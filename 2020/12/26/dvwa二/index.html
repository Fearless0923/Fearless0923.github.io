<!DOCTYPE HTML>
<html>

<head>
	<link rel="bookmark"  type="image/x-icon"  href="/img/logo_miccall.jpg"/>
	<link rel="shortcut icon" href="/img/logo_miccall.jpg">
	
			    <title>
    liquor's blog
    </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="/css/mic_main.css" />
    <link rel="stylesheet" href="/css/dropdownMenu.css" />
    <meta name="keywords" content="miccall" />
    
    	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	 
    <noscript>
        <link rel="stylesheet" href="/css/noscript.css" />
    </noscript>
    <style type="text/css">
        body:before {
          content: ' ';
          position: fixed;
          top: 0;
          background: url('/img/bg.jpg') center 0 no-repeat;
          right: 0;
          bottom: 0;
          left: 0;
          background-size: cover; 
        }
    </style>

			    
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script async type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.scrollex.min.js"></script>
    <script src="/js/jquery.scrolly.min.js"></script>
    <script src="/js/skel.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>
	
<meta name="generator" content="Hexo 5.2.0"></head>
    
		
<!-- Layouts -->



<!--  代码渲染  -->
<link rel="stylesheet" href="/css/prism_coy.css" />
<link rel="stylesheet" href="/css/typo.css" />
<!-- 文章页 -->
<body class="is-loading">
    <!-- Wrapper 外包 s-->
    <div id="wrapper" class="fade-in">
        <!-- Intro 头部显示 s -->
        <!-- Intro 头部显示 e -->
        <!-- Header 头部logo start -->
        <header id="header">
    <a href="/" class="logo">Little Genius</a>
</header>
        <!-- Nav 导航条 start -->
        <nav id="nav" class="special" >
            <ul class="menu links" >
			<!-- Homepage  主页  --> 
			<li >
	            <a href="/" rel="nofollow">主页</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">分类</a>
	                    <ul class="submenu">
	                        <li>
	                        
	                    </ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/about/" title="简历">
		                简历
		            </a>
		        </li>
		        
		        <li>
		            <a href="/group/" title="团队">
		                团队
		            </a>
		        </li>
		        
		        <li>
		            <a href="/gallery/" title="图库">
		                图库
		            </a>
		        </li>
		        
		        <li>
		            <a href="/tag/" title="标签">
		                标签
		            </a>
		        </li>
		        


            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
                    
                    <li>
                        <a title="github" href="https://github.com/liquor-boop" target="_blank" rel="noopener">
                            <i class="icon fa fa-github"></i>
                        </a>
                    </li>
                    
                    <li>
                        <a title="500px" href="http://500px.com" target="_blank" rel="noopener">
                            <i class="icon fa fa-500px"></i>
                        </a>
                    </li>
                    
			</ul>
</nav>

        <div id="main" >
            <div class ="post_page_title_img" style="height: 25rem;background-image: url();background-position: center; background-repeat:no-repeat; background-size:cover;-moz-background-size:cover;overflow:hidden;" >
                <a href="#" style="padding: 4rem 4rem 2rem 4rem ;"><h2 >Dvwa之Brute Force</h2></a>
            </div>
            <!-- Post -->
            <div class="typo" style="padding: 3rem;">
                <h1 id="dvwa"><a href="#dvwa" class="headerlink" title="dvwa"></a>dvwa</h1><h2 id="Brute-Force"><a href="#Brute-Force" class="headerlink" title="Brute Force"></a>Brute Force</h2><h4 id="low"><a href="#low" class="headerlink" title="low"></a>low</h4><h3 id="暴力破解，查看源代码："><a href="#暴力破解，查看源代码：" class="headerlink" title="暴力破解，查看源代码："></a>暴力破解，查看源代码：</h3><p><img src="/2020/12/26/dvwa%E4%BA%8C/2.jpg" alt="2"></p>
<p>它的select语句没有什么过滤，可以尝试sql注入构造<code>admin&#39;#</code>密码为空：</p>
<p><img src="/2020/12/26/dvwa%E4%BA%8C/3.jpg" alt="3"></p>
<p>成功~~但这关标题为暴力破解，所以要按暴力破解做一遍：</p>
<p>抓包,发到intruder,先clear ，选中要爆破字段,添加：</p>
<p><img src="/2020/12/26/dvwa%E4%BA%8C/1.jpg" alt="1"></p>
<p>在payload中选择字典，读取（字典很大读取了好久）：</p>
<p><img src="/2020/12/26/dvwa%E4%BA%8C/5.jpg" alt="5"></p>
<p>可设置线程数也可以使用默认：</p>
<p><img src="/2020/12/26/dvwa%E4%BA%8C/6.jpg" alt="6"></p>
<p>上图是我设置的线程数（线程数主要是设置一些重试时间，开始时间，线程数量等数据），就然后就可以开始破解：</p>
<p><img src="/2020/12/26/dvwa%E4%BA%8C/4.jpg" alt="4"></p>
<p>length可以对响应包的长度进行排序，找最大或最小的值（<strong>响应报文不一样，密码正确和错误返回的不是同一个响应报文，其长度一般都不同，故找出不同的一项，就可以找出正确的一项</strong>)然后看这个HTTP请求的响应报文：</p>
<img src="/2020/12/26/dvwa%E4%BA%8C/8.jpg" alt="8" style="zoom:50%;">

<p>报文中<code>welcome to the password protected area admin</code>表示成功登录。</p>
<p><img src="/2020/12/26/dvwa%E4%BA%8C/9.jpg" alt="9"></p>
<h3 id="medium"><a href="#medium" class="headerlink" title="medium"></a>medium</h3><p>查看源码:</p>
<p><img src="/2020/12/26/dvwa%E4%BA%8C/10.jpg" alt="10"></p>
<p>对传过来的值，使用了 <code>mysql_real_escape_string()</code> 函数，转义了以下字符：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\x00 \n \r \ &#x27; &quot; \x1a</span><br></pre></td></tr></table></figure>

<p>还使用了sleep(2)在密码错误的时候延时两秒：</p>
<p><img src="/2020/12/26/dvwa%E4%BA%8C/11.jpg" alt="11"></p>
<p>与low等级类似，但转义了很多字符不能再用SQL注入，暴力破解与前面操作一样。</p>
<h3 id="high"><a href="#high" class="headerlink" title="high"></a>high</h3><p>查看源码：</p>
<p><img src="/2020/12/26/dvwa%E4%BA%8C/22.jpg" alt="22"></p>
<p>发现登录验证时提交了username、password、login、user_token参数，服务器返回登陆页面时包含一个随机的user_token的值，每次登录时都要将user_token一起提交。服务器收到请求后，会先验证token，再进行sql查询。本关还使用了<a target="_blank" rel="noopener" href="https://www.w3school.com.cn/php/func_string_stripslashes.asp">stripslashes</a>函数（去除字符串中的反斜线字符,如果有两个连续的反斜线,则只去掉一个），<code> mysql_real_escape_string</code>对参数username、password进行过滤、转义,抵御sql注入。还是使用抓包，等学会python再用脚本做一遍。</p>
<h4 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h4><p>burp suite 有四种攻击模式，之前讲到的抓包中都使用狙击手模式，因为只需爆破一个位置，本关需要两个爆破位置故选择草叉模式（草叉模式允许使用多组payload组合，在每个标记位置上遍历所有payload组合)关于攻击模式详细看教程：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/diligenceday/p/12316899.html">攻击模式</a></p>
<h4 id="设置变量"><a href="#设置变量" class="headerlink" title="设置变量"></a>设置变量</h4><h4 id><a href="#" class="headerlink" title></a><img src="/2020/12/26/dvwa%E4%BA%8C/12.jpg" alt="12"></h4><h4 id="设置线程"><a href="#设置线程" class="headerlink" title="设置线程"></a>设置线程</h4><p>因为草叉模式只允许单线程，故线程要设为一。</p>
<h4 id="设置options"><a href="#设置options" class="headerlink" title="设置options"></a>设置options</h4><p>Grep-Extract提取响应消息中的有用信息，添加设置：</p>
<img src="/2020/12/26/dvwa%E4%BA%8C/15.jpg" alt="15" style="zoom:50%;">

<p>选中value值表示每次从响应中获得该值，将Redirections设置为Always。</p>
<h4 id="设置payloads"><a href="#设置payloads" class="headerlink" title="设置payloads"></a>设置payloads</h4><p>第一个参数不再赘述</p>
<img src="/2020/12/26/dvwa%E4%BA%8C/5-1610728925860.jpg" alt="5" style="zoom:50%;">

<p>第二个参数</p>
<img src="/2020/12/26/dvwa%E4%BA%8C/14.jpg" alt="14" style="zoom:50%;">

<p>红线部分为options中复制的token值。</p>
<h4 id="爆破"><a href="#爆破" class="headerlink" title="爆破"></a>爆破</h4><p><img src="/2020/12/26/dvwa%E4%BA%8C/13.jpg" alt="13"></p>
<h3 id="impossible"><a href="#impossible" class="headerlink" title="impossible"></a>impossible</h3><p>这个源代码有点复杂：</p>
<p><img src="/2020/12/26/dvwa%E4%BA%8C/16.jpg" alt="16"></p>
<p><img src="/2020/12/26/dvwa%E4%BA%8C/17.jpg" alt="17"><img src="/2020/12/26/dvwa%E4%BA%8C/18.jpg" alt="18"></p>
<p>本关一样有token值，但是两个级别最外层的爆破在通过字典尝试不同口令的时候，high只要发POST请求报文，就能从对应的响应报文拿到下次再发POST请求报文时需要用到的user_token。<strong>但impossible只有先发送GET方式的请求报文，才能获取到服务器发回来的一次性user_token。</strong>而GET方式的请求报文，无法提交爆破参数，只能通过POST方式的请求报文来提交爆破所用到的参数，所以需要在BurpSuite里建立一个宏来反复进行操作。</p>
<h4 id="建立宏"><a href="#建立宏" class="headerlink" title="建立宏"></a>建立宏</h4><p>直接对dvwa靶机的登录界面进行破解，在project options的sessions中添加Macros。</p>
<p>选择登录页面</p>
<p><img src="/2020/12/26/dvwa%E4%BA%8C/19.jpg" alt="19"></p>
<p>选择token后定义参数</p>
<p><img src="/2020/12/26/dvwa%E4%BA%8C/20.jpg" alt="20"></p>
<p>在configure item中添加</p>
<img src="/2020/12/26/dvwa%E4%BA%8C/21.jpg" alt="21" style="zoom:67%;">

<p>添加规则时注意描述规则时要将其参数范围定义到所有网址，全局宏定义就结束了</p>
<p><img src="/2020/12/26/dvwa%E4%BA%8C/23.jpg" alt="23"></p>
<p>接下来把提交的登录信息的包发送到入侵模块<strong>此时要选择post模式</strong></p>
<p><img src="/2020/12/26/dvwa%E4%BA%8C/25.jpg" alt="25"></p>
<p>接下来跟high等级一样但攻击模式要选默认的狙击手模式</p>
<p><img src="/2020/12/26/dvwa%E4%BA%8C/24.jpg" alt="24"></p>
<p>爆破成功~~</p>
<p>impossible和high级别的爆破涉及到登陆返回页面中产生的随机值user_token，在用户登录时要将user_token一起提交。由于user_token可提交报文的方式不同，high和impossible级别的爆破过程也不同。</p>
<p>至此dvwa的暴力破解就结束了~~</p>
<p>参考文献：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/126639909">DVWA教程之Brute Force（high、impossible）</a></p>

            </div>

            <!-- Post Comments -->
            
    <!-- 使用 DISQUS_CLICK -->
<div id="disqus-comment">
    <div id="disqus_thread"></div>

<!-- add animation -->
<style>
	.disqus_click_btn {
            line-height: 30px;
            margin: 0;
            min-width: 50px;
            padding: 0 14px;
            display: inline-block;
            font-family: "Roboto", "Helvetica", "Arial", sans-serif;
            font-size: 14px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0;
            overflow: hidden;
            will-change: box-shadow;
            transition: box-shadow .2s cubic-bezier(.4, 0, 1, 1), background-color .2s cubic-bezier(.4, 0, .2, 1), color .2s cubic-bezier(.4, 0, .2, 1);
            outline: 0;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            vertical-align: middle;
            border: 0;
            background: rgba(158, 158, 158, .2);
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, .14), 0 3px 1px -2px rgba(0, 0, 0, .2), 0 1px 5px 0 rgba(0, 0, 0, .12);
            color: #fff;
            background-color: #7EC0EE;
            text-shadow: 0
        }
</style>
	
<div class="btn_click_load" id="disqus_bt"> 
    <button class="disqus_click_btn">点击查看评论</button>
</div>

<!--
<script type="text/javascript">
$('.btn_click_load').click(function() {
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'http-miccall-tech'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    document.getElementById('disqus_bt').style.display = "none";
});
</script>
-->
<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://liquor-boop.github.io/2020/12/26/dvwa%E4%BA%8C/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://liquor-boop.github.io/2020/12/26/dvwa%E4%BA%8C/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
</script>

<script type="text/javascript">
    $('.btn_click_load').click(function() {  //click to load comments
        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document;
            var s = d.createElement('script');
            s.src = '//http-miccall-tech.disqus.com/embed.js';
            s.setAttribute('data-timestamp', + new Date());
            (d.head || d.body).appendChild(s);
        })();
        $('.btn_click_load').css('display','none');
    });
</script>
</div>
<style>
    #disqus-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>


        </div>
        <!-- Copyright 版权 start -->
                <div id="copyright">
            <ul>
                <li>&copy;Powered By <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/" style="border-bottom: none;">hexo</a></li>
                <li>Design: <a target="_blank" rel="noopener" href="http://miccall.tech " style="border-bottom: none;">miccall</a></li>
            </ul>
            
                <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
			
        </div>
    </div>
</body>



 	
</html>
