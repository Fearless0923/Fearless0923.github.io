

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Yu ting">
  <meta name="keywords" content="">
  <title>Hash Length Extension Attack - liquor&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.1.2/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />
  



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"liquor-boop.github.io","root":"/","version":"1.8.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"copy_btn":true,"image_zoom":{"enable":true},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Fluid</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="Hash Length Extension Attack">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-05-05 22:13" pubdate>
        May 5, 2021 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      2k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      30
       åˆ†é’Ÿ
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Hash Length Extension Attack</h1>
            
            <div class="markdown-body">
              <p>æ–°çŸ¥è¯†ç‚¹MD5hashé•¿åº¦æ‰©å±•æ”»å‡»å€Ÿ[De1CTF 2019]SSRF Meè®°å½•ä¸€ä¸‹ã€‚</p>
<p>æºç ï¼š</p>
<pre><code class="hljs ruby"><span class="hljs-comment">#! /usr/bin/env python</span>
<span class="hljs-comment">#encoding=utf-8</span>
from flask import Flask
from flask import request
import socket
import hashlib
import urllib
import sys
import os
import json
reload(sys)
sys.setdefaultencoding(<span class="hljs-string">&#x27;latin1&#x27;</span>)

app = Flask(__name_<span class="hljs-number">_</span>)

secert_key = os.urandom(<span class="hljs-number">16</span>)


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Task</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(<span class="hljs-keyword">self</span>, action, param, sign, ip)</span></span><span class="hljs-symbol">:</span>
        <span class="hljs-keyword">self</span>.action = action
        <span class="hljs-keyword">self</span>.param = param
        <span class="hljs-keyword">self</span>.sign = sign
        <span class="hljs-keyword">self</span>.sandbox = md5(ip)
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">not</span> os.path.exists(<span class="hljs-keyword">self</span>.sandbox)):          <span class="hljs-comment">#SandBox For Remote_Addr</span>
            os.mkdir(<span class="hljs-keyword">self</span>.sandbox)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Exec</span><span class="hljs-params">(<span class="hljs-keyword">self</span>)</span></span><span class="hljs-symbol">:</span>
        result = &#123;&#125;
        result[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-number">500</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.checkSign())<span class="hljs-symbol">:</span>
            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;scan&quot;</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">self</span>.<span class="hljs-symbol">action:</span>
                tmpfile = open(<span class="hljs-string">&quot;./%s/result.txt&quot;</span> % <span class="hljs-keyword">self</span>.sandbox, <span class="hljs-string">&#x27;w&#x27;</span>)
                resp = scan(<span class="hljs-keyword">self</span>.param)
                <span class="hljs-keyword">if</span> (resp == <span class="hljs-string">&quot;Connection Timeout&quot;</span>)<span class="hljs-symbol">:</span>
                    result[<span class="hljs-string">&#x27;data&#x27;</span>] = resp
                <span class="hljs-symbol">else:</span>
                    print resp
                    tmpfile.write(resp)
                    tmpfile.close()
                result[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-number">200</span>
            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;read&quot;</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">self</span>.<span class="hljs-symbol">action:</span>
                f = open(<span class="hljs-string">&quot;./%s/result.txt&quot;</span> % <span class="hljs-keyword">self</span>.sandbox, <span class="hljs-string">&#x27;r&#x27;</span>)
                result[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-number">200</span>
                result[<span class="hljs-string">&#x27;data&#x27;</span>] = f.read()
            <span class="hljs-keyword">if</span> result[<span class="hljs-string">&#x27;code&#x27;</span>] == <span class="hljs-number">500</span><span class="hljs-symbol">:</span>
                result[<span class="hljs-string">&#x27;data&#x27;</span>] = <span class="hljs-string">&quot;Action Error&quot;</span>
        <span class="hljs-symbol">else:</span>
            result[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-number">500</span>
            result[<span class="hljs-string">&#x27;msg&#x27;</span>] = <span class="hljs-string">&quot;Sign Error&quot;</span>
        <span class="hljs-keyword">return</span> result

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">checkSign</span><span class="hljs-params">(<span class="hljs-keyword">self</span>)</span></span><span class="hljs-symbol">:</span>
        <span class="hljs-keyword">if</span> (getSign(<span class="hljs-keyword">self</span>.action, <span class="hljs-keyword">self</span>.param) == <span class="hljs-keyword">self</span>.sign)<span class="hljs-symbol">:</span>
            <span class="hljs-keyword">return</span> True
        <span class="hljs-symbol">else:</span>
            <span class="hljs-keyword">return</span> False


<span class="hljs-comment">#generate Sign For Action Scan.</span>
@app.route(<span class="hljs-string">&quot;/geneSign&quot;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>])
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">geneSign</span><span class="hljs-params">()</span></span><span class="hljs-symbol">:</span>
    param = urllib.unquote(request.args.get(<span class="hljs-string">&quot;param&quot;</span>, <span class="hljs-string">&quot;&quot;</span>))
    action = <span class="hljs-string">&quot;scan&quot;</span>
    <span class="hljs-keyword">return</span> getSign(action, param)


@app.route(<span class="hljs-string">&#x27;/De1ta&#x27;</span>,methods=[<span class="hljs-string">&#x27;GET&#x27;</span>,<span class="hljs-string">&#x27;POST&#x27;</span>])
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">challenge</span><span class="hljs-params">()</span></span><span class="hljs-symbol">:</span>
    action = urllib.unquote(request.cookies.get(<span class="hljs-string">&quot;action&quot;</span>))
    param = urllib.unquote(request.args.get(<span class="hljs-string">&quot;param&quot;</span>, <span class="hljs-string">&quot;&quot;</span>))
    sign = urllib.unquote(request.cookies.get(<span class="hljs-string">&quot;sign&quot;</span>))
    ip = request.remote_addr
    <span class="hljs-keyword">if</span>(waf(param))<span class="hljs-symbol">:</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;No Hacker!!!!&quot;</span>
    task = Task(action, param, sign, ip)
    <span class="hljs-keyword">return</span> json.dumps(task.Exec())
@app.route(<span class="hljs-string">&#x27;/&#x27;</span>)
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span><span class="hljs-params">()</span></span><span class="hljs-symbol">:</span>
    <span class="hljs-keyword">return</span> open(<span class="hljs-string">&quot;code.txt&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>).read()


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">scan</span><span class="hljs-params">(param)</span></span><span class="hljs-symbol">:</span>
    socket.setdefaulttimeout(<span class="hljs-number">1</span>)
    <span class="hljs-symbol">try:</span>
        <span class="hljs-keyword">return</span> urllib.urlopen(param).read()[<span class="hljs-symbol">:</span><span class="hljs-number">50</span>]
    <span class="hljs-symbol">except:</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Connection Timeout&quot;</span>



<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getSign</span><span class="hljs-params">(action, param)</span></span><span class="hljs-symbol">:</span>
    <span class="hljs-keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">md5</span><span class="hljs-params">(content)</span></span><span class="hljs-symbol">:</span>
    <span class="hljs-keyword">return</span> hashlib.md5(content).hexdigest()


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">waf</span><span class="hljs-params">(param)</span></span><span class="hljs-symbol">:</span>
    check=param.strip().lower()
    <span class="hljs-keyword">if</span> check.startswith(<span class="hljs-string">&quot;gopher&quot;</span>) <span class="hljs-keyword">or</span> check.startswith(<span class="hljs-string">&quot;file&quot;</span>)<span class="hljs-symbol">:</span>
        <span class="hljs-keyword">return</span> True
    <span class="hljs-symbol">else:</span>
        <span class="hljs-keyword">return</span> False


<span class="hljs-keyword">if</span> __name_<span class="hljs-number">_</span> == <span class="hljs-string">&#x27;__main__&#x27;</span><span class="hljs-symbol">:</span>
    app.debug = False
    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>)</code></pre>
<h3 id="æ³•ä¸€"><a class="header-anchor" href="#æ³•ä¸€">ğŸ­</a>æ³•ä¸€</h3>
<p>flaskæ¡†æ¶ï¼Œä¸€å…±ä¸‰ä¸ªè·¯ç”±ï¼š</p>
<blockquote>
<p>indexè·å–æºç </p>
</blockquote>
<blockquote>
<p>geneSignè°ƒç”¨äº†getSignæ–¹æ³•ç”Ÿæˆ md5</p>
</blockquote>
<blockquote>
<p>De1taè·å–äº†ä¸‰ä¸ªå‚æ•°</p>
<blockquote>
<p><code>action = urllib.unquote(request.cookies.get(&quot;action&quot;))</code>//actionæ˜¯ä¼ å…¥readå’Œscançš„<br>
<code>param = urllib.unquote(request.args.get(&quot;param&quot;, &quot;&quot;))</code>//ä¼ å…¥ä¸€ä¸ªæ–‡ä»¶å<br>
<code>sign = urllib.unquote(request.cookies.get(&quot;sign&quot;))</code>//signæ˜¯MD5å€¼<br>
Taskä¸­æœ‰ä¸ªExec()æ–¹æ³•ï¼Œé‡Œé¢è¿˜æœ‰ä¸ªcheckSign()ï¼Œå¹¶ä¸”åœ¨è¿™é‡Œé¢è°ƒç”¨äº†getSign()æ–¹æ³•ï¼Œç»“æœä¸signè¿›è¡Œæ¯”è¾ƒï¼ŒgetSign()æ–¹æ³•é‡Œæœ‰ä¸ªsecert_keyï¼Œæˆ‘ä»¬éœ€è¦æ„é€ å‚æ•°:ç¬¬ä¸€ä¸ªå‚æ•°actionåº”è¯¥åŒ…å«readï¼Œç¬¬äºŒä¸ªparamå‚æ•°åº”è¯¥æ˜¯æ–‡ä»¶åï¼Œç¬¬ä¸‰ä¸ªå‚æ•°çš„secert_keyå€¼æˆ‘ä»¬ä¸çŸ¥é“ï¼Œæ‰€ä»¥ä¸èƒ½è‡ªå·±åŠ å¯†ï¼Œè®¿é—®ä¸€ä¸‹geneSigné¡µé¢ï¼Œå¹¶ä¼ å…¥å‚æ•°param=flag.txtå¾—åˆ°ä¸€ä¸²MD5å€¼ï¼š</p>
<p><img src="/2021/05/05/hash/1.jpg" srcset="/img/loading.gif" alt="1"></p>
<p>æºç <code>md5(secert_key + param + action)</code>é‡Œçš„actionå›ºå®šä¸ºcsanï¼Œæ‰€ä»¥æˆ‘ä»¬ç°åœ¨éœ€è¦çš„æ˜¯<code>md5(key+flag.txt+scanread/readscan)</code>æˆ‘ä»¬ç°åœ¨å¾—åˆ°äº†md5å€¼ï¼Œæ¥ç€è®¿é—®De1taé¡µé¢ä¼ å…¥flag.txtå³å¯</p>
<img src="/2021/05/05/hash/2.jpg" srcset="/img/loading.gif" alt="2" style="zoom: 50%;">
</blockquote>
</blockquote>
<h2 id="æ³•äºŒï¼šMD5hashé•¿åº¦æ‰©å±•æ”»å‡»"><a class="header-anchor" href="#æ³•äºŒï¼šMD5hashé•¿åº¦æ‰©å±•æ”»å‡»">ğŸ­</a>æ³•äºŒï¼šMD5hashé•¿åº¦æ‰©å±•æ”»å‡»</h2>
<h4 id="MD5ç®—æ³•"><a class="header-anchor" href="#MD5ç®—æ³•">ğŸ­</a>MD5ç®—æ³•</h4>
<p><img src="/2021/05/05/hash/4.png" srcset="/img/loading.gif" alt="4"></p>
<p>MD5ç®—æ³•åˆ†ä¸ºä¸¤æ­¥ï¼š</p>
<ul>
<li>MD5 padding</li>
<li>MD5 compress</li>
</ul>
<h4 id="md5-padding"><a class="header-anchor" href="#md5-padding">ğŸ­</a>md5 padding</h4>
<blockquote>
<p>å¦‚æœè¾“å…¥ä¿¡æ¯çš„é•¿åº¦(å­—èŠ‚)å¯¹64æ±‚ä½™çš„ç»“æœä¸ç­‰äº56ï¼Œå°±éœ€è¦å¡«å……ä½¿å¾—å¯¹64æ±‚ä½™çš„ç»“æœç­‰äº56ã€‚å¡«å……çš„æ–¹æ³•æ˜¯å¡«å……ä¸€ä¸ªx80å’Œxxä¸ª0ã€‚å¡«å……å®Œåï¼Œä¿¡æ¯çš„é•¿åº¦ä¸ºN*64+56(å­—èŠ‚)ï¼Œå¹¶ä¸”æœ€å8ä¸ªå­—èŠ‚ç”¨æ¥è®°å½•åŸå§‹è¾“å…¥ä¿¡æ¯é•¿åº¦</p>
</blockquote>
<p>å¦‚adminè¿›è¡Œmd5 paddingçš„ç»“æœä¸ºï¼š</p>
<pre><code class="hljs angelscript"><span class="hljs-number">61646</span>d696e8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002800000000000000</code></pre>
<p>å³ç”±ä»¥ä¸‹å‡ å—ç»„åˆ<br>
<code>61646d696e</code> ï¼šadminçš„hex<br>
<code>80</code>ï¼šå¡«å……çš„x80<br>
<code>50ä¸ª00</code>ï¼šä¸ºäº†ä¿è¯ä¿¡æ¯çš„é•¿åº¦ä¸ºN*64+56(å­—èŠ‚)<br>
<code>2800000000000000</code>ï¼šå®é™…çš„å€¼ä¸º<code>0000000000000028</code>ï¼Œåè¿›åˆ¶çš„40ï¼Œå•ä½æ˜¯bitï¼Œæ‰€ä»¥æ˜¯5ä¸ªå­—èŠ‚(admin)</p>
<h3 id="Magic-number"><a class="header-anchor" href="#Magic-number">ğŸ­</a>Magic number</h3>
<blockquote>
<p>ä»£ç ä¸­çš„<code>0x67452301L, 0xefcdab89L, 0x98badcfeL, 0x10325476L</code>è¿™4ä¸ªåˆå§‹åŒ–çš„numberå°±è¢«ç§°ä¸ºMagic numberæˆ–è€…æ˜¯md5 iv(md5 å‘é‡)</p>
</blockquote>
<p>md5çš„ç®—æ³•æ¦‚æ‹¬ï¼š</p>
<blockquote>
<p>å…ˆè¿›è¡Œæ¶ˆæ¯é•¿åº¦çš„å¡«å……(padding)ã€‚å¡«å……å®Œåï¼Œåˆå§‹åŒ–çš„4ä¸ªMagic numberä¼šå’Œç¬¬ä¸€ä¸ª64å­—èŠ‚çš„Message blockè¿›è¡Œmd5  compresså‹ç¼©ç®—æ³•ã€‚å‹ç¼©ç®—æ³•å®Œæˆåï¼Œä¼šäº§ç”Ÿæ–°çš„4ä¸ªMagic numberã€‚è¿™æ ·å†è¿›è¡Œç¬¬äºŒä¸ª64å­—èŠ‚Message blockçš„md5  compresså‹ç¼©ç®—æ³•ã€‚ä»¥æ­¤ç±»æ¨â€¦â€¦ç›´åˆ°å‹ç¼©åˆ°æœ€å64ä¸ªå­—èŠ‚çš„(<code>Message block</code> + padding)ï¼Œæœ€åå¾—åˆ°çš„Magic numberç»è¿‡hexè½¬åŒ–å°±æ˜¯æœ€åçš„md5 hashå€¼</p>
</blockquote>
<p>adminï¼š</p>
<p>md5ç»è¿‡paddingåï¼Œç”±äºåªæœ‰64å­—èŠ‚ï¼Œæ‰€ä»¥åªè¿›è¡Œä¸€è½®md5 compressã€‚å‹ç¼©ç®—æ³•å®Œæˆåï¼Œäº§ç”Ÿçš„æ–°çš„Magic numberä¸º</p>
<pre><code class="hljs apache"><span class="hljs-attribute">A</span>=<span class="hljs-number">0</span>x<span class="hljs-number">292</span>f<span class="hljs-number">2321</span>L
<span class="hljs-attribute">B</span>=<span class="hljs-number">0</span>xa<span class="hljs-number">7</span>a<span class="hljs-number">5577</span>aL
<span class="hljs-attribute">C</span>=<span class="hljs-number">0</span>xe<span class="hljs-number">4</span>a<span class="hljs-number">8943</span>L
<span class="hljs-attribute">D</span>=<span class="hljs-number">0</span>xc<span class="hljs-number">31</span>f<span class="hljs-number">804</span>aL</code></pre>
<p>md5çš„åŠ å¯†ç»“æœæ˜¯<code>21232f297a57a5a743894a0e4a801fc3</code>ï¼Œæˆ‘ä»¬å°†Aå¤§å°ç«¯é€†åºä¸€ä¸‹ï¼Œå˜æˆ21232F29ï¼Œåˆšå¥½æ˜¯md5çš„å‰8ä½ã€‚</p>
<p>å·²çŸ¥ï¼š</p>
<ul>
<li>md5(salt+message)çš„å€¼</li>
<li>messageå†…å®¹</li>
<li>salt+messageé•¿åº¦</li>
</ul>
<p>MD5é•¿åº¦æ‰©å±•æ”»å‡»å°±æ˜¯åœ¨ä¸çŸ¥é“saltçš„å…·ä½“å†…å®¹çš„æƒ…å†µä¸‹ï¼Œè®¡ç®—å‡ºä»»æ„çš„md5(salt+message+padding+append)å€¼ã€‚å› ä¸ºåœ¨è¿›è¡Œ<code>md5(salt+message+padding+m')</code>çš„æ—¶å€™ï¼Œåœ¨å¯¹mâ€™è¿›è¡Œpaddingä¹‹å‰çš„Message blockï¼Œå’Œ<code>md5(salt+message)</code>äº§æˆçš„Message blockä¸€æ ·ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨saltæœªçŸ¥çš„æƒ…å†µä¸‹ï¼Œåªéœ€æ ¹æ®<code>md5(salt+message)</code>çš„ç»“æœï¼Œé€†å‘å‡ºæœ€åä¸€æ¬¡çš„4ä¸ªMagic numberã€‚</p>
<p>é€†å‘ç®—æ³•ï¼š</p>
<pre><code class="hljs apache"><span class="hljs-attribute">def</span> compute_magic_number(self, md<span class="hljs-number">5</span>str):
    <span class="hljs-attribute">self</span>.A = struct.unpack(<span class="hljs-string">&quot;I&quot;</span>, md<span class="hljs-number">5</span>str[<span class="hljs-number">0</span>:<span class="hljs-number">8</span>].decode(&#x27;hex&#x27;))[<span class="hljs-number">0</span>]
    <span class="hljs-attribute">self</span>.B = struct.unpack(<span class="hljs-string">&quot;I&quot;</span>, md<span class="hljs-number">5</span>str[<span class="hljs-number">8</span>:<span class="hljs-number">16</span>].decode(&#x27;hex&#x27;))[<span class="hljs-number">0</span>]
    <span class="hljs-attribute">self</span>.C = struct.unpack(<span class="hljs-string">&quot;I&quot;</span>, md<span class="hljs-number">5</span>str[<span class="hljs-number">16</span>:<span class="hljs-number">24</span>].decode(&#x27;hex&#x27;))[<span class="hljs-number">0</span>]
    <span class="hljs-attribute">self</span>.D = struct.unpack(<span class="hljs-string">&quot;I&quot;</span>, md<span class="hljs-number">5</span>str[<span class="hljs-number">24</span>:<span class="hljs-number">32</span>].decode(&#x27;hex&#x27;))[<span class="hljs-number">0</span>]</code></pre>
<p>æ ¹æ®è¿™4ä¸ªMagci numberï¼Œå†å’Œæ‰©å±•çš„å­—ç¬¦ä¸²<code>m'</code>(æ­¤æ—¶çš„mâ€™è¦è¿›è¡Œpaddingï¼Œpaddingçš„é•¿åº¦æ˜¯<code>len(salt+message+padding+m')</code>)è¿›è¡Œmd5 compressï¼Œæœ€åçš„ç»“æœå³<code>md5(salt+message+padding+m')</code>ï¼Œmâ€™è¡¨ç¤ºè¦æ‰©å±•çš„å­—ç¬¦ä¸²ï¼Œpaddingè¡¨ç¤ºå¯¹salt+messageé•¿åº¦è¿›è¡Œpaddingåçš„ç»“æœã€‚</p>
<h4 id="å®ä¾‹ï¼š"><a class="header-anchor" href="#å®ä¾‹ï¼š">ğŸ­</a>å®ä¾‹ï¼š</h4>
<p>å·²çŸ¥saltçš„é•¿åº¦ä¸º4ï¼Œmessageä¸ºadminï¼Œmd5(salt+message)çš„å€¼ä¸ºc7813629f22b6a7d28a08041db3e80a9ï¼Œæƒ³æ‰©å±•çš„å­—ç¬¦ä¸²mâ€™ä¸º<code>joychou</code>ï¼Œè®¡ç®—<code>md5(salt+message+padding+m')</code>çš„å€¼ï¼Œpaddingè¡¨ç¤ºå¯¹salt+messageé•¿åº¦è¿›è¡Œpaddingåçš„ç»“æœ</p>
<p>c7813629f22b6a7d28a08041db3e80a9é€†å‘å‡ºmagic numberä¸ºï¼š</p>
<pre><code class="hljs apache"><span class="hljs-attribute">A</span>=<span class="hljs-number">0</span>x<span class="hljs-number">292</span>f<span class="hljs-number">2321</span>L
<span class="hljs-attribute">B</span>=<span class="hljs-number">0</span>xa<span class="hljs-number">7</span>a<span class="hljs-number">5577</span>aL
<span class="hljs-attribute">C</span>=<span class="hljs-number">0</span>xe<span class="hljs-number">4</span>a<span class="hljs-number">8943</span>L
<span class="hljs-attribute">D</span>=<span class="hljs-number">0</span>xc<span class="hljs-number">31</span>f<span class="hljs-number">804</span>aL</code></pre>
<p>å…ˆå¯¹mâ€™è¿›è¡Œpaddingï¼Œpaddingç»“æœç”¨<code>padding(m')</code></p>
<pre><code class="hljs angelscript"><span class="hljs-number">800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003802000000000000</span></code></pre>
<p>é•¿åº¦57ä¸ªå­—èŠ‚ï¼Œæ³¨æ„æœ€å8ä¸ªå­—èŠ‚0x238ä¸º<code>len(salt+message+padding+m')</code>ï¼Œå³568bitï¼Œ71å­—èŠ‚</p>
<p>å†ç”¨è¿™4ä¸ªmagic  numberå¯¹mâ€™äº§ç”Ÿçš„Message blockè¿›è¡Œmd5 compressï¼Œæœ€åç»“æœä¸º06cf5a94dcda53659f58c0f411ba0bd8</p>
<p>ä¸ºäº†è¯æ˜å’ŒéªŒè¯æƒ³æ³•ï¼Œæˆ‘ä»¬æ­£å‘å»è¿›è¡Œmd5åŠ å¯†ï¼Œçœ‹çœ‹paddingçš„è¿‡ç¨‹ã€‚æ­¤æ—¶éœ€è¦çŸ¥é“saltï¼Œsaltä¸º<code>meme</code></p>
<p>åŸå§‹çš„urlencodeåå­—ç¬¦ä¸²ä¸º</p>
<pre><code class="hljs angelscript">memeadmin%<span class="hljs-number">80</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>H%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>%<span class="hljs-number">00</span>joychou</code></pre>
<p>ä»£ç ï¼š</p>
<pre><code class="hljs python">str = unquote(<span class="hljs-string">&quot;memeadmin%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00H%00%00%00%00%00%00%00joychou&quot;</span>)
m = md5py.md5()
<span class="hljs-keyword">print</span> m.my_md5(str)</code></pre>
<p>è¿›è¡Œpaddingå</p>
<pre><code class="hljs angelscript"><span class="hljs-number">6</span>d656d6561646d696e800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000048000000000000006a6f7963686f75800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003802000000000000</code></pre>
<p>å¯ä»¥å‘ç°ï¼Œå…¶å®åªå¯¹joychouè¿›è¡Œäº†paddingã€‚è€Œä¸”å‰64å­—èŠ‚äº§ç”Ÿçš„magic numberæ­£æ˜¯c7813629f22b6a7d28a08041db3e80a9ç®—å‡ºæ¥çš„ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://github.com/JoyChou93/md5-extension-attack">md5é•¿åº¦æ‰©å±•æ”»å‡»ä»£ç è„šæœ¬</a>ï¼š</p>
<pre><code class="hljs apache"><span class="hljs-comment"># coding:utf-8</span>

<span class="hljs-attribute">import</span> md<span class="hljs-number">5</span>py
<span class="hljs-attribute">import</span> sys
<span class="hljs-attribute">from</span> urllib import unquote
<span class="hljs-attribute">import</span> hashlib
<span class="hljs-attribute">import</span> struct
<span class="hljs-attribute">import</span> urllib


<span class="hljs-attribute">def</span> payload(length, str_append):
    <span class="hljs-attribute">pad</span> = &#x27;&#x27;
    <span class="hljs-attribute">n0</span> = ((<span class="hljs-number">56</span> - (length + <span class="hljs-number">1</span>) % <span class="hljs-number">64</span>) % <span class="hljs-number">64</span>)
    <span class="hljs-attribute">pad</span> += &#x27;\x<span class="hljs-number">80</span>&#x27; 
    <span class="hljs-attribute">pad</span> += &#x27;\x<span class="hljs-number">00</span>&#x27;*n<span class="hljs-number">0</span> + struct.pack(&#x27;Q&#x27;, length*<span class="hljs-number">8</span>)

    <span class="hljs-attribute">return</span> pad + str_append


<span class="hljs-attribute">def</span> hashmd<span class="hljs-number">5</span>(str):
    <span class="hljs-attribute">return</span> hashlib.md<span class="hljs-number">5</span>(str).hexdigest()


<span class="hljs-attribute">def</span> check_extension_attack():
    <span class="hljs-attribute">for</span> i in range(<span class="hljs-number">1</span>, <span class="hljs-number">65</span>):
        <span class="hljs-attribute">s</span> = <span class="hljs-string">&quot;A&quot;</span> * i
        <span class="hljs-attribute">mm</span> = md<span class="hljs-number">5</span>py.md<span class="hljs-number">5</span>()
        <span class="hljs-attribute">assert</span> hashlib.md<span class="hljs-number">5</span>(s).hexdigest() == mm.my_md<span class="hljs-number">5</span>(s)
        <span class="hljs-attribute">print</span> mm.my_md<span class="hljs-number">5</span>(s)
    <span class="hljs-attribute">for</span> i in range(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>):
        <span class="hljs-attribute">for</span> j in range(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>):
            <span class="hljs-attribute">s</span> = &#x27;A&#x27; * i
            <span class="hljs-attribute">salt</span> = &#x27;B&#x27; * j
            <span class="hljs-attribute">mm</span> = md<span class="hljs-number">5</span>py.md<span class="hljs-number">5</span>()
            <span class="hljs-attribute">msg</span> = salt + s + payload(len(salt+s), &#x27;joychou&#x27;)
            <span class="hljs-attribute">assert</span> hashmd<span class="hljs-number">5</span>(msg) == mm.extension_attack(hashmd<span class="hljs-number">5</span>(salt+s), &#x27;joychou&#x27;, len(salt+s))

<span class="hljs-comment"># check if md5 extension attack is correct</span>
<span class="hljs-comment"># check_extension_attack()</span>

<span class="hljs-attribute">if</span> len(sys.argv) &lt; <span class="hljs-number">3</span>:
    <span class="hljs-attribute">print</span> <span class="hljs-string">&quot;Usage: &quot;</span>, sys.argv[<span class="hljs-number">0</span>], <span class="hljs-string">&quot; &lt;md5string&gt; &lt;string_to_append&gt; [length of plaintext of md5string]&quot;</span>
    <span class="hljs-attribute">sys</span>.exit()


<span class="hljs-attribute">hash_origin</span> = sys.argv[<span class="hljs-number">1</span>]
<span class="hljs-attribute">str_append</span> = sys.argv[<span class="hljs-number">2</span>]
<span class="hljs-attribute">lenth</span> = int(sys.argv[<span class="hljs-number">3</span>])

<span class="hljs-attribute">m</span> = md<span class="hljs-number">5</span>py.md<span class="hljs-number">5</span>()

<span class="hljs-attribute">str_payload</span> = payload(lenth, str_append)
<span class="hljs-attribute">print</span> <span class="hljs-string">&quot;Payload: &quot;</span>, repr(str_payload)
<span class="hljs-attribute">print</span> <span class="hljs-string">&quot;Payload urlencode:&quot;</span>, urllib.quote_plus(str_payload)
<span class="hljs-attribute">print</span> <span class="hljs-string">&quot;md5:&quot;</span>, m.extension_attack(hash_origin, str_append, lenth)</code></pre>
<h4 id="ä¿®å¤"><a class="header-anchor" href="#ä¿®å¤">ğŸ­</a>ä¿®å¤</h4>
<blockquote>
<p>å¾ˆå¤šå“ˆå¸Œç®—æ³•éƒ½å­˜åœ¨Length Extensionæ”»å‡»ï¼Œè¿™æ˜¯å› ä¸ºè¿™äº›å“ˆå¸Œç®—æ³•éƒ½ä½¿ç”¨äº†Merkleâ€“DamgÃ¥rd constructionè¿›è¡Œæ•°æ®çš„å‹ç¼©ï¼Œæµè¡Œç®—æ³•æ¯”å¦‚MD5ã€SHA-1ç­‰éƒ½å—å½±å“ã€‚å¯å°†<code>md5($salt.$role)</code>æ›¿æ¢æˆ<code>md5($role.$salt)</code></p>
</blockquote>
<p>ä»¥ä¸Šä¸ºhashdumpåŸç†ï¼Œæœ¬é¢˜å¯è§£ï¼š</p>
<p><img src="/2021/05/05/hash/3.png" srcset="/img/loading.gif" alt="3"></p>
<p>å‚æ•°ä¼ é€’å¾—åˆ°flagï¼š</p>
<p><img src="/2021/05/05/hash/6.png" srcset="/img/loading.gif" alt="6"></p>
<p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://joychou.org/web/hash-length-extension-attack.html#directory079462120078608992">Hash Length Extension Attack</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42967398/article/details/103549258">BUUCTF WEB [De1CTF 2019]SSRF Me</a></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/05/03/GXYctf/">
                        <span class="hidden-mobile">GXYCTF2019|ç¦æ­¢å¥—å¨ƒ</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":200})
    NProgress.start()
    document.addEventListener('DOMContentLoaded', function() {
      window.NProgress && window.NProgress.inc();
    })
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.staticfile.org/tocbot/4.12.0/tocbot.min.js" ></script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>





  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ ä¿æŒåœ¨æœ€åº•éƒ¨ -->
<script  src="/js/boot.js" ></script>



</body>
</html>
