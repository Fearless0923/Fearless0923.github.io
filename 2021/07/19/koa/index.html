

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Yu ting">
  <meta name="keywords" content="">
  <title>koaæ¡†æ¶æµ…æ - Fearless&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.1.2/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />
  



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"fearless0923.github.io","root":"/","version":"1.8.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"copy_btn":true,"image_zoom":{"enable":true},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Fearless's blog" type="application/atom+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Fluid</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="koaæ¡†æ¶æµ…æ">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-07-19 23:05" pubdate>
        July 19, 2021 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      2.9k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      38
       åˆ†é’Ÿ
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">koaæ¡†æ¶æµ…æ</h1>
            
            <div class="markdown-body">
              <h2 id="koaæ¡†æ¶"><a class="header-anchor" href="#koaæ¡†æ¶">ğŸ­</a>koaæ¡†æ¶</h2>
<p>Koa æ˜¯ä¸€ä¸ªæ–°çš„ web æ¡†æ¶ï¼Œ é€šè¿‡åˆ©ç”¨ async å‡½æ•°ï¼ŒKoa ä¸¢å¼ƒäº†å›è°ƒå‡½æ•°ï¼Œå¢å¼ºé”™è¯¯å¤„ç†ï¼Œæ²¡æœ‰æ†ç»‘ä»»ä½•ä¸­é—´ä»¶ã€‚</p>
<h3 id="ç›®å½•ç»“æ„"><a class="header-anchor" href="#ç›®å½•ç»“æ„">ğŸ­</a>ç›®å½•ç»“æ„</h3>
<img src="/2021/07/19/koa/1.png" srcset="/img/loading.gif" alt="1" style="zoom:50%;">
<h4 id="app-js"><a class="header-anchor" href="#app-js">ğŸ­</a>app.js</h4>
<pre><code class="hljs javascript"><span class="hljs-meta">&#x27;use strict&#x27;</span>

<span class="hljs-keyword">const</span> Koa = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa&#x27;</span>)
<span class="hljs-keyword">const</span> bodyParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-bodyparser&#x27;</span>)()
<span class="hljs-keyword">const</span> staticCache = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-static-cache&#x27;</span>)

<span class="hljs-keyword">const</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./config&#x27;</span>)
<span class="hljs-keyword">const</span> publicRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./routes/public&#x27;</span>)
<span class="hljs-keyword">const</span> privateRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./routes/private&#x27;</span>)
<span class="hljs-keyword">const</span> &#123; loggerMiddleware &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./middlewares/logger&#x27;</span>)
<span class="hljs-keyword">const</span> &#123; errorHandler, responseHandler &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./middlewares/response&#x27;</span>)

<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> Koa()

<span class="hljs-comment">// Logger</span>
app.use(loggerMiddleware)

<span class="hljs-comment">// Error Handler</span>
app.use(errorHandler)

<span class="hljs-comment">// Global Middlewares</span>
app.use(bodyParser)
app.use(staticCache(config.publicDir))

<span class="hljs-comment">// Routes</span>
app.use(publicRouter.routes(), publicRouter.allowedMethods())
app.use(privateRouter.routes(), privateRouter.allowedMethods())

<span class="hljs-comment">// Response</span>
app.use(responseHandler)

<span class="hljs-built_in">module</span>.exports = app</code></pre>
<p>æ–‡ä»¶æœ‰è¾ƒå¤šçš„ä¸­é—´ä»¶ï¼Œä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåºæ˜¯ä»å¤–åˆ°å†…ï¼Œå†ä»å†…åˆ°å¤–ï¼Œä¹Ÿå°±æ˜¯æ´‹è‘±æ¨¡å¼ã€‚ä¸­é—´ä»¶çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯ä¾é <code>app.use()</code>è¿›è¡Œä¼ é€’çš„ï¼Œå¯ä»¥ç®€å•çš„ç†è§£ä¸ºè‡ªå·±ç¼–å†™çš„å‡½æ•°ï¼Œä¾æ¬¡å»æ‰§è¡Œå³å¯ã€‚æ¯ä¸€ä¸ªä¸­é—´ä»¶ä¼šåœ¨appè°ƒç”¨æ˜¯ä¼ å…¥2ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸ºï¼š <code>ctx</code>å’Œ<code>next</code></p>
<blockquote>
<p>ctx:<br>
Koa Context å°† node çš„ request å’Œ response å¯¹è±¡å°è£…åœ¨ä¸€ä¸ªå•ç‹¬çš„å¯¹è±¡é‡Œé¢ï¼Œå…¶ä¸ºç¼–å†™ web åº”ç”¨å’Œ API æä¾›äº†å¾ˆå¤šæœ‰ç”¨çš„æ–¹æ³•ã€‚<br>
è¿™äº›æ“ä½œåœ¨HTTPæœåŠ¡å™¨å¼€å‘ä¸­ç»å¸¸ä½¿ç”¨ï¼Œå› æ­¤å…¶è¢«æ·»åŠ åœ¨ä¸Šä¸‹æ–‡è¿™ä¸€å±‚ï¼Œè€Œä¸æ˜¯æ›´é«˜å±‚æ¡†æ¶ä¸­ï¼Œå› æ­¤å°†è¿«ä½¿ä¸­é—´ä»¶éœ€è¦é‡æ–°å®ç°è¿™äº›å¸¸ç”¨æ–¹æ³•ã€‚</p>
<p>nextï¼š<br>
ä¸‹ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ªä¸­é—´ä»¶å¦‚æœè¦å¾€ä¸‹èµ°å¿…é¡»å†™ä¸Šè¿™ä¸ªï¼Œå¦åˆ™æ— æ³•æ‰§è¡Œã€‚<br>
å¯ä»¥ç†è§£ä¸ºå‰ç«¯çš„vue-Routerä¸­çš„è·¯ç”±å®ˆå«ä¸­çš„next(), æ‰§è¡Œä¸‹ä¸€æ­¥æˆ–è€…è¿›è¡Œä¼ å‚ã€‚</p>
</blockquote>
<h4 id="middlewaresæ–‡ä»¶"><a class="header-anchor" href="#middlewaresæ–‡ä»¶">ğŸ­</a>middlewaresæ–‡ä»¶</h4>
<p>åœ¨è¿™ä¸ªé¡¹ç›®ä¸»è¦ç”¨åˆ°äº†å‡ ä¸ªä¸­é—´ä»¶:<code>logger.js</code>,<code>response.js</code>, <code>jwt.js</code>ç­‰å…¶ä»–ä¸­é—´ä»¶ã€‚è‹¥åœ¨æ­¤ç›®å½•ä¸­æ–°å»ºå¯¹åº”ä¸­é—´ä»¶åï¼Œè¦åœ¨app.jsä¸­è¿›è¡Œå¼•å…¥ï¼Œå¦åœ¨æ— æ³•ç”Ÿæ•ˆã€‚ä¸­é—´ä»¶çš„æ‰§è¡Œå¾ˆåƒä¸€ä¸ªæ´‹è‘±ï¼Œä½†å¹¶ä¸æ˜¯ä¸€å±‚ä¸€å±‚çš„æ‰§è¡Œï¼Œè€Œæ˜¯ä»¥nextä¸ºåˆ†ç•Œï¼Œå…ˆæ‰§è¡Œæœ¬å±‚ä¸­nextä»¥å‰çš„éƒ¨åˆ†ï¼Œå½“ä¸‹ä¸€å±‚ä¸­é—´ä»¶æ‰§è¡Œå®Œåï¼Œå†æ‰§è¡Œæœ¬å±‚nextä»¥åçš„éƒ¨åˆ†ã€‚</p>
<p><img src="/2021/07/19/koa/2.png" srcset="/img/loading.gif" alt="2"></p>
<h5 id="logger-js"><a class="header-anchor" href="#logger-js">ğŸ­</a>logger.js</h5>
<p>è¿™ä¸ªä¸­é—´ä»¶ä¼šåœ¨æ§åˆ¶å°æˆ–è€…æ—¥å¿—ä¸­æ‰“å°å‡ºå›ºå®šçš„æ ¼å¼ï¼Œhttpè¯·æ±‚æ–¹æ³•ã€è¿”å›çŠ¶æ€ã€è¯·æ±‚urlã€IPåœ°å€ã€è¯·æ±‚æ—¶é—´ç­‰ï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆå¥½çš„åˆ©ç”¨log4jsä¸­çš„é…ç½®ï¼Œæ¥æ‰“å°å‡ºè‡ªå®šä¹‰çš„æ—¥å¿—ã€‚å¯ä»¥ä»£æ›¿<code>console.log()</code>ä½¿ç”¨,åœ¨ä½¿ç”¨è¿™ä¸ªä¸­é—´ä»¶çš„æ—¶å€™ï¼Œå¿…é¡»æ”¾åœ¨ç¬¬ä¸€ä¸ªä¸­é—´ä»¶ï¼Œæ‰èƒ½ä¿è¯æ‰€ä»¥çš„è¯·æ±‚åŠæ“ä½œä¼šå…ˆç»è¿‡loggerè¿›è¡Œè®°å½•å†åˆ°ä¸‹ä¸€ä¸ªä¸­é—´ä»¶.</p>
<pre><code class="hljs javascript"><span class="hljs-meta">&#x27;use strict&#x27;</span>

<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>)
<span class="hljs-keyword">const</span> log4js = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;log4js&#x27;</span>)
<span class="hljs-keyword">const</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../config&#x27;</span>)

<span class="hljs-comment">// è¿™ä¸ªæ˜¯åˆ¤æ–­æ˜¯å¦æœ‰logsç›®å½•ï¼Œæ²¡æœ‰å°±æ–°å»ºï¼Œç”¨æ¥å­˜æ”¾æ—¥å¿—</span>
<span class="hljs-keyword">const</span> logsDir = path.parse(config.logPath).dir
<span class="hljs-keyword">if</span> (!fs.existsSync(logsDir)) &#123;
  fs.mkdirSync(logsDir)
&#125;
<span class="hljs-comment">// é…ç½®log4.js</span>
log4js.configure(&#123;
  appenders: &#123;
    <span class="hljs-built_in">console</span>: &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;console&#x27;</span> &#125;,
    dateFile: &#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;dateFile&#x27;</span>, <span class="hljs-attr">filename</span>: config.logPath, <span class="hljs-attr">pattern</span>: <span class="hljs-string">&#x27;-yyyy-MM-dd&#x27;</span> &#125;
  &#125;,
  categories: &#123;
    <span class="hljs-keyword">default</span>: &#123;
      appenders: [<span class="hljs-string">&#x27;console&#x27;</span>, <span class="hljs-string">&#x27;dateFile&#x27;</span>],
      level: <span class="hljs-string">&#x27;info&#x27;</span>
    &#125;
  &#125;
&#125;)

<span class="hljs-keyword">const</span> logger = log4js.getLogger(<span class="hljs-string">&#x27;[Default]&#x27;</span>)
<span class="hljs-comment">// loggerä¸­é—´ä»¶</span>
<span class="hljs-keyword">const</span> loggerMiddleware = <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;
<span class="hljs-comment">// è¯·æ±‚å¼€å§‹æ—¶é—´</span>
  <span class="hljs-keyword">const</span> start = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()
  <span class="hljs-keyword">await</span> next()
  <span class="hljs-comment">// ç»“æŸæ—¶é—´</span>
  <span class="hljs-keyword">const</span> ms = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>() - start
    <span class="hljs-comment">// æ‰“å°å‡ºè¯·æ±‚ç›¸å…³å‚æ•°</span>
  <span class="hljs-keyword">const</span> remoteAddress = ctx.headers[<span class="hljs-string">&#x27;x-forwarded-for&#x27;</span>] || ctx.ip || ctx.ips ||
    (ctx.socket &amp;&amp; (ctx.socket.remoteAddress || (ctx.socket.socket &amp;&amp; ctx.socket.socket.remoteAddress)))
  <span class="hljs-keyword">let</span> logText = <span class="hljs-string">`<span class="hljs-subst">$&#123;ctx.method&#125;</span> <span class="hljs-subst">$&#123;ctx.status&#125;</span> <span class="hljs-subst">$&#123;ctx.url&#125;</span> è¯·æ±‚å‚æ•°ï¼š <span class="hljs-subst">$&#123;<span class="hljs-built_in">JSON</span>.stringify(ctx.request.body)&#125;</span> å“åº”å‚æ•°ï¼š <span class="hljs-subst">$&#123;<span class="hljs-built_in">JSON</span>.stringify(ctx.body)&#125;</span> - <span class="hljs-subst">$&#123;remoteAddress&#125;</span> - <span class="hljs-subst">$&#123;ms&#125;</span>ms`</span>
  logger.info(logText)
&#125;
<span class="hljs-built_in">module</span>.exports = &#123;
  logger,
  loggerMiddleware
&#125;</code></pre>
<h5 id="response-js"><a class="header-anchor" href="#response-js">ğŸ­</a>response.js</h5>
<p>è¿™ä¸ªä¸­é—´ä»¶ä¸»è¦æ˜¯ç”¨æ¥å¯¹è¿”å›å‰ç«¯çš„å“åº”è¿›è¡Œå¤„ç†ï¼ŒåŸºç¡€çš„koaæ¨¡æ¿ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <code>ctx.body</code>è¿›è¡Œè¿”å›å‰ç«¯ï¼Œä½†æ˜¯æœ‰äº›ä¸œè¥¿ç»å¸¸é‡å¤å†™ï¼Œè¿›è¡Œå°è£…è¾ƒæ–¹ä¾¿ã€‚</p>
<h5 id="cors-js"><a class="header-anchor" href="#cors-js">ğŸ­</a>cors.js</h5>
<p>åœ¨å‰åç«¯æ¥å£è¯·æ±‚ä¸­ï¼Œç”±äºæµè§ˆå™¨çš„é™åˆ¶ï¼Œä¼šå‡ºç°è·¨åŸŸçš„æƒ…å†µã€‚å¸¸ç”¨çš„è·¨åŸŸæ–¹æ¡ˆæœ‰ï¼š</p>
<ul>
<li>JSONPè·¨åŸŸ</li>
<li>nginxåå‘ä»£ç†</li>
<li>æœåŠ¡å™¨ç«¯ä¿®æ”¹heade</li>
<li>document.domain</li>
<li><a target="_blank" rel="noopener" href="http://window.name">window.name</a></li>
<li>postMessage</li>
<li>åå°é…ç½®è¿è¡Œè·¨åŸŸ</li>
</ul>
<p>corså…·ä½“å®ç°è·¨åŸŸ</p>
<pre><code class="hljs awk">app.use(async (ctx, <span class="hljs-keyword">next</span>) =&gt; &#123;
    <span class="hljs-regexp">//</span> å…è®¸æ¥è‡ªæ‰€æœ‰åŸŸåè¯·æ±‚
    ctx.set(<span class="hljs-string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="hljs-string">&quot;*&quot;</span>);
    <span class="hljs-regexp">//</span> è¿™æ ·å°±èƒ½åªå…è®¸ http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">8080</span> è¿™ä¸ªåŸŸåçš„è¯·æ±‚äº†
    <span class="hljs-regexp">//</span> ctx.set(<span class="hljs-string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="hljs-string">&quot;http://localhost:8080&quot;</span>); 

    <span class="hljs-regexp">//</span> è®¾ç½®æ‰€å…è®¸çš„HTTPè¯·æ±‚æ–¹æ³•
    ctx.set(<span class="hljs-string">&quot;Access-Control-Allow-Methods&quot;</span>, <span class="hljs-string">&quot;OPTIONS, GET, PUT, POST, DELETE&quot;</span>);

    <span class="hljs-regexp">//</span> å­—æ®µæ˜¯å¿…éœ€çš„ã€‚å®ƒä¹Ÿæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œè¡¨æ˜æœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰å¤´ä¿¡æ¯å­—æ®µ.
    ctx.set(<span class="hljs-string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="hljs-string">&quot;x-requested-with, accept, origin, content-type&quot;</span>);

    <span class="hljs-regexp">//</span> æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ä»¥åï¼Œæ£€æŸ¥äº†Originã€Access-Control-Request-Methodå’ŒAccess-Control-Request-Headerså­—æ®µä»¥åï¼Œç¡®è®¤å…è®¸è·¨æºè¯·æ±‚ï¼Œå°±å¯ä»¥åšå‡ºå›åº”ã€‚

    <span class="hljs-regexp">//</span> Content-Typeè¡¨ç¤ºå…·ä½“è¯·æ±‚ä¸­çš„åª’ä½“ç±»å‹ä¿¡æ¯
    ctx.set(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json;charset=utf-8&quot;</span>);

    <span class="hljs-regexp">//</span> è¯¥å­—æ®µå¯é€‰ã€‚å®ƒçš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å…è®¸å‘é€Cookieã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCookieä¸åŒ…æ‹¬åœ¨CORSè¯·æ±‚ä¹‹ä¸­ã€‚
    <span class="hljs-regexp">//</span> å½“è®¾ç½®æˆå…è®¸è¯·æ±‚æºå¸¦cookieæ—¶ï¼Œéœ€è¦ä¿è¯<span class="hljs-string">&quot;Access-Control-Allow-Origin&quot;</span>æ˜¯æœåŠ¡å™¨æœ‰çš„åŸŸåï¼Œè€Œä¸èƒ½æ˜¯<span class="hljs-string">&quot;*&quot;</span>;
    ctx.set(<span class="hljs-string">&quot;Access-Control-Allow-Credentials&quot;</span>, true);

    <span class="hljs-regexp">//</span> è¯¥å­—æ®µå¯é€‰ï¼Œç”¨æ¥æŒ‡å®šæœ¬æ¬¡é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’ã€‚
    <span class="hljs-regexp">//</span> å½“è¯·æ±‚æ–¹æ³•æ˜¯PUTæˆ–DELETEç­‰ç‰¹æ®Šæ–¹æ³•æˆ–è€…Content-Typeå­—æ®µçš„ç±»å‹æ˜¯application/jsonæ—¶ï¼ŒæœåŠ¡å™¨ä¼šæå‰å‘é€ä¸€æ¬¡è¯·æ±‚è¿›è¡ŒéªŒè¯
    <span class="hljs-regexp">//</span> ä¸‹é¢çš„çš„è®¾ç½®åªæœ¬æ¬¡éªŒè¯çš„æœ‰æ•ˆæ—¶é—´ï¼Œå³åœ¨è¯¥æ—¶é—´æ®µå†…æœåŠ¡ç«¯å¯ä»¥ä¸ç”¨è¿›è¡ŒéªŒè¯
    ctx.set(<span class="hljs-string">&quot;Access-Control-Max-Age&quot;</span>, <span class="hljs-number">300</span>);

    /*
    CORSè¯·æ±‚æ—¶ï¼ŒXMLHttpRequestå¯¹è±¡çš„getResponseHeader()æ–¹æ³•åªèƒ½æ‹¿åˆ°<span class="hljs-number">6</span>ä¸ªåŸºæœ¬å­—æ®µï¼š
        Cache-Controlã€
        Content-Languageã€
        Content-Typeã€
        Expiresã€
        Last-Modifiedã€
        Pragmaã€‚
    */
    <span class="hljs-regexp">//</span> éœ€è¦è·å–å…¶ä»–å­—æ®µæ—¶ï¼Œä½¿ç”¨Access-Control-Expose-Headersï¼Œ
    <span class="hljs-regexp">//</span> getResponseHeader(<span class="hljs-string">&#x27;myData&#x27;</span>)å¯ä»¥è¿”å›æˆ‘ä»¬æ‰€éœ€çš„å€¼
    <span class="hljs-regexp">//</span>https:<span class="hljs-regexp">//</span>www.rails365.net<span class="hljs-regexp">/articles/</span>cors-jin-jie-expose-headers-wu
    ctx.set(<span class="hljs-string">&quot;Access-Control-Expose-Headers&quot;</span>, <span class="hljs-string">&quot;myData&quot;</span>);
    
    await <span class="hljs-keyword">next</span>();
&#125;)</code></pre>
<h5 id="koa-helmet-ä¸­é—´ä»¶"><a class="header-anchor" href="#koa-helmet-ä¸­é—´ä»¶">ğŸ­</a>koa-helmet ä¸­é—´ä»¶</h5>
<p>koa-helmet å¯ä»¥å¸®åŠ© app æŠµå¾¡ä¸€äº›æ¯”è¾ƒå¸¸è§çš„å®‰å…¨ web å®‰å…¨éšæ‚£ï¼Œå®ƒå°† 9 ä¸ªå®‰å…¨ä¸­é—´ä»¶é›†ä¸­åˆ°äº†ä¸€èµ·ï¼Œåšäº†åˆå¹¶,å¤§éƒ¨åˆ†éƒ½æ˜¯å¯¹äº http header çš„æ“ä½œã€‚é»˜è®¤å¼€å¯åŠŸèƒ½ï¼š</p>
<p><img src="/2021/07/19/koa/5.png" srcset="/img/loading.gif" alt="5"></p>
<p>å®‰è£…åéœ€åœ¨app.jsè¿›è¡Œå¼•ç”¨ï¼š</p>
<pre><code class="hljs isbl"><span class="hljs-variable">const</span> <span class="hljs-variable">helmet</span> = <span class="hljs-function"><span class="hljs-title">require</span>(<span class="hljs-string">&quot;koa-helmet&quot;</span>)</span>

<span class="hljs-comment">// Helmet</span>
<span class="hljs-variable">app.use</span>(<span class="hljs-function"><span class="hljs-title">helmet</span>())</span></code></pre>
<h5 id="è·¯ç”±é…ç½®"><a class="header-anchor" href="#è·¯ç”±é…ç½®">ğŸ­</a>è·¯ç”±é…ç½®</h5>
<ul>
<li><code>private.js</code>ï¼šè¯¥æ–‡ä»¶ä¸‹çš„è·¯ç”±æ˜¯éœ€è¦é€šè¿‡jwtéªŒè¯çš„ï¼Œæ‰èƒ½è¿›è¡Œè®¿é—®ã€‚</li>
<li><code>public.js</code>ï¼šè¯¥æ–‡ä»¶ä¸ä¸Šé¢ç›¸åï¼Œä¸»è¦ç”¨æ¥ä¸è¿›è¡Œç™»å½•çš„æ ¡éªŒï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ç™»å½•ã€æ³¨å†Œç­‰ä¸éœ€è¦éªŒè¯çš„æ¥å£ã€‚</li>
</ul>
<h5 id="controllersæ–‡ä»¶"><a class="header-anchor" href="#controllersæ–‡ä»¶">ğŸ­</a>controllersæ–‡ä»¶</h5>
<p>ä¸ºäº†è®©æ•´ä¸ªé¡¹ç›®æ›´ä¸ºæ¨¡å—åŒ–ï¼Œè¯¥ç›®å½•ä¸‹ä¸»è¦æ˜¯å¤„ç†å¯¹åº”çš„è·¯ç”±çš„å›è°ƒå‡½æ•°ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¸ä¼šåœ¨routeræ–‡ä»¶ä¸­å»ä¸šåŠ¡é€»è¾‘æ“ä½œç­‰æ­¥éª¤ï¼Œè¿™é‡Œé‡‡ç”¨ routes å’Œ controller åˆ†å¼€ï¼Œåœ¨æ–¹ä¾¿ä»£ç çš„æŸ¥çœ‹åŒæ—¶ï¼Œä¹Ÿæ–¹ä¾¿ä»£ç çš„ç»´æŠ¤å’Œå¼€å‘ã€‚</p>
<p>controllerä¸‹çš„index.jsæ–‡ä»¶å°†å…¶ä»–æ–‡ä»¶å¯¼å‡ºç»Ÿä¸€åˆ°indexæš´éœ²å‡ºå»ï¼š</p>
<pre><code class="hljs javascript"><span class="hljs-meta">&#x27;use strict&#x27;</span>

<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)

<span class="hljs-keyword">const</span> files = fs.readdirSync(__dirname).filter(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> file !== <span class="hljs-string">&#x27;index.js&#x27;</span>)

<span class="hljs-keyword">const</span> controllers = &#123;&#125;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> files) &#123;
  <span class="hljs-keyword">if</span> (file.toLowerCase().endsWith(<span class="hljs-string">&#x27;js&#x27;</span>)) &#123;
    <span class="hljs-keyword">const</span> controller = <span class="hljs-built_in">require</span>(<span class="hljs-string">`./<span class="hljs-subst">$&#123;file&#125;</span>`</span>)
    controllers[<span class="hljs-string">`<span class="hljs-subst">$&#123;file.replace(<span class="hljs-regexp">/\.js/</span>, <span class="hljs-string">&#x27;&#x27;</span>)&#125;</span>`</span>] = controller
  &#125;
&#125;

<span class="hljs-built_in">module</span>.exports = controllers</code></pre>
<p>controllerä¸‹çš„user.jsæ–‡ä»¶æ˜¯æˆ‘ä»¬å¤„ç†ä¸šåŠ¡çš„ï¼Œå¯æŒ‰éœ€æ·»åŠ </p>
<pre><code class="hljs javascript"><span class="hljs-meta">&#x27;use strict&#x27;</span>

<span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;jsonwebtoken&#x27;</span>)
<span class="hljs-keyword">const</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../config&#x27;</span>)
<span class="hljs-keyword">const</span> userServices = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../services&#x27;</span>).user
<span class="hljs-keyword">const</span> &#123; InvalidQueryError &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../lib/error&#x27;</span>)
<span class="hljs-keyword">const</span> login = &#123;&#125;
login.login = <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;
    <span class="hljs-built_in">console</span>.log(userServices)
    <span class="hljs-keyword">const</span> &#123;userName, password&#125; = ctx.request.body
    <span class="hljs-keyword">if</span> (!userName || !password) &#123;
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> InvalidQueryError()
    &#125;
    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> userServices.login(&#123;
        userName: userName,
        password: password
    &#125;)
    <span class="hljs-keyword">if</span> (!user) &#123;
        ctx.result = <span class="hljs-string">&#x27;&#x27;</span>
        ctx.msg = <span class="hljs-string">&#x27;ç”¨æˆ·ä¸å­˜åœ¨&#x27;</span>
    &#125; <span class="hljs-keyword">else</span> &#123;
        ctx.result = jwt.sign(&#123;
            data: user._id,
            <span class="hljs-comment">// è®¾ç½® token è¿‡æœŸæ—¶é—´</span>
            exp: <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Date</span>.now() / <span class="hljs-number">1000</span>) + (<span class="hljs-number">60</span> * <span class="hljs-number">60</span>), <span class="hljs-comment">// 60 seconds * 60 minutes = 1 hour</span>
        &#125;, config.secret)
    &#125;
    <span class="hljs-keyword">return</span> next()
&#125;

<span class="hljs-built_in">module</span>.exports = login</code></pre>
<h4 id="modelsæ–‡ä»¶"><a class="header-anchor" href="#modelsæ–‡ä»¶">ğŸ­</a>modelsæ–‡ä»¶</h4>
<p>è¯¥é¡¹ç›®ä¸­æ˜¯ä½¿ç”¨<code>mongoose</code>å¯¹<code>mongoDB</code>å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œ,<code>mongoose</code>çš„é…ç½®åŒ…æ‹¬ä¸‰å¤§éƒ¨åˆ†ï¼š<code>connect</code>ã€<code>Models</code>å’Œ<code>Schema</code></p>
<p><code>connect</code>ï¼šç”¨äºåˆ›å»ºæ•°æ®åº“è¿æ¥åŠç›‘å¬</p>
<p><code>Schema</code>ï¼šSchemaä¸»è¦ç”¨äºå®šä¹‰MongoDBä¸­é›†åˆCollectioné‡Œæ–‡æ¡£documentçš„ç»“æ„,å¯ä»¥ç†è§£ä¸ºmongooseå¯¹è¡¨ç»“æ„çš„å®šä¹‰(ä¸ä»…ä»…å¯ä»¥å®šä¹‰æ–‡æ¡£çš„ç»“æ„å’Œå±æ€§ï¼Œè¿˜å¯ä»¥å®šä¹‰æ–‡æ¡£çš„å®ä¾‹æ–¹æ³•ã€é™æ€æ¨¡å‹æ–¹æ³•ã€å¤åˆç´¢å¼•ç­‰)ï¼Œæ¯ä¸ªschemaä¼šæ˜ å°„åˆ°mongodbä¸­çš„ä¸€ä¸ªcollectionï¼Œschemaä¸å…·å¤‡æ“ä½œæ•°æ®åº“çš„èƒ½åŠ›ï¼Œç®€å•ç†è§£æ˜¯å¯¹å­—æ®µçš„å®šä¹‰ï¼Œæ“ä½œæ•°æ®åº“å¿…é¡»æŒ‰ç…§è¿™äº›å­—æ®µè¿›è¡Œï¼Œå¦åœ¨ä¼šæŠ¥é”™ã€‚</p>
<p><code>Models</code>ï¼š ã€€Modelæ˜¯ç”±Schemaç¼–è¯‘è€Œæˆçš„å‡æƒ³ï¼ˆfancyï¼‰æ„é€ å™¨ï¼Œå…·æœ‰æŠ½è±¡å±æ€§å’Œè¡Œä¸ºã€‚Modelçš„æ¯ä¸€ä¸ªå®ä¾‹ï¼ˆinstanceï¼‰å°±æ˜¯ä¸€ä¸ªdocumentï¼Œdocumentå¯ä»¥ä¿å­˜åˆ°æ•°æ®åº“å’Œå¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œã€‚ç®€å•è¯´å°±æ˜¯modelæ˜¯ç”±schemaç”Ÿæˆçš„æ¨¡å‹ï¼Œå¯ä»¥å¯¹æ•°æ®åº“çš„æ“ä½œã€‚</p>
<h4 id="package-jsonæ–‡ä»¶"><a class="header-anchor" href="#package-jsonæ–‡ä»¶">ğŸ­</a>package.jsonæ–‡ä»¶</h4>
<p>æ¯ä¸ªNodejsé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹é¢ï¼Œä¸€èˆ¬éƒ½ä¼šæœ‰ä¸€ä¸ªpackage.jsonæ–‡ä»¶ã€‚è¯¥æ–‡ä»¶å¯ä»¥ç”±npm initç”Ÿæˆï¼Œå®šä¹‰äº†é¡¹ç›®æ‰€éœ€è¦çš„å„ç§æ¨¡å—ï¼Œä»¥åŠé¡¹ç›®çš„é…ç½®ä¿¡æ¯ï¼ˆæ¯”å¦‚åç§°ã€ç‰ˆæœ¬ã€è®¸å¯è¯ç­‰å…ƒæ•°æ®)ã€‚ package.jsonæ–‡ä»¶å†…éƒ¨å°±æ˜¯ä¸€ä¸ªJSONå¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„æ¯ä¸€ä¸ªæˆå‘˜å°±æ˜¯å½“å‰é¡¹ç›®çš„ä¸€é¡¹è®¾ç½®ã€‚æˆ‘ä»¬ä¹Ÿå¯åœ¨é‡Œé¢é…ç½®æˆ‘ä»¬çš„<code>npm run XXX</code>çš„å‘½ä»¤ã€‚</p>
<p>æœ¬é¡¹ç›®çš„package.jsonï¼š</p>
<pre><code class="hljs json">&#123;
  <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;koa-template&quot;</span>,
  <span class="hljs-attr">&quot;version&quot;</span>: <span class="hljs-string">&quot;0.1.0&quot;</span>,
  <span class="hljs-attr">&quot;author&quot;</span>: <span class="hljs-string">&quot;bayi&quot;</span>,
  <span class="hljs-attr">&quot;private&quot;</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">&quot;scripts&quot;</span>: &#123;
    <span class="hljs-attr">&quot;start&quot;</span>: <span class="hljs-string">&quot;node ./bin/www&quot;</span>,
    <span class="hljs-attr">&quot;dev&quot;</span>: <span class="hljs-string">&quot;pm2 start ecosystem.config.js --env dev&quot;</span>,
    <span class="hljs-attr">&quot;test&quot;</span>: <span class="hljs-string">&quot;pm2 start ecosystem.config.js --env test&quot;</span>,
    <span class="hljs-attr">&quot;pro&quot;</span>: <span class="hljs-string">&quot;pm2 start ecosystem.config.js --env pro&quot;</span>,
    <span class="hljs-attr">&quot;logs&quot;</span>: <span class="hljs-string">&quot;pm2 logs&quot;</span>,
    <span class="hljs-attr">&quot;stop&quot;</span>: <span class="hljs-string">&quot;pm2 stop ecosystem.config.js&quot;</span>
  &#125;,
  <span class="hljs-attr">&quot;dependencies&quot;</span>: &#123;
    <span class="hljs-attr">&quot;koa&quot;</span>: <span class="hljs-string">&quot;^2.6.2&quot;</span>,
    <span class="hljs-attr">&quot;koa-bodyparser&quot;</span>: <span class="hljs-string">&quot;^4.2.1&quot;</span>,
    <span class="hljs-attr">&quot;koa-helmet&quot;</span>: <span class="hljs-string">&quot;^4.1.0&quot;</span>,
    <span class="hljs-attr">&quot;koa-jwt&quot;</span>: <span class="hljs-string">&quot;^3.5.1&quot;</span>,
    <span class="hljs-attr">&quot;koa-router&quot;</span>: <span class="hljs-string">&quot;^7.4.0&quot;</span>,
    <span class="hljs-attr">&quot;koa-static-cache&quot;</span>: <span class="hljs-string">&quot;^5.1.2&quot;</span>,
    <span class="hljs-attr">&quot;koa2-cors&quot;</span>: <span class="hljs-string">&quot;^2.0.6&quot;</span>,
    <span class="hljs-attr">&quot;log4js&quot;</span>: <span class="hljs-string">&quot;^3.0.6&quot;</span>,
    <span class="hljs-attr">&quot;mongoose&quot;</span>: <span class="hljs-string">&quot;^5.5.5&quot;</span>
  &#125;
&#125;</code></pre>
<h4 id="config-jsæ–‡ä»¶"><a class="header-anchor" href="#config-jsæ–‡ä»¶">ğŸ­</a>config.jsæ–‡ä»¶</h4>
<p>æ ¹ç›®å½•æ–°å»ºè¯¥æ–‡ä»¶ä¸»è¦ç”¨æ¥å­˜æ”¾å…¨å±€çš„é…ç½®ï¼Œå¦‚æœä¸€ä¸ªé¡¹ç›®ä¸­æ²¡æœ‰å…¨å±€çš„é…ç½®ï¼Œé‚£ä¹ˆä¸€ä¸ªåœ°æ–¹æ”¹åŠ¨ç‰µåŠ¨çš„å…¶ä»–åœ°æ–¹å¾ˆå¤šï¼Œè¿™æ ·å·¥ä½œæ•ˆç‡å¾ˆä½ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šæŠŠå¸¸ç”¨çš„éƒ½æ”¾åœ¨è¿™ä¸ªæ–‡ä»¶ï¼Œä¾‹å¦‚ï¼šæ•°æ®åº“å‚æ•°ï¼Œç«¯å£ï¼Œå¯†é’¥ï¼Œå…¨å±€å˜é‡ç­‰ã€‚</p>
<h4 id="servicesæ–‡ä»¶"><a class="header-anchor" href="#servicesæ–‡ä»¶">ğŸ­</a>servicesæ–‡ä»¶</h4>
<p>è¿™ä¸ªæ–‡ä»¶ä¸»è¦æ˜¯ç”¨æ¥å¤„ç†æ•°æ®åº“ä»¥åŠæœåŠ¡ç­‰é€»è¾‘ï¼Œè¯¥æ–‡ä»¶å¤¹ä¸‹index.jsæ–‡ä»¶å†…å®¹ä¸controllersæ–‡ä»¶ä¸­çš„ç”¨æ³•ä¸€è‡´ã€‚</p>
<h4 id="PM2é…ç½®"><a class="header-anchor" href="#PM2é…ç½®">ğŸ­</a>PM2é…ç½®</h4>
<p>PM2æ˜¯å¯ä»¥ç”¨äºç”Ÿäº§ç¯å¢ƒçš„Nodejsçš„è¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œå¹¶ä¸”å®ƒå†…ç½®ä¸€ä¸ªè´Ÿè½½å‡è¡¡ã€‚å®ƒå¯ä»¥ä¿è¯æœåŠ¡ä¸ä¼šä¸­æ–­ä¸€ç›´åœ¨çº¿ï¼Œå¹¶ä¸”æä¾›0ç§’reloadåŠŸèƒ½ï¼Œè¿˜æœ‰å…¶ä»–ä¸€ç³»åˆ—è¿›ç¨‹ç®¡ç†ã€ç›‘æ§åŠŸèƒ½ã€‚</p>
<h4 id="libæ–‡ä»¶"><a class="header-anchor" href="#libæ–‡ä»¶">ğŸ­</a>libæ–‡ä»¶</h4>
<ul>
<li><code>error.js</code>ï¼šä¸»è¦æ˜¯åœ¨ä¸­é—´ä»¶ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œç”±äºå‰é¢æˆ‘ä»¬å·²ç»åŠ å…¥äº†å¼‚å¸¸æ•è·çš„ä¸­é—´ä»¶ï¼Œåœ¨ä¸­é—´ä»¶æ“ä½œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰é”™è¯¯ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬é…ç½®æ‰€ç”¨çš„ã€‚</li>
<li><code>mongoDB.js</code>ï¼šå¯¹mongoDBçš„é“¾æ¥é…ç½®ã€‚</li>
</ul>
<h4 id="binæ–‡ä»¶"><a class="header-anchor" href="#binæ–‡ä»¶">ğŸ­</a>binæ–‡ä»¶</h4>
<p>è¯¥æ–‡ä»¶æ˜¯ç”¨æ¥éƒ¨ç½²çš„æ—¶å€™å¯ä»¥å¯åŠ¨æˆ‘ä»¬ä¸€æ•´ä¸ªåç«¯ç¨‹åºï¼Œä¹Ÿå°±æ˜¯å‰ç«¯ä¸­çš„é›†æˆçš„è¿è¡Œç¯å¢ƒã€‚æˆ‘ä»¬çš„è¿è¡Œã€å…³é—­ã€é‡å¯éƒ½åœ¨è¿™æ–‡ä»¶è¿›è¡Œå³å¯ã€‚</p>
<p>å‚è€ƒï¼š</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/47259f48c153">https://www.jianshu.com/p/47259f48c153</a></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/07/20/jwt/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">HFCTF2020||EasyLogin</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/07/19/11/">
                        <span class="hidden-mobile">JSON Web Token</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":200})
    NProgress.start()
    document.addEventListener('DOMContentLoaded', function() {
      window.NProgress && window.NProgress.inc();
    })
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.staticfile.org/tocbot/4.12.0/tocbot.min.js" ></script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>





  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>















<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ ä¿æŒåœ¨æœ€åº•éƒ¨ -->
<script  src="/js/boot.js" ></script>



</body>
</html>
